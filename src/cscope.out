cscope 15 $HOME/OSProj/redis-OS-project/src               0002220718
	@adlist.c

32 
	~<¡dlib.h
>

33 
	~"adli¡.h
"

34 
	~"zm®loc.h
"

41 
li¡
 *
	$li¡C»©e
()

43 
li¡
 *list;

45 ià((
li¡
 = 
	`zm®loc
((*li¡))è=ğ
NULL
)

46  
NULL
;

47 
li¡
->
h—d
 =†i¡->

 = 
NULL
;

48 
li¡
->
Ën
 = 0;

49 
li¡
->
dup
 = 
NULL
;

50 
li¡
->
ä“
 = 
NULL
;

51 
li¡
->
m©ch
 = 
NULL
;

52  
li¡
;

53 
	}
}

58 
	$li¡R–—£
(
li¡
 *list)

60 
Ën
;

61 
li¡Node
 *
cu¼’t
, *
Ãxt
;

63 
cu¼’t
 = 
li¡
->
h—d
;

64 
Ën
 = 
li¡
->len;

65 
Ën
--) {

66 
Ãxt
 = 
cu¼’t
->next;

67 ià(
li¡
->
ä“
èli¡->
	`ä“
(
cu¼’t
->
v®ue
);

68 
	`zä“
(
cu¼’t
);

69 
cu¼’t
 = 
Ãxt
;

71 
	`zä“
(
li¡
);

72 
	}
}

80 
li¡
 *
	$li¡AddNodeH—d
(
li¡
 *li¡, *
v®ue
)

82 
li¡Node
 *
node
;

84 ià((
node
 = 
	`zm®loc
((*node))è=ğ
NULL
)

85  
NULL
;

86 
node
->
v®ue
 = value;

87 ià(
li¡
->
Ën
 == 0) {

88 
li¡
->
h—d
 =†i¡->

 = 
node
;

89 
node
->
´ev
 =‚ode->
Ãxt
 = 
NULL
;

91 
node
->
´ev
 = 
NULL
;

92 
node
->
Ãxt
 = 
li¡
->
h—d
;

93 
li¡
->
h—d
->
´ev
 = 
node
;

94 
li¡
->
h—d
 = 
node
;

96 
li¡
->
Ën
++;

97  
li¡
;

98 
	}
}

106 
li¡
 *
	$li¡AddNodeTa
(
li¡
 *li¡, *
v®ue
)

108 
li¡Node
 *
node
;

110 ià((
node
 = 
	`zm®loc
((*node))è=ğ
NULL
)

111  
NULL
;

112 
node
->
v®ue
 = value;

113 ià(
li¡
->
Ën
 == 0) {

114 
li¡
->
h—d
 =†i¡->

 = 
node
;

115 
node
->
´ev
 =‚ode->
Ãxt
 = 
NULL
;

117 
node
->
´ev
 = 
li¡
->

;

118 
node
->
Ãxt
 = 
NULL
;

119 
li¡
->

->
Ãxt
 = 
node
;

120 
li¡
->

 = 
node
;

122 
li¡
->
Ën
++;

123  
li¡
;

124 
	}
}

126 
li¡
 *
	$li¡In£¹Node
(
li¡
 *li¡, 
li¡Node
 *
Şd_node
, *
v®ue
, 
aá”
) {

127 
li¡Node
 *
node
;

129 ià((
node
 = 
	`zm®loc
((*node))è=ğ
NULL
)

130  
NULL
;

131 
node
->
v®ue
 = value;

132 ià(
aá”
) {

133 
node
->
´ev
 = 
Şd_node
;

134 
node
->
Ãxt
 = 
Şd_node
->next;

135 ià(
li¡
->

 =ğ
Şd_node
) {

136 
li¡
->

 = 
node
;

139 
node
->
Ãxt
 = 
Şd_node
;

140 
node
->
´ev
 = 
Şd_node
->prev;

141 ià(
li¡
->
h—d
 =ğ
Şd_node
) {

142 
li¡
->
h—d
 = 
node
;

145 ià(
node
->
´ev
 !ğ
NULL
) {

146 
node
->
´ev
->
Ãxt
 =‚ode;

148 ià(
node
->
Ãxt
 !ğ
NULL
) {

149 
node
->
Ãxt
->
´ev
 =‚ode;

151 
li¡
->
Ën
++;

152  
li¡
;

153 
	}
}

159 
	$li¡D–Node
(
li¡
 *li¡, 
li¡Node
 *
node
)

161 ià(
node
->
´ev
)

162 
node
->
´ev
->
Ãxt
 =‚ode->next;

164 
li¡
->
h—d
 = 
node
->
Ãxt
;

165 ià(
node
->
Ãxt
)

166 
node
->
Ãxt
->
´ev
 =‚ode->prev;

168 
li¡
->

 = 
node
->
´ev
;

169 ià(
li¡
->
ä“
èli¡->
	`ä“
(
node
->
v®ue
);

170 
	`zä“
(
node
);

171 
li¡
->
Ën
--;

172 
	}
}

178 
li¡I‹r
 *
	$li¡G‘I‹¿tÜ
(
li¡
 *li¡, 
dœeùiÚ
)

180 
li¡I‹r
 *
™”
;

182 ià((
™”
 = 
	`zm®loc
((*™”))è=ğ
NULL
)  NULL;

183 ià(
dœeùiÚ
 =ğ
AL_START_HEAD
)

184 
™”
->
Ãxt
 = 
li¡
->
h—d
;

186 
™”
->
Ãxt
 = 
li¡
->

;

187 
™”
->
dœeùiÚ
 = direction;

188  
™”
;

189 
	}
}

192 
	$li¡R–—£I‹¿tÜ
(
li¡I‹r
 *
™”
) {

193 
	`zä“
(
™”
);

194 
	}
}

197 
	$li¡Rewšd
(
li¡
 *li¡, 
li¡I‹r
 *
li
) {

198 
li
->
Ãxt
 = 
li¡
->
h—d
;

199 
li
->
dœeùiÚ
 = 
AL_START_HEAD
;

200 
	}
}

202 
	$li¡RewšdTa
(
li¡
 *li¡, 
li¡I‹r
 *
li
) {

203 
li
->
Ãxt
 = 
li¡
->

;

204 
li
->
dœeùiÚ
 = 
AL_START_TAIL
;

205 
	}
}

221 
li¡Node
 *
	$li¡Next
(
li¡I‹r
 *
™”
)

223 
li¡Node
 *
cu¼’t
 = 
™”
->
Ãxt
;

225 ià(
cu¼’t
 !ğ
NULL
) {

226 ià(
™”
->
dœeùiÚ
 =ğ
AL_START_HEAD
)

227 
™”
->
Ãxt
 = 
cu¼’t
->next;

229 
™”
->
Ãxt
 = 
cu¼’t
->
´ev
;

231  
cu¼’t
;

232 
	}
}

242 
li¡
 *
	$li¡Dup
(
li¡
 *
Üig
)

244 
li¡
 *
cİy
;

245 
li¡I‹r
 
™”
;

246 
li¡Node
 *
node
;

248 ià((
cİy
 = 
	`li¡C»©e
()è=ğ
NULL
)

249  
NULL
;

250 
cİy
->
dup
 = 
Üig
->dup;

251 
cİy
->
ä“
 = 
Üig
->free;

252 
cİy
->
m©ch
 = 
Üig
->match;

253 
	`li¡Rewšd
(
Üig
, &
™”
);

254 (
node
 = 
	`li¡Next
(&
™”
)è!ğ
NULL
) {

255 *
v®ue
;

257 ià(
cİy
->
dup
) {

258 
v®ue
 = 
cİy
->
	`dup
(
node
->value);

259 ià(
v®ue
 =ğ
NULL
) {

260 
	`li¡R–—£
(
cİy
);

261  
NULL
;

264 
v®ue
 = 
node
->value;

265 ià(
	`li¡AddNodeTa
(
cİy
, 
v®ue
è=ğ
NULL
) {

266 
	`li¡R–—£
(
cİy
);

267  
NULL
;

270  
cİy
;

271 
	}
}

282 
li¡Node
 *
	$li¡S—rchKey
(
li¡
 *li¡, *
key
)

284 
li¡I‹r
 
™”
;

285 
li¡Node
 *
node
;

287 
	`li¡Rewšd
(
li¡
, &
™”
);

288 (
node
 = 
	`li¡Next
(&
™”
)è!ğ
NULL
) {

289 ià(
li¡
->
m©ch
) {

290 ià(
li¡
->
	`m©ch
(
node
->
v®ue
, 
key
)) {

291  
node
;

294 ià(
key
 =ğ
node
->
v®ue
) {

295  
node
;

299  
NULL
;

300 
	}
}

307 
li¡Node
 *
	$li¡Index
(
li¡
 *li¡, 
šdex
) {

308 
li¡Node
 *
n
;

310 ià(
šdex
 < 0) {

311 
šdex
 = (-index)-1;

312 
n
 = 
li¡
->

;

313 
šdex
-- && 
n
èÀğn->
´ev
;

315 
n
 = 
li¡
->
h—d
;

316 
šdex
-- && 
n
èÀğn->
Ãxt
;

318  
n
;

319 
	}
}

322 
	$li¡RÙ©e
(
li¡
 *list) {

323 
li¡Node
 *

 = 
li¡
->tail;

325 ià(
	`li¡L’gth
(
li¡
) <= 1) ;

328 
li¡
->

 =a->
´ev
;

329 
li¡
->

->
Ãxt
 = 
NULL
;

331 
li¡
->
h—d
->
´ev
 = 

;

332 

->
´ev
 = 
NULL
;

333 

->
Ãxt
 = 
li¡
->
h—d
;

334 
li¡
->
h—d
 = 

;

335 
	}
}

	@adlist.h

31 #iâdeà
__ADLIST_H__


32 
	#__ADLIST_H__


	)

36 
	sli¡Node
 {

37 
li¡Node
 *
	m´ev
;

38 
li¡Node
 *
	mÃxt
;

39 *
	mv®ue
;

40 } 
	tli¡Node
;

42 
	sli¡I‹r
 {

43 
li¡Node
 *
	mÃxt
;

44 
	mdœeùiÚ
;

45 } 
	tli¡I‹r
;

47 
	sli¡
 {

48 
li¡Node
 *
	mh—d
;

49 
li¡Node
 *
	m
;

50 *(*
	mdup
)(*
	m±r
);

51 (*
	mä“
)(*
	m±r
);

52 (*
	mm©ch
)(*
	m±r
, *
	mkey
);

53 
	mËn
;

54 } 
	tli¡
;

57 
	#li¡L’gth
(
l
è(Ö)->
Ën
)

	)

58 
	#li¡Fœ¡
(
l
è(Ö)->
h—d
)

	)

59 
	#li¡La¡
(
l
è(Ö)->

)

	)

60 
	#li¡P»vNode
(
n
è(Ò)->
´ev
)

	)

61 
	#li¡NextNode
(
n
è(Ò)->
Ãxt
)

	)

62 
	#li¡NodeV®ue
(
n
è(Ò)->
v®ue
)

	)

64 
	#li¡S‘DupM‘hod
(
l
,
m
è(Ö)->
dup
 = (m))

	)

65 
	#li¡S‘F»eM‘hod
(
l
,
m
è(Ö)->
ä“
 = (m))

	)

66 
	#li¡S‘M©chM‘hod
(
l
,
m
è(Ö)->
m©ch
 = (m))

	)

68 
	#li¡G‘DupM‘hod
(
l
è(Ö)->
dup
)

	)

69 
	#li¡G‘F»e
(
l
è(Ö)->
ä“
)

	)

70 
	#li¡G‘M©chM‘hod
(
l
è(Ö)->
m©ch
)

	)

73 
li¡
 *
li¡C»©e
();

74 
li¡R–—£
(
li¡
 *list);

75 
li¡
 *
li¡AddNodeH—d
Öi¡ *li¡, *
v®ue
);

76 
li¡
 *
li¡AddNodeTa
Öi¡ *li¡, *
v®ue
);

77 
li¡
 *
li¡In£¹Node
Öi¡ *li¡, 
li¡Node
 *
Şd_node
, *
v®ue
, 
aá”
);

78 
li¡D–Node
(
li¡
 *li¡, 
li¡Node
 *
node
);

79 
li¡I‹r
 *
li¡G‘I‹¿tÜ
(
li¡
 *li¡, 
dœeùiÚ
);

80 
li¡Node
 *
li¡Next
(
li¡I‹r
 *
™”
);

81 
li¡R–—£I‹¿tÜ
(
li¡I‹r
 *
™”
);

82 
li¡
 *
li¡Dup
Öi¡ *
Üig
);

83 
li¡Node
 *
li¡S—rchKey
(
li¡
 *li¡, *
key
);

84 
li¡Node
 *
li¡Index
(
li¡
 *li¡, 
šdex
);

85 
li¡Rewšd
(
li¡
 *li¡, 
li¡I‹r
 *
li
);

86 
li¡RewšdTa
(
li¡
 *li¡, 
li¡I‹r
 *
li
);

87 
li¡RÙ©e
(
li¡
 *list);

90 
	#AL_START_HEAD
 0

	)

91 
	#AL_START_TAIL
 1

	)

	@ae.c

33 
	~<¡dio.h
>

34 
	~<sys/time.h
>

35 
	~<sys/ty³s.h
>

36 
	~<uni¡d.h
>

37 
	~<¡dlib.h
>

38 
	~<pŞl.h
>

39 
	~<¡ršg.h
>

40 
	~<time.h
>

41 
	~<”ºo.h
>

43 
	~"«.h
"

44 
	~"zm®loc.h
"

45 
	~"cÚfig.h
"

49 #ifdeà
HAVE_EVPORT


50 
	~"«_evpÜt.c
"

52 #ifdeà
HAVE_EPOLL


53 
	~"«_•Şl.c
"

55 #ifdeà
HAVE_KQUEUE


56 
	~"«_kqueue.c
"

58 
	~"«_£Ëù.c
"

63 
«Ev’tLoİ
 *
	$«C»©eEv’tLoİ
(
£tsize
) {

64 
«Ev’tLoİ
 *
ev’tLoİ
;

65 
i
;

67 ià((
ev’tLoİ
 = 
	`zm®loc
((*ev’tLoİ))è=ğ
NULL
è
”r
;

68 
ev’tLoİ
->
ev’ts
 = 
	`zm®loc
((
«FeEv’t
)*
£tsize
);

69 
ev’tLoİ
->
fœed
 = 
	`zm®loc
((
«FœedEv’t
)*
£tsize
);

70 ià(
ev’tLoİ
->
ev’ts
 =ğ
NULL
 ||ƒv’tLoİ->
fœed
 =ğNULLè
”r
;

71 
ev’tLoİ
->
£tsize
 = setsize;

72 
ev’tLoİ
->
Ï¡Time
 = 
	`time
(
NULL
);

73 
ev’tLoİ
->
timeEv’tH—d
 = 
NULL
;

74 
ev’tLoİ
->
timeEv’tNextId
 = 0;

75 
ev’tLoİ
->
¡İ
 = 0;

76 
ev’tLoİ
->
maxfd
 = -1;

77 
ev’tLoİ
->
befÜe¦“p
 = 
NULL
;

78 ià(
	`«ApiC»©e
(
ev’tLoİ
è=ğ-1è
”r
;

81 
i
 = 0; i < 
£tsize
; i++)

82 
ev’tLoİ
->
ev’ts
[
i
].
mask
 = 
AE_NONE
;

83  
ev’tLoİ
;

85 
”r
:

86 ià(
ev’tLoİ
) {

87 
	`zä“
(
ev’tLoİ
->
ev’ts
);

88 
	`zä“
(
ev’tLoİ
->
fœed
);

89 
	`zä“
(
ev’tLoİ
);

91  
NULL
;

92 
	}
}

95 
	$«G‘S‘Size
(
«Ev’tLoİ
 *
ev’tLoİ
) {

96  
ev’tLoİ
->
£tsize
;

97 
	}
}

106 
	$«ResizeS‘Size
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
) {

107 
i
;

109 ià(
£tsize
 =ğ
ev’tLoİ
->£tsizeè 
AE_OK
;

110 ià(
ev’tLoİ
->
maxfd
 >ğ
£tsize
è 
AE_ERR
;

111 ià(
	`«ApiResize
(
ev’tLoİ
,
£tsize
è=ğ-1è 
AE_ERR
;

113 
ev’tLoİ
->
ev’ts
 = 
	`z»®loc
Óv’tLoİ->ev’ts,(
«FeEv’t
)*
£tsize
);

114 
ev’tLoİ
->
fœed
 = 
	`z»®loc
Óv’tLoİ->fœed,(
«FœedEv’t
)*
£tsize
);

115 
ev’tLoİ
->
£tsize
 = setsize;

119 
i
 = 
ev’tLoİ
->
maxfd
+1; i < 
£tsize
; i++)

120 
ev’tLoİ
->
ev’ts
[
i
].
mask
 = 
AE_NONE
;

121  
AE_OK
;

122 
	}
}

124 
	$«D–‘eEv’tLoİ
(
«Ev’tLoİ
 *
ev’tLoİ
) {

125 
	`«ApiF»e
(
ev’tLoİ
);

126 
	`zä“
(
ev’tLoİ
->
ev’ts
);

127 
	`zä“
(
ev’tLoİ
->
fœed
);

128 
	`zä“
(
ev’tLoİ
);

129 
	}
}

131 
	$«Stİ
(
«Ev’tLoİ
 *
ev’tLoİ
) {

132 
ev’tLoİ
->
¡İ
 = 1;

133 
	}
}

135 
	$«C»©eFeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
,

136 
«FeProc
 *
´oc
, *
ş›ÁD©a
)

138 ià(
fd
 >ğ
ev’tLoİ
->
£tsize
) {

139 
”ºo
 = 
ERANGE
;

140  
AE_ERR
;

142 
«FeEv’t
 *
ã
 = &
ev’tLoİ
->
ev’ts
[
fd
];

144 ià(
	`«ApiAddEv’t
(
ev’tLoİ
, 
fd
, 
mask
) == -1)

145  
AE_ERR
;

146 
ã
->
mask
 |= mask;

147 ià(
mask
 & 
AE_READABLE
è
ã
->
rfeProc
 = 
´oc
;

148 ià(
mask
 & 
AE_WRITABLE
è
ã
->
wfeProc
 = 
´oc
;

149 
ã
->
ş›ÁD©a
 = clientData;

150 ià(
fd
 > 
ev’tLoİ
->
maxfd
)

151 
ev’tLoİ
->
maxfd
 = 
fd
;

152  
AE_OK
;

153 
	}
}

155 
	$«D–‘eFeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
)

157 ià(
fd
 >ğ
ev’tLoİ
->
£tsize
) ;

158 
«FeEv’t
 *
ã
 = &
ev’tLoİ
->
ev’ts
[
fd
];

159 ià(
ã
->
mask
 =ğ
AE_NONE
) ;

161 
	`«ApiD–Ev’t
(
ev’tLoİ
, 
fd
, 
mask
);

162 
ã
->
mask
 = fe->mask & (~mask);

163 ià(
fd
 =ğ
ev’tLoİ
->
maxfd
 && 
ã
->
mask
 =ğ
AE_NONE
) {

165 
j
;

167 
j
 = 
ev’tLoİ
->
maxfd
-1; j >= 0; j--)

168 ià(
ev’tLoİ
->
ev’ts
[
j
].
mask
 !ğ
AE_NONE
) ;

169 
ev’tLoİ
->
maxfd
 = 
j
;

171 
	}
}

173 
	$«G‘FeEv’ts
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
) {

174 ià(
fd
 >ğ
ev’tLoİ
->
£tsize
)  0;

175 
«FeEv’t
 *
ã
 = &
ev’tLoİ
->
ev’ts
[
fd
];

177  
ã
->
mask
;

178 
	}
}

180 
	$«G‘Time
(*
£cÚds
, *
mli£cÚds
)

182 
timev®
 
tv
;

184 
	`g‘timeofday
(&
tv
, 
NULL
);

185 *
£cÚds
 = 
tv
.
tv_£c
;

186 *
mli£cÚds
 = 
tv
.
tv_u£c
/1000;

187 
	}
}

189 
	$«AddMli£cÚdsToNow
(
mli£cÚds
, *
£c
, *
ms
) {

190 
cur_£c
, 
cur_ms
, 
wh’_£c
, 
wh’_ms
;

192 
	`«G‘Time
(&
cur_£c
, &
cur_ms
);

193 
wh’_£c
 = 
cur_£c
 + 
mli£cÚds
/1000;

194 
wh’_ms
 = 
cur_ms
 + 
mli£cÚds
%1000;

195 ià(
wh’_ms
 >= 1000) {

196 
wh’_£c
 ++;

197 
wh’_ms
 -= 1000;

199 *
£c
 = 
wh’_£c
;

200 *
ms
 = 
wh’_ms
;

201 
	}
}

203 
	$«C»©eTimeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
mli£cÚds
,

204 
«TimeProc
 *
´oc
, *
ş›ÁD©a
,

205 
«Ev’tFš®iz”Proc
 *
fš®iz”Proc
)

207 
id
 = 
ev’tLoİ
->
timeEv’tNextId
++;

208 
«TimeEv’t
 *
‹
;

210 
‹
 = 
	`zm®loc
((*te));

211 ià(
‹
 =ğ
NULL
è 
AE_ERR
;

212 
‹
->
id
 = id;

213 
	`«AddMli£cÚdsToNow
(
mli£cÚds
,&
‹
->
wh’_£c
,&‹->
wh’_ms
);

214 
‹
->
timeProc
 = 
´oc
;

215 
‹
->
fš®iz”Proc
 = finalizerProc;

216 
‹
->
ş›ÁD©a
 = clientData;

217 
‹
->
Ãxt
 = 
ev’tLoİ
->
timeEv’tH—d
;

218 
ev’tLoİ
->
timeEv’tH—d
 = 
‹
;

219  
id
;

220 
	}
}

222 
	$«D–‘eTimeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
id
)

224 
«TimeEv’t
 *
‹
 = 
ev’tLoİ
->
timeEv’tH—d
;

225 
‹
) {

226 ià(
‹
->
id
 == id) {

227 
‹
->
id
 = 
AE_DELETED_EVENT_ID
;

228  
AE_OK
;

230 
‹
 =e->
Ãxt
;

232  
AE_ERR
;

233 
	}
}

246 
«TimeEv’t
 *
	$«S—rchN—»¡Tim”
(
«Ev’tLoİ
 *
ev’tLoİ
)

248 
«TimeEv’t
 *
‹
 = 
ev’tLoİ
->
timeEv’tH—d
;

249 
«TimeEv’t
 *
Ã¬e¡
 = 
NULL
;

251 
‹
) {

252 ià(!
Ã¬e¡
 || 
‹
->
wh’_£c
 <‚earest->when_sec ||

253 (
‹
->
wh’_£c
 =ğ
Ã¬e¡
->when_sec &&

254 
‹
->
wh’_ms
 < 
Ã¬e¡
->when_ms))

255 
Ã¬e¡
 = 
‹
;

256 
‹
 =e->
Ãxt
;

258  
Ã¬e¡
;

259 
	}
}

262 
	$´oûssTimeEv’ts
(
«Ev’tLoİ
 *
ev’tLoİ
) {

263 
´oûs£d
 = 0;

264 
«TimeEv’t
 *
‹
, *
´ev
;

265 
maxId
;

266 
time_t
 
now
 = 
	`time
(
NULL
);

276 ià(
now
 < 
ev’tLoİ
->
Ï¡Time
) {

277 
‹
 = 
ev’tLoİ
->
timeEv’tH—d
;

278 
‹
) {

279 
‹
->
wh’_£c
 = 0;

280 
‹
 =e->
Ãxt
;

283 
ev’tLoİ
->
Ï¡Time
 = 
now
;

285 
´ev
 = 
NULL
;

286 
‹
 = 
ev’tLoİ
->
timeEv’tH—d
;

287 
maxId
 = 
ev’tLoİ
->
timeEv’tNextId
-1;

288 
‹
) {

289 
now_£c
, 
now_ms
;

290 
id
;

293 ià(
‹
->
id
 =ğ
AE_DELETED_EVENT_ID
) {

294 
«TimeEv’t
 *
Ãxt
 = 
‹
->next;

295 ià(
´ev
 =ğ
NULL
)

296 
ev’tLoİ
->
timeEv’tH—d
 = 
‹
->
Ãxt
;

298 
´ev
->
Ãxt
 = 
‹
->next;

299 ià(
‹
->
fš®iz”Proc
)

300 
‹
->
	`fš®iz”Proc
(
ev’tLoİ
,e->
ş›ÁD©a
);

301 
	`zä“
(
‹
);

302 
‹
 = 
Ãxt
;

311 ià(
‹
->
id
 > 
maxId
) {

312 
‹
 =e->
Ãxt
;

315 
	`«G‘Time
(&
now_£c
, &
now_ms
);

316 ià(
now_£c
 > 
‹
->
wh’_£c
 ||

317 (
now_£c
 =ğ
‹
->
wh’_£c
 && 
now_ms
 >ğ‹->
wh’_ms
))

319 
»tv®
;

321 
id
 = 
‹
->id;

322 
»tv®
 = 
‹
->
	`timeProc
(
ev’tLoİ
, 
id
,e->
ş›ÁD©a
);

323 
´oûs£d
++;

324 ià(
»tv®
 !ğ
AE_NOMORE
) {

325 
	`«AddMli£cÚdsToNow
(
»tv®
,&
‹
->
wh’_£c
,&‹->
wh’_ms
);

327 
‹
->
id
 = 
AE_DELETED_EVENT_ID
;

330 
´ev
 = 
‹
;

331 
‹
 =e->
Ãxt
;

333  
´oûs£d
;

334 
	}
}

349 
	$«ProûssEv’ts
(
«Ev’tLoİ
 *
ev’tLoİ
, 
æags
)

351 
´oûs£d
 = 0, 
numev’ts
;

354 ià(!(
æags
 & 
AE_TIME_EVENTS
è&& !(æag & 
AE_FILE_EVENTS
))  0;

360 ià(
ev’tLoİ
->
maxfd
 != -1 ||

361 ((
æags
 & 
AE_TIME_EVENTS
è&& !(æag & 
AE_DONT_WAIT
))) {

362 
j
;

363 
«TimeEv’t
 *
shÜ‹¡
 = 
NULL
;

364 
timev®
 
tv
, *
tvp
;

366 ià(
æags
 & 
AE_TIME_EVENTS
 && !(æag & 
AE_DONT_WAIT
))

367 
shÜ‹¡
 = 
	`«S—rchN—»¡Tim”
(
ev’tLoİ
);

368 ià(
shÜ‹¡
) {

369 
now_£c
, 
now_ms
;

371 
	`«G‘Time
(&
now_£c
, &
now_ms
);

372 
tvp
 = &
tv
;

376 
ms
 =

377 (
shÜ‹¡
->
wh’_£c
 - 
now_£c
)*1000 +

378 
shÜ‹¡
->
wh’_ms
 - 
now_ms
;

380 ià(
ms
 > 0) {

381 
tvp
->
tv_£c
 = 
ms
/1000;

382 
tvp
->
tv_u£c
 = (
ms
 % 1000)*1000;

384 
tvp
->
tv_£c
 = 0;

385 
tvp
->
tv_u£c
 = 0;

391 ià(
æags
 & 
AE_DONT_WAIT
) {

392 
tv
.
tv_£c
 =v.
tv_u£c
 = 0;

393 
tvp
 = &
tv
;

396 
tvp
 = 
NULL
;

400 
numev’ts
 = 
	`«ApiPŞl
(
ev’tLoİ
, 
tvp
);

401 
j
 = 0; j < 
numev’ts
; j++) {

402 
«FeEv’t
 *
ã
 = &
ev’tLoİ
->
ev’ts
[ev’tLoİ->
fœed
[
j
].
fd
];

403 
mask
 = 
ev’tLoİ
->
fœed
[
j
].mask;

404 
fd
 = 
ev’tLoİ
->
fœed
[
j
].fd;

405 
rfœed
 = 0;

410 ià(
ã
->
mask
 & mask & 
AE_READABLE
) {

411 
rfœed
 = 1;

412 
ã
->
	`rfeProc
(
ev’tLoİ
,
fd
,ã->
ş›ÁD©a
,
mask
);

414 ià(
ã
->
mask
 & mask & 
AE_WRITABLE
) {

415 ià(!
rfœed
 || 
ã
->
wfeProc
 !ğã->
rfeProc
)

416 
ã
->
	`wfeProc
(
ev’tLoİ
,
fd
,ã->
ş›ÁD©a
,
mask
);

418 
´oûs£d
++;

422 ià(
æags
 & 
AE_TIME_EVENTS
)

423 
´oûs£d
 +ğ
	`´oûssTimeEv’ts
(
ev’tLoİ
);

425  
´oûs£d
;

426 
	}
}

430 
	$«Wa™
(
fd
, 
mask
, 
mli£cÚds
) {

431 
pŞlfd
 
pfd
;

432 
»tmask
 = 0, 
»tv®
;

434 
	`mem£t
(&
pfd
, 0, (pfd));

435 
pfd
.
fd
 = fd;

436 ià(
mask
 & 
AE_READABLE
è
pfd
.
ev’ts
 |ğ
POLLIN
;

437 ià(
mask
 & 
AE_WRITABLE
è
pfd
.
ev’ts
 |ğ
POLLOUT
;

439 ià((
»tv®
 = 
	`pŞl
(&
pfd
, 1, 
mli£cÚds
))== 1) {

440 ià(
pfd
.
»v’ts
 & 
POLLIN
è
»tmask
 |ğ
AE_READABLE
;

441 ià(
pfd
.
»v’ts
 & 
POLLOUT
è
»tmask
 |ğ
AE_WRITABLE
;

442 ià(
pfd
.
»v’ts
 & 
POLLERR
è
»tmask
 |ğ
AE_WRITABLE
;

443 ià(
pfd
.
»v’ts
 & 
POLLHUP
è
»tmask
 |ğ
AE_WRITABLE
;

444  
»tmask
;

446  
»tv®
;

448 
	}
}

450 
	$«Maš
(
«Ev’tLoİ
 *
ev’tLoİ
) {

451 
ev’tLoİ
->
¡İ
 = 0;

452 !
ev’tLoİ
->
¡İ
) {

453 ià(
ev’tLoİ
->
befÜe¦“p
 !ğ
NULL
)

454 
ev’tLoİ
->
	`befÜe¦“p
(eventLoop);

455 
	`«ProûssEv’ts
(
ev’tLoİ
, 
AE_ALL_EVENTS
);

457 
	}
}

459 *
	$«G‘ApiName
() {

460  
	`«ApiName
();

461 
	}
}

463 
	$«S‘BefÜeSË•Proc
(
«Ev’tLoİ
 *
ev’tLoİ
, 
«BefÜeSË•Proc
 *
befÜe¦“p
) {

464 
ev’tLoİ
->
befÜe¦“p
 = beforesleep;

465 
	}
}

	@ae.h

33 #iâdeà
__AE_H__


34 
	#__AE_H__


	)

36 
	~<time.h
>

38 
	#AE_OK
 0

	)

39 
	#AE_ERR
 -1

	)

41 
	#AE_NONE
 0

	)

42 
	#AE_READABLE
 1

	)

43 
	#AE_WRITABLE
 2

	)

45 
	#AE_FILE_EVENTS
 1

	)

46 
	#AE_TIME_EVENTS
 2

	)

47 
	#AE_ALL_EVENTS
 (
AE_FILE_EVENTS
|
AE_TIME_EVENTS
)

	)

48 
	#AE_DONT_WAIT
 4

	)

50 
	#AE_NOMORE
 -1

	)

51 
	#AE_DELETED_EVENT_ID
 -1

	)

54 
	#AE_NOTUSED
(
V
è((èV)

	)

56 
	g«Ev’tLoİ
;

59 
	t«FeProc
(
	t«Ev’tLoİ
 *
	tev’tLoİ
, 
	tfd
, *
	tş›ÁD©a
, 
	tmask
);

60 
	t«TimeProc
(
	t«Ev’tLoİ
 *
	tev’tLoİ
, 
	tid
, *
	tş›ÁD©a
);

61 
	t«Ev’tFš®iz”Proc
(
	t«Ev’tLoİ
 *
	tev’tLoİ
, *
	tş›ÁD©a
);

62 
	t«BefÜeSË•Proc
(
	t«Ev’tLoİ
 *
	tev’tLoİ
);

65 
	s«FeEv’t
 {

66 
	mmask
;

67 
«FeProc
 *
	mrfeProc
;

68 
«FeProc
 *
	mwfeProc
;

69 *
	mş›ÁD©a
;

70 } 
	t«FeEv’t
;

73 
	s«TimeEv’t
 {

74 
	mid
;

75 
	mwh’_£c
;

76 
	mwh’_ms
;

77 
«TimeProc
 *
	mtimeProc
;

78 
«Ev’tFš®iz”Proc
 *
	mfš®iz”Proc
;

79 *
	mş›ÁD©a
;

80 
«TimeEv’t
 *
	mÃxt
;

81 } 
	t«TimeEv’t
;

84 
	s«FœedEv’t
 {

85 
	mfd
;

86 
	mmask
;

87 } 
	t«FœedEv’t
;

90 
	s«Ev’tLoİ
 {

91 
	mmaxfd
;

92 
	m£tsize
;

93 
	mtimeEv’tNextId
;

94 
time_t
 
	mÏ¡Time
;

95 
«FeEv’t
 *
	mev’ts
;

96 
«FœedEv’t
 *
	mfœed
;

97 
«TimeEv’t
 *
	mtimeEv’tH—d
;

98 
	m¡İ
;

99 *
	m­id©a
;

100 
«BefÜeSË•Proc
 *
	mbefÜe¦“p
;

101 } 
	t«Ev’tLoİ
;

104 
«Ev’tLoİ
 *
«C»©eEv’tLoİ
(
£tsize
);

105 
«D–‘eEv’tLoİ
(
«Ev’tLoİ
 *
ev’tLoİ
);

106 
«Stİ
(
«Ev’tLoİ
 *
ev’tLoİ
);

107 
«C»©eFeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
,

108 
«FeProc
 *
´oc
, *
ş›ÁD©a
);

109 
«D–‘eFeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
);

110 
«G‘FeEv’ts
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
);

111 
«C»©eTimeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
mli£cÚds
,

112 
«TimeProc
 *
´oc
, *
ş›ÁD©a
,

113 
«Ev’tFš®iz”Proc
 *
fš®iz”Proc
);

114 
«D–‘eTimeEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
id
);

115 
«ProûssEv’ts
(
«Ev’tLoİ
 *
ev’tLoİ
, 
æags
);

116 
«Wa™
(
fd
, 
mask
, 
mli£cÚds
);

117 
«Maš
(
«Ev’tLoİ
 *
ev’tLoİ
);

118 *
«G‘ApiName
();

119 
«S‘BefÜeSË•Proc
(
«Ev’tLoİ
 *
ev’tLoİ
, 
«BefÜeSË•Proc
 *
befÜe¦“p
);

120 
«G‘S‘Size
(
«Ev’tLoİ
 *
ev’tLoİ
);

121 
«ResizeS‘Size
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
);

	@ae_epoll.c

32 
	~<sys/•Şl.h
>

34 
	s«ApiS‹
 {

35 
	m•fd
;

36 
•Şl_ev’t
 *
	mev’ts
;

37 } 
	t«ApiS‹
;

39 
	$«ApiC»©e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

40 
«ApiS‹
 *
¡©e
 = 
	`zm®loc
((aeApiState));

42 ià(!
¡©e
)  -1;

43 
¡©e
->
ev’ts
 = 
	`zm®loc
((
•Şl_ev’t
)*
ev’tLoİ
->
£tsize
);

44 ià(!
¡©e
->
ev’ts
) {

45 
	`zä“
(
¡©e
);

48 
¡©e
->
•fd
 = 
	`•Şl_ü—‹
(1024);

49 ià(
¡©e
->
•fd
 == -1) {

50 
	`zä“
(
¡©e
->
ev’ts
);

51 
	`zä“
(
¡©e
);

54 
ev’tLoİ
->
­id©a
 = 
¡©e
;

56 
	}
}

58 
	$«ApiResize
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
) {

59 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

61 
¡©e
->
ev’ts
 = 
	`z»®loc
(¡©e->ev’ts, (
•Şl_ev’t
)*
£tsize
);

63 
	}
}

65 
	$«ApiF»e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

66 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

68 
	`şo£
(
¡©e
->
•fd
);

69 
	`zä“
(
¡©e
->
ev’ts
);

70 
	`zä“
(
¡©e
);

71 
	}
}

73 
	$«ApiAddEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

74 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

75 
•Şl_ev’t
 
“
 = {0};

78 
İ
 = 
ev’tLoİ
->
ev’ts
[
fd
].
mask
 =ğ
AE_NONE
 ?

79 
EPOLL_CTL_ADD
 : 
EPOLL_CTL_MOD
;

81 
“
.
ev’ts
 = 0;

82 
mask
 |ğ
ev’tLoİ
->
ev’ts
[
fd
].mask;

83 ià(
mask
 & 
AE_READABLE
è
“
.
ev’ts
 |ğ
EPOLLIN
;

84 ià(
mask
 & 
AE_WRITABLE
è
“
.
ev’ts
 |ğ
EPOLLOUT
;

85 
“
.
d©a
.
fd
 = fd;

86 ià(
	`•Şl_ùl
(
¡©e
->
•fd
,
İ
,
fd
,&
“
) == -1)  -1;

88 
	}
}

90 
	$«ApiD–Ev’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
d–mask
) {

91 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

92 
•Şl_ev’t
 
“
 = {0};

93 
mask
 = 
ev’tLoİ
->
ev’ts
[
fd
].mask & (~
d–mask
);

95 
“
.
ev’ts
 = 0;

96 ià(
mask
 & 
AE_READABLE
è
“
.
ev’ts
 |ğ
EPOLLIN
;

97 ià(
mask
 & 
AE_WRITABLE
è
“
.
ev’ts
 |ğ
EPOLLOUT
;

98 
“
.
d©a
.
fd
 = fd;

99 ià(
mask
 !ğ
AE_NONE
) {

100 
	`•Şl_ùl
(
¡©e
->
•fd
,
EPOLL_CTL_MOD
,
fd
,&
“
);

104 
	`•Şl_ùl
(
¡©e
->
•fd
,
EPOLL_CTL_DEL
,
fd
,&
“
);

106 
	}
}

108 
	$«ApiPŞl
(
«Ev’tLoİ
 *
ev’tLoİ
, 
timev®
 *
tvp
) {

109 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

110 
»tv®
, 
numev’ts
 = 0;

112 
»tv®
 = 
	`•Şl_wa™
(
¡©e
->
•fd
,¡©e->
ev’ts
,
ev’tLoİ
->
£tsize
,

113 
tvp
 ? (tvp->
tv_£c
*1000 +vp->
tv_u£c
/1000) : -1);

114 ià(
»tv®
 > 0) {

115 
j
;

117 
numev’ts
 = 
»tv®
;

118 
j
 = 0; j < 
numev’ts
; j++) {

119 
mask
 = 0;

120 
•Şl_ev’t
 *
e
 = 
¡©e
->
ev’ts
+
j
;

122 ià(
e
->
ev’ts
 & 
EPOLLIN
è
mask
 |ğ
AE_READABLE
;

123 ià(
e
->
ev’ts
 & 
EPOLLOUT
è
mask
 |ğ
AE_WRITABLE
;

124 ià(
e
->
ev’ts
 & 
EPOLLERR
è
mask
 |ğ
AE_WRITABLE
;

125 ià(
e
->
ev’ts
 & 
EPOLLHUP
è
mask
 |ğ
AE_WRITABLE
;

126 
ev’tLoİ
->
fœed
[
j
].
fd
 = 
e
->
d©a
.fd;

127 
ev’tLoİ
->
fœed
[
j
].
mask
 = mask;

130  
numev’ts
;

131 
	}
}

133 *
	$«ApiName
() {

135 
	}
}

	@ae_evport.c

31 
	~<as£¹.h
>

32 
	~<”ºo.h
>

33 
	~<pÜt.h
>

34 
	~<pŞl.h
>

36 
	~<sys/ty³s.h
>

37 
	~<sys/time.h
>

39 
	~<¡dio.h
>

41 
	gevpÜt_debug
 = 0;

66 
	#MAX_EVENT_BATCHSZ
 512

	)

68 
	s«ApiS‹
 {

69 
	mpÜtfd
;

70 
	mÅ’dšg
;

71 
	m³ndšg_fds
[
MAX_EVENT_BATCHSZ
];

72 
	m³ndšg_masks
[
MAX_EVENT_BATCHSZ
];

73 } 
	t«ApiS‹
;

75 
	$«ApiC»©e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

76 
i
;

77 
«ApiS‹
 *
¡©e
 = 
	`zm®loc
((aeApiState));

78 ià(!
¡©e
)  -1;

80 
¡©e
->
pÜtfd
 = 
	`pÜt_ü—‹
();

81 ià(
¡©e
->
pÜtfd
 == -1) {

82 
	`zä“
(
¡©e
);

86 
¡©e
->
Å’dšg
 = 0;

88 
i
 = 0; i < 
MAX_EVENT_BATCHSZ
; i++) {

89 
¡©e
->
³ndšg_fds
[
i
] = -1;

90 
¡©e
->
³ndšg_masks
[
i
] = 
AE_NONE
;

93 
ev’tLoİ
->
­id©a
 = 
¡©e
;

95 
	}
}

97 
	$«ApiResize
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
) {

100 
	}
}

102 
	$«ApiF»e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

103 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

105 
	`şo£
(
¡©e
->
pÜtfd
);

106 
	`zä“
(
¡©e
);

107 
	}
}

109 
	$«ApiLookupP’dšg
(
«ApiS‹
 *
¡©e
, 
fd
) {

110 
i
;

112 
i
 = 0; i < 
¡©e
->
Å’dšg
; i++) {

113 ià(
¡©e
->
³ndšg_fds
[
i
] =ğ
fd
)

114  (
i
);

118 
	}
}

123 
	$«ApiAssocŸ‹
(cÚ¡ *
wh”e
, 
pÜtfd
, 
fd
, 
mask
) {

124 
ev’ts
 = 0;

125 
rv
, 
”r
;

127 ià(
mask
 & 
AE_READABLE
)

128 
ev’ts
 |ğ
POLLIN
;

129 ià(
mask
 & 
AE_WRITABLE
)

130 
ev’ts
 |ğ
POLLOUT
;

132 ià(
evpÜt_debug
)

133 
	`årštf
(
¡d”r
, "%s:…Üt_assocŸ‹(%d, 0x%xèğ", 
wh”e
, 
fd
, 
ev’ts
);

135 
rv
 = 
	`pÜt_assocŸ‹
(
pÜtfd
, 
PORT_SOURCE_FD
, 
fd
, 
ev’ts
,

136 (*)(
ušŒ_t
)
mask
);

137 
”r
 = 
”ºo
;

139 ià(
evpÜt_debug
)

140 
	`årštf
(
¡d”r
, "%d (%s)\n", 
rv
,„v =ğ0 ? "nØ”rÜ" : 
	`¡»¼Ü
(
”r
));

142 ià(
rv
 == -1) {

143 
	`årštf
(
¡d”r
, "%s:…Üt_assocŸ‹: %s\n", 
wh”e
, 
	`¡»¼Ü
(
”r
));

145 ià(
”r
 =ğ
EAGAIN
)

146 
	`årštf
(
¡d”r
, "aeApiAssociate:ƒvent…ort†imitƒxceeded.");

149  
rv
;

150 
	}
}

152 
	$«ApiAddEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

153 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

154 
fuÎmask
, 
pfd
;

156 ià(
evpÜt_debug
)

157 
	`årštf
(
¡d”r
, "«ApiAddEv’t: fd %d mask 0x%x\n", 
fd
, 
mask
);

164 
fuÎmask
 = 
mask
 | 
ev’tLoİ
->
ev’ts
[
fd
].mask;

165 
pfd
 = 
	`«ApiLookupP’dšg
(
¡©e
, 
fd
);

167 ià(
pfd
 != -1) {

174 ià(
evpÜt_debug
)

175 
	`årštf
(
¡d”r
, "«ApiAddEv’t:‡ddšgØ³ndšg fd %d\n", 
fd
);

176 
¡©e
->
³ndšg_masks
[
pfd
] |ğ
fuÎmask
;

180  (
	`«ApiAssocŸ‹
("«ApiAddEv’t", 
¡©e
->
pÜtfd
, 
fd
, 
fuÎmask
));

181 
	}
}

183 
	$«ApiD–Ev’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

184 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

185 
fuÎmask
, 
pfd
;

187 ià(
evpÜt_debug
)

188 
	`årštf
(
¡d”r
, "d– fd %d mask 0x%x\n", 
fd
, 
mask
);

190 
pfd
 = 
	`«ApiLookupP’dšg
(
¡©e
, 
fd
);

192 ià(
pfd
 != -1) {

193 ià(
evpÜt_debug
)

194 
	`årštf
(
¡d”r
, "d–‘šgƒv’ˆäom…’dšg fd %d\n", 
fd
);

201 
¡©e
->
³ndšg_masks
[
pfd
] &ğ~
mask
;

203 ià(
¡©e
->
³ndšg_masks
[
pfd
] =ğ
AE_NONE
)

204 
¡©e
->
³ndšg_fds
[
pfd
] = -1;

217 
fuÎmask
 = 
ev’tLoİ
->
ev’ts
[
fd
].
mask
;

218 ià(
fuÎmask
 =ğ
AE_NONE
) {

223 ià(
evpÜt_debug
)

224 
	`årštf
(
¡d”r
, "«ApiD–Ev’t:…Üt_dissocŸ‹(%d)\n", 
fd
);

226 ià(
	`pÜt_dissocŸ‹
(
¡©e
->
pÜtfd
, 
PORT_SOURCE_FD
, 
fd
) != 0) {

227 
	`³¼Ü
("aeApiDelEvent:…ort_dissociate");

228 
	`abÜt
();

230 } ià(
	`«ApiAssocŸ‹
("«ApiD–Ev’t", 
¡©e
->
pÜtfd
, 
fd
,

231 
fuÎmask
) != 0) {

239 
	`abÜt
();

241 
	}
}

243 
	$«ApiPŞl
(
«Ev’tLoİ
 *
ev’tLoİ
, 
timev®
 *
tvp
) {

244 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

245 
time¥ec
 
timeout
, *
t¥
;

246 
mask
, 
i
;

247 
ušt_t
 
Ãv’ts
;

248 
pÜt_ev’t_t
 
ev’t
[
MAX_EVENT_BATCHSZ
];

255 
i
 = 0; i < 
¡©e
->
Å’dšg
; i++) {

256 ià(
¡©e
->
³ndšg_fds
[
i
] == -1)

260 ià(
	`«ApiAssocŸ‹
("«ApiPŞl", 
¡©e
->
pÜtfd
,

261 
¡©e
->
³ndšg_fds
[
i
], s‹->
³ndšg_masks
[i]) != 0) {

263 
	`abÜt
();

266 
¡©e
->
³ndšg_masks
[
i
] = 
AE_NONE
;

267 
¡©e
->
³ndšg_fds
[
i
] = -1;

270 
¡©e
->
Å’dšg
 = 0;

272 ià(
tvp
 !ğ
NULL
) {

273 
timeout
.
tv_£c
 = 
tvp
->tv_sec;

274 
timeout
.
tv_n£c
 = 
tvp
->
tv_u£c
 * 1000;

275 
t¥
 = &
timeout
;

277 
t¥
 = 
NULL
;

284 
Ãv’ts
 = 1;

285 ià(
	`pÜt_g‘n
(
¡©e
->
pÜtfd
, 
ev’t
, 
MAX_EVENT_BATCHSZ
, &
Ãv’ts
,

286 
t¥
è=ğ-1 && (
”ºo
 !ğ
ETIME
 || 
Ãv’ts
 == 0)) {

287 ià(
”ºo
 =ğ
ETIME
 ||ƒ¼nØ=ğ
EINTR
)

291 
	`³¼Ü
("aeApiPoll:…ort_get");

292 
	`abÜt
();

295 
¡©e
->
Å’dšg
 = 
Ãv’ts
;

297 
i
 = 0; i < 
Ãv’ts
; i++) {

298 
mask
 = 0;

299 ià(
ev’t
[
i
].
pÜ‹v_ev’ts
 & 
POLLIN
)

300 
mask
 |ğ
AE_READABLE
;

301 ià(
ev’t
[
i
].
pÜ‹v_ev’ts
 & 
POLLOUT
)

302 
mask
 |ğ
AE_WRITABLE
;

304 
ev’tLoİ
->
fœed
[
i
].
fd
 = 
ev’t
[i].
pÜ‹v_objeù
;

305 
ev’tLoİ
->
fœed
[
i
].
mask
 = mask;

307 ià(
evpÜt_debug
)

308 
	`årštf
(
¡d”r
, "aeApiPoll: fd %d mask 0x%x\n",

309 ()
ev’t
[
i
].
pÜ‹v_objeù
, 
mask
);

311 
¡©e
->
³ndšg_fds
[
i
] = 
ev’t
[i].
pÜ‹v_objeù
;

312 
¡©e
->
³ndšg_masks
[
i
] = (
ušŒ_t
)
ev’t
[i].
pÜ‹v_u£r
;

315  
Ãv’ts
;

316 
	}
}

318 *
	$«ApiName
() {

320 
	}
}

	@ae_kqueue.c

32 
	~<sys/ty³s.h
>

33 
	~<sys/ev’t.h
>

34 
	~<sys/time.h
>

36 
	s«ApiS‹
 {

37 
	mkqfd
;

38 
kev’t
 *
	mev’ts
;

39 } 
	t«ApiS‹
;

41 
	$«ApiC»©e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

42 
«ApiS‹
 *
¡©e
 = 
	`zm®loc
((aeApiState));

44 ià(!
¡©e
)  -1;

45 
¡©e
->
ev’ts
 = 
	`zm®loc
((
kev’t
)*
ev’tLoİ
->
£tsize
);

46 ià(!
¡©e
->
ev’ts
) {

47 
	`zä“
(
¡©e
);

50 
¡©e
->
kqfd
 = 
	`kqueue
();

51 ià(
¡©e
->
kqfd
 == -1) {

52 
	`zä“
(
¡©e
->
ev’ts
);

53 
	`zä“
(
¡©e
);

56 
ev’tLoİ
->
­id©a
 = 
¡©e
;

58 
	}
}

60 
	$«ApiResize
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
) {

61 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

63 
¡©e
->
ev’ts
 = 
	`z»®loc
(¡©e->ev’ts, (
kev’t
)*
£tsize
);

65 
	}
}

67 
	$«ApiF»e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

68 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

70 
	`şo£
(
¡©e
->
kqfd
);

71 
	`zä“
(
¡©e
->
ev’ts
);

72 
	`zä“
(
¡©e
);

73 
	}
}

75 
	$«ApiAddEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

76 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

77 
kev’t
 
ke
;

79 ià(
mask
 & 
AE_READABLE
) {

80 
	`EV_SET
(&
ke
, 
fd
, 
EVFILT_READ
, 
EV_ADD
, 0, 0, 
NULL
);

81 ià(
	`kev’t
(
¡©e
->
kqfd
, &
ke
, 1, 
NULL
, 0, NULL) == -1)  -1;

83 ià(
mask
 & 
AE_WRITABLE
) {

84 
	`EV_SET
(&
ke
, 
fd
, 
EVFILT_WRITE
, 
EV_ADD
, 0, 0, 
NULL
);

85 ià(
	`kev’t
(
¡©e
->
kqfd
, &
ke
, 1, 
NULL
, 0, NULL) == -1)  -1;

88 
	}
}

90 
	$«ApiD–Ev’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

91 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

92 
kev’t
 
ke
;

94 ià(
mask
 & 
AE_READABLE
) {

95 
	`EV_SET
(&
ke
, 
fd
, 
EVFILT_READ
, 
EV_DELETE
, 0, 0, 
NULL
);

96 
	`kev’t
(
¡©e
->
kqfd
, &
ke
, 1, 
NULL
, 0, NULL);

98 ià(
mask
 & 
AE_WRITABLE
) {

99 
	`EV_SET
(&
ke
, 
fd
, 
EVFILT_WRITE
, 
EV_DELETE
, 0, 0, 
NULL
);

100 
	`kev’t
(
¡©e
->
kqfd
, &
ke
, 1, 
NULL
, 0, NULL);

102 
	}
}

104 
	$«ApiPŞl
(
«Ev’tLoİ
 *
ev’tLoİ
, 
timev®
 *
tvp
) {

105 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

106 
»tv®
, 
numev’ts
 = 0;

108 ià(
tvp
 !ğ
NULL
) {

109 
time¥ec
 
timeout
;

110 
timeout
.
tv_£c
 = 
tvp
->tv_sec;

111 
timeout
.
tv_n£c
 = 
tvp
->
tv_u£c
 * 1000;

112 
»tv®
 = 
	`kev’t
(
¡©e
->
kqfd
, 
NULL
, 0, s‹->
ev’ts
, 
ev’tLoİ
->
£tsize
,

113 &
timeout
);

115 
»tv®
 = 
	`kev’t
(
¡©e
->
kqfd
, 
NULL
, 0, s‹->
ev’ts
, 
ev’tLoİ
->
£tsize
,

116 
NULL
);

119 ià(
»tv®
 > 0) {

120 
j
;

122 
numev’ts
 = 
»tv®
;

123 
j
 = 0; j < 
numev’ts
; j++) {

124 
mask
 = 0;

125 
kev’t
 *
e
 = 
¡©e
->
ev’ts
+
j
;

127 ià(
e
->
f‹r
 =ğ
EVFILT_READ
è
mask
 |ğ
AE_READABLE
;

128 ià(
e
->
f‹r
 =ğ
EVFILT_WRITE
è
mask
 |ğ
AE_WRITABLE
;

129 
ev’tLoİ
->
fœed
[
j
].
fd
 = 
e
->
id’t
;

130 
ev’tLoİ
->
fœed
[
j
].
mask
 = mask;

133  
numev’ts
;

134 
	}
}

136 *
	$«ApiName
() {

138 
	}
}

	@ae_select.c

32 
	~<sys/£Ëù.h
>

33 
	~<¡ršg.h
>

35 
	s«ApiS‹
 {

36 
fd_£t
 
	mrfds
, 
	mwfds
;

39 
fd_£t
 
	m_rfds
, 
	m_wfds
;

40 } 
	t«ApiS‹
;

42 
	$«ApiC»©e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

43 
«ApiS‹
 *
¡©e
 = 
	`zm®loc
((aeApiState));

45 ià(!
¡©e
)  -1;

46 
	`FD_ZERO
(&
¡©e
->
rfds
);

47 
	`FD_ZERO
(&
¡©e
->
wfds
);

48 
ev’tLoİ
->
­id©a
 = 
¡©e
;

50 
	}
}

52 
	$«ApiResize
(
«Ev’tLoİ
 *
ev’tLoİ
, 
£tsize
) {

54 ià(
£tsize
 >ğ
FD_SETSIZE
)  -1;

56 
	}
}

58 
	$«ApiF»e
(
«Ev’tLoİ
 *
ev’tLoİ
) {

59 
	`zä“
(
ev’tLoİ
->
­id©a
);

60 
	}
}

62 
	$«ApiAddEv’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

63 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

65 ià(
mask
 & 
AE_READABLE
è
	`FD_SET
(
fd
,&
¡©e
->
rfds
);

66 ià(
mask
 & 
AE_WRITABLE
è
	`FD_SET
(
fd
,&
¡©e
->
wfds
);

68 
	}
}

70 
	$«ApiD–Ev’t
(
«Ev’tLoİ
 *
ev’tLoİ
, 
fd
, 
mask
) {

71 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

73 ià(
mask
 & 
AE_READABLE
è
	`FD_CLR
(
fd
,&
¡©e
->
rfds
);

74 ià(
mask
 & 
AE_WRITABLE
è
	`FD_CLR
(
fd
,&
¡©e
->
wfds
);

75 
	}
}

77 
	$«ApiPŞl
(
«Ev’tLoİ
 *
ev’tLoİ
, 
timev®
 *
tvp
) {

78 
«ApiS‹
 *
¡©e
 = 
ev’tLoİ
->
­id©a
;

79 
»tv®
, 
j
, 
numev’ts
 = 0;

81 
	`memıy
(&
¡©e
->
_rfds
,&¡©e->
rfds
,(
fd_£t
));

82 
	`memıy
(&
¡©e
->
_wfds
,&¡©e->
wfds
,(
fd_£t
));

84 
»tv®
 = 
	`£Ëù
(
ev’tLoİ
->
maxfd
+1,

85 &
¡©e
->
_rfds
,&¡©e->
_wfds
,
NULL
,
tvp
);

86 ià(
»tv®
 > 0) {

87 
j
 = 0; j <ğ
ev’tLoİ
->
maxfd
; j++) {

88 
mask
 = 0;

89 
«FeEv’t
 *
ã
 = &
ev’tLoİ
->
ev’ts
[
j
];

91 ià(
ã
->
mask
 =ğ
AE_NONE
) ;

92 ià(
ã
->
mask
 & 
AE_READABLE
 && 
	`FD_ISSET
(
j
,&
¡©e
->
_rfds
))

93 
mask
 |ğ
AE_READABLE
;

94 ià(
ã
->
mask
 & 
AE_WRITABLE
 && 
	`FD_ISSET
(
j
,&
¡©e
->
_wfds
))

95 
mask
 |ğ
AE_WRITABLE
;

96 
ev’tLoİ
->
fœed
[
numev’ts
].
fd
 = 
j
;

97 
ev’tLoİ
->
fœed
[
numev’ts
].
mask
 = mask;

98 
numev’ts
++;

101  
numev’ts
;

102 
	}
}

104 *
	$«ApiName
() {

106 
	}
}

	@anet.c

31 
	~"fmaüos.h
"

33 
	~<sys/ty³s.h
>

34 
	~<sys/sock‘.h
>

35 
	~<sys/¡©.h
>

36 
	~<sys/un.h
>

37 
	~<sys/time.h
>

38 
	~<Ãtš‘/š.h
>

39 
	~<Ãtš‘/tı.h
>

40 
	~<¬·/š‘.h
>

41 
	~<uni¡d.h
>

42 
	~<fú.h
>

43 
	~<¡ršg.h
>

44 
	~<Ãtdb.h
>

45 
	~<”ºo.h
>

46 
	~<¡d¬g.h
>

47 
	~<¡dio.h
>

49 
	~"ª‘.h
"

51 
	$ª‘S‘E¼Ü
(*
”r
, cÚ¡ *
fmt
, ...)

53 
va_li¡
 
­
;

55 ià(!
”r
) ;

56 
	`va_¡¬t
(
­
, 
fmt
);

57 
	`v¢´štf
(
”r
, 
ANET_ERR_LEN
, 
fmt
, 
­
);

58 
	`va_’d
(
­
);

59 
	}
}

61 
	$ª‘S‘Block
(*
”r
, 
fd
, 
nÚ_block
) {

62 
æags
;

67 ià((
æags
 = 
	`fú
(
fd
, 
F_GETFL
)) == -1) {

68 
	`ª‘S‘E¼Ü
(
”r
, "fú(F_GETFL): %s", 
	`¡»¼Ü
(
”ºo
));

69  
ANET_ERR
;

72 ià(
nÚ_block
)

73 
æags
 |ğ
O_NONBLOCK
;

75 
æags
 &ğ~
O_NONBLOCK
;

77 ià(
	`fú
(
fd
, 
F_SETFL
, 
æags
) == -1) {

78 
	`ª‘S‘E¼Ü
(
”r
, "fú(F_SETFL,O_NONBLOCK): %s", 
	`¡»¼Ü
(
”ºo
));

79  
ANET_ERR
;

81  
ANET_OK
;

82 
	}
}

84 
	$ª‘NÚBlock
(*
”r
, 
fd
) {

85  
	`ª‘S‘Block
(
”r
,
fd
,1);

86 
	}
}

88 
	$ª‘Block
(*
”r
, 
fd
) {

89  
	`ª‘S‘Block
(
”r
,
fd
,0);

90 
	}
}

95 
	$ª‘K“pAlive
(*
”r
, 
fd
, 
š‹rv®
)

97 
v®
 = 1;

99 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, &
v®
, (val)) == -1)

101 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆSO_KEEPALIVE: %s", 
	`¡»¼Ü
(
”ºo
));

102  
ANET_ERR
;

105 #ifdeà
__lšux__


111 
v®
 = 
š‹rv®
;

112 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPIDLE
, &
v®
, (val)) < 0) {

113 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆTCP_KEEPIDLE: %s\n", 
	`¡»¼Ü
(
”ºo
));

114  
ANET_ERR
;

120 
v®
 = 
š‹rv®
/3;

121 ià(
v®
 == 0) val = 1;

122 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPINTVL
, &
v®
, (val)) < 0) {

123 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆTCP_KEEPINTVL: %s\n", 
	`¡»¼Ü
(
”ºo
));

124  
ANET_ERR
;

129 
v®
 = 3;

130 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPCNT
, &
v®
, (val)) < 0) {

131 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆTCP_KEEPCNT: %s\n", 
	`¡»¼Ü
(
”ºo
));

132  
ANET_ERR
;

135 ((è
š‹rv®
);

138  
ANET_OK
;

139 
	}
}

141 
	$ª‘S‘TıNoD–ay
(*
”r
, 
fd
, 
v®
)

143 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_NODELAY
, &
v®
, (val)) == -1)

145 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆTCP_NODELAY: %s", 
	`¡»¼Ü
(
”ºo
));

146  
ANET_ERR
;

148  
ANET_OK
;

149 
	}
}

151 
	$ª‘EÇbËTıNoD–ay
(*
”r
, 
fd
)

153  
	`ª‘S‘TıNoD–ay
(
”r
, 
fd
, 1);

154 
	}
}

156 
	$ª‘Di§bËTıNoD–ay
(*
”r
, 
fd
)

158  
	`ª‘S‘TıNoD–ay
(
”r
, 
fd
, 0);

159 
	}
}

162 
	$ª‘S‘S’dBufãr
(*
”r
, 
fd
, 
buffsize
)

164 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
buffsize
, (buffsize)) == -1)

166 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆSO_SNDBUF: %s", 
	`¡»¼Ü
(
”ºo
));

167  
ANET_ERR
;

169  
ANET_OK
;

170 
	}
}

172 
	$ª‘TıK“pAlive
(*
”r
, 
fd
)

174 
yes
 = 1;

175 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, &
yes
, (yes)) == -1) {

176 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆSO_KEEPALIVE: %s", 
	`¡»¼Ü
(
”ºo
));

177  
ANET_ERR
;

179  
ANET_OK
;

180 
	}
}

184 
	$ª‘S’dTimeout
(*
”r
, 
fd
, 
ms
) {

185 
timev®
 
tv
;

187 
tv
.
tv_£c
 = 
ms
/1000;

188 
tv
.
tv_u£c
 = (
ms
%1000)*1000;

189 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, &
tv
, (tv)) == -1) {

190 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆSO_SNDTIMEO: %s", 
	`¡»¼Ü
(
”ºo
));

191  
ANET_ERR
;

193  
ANET_OK
;

194 
	}
}

203 
	$ª‘G’”icResŞve
(*
”r
, *
ho¡
, *
buf
, 
size_t
 
buf_Ën
,

204 
æags
)

206 
addršfo
 
hšts
, *
šfo
;

207 
rv
;

209 
	`mem£t
(&
hšts
,0,(hints));

210 ià(
æags
 & 
ANET_IP_ONLY
è
hšts
.
ai_æags
 = 
AI_NUMERICHOST
;

211 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

212 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

214 ià((
rv
 = 
	`g‘addršfo
(
ho¡
, 
NULL
, &
hšts
, &
šfo
)) != 0) {

215 
	`ª‘S‘E¼Ü
(
”r
, "%s", 
	`gai_¡»¼Ü
(
rv
));

216  
ANET_ERR
;

218 ià(
šfo
->
ai_çmy
 =ğ
AF_INET
) {

219 
sockaddr_š
 *
§
 = (sockaddr_š *)
šfo
->
ai_addr
;

220 
	`š‘_Áİ
(
AF_INET
, &(
§
->
sš_addr
), 
buf
, 
buf_Ën
);

222 
sockaddr_š6
 *
§
 = (sockaddr_š6 *)
šfo
->
ai_addr
;

223 
	`š‘_Áİ
(
AF_INET6
, &(
§
->
sš6_addr
), 
buf
, 
buf_Ën
);

226 
	`ä“addršfo
(
šfo
);

227  
ANET_OK
;

228 
	}
}

230 
	$ª‘ResŞve
(*
”r
, *
ho¡
, *
buf
, 
size_t
 
buf_Ën
) {

231  
	`ª‘G’”icResŞve
(
”r
,
ho¡
,
buf
,
buf_Ën
,
ANET_NONE
);

232 
	}
}

234 
	$ª‘ResŞveIP
(*
”r
, *
ho¡
, *
buf
, 
size_t
 
buf_Ën
) {

235  
	`ª‘G’”icResŞve
(
”r
,
ho¡
,
buf
,
buf_Ën
,
ANET_IP_ONLY
);

236 
	}
}

238 
	$ª‘S‘Reu£Addr
(*
”r
, 
fd
) {

239 
yes
 = 1;

242 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
yes
, (yes)) == -1) {

243 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİˆSO_REUSEADDR: %s", 
	`¡»¼Ü
(
”ºo
));

244  
ANET_ERR
;

246  
ANET_OK
;

247 
	}
}

249 
	$ª‘C»©eSock‘
(*
”r
, 
domaš
) {

250 
s
;

251 ià((
s
 = 
	`sock‘
(
domaš
, 
SOCK_STREAM
, 0)) == -1) {

252 
	`ª‘S‘E¼Ü
(
”r
, "ü—tšg sock‘: %s", 
	`¡»¼Ü
(
”ºo
));

253  
ANET_ERR
;

258 ià(
	`ª‘S‘Reu£Addr
(
”r
,
s
è=ğ
ANET_ERR
) {

259 
	`şo£
(
s
);

260  
ANET_ERR
;

262  
s
;

263 
	}
}

265 
	#ANET_CONNECT_NONE
 0

	)

266 
	#ANET_CONNECT_NONBLOCK
 1

	)

267 
	#ANET_CONNECT_BE_BINDING
 2

	)

268 
	$ª‘TıG’”icCÚÃù
(*
”r
, *
addr
, 
pÜt
,

269 *
sourû_addr
, 
æags
)

271 
s
 = 
ANET_ERR
, 
rv
;

272 
pÜt¡r
[6];

273 
addršfo
 
hšts
, *
£rvšfo
, *
b£rvšfo
, *
p
, *
b
;

275 
	`¢´štf
(
pÜt¡r
,ÕÜt¡r),"%d",
pÜt
);

276 
	`mem£t
(&
hšts
,0,(hints));

277 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

278 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

280 ià((
rv
 = 
	`g‘addršfo
(
addr
,
pÜt¡r
,&
hšts
,&
£rvšfo
)) != 0) {

281 
	`ª‘S‘E¼Ü
(
”r
, "%s", 
	`gai_¡»¼Ü
(
rv
));

282  
ANET_ERR
;

284 
p
 = 
£rvšfo
;… !ğ
NULL
;… =…->
ai_Ãxt
) {

288 ià((
s
 = 
	`sock‘
(
p
->
ai_çmy
,p->
ai_sockty³
,p->
ai_´ÙocŞ
)) == -1)

290 ià(
	`ª‘S‘Reu£Addr
(
”r
,
s
è=ğ
ANET_ERR
è
”rÜ
;

291 ià(
æags
 & 
ANET_CONNECT_NONBLOCK
 && 
	`ª‘NÚBlock
(
”r
,
s
è!ğ
ANET_OK
)

292 
”rÜ
;

293 ià(
sourû_addr
) {

294 
bound
 = 0;

296 ià((
rv
 = 
	`g‘addršfo
(
sourû_addr
, 
NULL
, &
hšts
, &
b£rvšfo
)) != 0)

298 
	`ª‘S‘E¼Ü
(
”r
, "%s", 
	`gai_¡»¼Ü
(
rv
));

299 
”rÜ
;

301 
b
 = 
b£rvšfo
; b !ğ
NULL
; b = b->
ai_Ãxt
) {

302 ià(
	`bšd
(
s
,
b
->
ai_addr
,b->
ai_add¾’
) != -1) {

303 
bound
 = 1;

307 
	`ä“addršfo
(
b£rvšfo
);

308 ià(!
bound
) {

309 
	`ª‘S‘E¼Ü
(
”r
, "bšd: %s", 
	`¡»¼Ü
(
”ºo
));

310 
”rÜ
;

313 ià(
	`cÚÃù
(
s
,
p
->
ai_addr
,p->
ai_add¾’
) == -1) {

316 ià(
”ºo
 =ğ
EINPROGRESS
 && 
æags
 & 
ANET_CONNECT_NONBLOCK
)

317 
’d
;

318 
	`şo£
(
s
);

319 
s
 = 
ANET_ERR
;

325 
’d
;

327 ià(
p
 =ğ
NULL
)

328 
	`ª‘S‘E¼Ü
(
”r
, "ü—tšg sock‘: %s", 
	`¡»¼Ü
(
”ºo
));

330 
”rÜ
:

331 ià(
s
 !ğ
ANET_ERR
) {

332 
	`şo£
(
s
);

333 
s
 = 
ANET_ERR
;

336 
’d
:

337 
	`ä“addršfo
(
£rvšfo
);

341 ià(
s
 =ğ
ANET_ERR
 && 
sourû_addr
 && (
æags
 & 
ANET_CONNECT_BE_BINDING
)) {

342  
	`ª‘TıG’”icCÚÃù
(
”r
,
addr
,
pÜt
,
NULL
,
æags
);

344  
s
;

346 
	}
}

348 
	$ª‘TıCÚÃù
(*
”r
, *
addr
, 
pÜt
)

350  
	`ª‘TıG’”icCÚÃù
(
”r
,
addr
,
pÜt
,
NULL
,
ANET_CONNECT_NONE
);

351 
	}
}

353 
	$ª‘TıNÚBlockCÚÃù
(*
”r
, *
addr
, 
pÜt
)

355  
	`ª‘TıG’”icCÚÃù
(
”r
,
addr
,
pÜt
,
NULL
,
ANET_CONNECT_NONBLOCK
);

356 
	}
}

358 
	$ª‘TıNÚBlockBšdCÚÃù
(*
”r
, *
addr
, 
pÜt
,

359 *
sourû_addr
)

361  
	`ª‘TıG’”icCÚÃù
(
”r
,
addr
,
pÜt
,
sourû_addr
,

362 
ANET_CONNECT_NONBLOCK
);

363 
	}
}

365 
	$ª‘TıNÚBlockBe¡EffÜtBšdCÚÃù
(*
”r
, *
addr
, 
pÜt
,

366 *
sourû_addr
)

368  
	`ª‘TıG’”icCÚÃù
(
”r
,
addr
,
pÜt
,
sourû_addr
,

369 
ANET_CONNECT_NONBLOCK
|
ANET_CONNECT_BE_BINDING
);

370 
	}
}

372 
	$ª‘UnixG’”icCÚÃù
(*
”r
, *
·th
, 
æags
)

374 
s
;

375 
sockaddr_un
 
§
;

377 ià((
s
 = 
	`ª‘C»©eSock‘
(
”r
,
AF_LOCAL
)è=ğ
ANET_ERR
)

378  
ANET_ERR
;

380 
§
.
sun_çmy
 = 
AF_LOCAL
;

381 
	`¡ºıy
(
§
.
sun_·th
,
·th
,(sa.sun_path)-1);

382 ià(
æags
 & 
ANET_CONNECT_NONBLOCK
) {

383 ià(
	`ª‘NÚBlock
(
”r
,
s
è!ğ
ANET_OK
)

384  
ANET_ERR
;

386 ià(
	`cÚÃù
(
s
,(
sockaddr
*)&
§
,(sa)) == -1) {

387 ià(
”ºo
 =ğ
EINPROGRESS
 &&

388 
æags
 & 
ANET_CONNECT_NONBLOCK
)

389  
s
;

391 
	`ª‘S‘E¼Ü
(
”r
, "cÚÃù: %s", 
	`¡»¼Ü
(
”ºo
));

392 
	`şo£
(
s
);

393  
ANET_ERR
;

395  
s
;

396 
	}
}

398 
	$ª‘UnixCÚÃù
(*
”r
, *
·th
)

400  
	`ª‘UnixG’”icCÚÃù
(
”r
,
·th
,
ANET_CONNECT_NONE
);

401 
	}
}

403 
	$ª‘UnixNÚBlockCÚÃù
(*
”r
, *
·th
)

405  
	`ª‘UnixG’”icCÚÃù
(
”r
,
·th
,
ANET_CONNECT_NONBLOCK
);

406 
	}
}

410 
	$ª‘R—d
(
fd
, *
buf
, 
couÁ
)

412 
ssize_t
 
Ä—d
, 
tÙËn
 = 0;

413 
tÙËn
 !ğ
couÁ
) {

414 
Ä—d
 = 
	`»ad
(
fd
,
buf
,
couÁ
-
tÙËn
);

415 ià(
Ä—d
 =ğ0è 
tÙËn
;

416 ià(
Ä—d
 == -1)  -1;

417 
tÙËn
 +ğ
Ä—d
;

418 
buf
 +ğ
Ä—d
;

420  
tÙËn
;

421 
	}
}

425 
	$ª‘Wr™e
(
fd
, *
buf
, 
couÁ
)

427 
ssize_t
 
nwr™‹n
, 
tÙËn
 = 0;

428 
tÙËn
 !ğ
couÁ
) {

429 
nwr™‹n
 = 
	`wr™e
(
fd
,
buf
,
couÁ
-
tÙËn
);

430 ià(
nwr™‹n
 =ğ0è 
tÙËn
;

431 ià(
nwr™‹n
 == -1)  -1;

432 
tÙËn
 +ğ
nwr™‹n
;

433 
buf
 +ğ
nwr™‹n
;

435  
tÙËn
;

436 
	}
}

438 
	$ª‘Li¡’
(*
”r
, 
s
, 
sockaddr
 *
§
, 
sockËn_t
 
Ën
, 
backlog
) {

439 ià(
	`bšd
(
s
,
§
,
Ën
) == -1) {

440 
	`ª‘S‘E¼Ü
(
”r
, "bšd: %s", 
	`¡»¼Ü
(
”ºo
));

441 
	`şo£
(
s
);

442  
ANET_ERR
;

445 ià(
	`li¡’
(
s
, 
backlog
) == -1) {

446 
	`ª‘S‘E¼Ü
(
”r
, "li¡’: %s", 
	`¡»¼Ü
(
”ºo
));

447 
	`şo£
(
s
);

448  
ANET_ERR
;

450  
ANET_OK
;

451 
	}
}

453 
	$ª‘V6OÆy
(*
”r
, 
s
) {

454 
yes
 = 1;

455 ià(
	`£tsockİt
(
s
,
IPPROTO_IPV6
,
IPV6_V6ONLY
,&
yes
,(yes)) == -1) {

456 
	`ª‘S‘E¼Ü
(
”r
, "£tsockİt: %s", 
	`¡»¼Ü
(
”ºo
));

457 
	`şo£
(
s
);

458  
ANET_ERR
;

460  
ANET_OK
;

461 
	}
}

463 
	$_ª‘TıS”v”
(*
”r
, 
pÜt
, *
bšdaddr
, 
af
, 
backlog
)

465 
s
, 
rv
;

466 
_pÜt
[6];

467 
addršfo
 
hšts
, *
£rvšfo
, *
p
;

469 
	`¢´štf
(
_pÜt
,6,"%d",
pÜt
);

470 
	`mem£t
(&
hšts
,0,(hints));

471 
hšts
.
ai_çmy
 = 
af
;

472 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

473 
hšts
.
ai_æags
 = 
AI_PASSIVE
;

475 ià((
rv
 = 
	`g‘addršfo
(
bšdaddr
,
_pÜt
,&
hšts
,&
£rvšfo
)) != 0) {

476 
	`ª‘S‘E¼Ü
(
”r
, "%s", 
	`gai_¡»¼Ü
(
rv
));

477  
ANET_ERR
;

479 
p
 = 
£rvšfo
;… !ğ
NULL
;… =…->
ai_Ãxt
) {

480 ià((
s
 = 
	`sock‘
(
p
->
ai_çmy
,p->
ai_sockty³
,p->
ai_´ÙocŞ
)) == -1)

483 ià(
af
 =ğ
AF_INET6
 && 
	`ª‘V6OÆy
(
”r
,
s
è=ğ
ANET_ERR
è
”rÜ
;

484 ià(
	`ª‘S‘Reu£Addr
(
”r
,
s
è=ğ
ANET_ERR
è
”rÜ
;

485 ià(
	`ª‘Li¡’
(
”r
,
s
,
p
->
ai_addr
,p->
ai_add¾’
,
backlog
è=ğ
ANET_ERR
è
”rÜ
;

486 
’d
;

488 ià(
p
 =ğ
NULL
) {

489 
	`ª‘S‘E¼Ü
(
”r
, "uÇbËØbšd sock‘,ƒ¼no: %d", 
”ºo
);

490 
”rÜ
;

493 
”rÜ
:

494 
s
 = 
ANET_ERR
;

495 
’d
:

496 
	`ä“addršfo
(
£rvšfo
);

497  
s
;

498 
	}
}

500 
	$ª‘TıS”v”
(*
”r
, 
pÜt
, *
bšdaddr
, 
backlog
)

502  
	`_ª‘TıS”v”
(
”r
, 
pÜt
, 
bšdaddr
, 
AF_INET
, 
backlog
);

503 
	}
}

505 
	$ª‘Tı6S”v”
(*
”r
, 
pÜt
, *
bšdaddr
, 
backlog
)

507  
	`_ª‘TıS”v”
(
”r
, 
pÜt
, 
bšdaddr
, 
AF_INET6
, 
backlog
);

508 
	}
}

510 
	$ª‘UnixS”v”
(*
”r
, *
·th
, 
mode_t
 
³rm
, 
backlog
)

512 
s
;

513 
sockaddr_un
 
§
;

515 ià((
s
 = 
	`ª‘C»©eSock‘
(
”r
,
AF_LOCAL
)è=ğ
ANET_ERR
)

516  
ANET_ERR
;

518 
	`mem£t
(&
§
,0,(sa));

519 
§
.
sun_çmy
 = 
AF_LOCAL
;

520 
	`¡ºıy
(
§
.
sun_·th
,
·th
,(sa.sun_path)-1);

521 ià(
	`ª‘Li¡’
(
”r
,
s
,(
sockaddr
*)&
§
,(§),
backlog
è=ğ
ANET_ERR
)

522  
ANET_ERR
;

523 ià(
³rm
)

524 
	`chmod
(
§
.
sun_·th
, 
³rm
);

525  
s
;

526 
	}
}

528 
	$ª‘G’”icAcû±
(*
”r
, 
s
, 
sockaddr
 *
§
, 
sockËn_t
 *
Ën
) {

529 
fd
;

531 
fd
 = 
	`acû±
(
s
,
§
,
Ën
);

532 ià(
fd
 == -1) {

533 ià(
”ºo
 =ğ
EINTR
)

536 
	`ª‘S‘E¼Ü
(
”r
, "acû±: %s", 
	`¡»¼Ü
(
”ºo
));

537  
ANET_ERR
;

542  
fd
;

543 
	}
}

545 
	$ª‘TıAcû±
(*
”r
, 
s
, *

, 
size_t
 
_Ën
, *
pÜt
) {

546 
fd
;

547 
sockaddr_¡Üage
 
§
;

548 
sockËn_t
 
§Ën
 = (
§
);

549 ià((
fd
 = 
	`ª‘G’”icAcû±
(
”r
,
s
,(
sockaddr
*)&
§
,&
§Ën
)) == -1)

550  
ANET_ERR
;

552 ià(
§
.
ss_çmy
 =ğ
AF_INET
) {

553 
sockaddr_š
 *
s
 = (sockaddr_š *)&
§
;

554 ià(

è
	`š‘_Áİ
(
AF_INET
,(*)&(
s
->
sš_addr
),,
_Ën
);

555 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš_pÜt
);

557 
sockaddr_š6
 *
s
 = (sockaddr_š6 *)&
§
;

558 ià(

è
	`š‘_Áİ
(
AF_INET6
,(*)&(
s
->
sš6_addr
),,
_Ën
);

559 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš6_pÜt
);

561  
fd
;

562 
	}
}

564 
	$ª‘UnixAcû±
(*
”r
, 
s
) {

565 
fd
;

566 
sockaddr_un
 
§
;

567 
sockËn_t
 
§Ën
 = (
§
);

568 ià((
fd
 = 
	`ª‘G’”icAcû±
(
”r
,
s
,(
sockaddr
*)&
§
,&
§Ën
)) == -1)

569  
ANET_ERR
;

571  
fd
;

572 
	}
}

574 
	$ª‘P“rToSŒšg
(
fd
, *

, 
size_t
 
_Ën
, *
pÜt
) {

575 
sockaddr_¡Üage
 
§
;

576 
sockËn_t
 
§Ën
 = (
§
);

578 ià(
	`g‘³”Çme
(
fd
,(
sockaddr
*)&
§
,&
§Ën
è=ğ-1è
”rÜ
;

579 ià(
_Ën
 =ğ0è
”rÜ
;

581 ià(
§
.
ss_çmy
 =ğ
AF_INET
) {

582 
sockaddr_š
 *
s
 = (sockaddr_š *)&
§
;

583 ià(

è
	`š‘_Áİ
(
AF_INET
,(*)&(
s
->
sš_addr
),,
_Ën
);

584 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš_pÜt
);

585 } ià(
§
.
ss_çmy
 =ğ
AF_INET6
) {

586 
sockaddr_š6
 *
s
 = (sockaddr_š6 *)&
§
;

587 ià(

è
	`š‘_Áİ
(
AF_INET6
,(*)&(
s
->
sš6_addr
),,
_Ën
);

588 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš6_pÜt
);

589 } ià(
§
.
ss_çmy
 =ğ
AF_UNIX
) {

590 ià(

è
	`¡ºıy
(,"/unixsock‘",
_Ën
);

591 ià(
pÜt
) *port = 0;

593 
”rÜ
;

597 
”rÜ
:

598 ià(

) {

599 ià(
_Ën
 >= 2) {

600 

[0] = '?';

601 

[1] = '\0';

602 } ià(
_Ën
 == 1) {

603 

[0] = '\0';

606 ià(
pÜt
) *port = 0;

608 
	}
}

613 
	$ª‘FÜm©Addr
(*
buf
, 
size_t
 
buf_Ën
, *

, 
pÜt
) {

614  
	`¢´štf
(
buf
,
buf_Ën
, 
	`¡rchr
(

,':') ?

615 "[%s]:%d" : "%s:%d", 

, 
pÜt
);

616 
	}
}

619 
	$ª‘FÜm©P“r
(
fd
, *
buf
, 
size_t
 
buf_Ën
) {

620 

[
INET6_ADDRSTRLEN
];

621 
pÜt
;

623 
	`ª‘P“rToSŒšg
(
fd
,

,(),&
pÜt
);

624  
	`ª‘FÜm©Addr
(
buf
, 
buf_Ën
, 

, 
pÜt
);

625 
	}
}

627 
	$ª‘SockName
(
fd
, *

, 
size_t
 
_Ën
, *
pÜt
) {

628 
sockaddr_¡Üage
 
§
;

629 
sockËn_t
 
§Ën
 = (
§
);

631 ià(
	`g‘sockÇme
(
fd
,(
sockaddr
*)&
§
,&
§Ën
) == -1) {

632 ià(
pÜt
) *port = 0;

633 

[0] = '?';

634 

[1] = '\0';

637 ià(
§
.
ss_çmy
 =ğ
AF_INET
) {

638 
sockaddr_š
 *
s
 = (sockaddr_š *)&
§
;

639 ià(

è
	`š‘_Áİ
(
AF_INET
,(*)&(
s
->
sš_addr
),,
_Ën
);

640 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš_pÜt
);

642 
sockaddr_š6
 *
s
 = (sockaddr_š6 *)&
§
;

643 ià(

è
	`š‘_Áİ
(
AF_INET6
,(*)&(
s
->
sš6_addr
),,
_Ën
);

644 ià(
pÜt
è*pÜˆğ
	`Áohs
(
s
->
sš6_pÜt
);

647 
	}
}

649 
	$ª‘FÜm©Sock
(
fd
, *
fmt
, 
size_t
 
fmt_Ën
) {

650 

[
INET6_ADDRSTRLEN
];

651 
pÜt
;

653 
	`ª‘SockName
(
fd
,

,(),&
pÜt
);

654  
	`ª‘FÜm©Addr
(
fmt
, 
fmt_Ën
, 

, 
pÜt
);

655 
	}
}

	@anet.h

31 #iâdeà
ANET_H


32 
	#ANET_H


	)

34 
	~<sys/ty³s.h
>

36 
	#ANET_OK
 0

	)

37 
	#ANET_ERR
 -1

	)

38 
	#ANET_ERR_LEN
 256

	)

41 
	#ANET_NONE
 0

	)

42 
	#ANET_IP_ONLY
 (1<<0)

	)

44 #ià
defšed
(
__sun
è|| defšed(
_AIX
)

45 
	#AF_LOCAL
 
AF_UNIX


	)

48 #ifdeà
_AIX


49 #undeà
_Ën


52 
ª‘TıCÚÃù
(*
”r
, *
addr
, 
pÜt
);

53 
ª‘TıNÚBlockCÚÃù
(*
”r
, *
addr
, 
pÜt
);

54 
ª‘TıNÚBlockBšdCÚÃù
(*
”r
, *
addr
, 
pÜt
, *
sourû_addr
);

55 
ª‘TıNÚBlockBe¡EffÜtBšdCÚÃù
(*
”r
, *
addr
, 
pÜt
, *
sourû_addr
);

56 
ª‘UnixCÚÃù
(*
”r
, *
·th
);

57 
ª‘UnixNÚBlockCÚÃù
(*
”r
, *
·th
);

58 
ª‘R—d
(
fd
, *
buf
, 
couÁ
);

59 
ª‘ResŞve
(*
”r
, *
ho¡
, *
buf
, 
size_t
 
buf_Ën
);

60 
ª‘ResŞveIP
(*
”r
, *
ho¡
, *
buf
, 
size_t
 
buf_Ën
);

61 
ª‘TıS”v”
(*
”r
, 
pÜt
, *
bšdaddr
, 
backlog
);

62 
ª‘Tı6S”v”
(*
”r
, 
pÜt
, *
bšdaddr
, 
backlog
);

63 
ª‘UnixS”v”
(*
”r
, *
·th
, 
mode_t
 
³rm
, 
backlog
);

64 
ª‘TıAcû±
(*
”r
, 
£rv”sock
, *

, 
size_t
 
_Ën
, *
pÜt
);

65 
ª‘UnixAcû±
(*
”r
, 
£rv”sock
);

66 
ª‘Wr™e
(
fd
, *
buf
, 
couÁ
);

67 
ª‘NÚBlock
(*
”r
, 
fd
);

68 
ª‘Block
(*
”r
, 
fd
);

69 
ª‘EÇbËTıNoD–ay
(*
”r
, 
fd
);

70 
ª‘Di§bËTıNoD–ay
(*
”r
, 
fd
);

71 
ª‘TıK“pAlive
(*
”r
, 
fd
);

72 
ª‘S’dTimeout
(*
”r
, 
fd
, 
ms
);

73 
ª‘P“rToSŒšg
(
fd
, *

, 
size_t
 
_Ën
, *
pÜt
);

74 
ª‘K“pAlive
(*
”r
, 
fd
, 
š‹rv®
);

75 
ª‘SockName
(
fd
, *

, 
size_t
 
_Ën
, *
pÜt
);

76 
ª‘FÜm©Addr
(*
fmt
, 
size_t
 
fmt_Ën
, *

, 
pÜt
);

77 
ª‘FÜm©P“r
(
fd
, *
fmt
, 
size_t
 
fmt_Ën
);

78 
ª‘FÜm©Sock
(
fd
, *
fmt
, 
size_t
 
fmt_Ën
);

	@aof.c

30 
	~"£rv”.h
"

31 
	~"bio.h
"

32 
	~"rio.h
"

34 
	~<sigÇl.h
>

35 
	~<fú.h
>

36 
	~<sys/¡©.h
>

37 
	~<sys/ty³s.h
>

38 
	~<sys/time.h
>

39 
	~<sys/»sourû.h
>

40 
	~<sys/wa™.h
>

41 
	~<sys/·¿m.h
>

43 
aofUpd©eCu¼’tSize
();

44 
aofClo£Pes
();

60 
	#AOF_RW_BUF_BLOCK_SIZE
 (1024*1024*10è

	)

62 
	saoäwblock
 {

63 
	mu£d
, 
	mä“
;

64 
	mbuf
[
AOF_RW_BUF_BLOCK_SIZE
];

65 } 
	taoäwblock
;

70 
	$aofRewr™eBufãrRe£t
() {

71 ià(
£rv”
.
aof_»wr™e_buf_blocks
)

72 
	`li¡R–—£
(
£rv”
.
aof_»wr™e_buf_blocks
);

74 
£rv”
.
aof_»wr™e_buf_blocks
 = 
	`li¡C»©e
();

75 
	`li¡S‘F»eM‘hod
(
£rv”
.
aof_»wr™e_buf_blocks
,
zä“
);

76 
	}
}

79 
	$aofRewr™eBufãrSize
() {

80 
li¡Node
 *
Ê
;

81 
li¡I‹r
 
li
;

82 
size
 = 0;

84 
	`li¡Rewšd
(
£rv”
.
aof_»wr™e_buf_blocks
,&
li
);

85 (
Ê
 = 
	`li¡Next
(&
li
))) {

86 
aoäwblock
 *
block
 = 
	`li¡NodeV®ue
(
Ê
);

87 
size
 +ğ
block
->
u£d
;

89  
size
;

90 
	}
}

95 
	$aofChdWr™eDiffD©a
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

96 
li¡Node
 *
Ê
;

97 
aoäwblock
 *
block
;

98 
ssize_t
 
nwr™‹n
;

99 
	`UNUSED
(
–
);

100 
	`UNUSED
(
fd
);

101 
	`UNUSED
(
´ivd©a
);

102 
	`UNUSED
(
mask
);

105 
Ê
 = 
	`li¡Fœ¡
(
£rv”
.
aof_»wr™e_buf_blocks
);

106 
block
 = 
Ê
 ?†n->
v®ue
 : 
NULL
;

107 ià(
£rv”
.
aof_¡İ_£ndšg_diff
 || !
block
) {

108 
	`«D–‘eFeEv’t
(
£rv”
.
–
,£rv”.
aof_pe_wr™e_d©a_to_chd
,

109 
AE_WRITABLE
);

112 ià(
block
->
u£d
 > 0) {

113 
nwr™‹n
 = 
	`wr™e
(
£rv”
.
aof_pe_wr™e_d©a_to_chd
,

114 
block
->
buf
,block->
u£d
);

115 ià(
nwr™‹n
 <= 0) ;

116 
	`memmove
(
block
->
buf
,block->buf+
nwr™‹n
,block->
u£d
-nwritten);

117 
block
->
u£d
 -ğ
nwr™‹n
;

119 ià(
block
->
u£d
 =ğ0è
	`li¡D–Node
(
£rv”
.
aof_»wr™e_buf_blocks
,
Ê
);

121 
	}
}

124 
	$aofRewr™eBufãrAµ’d
(*
s
, 
Ën
) {

125 
li¡Node
 *
Ê
 = 
	`li¡La¡
(
£rv”
.
aof_»wr™e_buf_blocks
);

126 
aoäwblock
 *
block
 = 
Ê
 ?†n->
v®ue
 : 
NULL
;

128 
Ën
) {

131 ià(
block
) {

132 
thi¦’
 = (
block
->
ä“
 < 
Ën
) ? block->free :†en;

133 ià(
thi¦’
) {

134 
	`memıy
(
block
->
buf
+block->
u£d
, 
s
, 
thi¦’
);

135 
block
->
u£d
 +ğ
thi¦’
;

136 
block
->
ä“
 -ğ
thi¦’
;

137 
s
 +ğ
thi¦’
;

138 
Ën
 -ğ
thi¦’
;

142 ià(
Ën
) {

143 
numblocks
;

145 
block
 = 
	`zm®loc
((*block));

146 
block
->
ä“
 = 
AOF_RW_BUF_BLOCK_SIZE
;

147 
block
->
u£d
 = 0;

148 
	`li¡AddNodeTa
(
£rv”
.
aof_»wr™e_buf_blocks
,
block
);

152 
numblocks
 = 
	`li¡L’gth
(
£rv”
.
aof_»wr™e_buf_blocks
);

153 ià(((
numblocks
+1) % 10) == 0) {

154 
Ëv–
 = ((
numblocks
+1è% 100è=ğ0 ? 
LL_WARNING
 :

155 
LL_NOTICE
;

156 
	`£rv”Log
(
Ëv–
,"Background AOF buffer size: %lu MB",

157 
	`aofRewr™eBufãrSize
()/(1024*1024));

164 ià(
	`«G‘FeEv’ts
(
£rv”
.
–
,£rv”.
aof_pe_wr™e_d©a_to_chd
) == 0) {

165 
	`«C»©eFeEv’t
(
£rv”
.
–
, s”v”.
aof_pe_wr™e_d©a_to_chd
,

166 
AE_WRITABLE
, 
aofChdWr™eDiffD©a
, 
NULL
);

168 
	}
}

173 
ssize_t
 
	$aofRewr™eBufãrWr™e
(
fd
) {

174 
li¡Node
 *
Ê
;

175 
li¡I‹r
 
li
;

176 
ssize_t
 
couÁ
 = 0;

178 
	`li¡Rewšd
(
£rv”
.
aof_»wr™e_buf_blocks
,&
li
);

179 (
Ê
 = 
	`li¡Next
(&
li
))) {

180 
aoäwblock
 *
block
 = 
	`li¡NodeV®ue
(
Ê
);

181 
ssize_t
 
nwr™‹n
;

183 ià(
block
->
u£d
) {

184 
nwr™‹n
 = 
	`wr™e
(
fd
,
block
->
buf
,block->
u£d
);

185 ià(
nwr™‹n
 !ğ(
ssize_t
)
block
->
u£d
) {

186 ià(
nwr™‹n
 =ğ0è
”ºo
 = 
EIO
;

189 
couÁ
 +ğ
nwr™‹n
;

192  
couÁ
;

193 
	}
}

201 
	$aof_background_fsync
(
fd
) {

202 
	`bioC»©eBackgroundJob
(
BIO_AOF_FSYNC
,(*)()
fd
,
NULL
,NULL);

203 
	}
}

207 
	$¡İAµ’dOÆy
() {

208 
	`£rv”As£¹
(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
);

209 
	`æushAµ’dOÆyFe
(1);

210 
	`aof_fsync
(
£rv”
.
aof_fd
);

211 
	`şo£
(
£rv”
.
aof_fd
);

213 
£rv”
.
aof_fd
 = -1;

214 
£rv”
.
aof_£Ëùed_db
 = -1;

215 
£rv”
.
aof_¡©e
 = 
AOF_OFF
;

217 ià(
£rv”
.
aof_chd_pid
 != -1) {

218 
¡©loc
;

220 
	`£rv”Log
(
LL_NOTICE
,"Killing„unning AOF„ewrite child: %ld",

221 (è
£rv”
.
aof_chd_pid
);

222 ià(
	`kl
(
£rv”
.
aof_chd_pid
,
SIGUSR1
) != -1) {

223 
	`wa™3
(&
¡©loc
,0,
NULL
è!ğ
£rv”
.
aof_chd_pid
);

226 
	`aofRewr™eBufãrRe£t
();

227 
	`aofRemoveTempFe
(
£rv”
.
aof_chd_pid
);

228 
£rv”
.
aof_chd_pid
 = -1;

229 
£rv”
.
aof_»wr™e_time_¡¬t
 = -1;

231 
	`aofClo£Pes
();

233 
	}
}

237 
	$¡¬tAµ’dOÆy
() {

238 
cwd
[
MAXPATHLEN
];

240 
£rv”
.
aof_Ï¡_fsync
 = s”v”.
unixtime
;

241 
£rv”
.
aof_fd
 = 
	`İ’
(£rv”.
aof_f’ame
,
O_WRONLY
|
O_APPEND
|
O_CREAT
,0644);

242 
	`£rv”As£¹
(
£rv”
.
aof_¡©e
 =ğ
AOF_OFF
);

243 ià(
£rv”
.
aof_fd
 == -1) {

244 *
cwdp
 = 
	`g‘cwd
(
cwd
,
MAXPATHLEN
);

246 
	`£rv”Log
(
LL_WARNING
,

249 
£rv”
.
aof_f’ame
,

250 
cwdp
 ? cwdp : "unknown",

251 
	`¡»¼Ü
(
”ºo
));

252  
C_ERR
;

254 ià(
£rv”
.
rdb_chd_pid
 != -1) {

255 
£rv”
.
aof_»wr™e_scheduËd
 = 1;

256 
	`£rv”Log
(
LL_WARNING
,"AOF wasƒnabled buthere is‡lready‡ child…rocess saving‡n RDB file on disk. An AOF background was scheduledo start when…ossible.");

257 } ià(
	`»wr™eAµ’dOÆyFeBackground
(è=ğ
C_ERR
) {

258 
	`şo£
(
£rv”
.
aof_fd
);

259 
	`£rv”Log
(
LL_WARNING
,"Redis‚eedsoƒnablehe AOF but can'trigger‡ background AOF„ewrite operation. Checkhe‡bove†ogs for more info‡boutheƒrror.");

260  
C_ERR
;

264 
£rv”
.
aof_¡©e
 = 
AOF_WAIT_REWRITE
;

265  
C_OK
;

266 
	}
}

286 
	#AOF_WRITE_LOG_ERROR_RATE
 30

	)

287 
	$æushAµ’dOÆyFe
(
fÜû
) {

288 
ssize_t
 
nwr™‹n
;

289 
sync_š_´og»ss
 = 0;

290 
m¡ime_t
 
Ï‹ncy
;

292 ià(
	`sd¦’
(
£rv”
.
aof_buf
) == 0) ;

294 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_EVERYSEC
)

295 
sync_š_´og»ss
 = 
	`bioP’dšgJobsOfTy³
(
BIO_AOF_FSYNC
) != 0;

297 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_EVERYSEC
 && !
fÜû
) {

301 ià(
sync_š_´og»ss
) {

302 ià(
£rv”
.
aof_æush_po¡pÚed_¡¬t
 == 0) {

305 
£rv”
.
aof_æush_po¡pÚed_¡¬t
 = s”v”.
unixtime
;

307 } ià(
£rv”
.
unixtime
 - s”v”.
aof_æush_po¡pÚed_¡¬t
 < 2) {

314 
£rv”
.
aof_d–ayed_fsync
++;

315 
	`£rv”Log
(
LL_NOTICE
,"Asynchronous AOF fsync isakingoo†ong (disk is busy?). Writinghe AOF buffer without waiting for fsynco complete,his may slow down Redis.");

324 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

325 
nwr™‹n
 = 
	`wr™e
(
£rv”
.
aof_fd
,£rv”.
aof_buf
,
	`sd¦’
(server.aof_buf));

326 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

332 ià(
sync_š_´og»ss
) {

333 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-wr™e-³ndšg-fsync",
Ï‹ncy
);

334 } ià(
£rv”
.
aof_chd_pid
 !ğ-1 || s”v”.
rdb_chd_pid
 != -1) {

335 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-wr™e-aùive-chd",
Ï‹ncy
);

337 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-wr™e-®Úe",
Ï‹ncy
);

339 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-wr™e",
Ï‹ncy
);

342 
£rv”
.
aof_æush_po¡pÚed_¡¬t
 = 0;

344 ià(
nwr™‹n
 !ğ(sigÃd)
	`sd¦’
(
£rv”
.
aof_buf
)) {

345 
time_t
 
Ï¡_wr™e_”rÜ_log
 = 0;

346 
ÿn_log
 = 0;

349 ià((
£rv”
.
unixtime
 - 
Ï¡_wr™e_”rÜ_log
è> 
AOF_WRITE_LOG_ERROR_RATE
) {

350 
ÿn_log
 = 1;

351 
Ï¡_wr™e_”rÜ_log
 = 
£rv”
.
unixtime
;

355 ià(
nwr™‹n
 == -1) {

356 ià(
ÿn_log
) {

357 
	`£rv”Log
(
LL_WARNING
,"Error writingohe AOF file: %s",

358 
	`¡»¼Ü
(
”ºo
));

359 
£rv”
.
aof_Ï¡_wr™e_”ºo
 = 
”ºo
;

362 ià(
ÿn_log
) {

363 
	`£rv”Log
(
LL_WARNING
,"Short write while writingo "

366 ()
nwr™‹n
,

367 ()
	`sd¦’
(
£rv”
.
aof_buf
));

370 ià(
	`árunÿ‹
(
£rv”
.
aof_fd
, s”v”.
aof_cu¼’t_size
) == -1) {

371 ià(
ÿn_log
) {

372 
	`£rv”Log
(
LL_WARNING
, "Could‚ot„emove short write "

375 "árunÿ‹: %s", 
	`¡»¼Ü
(
”ºo
));

380 
nwr™‹n
 = -1;

382 
£rv”
.
aof_Ï¡_wr™e_”ºo
 = 
ENOSPC
;

386 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_ALWAYS
) {

391 
	`£rv”Log
(
LL_WARNING
,"Can't„ecover from AOF writeƒrror whenhe AOF fsync…olicy is 'always'. Exiting...");

392 
	`ex™
(1);

397 
£rv”
.
aof_Ï¡_wr™e_¡©us
 = 
C_ERR
;

401 ià(
nwr™‹n
 > 0) {

402 
£rv”
.
aof_cu¼’t_size
 +ğ
nwr™‹n
;

403 
	`sd¤ªge
(
£rv”
.
aof_buf
,
nwr™‹n
,-1);

410 ià(
£rv”
.
aof_Ï¡_wr™e_¡©us
 =ğ
C_ERR
) {

411 
	`£rv”Log
(
LL_WARNING
,

413 
£rv”
.
aof_Ï¡_wr™e_¡©us
 = 
C_OK
;

416 
£rv”
.
aof_cu¼’t_size
 +ğ
nwr™‹n
;

420 ià((
	`sd¦’
(
£rv”
.
aof_buf
)+
	`sd§va
(server.aof_buf)) < 4000) {

421 
	`sdsş—r
(
£rv”
.
aof_buf
);

423 
	`sdsä“
(
£rv”
.
aof_buf
);

424 
£rv”
.
aof_buf
 = 
	`sd£m±y
();

429 ià(
£rv”
.
aof_no_fsync_Ú_»wr™e
 &&

430 (
£rv”
.
aof_chd_pid
 !ğ-1 || s”v”.
rdb_chd_pid
 != -1))

434 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_ALWAYS
) {

437 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

438 
	`aof_fsync
(
£rv”
.
aof_fd
);

439 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

440 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-fsync-®ways",
Ï‹ncy
);

441 
£rv”
.
aof_Ï¡_fsync
 = s”v”.
unixtime
;

442 } ià((
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_EVERYSEC
 &&

443 
£rv”
.
unixtime
 > s”v”.
aof_Ï¡_fsync
)) {

444 ià(!
sync_š_´og»ss
è
	`aof_background_fsync
(
£rv”
.
aof_fd
);

445 
£rv”
.
aof_Ï¡_fsync
 = s”v”.
unixtime
;

447 
	}
}

449 
sds
 
	$ÿtAµ’dOÆyG’”icCommªd
(
sds
 
d¡
, 
¬gc
, 
robj
 **
¬gv
) {

450 
buf
[32];

451 
Ën
, 
j
;

452 
robj
 *
o
;

454 
buf
[0] = '*';

455 
Ën
 = 1+
	`Î2¡ršg
(
buf
+1,(buf)-1,
¬gc
);

456 
buf
[
Ën
++] = '\r';

457 
buf
[
Ën
++] = '\n';

458 
d¡
 = 
	`sdsÿ’
(d¡,
buf
,
Ën
);

460 
j
 = 0; j < 
¬gc
; j++) {

461 
o
 = 
	`g‘DecodedObjeù
(
¬gv
[
j
]);

462 
buf
[0] = '$';

463 
Ën
 = 1+
	`Î2¡ršg
(
buf
+1,(buf)-1,
	`sd¦’
(
o
->
±r
));

464 
buf
[
Ën
++] = '\r';

465 
buf
[
Ën
++] = '\n';

466 
d¡
 = 
	`sdsÿ’
(d¡,
buf
,
Ën
);

467 
d¡
 = 
	`sdsÿ’
(d¡,
o
->
±r
,
	`sd¦’
(o->ptr));

468 
d¡
 = 
	`sdsÿ’
(dst,"\r\n",2);

469 
	`deüRefCouÁ
(
o
);

471  
d¡
;

472 
	}
}

481 
sds
 
	$ÿtAµ’dOÆyExpœeAtCommªd
(
sds
 
buf
, 
»disCommªd
 *
cmd
, 
robj
 *
key
,„obj *
£cÚds
) {

482 
wh’
;

483 
robj
 *
¬gv
[3];

486 
£cÚds
 = 
	`g‘DecodedObjeù
(seconds);

487 
wh’
 = 
	`¡¹Şl
(
£cÚds
->
±r
,
NULL
,10);

489 ià(
cmd
->
´oc
 =ğ
expœeCommªd
 || cmd->´oø=ğ
£‹xCommªd
 ||

490 
cmd
->
´oc
 =ğ
expœ—tCommªd
)

492 
wh’
 *= 1000;

495 ià(
cmd
->
´oc
 =ğ
expœeCommªd
 || cmd->´oø=ğ
³xpœeCommªd
 ||

496 
cmd
->
´oc
 =ğ
£‹xCommªd
 || cmd->´oø=ğ
p£‹xCommªd
)

498 
wh’
 +ğ
	`m¡ime
();

500 
	`deüRefCouÁ
(
£cÚds
);

502 
¬gv
[0] = 
	`ü—‹SŒšgObjeù
("PEXPIREAT",9);

503 
¬gv
[1] = 
key
;

504 
¬gv
[2] = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
wh’
);

505 
buf
 = 
	`ÿtAµ’dOÆyG’”icCommªd
(buf, 3, 
¬gv
);

506 
	`deüRefCouÁ
(
¬gv
[0]);

507 
	`deüRefCouÁ
(
¬gv
[2]);

508  
buf
;

509 
	}
}

511 
	$ãedAµ’dOÆyFe
(
»disCommªd
 *
cmd
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
) {

512 
sds
 
buf
 = 
	`sd£m±y
();

513 
robj
 *
tm·rgv
[3];

517 ià(
diùid
 !ğ
£rv”
.
aof_£Ëùed_db
) {

518 
£ldb
[64];

520 
	`¢´štf
(
£ldb
,(£ldb),"%d",
diùid
);

521 
buf
 = 
	`sdsÿrštf
(buf,"*2\r\n$6\r\nSELECT\r\n$%lu\r\n%s\r\n",

522 ()
	`¡¾’
(
£ldb
),seldb);

523 
£rv”
.
aof_£Ëùed_db
 = 
diùid
;

526 ià(
cmd
->
´oc
 =ğ
expœeCommªd
 || cmd->´oø=ğ
³xpœeCommªd
 ||

527 
cmd
->
´oc
 =ğ
expœ—tCommªd
) {

529 
buf
 = 
	`ÿtAµ’dOÆyExpœeAtCommªd
(buf,
cmd
,
¬gv
[1],argv[2]);

530 } ià(
cmd
->
´oc
 =ğ
£‹xCommªd
 || cmd->´oø=ğ
p£‹xCommªd
) {

532 
tm·rgv
[0] = 
	`ü—‹SŒšgObjeù
("SET",3);

533 
tm·rgv
[1] = 
¬gv
[1];

534 
tm·rgv
[2] = 
¬gv
[3];

535 
buf
 = 
	`ÿtAµ’dOÆyG’”icCommªd
(buf,3,
tm·rgv
);

536 
	`deüRefCouÁ
(
tm·rgv
[0]);

537 
buf
 = 
	`ÿtAµ’dOÆyExpœeAtCommªd
(buf,
cmd
,
¬gv
[1],argv[2]);

542 
buf
 = 
	`ÿtAµ’dOÆyG’”icCommªd
(buf,
¬gc
,
¬gv
);

548 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_ON
)

549 
£rv”
.
aof_buf
 = 
	`sdsÿ’
(£rv”.aof_buf,
buf
,
	`sd¦’
(buf));

555 ià(
£rv”
.
aof_chd_pid
 != -1)

556 
	`aofRewr™eBufãrAµ’d
((*)
buf
,
	`sd¦’
(buf));

558 
	`sdsä“
(
buf
);

559 
	}
}

567 
ş›Á
 *
	$ü—‹FakeCl›Á
() {

568 
ş›Á
 *
c
 = 
	`zm®loc
((*c));

570 
	`£ËùDb
(
c
,0);

571 
c
->
fd
 = -1;

572 
c
->
Çme
 = 
NULL
;

573 
c
->
qu”ybuf
 = 
	`sd£m±y
();

574 
c
->
qu”ybuf_³ak
 = 0;

575 
c
->
¬gc
 = 0;

576 
c
->
¬gv
 = 
NULL
;

577 
c
->
buåos
 = 0;

578 
c
->
æags
 = 0;

579 
c
->
bty³
 = 
BLOCKED_NONE
;

582 
c
->
»¶¡©e
 = 
SLAVE_STATE_WAIT_BGSAVE_START
;

583 
c
->
»¶y
 = 
	`li¡C»©e
();

584 
c
->
»¶y_by‹s
 = 0;

585 
c
->
obuf_soá_lim™_»ached_time
 = 0;

586 
c
->
w©ched_keys
 = 
	`li¡C»©e
();

587 
c
->
³”id
 = 
NULL
;

588 
	`li¡S‘F»eM‘hod
(
c
->
»¶y
,
deüRefCouÁVoid
);

589 
	`li¡S‘DupM‘hod
(
c
->
»¶y
,
dupCl›ÁR•lyV®ue
);

590 
	`š™Cl›ÁMuÉiS‹
(
c
);

591  
c
;

592 
	}
}

594 
	$ä“FakeCl›ÁArgv
(
ş›Á
 *
c
) {

595 
j
;

597 
j
 = 0; j < 
c
->
¬gc
; j++)

598 
	`deüRefCouÁ
(
c
->
¬gv
[
j
]);

599 
	`zä“
(
c
->
¬gv
);

600 
	}
}

602 
	$ä“FakeCl›Á
(
ş›Á
 *
c
) {

603 
	`sdsä“
(
c
->
qu”ybuf
);

604 
	`li¡R–—£
(
c
->
»¶y
);

605 
	`li¡R–—£
(
c
->
w©ched_keys
);

606 
	`ä“Cl›ÁMuÉiS‹
(
c
);

607 
	`zä“
(
c
);

608 
	}
}

613 
	$lßdAµ’dOÆyFe
(*
f’ame
) {

614 
ş›Á
 *
çkeCl›Á
;

615 
FILE
 *
å
 = 
	`fİ’
(
f’ame
,"r");

616 
»dis_¡©
 
sb
;

617 
Şd_aof_¡©e
 = 
£rv”
.
aof_¡©e
;

618 
loİs
 = 0;

619 
off_t
 
v®id_up_to
 = 0;

621 ià(
å
 =ğ
NULL
) {

622 
	`£rv”Log
(
LL_WARNING
,"F©®ƒ¼Ü: cª'ˆİ’h­³nd†og ffÜ„—dšg: %s",
	`¡»¼Ü
(
”ºo
));

623 
	`ex™
(1);

630 ià(
å
 && 
	`»dis_f¡©
(
	`f’o
(å),&
sb
è!ğ-1 && sb.
¡_size
 == 0) {

631 
£rv”
.
aof_cu¼’t_size
 = 0;

632 
	`fşo£
(
å
);

633  
C_ERR
;

638 
£rv”
.
aof_¡©e
 = 
AOF_OFF
;

640 
çkeCl›Á
 = 
	`ü—‹FakeCl›Á
();

641 
	`¡¬tLßdšg
(
å
);

645 
sig
[5];

646 ià(
	`ä—d
(
sig
,1,5,
å
è!ğ5 || 
	`memcmp
(sig,"REDIS",5) != 0) {

648 ià(
	`f£ek
(
å
,0,
SEEK_SET
è=ğ-1è
»ad”r
;

651 
rio
 
rdb
;

653 
	`£rv”Log
(
LL_NOTICE
,"Reading RDB…reamble from AOF file...");

654 ià(
	`f£ek
(
å
,0,
SEEK_SET
è=ğ-1è
»ad”r
;

655 
	`rioIn™W™hFe
(&
rdb
,
å
);

656 ià(
	`rdbLßdRio
(&
rdb
è!ğ
C_OK
) {

657 
	`£rv”Log
(
LL_WARNING
,"Error„eadinghe RDB…reamble ofhe AOF file, AOF†oading‡borted");

658 
»ad”r
;

660 
	`£rv”Log
(
LL_NOTICE
,"Readinghe„emaining AOFail...");

666 
¬gc
, 
j
;

667 
Ën
;

668 
robj
 **
¬gv
;

669 
buf
[128];

670 
sds
 
¬gsds
;

671 
»disCommªd
 *
cmd
;

674 ià(!(
loİs
++ % 1000)) {

675 
	`lßdšgProg»ss
(
	`á–lo
(
å
));

676 
	`´oûssEv’tsWheBlocked
();

679 ià(
	`fg‘s
(
buf
,(buf),
å
è=ğ
NULL
) {

680 ià(
	`ãof
(
å
))

683 
»ad”r
;

685 ià(
buf
[0] !ğ'*'è
fm‹¼
;

686 ià(
buf
[1] =ğ'\0'è
»ad”r
;

687 
¬gc
 = 
	`©oi
(
buf
+1);

688 ià(
¬gc
 < 1è
fm‹¼
;

690 
¬gv
 = 
	`zm®loc
((
robj
*)*
¬gc
);

691 
çkeCl›Á
->
¬gc
 =‡rgc;

692 
çkeCl›Á
->
¬gv
 =‡rgv;

694 
j
 = 0; j < 
¬gc
; j++) {

695 ià(
	`fg‘s
(
buf
,(buf),
å
è=ğ
NULL
) {

696 
çkeCl›Á
->
¬gc
 = 
j
;

697 
	`ä“FakeCl›ÁArgv
(
çkeCl›Á
);

698 
»ad”r
;

700 ià(
buf
[0] !ğ'$'è
fm‹¼
;

701 
Ën
 = 
	`¡¹Ş
(
buf
+1,
NULL
,10);

702 
¬gsds
 = 
	`sd¢ewËn
(
NULL
,
Ën
);

703 ià(
Ën
 && 
	`ä—d
(
¬gsds
,Ën,1,
å
) == 0) {

704 
	`sdsä“
(
¬gsds
);

705 
çkeCl›Á
->
¬gc
 = 
j
;

706 
	`ä“FakeCl›ÁArgv
(
çkeCl›Á
);

707 
»ad”r
;

709 
¬gv
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,
¬gsds
);

710 ià(
	`ä—d
(
buf
,2,1,
å
) == 0) {

711 
çkeCl›Á
->
¬gc
 = 
j
+1;

712 
	`ä“FakeCl›ÁArgv
(
çkeCl›Á
);

713 
»ad”r
;

718 
cmd
 = 
	`lookupCommªd
(
¬gv
[0]->
±r
);

719 ià(!
cmd
) {

720 
	`£rv”Log
(
LL_WARNING
,"UnknowÀcommªd '%s'„—dšgh­³nd oÆy fe", (*)
¬gv
[0]->
±r
);

721 
	`ex™
(1);

725 
çkeCl›Á
->
cmd
 = cmd;

726 
cmd
->
	`´oc
(
çkeCl›Á
);

729 
	`£rv”As£¹
(
çkeCl›Á
->
buåos
 =ğ0 && 
	`li¡L’gth
(çkeCl›Á->
»¶y
) == 0);

731 
	`£rv”As£¹
((
çkeCl›Á
->
æags
 & 
CLIENT_BLOCKED
) == 0);

735 
	`ä“FakeCl›ÁArgv
(
çkeCl›Á
);

736 
çkeCl›Á
->
cmd
 = 
NULL
;

737 ià(
£rv”
.
aof_lßd_Œunÿ‹d
è
v®id_up_to
 = 
	`á–lo
(
å
);

742 ià(
çkeCl›Á
->
æags
 & 
CLIENT_MULTI
è
uxeof
;

744 
lßded_ok
:

745 
	`fşo£
(
å
);

746 
	`ä“FakeCl›Á
(
çkeCl›Á
);

747 
£rv”
.
aof_¡©e
 = 
Şd_aof_¡©e
;

748 
	`¡İLßdšg
();

749 
	`aofUpd©eCu¼’tSize
();

750 
£rv”
.
aof_»wr™e_ba£_size
 = s”v”.
aof_cu¼’t_size
;

751  
C_OK
;

753 
»ad”r
:

754 ià(!
	`ãof
(
å
)) {

755 ià(
çkeCl›Á
è
	`ä“FakeCl›Á
(fakeClient);

756 
	`£rv”Log
(
LL_WARNING
,"UÄecov”abËƒ¼Ü„—dšgh­³nd oÆy fe: %s", 
	`¡»¼Ü
(
”ºo
));

757 
	`ex™
(1);

760 
uxeof
:

761 ià(
£rv”
.
aof_lßd_Œunÿ‹d
) {

762 
	`£rv”Log
(
LL_WARNING
,"!!! Warning: short„ead while†oadinghe AOF file !!!");

763 
	`£rv”Log
(
LL_WARNING
,"!!! Truncatinghe AOF‡t offset %llu !!!",

764 (è
v®id_up_to
);

765 ià(
v®id_up_to
 =ğ-1 || 
	`Œunÿ‹
(
f’ame
,valid_up_to) == -1) {

766 ià(
v®id_up_to
 == -1) {

767 
	`£rv”Log
(
LL_WARNING
,"Last valid command offset is invalid");

769 
	`£rv”Log
(
LL_WARNING
,"Errorruncatinghe AOF file: %s",

770 
	`¡»¼Ü
(
”ºo
));

775 ià(
£rv”
.
aof_fd
 !ğ-1 && 
	`l£ek
(£rv”.aof_fd,0,
SEEK_END
) == -1) {

776 
	`£rv”Log
(
LL_WARNING
,"Can't seekheƒnd ofhe AOF file: %s",

777 
	`¡»¼Ü
(
”ºo
));

779 
	`£rv”Log
(
LL_WARNING
,

781 
lßded_ok
;

785 ià(
çkeCl›Á
è
	`ä“FakeCl›Á
(fakeClient);

786 
	`£rv”Log
(
LL_WARNING
,"Unexpectedƒnd of file„eadinghe‡ppend only file. You can: 1) Make‡ backup of your AOF file,hen use ./redis-check-aof --fix <filename>. 2) Alternatively you can sethe 'aof-load-truncated' configuration optiono yes‡nd„estarthe server.");

787 
	`ex™
(1);

789 
fm‹¼
:

790 ià(
çkeCl›Á
è
	`ä“FakeCl›Á
(fakeClient);

791 
	`£rv”Log
(
LL_WARNING
,"Bad file format„eadinghe‡ppend only file: make‡ backup of your AOF file,hen use ./redis-check-aof --fix <filename>");

792 
	`ex™
(1);

793 
	}
}

801 
	$rioWr™eBulkObjeù
(
rio
 *
r
, 
robj
 *
obj
) {

804 ià(
obj
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

805  
	`rioWr™eBulkLÚgLÚg
(
r
,()
obj
->
±r
);

806 } ià(
	`sdsEncodedObjeù
(
obj
)) {

807  
	`rioWr™eBulkSŒšg
(
r
,
obj
->
±r
,
	`sd¦’
(obj->ptr));

809 
	`£rv”Pªic
("Unknown stringƒncoding");

811 
	}
}

815 
	$»wr™eLi¡Objeù
(
rio
 *
r
, 
robj
 *
key
,„obj *
o
) {

816 
couÁ
 = 0, 
™ems
 = 
	`li¡Ty³L’gth
(
o
);

818 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

819 
quickli¡
 *
li¡
 = 
o
->
±r
;

820 
quickli¡I‹r
 *
li
 = 
	`quickli¡G‘I‹¿tÜ
(
li¡
, 
AL_START_HEAD
);

821 
quickli¡EÁry
 
’Œy
;

823 
	`quickli¡Next
(
li
,&
’Œy
)) {

824 ià(
couÁ
 == 0) {

825 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

826 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

827 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
) == 0)  0;

828 ià(
	`rioWr™eBulkSŒšg
(
r
,"RPUSH",5) == 0)  0;

829 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

832 ià(
’Œy
.
v®ue
) {

833 ià(
	`rioWr™eBulkSŒšg
(
r
,(*)
’Œy
.
v®ue
,’Œy.
sz
) == 0)  0;

835 ià(
	`rioWr™eBulkLÚgLÚg
(
r
,
’Œy
.
lÚgv®
) == 0)  0;

837 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

838 
™ems
--;

840 
	`quickli¡R–—£I‹¿tÜ
(
li
);

842 
	`£rv”Pªic
("Unknown†istƒncoding");

845 
	}
}

849 
	$»wr™eS‘Objeù
(
rio
 *
r
, 
robj
 *
key
,„obj *
o
) {

850 
couÁ
 = 0, 
™ems
 = 
	`£tTy³Size
(
o
);

852 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

853 
ii
 = 0;

854 
št64_t
 
Îv®
;

856 
	`št£tG‘
(
o
->
±r
,
ii
++,&
Îv®
)) {

857 ià(
couÁ
 == 0) {

858 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

859 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

861 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
) == 0)  0;

862 ià(
	`rioWr™eBulkSŒšg
(
r
,"SADD",4) == 0)  0;

863 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

865 ià(
	`rioWr™eBulkLÚgLÚg
(
r
,
Îv®
) == 0)  0;

866 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

867 
™ems
--;

869 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

870 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
o
->
±r
);

871 
diùEÁry
 *
de
;

873 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

874 
sds
 
–e
 = 
	`diùG‘Key
(
de
);

875 ià(
couÁ
 == 0) {

876 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

877 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

879 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
) == 0)  0;

880 ià(
	`rioWr™eBulkSŒšg
(
r
,"SADD",4) == 0)  0;

881 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

883 ià(
	`rioWr™eBulkSŒšg
(
r
,
–e
,
	`sd¦’
(ele)) == 0)  0;

884 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

885 
™ems
--;

887 
	`diùR–—£I‹¿tÜ
(
di
);

889 
	`£rv”Pªic
("Unknown setƒncoding");

892 
	}
}

896 
	$»wr™eSÜ‹dS‘Objeù
(
rio
 *
r
, 
robj
 *
key
,„obj *
o
) {

897 
couÁ
 = 0, 
™ems
 = 
	`z£tL’gth
(
o
);

899 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

900 *
zl
 = 
o
->
±r
;

901 *
•Œ
, *
¥Œ
;

902 *
v¡r
;

903 
vËn
;

904 
vÎ
;

905 
scÜe
;

907 
•Œ
 = 
	`zli¡Index
(
zl
,0);

908 
	`£rv”As£¹
(
•Œ
 !ğ
NULL
);

909 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

910 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

912 
•Œ
 !ğ
NULL
) {

913 
	`£rv”As£¹
(
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vÎ
));

914 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

916 ià(
couÁ
 == 0) {

917 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

918 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

920 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
*2) == 0)  0;

921 ià(
	`rioWr™eBulkSŒšg
(
r
,"ZADD",4) == 0)  0;

922 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

924 ià(
	`rioWr™eBulkDoubË
(
r
,
scÜe
) == 0)  0;

925 ià(
v¡r
 !ğ
NULL
) {

926 ià(
	`rioWr™eBulkSŒšg
(
r
,(*)
v¡r
,
vËn
) == 0)  0;

928 ià(
	`rioWr™eBulkLÚgLÚg
(
r
,
vÎ
) == 0)  0;

930 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

931 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

932 
™ems
--;

934 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

935 
z£t
 *
zs
 = 
o
->
±r
;

936 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
zs
->
diù
);

937 
diùEÁry
 *
de
;

939 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

940 
sds
 
–e
 = 
	`diùG‘Key
(
de
);

941 *
scÜe
 = 
	`diùG‘V®
(
de
);

943 ià(
couÁ
 == 0) {

944 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

945 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

947 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
*2) == 0)  0;

948 ià(
	`rioWr™eBulkSŒšg
(
r
,"ZADD",4) == 0)  0;

949 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

951 ià(
	`rioWr™eBulkDoubË
(
r
,*
scÜe
) == 0)  0;

952 ià(
	`rioWr™eBulkSŒšg
(
r
,
–e
,
	`sd¦’
(ele)) == 0)  0;

953 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

954 
™ems
--;

956 
	`diùR–—£I‹¿tÜ
(
di
);

958 
	`£rv”Pªic
("Unknown sorted zsetƒncoding");

961 
	}
}

969 
	$rioWr™eHashI‹¿tÜCursÜ
(
rio
 *
r
, 
hashTy³I‹¿tÜ
 *
hi
, 
wh©
) {

970 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

971 *
v¡r
 = 
NULL
;

972 
vËn
 = 
UINT_MAX
;

973 
vÎ
 = 
LLONG_MAX
;

975 
	`hashTy³Cu¼’tFromZli¡
(
hi
, 
wh©
, &
v¡r
, &
vËn
, &
vÎ
);

976 ià(
v¡r
)

977  
	`rioWr™eBulkSŒšg
(
r
, (*)
v¡r
, 
vËn
);

979  
	`rioWr™eBulkLÚgLÚg
(
r
, 
vÎ
);

980 } ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

981 
sds
 
v®ue
 = 
	`hashTy³Cu¼’tFromHashTabË
(
hi
, 
wh©
);

982  
	`rioWr™eBulkSŒšg
(
r
, 
v®ue
, 
	`sd¦’
(value));

985 
	`£rv”Pªic
("Unknown hashƒncoding");

987 
	}
}

991 
	$»wr™eHashObjeù
(
rio
 *
r
, 
robj
 *
key
,„obj *
o
) {

992 
hashTy³I‹¿tÜ
 *
hi
;

993 
couÁ
 = 0, 
™ems
 = 
	`hashTy³L’gth
(
o
);

995 
hi
 = 
	`hashTy³In™I‹¿tÜ
(
o
);

996 
	`hashTy³Next
(
hi
è!ğ
C_ERR
) {

997 ià(
couÁ
 == 0) {

998 
cmd_™ems
 = (
™ems
 > 
AOF_REWRITE_ITEMS_PER_CMD
) ?

999 
AOF_REWRITE_ITEMS_PER_CMD
 : 
™ems
;

1001 ià(
	`rioWr™eBulkCouÁ
(
r
,'*',2+
cmd_™ems
*2) == 0)  0;

1002 ià(
	`rioWr™eBulkSŒšg
(
r
,"HMSET",5) == 0)  0;

1003 ià(
	`rioWr™eBulkObjeù
(
r
,
key
) == 0)  0;

1006 ià(
	`rioWr™eHashI‹¿tÜCursÜ
(
r
, 
hi
, 
OBJ_HASH_KEY
) == 0)  0;

1007 ià(
	`rioWr™eHashI‹¿tÜCursÜ
(
r
, 
hi
, 
OBJ_HASH_VALUE
) == 0)  0;

1008 ià(++
couÁ
 =ğ
AOF_REWRITE_ITEMS_PER_CMD
) count = 0;

1009 
™ems
--;

1012 
	`hashTy³R–—£I‹¿tÜ
(
hi
);

1015 
	}
}

1020 
	$»wr™eModuËObjeù
(
rio
 *
r
, 
robj
 *
key
,„obj *
o
) {

1021 
RedisModuËIO
 
io
;

1022 
moduËV®ue
 *
mv
 = 
o
->
±r
;

1023 
moduËTy³
 *
mt
 = 
mv
->
ty³
;

1024 
	`moduËIn™IOCÚ‹xt
(
io
,
mt
,
r
);

1025 
mt
->
	`aof_»wr™e
(&
io
,
key
,
mv
->
v®ue
);

1026 ià(
io
.
ùx
) {

1027 
	`moduËF»eCÚ‹xt
(
io
.
ùx
);

1028 
	`zä“
(
io
.
ùx
);

1030  
io
.
”rÜ
 ? 0 : 1;

1031 
	}
}

1036 
ssize_t
 
	$aofR—dDiffFromP¬’t
() {

1037 
buf
[65536];

1038 
ssize_t
 
Ä—d
, 
tÙ®
 = 0;

1040 (
Ä—d
 =

1041 
	`»ad
(
£rv”
.
aof_pe_»ad_d©a_äom_·»Á
,
buf
,(buf))) > 0) {

1042 
£rv”
.
aof_chd_diff
 = 
	`sdsÿ’
(£rv”.aof_chd_diff,
buf
,
Ä—d
);

1043 
tÙ®
 +ğ
Ä—d
;

1045  
tÙ®
;

1046 
	}
}

1048 
	$»wr™eAµ’dOÆyFeRio
(
rio
 *
aof
) {

1049 
diùI‹¿tÜ
 *
di
 = 
NULL
;

1050 
diùEÁry
 *
de
;

1051 
size_t
 
´oûs£d
 = 0;

1052 
now
 = 
	`m¡ime
();

1053 
j
;

1055 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

1056 
£Ëùcmd
[] = "*2\r\n$6\r\nSELECT\r\n";

1057 
»disDb
 *
db
 = 
£rv”
.db+
j
;

1058 
diù
 *
d
 = 
db
->dict;

1059 ià(
	`diùSize
(
d
) == 0) ;

1060 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
d
);

1063 ià(
	`rioWr™e
(
aof
,
£Ëùcmd
,(£Ëùcmd)-1è=ğ0è
w”r
;

1064 ià(
	`rioWr™eBulkLÚgLÚg
(
aof
,
j
è=ğ0è
w”r
;

1067 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1068 
sds
 
key¡r
;

1069 
robj
 
key
, *
o
;

1070 
expœ‘ime
;

1072 
key¡r
 = 
	`diùG‘Key
(
de
);

1073 
o
 = 
	`diùG‘V®
(
de
);

1074 
	`š™SticSŒšgObjeù
(
key
,
key¡r
);

1076 
expœ‘ime
 = 
	`g‘Expœe
(
db
,&
key
);

1079 ià(
expœ‘ime
 !ğ-1 &&ƒxpœ‘im< 
now
) ;

1082 ià(
o
->
ty³
 =ğ
OBJ_STRING
) {

1084 
cmd
[]="*3\r\n$3\r\nSET\r\n";

1085 ià(
	`rioWr™e
(
aof
,
cmd
,(cmd)-1è=ğ0è
w”r
;

1087 ià(
	`rioWr™eBulkObjeù
(
aof
,&
key
è=ğ0è
w”r
;

1088 ià(
	`rioWr™eBulkObjeù
(
aof
,
o
è=ğ0è
w”r
;

1089 } ià(
o
->
ty³
 =ğ
OBJ_LIST
) {

1090 ià(
	`»wr™eLi¡Objeù
(
aof
,&
key
,
o
è=ğ0è
w”r
;

1091 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

1092 ià(
	`»wr™eS‘Objeù
(
aof
,&
key
,
o
è=ğ0è
w”r
;

1093 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

1094 ià(
	`»wr™eSÜ‹dS‘Objeù
(
aof
,&
key
,
o
è=ğ0è
w”r
;

1095 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

1096 ià(
	`»wr™eHashObjeù
(
aof
,&
key
,
o
è=ğ0è
w”r
;

1097 } ià(
o
->
ty³
 =ğ
OBJ_MODULE
) {

1098 ià(
	`»wr™eModuËObjeù
(
aof
,&
key
,
o
è=ğ0è
w”r
;

1100 
	`£rv”Pªic
("Unknown objectype");

1103 ià(
expœ‘ime
 != -1) {

1104 
cmd
[]="*3\r\n$9\r\nPEXPIREAT\r\n";

1105 ià(
	`rioWr™e
(
aof
,
cmd
,(cmd)-1è=ğ0è
w”r
;

1106 ià(
	`rioWr™eBulkObjeù
(
aof
,&
key
è=ğ0è
w”r
;

1107 ià(
	`rioWr™eBulkLÚgLÚg
(
aof
,
expœ‘ime
è=ğ0è
w”r
;

1110 ià(
aof
->
´oûs£d_by‹s
 > 
´oûs£d
+
AOF_READ_DIFF_INTERVAL_BYTES
) {

1111 
´oûs£d
 = 
aof
->
´oûs£d_by‹s
;

1112 
	`aofR—dDiffFromP¬’t
();

1115 
	`diùR–—£I‹¿tÜ
(
di
);

1116 
di
 = 
NULL
;

1118  
C_OK
;

1120 
w”r
:

1121 ià(
di
è
	`diùR–—£I‹¿tÜ
(di);

1122  
C_ERR
;

1123 
	}
}

1132 
	$»wr™eAµ’dOÆyFe
(*
f’ame
) {

1133 
rio
 
aof
;

1134 
FILE
 *
å
;

1135 
tmpfe
[256];

1136 
by‹
;

1140 
	`¢´štf
(
tmpfe
,256,"‹mp-»wr™—of-%d.aof", (è
	`g‘pid
());

1141 
å
 = 
	`fİ’
(
tmpfe
,"w");

1142 ià(!
å
) {

1143 
	`£rv”Log
(
LL_WARNING
, "O³nšgh‹m°ffÜ AOF„ewr™š„ewr™eAµ’dOÆyFe(): %s", 
	`¡»¼Ü
(
”ºo
));

1144  
C_ERR
;

1147 
£rv”
.
aof_chd_diff
 = 
	`sd£m±y
();

1148 
	`rioIn™W™hFe
(&
aof
,
å
);

1150 ià(
£rv”
.
aof_»wr™e_šüem’l_fsync
)

1151 
	`rioS‘AutoSync
(&
aof
,
AOF_AUTOSYNC_BYTES
);

1153 ià(
£rv”
.
aof_u£_rdb_´—mbË
) {

1154 
”rÜ
;

1155 ià(
	`rdbSaveRio
(&
aof
,&
”rÜ
,
RDB_SAVE_AOF_PREAMBLE
è=ğ
C_ERR
) {

1156 
”ºo
 = 
”rÜ
;

1157 
w”r
;

1160 ià(
	`»wr™eAµ’dOÆyFeRio
(&
aof
è=ğ
C_ERR
è
w”r
;

1165 ià(
	`fæush
(
å
è=ğ
EOF
è
w”r
;

1166 ià(
	`fsync
(
	`f’o
(
å
)è=ğ-1è
w”r
;

1174 
nod©a
 = 0;

1175 
m¡ime_t
 
¡¬t
 = 
	`m¡ime
();

1176 
	`m¡ime
()-
¡¬t
 < 1000 && 
nod©a
 < 20) {

1177 ià(
	`«Wa™
(
£rv”
.
aof_pe_»ad_d©a_äom_·»Á
, 
AE_READABLE
, 1) <= 0)

1179 
nod©a
++;

1182 
nod©a
 = 0;

1184 
	`aofR—dDiffFromP¬’t
();

1188 ià(
	`wr™e
(
£rv”
.
aof_pe_wr™e_ack_to_·»Á
,"!",1è!ğ1è
w”r
;

1189 ià(
	`ª‘NÚBlock
(
NULL
,
£rv”
.
aof_pe_»ad_ack_äom_·»Á
è!ğ
ANET_OK
)

1190 
w”r
;

1194 ià(
	`syncR—d
(
£rv”
.
aof_pe_»ad_ack_äom_·»Á
,&
by‹
,1,5000) != 1 ||

1195 
by‹
 !ğ'!'è
w”r
;

1196 
	`£rv”Log
(
LL_NOTICE
,"Parent‡greedo stop sending diffs. Finalizing AOF...");

1199 
	`aofR—dDiffFromP¬’t
();

1202 
	`£rv”Log
(
LL_NOTICE
,

1204 (è
	`sd¦’
(
£rv”
.
aof_chd_diff
) / (1024*1024));

1205 ià(
	`rioWr™e
(&
aof
,
£rv”
.
aof_chd_diff
,
	`sd¦’
(server.aof_child_diff)) == 0)

1206 
w”r
;

1209 ià(
	`fæush
(
å
è=ğ
EOF
è
w”r
;

1210 ià(
	`fsync
(
	`f’o
(
å
)è=ğ-1è
w”r
;

1211 ià(
	`fşo£
(
å
è=ğ
EOF
è
w”r
;

1215 ià(
	`»Çme
(
tmpfe
,
f’ame
) == -1) {

1216 
	`£rv”Log
(
LL_WARNING
,"E¼Ü movšgem°­³nd oÆy fÚhfš® de¡š©iÚ: %s", 
	`¡»¼Ü
(
”ºo
));

1217 
	`uÆšk
(
tmpfe
);

1218  
C_ERR
;

1220 
	`£rv”Log
(
LL_NOTICE
,"SYNC‡ppend only file„ewrite…erformed");

1221  
C_OK
;

1223 
w”r
:

1224 
	`£rv”Log
(
LL_WARNING
,"Wr™”rÜ wr™šg‡µ’d oÆy fÚ disk: %s", 
	`¡»¼Ü
(
”ºo
));

1225 
	`fşo£
(
å
);

1226 
	`uÆšk
(
tmpfe
);

1227  
C_ERR
;

1228 
	}
}

1237 
	$aofChdPeR—dabË
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

1238 
by‹
;

1239 
	`UNUSED
(
–
);

1240 
	`UNUSED
(
´ivd©a
);

1241 
	`UNUSED
(
mask
);

1243 ià(
	`»ad
(
fd
,&
by‹
,1) == 1 && byte == '!') {

1244 
	`£rv”Log
(
LL_NOTICE
,"AOF„ewrite child‡skso stop sending diffs.");

1245 
£rv”
.
aof_¡İ_£ndšg_diff
 = 1;

1246 ià(
	`wr™e
(
£rv”
.
aof_pe_wr™e_ack_to_chd
,"!",1) != 1) {

1251 
	`£rv”Log
(
LL_WARNING
,"Can't send ACKo AOF child: %s",

1252 
	`¡»¼Ü
(
”ºo
));

1257 
	`«D–‘eFeEv’t
(
£rv”
.
–
,£rv”.
aof_pe_»ad_ack_äom_chd
,
AE_READABLE
);

1258 
	}
}

1265 
	$aofC»©ePes
() {

1266 
fds
[6] = {-1, -1, -1, -1, -1, -1};

1267 
j
;

1269 ià(
	`pe
(
fds
è=ğ-1è
”rÜ
;

1270 ià(
	`pe
(
fds
+2è=ğ-1è
”rÜ
;

1271 ià(
	`pe
(
fds
+4è=ğ-1è
”rÜ
;

1273 ià(
	`ª‘NÚBlock
(
NULL
,
fds
[0]è!ğ
ANET_OK
è
”rÜ
;

1274 ià(
	`ª‘NÚBlock
(
NULL
,
fds
[1]è!ğ
ANET_OK
è
”rÜ
;

1275 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, 
fds
[2], 
AE_READABLE
, 
aofChdPeR—dabË
, 
NULL
è=ğ
AE_ERR
è
”rÜ
;

1277 
£rv”
.
aof_pe_wr™e_d©a_to_chd
 = 
fds
[1];

1278 
£rv”
.
aof_pe_»ad_d©a_äom_·»Á
 = 
fds
[0];

1279 
£rv”
.
aof_pe_wr™e_ack_to_·»Á
 = 
fds
[3];

1280 
£rv”
.
aof_pe_»ad_ack_äom_chd
 = 
fds
[2];

1281 
£rv”
.
aof_pe_wr™e_ack_to_chd
 = 
fds
[5];

1282 
£rv”
.
aof_pe_»ad_ack_äom_·»Á
 = 
fds
[4];

1283 
£rv”
.
aof_¡İ_£ndšg_diff
 = 0;

1284  
C_OK
;

1286 
”rÜ
:

1287 
	`£rv”Log
(
LL_WARNING
,"Error opening /setting AOF„ewrite IPC…ipes: %s",

1288 
	`¡»¼Ü
(
”ºo
));

1289 
j
 = 0; j < 6; j++èif(
fds
[j] !ğ-1è
	`şo£
(fds[j]);

1290  
C_ERR
;

1291 
	}
}

1293 
	$aofClo£Pes
() {

1294 
	`«D–‘eFeEv’t
(
£rv”
.
–
,£rv”.
aof_pe_»ad_ack_äom_chd
,
AE_READABLE
);

1295 
	`«D–‘eFeEv’t
(
£rv”
.
–
,£rv”.
aof_pe_wr™e_d©a_to_chd
,
AE_WRITABLE
);

1296 
	`şo£
(
£rv”
.
aof_pe_wr™e_d©a_to_chd
);

1297 
	`şo£
(
£rv”
.
aof_pe_»ad_d©a_äom_·»Á
);

1298 
	`şo£
(
£rv”
.
aof_pe_wr™e_ack_to_·»Á
);

1299 
	`şo£
(
£rv”
.
aof_pe_»ad_ack_äom_chd
);

1300 
	`şo£
(
£rv”
.
aof_pe_wr™e_ack_to_chd
);

1301 
	`şo£
(
£rv”
.
aof_pe_»ad_ack_äom_·»Á
);

1302 
	}
}

1320 
	$»wr™eAµ’dOÆyFeBackground
() {

1321 
pid_t
 
chdpid
;

1322 
¡¬t
;

1324 ià(
£rv”
.
aof_chd_pid
 !ğ-1 || s”v”.
rdb_chd_pid
 !ğ-1è 
C_ERR
;

1325 ià(
	`aofC»©ePes
(è!ğ
C_OK
è 
C_ERR
;

1326 
	`İ’ChdInfoPe
();

1327 
¡¬t
 = 
	`u¡ime
();

1328 ià((
chdpid
 = 
	`fÜk
()) == 0) {

1329 
tmpfe
[256];

1332 
	`şo£Li¡’šgSock‘s
(0);

1333 
	`»disS‘ProcT™Ë
("redis-aof-rewrite");

1334 
	`¢´štf
(
tmpfe
,256,"‹mp-»wr™—of-bg-%d.aof", (è
	`g‘pid
());

1335 ià(
	`»wr™eAµ’dOÆyFe
(
tmpfe
è=ğ
C_OK
) {

1336 
size_t
 
´iv©e_dœty
 = 
	`zm®loc_g‘_´iv©e_dœty
(-1);

1338 ià(
´iv©e_dœty
) {

1339 
	`£rv”Log
(
LL_NOTICE
,

1341 
´iv©e_dœty
/(1024*1024));

1344 
£rv”
.
chd_šfo_d©a
.
cow_size
 = 
´iv©e_dœty
;

1345 
	`£ndChdInfo
(
CHILD_INFO_TYPE_AOF
);

1346 
	`ex™FromChd
(0);

1348 
	`ex™FromChd
(1);

1352 
£rv”
.
¡©_fÜk_time
 = 
	`u¡ime
()-
¡¬t
;

1353 
£rv”
.
¡©_fÜk_¿‹
 = (è
	`zm®loc_u£d_memÜy
(è* 1000000 / s”v”.
¡©_fÜk_time
 / (1024*1024*1024);

1354 
	`Ï‹ncyAddSam¶eIfN“ded
("fÜk",
£rv”
.
¡©_fÜk_time
/1000);

1355 ià(
chdpid
 == -1) {

1356 
	`şo£ChdInfoPe
();

1357 
	`£rv”Log
(
LL_WARNING
,

1359 
	`¡»¼Ü
(
”ºo
));

1360  
C_ERR
;

1362 
	`£rv”Log
(
LL_NOTICE
,

1363 "Background‡µ’d oÆy f»wr™šg s¹ed by…id %d",
chdpid
);

1364 
£rv”
.
aof_»wr™e_scheduËd
 = 0;

1365 
£rv”
.
aof_»wr™e_time_¡¬t
 = 
	`time
(
NULL
);

1366 
£rv”
.
aof_chd_pid
 = 
chdpid
;

1367 
	`upd©eDiùResizePŞicy
();

1372 
£rv”
.
aof_£Ëùed_db
 = -1;

1373 
	`»¶iÿtiÚSütCacheFlush
();

1374  
C_OK
;

1376  
C_OK
;

1377 
	}
}

1379 
	$bg»wr™—ofCommªd
(
ş›Á
 *
c
) {

1380 ià(
£rv”
.
aof_chd_pid
 != -1) {

1381 
	`addR•lyE¼Ü
(
c
,"Background‡ppend only file„ewriting‡lready in…rogress");

1382 } ià(
£rv”
.
rdb_chd_pid
 != -1) {

1383 
£rv”
.
aof_»wr™e_scheduËd
 = 1;

1384 
	`addR•lyStus
(
c
,"Background‡ppend only file„ewriting scheduled");

1385 } ià(
	`»wr™eAµ’dOÆyFeBackground
(è=ğ
C_OK
) {

1386 
	`addR•lyStus
(
c
,"Background‡ppend only file„ewriting started");

1388 
	`addR•ly
(
c
,
sh¬ed
.
”r
);

1390 
	}
}

1392 
	$aofRemoveTempFe
(
pid_t
 
chdpid
) {

1393 
tmpfe
[256];

1395 
	`¢´štf
(
tmpfe
,256,"‹mp-»wr™—of-bg-%d.aof", (è
chdpid
);

1396 
	`uÆšk
(
tmpfe
);

1397 
	}
}

1403 
	$aofUpd©eCu¼’tSize
() {

1404 
»dis_¡©
 
sb
;

1405 
m¡ime_t
 
Ï‹ncy
;

1407 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

1408 ià(
	`»dis_f¡©
(
£rv”
.
aof_fd
,&
sb
) == -1) {

1409 
	`£rv”Log
(
LL_WARNING
,"Unableo obtainhe AOF file†ength. stat: %s",

1410 
	`¡»¼Ü
(
”ºo
));

1412 
£rv”
.
aof_cu¼’t_size
 = 
sb
.
¡_size
;

1414 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

1415 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-f¡©",
Ï‹ncy
);

1416 
	}
}

1420 
	$backgroundRewr™eDÚeHªdËr
(
ex™code
, 
bysigÇl
) {

1421 ià(!
bysigÇl
 && 
ex™code
 == 0) {

1422 
Ãwfd
, 
Şdfd
;

1423 
tmpfe
[256];

1424 
now
 = 
	`u¡ime
();

1425 
m¡ime_t
 
Ï‹ncy
;

1427 
	`£rv”Log
(
LL_NOTICE
,

1432 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

1433 
	`¢´štf
(
tmpfe
,256,"temp-rewriteaof-bg-%d.aof",

1434 ()
£rv”
.
aof_chd_pid
);

1435 
Ãwfd
 = 
	`İ’
(
tmpfe
,
O_WRONLY
|
O_APPEND
);

1436 ià(
Ãwfd
 == -1) {

1437 
	`£rv”Log
(
LL_WARNING
,

1438 "UÇbËØİ’h‹mpÜ¬y AOF…roduûd byhchd: %s", 
	`¡»¼Ü
(
”ºo
));

1439 
ş—nup
;

1442 ià(
	`aofRewr™eBufãrWr™e
(
Ãwfd
) == -1) {

1443 
	`£rv”Log
(
LL_WARNING
,

1444 "E¼ÜryšgØæushh·»Á difàtØth»wr™‹ÀAOF: %s", 
	`¡»¼Ü
(
”ºo
));

1445 
	`şo£
(
Ãwfd
);

1446 
ş—nup
;

1448 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

1449 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-»wr™e-diff-wr™e",
Ï‹ncy
);

1451 
	`£rv”Log
(
LL_NOTICE
,

1452 "Residu®…¬’ˆdifàsucûssfuÎy flushedØth»wr™‹ÀAOF (%.2àMB)", (è
	`aofRewr™eBufãrSize
() / (1024*1024));

1481 ià(
£rv”
.
aof_fd
 == -1) {

1487 
Şdfd
 = 
	`İ’
(
£rv”
.
aof_f’ame
,
O_RDONLY
|
O_NONBLOCK
);

1490 
Şdfd
 = -1;

1495 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

1496 ià(
	`»Çme
(
tmpfe
,
£rv”
.
aof_f’ame
) == -1) {

1497 
	`£rv”Log
(
LL_WARNING
,

1499 
tmpfe
,

1500 
£rv”
.
aof_f’ame
,

1501 
	`¡»¼Ü
(
”ºo
));

1502 
	`şo£
(
Ãwfd
);

1503 ià(
Şdfd
 !ğ-1è
	`şo£
(oldfd);

1504 
ş—nup
;

1506 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

1507 
	`Ï‹ncyAddSam¶eIfN“ded
("aof-»Çme",
Ï‹ncy
);

1509 ià(
£rv”
.
aof_fd
 == -1) {

1512 
	`şo£
(
Ãwfd
);

1515 
Şdfd
 = 
£rv”
.
aof_fd
;

1516 
£rv”
.
aof_fd
 = 
Ãwfd
;

1517 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_ALWAYS
)

1518 
	`aof_fsync
(
Ãwfd
);

1519 ià(
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_EVERYSEC
)

1520 
	`aof_background_fsync
(
Ãwfd
);

1521 
£rv”
.
aof_£Ëùed_db
 = -1;

1522 
	`aofUpd©eCu¼’tSize
();

1523 
£rv”
.
aof_»wr™e_ba£_size
 = s”v”.
aof_cu¼’t_size
;

1527 
	`sdsä“
(
£rv”
.
aof_buf
);

1528 
£rv”
.
aof_buf
 = 
	`sd£m±y
();

1531 
£rv”
.
aof_Ï¡bg»wr™e_¡©us
 = 
C_OK
;

1533 
	`£rv”Log
(
LL_NOTICE
, "Background AOF„ewrite finished successfully");

1535 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_WAIT_REWRITE
)

1536 
£rv”
.
aof_¡©e
 = 
AOF_ON
;

1539 ià(
Şdfd
 !ğ-1è
	`bioC»©eBackgroundJob
(
BIO_CLOSE_FILE
,(*)()Şdfd,
NULL
,NULL);

1541 
	`£rv”Log
(
LL_VERBOSE
,

1542 "Background AOF„ewr™sigÇÈhªdË¸took %Îdus", 
	`u¡ime
()-
now
);

1543 } ià(!
bysigÇl
 && 
ex™code
 != 0) {

1546 ià(
bysigÇl
 !ğ
SIGUSR1
)

1547 
£rv”
.
aof_Ï¡bg»wr™e_¡©us
 = 
C_ERR
;

1548 
	`£rv”Log
(
LL_WARNING
,

1551 
£rv”
.
aof_Ï¡bg»wr™e_¡©us
 = 
C_ERR
;

1553 
	`£rv”Log
(
LL_WARNING
,

1554 "Background AOF„ewr™‹rmš©ed by sigÇÈ%d", 
bysigÇl
);

1557 
ş—nup
:

1558 
	`aofClo£Pes
();

1559 
	`aofRewr™eBufãrRe£t
();

1560 
	`aofRemoveTempFe
(
£rv”
.
aof_chd_pid
);

1561 
£rv”
.
aof_chd_pid
 = -1;

1562 
£rv”
.
aof_»wr™e_time_Ï¡
 = 
	`time
(
NULL
)-£rv”.
aof_»wr™e_time_¡¬t
;

1563 
£rv”
.
aof_»wr™e_time_¡¬t
 = -1;

1565 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_WAIT_REWRITE
)

1566 
£rv”
.
aof_»wr™e_scheduËd
 = 1;

1567 
	}
}

	@asciilogo.h

30 *
	gascii_logo
 =

	@atomicvar.h

49 
	~<±h»ad.h
>

51 #iâdeà
__ATOMIC_VAR_H


52 
	#__ATOMIC_VAR_H


	)

54 #ià
defšed
(
__ATOMIC_RELAXED
)

57 
	#©omicInü
(
v¬
,
couÁ
,
mu‹x
è
	`__©omic_add_ãtch
(&v¬,(couÁ),
__ATOMIC_RELAXED
)

	)

58 
	#©omicDeü
(
v¬
,
couÁ
,
mu‹x
è
	`__©omic_sub_ãtch
(&v¬,(couÁ),
__ATOMIC_RELAXED
)

	)

59 
	#©omicG‘
(
v¬
,
d¡v¬
,
mu‹x
) do { \

60 
d¡v¬
 = 
	`__©omic_lßd_n
(&
v¬
,
__ATOMIC_RELAXED
); \

61 } 0)

	)

63 #–ià
defšed
(
HAVE_ATOMIC
)

66 
	#©omicInü
(
v¬
,
couÁ
,
mu‹x
è
	`__sync_add_ªd_ãtch
(&v¬,(couÁ))

	)

67 
	#©omicDeü
(
v¬
,
couÁ
,
mu‹x
è
	`__sync_sub_ªd_ãtch
(&v¬,(couÁ))

	)

68 
	#©omicG‘
(
v¬
,
d¡v¬
,
mu‹x
) do { \

69 
d¡v¬
 = 
	`__sync_sub_ªd_ãtch
(&
v¬
,0); \

70 } 0)

	)

75 
	#©omicInü
(
v¬
,
couÁ
,
mu‹x
) do { \

76 
	`±h»ad_mu‹x_lock
(&
mu‹x
); \

77 
v¬
 +ğ(
couÁ
); \

78 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
); \

79 } 0)

	)

81 
	#©omicDeü
(
v¬
,
couÁ
,
mu‹x
) do { \

82 
	`±h»ad_mu‹x_lock
(&
mu‹x
); \

83 
v¬
 -ğ(
couÁ
); \

84 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
); \

85 } 0)

	)

87 
	#©omicG‘
(
v¬
,
d¡v¬
,
mu‹x
) do { \

88 
	`±h»ad_mu‹x_lock
(&
mu‹x
); \

89 
d¡v¬
 = 
v¬
; \

90 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
); \

91 } 0)

	)

	@bio.c

61 
	~"£rv”.h
"

62 
	~"bio.h
"

64 
±h»ad_t
 
	gbio_th»ads
[
BIO_NUM_OPS
];

65 
±h»ad_mu‹x_t
 
	gbio_mu‹x
[
BIO_NUM_OPS
];

66 
±h»ad_cÚd_t
 
	gbio_Ãwjob_cÚd
[
BIO_NUM_OPS
];

67 
±h»ad_cÚd_t
 
	gbio_¡•_cÚd
[
BIO_NUM_OPS
];

68 
li¡
 *
	gbio_jobs
[
BIO_NUM_OPS
];

75 
	gbio_³ndšg
[
BIO_NUM_OPS
];

79 
	sbio_job
 {

80 
time_t
 
	mtime
;

83 *
	m¬g1
, *
	m¬g2
, *
	m¬g3
;

86 *
bioProûssBackgroundJobs
(*
¬g
);

87 
Ïzyä“F»eObjeùFromBioTh»ad
(
robj
 *
o
);

88 
Ïzyä“F»eD©aba£FromBioTh»ad
(
diù
 *
ht1
, diù *
ht2
);

89 
Ïzyä“F»eSlÙsM­FromBioTh»ad
(
zskli¡
 *
¦
);

93 
	#REDIS_THREAD_STACK_SIZE
 (1024*1024*4)

	)

96 
	$bioIn™
() {

97 
±h»ad_©Œ_t
 
©Œ
;

98 
±h»ad_t
 
th»ad
;

99 
size_t
 
¡acksize
;

100 
j
;

103 
j
 = 0; j < 
BIO_NUM_OPS
; j++) {

104 
	`±h»ad_mu‹x_š™
(&
bio_mu‹x
[
j
],
NULL
);

105 
	`±h»ad_cÚd_š™
(&
bio_Ãwjob_cÚd
[
j
],
NULL
);

106 
	`±h»ad_cÚd_š™
(&
bio_¡•_cÚd
[
j
],
NULL
);

107 
bio_jobs
[
j
] = 
	`li¡C»©e
();

108 
bio_³ndšg
[
j
] = 0;

112 
	`±h»ad_©Œ_š™
(&
©Œ
);

113 
	`±h»ad_©Œ_g‘¡acksize
(&
©Œ
,&
¡acksize
);

114 ià(!
¡acksize
) stacksize = 1;

115 
¡acksize
 < 
REDIS_THREAD_STACK_SIZE
) stacksize *= 2;

116 
	`±h»ad_©Œ_£t¡acksize
(&
©Œ
, 
¡acksize
);

121 
j
 = 0; j < 
BIO_NUM_OPS
; j++) {

122 *
¬g
 = (*)(è
j
;

123 ià(
	`±h»ad_ü—‹
(&
th»ad
,&
©Œ
,
bioProûssBackgroundJobs
,
¬g
) != 0) {

124 
	`£rv”Log
(
LL_WARNING
,"Fatal: Can't initialize Background Jobs.");

125 
	`ex™
(1);

127 
bio_th»ads
[
j
] = 
th»ad
;

129 
	}
}

131 
	$bioC»©eBackgroundJob
(
ty³
, *
¬g1
, *
¬g2
, *
¬g3
) {

132 
bio_job
 *
job
 = 
	`zm®loc
((*job));

134 
job
->
time
 = 
	`time
(
NULL
);

135 
job
->
¬g1
 =‡rg1;

136 
job
->
¬g2
 =‡rg2;

137 
job
->
¬g3
 =‡rg3;

138 
	`±h»ad_mu‹x_lock
(&
bio_mu‹x
[
ty³
]);

139 
	`li¡AddNodeTa
(
bio_jobs
[
ty³
],
job
);

140 
bio_³ndšg
[
ty³
]++;

141 
	`±h»ad_cÚd_sigÇl
(&
bio_Ãwjob_cÚd
[
ty³
]);

142 
	`±h»ad_mu‹x_uÆock
(&
bio_mu‹x
[
ty³
]);

143 
	}
}

145 *
	$bioProûssBackgroundJobs
(*
¬g
) {

146 
bio_job
 *
job
;

147 
ty³
 = (è
¬g
;

148 
sig£t_t
 
sig£t
;

151 ià(
ty³
 >ğ
BIO_NUM_OPS
) {

152 
	`£rv”Log
(
LL_WARNING
,

153 "W¬nšg: biØth»ad s¹ed w™h wrÚgy³ %lu",
ty³
);

154  
NULL
;

159 
	`±h»ad_£tÿnûl¡©e
(
PTHREAD_CANCEL_ENABLE
, 
NULL
);

160 
	`±h»ad_£tÿnûÉy³
(
PTHREAD_CANCEL_ASYNCHRONOUS
, 
NULL
);

162 
	`±h»ad_mu‹x_lock
(&
bio_mu‹x
[
ty³
]);

165 
	`sigem±y£t
(&
sig£t
);

166 
	`sigadd£t
(&
sig£t
, 
SIGALRM
);

167 ià(
	`±h»ad_sigmask
(
SIG_BLOCK
, &
sig£t
, 
NULL
))

168 
	`£rv”Log
(
LL_WARNING
,

169 "W¬nšg: cª'ˆmask SIGALRM iÀbio.øth»ad: %s", 
	`¡»¼Ü
(
”ºo
));

172 
li¡Node
 *
Ê
;

175 ià(
	`li¡L’gth
(
bio_jobs
[
ty³
]) == 0) {

176 
	`±h»ad_cÚd_wa™
(&
bio_Ãwjob_cÚd
[
ty³
],&
bio_mu‹x
[type]);

180 
Ê
 = 
	`li¡Fœ¡
(
bio_jobs
[
ty³
]);

181 
job
 = 
Ê
->
v®ue
;

184 
	`±h»ad_mu‹x_uÆock
(&
bio_mu‹x
[
ty³
]);

187 ià(
ty³
 =ğ
BIO_CLOSE_FILE
) {

188 
	`şo£
(()
job
->
¬g1
);

189 } ià(
ty³
 =ğ
BIO_AOF_FSYNC
) {

190 
	`aof_fsync
(()
job
->
¬g1
);

191 } ià(
ty³
 =ğ
BIO_LAZY_FREE
) {

196 ià(
job
->
¬g1
)

197 
	`Ïzyä“F»eObjeùFromBioTh»ad
(
job
->
¬g1
);

198 ià(
job
->
¬g2
 && job->
¬g3
)

199 
	`Ïzyä“F»eD©aba£FromBioTh»ad
(
job
->
¬g2
,job->
¬g3
);

200 ià(
job
->
¬g3
)

201 
	`Ïzyä“F»eSlÙsM­FromBioTh»ad
(
job
->
¬g3
);

203 
	`£rv”Pªic
("Wrong jobype in bioProcessBackgroundJobs().");

205 
	`zä“
(
job
);

208 
	`±h»ad_cÚd_brßdÿ¡
(&
bio_¡•_cÚd
[
ty³
]);

212 
	`±h»ad_mu‹x_lock
(&
bio_mu‹x
[
ty³
]);

213 
	`li¡D–Node
(
bio_jobs
[
ty³
],
Ê
);

214 
bio_³ndšg
[
ty³
]--;

216 
	}
}

219 
	$bioP’dšgJobsOfTy³
(
ty³
) {

220 
v®
;

221 
	`±h»ad_mu‹x_lock
(&
bio_mu‹x
[
ty³
]);

222 
v®
 = 
bio_³ndšg
[
ty³
];

223 
	`±h»ad_mu‹x_uÆock
(&
bio_mu‹x
[
ty³
]);

224  
v®
;

225 
	}
}

237 
	$bioWa™S‹pOfTy³
(
ty³
) {

238 
v®
;

239 
	`±h»ad_mu‹x_lock
(&
bio_mu‹x
[
ty³
]);

240 
v®
 = 
bio_³ndšg
[
ty³
];

241 ià(
v®
 != 0) {

242 
	`±h»ad_cÚd_wa™
(&
bio_¡•_cÚd
[
ty³
],&
bio_mu‹x
[type]);

243 
v®
 = 
bio_³ndšg
[
ty³
];

245 
	`±h»ad_mu‹x_uÆock
(&
bio_mu‹x
[
ty³
]);

246  
v®
;

247 
	}
}

253 
	$bioKlTh»ads
() {

254 
”r
, 
j
;

256 
j
 = 0; j < 
BIO_NUM_OPS
; j++) {

257 ià(
	`±h»ad_ÿnûl
(
bio_th»ads
[
j
]) == 0) {

258 ià((
”r
 = 
	`±h»ad_još
(
bio_th»ads
[
j
],
NULL
)) != 0) {

259 
	`£rv”Log
(
LL_WARNING
,

261 
j
, 
	`¡»¼Ü
(
”r
));

263 
	`£rv”Log
(
LL_WARNING
,

264 "BiØth»ad fÜ joby³ #%d”mš©ed",
j
);

268 
	}
}

	@bio.h

31 
bioIn™
();

32 
bioC»©eBackgroundJob
(
ty³
, *
¬g1
, *
¬g2
, *
¬g3
);

33 
bioP’dšgJobsOfTy³
(
ty³
);

34 
bioWa™S‹pOfTy³
(
ty³
);

35 
time_t
 
bioOld”JobOfTy³
(
ty³
);

36 
bioKlTh»ads
();

39 
	#BIO_CLOSE_FILE
 0

	)

40 
	#BIO_AOF_FSYNC
 1

	)

41 
	#BIO_LAZY_FREE
 2

	)

42 
	#BIO_NUM_OPS
 3

	)

	@bitops.c

31 
	~"£rv”.h
"

40 
size_t
 
	$»disPİcouÁ
(*
s
, 
couÁ
) {

41 
size_t
 
b™s
 = 0;

42 *
p
 = 
s
;

43 
ušt32_t
 *
p4
;

44 cÚ¡ 
b™sšby‹
[256] = {0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8};

47 ()
p
 & 3 && 
couÁ
) {

48 
b™s
 +ğ
b™sšby‹
[*
p
++];

49 
couÁ
--;

53 
p4
 = (
ušt32_t
*)
p
;

54 
couÁ
>=28) {

55 
ušt32_t
 
aux1
, 
aux2
, 
aux3
, 
aux4
, 
aux5
, 
aux6
, 
aux7
;

57 
aux1
 = *
p4
++;

58 
aux2
 = *
p4
++;

59 
aux3
 = *
p4
++;

60 
aux4
 = *
p4
++;

61 
aux5
 = *
p4
++;

62 
aux6
 = *
p4
++;

63 
aux7
 = *
p4
++;

64 
couÁ
 -= 28;

66 
aux1
 =‡ux1 - ((aux1 >> 1) & 0x55555555);

67 
aux1
 = (aux1 & 0x33333333) + ((aux1 >> 2) & 0x33333333);

68 
aux2
 =‡ux2 - ((aux2 >> 1) & 0x55555555);

69 
aux2
 = (aux2 & 0x33333333) + ((aux2 >> 2) & 0x33333333);

70 
aux3
 =‡ux3 - ((aux3 >> 1) & 0x55555555);

71 
aux3
 = (aux3 & 0x33333333) + ((aux3 >> 2) & 0x33333333);

72 
aux4
 =‡ux4 - ((aux4 >> 1) & 0x55555555);

73 
aux4
 = (aux4 & 0x33333333) + ((aux4 >> 2) & 0x33333333);

74 
aux5
 =‡ux5 - ((aux5 >> 1) & 0x55555555);

75 
aux5
 = (aux5 & 0x33333333) + ((aux5 >> 2) & 0x33333333);

76 
aux6
 =‡ux6 - ((aux6 >> 1) & 0x55555555);

77 
aux6
 = (aux6 & 0x33333333) + ((aux6 >> 2) & 0x33333333);

78 
aux7
 =‡ux7 - ((aux7 >> 1) & 0x55555555);

79 
aux7
 = (aux7 & 0x33333333) + ((aux7 >> 2) & 0x33333333);

80 
b™s
 +ğ((((
aux1
 + (aux1 >> 4)) & 0x0F0F0F0F) +

81 ((
aux2
 + (aux2 >> 4)) & 0x0F0F0F0F) +

82 ((
aux3
 + (aux3 >> 4)) & 0x0F0F0F0F) +

83 ((
aux4
 + (aux4 >> 4)) & 0x0F0F0F0F) +

84 ((
aux5
 + (aux5 >> 4)) & 0x0F0F0F0F) +

85 ((
aux6
 + (aux6 >> 4)) & 0x0F0F0F0F) +

86 ((
aux7
 + (aux7 >> 4)) & 0x0F0F0F0F))* 0x01010101) >> 24;

89 
p
 = (*)
p4
;

90 
couÁ
--è
b™s
 +ğ
b™sšby‹
[*
p
++];

91  
b™s
;

92 
	}
}

101 
	$»disB™pos
(*
s
, 
couÁ
, 
b™
) {

102 *
l
;

103 *
c
;

104 
skv®
, 
wÜd
 = 0, 
Úe
;

105 
pos
 = 0;

106 
j
;

118 
skv®
 = 
b™
 ? 0 : 
UCHAR_MAX
;

119 
c
 = (*è
s
;

120 ()
c
 & ((*
l
)-1è&& 
couÁ
) {

121 ià(*
c
 !ğ
skv®
) ;

122 
c
++;

123 
couÁ
--;

124 
pos
 += 8;

128 
skv®
 = 
b™
 ? 0 : 
ULONG_MAX
;

129 
l
 = (*è
c
;

130 
couÁ
 >ğ(*
l
)) {

131 ià(*
l
 !ğ
skv®
) ;

132 
l
++;

133 
couÁ
 -ğ(*
l
);

134 
pos
 +ğ(*
l
)*8;

144 
c
 = (*)
l
;

145 
j
 = 0; j < (*
l
); j++) {

146 
wÜd
 <<= 8;

147 ià(
couÁ
) {

148 
wÜd
 |ğ*
c
;

149 
c
++;

150 
couÁ
--;

159 ià(
b™
 =ğ1 && 
wÜd
 == 0)  -1;

165 
Úe
 = 
ULONG_MAX
;

166 
Úe
 >>= 1;

167 
Úe
 = ~one;

169 
Úe
) {

170 ià(((
Úe
 & 
wÜd
è!ğ0è=ğ
b™
è 
pos
;

171 
pos
++;

172 
Úe
 >>= 1;

177 
	`£rv”Pªic
("End of„edisBitpos()„eached.");

179 
	}
}

202 
	$£tUnsigÃdB™f›ld
(*
p
, 
ušt64_t
 
off£t
, ušt64_ˆ
b™s
, ušt64_ˆ
v®ue
) {

203 
ušt64_t
 
by‹
, 
b™
, 
by‹v®
, 
b™v®
, 
j
;

205 
j
 = 0; j < 
b™s
; j++) {

206 
b™v®
 = (
v®ue
 & ((
ušt64_t
)1<<(
b™s
-1-
j
))) != 0;

207 
by‹
 = 
off£t
 >> 3;

208 
b™
 = 7 - (
off£t
 & 0x7);

209 
by‹v®
 = 
p
[
by‹
];

210 
by‹v®
 &ğ~(1 << 
b™
);

211 
by‹v®
 |ğ
b™v®
 << 
b™
;

212 
p
[
by‹
] = 
by‹v®
 & 0xff;

213 
off£t
++;

215 
	}
}

217 
	$£tSigÃdB™f›ld
(*
p
, 
ušt64_t
 
off£t
, ušt64_ˆ
b™s
, 
št64_t
 
v®ue
) {

218 
ušt64_t
 
uv
 = 
v®ue
;

219 
	`£tUnsigÃdB™f›ld
(
p
,
off£t
,
b™s
,
uv
);

220 
	}
}

222 
ušt64_t
 
	$g‘UnsigÃdB™f›ld
(*
p
, 
ušt64_t
 
off£t
, ušt64_ˆ
b™s
) {

223 
ušt64_t
 
by‹
, 
b™
, 
by‹v®
, 
b™v®
, 
j
, 
v®ue
 = 0;

225 
j
 = 0; j < 
b™s
; j++) {

226 
by‹
 = 
off£t
 >> 3;

227 
b™
 = 7 - (
off£t
 & 0x7);

228 
by‹v®
 = 
p
[
by‹
];

229 
b™v®
 = (
by‹v®
 >> 
b™
) & 1;

230 
v®ue
 = (v®ue<<1è| 
b™v®
;

231 
off£t
++;

233  
v®ue
;

234 
	}
}

236 
št64_t
 
	$g‘SigÃdB™f›ld
(*
p
, 
ušt64_t
 
off£t
, ušt64_ˆ
b™s
) {

237 
št64_t
 
v®ue
;

238 uniÚ {
ušt64_t
 
u
; 
št64_t
 
i
;} 
cÚv
;

247 
cÚv
.
u
 = 
	`g‘UnsigÃdB™f›ld
(
p
,
off£t
,
b™s
);

248 
v®ue
 = 
cÚv
.
i
;

253 ià(
v®ue
 & ((
ušt64_t
)1 << (
b™s
-1)))

254 
v®ue
 |ğ((
ušt64_t
)-1è<< 
b™s
;

255  
v®ue
;

256 
	}
}

277 
	#BFOVERFLOW_WRAP
 0

	)

278 
	#BFOVERFLOW_SAT
 1

	)

279 
	#BFOVERFLOW_FAIL
 2

	)

281 
	$checkUnsigÃdB™f›ldOv”æow
(
ušt64_t
 
v®ue
, 
št64_t
 
šü
, ušt64_ˆ
b™s
, 
owty³
, ušt64_ˆ*
lim™
) {

282 
ušt64_t
 
max
 = (
b™s
 =ğ64è? 
UINT64_MAX
 : (((uint64_t)1<<bits)-1);

283 
št64_t
 
maxšü
 = 
max
-
v®ue
;

284 
št64_t
 
mššü
 = -
v®ue
;

286 ià(
v®ue
 > 
max
 || (
šü
 > 0 && inü > 
maxšü
)) {

287 ià(
lim™
) {

288 ià(
owty³
 =ğ
BFOVERFLOW_WRAP
) {

289 
hªdË_w¿p
;

290 } ià(
owty³
 =ğ
BFOVERFLOW_SAT
) {

291 *
lim™
 = 
max
;

295 } ià(
šü
 < 0 && inü < 
mššü
) {

296 ià(
lim™
) {

297 ià(
owty³
 =ğ
BFOVERFLOW_WRAP
) {

298 
hªdË_w¿p
;

299 } ià(
owty³
 =ğ
BFOVERFLOW_SAT
) {

300 *
lim™
 = 0;

307 
hªdË_w¿p
:

309 
ušt64_t
 
mask
 = ((ušt64_t)-1è<< 
b™s
;

310 
ušt64_t
 
»s
 = 
v®ue
+
šü
;

312 
»s
 &ğ~
mask
;

313 *
lim™
 = 
»s
;

316 
	}
}

318 
	$checkSigÃdB™f›ldOv”æow
(
št64_t
 
v®ue
, iÁ64_ˆ
šü
, 
ušt64_t
 
b™s
, 
owty³
, iÁ64_ˆ*
lim™
) {

319 
št64_t
 
max
 = (
b™s
 =ğ64è? 
INT64_MAX
 : (((int64_t)1<<(bits-1))-1);

320 
št64_t
 
mš
 = (-
max
)-1;

325 
št64_t
 
maxšü
 = 
max
-
v®ue
;

326 
št64_t
 
mššü
 = 
mš
-
v®ue
;

328 ià(
v®ue
 > 
max
 || (
b™s
 !ğ64 && 
šü
 > 
maxšü
) || (value >= 0 && incr > 0 && incr > maxincr))

330 ià(
lim™
) {

331 ià(
owty³
 =ğ
BFOVERFLOW_WRAP
) {

332 
hªdË_w¿p
;

333 } ià(
owty³
 =ğ
BFOVERFLOW_SAT
) {

334 *
lim™
 = 
max
;

338 } ià(
v®ue
 < 
mš
 || (
b™s
 !ğ64 && 
šü
 < 
mššü
) || (value < 0 && incr < 0 && incr < minincr)) {

339 ià(
lim™
) {

340 ià(
owty³
 =ğ
BFOVERFLOW_WRAP
) {

341 
hªdË_w¿p
;

342 } ià(
owty³
 =ğ
BFOVERFLOW_SAT
) {

343 *
lim™
 = 
mš
;

350 
hªdË_w¿p
:

352 
ušt64_t
 
mask
 = ((ušt64_t)-1è<< 
b™s
;

353 
ušt64_t
 
msb
 = (ušt64_t)1 << (
b™s
-1);

354 
ušt64_t
 
a
 = 
v®ue
, 
b
 = 
šü
, 
c
;

355 
c
 = 
a
+
b
;

360 ià(
c
 & 
msb
) {

361 
c
 |ğ
mask
;

363 
c
 &ğ~
mask
;

365 *
lim™
 = 
c
;

368 
	}
}

372 
	$´štB™s
(*
p
, 
couÁ
) {

373 
j
, 
i
, 
by‹
;

375 
j
 = 0; j < 
couÁ
; j++) {

376 
by‹
 = 
p
[
j
];

377 
i
 = 0x80; i > 0; i /= 2)

378 
	`´štf
("%c", (
by‹
 & 
i
) ? '1' : '0');

379 
	`´štf
("|");

381 
	`´štf
("\n");

382 
	}
}

388 
	#BITOP_AND
 0

	)

389 
	#BITOP_OR
 1

	)

390 
	#BITOP_XOR
 2

	)

391 
	#BITOP_NOT
 3

	)

393 
	#BITFIELDOP_GET
 0

	)

394 
	#BITFIELDOP_SET
 1

	)

395 
	#BITFIELDOP_INCRBY
 2

	)

404 
	$g‘B™Off£tFromArgum’t
(
ş›Á
 *
c
, 
robj
 *
o
, 
size_t
 *
off£t
, 
hash
, 
b™s
) {

405 
loff£t
;

406 *
”r
 = "bit offset is‚ot‡n integer or out of„ange";

407 *
p
 = 
o
->
±r
;

408 
size_t
 
¶’
 = 
	`sd¦’
(
p
);

409 
u£hash
 = 0;

412 ià(
p
[0] =ğ'#' && 
hash
 && 
b™s
 > 0è
u£hash
 = 1;

414 ià(
	`¡ršg2Î
(
p
+
u£hash
,
¶’
-u£hash,&
loff£t
) == 0) {

415 
	`addR•lyE¼Ü
(
c
,
”r
);

416  
C_ERR
;

420 ià(
u£hash
è
loff£t
 *ğ
b™s
;

423 ià((
loff£t
 < 0) || (()loffset >> 3) >= (512*1024*1024))

425 
	`addR•lyE¼Ü
(
c
,
”r
);

426  
C_ERR
;

429 *
off£t
 = (
size_t
)
loff£t
;

430  
C_OK
;

431 
	}
}

440 
	$g‘B™f›ldTy³FromArgum’t
(
ş›Á
 *
c
, 
robj
 *
o
, *
sign
, *
b™s
) {

441 *
p
 = 
o
->
±r
;

442 *
”r
 = "Invalid bitfieldype. Use something†ike i16 u8. Notehat u64 is‚ot supported but i64 is.";

443 
Îb™s
;

445 ià(
p
[0] == 'i') {

446 *
sign
 = 1;

447 } ià(
p
[0] == 'u') {

448 *
sign
 = 0;

450 
	`addR•lyE¼Ü
(
c
,
”r
);

451  
C_ERR
;

454 ià((
	`¡ršg2Î
(
p
+1,
	`¡¾’
Õ+1),&
Îb™s
)) == 0 ||

455 
Îb™s
 < 1 ||

456 (*
sign
 =ğ1 && 
Îb™s
 > 64) ||

457 (*
sign
 =ğ0 && 
Îb™s
 > 63))

459 
	`addR•lyE¼Ü
(
c
,
”r
);

460  
C_ERR
;

462 *
b™s
 = 
Îb™s
;

463  
C_OK
;

464 
	}
}

471 
robj
 *
	$lookupSŒšgFÜB™Commªd
(
ş›Á
 *
c
, 
size_t
 
maxb™
) {

472 
size_t
 
by‹
 = 
maxb™
 >> 3;

473 
robj
 *
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

475 ià(
o
 =ğ
NULL
) {

476 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ewËn
(
NULL
, 
by‹
+1));

477 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
o
);

479 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
)è 
NULL
;

480 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

481 
o
->
±r
 = 
	`sdsgrowz”o
(o->±r,
by‹
+1);

483  
o
;

484 
	}
}

499 *
	$g‘ObjeùR—dOÆySŒšg
(
robj
 *
o
, *
Ën
, *
Îbuf
) {

500 
	`£rv”As£¹
(
o
->
ty³
 =ğ
OBJ_STRING
);

501 *
p
 = 
NULL
;

505 ià(
o
 && o->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

506 
p
 = (*è
Îbuf
;

507 ià(
Ën
è*ËÀğ
	`Î2¡ršg
(
Îbuf
,
LONG_STR_SIZE
,()
o
->
±r
);

508 } ià(
o
) {

509 
p
 = (*è
o
->
±r
;

510 ià(
Ën
è*ËÀğ
	`sd¦’
(
o
->
±r
);

512 ià(
Ën
) *len = 0;

514  
p
;

515 
	}
}

518 
	$£tb™Commªd
(
ş›Á
 *
c
) {

519 
robj
 *
o
;

520 *
”r
 = "bit is‚ot‡n integer or out of„ange";

521 
size_t
 
b™off£t
;

522 
ssize_t
 
by‹
, 
b™
;

523 
by‹v®
, 
b™v®
;

524 
Ú
;

526 ià(
	`g‘B™Off£tFromArgum’t
(
c
,c->
¬gv
[2],&
b™off£t
,0,0è!ğ
C_OK
)

529 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
Ú
,
”r
è!ğ
C_OK
)

533 ià(
Ú
 & ~1) {

534 
	`addR•lyE¼Ü
(
c
,
”r
);

538 ià((
o
 = 
	`lookupSŒšgFÜB™Commªd
(
c
,
b™off£t
)è=ğ
NULL
) ;

541 
by‹
 = 
b™off£t
 >> 3;

542 
by‹v®
 = ((
ušt8_t
*)
o
->
±r
)[
by‹
];

543 
b™
 = 7 - (
b™off£t
 & 0x7);

544 
b™v®
 = 
by‹v®
 & (1 << 
b™
);

547 
by‹v®
 &ğ~(1 << 
b™
);

548 
by‹v®
 |ğ((
Ú
 & 0x1è<< 
b™
);

549 ((
ušt8_t
*)
o
->
±r
)[
by‹
] = 
by‹v®
;

550 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

551 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£tb™",
c
->
¬gv
[1],c->
db
->
id
);

552 
£rv”
.
dœty
++;

553 
	`addR•ly
(
c
, 
b™v®
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

554 
	}
}

557 
	$g‘b™Commªd
(
ş›Á
 *
c
) {

558 
robj
 *
o
;

559 
Îbuf
[32];

560 
size_t
 
b™off£t
;

561 
size_t
 
by‹
, 
b™
;

562 
size_t
 
b™v®
 = 0;

564 ià(
	`g‘B™Off£tFromArgum’t
(
c
,c->
¬gv
[2],&
b™off£t
,0,0è!ğ
C_OK
)

567 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

568 
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) ;

570 
by‹
 = 
b™off£t
 >> 3;

571 
b™
 = 7 - (
b™off£t
 & 0x7);

572 ià(
	`sdsEncodedObjeù
(
o
)) {

573 ià(
by‹
 < 
	`sd¦’
(
o
->
±r
))

574 
b™v®
 = ((
ušt8_t
*)
o
->
±r
)[
by‹
] & (1 << 
b™
);

576 ià(
by‹
 < (
size_t
)
	`Î2¡ršg
(
Îbuf
,Ölbuf),()
o
->
±r
))

577 
b™v®
 = 
Îbuf
[
by‹
] & (1 << 
b™
);

580 
	`addR•ly
(
c
, 
b™v®
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

581 
	}
}

584 
	$b™İCommªd
(
ş›Á
 *
c
) {

585 *
İÇme
 = 
c
->
¬gv
[1]->
±r
;

586 
robj
 *
o
, *
rg‘key
 = 
c
->
¬gv
[2];

587 
İ
, 
j
, 
numkeys
;

588 
robj
 **
objeùs
;

589 **
¤c
;

590 *
Ën
, 
maxËn
 = 0;

592 
mšËn
 = 0;

593 *
»s
 = 
NULL
;

596 ià((
İÇme
[0] =ğ'a' || o²ame[0] =ğ'A'è&& !
	`¡rÿ£cmp
(opname,"and"))

597 
İ
 = 
BITOP_AND
;

598 if((
İÇme
[0] =ğ'o' || o²ame[0] =ğ'O'è&& !
	`¡rÿ£cmp
(opname,"or"))

599 
İ
 = 
BITOP_OR
;

600 if((
İÇme
[0] =ğ'x' || o²ame[0] =ğ'X'è&& !
	`¡rÿ£cmp
(opname,"xor"))

601 
İ
 = 
BITOP_XOR
;

602 if((
İÇme
[0] =ğ'n' || o²ame[0] =ğ'N'è&& !
	`¡rÿ£cmp
(opname,"not"))

603 
İ
 = 
BITOP_NOT
;

605 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

610 ià(
İ
 =ğ
BITOP_NOT
 && 
c
->
¬gc
 != 4) {

611 
	`addR•lyE¼Ü
(
c
,"BITOP NOT must be called with‡ single source key.");

616 
numkeys
 = 
c
->
¬gc
 - 3;

617 
¤c
 = 
	`zm®loc
((*è* 
numkeys
);

618 
Ën
 = 
	`zm®loc
((è* 
numkeys
);

619 
objeùs
 = 
	`zm®loc
((
robj
*è* 
numkeys
);

620 
j
 = 0; j < 
numkeys
; j++) {

621 
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
j
+3]);

623 ià(
o
 =ğ
NULL
) {

624 
objeùs
[
j
] = 
NULL
;

625 
¤c
[
j
] = 
NULL
;

626 
Ën
[
j
] = 0;

627 
mšËn
 = 0;

631 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) {

632 
i
;

633 
i
 = 0; i < 
j
; i++) {

634 ià(
objeùs
[
i
])

635 
	`deüRefCouÁ
(
objeùs
[
i
]);

637 
	`zä“
(
¤c
);

638 
	`zä“
(
Ën
);

639 
	`zä“
(
objeùs
);

642 
objeùs
[
j
] = 
	`g‘DecodedObjeù
(
o
);

643 
¤c
[
j
] = 
objeùs
[j]->
±r
;

644 
Ën
[
j
] = 
	`sd¦’
(
objeùs
[j]->
±r
);

645 ià(
Ën
[
j
] > 
maxËn
) maxlen =†en[j];

646 ià(
j
 =ğ0 || 
Ën
[j] < 
mšËn
) minlen =†en[j];

650 ià(
maxËn
) {

651 
»s
 = (*è
	`sd¢ewËn
(
NULL
,
maxËn
);

652 
ouut
, 
by‹
;

653 
i
;

658 
j
 = 0;

659 ià(
mšËn
 >ğ()*4 && 
numkeys
 <= 16) {

660 *
Í
[16];

661 *
Ìes
 = (*è
»s
;

664 
	`memıy
(
Í
,
¤c
,(*)*
numkeys
);

665 
	`memıy
(
»s
,
¤c
[0],
mšËn
);

668 ià(
İ
 =ğ
BITOP_AND
) {

669 
mšËn
 >= ()*4) {

670 
i
 = 1; i < 
numkeys
; i++) {

671 
Ìes
[0] &ğ
Í
[
i
][0];

672 
Ìes
[1] &ğ
Í
[
i
][1];

673 
Ìes
[2] &ğ
Í
[
i
][2];

674 
Ìes
[3] &ğ
Í
[
i
][3];

675 
Í
[
i
]+=4;

677 
Ìes
+=4;

678 
j
 += ()*4;

679 
mšËn
 -= ()*4;

681 } ià(
İ
 =ğ
BITOP_OR
) {

682 
mšËn
 >= ()*4) {

683 
i
 = 1; i < 
numkeys
; i++) {

684 
Ìes
[0] |ğ
Í
[
i
][0];

685 
Ìes
[1] |ğ
Í
[
i
][1];

686 
Ìes
[2] |ğ
Í
[
i
][2];

687 
Ìes
[3] |ğ
Í
[
i
][3];

688 
Í
[
i
]+=4;

690 
Ìes
+=4;

691 
j
 += ()*4;

692 
mšËn
 -= ()*4;

694 } ià(
İ
 =ğ
BITOP_XOR
) {

695 
mšËn
 >= ()*4) {

696 
i
 = 1; i < 
numkeys
; i++) {

697 
Ìes
[0] ^ğ
Í
[
i
][0];

698 
Ìes
[1] ^ğ
Í
[
i
][1];

699 
Ìes
[2] ^ğ
Í
[
i
][2];

700 
Ìes
[3] ^ğ
Í
[
i
][3];

701 
Í
[
i
]+=4;

703 
Ìes
+=4;

704 
j
 += ()*4;

705 
mšËn
 -= ()*4;

707 } ià(
İ
 =ğ
BITOP_NOT
) {

708 
mšËn
 >= ()*4) {

709 
Ìes
[0] = ~lres[0];

710 
Ìes
[1] = ~lres[1];

711 
Ìes
[2] = ~lres[2];

712 
Ìes
[3] = ~lres[3];

713 
Ìes
+=4;

714 
j
 += ()*4;

715 
mšËn
 -= ()*4;

721 ; 
j
 < 
maxËn
; j++) {

722 
ouut
 = (
Ën
[0] <ğ
j
è? 0 : 
¤c
[0][j];

723 ià(
İ
 =ğ
BITOP_NOT
è
ouut
 = ~output;

724 
i
 = 1; i < 
numkeys
; i++) {

725 
by‹
 = (
Ën
[
i
] <ğ
j
è? 0 : 
¤c
[i][j];

726 
İ
) {

727 
BITOP_AND
: 
ouut
 &ğ
by‹
; ;

728 
BITOP_OR
: 
ouut
 |ğ
by‹
; ;

729 
BITOP_XOR
: 
ouut
 ^ğ
by‹
; ;

732 
»s
[
j
] = 
ouut
;

735 
j
 = 0; j < 
numkeys
; j++) {

736 ià(
objeùs
[
j
])

737 
	`deüRefCouÁ
(
objeùs
[
j
]);

739 
	`zä“
(
¤c
);

740 
	`zä“
(
Ën
);

741 
	`zä“
(
objeùs
);

744 ià(
maxËn
) {

745 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
»s
);

746 
	`£tKey
(
c
->
db
,
rg‘key
,
o
);

747 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£t",
rg‘key
,
c
->
db
->
id
);

748 
	`deüRefCouÁ
(
o
);

749 } ià(
	`dbD–‘e
(
c
->
db
,
rg‘key
)) {

750 
	`sigÇlModif›dKey
(
c
->
db
,
rg‘key
);

751 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
rg‘key
,
c
->
db
->
id
);

753 
£rv”
.
dœty
++;

754 
	`addR•lyLÚgLÚg
(
c
,
maxËn
);

755 
	}
}

758 
	$b™couÁCommªd
(
ş›Á
 *
c
) {

759 
robj
 *
o
;

760 
¡¬t
, 
’d
, 
¡¾’
;

761 *
p
;

762 
Îbuf
[
LONG_STR_SIZE
];

765 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

766 
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) ;

767 
p
 = 
	`g‘ObjeùR—dOÆySŒšg
(
o
,&
¡¾’
,
Îbuf
);

770 ià(
c
->
¬gc
 == 4) {

771 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
¡¬t
,
NULL
è!ğ
C_OK
)

773 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
’d
,
NULL
è!ğ
C_OK
)

776 ià(
¡¬t
 < 0 && 
’d
 < 0 && start >ƒnd) {

777 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

780 ià(
¡¬t
 < 0è¡¬ˆğ
¡¾’
+start;

781 ià(
’d
 < 0è’d = 
¡¾’
+end;

782 ià(
¡¬t
 < 0) start = 0;

783 ià(
’d
 < 0)ƒnd = 0;

784 ià(
’d
 >ğ
¡¾’
)ƒnd = strlen-1;

785 } ià(
c
->
¬gc
 == 2) {

787 
¡¬t
 = 0;

788 
’d
 = 
¡¾’
-1;

791 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

797 ià(
¡¬t
 > 
’d
) {

798 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

800 
by‹s
 = 
’d
-
¡¬t
+1;

802 
	`addR•lyLÚgLÚg
(
c
,
	`»disPİcouÁ
(
p
+
¡¬t
,
by‹s
));

804 
	}
}

807 
	$b™posCommªd
(
ş›Á
 *
c
) {

808 
robj
 *
o
;

809 
b™
, 
¡¬t
, 
’d
, 
¡¾’
;

810 *
p
;

811 
Îbuf
[
LONG_STR_SIZE
];

812 
’d_giv’
 = 0;

816 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
b™
,
NULL
è!ğ
C_OK
)

818 ià(
b™
 != 0 && bit != 1) {

819 
	`addR•lyE¼Ü
(
c
, "The bit‡rgument must be 1 or 0.");

826 ià((
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[1])è=ğ
NULL
) {

827 
	`addR•lyLÚgLÚg
(
c
, 
b™
 ? -1 : 0);

830 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) ;

831 
p
 = 
	`g‘ObjeùR—dOÆySŒšg
(
o
,&
¡¾’
,
Îbuf
);

834 ià(
c
->
¬gc
 == 4 || c->argc == 5) {

835 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
¡¬t
,
NULL
è!ğ
C_OK
)

837 ià(
c
->
¬gc
 == 5) {

838 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[4],&
’d
,
NULL
è!ğ
C_OK
)

840 
’d_giv’
 = 1;

842 
’d
 = 
¡¾’
-1;

845 ià(
¡¬t
 < 0è¡¬ˆğ
¡¾’
+start;

846 ià(
’d
 < 0è’d = 
¡¾’
+end;

847 ià(
¡¬t
 < 0) start = 0;

848 ià(
’d
 < 0)ƒnd = 0;

849 ià(
’d
 >ğ
¡¾’
)ƒnd = strlen-1;

850 } ià(
c
->
¬gc
 == 3) {

852 
¡¬t
 = 0;

853 
’d
 = 
¡¾’
-1;

856 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

862 ià(
¡¬t
 > 
’d
) {

863 
	`addR•lyLÚgLÚg
(
c
, -1);

865 
by‹s
 = 
’d
-
¡¬t
+1;

866 
pos
 = 
	`»disB™pos
(
p
+
¡¬t
,
by‹s
,
b™
);

875 ià(
’d_giv’
 && 
b™
 =ğ0 && 
pos
 =ğ
by‹s
*8) {

876 
	`addR•lyLÚgLÚg
(
c
,-1);

879 ià(
pos
 !ğ-1èpo +ğ
¡¬t
*8;

880 
	`addR•lyLÚgLÚg
(
c
,
pos
);

882 
	}
}

894 
	sb™f›ldOp
 {

895 
ušt64_t
 
	moff£t
;

896 
št64_t
 
	mi64
;

897 
	mİcode
;

898 
	mowty³
;

899 
	mb™s
;

900 
	msign
;

903 
	$b™f›ldCommªd
(
ş›Á
 *
c
) {

904 
robj
 *
o
;

905 
size_t
 
b™off£t
;

906 
j
, 
numİs
 = 0, 
chªges
 = 0;

907 
b™f›ldOp
 *
İs
 = 
NULL
;

908 
owty³
 = 
BFOVERFLOW_WRAP
;

909 
»adÚly
 = 1;

910 
hige¡_wr™e_off£t
 = 0;

912 
j
 = 2; j < 
c
->
¬gc
; j++) {

913 
»m¬gs
 = 
c
->
¬gc
-
j
-1;

914 *
subcmd
 = 
c
->
¬gv
[
j
]->
±r
;

915 
İcode
;

916 
i64
 = 0;

917 
sign
 = 0;

918 
b™s
 = 0;

920 ià(!
	`¡rÿ£cmp
(
subcmd
,"g‘"è&& 
»m¬gs
 >= 2)

921 
İcode
 = 
BITFIELDOP_GET
;

922 ià(!
	`¡rÿ£cmp
(
subcmd
,"£t"è&& 
»m¬gs
 >= 3)

923 
İcode
 = 
BITFIELDOP_SET
;

924 ià(!
	`¡rÿ£cmp
(
subcmd
,"šüby"è&& 
»m¬gs
 >= 3)

925 
İcode
 = 
BITFIELDOP_INCRBY
;

926 ià(!
	`¡rÿ£cmp
(
subcmd
,"ov”æow"è&& 
»m¬gs
 >= 1) {

927 *
owty³Çme
 = 
c
->
¬gv
[
j
+1]->
±r
;

928 
j
++;

929 ià(!
	`¡rÿ£cmp
(
owty³Çme
,"wrap"))

930 
owty³
 = 
BFOVERFLOW_WRAP
;

931 ià(!
	`¡rÿ£cmp
(
owty³Çme
,"sat"))

932 
owty³
 = 
BFOVERFLOW_SAT
;

933 ià(!
	`¡rÿ£cmp
(
owty³Çme
,"fail"))

934 
owty³
 = 
BFOVERFLOW_FAIL
;

936 
	`addR•lyE¼Ü
(
c
,"Invalid OVERFLOWype specified");

937 
	`zä“
(
İs
);

942 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

943 
	`zä“
(
İs
);

948 ià(
	`g‘B™f›ldTy³FromArgum’t
(
c
,c->
¬gv
[
j
+1],&
sign
,&
b™s
è!ğ
C_OK
) {

949 
	`zä“
(
İs
);

953 ià(
	`g‘B™Off£tFromArgum’t
(
c
,c->
¬gv
[
j
+2],&
b™off£t
,1,
b™s
è!ğ
C_OK
){

954 
	`zä“
(
İs
);

958 ià(
İcode
 !ğ
BITFIELDOP_GET
) {

959 
»adÚly
 = 0;

960 
hige¡_wr™e_off£t
 = 
b™off£t
 + 
b™s
 - 1;

962 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[
j
+3],&
i64
,
NULL
è!ğ
C_OK
){

963 
	`zä“
(
İs
);

969 
İs
 = 
	`z»®loc
(İs,(*İs)*(
numİs
+1));

970 
İs
[
numİs
].
off£t
 = 
b™off£t
;

971 
İs
[
numİs
].
i64
 = i64;

972 
İs
[
numİs
].
İcode
 = opcode;

973 
İs
[
numİs
].
owty³
 = owtype;

974 
İs
[
numİs
].
b™s
 = bits;

975 
İs
[
numİs
].
sign
 = sign;

976 
numİs
++;

978 
j
 +ğ3 - (
İcode
 =ğ
BITFIELDOP_GET
);

981 ià(
»adÚly
) {

984 
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[1]);

985 ià(
o
 !ğ
NULL
 && 
	`checkTy³
(
c
,o,
OBJ_STRING
)) ;

989 ià((
o
 = 
	`lookupSŒšgFÜB™Commªd
(
c
,

990 
hige¡_wr™e_off£t
)è=ğ
NULL
) ;

993 
	`addR•lyMuÉiBulkL’
(
c
,
numİs
);

996 
j
 = 0; j < 
numİs
; j++) {

997 
b™f›ldOp
 *
thisİ
 = 
İs
+
j
;

1000 ià(
thisİ
->
İcode
 =ğ
BITFIELDOP_SET
 ||

1001 
thisİ
->
İcode
 =ğ
BITFIELDOP_INCRBY
)

1010 ià(
thisİ
->
sign
) {

1011 
št64_t
 
Şdv®
, 
Ãwv®
, 
w¿µed
, 
»tv®
;

1012 
ov”æow
;

1014 
Şdv®
 = 
	`g‘SigÃdB™f›ld
(
o
->
±r
,
thisİ
->
off£t
,

1015 
thisİ
->
b™s
);

1017 ià(
thisİ
->
İcode
 =ğ
BITFIELDOP_INCRBY
) {

1018 
Ãwv®
 = 
Şdv®
 + 
thisİ
->
i64
;

1019 
ov”æow
 = 
	`checkSigÃdB™f›ldOv”æow
(
Şdv®
,

1020 
thisİ
->
i64
,thisİ->
b™s
,thisİ->
owty³
,&
w¿µed
);

1021 ià(
ov”æow
è
Ãwv®
 = 
w¿µed
;

1022 
»tv®
 = 
Ãwv®
;

1024 
Ãwv®
 = 
thisİ
->
i64
;

1025 
ov”æow
 = 
	`checkSigÃdB™f›ldOv”æow
(
Ãwv®
,

1026 0,
thisİ
->
b™s
,thisİ->
owty³
,&
w¿µed
);

1027 ià(
ov”æow
è
Ãwv®
 = 
w¿µed
;

1028 
»tv®
 = 
Şdv®
;

1033 ià(!(
ov”æow
 && 
thisİ
->
owty³
 =ğ
BFOVERFLOW_FAIL
)) {

1034 
	`addR•lyLÚgLÚg
(
c
,
»tv®
);

1035 
	`£tSigÃdB™f›ld
(
o
->
±r
,
thisİ
->
off£t
,

1036 
thisİ
->
b™s
,
Ãwv®
);

1038 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

1041 
ušt64_t
 
Şdv®
, 
Ãwv®
, 
w¿µed
, 
»tv®
;

1042 
ov”æow
;

1044 
Şdv®
 = 
	`g‘UnsigÃdB™f›ld
(
o
->
±r
,
thisİ
->
off£t
,

1045 
thisİ
->
b™s
);

1047 ià(
thisİ
->
İcode
 =ğ
BITFIELDOP_INCRBY
) {

1048 
Ãwv®
 = 
Şdv®
 + 
thisİ
->
i64
;

1049 
ov”æow
 = 
	`checkUnsigÃdB™f›ldOv”æow
(
Şdv®
,

1050 
thisİ
->
i64
,thisİ->
b™s
,thisİ->
owty³
,&
w¿µed
);

1051 ià(
ov”æow
è
Ãwv®
 = 
w¿µed
;

1052 
»tv®
 = 
Ãwv®
;

1054 
Ãwv®
 = 
thisİ
->
i64
;

1055 
ov”æow
 = 
	`checkUnsigÃdB™f›ldOv”æow
(
Ãwv®
,

1056 0,
thisİ
->
b™s
,thisİ->
owty³
,&
w¿µed
);

1057 ià(
ov”æow
è
Ãwv®
 = 
w¿µed
;

1058 
»tv®
 = 
Şdv®
;

1062 ià(!(
ov”æow
 && 
thisİ
->
owty³
 =ğ
BFOVERFLOW_FAIL
)) {

1063 
	`addR•lyLÚgLÚg
(
c
,
»tv®
);

1064 
	`£tUnsigÃdB™f›ld
(
o
->
±r
,
thisİ
->
off£t
,

1065 
thisİ
->
b™s
,
Ãwv®
);

1067 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

1070 
chªges
++;

1073 
buf
[9];

1074 
¡¾’
 = 0;

1075 *
¤c
 = 
NULL
;

1076 
Îbuf
[
LONG_STR_SIZE
];

1078 ià(
o
 !ğ
NULL
)

1079 
¤c
 = 
	`g‘ObjeùR—dOÆySŒšg
(
o
,&
¡¾’
,
Îbuf
);

1085 
	`mem£t
(
buf
,0,9);

1086 
i
;

1087 
size_t
 
by‹
 = 
thisİ
->
off£t
 >> 3;

1088 
i
 = 0; i < 9; i++) {

1089 ià(
¤c
 =ğ
NULL
 || 
i
+
by‹
 >ğ(
size_t
)
¡¾’
) ;

1090 
buf
[
i
] = 
¤c
[i+
by‹
];

1095 ià(
thisİ
->
sign
) {

1096 
št64_t
 
v®
 = 
	`g‘SigÃdB™f›ld
(
buf
,
thisİ
->
off£t
-(
by‹
*8),

1097 
thisİ
->
b™s
);

1098 
	`addR•lyLÚgLÚg
(
c
,
v®
);

1100 
ušt64_t
 
v®
 = 
	`g‘UnsigÃdB™f›ld
(
buf
,
thisİ
->
off£t
-(
by‹
*8),

1101 
thisİ
->
b™s
);

1102 
	`addR•lyLÚgLÚg
(
c
,
v®
);

1107 ià(
chªges
) {

1108 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

1109 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£tb™",
c
->
¬gv
[1],c->
db
->
id
);

1110 
£rv”
.
dœty
 +ğ
chªges
;

1112 
	`zä“
(
İs
);

1113 
	}
}

	@blocked.c

66 
	~"£rv”.h
"

76 
	$g‘TimeoutFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
objeù
, 
m¡ime_t
 *
timeout
, 
un™
) {

77 
tv®
;

79 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,
objeù
,&
tv®
,

80 "timeouˆi nÙ‡Àš‹g” o¸ouˆoà¿nge"è!ğ
C_OK
)

81  
C_ERR
;

83 ià(
tv®
 < 0) {

84 
	`addR•lyE¼Ü
(
c
,"timeout is‚egative");

85  
C_ERR
;

88 ià(
tv®
 > 0) {

89 ià(
un™
 =ğ
UNIT_SECONDS
è
tv®
 *= 1000;

90 
tv®
 +ğ
	`m¡ime
();

92 *
timeout
 = 
tv®
;

94  
C_OK
;

95 
	}
}

100 
	$blockCl›Á
(
ş›Á
 *
c
, 
bty³
) {

101 
c
->
æags
 |ğ
CLIENT_BLOCKED
;

102 
c
->
bty³
 = btype;

103 
£rv”
.
bpİ_blocked_ş›Ás
++;

104 
	}
}

109 
	$´oûssUnblockedCl›Ás
() {

110 
li¡Node
 *
Ê
;

111 
ş›Á
 *
c
;

113 
	`li¡L’gth
(
£rv”
.
unblocked_ş›Ás
)) {

114 
Ê
 = 
	`li¡Fœ¡
(
£rv”
.
unblocked_ş›Ás
);

115 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

116 
c
 = 
Ê
->
v®ue
;

117 
	`li¡D–Node
(
£rv”
.
unblocked_ş›Ás
,
Ê
);

118 
c
->
æags
 &ğ~
CLIENT_UNBLOCKED
;

124 ià(!(
c
->
æags
 & 
CLIENT_BLOCKED
)) {

125 ià(
c
->
qu”ybuf
 && 
	`sd¦’
(c->querybuf) > 0) {

126 
	`´oûssIÅutBufãr
(
c
);

130 
	}
}

134 
	$unblockCl›Á
(
ş›Á
 *
c
) {

135 ià(
c
->
bty³
 =ğ
BLOCKED_LIST
) {

136 
	`unblockCl›ÁWa™šgD©a
(
c
);

137 } ià(
c
->
bty³
 =ğ
BLOCKED_WAIT
) {

138 
	`unblockCl›ÁWa™šgR•liÿs
(
c
);

140 
	`£rv”Pªic
("Unknown btype in unblockClient().");

144 
c
->
æags
 &ğ~
CLIENT_BLOCKED
;

145 
c
->
bty³
 = 
BLOCKED_NONE
;

146 
£rv”
.
bpİ_blocked_ş›Ás
--;

149 ià(!(
c
->
æags
 & 
CLIENT_UNBLOCKED
)) {

150 
c
->
æags
 |ğ
CLIENT_UNBLOCKED
;

151 
	`li¡AddNodeTa
(
£rv”
.
unblocked_ş›Ás
,
c
);

153 
	}
}

157 
	$»¶yToBlockedCl›ÁTimedOut
(
ş›Á
 *
c
) {

158 ià(
c
->
bty³
 =ğ
BLOCKED_LIST
) {

159 
	`addR•ly
(
c
,
sh¬ed
.
nuÎmuÉibulk
);

160 } ià(
c
->
bty³
 =ğ
BLOCKED_WAIT
) {

161 
	`addR•lyLÚgLÚg
(
c
,
	`»¶iÿtiÚCouÁAcksByOff£t
(c->
bpİ
.
»¶off£t
));

163 
	`£rv”Pªic
("Unknown btype in„eplyToBlockedClientTimedOut().");

165 
	}
}

174 
	$discÚÃùAÎBlockedCl›Ás
() {

175 
li¡Node
 *
Ê
;

176 
li¡I‹r
 
li
;

178 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

179 (
Ê
 = 
	`li¡Next
(&
li
))) {

180 
ş›Á
 *
c
 = 
	`li¡NodeV®ue
(
Ê
);

182 ià(
c
->
æags
 & 
CLIENT_BLOCKED
) {

183 
	`addR•lySds
(
c
,
	`sd¢ew
(

186 
	`unblockCl›Á
(
c
);

187 
c
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

190 
	}
}

	@childinfo.c

30 
	~"£rv”.h
"

31 
	~<uni¡d.h
>

36 
	$İ’ChdInfoPe
() {

37 ià(
	`pe
(
£rv”
.
chd_šfo_pe
) == -1) {

40 
	`şo£ChdInfoPe
();

41 } ià(
	`ª‘NÚBlock
(
NULL
,
£rv”
.
chd_šfo_pe
[0]è!ğ
ANET_OK
) {

42 
	`şo£ChdInfoPe
();

44 
	`mem£t
(&
£rv”
.
chd_šfo_d©a
,0,(server.child_info_data));

46 
	}
}

49 
	$şo£ChdInfoPe
() {

50 ià(
£rv”
.
chd_šfo_pe
[0] != -1 ||

51 
£rv”
.
chd_šfo_pe
[1] != -1)

53 
	`şo£
(
£rv”
.
chd_šfo_pe
[0]);

54 
	`şo£
(
£rv”
.
chd_šfo_pe
[1]);

55 
£rv”
.
chd_šfo_pe
[0] = -1;

56 
£rv”
.
chd_šfo_pe
[1] = -1;

58 
	}
}

62 
	$£ndChdInfo
(
±y³
) {

63 ià(
£rv”
.
chd_šfo_pe
[1] == -1) ;

64 
£rv”
.
chd_šfo_d©a
.
magic
 = 
CHILD_INFO_MAGIC
;

65 
£rv”
.
chd_šfo_d©a
.
´oûss_ty³
 = 
±y³
;

66 
ssize_t
 
wËn
 = (
£rv”
.
chd_šfo_d©a
);

67 ià(
	`wr™e
(
£rv”
.
chd_šfo_pe
[1],&£rv”.
chd_šfo_d©a
,
wËn
) != wlen) {

70 
	}
}

73 
	$»ûiveChdInfo
() {

74 ià(
£rv”
.
chd_šfo_pe
[0] == -1) ;

75 
ssize_t
 
wËn
 = (
£rv”
.
chd_šfo_d©a
);

76 ià(
	`»ad
(
£rv”
.
chd_šfo_pe
[0],&£rv”.
chd_šfo_d©a
,
wËn
) == wlen &&

77 
£rv”
.
chd_šfo_d©a
.
magic
 =ğ
CHILD_INFO_MAGIC
)

79 ià(
£rv”
.
chd_šfo_d©a
.
´oûss_ty³
 =ğ
CHILD_INFO_TYPE_RDB
) {

80 
£rv”
.
¡©_rdb_cow_by‹s
 = s”v”.
chd_šfo_d©a
.
cow_size
;

81 } ià(
£rv”
.
chd_šfo_d©a
.
´oûss_ty³
 =ğ
CHILD_INFO_TYPE_AOF
) {

82 
£rv”
.
¡©_aof_cow_by‹s
 = s”v”.
chd_šfo_d©a
.
cow_size
;

85 
	}
}

	@cluster.c

31 
	~"£rv”.h
"

32 
	~"şu¡”.h
"

33 
	~"’dŸncÚv.h
"

35 
	~<sys/ty³s.h
>

36 
	~<sys/sock‘.h
>

37 
	~<¬·/š‘.h
>

38 
	~<fú.h
>

39 
	~<uni¡d.h
>

40 
	~<sys/sock‘.h
>

41 
	~<sys/¡©.h
>

42 
	~<sys/fe.h
>

43 
	~<m©h.h
>

48 
şu¡”Node
 *
	gmy£lf
 = 
NULL
;

50 
şu¡”Node
 *
ü—‹Clu¡”Node
(*
nod’ame
, 
æags
);

51 
şu¡”AddNode
(
şu¡”Node
 *
node
);

52 
şu¡”Acû±HªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

53 
şu¡”R—dHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

54 
şu¡”S’dPšg
(
şu¡”Lšk
 *
lšk
, 
ty³
);

55 
şu¡”S’dFa
(*
nod’ame
);

56 
şu¡”S’dFaov”AuthIfN“ded
(
şu¡”Node
 *
node
, 
şu¡”Msg
 *
»que¡
);

57 
şu¡”Upd©eS‹
();

58 
şu¡”NodeG‘SlÙB™
(
şu¡”Node
 *
n
, 
¦Ù
);

59 
sds
 
şu¡”G’NodesDesütiÚ
(
f‹r
);

60 
şu¡”Node
 *
şu¡”LookupNode
(*
Çme
);

61 
şu¡”NodeAddSÏve
(
şu¡”Node
 *
ma¡”
, clu¡”Nod*
¦ave
);

62 
şu¡”AddSlÙ
(
şu¡”Node
 *
n
, 
¦Ù
);

63 
şu¡”D–SlÙ
(
¦Ù
);

64 
şu¡”D–NodeSlÙs
(
şu¡”Node
 *
node
);

65 
şu¡”NodeS‘SlÙB™
(
şu¡”Node
 *
n
, 
¦Ù
);

66 
şu¡”S‘Ma¡”
(
şu¡”Node
 *
n
);

67 
şu¡”HªdËSÏveFaov”
();

68 
şu¡”HªdËSÏveMig¿tiÚ
(
max_¦aves
);

69 
b™m­Te¡B™
(*
b™m­
, 
pos
);

70 
şu¡”DoBefÜeSË•
(
æags
);

71 
şu¡”S’dUpd©e
(
şu¡”Lšk
 *
lšk
, 
şu¡”Node
 *
node
);

72 
»£tMªu®Faov”
();

73 
şu¡”Clo£AÎSlÙs
();

74 
şu¡”S‘NodeAsMa¡”
(
şu¡”Node
 *
n
);

75 
şu¡”D–Node
(
şu¡”Node
 *
d–node
);

76 
sds
 
»´e£ÁClu¡”NodeFÏgs
(sd 
ci
, 
ušt16_t
 
æags
);

77 
ušt64_t
 
şu¡”G‘MaxEpoch
();

78 
şu¡”BumpCÚfigEpochW™houtCÚ£nsus
();

90 
	$şu¡”LßdCÚfig
(*
f’ame
) {

91 
FILE
 *
å
 = 
	`fİ’
(
f’ame
,"r");

92 
¡©
 
sb
;

93 *
lše
;

94 
maxlše
, 
j
;

96 ià(
å
 =ğ
NULL
) {

97 ià(
”ºo
 =ğ
ENOENT
) {

98  
C_ERR
;

100 
	`£rv”Log
(
LL_WARNING
,

102 
f’ame
, 
	`¡»¼Ü
(
”ºo
));

103 
	`ex™
(1);

109 ià(
	`f¡©
(
	`f’o
(
å
),&
sb
è!ğ-1 && sb.
¡_size
 == 0) {

110 
	`fşo£
(
å
);

111  
C_ERR
;

121 
maxlše
 = 1024+
CLUSTER_SLOTS
*128;

122 
lše
 = 
	`zm®loc
(
maxlše
);

123 
	`fg‘s
(
lše
,
maxlše
,
å
è!ğ
NULL
) {

124 
¬gc
;

125 
sds
 *
¬gv
;

126 
şu¡”Node
 *
n
, *
ma¡”
;

127 *
p
, *
s
;

132 ià(
lše
[0] == '\n') ;

135 
¬gv
 = 
	`sds¥l™¬gs
(
lše
,&
¬gc
);

136 ià(
¬gv
 =ğ
NULL
è
fm‹¼
;

140 ià(
	`¡rÿ£cmp
(
¬gv
[0],"vars") == 0) {

141 
j
 = 1; j < 
¬gc
; j += 2) {

142 ià(
	`¡rÿ£cmp
(
¬gv
[
j
],"currentEpoch") == 0) {

143 
£rv”
.
şu¡”
->
cu¼’tEpoch
 =

144 
	`¡¹ouÎ
(
¬gv
[
j
+1],
NULL
,10);

145 } ià(
	`¡rÿ£cmp
(
¬gv
[
j
],"lastVoteEpoch") == 0) {

146 
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
 =

147 
	`¡¹ouÎ
(
¬gv
[
j
+1],
NULL
,10);

149 
	`£rv”Log
(
LL_WARNING
,

151 
¬gv
[
j
]);

154 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

159 ià(
¬gc
 < 8è
fm‹¼
;

162 
n
 = 
	`şu¡”LookupNode
(
¬gv
[0]);

163 ià(!
n
) {

164 
n
 = 
	`ü—‹Clu¡”Node
(
¬gv
[0],0);

165 
	`şu¡”AddNode
(
n
);

168 ià((
p
 = 
	`¡¼chr
(
¬gv
[1],':')è=ğ
NULL
è
fm‹¼
;

169 *
p
 = '\0';

170 
	`memıy
(
n
->

,
¬gv
[1],
	`¡¾’
(argv[1])+1);

171 *
pÜt
 = 
p
+1;

172 *
bu¥
 = 
	`¡rchr
(
pÜt
,'@');

173 ià(
bu¥
) {

174 *
bu¥
 = '\0';

175 
bu¥
++;

177 
n
->
pÜt
 = 
	`©oi
(port);

181 
n
->
ıÜt
 = 
bu¥
 ? 
	`©oi
(bu¥è:‚->
pÜt
 + 
CLUSTER_PORT_INCR
;

184 
p
 = 
s
 = 
¬gv
[2];

185 
p
) {

186 
p
 = 
	`¡rchr
(
s
,',');

187 ià(
p
) *p = '\0';

188 ià(!
	`¡rÿ£cmp
(
s
,"myself")) {

189 
	`£rv”As£¹
(
£rv”
.
şu¡”
->
my£lf
 =ğ
NULL
);

190 
my£lf
 = 
£rv”
.
şu¡”
->my£làğ
n
;

191 
n
->
æags
 |ğ
CLUSTER_NODE_MYSELF
;

192 } ià(!
	`¡rÿ£cmp
(
s
,"master")) {

193 
n
->
æags
 |ğ
CLUSTER_NODE_MASTER
;

194 } ià(!
	`¡rÿ£cmp
(
s
,"slave")) {

195 
n
->
æags
 |ğ
CLUSTER_NODE_SLAVE
;

196 } ià(!
	`¡rÿ£cmp
(
s
,"fail?")) {

197 
n
->
æags
 |ğ
CLUSTER_NODE_PFAIL
;

198 } ià(!
	`¡rÿ£cmp
(
s
,"fail")) {

199 
n
->
æags
 |ğ
CLUSTER_NODE_FAIL
;

200 
n
->
ç_time
 = 
	`m¡ime
();

201 } ià(!
	`¡rÿ£cmp
(
s
,"handshake")) {

202 
n
->
æags
 |ğ
CLUSTER_NODE_HANDSHAKE
;

203 } ià(!
	`¡rÿ£cmp
(
s
,"noaddr")) {

204 
n
->
æags
 |ğ
CLUSTER_NODE_NOADDR
;

205 } ià(!
	`¡rÿ£cmp
(
s
,"noflags")) {

208 
	`£rv”Pªic
("Unknown flag in„edis cluster config file");

210 ià(
p
è
s
 =…+1;

215 ià(
¬gv
[3][0] != '-') {

216 
ma¡”
 = 
	`şu¡”LookupNode
(
¬gv
[3]);

217 ià(!
ma¡”
) {

218 
ma¡”
 = 
	`ü—‹Clu¡”Node
(
¬gv
[3],0);

219 
	`şu¡”AddNode
(
ma¡”
);

221 
n
->
¦aveof
 = 
ma¡”
;

222 
	`şu¡”NodeAddSÏve
(
ma¡”
,
n
);

226 ià(
	`©oi
(
¬gv
[4])è
n
->
pšg_£Á
 = 
	`m¡ime
();

227 ià(
	`©oi
(
¬gv
[5])è
n
->
pÚg_»ûived
 = 
	`m¡ime
();

230 
n
->
cÚfigEpoch
 = 
	`¡¹ouÎ
(
¬gv
[6],
NULL
,10);

233 
j
 = 8; j < 
¬gc
; j++) {

234 
¡¬t
, 
¡İ
;

236 ià(
¬gv
[
j
][0] == '[') {

238 
¦Ù
;

239 
dœeùiÚ
;

240 
şu¡”Node
 *
ú
;

242 
p
 = 
	`¡rchr
(
¬gv
[
j
],'-');

243 
	`£rv”As£¹
(
p
 !ğ
NULL
);

244 *
p
 = '\0';

245 
dœeùiÚ
 = 
p
[1];

246 
¦Ù
 = 
	`©oi
(
¬gv
[
j
]+1);

247 
p
 += 3;

248 
ú
 = 
	`şu¡”LookupNode
(
p
);

249 ià(!
ú
) {

250 
ú
 = 
	`ü—‹Clu¡”Node
(
p
,0);

251 
	`şu¡”AddNode
(
ú
);

253 ià(
dœeùiÚ
 == '>') {

254 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
] = 
ú
;

256 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] = 
ú
;

259 } ià((
p
 = 
	`¡rchr
(
¬gv
[
j
],'-')è!ğ
NULL
) {

260 *
p
 = '\0';

261 
¡¬t
 = 
	`©oi
(
¬gv
[
j
]);

262 
¡İ
 = 
	`©oi
(
p
+1);

264 
¡¬t
 = 
¡İ
 = 
	`©oi
(
¬gv
[
j
]);

266 
¡¬t
 <ğ
¡İ
è
	`şu¡”AddSlÙ
(
n
, start++);

269 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

272 ià(
£rv”
.
şu¡”
->
my£lf
 =ğ
NULL
è
fm‹¼
;

274 
	`zä“
(
lše
);

275 
	`fşo£
(
å
);

277 
	`£rv”Log
(
LL_NOTICE
,"NodcÚfigu¿tiÚ†ßded, I'm %.40s", 
my£lf
->
Çme
);

282 ià(
	`şu¡”G‘MaxEpoch
(è> 
£rv”
.
şu¡”
->
cu¼’tEpoch
) {

283 
£rv”
.
şu¡”
->
cu¼’tEpoch
 = 
	`şu¡”G‘MaxEpoch
();

285  
C_OK
;

287 
fm‹¼
:

288 
	`£rv”Log
(
LL_WARNING
,

290 
	`zä“
(
lše
);

291 ià(
å
è
	`fşo£
(fp);

292 
	`ex™
(1);

293 
	}
}

307 
	$şu¡”SaveCÚfig
(
do_fsync
) {

308 
sds
 
ci
;

309 
size_t
 
cÚ‹Á_size
;

310 
¡©
 
sb
;

311 
fd
;

313 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 &ğ~
CLUSTER_TODO_SAVE_CONFIG
;

317 
ci
 = 
	`şu¡”G’NodesDesütiÚ
(
CLUSTER_NODE_HANDSHAKE
);

318 
ci
 = 
	`sdsÿrštf
(ci,"vars currentEpoch %llu†astVoteEpoch %llu\n",

319 (è
£rv”
.
şu¡”
->
cu¼’tEpoch
,

320 (è
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
);

321 
cÚ‹Á_size
 = 
	`sd¦’
(
ci
);

323 ià((
fd
 = 
	`İ’
(
£rv”
.
şu¡”_cÚfigfe
,
O_WRONLY
|
O_CREAT
,0644))

324 =ğ-1è
”r
;

327 ià(
	`f¡©
(
fd
,&
sb
) != -1) {

328 ià(
sb
.
¡_size
 > (
off_t
)
cÚ‹Á_size
) {

329 
ci
 = 
	`sdsgrowz”o
(ci,
sb
.
¡_size
);

330 
	`mem£t
(
ci
+
cÚ‹Á_size
,'\n',
sb
.
¡_size
-content_size);

333 ià(
	`wr™e
(
fd
,
ci
,
	`sd¦’
(ci)è!ğ(
ssize_t
)sd¦’(ci)è
”r
;

334 ià(
do_fsync
) {

335 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 &ğ~
CLUSTER_TODO_FSYNC_CONFIG
;

336 
	`fsync
(
fd
);

341 ià(
cÚ‹Á_size
 !ğ
	`sd¦’
(
ci
è&& 
	`árunÿ‹
(
fd
,content_size) == -1) {

344 
	`şo£
(
fd
);

345 
	`sdsä“
(
ci
);

348 
”r
:

349 ià(
fd
 !ğ-1è
	`şo£
(fd);

350 
	`sdsä“
(
ci
);

352 
	}
}

354 
	$şu¡”SaveCÚfigOrD›
(
do_fsync
) {

355 ià(
	`şu¡”SaveCÚfig
(
do_fsync
) == -1) {

356 
	`£rv”Log
(
LL_WARNING
,"Fatal: can't update cluster config file.");

357 
	`ex™
(1);

359 
	}
}

370 
	$şu¡”LockCÚfig
(*
f’ame
) {

375 #ià!
	`defšed
(
__sun
)

379 
fd
 = 
	`İ’
(
f’ame
,
O_WRONLY
|
O_CREAT
,0644);

380 ià(
fd
 == -1) {

381 
	`£rv”Log
(
LL_WARNING
,

383 
f’ame
, 
	`¡»¼Ü
(
”ºo
));

384  
C_ERR
;

387 ià(
	`æock
(
fd
,
LOCK_EX
|
LOCK_NB
) == -1) {

388 ià(
”ºo
 =ğ
EWOULDBLOCK
) {

389 
	`£rv”Log
(
LL_WARNING
,

393 "fes.", 
f’ame
);

395 
	`£rv”Log
(
LL_WARNING
,

396 "ImpossibËØlock %s: %s", 
f’ame
, 
	`¡»¼Ü
(
”ºo
));

398 
	`şo£
(
fd
);

399  
C_ERR
;

405  
C_OK
;

406 
	}
}

408 
	$şu¡”In™
() {

409 
§vecÚf
 = 0;

411 
£rv”
.
şu¡”
 = 
	`zm®loc
((
şu¡”S‹
));

412 
£rv”
.
şu¡”
->
my£lf
 = 
NULL
;

413 
£rv”
.
şu¡”
->
cu¼’tEpoch
 = 0;

414 
£rv”
.
şu¡”
->
¡©e
 = 
CLUSTER_FAIL
;

415 
£rv”
.
şu¡”
->
size
 = 1;

416 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 = 0;

417 
£rv”
.
şu¡”
->
nodes
 = 
	`diùC»©e
(&
şu¡”NodesDiùTy³
,
NULL
);

418 
£rv”
.
şu¡”
->
nodes_bÏck_li¡
 =

419 
	`diùC»©e
(&
şu¡”NodesBÏckLi¡DiùTy³
,
NULL
);

420 
£rv”
.
şu¡”
->
çov”_auth_time
 = 0;

421 
£rv”
.
şu¡”
->
çov”_auth_couÁ
 = 0;

422 
£rv”
.
şu¡”
->
çov”_auth_¿nk
 = 0;

423 
£rv”
.
şu¡”
->
çov”_auth_•och
 = 0;

424 
£rv”
.
şu¡”
->
ÿÁ_çov”_»asÚ
 = 
CLUSTER_CANT_FAILOVER_NONE
;

425 
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
 = 0;

426 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_£Á
 = 0;

427 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_»ûived
 = 0;

428 
	`mem£t
(
£rv”
.
şu¡”
->
¦Ùs
,0, (server.cluster->slots));

429 
	`şu¡”Clo£AÎSlÙs
();

433 ià(
	`şu¡”LockCÚfig
(
£rv”
.
şu¡”_cÚfigfe
è=ğ
C_ERR
)

434 
	`ex™
(1);

437 ià(
	`şu¡”LßdCÚfig
(
£rv”
.
şu¡”_cÚfigfe
è=ğ
C_ERR
) {

440 
my£lf
 = 
£rv”
.
şu¡”
->myself =

441 
	`ü—‹Clu¡”Node
(
NULL
,
CLUSTER_NODE_MYSELF
|
CLUSTER_NODE_MASTER
);

442 
	`£rv”Log
(
LL_NOTICE
,"No cluster configuration found, I'm %.40s",

443 
my£lf
->
Çme
);

444 
	`şu¡”AddNode
(
my£lf
);

445 
§vecÚf
 = 1;

447 ià(
§vecÚf
è
	`şu¡”SaveCÚfigOrD›
(1);

450 
£rv”
.
cfd_couÁ
 = 0;

455 ià(
£rv”
.
pÜt
 > (65535-
CLUSTER_PORT_INCR
)) {

456 
	`£rv”Log
(
LL_WARNING
, "Redis…ort‚umberoo high. "

461 
	`ex™
(1);

464 ià(
	`li¡’ToPÜt
(
£rv”
.
pÜt
+
CLUSTER_PORT_INCR
,

465 
£rv”
.
cfd
,&£rv”.
cfd_couÁ
è=ğ
C_ERR
)

467 
	`ex™
(1);

469 
j
;

471 
j
 = 0; j < 
£rv”
.
cfd_couÁ
; j++) {

472 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, s”v”.
cfd
[
j
], 
AE_READABLE
,

473 
şu¡”Acû±HªdËr
, 
NULL
è=ğ
AE_ERR
)

474 
	`£rv”Pªic
("Unrecoverableƒrror creating Redis Cluster "

480 
£rv”
.
şu¡”
->
¦Ùs_to_keys
 = 
	`z¦C»©e
();

484 
my£lf
->
pÜt
 = 
£rv”
.port;

485 
my£lf
->
ıÜt
 = 
£rv”
.
pÜt
+
CLUSTER_PORT_INCR
;

486 ià(
£rv”
.
şu¡”_ªnounû_pÜt
)

487 
my£lf
->
pÜt
 = 
£rv”
.
şu¡”_ªnounû_pÜt
;

488 ià(
£rv”
.
şu¡”_ªnounû_bus_pÜt
)

489 
my£lf
->
ıÜt
 = 
£rv”
.
şu¡”_ªnounû_bus_pÜt
;

491 
£rv”
.
şu¡”
->
mf_’d
 = 0;

492 
	`»£tMªu®Faov”
();

493 
	}
}

504 
	$şu¡”Re£t
(
h¬d
) {

505 
diùI‹¿tÜ
 *
di
;

506 
diùEÁry
 *
de
;

507 
j
;

510 ià(
	`nodeIsSÏve
(
my£lf
)) {

511 
	`şu¡”S‘NodeAsMa¡”
(
my£lf
);

512 
	`»¶iÿtiÚUn£tMa¡”
();

513 
	`em±yDb
(-1,
EMPTYDB_NO_FLAGS
,
NULL
);

517 
	`şu¡”Clo£AÎSlÙs
();

518 
	`»£tMªu®Faov”
();

521 
j
 = 0; j < 
CLUSTER_SLOTS
; j++è
	`şu¡”D–SlÙ
(j);

524 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

525 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

526 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

528 ià(
node
 =ğ
my£lf
) ;

529 
	`şu¡”D–Node
(
node
);

531 
	`diùR–—£I‹¿tÜ
(
di
);

534 ià(
h¬d
) {

535 
sds
 
ŞdÇme
;

537 
£rv”
.
şu¡”
->
cu¼’tEpoch
 = 0;

538 
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
 = 0;

539 
my£lf
->
cÚfigEpoch
 = 0;

540 
	`£rv”Log
(
LL_WARNING
, "configEpoch seto 0 via CLUSTER RESET HARD");

544 
ŞdÇme
 = 
	`sd¢ewËn
(
my£lf
->
Çme
, 
CLUSTER_NAMELEN
);

545 
	`diùD–‘e
(
£rv”
.
şu¡”
->
nodes
,
ŞdÇme
);

546 
	`sdsä“
(
ŞdÇme
);

547 
	`g‘RªdomHexCh¬s
(
my£lf
->
Çme
, 
CLUSTER_NAMELEN
);

548 
	`şu¡”AddNode
(
my£lf
);

549 
	`£rv”Log
(
LL_NOTICE
,"Nodh¬d„e£t,‚ow I'm %.40s", 
my£lf
->
Çme
);

553 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

554 
CLUSTER_TODO_UPDATE_STATE
|

555 
CLUSTER_TODO_FSYNC_CONFIG
);

556 
	}
}

562 
şu¡”Lšk
 *
	$ü—‹Clu¡”Lšk
(
şu¡”Node
 *
node
) {

563 
şu¡”Lšk
 *
lšk
 = 
	`zm®loc
((*link));

564 
lšk
->
ùime
 = 
	`m¡ime
();

565 
lšk
->
¢dbuf
 = 
	`sd£m±y
();

566 
lšk
->
rcvbuf
 = 
	`sd£m±y
();

567 
lšk
->
node
 =‚ode;

568 
lšk
->
fd
 = -1;

569  
lšk
;

570 
	}
}

575 
	$ä“Clu¡”Lšk
(
şu¡”Lšk
 *
lšk
) {

576 ià(
lšk
->
fd
 != -1) {

577 
	`«D–‘eFeEv’t
(
£rv”
.
–
, 
lšk
->
fd
, 
AE_WRITABLE
);

578 
	`«D–‘eFeEv’t
(
£rv”
.
–
, 
lšk
->
fd
, 
AE_READABLE
);

580 
	`sdsä“
(
lšk
->
¢dbuf
);

581 
	`sdsä“
(
lšk
->
rcvbuf
);

582 ià(
lšk
->
node
)

583 
lšk
->
node
->lšk = 
NULL
;

584 
	`şo£
(
lšk
->
fd
);

585 
	`zä“
(
lšk
);

586 
	}
}

588 
	#MAX_CLUSTER_ACCEPTS_PER_CALL
 1000

	)

589 
	$şu¡”Acû±HªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

590 
ıÜt
, 
cfd
;

591 
max
 = 
MAX_CLUSTER_ACCEPTS_PER_CALL
;

592 
c
[
NET_IP_STR_LEN
];

593 
şu¡”Lšk
 *
lšk
;

594 
	`UNUSED
(
–
);

595 
	`UNUSED
(
mask
);

596 
	`UNUSED
(
´ivd©a
);

600 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
 && s”v”.
lßdšg
) ;

602 
max
--) {

603 
cfd
 = 
	`ª‘TıAcû±
(
£rv”
.
Ã‹¼
, 
fd
, 
c
, (c), &
ıÜt
);

604 ià(
cfd
 =ğ
ANET_ERR
) {

605 ià(
”ºo
 !ğ
EWOULDBLOCK
)

606 
	`£rv”Log
(
LL_VERBOSE
,

607 "E¼Ü‡cû±šg clu¡”‚ode: %s", 
£rv”
.
Ã‹¼
);

610 
	`ª‘NÚBlock
(
NULL
,
cfd
);

611 
	`ª‘EÇbËTıNoD–ay
(
NULL
,
cfd
);

614 
	`£rv”Log
(
LL_VERBOSE
,"Acû±ed clu¡”‚od%s:%d", 
c
, 
ıÜt
);

620 
lšk
 = 
	`ü—‹Clu¡”Lšk
(
NULL
);

621 
lšk
->
fd
 = 
cfd
;

622 
	`«C»©eFeEv’t
(
£rv”
.
–
,
cfd
,
AE_READABLE
,
şu¡”R—dHªdËr
,
lšk
);

624 
	}
}

636 
	$keyHashSlÙ
(*
key
, 
keyËn
) {

637 
s
, 
e
;

639 
s
 = 0; s < 
keyËn
; s++)

640 ià(
key
[
s
] == '{') ;

643 ià(
s
 =ğ
keyËn
è 
	`üc16
(
key
,keylen) & 0x3FFF;

646 
e
 = 
s
+1;ƒ < 
keyËn
;ƒ++)

647 ià(
key
[
e
] == '}') ;

650 ià(
e
 =ğ
keyËn
 ||ƒ =ğ
s
+1è 
	`üc16
(
key
,keylen) & 0x3FFF;

654  
	`üc16
(
key
+
s
+1,
e
-s-1) & 0x3FFF;

655 
	}
}

668 
şu¡”Node
 *
	$ü—‹Clu¡”Node
(*
nod’ame
, 
æags
) {

669 
şu¡”Node
 *
node
 = 
	`zm®loc
((*node));

671 ià(
nod’ame
)

672 
	`memıy
(
node
->
Çme
, 
nod’ame
, 
CLUSTER_NAMELEN
);

674 
	`g‘RªdomHexCh¬s
(
node
->
Çme
, 
CLUSTER_NAMELEN
);

675 
node
->
ùime
 = 
	`m¡ime
();

676 
node
->
cÚfigEpoch
 = 0;

677 
node
->
æags
 = flags;

678 
	`mem£t
(
node
->
¦Ùs
,0,(node->slots));

679 
node
->
num¦Ùs
 = 0;

680 
node
->
num¦aves
 = 0;

681 
node
->
¦aves
 = 
NULL
;

682 
node
->
¦aveof
 = 
NULL
;

683 
node
->
pšg_£Á
 =‚ode->
pÚg_»ûived
 = 0;

684 
node
->
ç_time
 = 0;

685 
node
->
lšk
 = 
NULL
;

686 
	`mem£t
(
node
->

,0,(node->ip));

687 
node
->
pÜt
 = 0;

688 
node
->
ıÜt
 = 0;

689 
node
->
ç_»pÜts
 = 
	`li¡C»©e
();

690 
node
->
vÙed_time
 = 0;

691 
node
->
Üphªed_time
 = 0;

692 
node
->
»¶_off£t_time
 = 0;

693 
node
->
»¶_off£t
 = 0;

694 
	`li¡S‘F»eM‘hod
(
node
->
ç_»pÜts
,
zä“
);

695  
node
;

696 
	}
}

708 
	$şu¡”NodeAddFau»R•Üt
(
şu¡”Node
 *
çšg
, clu¡”Nod*
£nd”
) {

709 
li¡
 *
l
 = 
çšg
->
ç_»pÜts
;

710 
li¡Node
 *
Ê
;

711 
li¡I‹r
 
li
;

712 
şu¡”NodeFaR•Üt
 *
ä
;

716 
	`li¡Rewšd
(
l
,&
li
);

717 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

718 
ä
 = 
Ê
->
v®ue
;

719 ià(
ä
->
node
 =ğ
£nd”
) {

720 
ä
->
time
 = 
	`m¡ime
();

726 
ä
 = 
	`zm®loc
((*fr));

727 
ä
->
node
 = 
£nd”
;

728 
ä
->
time
 = 
	`m¡ime
();

729 
	`li¡AddNodeTa
(
l
,
ä
);

731 
	}
}

738 
	$şu¡”NodeCËªupFau»R•Üts
(
şu¡”Node
 *
node
) {

739 
li¡
 *
l
 = 
node
->
ç_»pÜts
;

740 
li¡Node
 *
Ê
;

741 
li¡I‹r
 
li
;

742 
şu¡”NodeFaR•Üt
 *
ä
;

743 
m¡ime_t
 
maxtime
 = 
£rv”
.
şu¡”_node_timeout
 *

744 
CLUSTER_FAIL_REPORT_VALIDITY_MULT
;

745 
m¡ime_t
 
now
 = 
	`m¡ime
();

747 
	`li¡Rewšd
(
l
,&
li
);

748 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

749 
ä
 = 
Ê
->
v®ue
;

750 ià(
now
 - 
ä
->
time
 > 
maxtime
è
	`li¡D–Node
(
l
,
Ê
);

752 
	}
}

765 
	$şu¡”NodeD–Fau»R•Üt
(
şu¡”Node
 *
node
, clu¡”Nod*
£nd”
) {

766 
li¡
 *
l
 = 
node
->
ç_»pÜts
;

767 
li¡Node
 *
Ê
;

768 
li¡I‹r
 
li
;

769 
şu¡”NodeFaR•Üt
 *
ä
;

772 
	`li¡Rewšd
(
l
,&
li
);

773 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

774 
ä
 = 
Ê
->
v®ue
;

775 ià(
ä
->
node
 =ğ
£nd”
) ;

777 ià(!
Ê
)  0;

780 
	`li¡D–Node
(
l
,
Ê
);

781 
	`şu¡”NodeCËªupFau»R•Üts
(
node
);

783 
	}
}

788 
	$şu¡”NodeFau»R•ÜtsCouÁ
(
şu¡”Node
 *
node
) {

789 
	`şu¡”NodeCËªupFau»R•Üts
(
node
);

790  
	`li¡L’gth
(
node
->
ç_»pÜts
);

791 
	}
}

793 
	$şu¡”NodeRemoveSÏve
(
şu¡”Node
 *
ma¡”
, clu¡”Nod*
¦ave
) {

794 
j
;

796 
j
 = 0; j < 
ma¡”
->
num¦aves
; j++) {

797 ià(
ma¡”
->
¦aves
[
j
] =ğ
¦ave
) {

798 ià((
j
+1è< 
ma¡”
->
num¦aves
) {

799 
»maššg_¦aves
 = (
ma¡”
->
num¦aves
 - 
j
) - 1;

800 
	`memmove
(
ma¡”
->
¦aves
+
j
,master->slaves+(j+1),

801 ((*
ma¡”
->
¦aves
è* 
»maššg_¦aves
));

803 
ma¡”
->
num¦aves
--;

804 ià(
ma¡”
->
num¦aves
 == 0)

805 
ma¡”
->
æags
 &ğ~
CLUSTER_NODE_MIGRATE_TO
;

806  
C_OK
;

809  
C_ERR
;

810 
	}
}

812 
	$şu¡”NodeAddSÏve
(
şu¡”Node
 *
ma¡”
, clu¡”Nod*
¦ave
) {

813 
j
;

816 
j
 = 0; j < 
ma¡”
->
num¦aves
; j++)

817 ià(
ma¡”
->
¦aves
[
j
] =ğ
¦ave
è 
C_ERR
;

818 
ma¡”
->
¦aves
 = 
	`z»®loc
(master->slaves,

819 (
şu¡”Node
*)*(
ma¡”
->
num¦aves
+1));

820 
ma¡”
->
¦aves
[ma¡”->
num¦aves
] = 
¦ave
;

821 
ma¡”
->
num¦aves
++;

822 
ma¡”
->
æags
 |ğ
CLUSTER_NODE_MIGRATE_TO
;

823  
C_OK
;

824 
	}
}

826 
	$şu¡”CouÁNÚFašgSÏves
(
şu¡”Node
 *
n
) {

827 
j
, 
ok¦aves
 = 0;

829 
j
 = 0; j < 
n
->
num¦aves
; j++)

830 ià(!
	`nodeFaed
(
n
->
¦aves
[
j
])è
ok¦aves
++;

831  
ok¦aves
;

832 
	}
}

835 
	$ä“Clu¡”Node
(
şu¡”Node
 *
n
) {

836 
sds
 
nod’ame
;

837 
j
;

841 
j
 = 0; j < 
n
->
num¦aves
; j++)

842 
n
->
¦aves
[
j
]->
¦aveof
 = 
NULL
;

845 ià(
	`nodeIsSÏve
(
n
è&&‚->
¦aveof
è
	`şu¡”NodeRemoveSÏve
(n->slaveof,n);

848 
nod’ame
 = 
	`sd¢ewËn
(
n
->
Çme
, 
CLUSTER_NAMELEN
);

849 
	`£rv”As£¹
(
	`diùD–‘e
(
£rv”
.
şu¡”
->
nodes
,
nod’ame
è=ğ
DICT_OK
);

850 
	`sdsä“
(
nod’ame
);

853 ià(
n
->
lšk
è
	`ä“Clu¡”Lšk
(n->link);

854 
	`li¡R–—£
(
n
->
ç_»pÜts
);

855 
	`zä“
(
n
->
¦aves
);

856 
	`zä“
(
n
);

857 
	}
}

860 
	$şu¡”AddNode
(
şu¡”Node
 *
node
) {

861 
»tv®
;

863 
»tv®
 = 
	`diùAdd
(
£rv”
.
şu¡”
->
nodes
,

864 
	`sd¢ewËn
(
node
->
Çme
,
CLUSTER_NAMELEN
),‚ode);

865  (
»tv®
 =ğ
DICT_OK
è? 
C_OK
 : 
C_ERR
;

866 
	}
}

879 
	$şu¡”D–Node
(
şu¡”Node
 *
d–node
) {

880 
j
;

881 
diùI‹¿tÜ
 *
di
;

882 
diùEÁry
 *
de
;

885 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

886 ià(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
] =ğ
d–node
)

887 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
] = 
NULL
;

888 ià(
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
j
] =ğ
d–node
)

889 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
j
] = 
NULL
;

890 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
d–node
)

891 
	`şu¡”D–SlÙ
(
j
);

895 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

896 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

897 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

899 ià(
node
 =ğ
d–node
) ;

900 
	`şu¡”NodeD–Fau»R•Üt
(
node
,
d–node
);

902 
	`diùR–—£I‹¿tÜ
(
di
);

905 
	`ä“Clu¡”Node
(
d–node
);

906 
	}
}

909 
şu¡”Node
 *
	$şu¡”LookupNode
(*
Çme
) {

910 
sds
 
s
 = 
	`sd¢ewËn
(
Çme
, 
CLUSTER_NAMELEN
);

911 
diùEÁry
 *
de
;

913 
de
 = 
	`diùFšd
(
£rv”
.
şu¡”
->
nodes
,
s
);

914 
	`sdsä“
(
s
);

915 ià(
de
 =ğ
NULL
)  NULL;

916  
	`diùG‘V®
(
de
);

917 
	}
}

923 
	$şu¡”R’ameNode
(
şu¡”Node
 *
node
, *
ÃwÇme
) {

924 
»tv®
;

925 
sds
 
s
 = 
	`sd¢ewËn
(
node
->
Çme
, 
CLUSTER_NAMELEN
);

927 
	`£rv”Log
(
LL_DEBUG
,"Renaming‚ode %.40s into %.40s",

928 
node
->
Çme
, 
ÃwÇme
);

929 
»tv®
 = 
	`diùD–‘e
(
£rv”
.
şu¡”
->
nodes
, 
s
);

930 
	`sdsä“
(
s
);

931 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

932 
	`memıy
(
node
->
Çme
, 
ÃwÇme
, 
CLUSTER_NAMELEN
);

933 
	`şu¡”AddNode
(
node
);

934 
	}
}

942 
ušt64_t
 
	$şu¡”G‘MaxEpoch
() {

943 
ušt64_t
 
max
 = 0;

944 
diùI‹¿tÜ
 *
di
;

945 
diùEÁry
 *
de
;

947 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

948 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

949 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

950 ià(
node
->
cÚfigEpoch
 > 
max
) max =‚ode->configEpoch;

952 
	`diùR–—£I‹¿tÜ
(
di
);

953 ià(
max
 < 
£rv”
.
şu¡”
->
cu¼’tEpoch
) max = server.cluster->currentEpoch;

954  
max
;

955 
	}
}

986 
	$şu¡”BumpCÚfigEpochW™houtCÚ£nsus
() {

987 
ušt64_t
 
maxEpoch
 = 
	`şu¡”G‘MaxEpoch
();

989 ià(
my£lf
->
cÚfigEpoch
 == 0 ||

990 
my£lf
->
cÚfigEpoch
 !ğ
maxEpoch
)

992 
£rv”
.
şu¡”
->
cu¼’tEpoch
++;

993 
my£lf
->
cÚfigEpoch
 = 
£rv”
.
şu¡”
->
cu¼’tEpoch
;

994 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

995 
CLUSTER_TODO_FSYNC_CONFIG
);

996 
	`£rv”Log
(
LL_WARNING
,

998 (è
my£lf
->
cÚfigEpoch
);

999  
C_OK
;

1001  
C_ERR
;

1003 
	}
}

1051 
	$şu¡”HªdËCÚfigEpochCŞlisiÚ
(
şu¡”Node
 *
£nd”
) {

1053 ià(
£nd”
->
cÚfigEpoch
 !ğ
my£lf
->configEpoch ||

1054 !
	`nodeIsMa¡”
(
£nd”
è|| !nodeIsMa¡”(
my£lf
)) ;

1056 ià(
	`memcmp
(
£nd”
->
Çme
,
my£lf
->Çme,
CLUSTER_NAMELEN
) <= 0) ;

1058 
£rv”
.
şu¡”
->
cu¼’tEpoch
++;

1059 
my£lf
->
cÚfigEpoch
 = 
£rv”
.
şu¡”
->
cu¼’tEpoch
;

1060 
	`şu¡”SaveCÚfigOrD›
(1);

1061 
	`£rv”Log
(
LL_VERBOSE
,

1064 
£nd”
->
Çme
,

1065 (è
my£lf
->
cÚfigEpoch
);

1066 
	}
}

1090 
	#CLUSTER_BLACKLIST_TTL
 60

	)

1099 
	$şu¡”BÏckli¡CËªup
() {

1100 
diùI‹¿tÜ
 *
di
;

1101 
diùEÁry
 *
de
;

1103 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes_bÏck_li¡
);

1104 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1105 
št64_t
 
expœe
 = 
	`diùG‘UnsigÃdIÁeg”V®
(
de
);

1107 ià(
expœe
 < 
£rv”
.
unixtime
)

1108 
	`diùD–‘e
(
£rv”
.
şu¡”
->
nodes_bÏck_li¡
,
	`diùG‘Key
(
de
));

1110 
	`diùR–—£I‹¿tÜ
(
di
);

1111 
	}
}

1114 
	$şu¡”BÏckli¡AddNode
(
şu¡”Node
 *
node
) {

1115 
diùEÁry
 *
de
;

1116 
sds
 
id
 = 
	`sd¢ewËn
(
node
->
Çme
,
CLUSTER_NAMELEN
);

1118 
	`şu¡”BÏckli¡CËªup
();

1119 ià(
	`diùAdd
(
£rv”
.
şu¡”
->
nodes_bÏck_li¡
,
id
,
NULL
è=ğ
DICT_OK
) {

1122 
id
 = 
	`sdsdup
(id);

1124 
de
 = 
	`diùFšd
(
£rv”
.
şu¡”
->
nodes_bÏck_li¡
,
id
);

1125 
	`diùS‘UnsigÃdIÁeg”V®
(
de
,
	`time
(
NULL
)+
CLUSTER_BLACKLIST_TTL
);

1126 
	`sdsä“
(
id
);

1127 
	}
}

1132 
	$şu¡”BÏckli¡Exi¡s
(*
nodeid
) {

1133 
sds
 
id
 = 
	`sd¢ewËn
(
nodeid
,
CLUSTER_NAMELEN
);

1134 
»tv®
;

1136 
	`şu¡”BÏckli¡CËªup
();

1137 
»tv®
 = 
	`diùFšd
(
£rv”
.
şu¡”
->
nodes_bÏck_li¡
,
id
è!ğ
NULL
;

1138 
	`sdsä“
(
id
);

1139  
»tv®
;

1140 
	}
}

1167 
	$m¬kNodeAsFašgIfN“ded
(
şu¡”Node
 *
node
) {

1168 
çu»s
;

1169 
Ãeded_quÜum
 = (
£rv”
.
şu¡”
->
size
 / 2) + 1;

1171 ià(!
	`nodeTimedOut
(
node
)) ;

1172 ià(
	`nodeFaed
(
node
)) ;

1174 
çu»s
 = 
	`şu¡”NodeFau»R•ÜtsCouÁ
(
node
);

1176 ià(
	`nodeIsMa¡”
(
my£lf
)è
çu»s
++;

1177 ià(
çu»s
 < 
Ãeded_quÜum
) ;

1179 
	`£rv”Log
(
LL_NOTICE
,

1180 "M¬kšg‚od%.40 a çšg (quÜum„—ched).", 
node
->
Çme
);

1183 
node
->
æags
 &ğ~
CLUSTER_NODE_PFAIL
;

1184 
node
->
æags
 |ğ
CLUSTER_NODE_FAIL
;

1185 
node
->
ç_time
 = 
	`m¡ime
();

1189 ià(
	`nodeIsMa¡”
(
my£lf
)è
	`şu¡”S’dFa
(
node
->
Çme
);

1190 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

1191 
	}
}

1196 
	$ş—rNodeFau»IfN“ded
(
şu¡”Node
 *
node
) {

1197 
m¡ime_t
 
now
 = 
	`m¡ime
();

1199 
	`£rv”As£¹
(
	`nodeFaed
(
node
));

1203 ià(
	`nodeIsSÏve
(
node
è||‚ode->
num¦Ùs
 == 0) {

1204 
	`£rv”Log
(
LL_NOTICE
,

1206 
node
->
Çme
,

1207 
	`nodeIsSÏve
(
node
) ? "slave" : "master without slots");

1208 
node
->
æags
 &ğ~
CLUSTER_NODE_FAIL
;

1209 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

1216 ià(
	`nodeIsMa¡”
(
node
è&&‚ode->
num¦Ùs
 > 0 &&

1217 (
now
 - 
node
->
ç_time
) >

1218 (
£rv”
.
şu¡”_node_timeout
 * 
CLUSTER_FAIL_UNDO_TIME_MULT
))

1220 
	`£rv”Log
(
LL_NOTICE
,

1222 
node
->
Çme
);

1223 
node
->
æags
 &ğ~
CLUSTER_NODE_FAIL
;

1224 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

1226 
	}
}

1231 
	$şu¡”HªdshakeInProg»ss
(*

, 
pÜt
, 
ıÜt
) {

1232 
diùI‹¿tÜ
 *
di
;

1233 
diùEÁry
 *
de
;

1235 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

1236 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1237 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

1239 ià(!
	`nodeInHªdshake
(
node
)) ;

1240 ià(!
	`¡rÿ£cmp
(
node
->

,ip) &&

1241 
node
->
pÜt
 ==…ort &&

1242 
node
->
ıÜt
 == cport) ;

1244 
	`diùR–—£I‹¿tÜ
(
di
);

1245  
de
 !ğ
NULL
;

1246 
	}
}

1255 
	$şu¡”S¹Hªdshake
(*

, 
pÜt
, 
ıÜt
) {

1256 
şu¡”Node
 *
n
;

1257 
nÜm_
[
NET_IP_STR_LEN
];

1258 
sockaddr_¡Üage
 
§
;

1261 ià(
	`š‘_±Ú
(
AF_INET
,

,

1262 &(((
sockaddr_š
 *)&
§
)->
sš_addr
)))

1264 
§
.
ss_çmy
 = 
AF_INET
;

1265 } ià(
	`š‘_±Ú
(
AF_INET6
,

,

1266 &(((
sockaddr_š6
 *)&
§
)->
sš6_addr
)))

1268 
§
.
ss_çmy
 = 
AF_INET6
;

1270 
”ºo
 = 
EINVAL
;

1275 ià(
pÜt
 <ğ0 ||…Üˆ> 65535 || 
ıÜt
 <= 0 || cport > 65535) {

1276 
”ºo
 = 
EINVAL
;

1282 
	`mem£t
(
nÜm_
,0,
NET_IP_STR_LEN
);

1283 ià(
§
.
ss_çmy
 =ğ
AF_INET
)

1284 
	`š‘_Áİ
(
AF_INET
,

1285 (*)&(((
sockaddr_š
 *)&
§
)->
sš_addr
),

1286 
nÜm_
,
NET_IP_STR_LEN
);

1288 
	`š‘_Áİ
(
AF_INET6
,

1289 (*)&(((
sockaddr_š6
 *)&
§
)->
sš6_addr
),

1290 
nÜm_
,
NET_IP_STR_LEN
);

1292 ià(
	`şu¡”HªdshakeInProg»ss
(
nÜm_
,
pÜt
,
ıÜt
)) {

1293 
”ºo
 = 
EAGAIN
;

1300 
n
 = 
	`ü—‹Clu¡”Node
(
NULL
,
CLUSTER_NODE_HANDSHAKE
|
CLUSTER_NODE_MEET
);

1301 
	`memıy
(
n
->

,
nÜm_
,(n->ip));

1302 
n
->
pÜt
 =…ort;

1303 
n
->
ıÜt
 = cport;

1304 
	`şu¡”AddNode
(
n
);

1306 
	}
}

1312 
	$şu¡”ProûssGossSeùiÚ
(
şu¡”Msg
 *
hdr
, 
şu¡”Lšk
 *
lšk
) {

1313 
ušt16_t
 
couÁ
 = 
	`Áohs
(
hdr
->count);

1314 
şu¡”MsgD©aGoss
 *
g
 = (şu¡”MsgD©aGoss*è
hdr
->
d©a
.
pšg
.
goss
;

1315 
şu¡”Node
 *
£nd”
 = 
lšk
->
node
 ?†šk->nod: 
	`şu¡”LookupNode
(
hdr
->sender);

1317 
couÁ
--) {

1318 
ušt16_t
 
æags
 = 
	`Áohs
(
g
->flags);

1319 
şu¡”Node
 *
node
;

1320 
sds
 
ci
;

1322 
ci
 = 
	`»´e£ÁClu¡”NodeFÏgs
(
	`sd£m±y
(), 
æags
);

1323 
	`£rv”Log
(
LL_DEBUG
,"GOSSIP %.40s %s:%d@%d %s",

1324 
g
->
nod’ame
,

1325 
g
->

,

1326 
	`Áohs
(
g
->
pÜt
),

1327 
	`Áohs
(
g
->
ıÜt
),

1328 
ci
);

1329 
	`sdsä“
(
ci
);

1332 
node
 = 
	`şu¡”LookupNode
(
g
->
nod’ame
);

1333 ià(
node
) {

1336 ià(
£nd”
 && 
	`nodeIsMa¡”
(£nd”è&& 
node
 !ğ
my£lf
) {

1337 ià(
æags
 & (
CLUSTER_NODE_FAIL
|
CLUSTER_NODE_PFAIL
)) {

1338 ià(
	`şu¡”NodeAddFau»R•Üt
(
node
,
£nd”
)) {

1339 
	`£rv”Log
(
LL_VERBOSE
,

1341 
£nd”
->
Çme
, 
node
->name);

1343 
	`m¬kNodeAsFašgIfN“ded
(
node
);

1345 ià(
	`şu¡”NodeD–Fau»R•Üt
(
node
,
£nd”
)) {

1346 
	`£rv”Log
(
LL_VERBOSE
,

1348 
£nd”
->
Çme
, 
node
->name);

1358 ià(
node
->
æags
 & (
CLUSTER_NODE_FAIL
|
CLUSTER_NODE_PFAIL
) &&

1359 !(
æags
 & 
CLUSTER_NODE_NOADDR
) &&

1360 !(
æags
 & (
CLUSTER_NODE_FAIL
|
CLUSTER_NODE_PFAIL
)) &&

1361 (
	`¡rÿ£cmp
(
node
->

,
g
->ip) ||

1362 
node
->
pÜt
 !ğ
	`Áohs
(
g
->port) ||

1363 
node
->
ıÜt
 !ğ
	`Áohs
(
g
->cport)))

1365 ià(
node
->
lšk
è
	`ä“Clu¡”Lšk
(node->link);

1366 
	`memıy
(
node
->

,
g
->,
NET_IP_STR_LEN
);

1367 
node
->
pÜt
 = 
	`Áohs
(
g
->port);

1368 
node
->
ıÜt
 = 
	`Áohs
(
g
->cport);

1369 
node
->
æags
 &ğ~
CLUSTER_NODE_NOADDR
;

1378 ià(
£nd”
 &&

1379 !(
æags
 & 
CLUSTER_NODE_NOADDR
) &&

1380 !
	`şu¡”BÏckli¡Exi¡s
(
g
->
nod’ame
))

1382 
	`şu¡”S¹Hªdshake
(
g
->

,
	`Áohs
(g->
pÜt
),Áohs(g->
ıÜt
));

1387 
g
++;

1389 
	}
}

1394 
	$nodeIp2SŒšg
(*
buf
, 
şu¡”Lšk
 *
lšk
, *
ªnounûd_
) {

1395 ià(
ªnounûd_
[0] != '\0') {

1396 
	`memıy
(
buf
,
ªnounûd_
,
NET_IP_STR_LEN
);

1397 
buf
[
NET_IP_STR_LEN
-1] = '\0';

1399 
	`ª‘P“rToSŒšg
(
lšk
->
fd
, 
buf
, 
NET_IP_STR_LEN
, 
NULL
);

1401 
	}
}

1415 
	$nodeUpd©eAdd»ssIfN“ded
(
şu¡”Node
 *
node
, 
şu¡”Lšk
 *
lšk
,

1416 
şu¡”Msg
 *
hdr
)

1418 

[
NET_IP_STR_LEN
] = {0};

1419 
pÜt
 = 
	`Áohs
(
hdr
->port);

1420 
ıÜt
 = 
	`Áohs
(
hdr
->cport);

1428 ià(
lšk
 =ğ
node
->link)  0;

1430 
	`nodeIp2SŒšg
(

,
lšk
,
hdr
->
my
);

1431 ià(
node
->
pÜt
 =ğpÜˆ&&‚ode->
ıÜt
 == cport &&

1432 
	`¡rcmp
(

,
node
->ip) == 0)  0;

1435 
	`memıy
(
node
->

,ip,(ip));

1436 
node
->
pÜt
 =…ort;

1437 
node
->
ıÜt
 = cport;

1438 ià(
node
->
lšk
è
	`ä“Clu¡”Lšk
(node->link);

1439 
node
->
æags
 &ğ~
CLUSTER_NODE_NOADDR
;

1440 
	`£rv”Log
(
LL_WARNING
,"Address updated for‚ode %.40s,‚ow %s:%d",

1441 
node
->
Çme
,‚ode->

,‚ode->
pÜt
);

1445 ià(
	`nodeIsSÏve
(
my£lf
è&& my£lf->
¦aveof
 =ğ
node
)

1446 
	`»¶iÿtiÚS‘Ma¡”
(
node
->

,‚ode->
pÜt
);

1448 
	}
}

1453 
	$şu¡”S‘NodeAsMa¡”
(
şu¡”Node
 *
n
) {

1454 ià(
	`nodeIsMa¡”
(
n
)) ;

1456 ià(
n
->
¦aveof
) {

1457 
	`şu¡”NodeRemoveSÏve
(
n
->
¦aveof
,n);

1458 ià(
n
 !ğ
my£lf
èn->
æags
 |ğ
CLUSTER_NODE_MIGRATE_TO
;

1460 
n
->
æags
 &ğ~
CLUSTER_NODE_SLAVE
;

1461 
n
->
æags
 |ğ
CLUSTER_NODE_MASTER
;

1462 
n
->
¦aveof
 = 
NULL
;

1465 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1466 
CLUSTER_TODO_UPDATE_STATE
);

1467 
	}
}

1480 
	$şu¡”Upd©eSlÙsCÚfigW™h
(
şu¡”Node
 *
£nd”
, 
ušt64_t
 
£nd”CÚfigEpoch
, *
¦Ùs
) {

1481 
j
;

1482 
şu¡”Node
 *
curma¡”
, *
Ãwma¡”
 = 
NULL
;

1490 
ušt16_t
 
dœty_¦Ùs
[
CLUSTER_SLOTS
];

1491 
dœty_¦Ùs_couÁ
 = 0;

1496 
curma¡”
 = 
	`nodeIsMa¡”
(
my£lf
è? my£là: my£lf->
¦aveof
;

1498 ià(
£nd”
 =ğ
my£lf
) {

1499 
	`£rv”Log
(
LL_WARNING
,"Discarding UPDATE message‡bout myself.");

1503 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

1504 ià(
	`b™m­Te¡B™
(
¦Ùs
,
j
)) {

1506 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
£nd”
) ;

1512 ià(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
]) ;

1518 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
NULL
 ||

1519 
£rv”
.
şu¡”
->
¦Ùs
[
j
]->
cÚfigEpoch
 < 
£nd”CÚfigEpoch
)

1523 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
my£lf
 &&

1524 
	`couÁKeysInSlÙ
(
j
) &&

1525 
£nd”
 !ğ
my£lf
)

1527 
dœty_¦Ùs
[
dœty_¦Ùs_couÁ
] = 
j
;

1528 
dœty_¦Ùs_couÁ
++;

1531 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
curma¡”
)

1532 
Ãwma¡”
 = 
£nd”
;

1533 
	`şu¡”D–SlÙ
(
j
);

1534 
	`şu¡”AddSlÙ
(
£nd”
,
j
);

1535 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1536 
CLUSTER_TODO_UPDATE_STATE
|

1537 
CLUSTER_TODO_FSYNC_CONFIG
);

1549 ià(
Ãwma¡”
 && 
curma¡”
->
num¦Ùs
 == 0) {

1550 
	`£rv”Log
(
LL_WARNING
,

1552 "a ¨»¶iÿ oà%.40s", 
£nd”
->
Çme
);

1553 
	`şu¡”S‘Ma¡”
(
£nd”
);

1554 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1555 
CLUSTER_TODO_UPDATE_STATE
|

1556 
CLUSTER_TODO_FSYNC_CONFIG
);

1557 } ià(
dœty_¦Ùs_couÁ
) {

1565 
j
 = 0; j < 
dœty_¦Ùs_couÁ
; j++)

1566 
	`d–KeysInSlÙ
(
dœty_¦Ùs
[
j
]);

1568 
	}
}

1579 
	$şu¡”ProûssPack‘
(
şu¡”Lšk
 *
lšk
) {

1580 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
lšk
->
rcvbuf
;

1581 
ušt32_t
 
tÙËn
 = 
	`Áohl
(
hdr
->totlen);

1582 
ušt16_t
 
ty³
 = 
	`Áohs
(
hdr
->type);

1584 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_»ûived
++;

1585 
	`£rv”Log
(
LL_DEBUG
,"--- Processing…acket ofype %d, %lu bytes",

1586 
ty³
, (è
tÙËn
);

1589 ià(
tÙËn
 < 16)  1;

1590 ià(
tÙËn
 > 
	`sd¦’
(
lšk
->
rcvbuf
))  1;

1592 ià(
	`Áohs
(
hdr
->
v”
è!ğ
CLUSTER_PROTO_VER
) {

1597 
ušt16_t
 
æags
 = 
	`Áohs
(
hdr
->flags);

1598 
ušt64_t
 
£nd”Cu¼’tEpoch
 = 0, 
£nd”CÚfigEpoch
 = 0;

1599 
şu¡”Node
 *
£nd”
;

1601 ià(
ty³
 =ğ
CLUSTERMSG_TYPE_PING
 ||y³ =ğ
CLUSTERMSG_TYPE_PONG
 ||

1602 
ty³
 =ğ
CLUSTERMSG_TYPE_MEET
)

1604 
ušt16_t
 
couÁ
 = 
	`Áohs
(
hdr
->count);

1605 
ušt32_t
 
ex¶’
;

1607 
ex¶’
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

1608 
ex¶’
 +ğ((
şu¡”MsgD©aGoss
)*
couÁ
);

1609 ià(
tÙËn
 !ğ
ex¶’
)  1;

1610 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAIL
) {

1611 
ušt32_t
 
ex¶’
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

1613 
ex¶’
 +ğ(
şu¡”MsgD©aFa
);

1614 ià(
tÙËn
 !ğ
ex¶’
)  1;

1615 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_PUBLISH
) {

1616 
ušt32_t
 
ex¶’
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

1618 
ex¶’
 +ğ(
şu¡”MsgD©aPublish
) -

1620 
	`Áohl
(
hdr
->
d©a
.
publish
.
msg
.
chªÃl_Ën
) +

1621 
	`Áohl
(
hdr
->
d©a
.
publish
.
msg
.
mes§ge_Ën
);

1622 ià(
tÙËn
 !ğ
ex¶’
)  1;

1623 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAILOVER_AUTH_REQUEST
 ||

1624 
ty³
 =ğ
CLUSTERMSG_TYPE_FAILOVER_AUTH_ACK
 ||

1625 
ty³
 =ğ
CLUSTERMSG_TYPE_MFSTART
)

1627 
ušt32_t
 
ex¶’
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

1629 ià(
tÙËn
 !ğ
ex¶’
)  1;

1630 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_UPDATE
) {

1631 
ušt32_t
 
ex¶’
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

1633 
ex¶’
 +ğ(
şu¡”MsgD©aUpd©e
);

1634 ià(
tÙËn
 !ğ
ex¶’
)  1;

1638 
£nd”
 = 
	`şu¡”LookupNode
(
hdr
->sender);

1639 ià(
£nd”
 && !
	`nodeInHªdshake
(sender)) {

1641 
£nd”Cu¼’tEpoch
 = 
	`Áohu64
(
hdr
->
cu¼’tEpoch
);

1642 
£nd”CÚfigEpoch
 = 
	`Áohu64
(
hdr
->
cÚfigEpoch
);

1643 ià(
£nd”Cu¼’tEpoch
 > 
£rv”
.
şu¡”
->
cu¼’tEpoch
)

1644 
£rv”
.
şu¡”
->
cu¼’tEpoch
 = 
£nd”Cu¼’tEpoch
;

1646 ià(
£nd”CÚfigEpoch
 > 
£nd”
->
cÚfigEpoch
) {

1647 
£nd”
->
cÚfigEpoch
 = 
£nd”CÚfigEpoch
;

1648 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1649 
CLUSTER_TODO_FSYNC_CONFIG
);

1652 
£nd”
->
»¶_off£t
 = 
	`Áohu64
(
hdr
->
off£t
);

1653 
£nd”
->
»¶_off£t_time
 = 
	`m¡ime
();

1656 ià(
£rv”
.
şu¡”
->
mf_’d
 &&

1657 
	`nodeIsSÏve
(
my£lf
) &&

1658 
my£lf
->
¦aveof
 =ğ
£nd”
 &&

1659 
hdr
->
mæags
[0] & 
CLUSTERMSG_FLAG0_PAUSED
 &&

1660 
£rv”
.
şu¡”
->
mf_ma¡”_off£t
 == 0)

1662 
£rv”
.
şu¡”
->
mf_ma¡”_off£t
 = 
£nd”
->
»¶_off£t
;

1663 
	`£rv”Log
(
LL_WARNING
,

1666 
£rv”
.
şu¡”
->
mf_ma¡”_off£t
);

1671 ià(
ty³
 =ğ
CLUSTERMSG_TYPE_PING
 ||y³ =ğ
CLUSTERMSG_TYPE_MEET
) {

1672 
	`£rv”Log
(
LL_DEBUG
,"Pšg…ack‘„eûived: %p", (*)
lšk
->
node
);

1685 ià((
ty³
 =ğ
CLUSTERMSG_TYPE_MEET
 || 
my£lf
->

[0] == '\0') &&

1686 
£rv”
.
şu¡”_ªnounû_
 =ğ
NULL
)

1688 

[
NET_IP_STR_LEN
];

1690 ià(
	`ª‘SockName
(
lšk
->
fd
,

,(),
NULL
) != -1 &&

1691 
	`¡rcmp
(

,
my£lf
->ip))

1693 
	`memıy
(
my£lf
->

,,
NET_IP_STR_LEN
);

1694 
	`£rv”Log
(
LL_WARNING
,"IP‡ddress forhis‚ode updatedo %s",

1695 
my£lf
->

);

1696 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
);

1704 ià(!
£nd”
 && 
ty³
 =ğ
CLUSTERMSG_TYPE_MEET
) {

1705 
şu¡”Node
 *
node
;

1707 
node
 = 
	`ü—‹Clu¡”Node
(
NULL
,
CLUSTER_NODE_HANDSHAKE
);

1708 
	`nodeIp2SŒšg
(
node
->

,
lšk
,
hdr
->
my
);

1709 
node
->
pÜt
 = 
	`Áohs
(
hdr
->port);

1710 
node
->
ıÜt
 = 
	`Áohs
(
hdr
->cport);

1711 
	`şu¡”AddNode
(
node
);

1712 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
);

1718 ià(!
£nd”
 && 
ty³
 =ğ
CLUSTERMSG_TYPE_MEET
)

1719 
	`şu¡”ProûssGossSeùiÚ
(
hdr
,
lšk
);

1722 
	`şu¡”S’dPšg
(
lšk
,
CLUSTERMSG_TYPE_PONG
);

1726 ià(
ty³
 =ğ
CLUSTERMSG_TYPE_PING
 ||y³ =ğ
CLUSTERMSG_TYPE_PONG
 ||

1727 
ty³
 =ğ
CLUSTERMSG_TYPE_MEET
)

1729 
	`£rv”Log
(
LL_DEBUG
,"%s…acket„eceived: %p",

1730 
ty³
 =ğ
CLUSTERMSG_TYPE_PING
 ? "ping" : "pong",

1731 (*)
lšk
->
node
);

1732 ià(
lšk
->
node
) {

1733 ià(
	`nodeInHªdshake
(
lšk
->
node
)) {

1736 ià(
£nd”
) {

1737 
	`£rv”Log
(
LL_VERBOSE
,

1739 "upd©šghadd»s iàÃeded.", 
£nd”
->
Çme
);

1740 ià(
	`nodeUpd©eAdd»ssIfN“ded
(
£nd”
,
lšk
,
hdr
))

1742 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1743 
CLUSTER_TODO_UPDATE_STATE
);

1747 
	`şu¡”D–Node
(
lšk
->
node
);

1753 
	`şu¡”R’ameNode
(
lšk
->
node
, 
hdr
->
£nd”
);

1754 
	`£rv”Log
(
LL_DEBUG
,"Handshake with‚ode %.40s completed.",

1755 
lšk
->
node
->
Çme
);

1756 
lšk
->
node
->
æags
 &ğ~
CLUSTER_NODE_HANDSHAKE
;

1757 
lšk
->
node
->
æags
 |ğæags&(
CLUSTER_NODE_MASTER
|
CLUSTER_NODE_SLAVE
);

1758 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
);

1759 } ià(
	`memcmp
(
lšk
->
node
->
Çme
,
hdr
->
£nd”
,

1760 
CLUSTER_NAMELEN
) != 0)

1765 
	`£rv”Log
(
LL_DEBUG
,"PONG contains mismatching sender ID. About‚ode %.40s‡dded %d ms‡go, having flags %d",

1766 
lšk
->
node
->
Çme
,

1767 ()(
	`m¡ime
()-(
lšk
->
node
->
ùime
)),

1768 
lšk
->
node
->
æags
);

1769 
lšk
->
node
->
æags
 |ğ
CLUSTER_NODE_NOADDR
;

1770 
lšk
->
node
->

[0] = '\0';

1771 
lšk
->
node
->
pÜt
 = 0;

1772 
lšk
->
node
->
ıÜt
 = 0;

1773 
	`ä“Clu¡”Lšk
(
lšk
);

1774 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
);

1780 ià(
£nd”
 && 
ty³
 =ğ
CLUSTERMSG_TYPE_PING
 &&

1781 !
	`nodeInHªdshake
(
£nd”
) &&

1782 
	`nodeUpd©eAdd»ssIfN“ded
(
£nd”
,
lšk
,
hdr
))

1784 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1785 
CLUSTER_TODO_UPDATE_STATE
);

1789 ià(
lšk
->
node
 && 
ty³
 =ğ
CLUSTERMSG_TYPE_PONG
) {

1790 
lšk
->
node
->
pÚg_»ûived
 = 
	`m¡ime
();

1791 
lšk
->
node
->
pšg_£Á
 = 0;

1799 ià(
	`nodeTimedOut
(
lšk
->
node
)) {

1800 
lšk
->
node
->
æags
 &ğ~
CLUSTER_NODE_PFAIL
;

1801 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1802 
CLUSTER_TODO_UPDATE_STATE
);

1803 } ià(
	`nodeFaed
(
lšk
->
node
)) {

1804 
	`ş—rNodeFau»IfN“ded
(
lšk
->
node
);

1809 ià(
£nd”
) {

1810 ià(!
	`memcmp
(
hdr
->
¦aveof
,
CLUSTER_NODE_NULL_NAME
,

1811 (
hdr
->
¦aveof
)))

1814 
	`şu¡”S‘NodeAsMa¡”
(
£nd”
);

1817 
şu¡”Node
 *
ma¡”
 = 
	`şu¡”LookupNode
(
hdr
->
¦aveof
);

1819 ià(
	`nodeIsMa¡”
(
£nd”
)) {

1821 
	`şu¡”D–NodeSlÙs
(
£nd”
);

1822 
£nd”
->
æags
 &ğ~(
CLUSTER_NODE_MASTER
|

1823 
CLUSTER_NODE_MIGRATE_TO
);

1824 
£nd”
->
æags
 |ğ
CLUSTER_NODE_SLAVE
;

1827 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1828 
CLUSTER_TODO_UPDATE_STATE
);

1832 ià(
ma¡”
 && 
£nd”
->
¦aveof
 != master) {

1833 ià(
£nd”
->
¦aveof
)

1834 
	`şu¡”NodeRemoveSÏve
(
£nd”
->
¦aveof
,sender);

1835 
	`şu¡”NodeAddSÏve
(
ma¡”
,
£nd”
);

1836 
£nd”
->
¦aveof
 = 
ma¡”
;

1839 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
);

1853 
şu¡”Node
 *
£nd”_ma¡”
 = 
NULL
;

1854 
dœty_¦Ùs
 = 0;

1856 ià(
£nd”
) {

1857 
£nd”_ma¡”
 = 
	`nodeIsMa¡”
(
£nd”
è? s’d” : s’d”->
¦aveof
;

1858 ià(
£nd”_ma¡”
) {

1859 
dœty_¦Ùs
 = 
	`memcmp
(
£nd”_ma¡”
->
¦Ùs
,

1860 
hdr
->
my¦Ùs
,(hdr->myslots)) != 0;

1867 ià(
£nd”
 && 
	`nodeIsMa¡”
(£nd”è&& 
dœty_¦Ùs
)

1868 
	`şu¡”Upd©eSlÙsCÚfigW™h
(
£nd”
,
£nd”CÚfigEpoch
,
hdr
->
my¦Ùs
);

1888 ià(
£nd”
 && 
dœty_¦Ùs
) {

1889 
j
;

1891 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

1892 ià(
	`b™m­Te¡B™
(
hdr
->
my¦Ùs
,
j
)) {

1893 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
£nd”
 ||

1894 
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
NULL
) ;

1895 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
]->
cÚfigEpoch
 >

1896 
£nd”CÚfigEpoch
)

1898 
	`£rv”Log
(
LL_VERBOSE
,

1901 
£nd”
->
Çme
, 
£rv”
.
şu¡”
->
¦Ùs
[
j
]->name);

1902 
	`şu¡”S’dUpd©e
(
£nd”
->
lšk
,

1903 
£rv”
.
şu¡”
->
¦Ùs
[
j
]);

1916 ià(
£nd”
 &&

1917 
	`nodeIsMa¡”
(
my£lf
è&&‚odeIsMa¡”(
£nd”
) &&

1918 
£nd”CÚfigEpoch
 =ğ
my£lf
->
cÚfigEpoch
)

1920 
	`şu¡”HªdËCÚfigEpochCŞlisiÚ
(
£nd”
);

1924 ià(
£nd”
è
	`şu¡”ProûssGossSeùiÚ
(
hdr
,
lšk
);

1925 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAIL
) {

1926 
şu¡”Node
 *
çšg
;

1928 ià(
£nd”
) {

1929 
çšg
 = 
	`şu¡”LookupNode
(
hdr
->
d©a
.
ç
.
about
.
nod’ame
);

1930 ià(
çšg
 &&

1931 !(
çšg
->
æags
 & (
CLUSTER_NODE_FAIL
|
CLUSTER_NODE_MYSELF
)))

1933 
	`£rv”Log
(
LL_NOTICE
,

1935 
hdr
->
£nd”
, hdr->
d©a
.
ç
.
about
.
nod’ame
);

1936 
çšg
->
æags
 |ğ
CLUSTER_NODE_FAIL
;

1937 
çšg
->
ç_time
 = 
	`m¡ime
();

1938 
çšg
->
æags
 &ğ~
CLUSTER_NODE_PFAIL
;

1939 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

1940 
CLUSTER_TODO_UPDATE_STATE
);

1943 
	`£rv”Log
(
LL_NOTICE
,

1945 
hdr
->
£nd”
, hdr->
d©a
.
ç
.
about
.
nod’ame
);

1947 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_PUBLISH
) {

1948 
robj
 *
chªÃl
, *
mes§ge
;

1949 
ušt32_t
 
chªÃl_Ën
, 
mes§ge_Ën
;

1953 ià(
	`diùSize
(
£rv”
.
pubsub_chªÃls
) ||

1954 
	`li¡L’gth
(
£rv”
.
pubsub_·‰”ns
))

1956 
chªÃl_Ën
 = 
	`Áohl
(
hdr
->
d©a
.
publish
.
msg
.channel_len);

1957 
mes§ge_Ën
 = 
	`Áohl
(
hdr
->
d©a
.
publish
.
msg
.message_len);

1958 
chªÃl
 = 
	`ü—‹SŒšgObjeù
(

1959 (*)
hdr
->
d©a
.
publish
.
msg
.
bulk_d©a
,
chªÃl_Ën
);

1960 
mes§ge
 = 
	`ü—‹SŒšgObjeù
(

1961 (*)
hdr
->
d©a
.
publish
.
msg
.
bulk_d©a
+
chªÃl_Ën
,

1962 
mes§ge_Ën
);

1963 
	`pubsubPublishMes§ge
(
chªÃl
,
mes§ge
);

1964 
	`deüRefCouÁ
(
chªÃl
);

1965 
	`deüRefCouÁ
(
mes§ge
);

1967 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAILOVER_AUTH_REQUEST
) {

1968 ià(!
£nd”
)  1;

1969 
	`şu¡”S’dFaov”AuthIfN“ded
(
£nd”
,
hdr
);

1970 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAILOVER_AUTH_ACK
) {

1971 ià(!
£nd”
)  1;

1975 ià(
	`nodeIsMa¡”
(
£nd”
è&& s’d”->
num¦Ùs
 > 0 &&

1976 
£nd”Cu¼’tEpoch
 >ğ
£rv”
.
şu¡”
->
çov”_auth_•och
)

1978 
£rv”
.
şu¡”
->
çov”_auth_couÁ
++;

1981 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_HANDLE_FAILOVER
);

1983 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_MFSTART
) {

1986 ià(!
£nd”
 || s’d”->
¦aveof
 !ğ
my£lf
)  1;

1989 
	`»£tMªu®Faov”
();

1990 
£rv”
.
şu¡”
->
mf_’d
 = 
	`m¡ime
(è+ 
CLUSTER_MF_TIMEOUT
;

1991 
£rv”
.
şu¡”
->
mf_¦ave
 = 
£nd”
;

1992 
	`·u£Cl›Ás
(
	`m¡ime
()+(
CLUSTER_MF_TIMEOUT
*2));

1993 
	`£rv”Log
(
LL_WARNING
,"Manual failover„equested by slave %.40s.",

1994 
£nd”
->
Çme
);

1995 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_UPDATE
) {

1996 
şu¡”Node
 *
n
;

1997 
ušt64_t
 
»pÜ‹dCÚfigEpoch
 =

1998 
	`Áohu64
(
hdr
->
d©a
.
upd©e
.
nodecfg
.
cÚfigEpoch
);

2000 ià(!
£nd”
)  1;

2001 
n
 = 
	`şu¡”LookupNode
(
hdr
->
d©a
.
upd©e
.
nodecfg
.
nod’ame
);

2002 ià(!
n
)  1;

2003 ià(
n
->
cÚfigEpoch
 >ğ
»pÜ‹dCÚfigEpoch
)  1;

2006 ià(
	`nodeIsSÏve
(
n
)è
	`şu¡”S‘NodeAsMa¡”
(n);

2009 
n
->
cÚfigEpoch
 = 
»pÜ‹dCÚfigEpoch
;

2010 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

2011 
CLUSTER_TODO_FSYNC_CONFIG
);

2015 
	`şu¡”Upd©eSlÙsCÚfigW™h
(
n
,
»pÜ‹dCÚfigEpoch
,

2016 
hdr
->
d©a
.
upd©e
.
nodecfg
.
¦Ùs
);

2018 
	`£rv”Log
(
LL_WARNING
,"Reûived unknowÀ·ck‘y³: %d", 
ty³
);

2021 
	}
}

2029 
	$hªdËLškIOE¼Ü
(
şu¡”Lšk
 *
lšk
) {

2030 
	`ä“Clu¡”Lšk
(
lšk
);

2031 
	}
}

2036 
	$şu¡”Wr™eHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

2037 
şu¡”Lšk
 *
lšk
 = (şu¡”Lšk*è
´ivd©a
;

2038 
ssize_t
 
nwr™‹n
;

2039 
	`UNUSED
(
–
);

2040 
	`UNUSED
(
mask
);

2042 
nwr™‹n
 = 
	`wr™e
(
fd
, 
lšk
->
¢dbuf
, 
	`sd¦’
(link->sndbuf));

2043 ià(
nwr™‹n
 <= 0) {

2044 
	`£rv”Log
(
LL_DEBUG
,"I/Oƒrror writingo‚ode†ink: %s",

2045 
	`¡»¼Ü
(
”ºo
));

2046 
	`hªdËLškIOE¼Ü
(
lšk
);

2049 
	`sd¤ªge
(
lšk
->
¢dbuf
,
nwr™‹n
,-1);

2050 ià(
	`sd¦’
(
lšk
->
¢dbuf
) == 0)

2051 
	`«D–‘eFeEv’t
(
£rv”
.
–
, 
lšk
->
fd
, 
AE_WRITABLE
);

2052 
	}
}

2057 
	$şu¡”R—dHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

2058 
buf
[(
şu¡”Msg
)];

2059 
ssize_t
 
Ä—d
;

2060 
şu¡”Msg
 *
hdr
;

2061 
şu¡”Lšk
 *
lšk
 = (şu¡”Lšk*è
´ivd©a
;

2062 
»adËn
, 
rcvbuæ’
;

2063 
	`UNUSED
(
–
);

2064 
	`UNUSED
(
mask
);

2067 
rcvbuæ’
 = 
	`sd¦’
(
lšk
->
rcvbuf
);

2068 ià(
rcvbuæ’
 < 8) {

2071 
»adËn
 = 8 - 
rcvbuæ’
;

2074 
hdr
 = (
şu¡”Msg
*è
lšk
->
rcvbuf
;

2075 ià(
rcvbuæ’
 == 8) {

2078 ià(
	`memcmp
(
hdr
->
sig
,"RCmb",4) != 0 ||

2079 
	`Áohl
(
hdr
->
tÙËn
è< 
CLUSTERMSG_MIN_LEN
)

2081 
	`£rv”Log
(
LL_WARNING
,

2084 
	`hªdËLškIOE¼Ü
(
lšk
);

2088 
»adËn
 = 
	`Áohl
(
hdr
->
tÙËn
è- 
rcvbuæ’
;

2089 ià(
»adËn
 > (
buf
))„eadlen = (buf);

2092 
Ä—d
 = 
	`»ad
(
fd
,
buf
,
»adËn
);

2093 ià(
Ä—d
 =ğ-1 && 
”ºo
 =ğ
EAGAIN
) ;

2095 ià(
Ä—d
 <= 0) {

2097 
	`£rv”Log
(
LL_DEBUG
,"I/Oƒrror„eading from‚ode†ink: %s",

2098 (
Ä—d
 =ğ0è? "cÚÃùiÚ clo£d" : 
	`¡»¼Ü
(
”ºo
));

2099 
	`hªdËLškIOE¼Ü
(
lšk
);

2103 
lšk
->
rcvbuf
 = 
	`sdsÿ’
Öšk->rcvbuf,
buf
,
Ä—d
);

2104 
hdr
 = (
şu¡”Msg
*è
lšk
->
rcvbuf
;

2105 
rcvbuæ’
 +ğ
Ä—d
;

2109 ià(
rcvbuæ’
 >ğ8 &&„cvbuæ’ =ğ
	`Áohl
(
hdr
->
tÙËn
)) {

2110 ià(
	`şu¡”ProûssPack‘
(
lšk
)) {

2111 
	`sdsä“
(
lšk
->
rcvbuf
);

2112 
lšk
->
rcvbuf
 = 
	`sd£m±y
();

2118 
	}
}

2125 
	$şu¡”S’dMes§ge
(
şu¡”Lšk
 *
lšk
, *
msg
, 
size_t
 
msgËn
) {

2126 ià(
	`sd¦’
(
lšk
->
¢dbuf
è=ğ0 && 
msgËn
 != 0)

2127 
	`«C»©eFeEv’t
(
£rv”
.
–
,
lšk
->
fd
,
AE_WRITABLE
,

2128 
şu¡”Wr™eHªdËr
,
lšk
);

2130 
lšk
->
¢dbuf
 = 
	`sdsÿ’
Öšk->¢dbuf, 
msg
, 
msgËn
);

2131 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_£Á
++;

2132 
	}
}

2140 
	$şu¡”Brßdÿ¡Mes§ge
(*
buf
, 
size_t
 
Ën
) {

2141 
diùI‹¿tÜ
 *
di
;

2142 
diùEÁry
 *
de
;

2144 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

2145 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2146 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

2148 ià(!
node
->
lšk
) ;

2149 ià(
node
->
æags
 & (
CLUSTER_NODE_MYSELF
|
CLUSTER_NODE_HANDSHAKE
))

2151 
	`şu¡”S’dMes§ge
(
node
->
lšk
,
buf
,
Ën
);

2153 
	`diùR–—£I‹¿tÜ
(
di
);

2154 
	}
}

2158 
	$şu¡”BudMes§geHdr
(
şu¡”Msg
 *
hdr
, 
ty³
) {

2159 
tÙËn
 = 0;

2160 
ušt64_t
 
off£t
;

2161 
şu¡”Node
 *
ma¡”
;

2167 
ma¡”
 = (
	`nodeIsSÏve
(
my£lf
è&& my£lf->
¦aveof
) ?

2168 
my£lf
->
¦aveof
 : myself;

2170 
	`mem£t
(
hdr
,0,(*hdr));

2171 
hdr
->
v”
 = 
	`htÚs
(
CLUSTER_PROTO_VER
);

2172 
hdr
->
sig
[0] = 'R';

2173 
hdr
->
sig
[1] = 'C';

2174 
hdr
->
sig
[2] = 'm';

2175 
hdr
->
sig
[3] = 'b';

2176 
hdr
->
ty³
 = 
	`htÚs
(type);

2177 
	`memıy
(
hdr
->
£nd”
,
my£lf
->
Çme
,
CLUSTER_NAMELEN
);

2182 
	`mem£t
(
hdr
->
my
,0,
NET_IP_STR_LEN
);

2183 ià(
£rv”
.
şu¡”_ªnounû_
) {

2184 
	`¡ºıy
(
hdr
->
my
,
£rv”
.
şu¡”_ªnounû_
,
NET_IP_STR_LEN
);

2185 
hdr
->
my
[
NET_IP_STR_LEN
-1] = '\0';

2189 
ªnounûd_pÜt
 = 
£rv”
.
şu¡”_ªnounû_pÜt
 ?

2190 
£rv”
.
şu¡”_ªnounû_pÜt
 : s”v”.
pÜt
;

2191 
ªnounûd_ıÜt
 = 
£rv”
.
şu¡”_ªnounû_bus_pÜt
 ?

2192 
£rv”
.
şu¡”_ªnounû_bus_pÜt
 :

2193 (
£rv”
.
pÜt
 + 
CLUSTER_PORT_INCR
);

2195 
	`memıy
(
hdr
->
my¦Ùs
,
ma¡”
->
¦Ùs
,(hdr->myslots));

2196 
	`mem£t
(
hdr
->
¦aveof
,0,
CLUSTER_NAMELEN
);

2197 ià(
my£lf
->
¦aveof
 !ğ
NULL
)

2198 
	`memıy
(
hdr
->
¦aveof
,
my£lf
->¦aveof->
Çme
, 
CLUSTER_NAMELEN
);

2199 
hdr
->
pÜt
 = 
	`htÚs
(
ªnounûd_pÜt
);

2200 
hdr
->
ıÜt
 = 
	`htÚs
(
ªnounûd_ıÜt
);

2201 
hdr
->
æags
 = 
	`htÚs
(
my£lf
->flags);

2202 
hdr
->
¡©e
 = 
£rv”
.
şu¡”
->state;

2205 
hdr
->
cu¼’tEpoch
 = 
	`htÚu64
(
£rv”
.
şu¡”
->currentEpoch);

2206 
hdr
->
cÚfigEpoch
 = 
	`htÚu64
(
ma¡”
->configEpoch);

2209 ià(
	`nodeIsSÏve
(
my£lf
))

2210 
off£t
 = 
	`»¶iÿtiÚG‘SÏveOff£t
();

2212 
off£t
 = 
£rv”
.
ma¡”_»¶_off£t
;

2213 
hdr
->
off£t
 = 
	`htÚu64
(offset);

2216 ià(
	`nodeIsMa¡”
(
my£lf
è&& 
£rv”
.
şu¡”
->
mf_’d
)

2217 
hdr
->
mæags
[0] |ğ
CLUSTERMSG_FLAG0_PAUSED
;

2221 ià(
ty³
 =ğ
CLUSTERMSG_TYPE_FAIL
) {

2222 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2223 
tÙËn
 +ğ(
şu¡”MsgD©aFa
);

2224 } ià(
ty³
 =ğ
CLUSTERMSG_TYPE_UPDATE
) {

2225 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2226 
tÙËn
 +ğ(
şu¡”MsgD©aUpd©e
);

2228 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2230 
	}
}

2234 
	$şu¡”S’dPšg
(
şu¡”Lšk
 *
lšk
, 
ty³
) {

2235 *
buf
;

2236 
şu¡”Msg
 *
hdr
;

2237 
gosscouÁ
 = 0;

2238 
wª‹d
;

2239 
tÙËn
;

2244 
äeshnodes
 = 
	`diùSize
(
£rv”
.
şu¡”
->
nodes
)-2;

2272 
wª‹d
 = 
	`æoÜ
(
	`diùSize
(
£rv”
.
şu¡”
->
nodes
)/10);

2273 ià(
wª‹d
 < 3) wanted = 3;

2274 ià(
wª‹d
 > 
äeshnodes
) wanted = freshnodes;

2279 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2280 
tÙËn
 +ğ((
şu¡”MsgD©aGoss
)*
wª‹d
);

2283 ià(
tÙËn
 < ()(
şu¡”Msg
))otlen = (clusterMsg);

2284 
buf
 = 
	`zÿÎoc
(
tÙËn
);

2285 
hdr
 = (
şu¡”Msg
*è
buf
;

2288 ià(
lšk
->
node
 && 
ty³
 =ğ
CLUSTERMSG_TYPE_PING
)

2289 
lšk
->
node
->
pšg_£Á
 = 
	`m¡ime
();

2290 
	`şu¡”BudMes§geHdr
(
hdr
,
ty³
);

2293 
max™”©iÚs
 = 
wª‹d
*3;

2294 
äeshnodes
 > 0 && 
gosscouÁ
 < 
wª‹d
 && 
max™”©iÚs
--) {

2295 
diùEÁry
 *
de
 = 
	`diùG‘RªdomKey
(
£rv”
.
şu¡”
->
nodes
);

2296 
şu¡”Node
 *
this
 = 
	`diùG‘V®
(
de
);

2297 
şu¡”MsgD©aGoss
 *
goss
;

2298 
j
;

2302 ià(
this
 =ğ
my£lf
) ;

2305 ià(
max™”©iÚs
 > 
wª‹d
*2 &&

2306 !(
this
->
æags
 & (
CLUSTER_NODE_PFAIL
|
CLUSTER_NODE_FAIL
)))

2314 ià(
this
->
æags
 & (
CLUSTER_NODE_HANDSHAKE
|
CLUSTER_NODE_NOADDR
) ||

2315 (
this
->
lšk
 =ğ
NULL
 &&his->
num¦Ùs
 == 0))

2317 
äeshnodes
--;

2322 
j
 = 0; j < 
gosscouÁ
; j++) {

2323 ià(
	`memcmp
(
hdr
->
d©a
.
pšg
.
goss
[
j
].
nod’ame
,
this
->
Çme
,

2324 
CLUSTER_NAMELEN
) == 0) ;

2326 ià(
j
 !ğ
gosscouÁ
) ;

2329 
äeshnodes
--;

2330 
goss
 = &(
hdr
->
d©a
.
pšg
.goss[
gosscouÁ
]);

2331 
	`memıy
(
goss
->
nod’ame
,
this
->
Çme
,
CLUSTER_NAMELEN
);

2332 
goss
->
pšg_£Á
 = 
	`htÚl
(
this
->ping_sent);

2333 
goss
->
pÚg_»ûived
 = 
	`htÚl
(
this
->pong_received);

2334 
	`memıy
(
goss
->

,
this
->ip,(this->ip));

2335 
goss
->
pÜt
 = 
	`htÚs
(
this
->port);

2336 
goss
->
ıÜt
 = 
	`htÚs
(
this
->cport);

2337 
goss
->
æags
 = 
	`htÚs
(
this
->flags);

2338 
goss
->
nÙu£d1
 = 0;

2339 
gosscouÁ
++;

2344 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2345 
tÙËn
 +ğ((
şu¡”MsgD©aGoss
)*
gosscouÁ
);

2346 
hdr
->
couÁ
 = 
	`htÚs
(
gosscouÁ
);

2347 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2348 
	`şu¡”S’dMes§ge
(
lšk
,
buf
,
tÙËn
);

2349 
	`zä“
(
buf
);

2350 
	}
}

2366 
	#CLUSTER_BROADCAST_ALL
 0

	)

2367 
	#CLUSTER_BROADCAST_LOCAL_SLAVES
 1

	)

2368 
	$şu¡”Brßdÿ¡PÚg
(
rg‘
) {

2369 
diùI‹¿tÜ
 *
di
;

2370 
diùEÁry
 *
de
;

2372 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

2373 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2374 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

2376 ià(!
node
->
lšk
) ;

2377 ià(
node
 =ğ
my£lf
 || 
	`nodeInHªdshake
(node)) ;

2378 ià(
rg‘
 =ğ
CLUSTER_BROADCAST_LOCAL_SLAVES
) {

2379 
loÿl_¦ave
 =

2380 
	`nodeIsSÏve
(
node
è&&‚ode->
¦aveof
 &&

2381 (
node
->
¦aveof
 =ğ
my£lf
 ||‚ode->slaveof == myself->slaveof);

2382 ià(!
loÿl_¦ave
) ;

2384 
	`şu¡”S’dPšg
(
node
->
lšk
,
CLUSTERMSG_TYPE_PONG
);

2386 
	`diùR–—£I‹¿tÜ
(
di
);

2387 
	}
}

2392 
	$şu¡”S’dPublish
(
şu¡”Lšk
 *
lšk
, 
robj
 *
chªÃl
,„obj *
mes§ge
) {

2393 
buf
[(
şu¡”Msg
)], *
·ylßd
;

2394 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2395 
ušt32_t
 
tÙËn
;

2396 
ušt32_t
 
chªÃl_Ën
, 
mes§ge_Ën
;

2398 
chªÃl
 = 
	`g‘DecodedObjeù
(channel);

2399 
mes§ge
 = 
	`g‘DecodedObjeù
(message);

2400 
chªÃl_Ën
 = 
	`sd¦’
(
chªÃl
->
±r
);

2401 
mes§ge_Ën
 = 
	`sd¦’
(
mes§ge
->
±r
);

2403 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_PUBLISH
);

2404 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2405 
tÙËn
 +ğ(
şu¡”MsgD©aPublish
è- 8 + 
chªÃl_Ën
 + 
mes§ge_Ën
;

2407 
hdr
->
d©a
.
publish
.
msg
.
chªÃl_Ën
 = 
	`htÚl
(channel_len);

2408 
hdr
->
d©a
.
publish
.
msg
.
mes§ge_Ën
 = 
	`htÚl
(message_len);

2409 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2412 ià(
tÙËn
 < (
buf
)) {

2413 
·ylßd
 = 
buf
;

2415 
·ylßd
 = 
	`zm®loc
(
tÙËn
);

2416 
	`memıy
(
·ylßd
,
hdr
,(*hdr));

2417 
hdr
 = (
şu¡”Msg
*è
·ylßd
;

2419 
	`memıy
(
hdr
->
d©a
.
publish
.
msg
.
bulk_d©a
,
chªÃl
->
±r
,
	`sd¦’
(channel->ptr));

2420 
	`memıy
(
hdr
->
d©a
.
publish
.
msg
.
bulk_d©a
+
	`sd¦’
(
chªÃl
->
±r
),

2421 
mes§ge
->
±r
,
	`sd¦’
(message->ptr));

2423 ià(
lšk
)

2424 
	`şu¡”S’dMes§ge
(
lšk
,
·ylßd
,
tÙËn
);

2426 
	`şu¡”Brßdÿ¡Mes§ge
(
·ylßd
,
tÙËn
);

2428 
	`deüRefCouÁ
(
chªÃl
);

2429 
	`deüRefCouÁ
(
mes§ge
);

2430 ià(
·ylßd
 !ğ
buf
è
	`zä“
(payload);

2431 
	}
}

2438 
	$şu¡”S’dFa
(*
nod’ame
) {

2439 
buf
[(
şu¡”Msg
)];

2440 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2442 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_FAIL
);

2443 
	`memıy
(
hdr
->
d©a
.
ç
.
about
.
nod’ame
,nod’ame,
CLUSTER_NAMELEN
);

2444 
	`şu¡”Brßdÿ¡Mes§ge
(
buf
,
	`Áohl
(
hdr
->
tÙËn
));

2445 
	}
}

2450 
	$şu¡”S’dUpd©e
(
şu¡”Lšk
 *
lšk
, 
şu¡”Node
 *
node
) {

2451 
buf
[(
şu¡”Msg
)];

2452 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2454 ià(
lšk
 =ğ
NULL
) ;

2455 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_UPDATE
);

2456 
	`memıy
(
hdr
->
d©a
.
upd©e
.
nodecfg
.
nod’ame
,
node
->
Çme
,
CLUSTER_NAMELEN
);

2457 
hdr
->
d©a
.
upd©e
.
nodecfg
.
cÚfigEpoch
 = 
	`htÚu64
(
node
->configEpoch);

2458 
	`memıy
(
hdr
->
d©a
.
upd©e
.
nodecfg
.
¦Ùs
,
node
->slots,(node->slots));

2459 
	`şu¡”S’dMes§ge
(
lšk
,
buf
,
	`Áohl
(
hdr
->
tÙËn
));

2460 
	}
}

2469 
	$şu¡”Prİag©ePublish
(
robj
 *
chªÃl
,„obj *
mes§ge
) {

2470 
	`şu¡”S’dPublish
(
NULL
, 
chªÃl
, 
mes§ge
);

2471 
	}
}

2483 
	$şu¡”Reque¡Faov”Auth
() {

2484 
buf
[(
şu¡”Msg
)];

2485 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2486 
ušt32_t
 
tÙËn
;

2488 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_FAILOVER_AUTH_REQUEST
);

2492 ià(
£rv”
.
şu¡”
->
mf_’d
è
hdr
->
mæags
[0] |ğ
CLUSTERMSG_FLAG0_FORCEACK
;

2493 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2494 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2495 
	`şu¡”Brßdÿ¡Mes§ge
(
buf
,
tÙËn
);

2496 
	}
}

2499 
	$şu¡”S’dFaov”Auth
(
şu¡”Node
 *
node
) {

2500 
buf
[(
şu¡”Msg
)];

2501 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2502 
ušt32_t
 
tÙËn
;

2504 ià(!
node
->
lšk
) ;

2505 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_FAILOVER_AUTH_ACK
);

2506 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2507 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2508 
	`şu¡”S’dMes§ge
(
node
->
lšk
,
buf
,
tÙËn
);

2509 
	}
}

2512 
	$şu¡”S’dMFS¹
(
şu¡”Node
 *
node
) {

2513 
buf
[(
şu¡”Msg
)];

2514 
şu¡”Msg
 *
hdr
 = (şu¡”Msg*è
buf
;

2515 
ušt32_t
 
tÙËn
;

2517 ià(!
node
->
lšk
) ;

2518 
	`şu¡”BudMes§geHdr
(
hdr
,
CLUSTERMSG_TYPE_MFSTART
);

2519 
tÙËn
 = (
şu¡”Msg
)-(
şu¡”MsgD©a
);

2520 
hdr
->
tÙËn
 = 
	`htÚl
(totlen);

2521 
	`şu¡”S’dMes§ge
(
node
->
lšk
,
buf
,
tÙËn
);

2522 
	}
}

2525 
	$şu¡”S’dFaov”AuthIfN“ded
(
şu¡”Node
 *
node
, 
şu¡”Msg
 *
»que¡
) {

2526 
şu¡”Node
 *
ma¡”
 = 
node
->
¦aveof
;

2527 
ušt64_t
 
»que¡Cu¼’tEpoch
 = 
	`Áohu64
(
»que¡
->
cu¼’tEpoch
);

2528 
ušt64_t
 
»que¡CÚfigEpoch
 = 
	`Áohu64
(
»que¡
->
cÚfigEpoch
);

2529 *
şaimed_¦Ùs
 = 
»que¡
->
my¦Ùs
;

2530 
fÜû_ack
 = 
»que¡
->
mæags
[0] & 
CLUSTERMSG_FLAG0_FORCEACK
;

2531 
j
;

2537 ià(
	`nodeIsSÏve
(
my£lf
è|| my£lf->
num¦Ùs
 == 0) ;

2543 ià(
»que¡Cu¼’tEpoch
 < 
£rv”
.
şu¡”
->
cu¼’tEpoch
) {

2544 
	`£rv”Log
(
LL_WARNING
,

2546 
node
->
Çme
,

2547 (è
»que¡Cu¼’tEpoch
,

2548 (è
£rv”
.
şu¡”
->
cu¼’tEpoch
);

2553 ià(
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
 =ğ£rv”.şu¡”->
cu¼’tEpoch
) {

2554 
	`£rv”Log
(
LL_WARNING
,

2556 
node
->
Çme
,

2557 (è
£rv”
.
şu¡”
->
cu¼’tEpoch
);

2564 ià(
	`nodeIsMa¡”
(
node
è|| 
ma¡”
 =ğ
NULL
 ||

2565 (!
	`nodeFaed
(
ma¡”
è&& !
fÜû_ack
))

2567 ià(
	`nodeIsMa¡”
(
node
)) {

2568 
	`£rv”Log
(
LL_WARNING
,

2570 
node
->
Çme
);

2571 } ià(
ma¡”
 =ğ
NULL
) {

2572 
	`£rv”Log
(
LL_WARNING
,

2574 
node
->
Çme
);

2575 } ià(!
	`nodeFaed
(
ma¡”
)) {

2576 
	`£rv”Log
(
LL_WARNING
,

2578 
node
->
Çme
);

2586 ià(
	`m¡ime
(è- 
node
->
¦aveof
->
vÙed_time
 < 
£rv”
.
şu¡”_node_timeout
 * 2)

2588 
	`£rv”Log
(
LL_WARNING
,

2591 
node
->
Çme
,

2592 (è((
£rv”
.
şu¡”_node_timeout
*2)-

2593 (
	`m¡ime
(è- 
node
->
¦aveof
->
vÙed_time
)));

2600 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

2601 ià(
	`b™m­Te¡B™
(
şaimed_¦Ùs
, 
j
) == 0) ;

2602 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
NULL
 ||

2603 
£rv”
.
şu¡”
->
¦Ùs
[
j
]->
cÚfigEpoch
 <ğ
»que¡CÚfigEpoch
)

2610 
	`£rv”Log
(
LL_WARNING
,

2613 
node
->
Çme
, 
j
,

2614 (è
£rv”
.
şu¡”
->
¦Ùs
[
j
]->
cÚfigEpoch
,

2615 (è
»que¡CÚfigEpoch
);

2620 
	`şu¡”S’dFaov”Auth
(
node
);

2621 
£rv”
.
şu¡”
->
Ï¡VÙeEpoch
 = s”v”.şu¡”->
cu¼’tEpoch
;

2622 
node
->
¦aveof
->
vÙed_time
 = 
	`m¡ime
();

2623 
	`£rv”Log
(
LL_WARNING
, "Failover‡uth grantedo %.40s forƒpoch %llu",

2624 
node
->
Çme
, (è
£rv”
.
şu¡”
->
cu¼’tEpoch
);

2625 
	}
}

2639 
	$şu¡”G‘SÏveRªk
() {

2640 
myoff£t
;

2641 
j
, 
¿nk
 = 0;

2642 
şu¡”Node
 *
ma¡”
;

2644 
	`£rv”As£¹
(
	`nodeIsSÏve
(
my£lf
));

2645 
ma¡”
 = 
my£lf
->
¦aveof
;

2646 ià(
ma¡”
 =ğ
NULL
)  0;

2648 
myoff£t
 = 
	`»¶iÿtiÚG‘SÏveOff£t
();

2649 
j
 = 0; j < 
ma¡”
->
num¦aves
; j++)

2650 ià(
ma¡”
->
¦aves
[
j
] !ğ
my£lf
 &&

2651 
ma¡”
->
¦aves
[
j
]->
»¶_off£t
 > 
myoff£t
è
¿nk
++;

2652  
¿nk
;

2653 
	}
}

2677 
	$şu¡”LogCªtFaov”
(
»asÚ
) {

2678 *
msg
;

2679 
time_t
 
Ï¡log_time
 = 0;

2680 
m¡ime_t
 
nŞog_ç_time
 = 
£rv”
.
şu¡”_node_timeout
 + 5000;

2683 ià(
»asÚ
 =ğ
£rv”
.
şu¡”
->
ÿÁ_çov”_»asÚ
 &&

2684 
	`time
(
NULL
)-
Ï¡log_time
 < 
CLUSTER_CANT_FAILOVER_RELOG_PERIOD
)

2687 
£rv”
.
şu¡”
->
ÿÁ_çov”_»asÚ
 = 
»asÚ
;

2692 ià(
my£lf
->
¦aveof
 &&

2693 
	`nodeFaed
(
my£lf
->
¦aveof
) &&

2694 (
	`m¡ime
(è- 
my£lf
->
¦aveof
->
ç_time
è< 
nŞog_ç_time
) ;

2696 
»asÚ
) {

2697 
CLUSTER_CANT_FAILOVER_DATA_AGE
:

2698 
msg
 = "Disconnected from master for†ongerhan‡llowed. "

2702 
CLUSTER_CANT_FAILOVER_WAITING_DELAY
:

2703 
msg
 = "Waitinghe delay before I can start‡‚ew failover.";

2705 
CLUSTER_CANT_FAILOVER_EXPIRED
:

2706 
msg
 = "Failover‡ttemptƒxpired.";

2708 
CLUSTER_CANT_FAILOVER_WAITING_VOTES
:

2709 
msg
 = "Waiting for votes, but majority still‚ot„eached.";

2712 
msg
 = "Unknown„eason code.";

2715 
Ï¡log_time
 = 
	`time
(
NULL
);

2716 
	`£rv”Log
(
LL_WARNING
,"Cu¼’y uÇbËØçov”: %s", 
msg
);

2717 
	}
}

2725 
	$şu¡”Faov”R•ÏûYourMa¡”
() {

2726 
j
;

2727 
şu¡”Node
 *
Şdma¡”
 = 
my£lf
->
¦aveof
;

2729 ià(
	`nodeIsMa¡”
(
my£lf
è|| 
Şdma¡”
 =ğ
NULL
) ;

2732 
	`şu¡”S‘NodeAsMa¡”
(
my£lf
);

2733 
	`»¶iÿtiÚUn£tMa¡”
();

2736 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

2737 ià(
	`şu¡”NodeG‘SlÙB™
(
Şdma¡”
,
j
)) {

2738 
	`şu¡”D–SlÙ
(
j
);

2739 
	`şu¡”AddSlÙ
(
my£lf
,
j
);

2744 
	`şu¡”Upd©eS‹
();

2745 
	`şu¡”SaveCÚfigOrD›
(1);

2749 
	`şu¡”Brßdÿ¡PÚg
(
CLUSTER_BROADCAST_ALL
);

2752 
	`»£tMªu®Faov”
();

2753 
	}
}

2763 
	$şu¡”HªdËSÏveFaov”
() {

2764 
m¡ime_t
 
d©a_age
;

2765 
m¡ime_t
 
auth_age
 = 
	`m¡ime
(è- 
£rv”
.
şu¡”
->
çov”_auth_time
;

2766 
Ãeded_quÜum
 = (
£rv”
.
şu¡”
->
size
 / 2) + 1;

2767 
mªu®_çov”
 = 
£rv”
.
şu¡”
->
mf_’d
 != 0 &&

2768 
£rv”
.
şu¡”
->
mf_ÿn_¡¬t
;

2769 
m¡ime_t
 
auth_timeout
, 
auth_»Œy_time
;

2771 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 &ğ~
CLUSTER_TODO_HANDLE_FAILOVER
;

2780 
auth_timeout
 = 
£rv”
.
şu¡”_node_timeout
*2;

2781 ià(
auth_timeout
 < 2000)‡uth_timeout = 2000;

2782 
auth_»Œy_time
 = 
auth_timeout
*2;

2789 ià(
	`nodeIsMa¡”
(
my£lf
) ||

2790 
my£lf
->
¦aveof
 =ğ
NULL
 ||

2791 (!
	`nodeFaed
(
my£lf
->
¦aveof
è&& !
mªu®_çov”
) ||

2792 
my£lf
->
¦aveof
->
num¦Ùs
 == 0)

2796 
£rv”
.
şu¡”
->
ÿÁ_çov”_»asÚ
 = 
CLUSTER_CANT_FAILOVER_NONE
;

2802 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTED
) {

2803 
d©a_age
 = (
m¡ime_t
)(
£rv”
.
unixtime
 - s”v”.
ma¡”
->
Ï¡š‹¿ùiÚ
)

2806 
d©a_age
 = (
m¡ime_t
)(
£rv”
.
unixtime
 - s”v”.
»¶_down_sšû
) * 1000;

2812 ià(
d©a_age
 > 
£rv”
.
şu¡”_node_timeout
)

2813 
d©a_age
 -ğ
£rv”
.
şu¡”_node_timeout
;

2819 ià(
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
 &&

2820 
d©a_age
 >

2821 (((
m¡ime_t
)
£rv”
.
»¶_pšg_¦ave_³riod
 * 1000) +

2822 (
£rv”
.
şu¡”_node_timeout
 * s”v”.
şu¡”_¦ave_v®id™y_çùÜ
)))

2824 ià(!
mªu®_çov”
) {

2825 
	`şu¡”LogCªtFaov”
(
CLUSTER_CANT_FAILOVER_DATA_AGE
);

2832 ià(
auth_age
 > 
auth_»Œy_time
) {

2833 
£rv”
.
şu¡”
->
çov”_auth_time
 = 
	`m¡ime
() +

2835 
	`¿ndom
() % 500;

2836 
£rv”
.
şu¡”
->
çov”_auth_couÁ
 = 0;

2837 
£rv”
.
şu¡”
->
çov”_auth_£Á
 = 0;

2838 
£rv”
.
şu¡”
->
çov”_auth_¿nk
 = 
	`şu¡”G‘SÏveRªk
();

2842 
£rv”
.
şu¡”
->
çov”_auth_time
 +=

2843 
£rv”
.
şu¡”
->
çov”_auth_¿nk
 * 1000;

2845 ià(
£rv”
.
şu¡”
->
mf_’d
) {

2846 
£rv”
.
şu¡”
->
çov”_auth_time
 = 
	`m¡ime
();

2847 
£rv”
.
şu¡”
->
çov”_auth_¿nk
 = 0;

2849 
	`£rv”Log
(
LL_WARNING
,

2852 
£rv”
.
şu¡”
->
çov”_auth_time
 - 
	`m¡ime
(),

2853 
£rv”
.
şu¡”
->
çov”_auth_¿nk
,

2854 
	`»¶iÿtiÚG‘SÏveOff£t
());

2858 
	`şu¡”Brßdÿ¡PÚg
(
CLUSTER_BROADCAST_LOCAL_SLAVES
);

2867 ià(
£rv”
.
şu¡”
->
çov”_auth_£Á
 == 0 &&

2868 
£rv”
.
şu¡”
->
mf_’d
 == 0)

2870 
Ãw¿nk
 = 
	`şu¡”G‘SÏveRªk
();

2871 ià(
Ãw¿nk
 > 
£rv”
.
şu¡”
->
çov”_auth_¿nk
) {

2872 
added_d–ay
 =

2873 (
Ãw¿nk
 - 
£rv”
.
şu¡”
->
çov”_auth_¿nk
) * 1000;

2874 
£rv”
.
şu¡”
->
çov”_auth_time
 +ğ
added_d–ay
;

2875 
£rv”
.
şu¡”
->
çov”_auth_¿nk
 = 
Ãw¿nk
;

2876 
	`£rv”Log
(
LL_WARNING
,

2878 
Ãw¿nk
, 
added_d–ay
);

2883 ià(
	`m¡ime
(è< 
£rv”
.
şu¡”
->
çov”_auth_time
) {

2884 
	`şu¡”LogCªtFaov”
(
CLUSTER_CANT_FAILOVER_WAITING_DELAY
);

2889 ià(
auth_age
 > 
auth_timeout
) {

2890 
	`şu¡”LogCªtFaov”
(
CLUSTER_CANT_FAILOVER_EXPIRED
);

2895 ià(
£rv”
.
şu¡”
->
çov”_auth_£Á
 == 0) {

2896 
£rv”
.
şu¡”
->
cu¼’tEpoch
++;

2897 
£rv”
.
şu¡”
->
çov”_auth_•och
 = s”v”.şu¡”->
cu¼’tEpoch
;

2898 
	`£rv”Log
(
LL_WARNING
,"Starting‡ failoverƒlection forƒpoch %llu.",

2899 (è
£rv”
.
şu¡”
->
cu¼’tEpoch
);

2900 
	`şu¡”Reque¡Faov”Auth
();

2901 
£rv”
.
şu¡”
->
çov”_auth_£Á
 = 1;

2902 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|

2903 
CLUSTER_TODO_UPDATE_STATE
|

2904 
CLUSTER_TODO_FSYNC_CONFIG
);

2909 ià(
£rv”
.
şu¡”
->
çov”_auth_couÁ
 >ğ
Ãeded_quÜum
) {

2912 
	`£rv”Log
(
LL_WARNING
,

2916 ià(
my£lf
->
cÚfigEpoch
 < 
£rv”
.
şu¡”
->
çov”_auth_•och
) {

2917 
my£lf
->
cÚfigEpoch
 = 
£rv”
.
şu¡”
->
çov”_auth_•och
;

2918 
	`£rv”Log
(
LL_WARNING
,

2920 (è
my£lf
->
cÚfigEpoch
);

2924 
	`şu¡”Faov”R•ÏûYourMa¡”
();

2926 
	`şu¡”LogCªtFaov”
(
CLUSTER_CANT_FAILOVER_WAITING_VOTES
);

2928 
	}
}

2957 
	$şu¡”HªdËSÏveMig¿tiÚ
(
max_¦aves
) {

2958 
j
, 
ok¦aves
 = 0;

2959 
şu¡”Node
 *
myma¡”
 = 
my£lf
->
¦aveof
, *
rg‘
 = 
NULL
, *
ÿndid©e
 = NULL;

2960 
diùI‹¿tÜ
 *
di
;

2961 
diùEÁry
 *
de
;

2964 ià(
£rv”
.
şu¡”
->
¡©e
 !ğ
CLUSTER_OK
) ;

2968 ià(
myma¡”
 =ğ
NULL
) ;

2969 
j
 = 0; j < 
myma¡”
->
num¦aves
; j++)

2970 ià(!
	`nodeFaed
(
myma¡”
->
¦aves
[
j
]) &&

2971 !
	`nodeTimedOut
(
myma¡”
->
¦aves
[
j
])è
ok¦aves
++;

2972 ià(
ok¦aves
 <ğ
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
) ;

2984 
ÿndid©e
 = 
my£lf
;

2985 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

2986 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2987 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

2988 
ok¦aves
 = 0, 
is_Üphªed
 = 1;

2994 ià(
	`nodeIsSÏve
(
node
è|| 
	`nodeFaed
Òode)è
is_Üphªed
 = 0;

2995 ià(!(
node
->
æags
 & 
CLUSTER_NODE_MIGRATE_TO
)è
is_Üphªed
 = 0;

2998 ià(
	`nodeIsMa¡”
(
node
)è
ok¦aves
 = 
	`şu¡”CouÁNÚFašgSÏves
(node);

2999 ià(
ok¦aves
 > 0è
is_Üphªed
 = 0;

3001 ià(
is_Üphªed
) {

3002 ià(!
rg‘
 && 
node
->
num¦Ùs
 > 0)arget =‚ode;

3006 ià(!
node
->
Üphªed_time
ènode->Üphªed_timğ
	`m¡ime
();

3008 
node
->
Üphªed_time
 = 0;

3014 ià(
ok¦aves
 =ğ
max_¦aves
) {

3015 
j
 = 0; j < 
node
->
num¦aves
; j++) {

3016 ià(
	`memcmp
(
node
->
¦aves
[
j
]->
Çme
,

3017 
ÿndid©e
->
Çme
,

3018 
CLUSTER_NAMELEN
) < 0)

3020 
ÿndid©e
 = 
node
->
¦aves
[
j
];

3025 
	`diùR–—£I‹¿tÜ
(
di
);

3032 ià(
rg‘
 && 
ÿndid©e
 =ğ
my£lf
 &&

3033 (
	`m¡ime
()-
rg‘
->
Üphªed_time
è> 
CLUSTER_SLAVE_MIGRATION_DELAY
)

3035 
	`£rv”Log
(
LL_WARNING
,"Migratingo orphaned master %.40s",

3036 
rg‘
->
Çme
);

3037 
	`şu¡”S‘Ma¡”
(
rg‘
);

3039 
	}
}

3075 
	$»£tMªu®Faov”
() {

3076 ià(
£rv”
.
şu¡”
->
mf_’d
 && 
	`ş›ÁsA»Pau£d
()) {

3077 
£rv”
.
ş›Ás_·u£_’d_time
 = 0;

3078 
	`ş›ÁsA»Pau£d
();

3080 
£rv”
.
şu¡”
->
mf_’d
 = 0;

3081 
£rv”
.
şu¡”
->
mf_ÿn_¡¬t
 = 0;

3082 
£rv”
.
şu¡”
->
mf_¦ave
 = 
NULL
;

3083 
£rv”
.
şu¡”
->
mf_ma¡”_off£t
 = 0;

3084 
	}
}

3087 
	$mªu®Faov”CheckTimeout
() {

3088 ià(
£rv”
.
şu¡”
->
mf_’d
 && s”v”.şu¡”->mf_’d < 
	`m¡ime
()) {

3089 
	`£rv”Log
(
LL_WARNING
,"Manual failoverimed out.");

3090 
	`»£tMªu®Faov”
();

3092 
	}
}

3096 
	$şu¡”HªdËMªu®Faov”
() {

3098 ià(
£rv”
.
şu¡”
->
mf_’d
 == 0) ;

3102 ià(
£rv”
.
şu¡”
->
mf_ÿn_¡¬t
) ;

3104 ià(
£rv”
.
şu¡”
->
mf_ma¡”_off£t
 == 0) ;

3106 ià(
£rv”
.
şu¡”
->
mf_ma¡”_off£t
 =ğ
	`»¶iÿtiÚG‘SÏveOff£t
()) {

3109 
£rv”
.
şu¡”
->
mf_ÿn_¡¬t
 = 1;

3110 
	`£rv”Log
(
LL_WARNING
,

3114 
	}
}

3121 
	$şu¡”CrÚ
() {

3122 
diùI‹¿tÜ
 *
di
;

3123 
diùEÁry
 *
de
;

3124 
upd©e_¡©e
 = 0;

3125 
Üphªed_ma¡”s
;

3126 
max_¦aves
;

3127 
this_¦aves
;

3128 
m¡ime_t
 
mš_pÚg
 = 0, 
now
 = 
	`m¡ime
();

3129 
şu¡”Node
 *
mš_pÚg_node
 = 
NULL
;

3130 
™”©iÚ
 = 0;

3131 
m¡ime_t
 
hªdshake_timeout
;

3133 
™”©iÚ
++;

3139 *
´ev_
 = 
NULL
;

3140 *
cu¼_
 = 
£rv”
.
şu¡”_ªnounû_
;

3141 
chªged
 = 0;

3143 ià(
´ev_
 =ğ
NULL
 && 
cu¼_
 !ğNULLè
chªged
 = 1;

3144 ià(
´ev_
 !ğ
NULL
 && 
cu¼_
 =ğNULLè
chªged
 = 1;

3145 ià(
´ev_
 && 
cu¼_
 && 
	`¡rcmp
Õ»v_,cu¼_)è
chªged
 = 1;

3147 ià(
chªged
) {

3148 
´ev_
 = 
cu¼_
;

3149 ià(
´ev_
è´ev_ = 
	`z¡rdup
(prev_ip);

3151 ià(
cu¼_
) {

3152 
	`¡ºıy
(
my£lf
->

,
£rv”
.
şu¡”_ªnounû_
,
NET_IP_STR_LEN
);

3153 
my£lf
->

[
NET_IP_STR_LEN
-1] = '\0';

3155 
my£lf
->

[0] = '\0';

3164 
hªdshake_timeout
 = 
£rv”
.
şu¡”_node_timeout
;

3165 ià(
hªdshake_timeout
 < 1000) handshake_timeout = 1000;

3168 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3169 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3170 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3172 ià(
node
->
æags
 & (
CLUSTER_NODE_MYSELF
|
CLUSTER_NODE_NOADDR
)) ;

3176 ià(
	`nodeInHªdshake
(
node
è&& 
now
 -‚ode->
ùime
 > 
hªdshake_timeout
) {

3177 
	`şu¡”D–Node
(
node
);

3181 ià(
node
->
lšk
 =ğ
NULL
) {

3182 
fd
;

3183 
m¡ime_t
 
Şd_pšg_£Á
;

3184 
şu¡”Lšk
 *
lšk
;

3186 
fd
 = 
	`ª‘TıNÚBlockBšdCÚÃù
(
£rv”
.
Ã‹¼
, 
node
->

,

3187 
node
->
ıÜt
, 
NET_FIRST_BIND_ADDR
);

3188 ià(
fd
 == -1) {

3194 ià(
node
->
pšg_£Á
 =ğ0ènode->pšg_£Á = 
	`m¡ime
();

3195 
	`£rv”Log
(
LL_DEBUG
, "Unableo connecto "

3196 "Clu¡” Nod[%s]:%d -> %s", 
node
->

,

3197 
node
->
ıÜt
, 
£rv”
.
Ã‹¼
);

3200 
lšk
 = 
	`ü—‹Clu¡”Lšk
(
node
);

3201 
lšk
->
fd
 = fd;

3202 
node
->
lšk
 =†ink;

3203 
	`«C»©eFeEv’t
(
£rv”
.
–
,
lšk
->
fd
,
AE_READABLE
,

3204 
şu¡”R—dHªdËr
,
lšk
);

3211 
Şd_pšg_£Á
 = 
node
->
pšg_£Á
;

3212 
	`şu¡”S’dPšg
(
lšk
, 
node
->
æags
 & 
CLUSTER_NODE_MEET
 ?

3213 
CLUSTERMSG_TYPE_MEET
 : 
CLUSTERMSG_TYPE_PING
);

3214 ià(
Şd_pšg_£Á
) {

3218 
node
->
pšg_£Á
 = 
Şd_pšg_£Á
;

3225 
node
->
æags
 &ğ~
CLUSTER_NODE_MEET
;

3227 
	`£rv”Log
(
LL_DEBUG
,"Connecting with Node %.40s‡t %s:%d",

3228 
node
->
Çme
,‚ode->

,‚ode->
ıÜt
);

3231 
	`diùR–—£I‹¿tÜ
(
di
);

3235 ià(!(
™”©iÚ
 % 10)) {

3236 
j
;

3240 
j
 = 0; j < 5; j++) {

3241 
de
 = 
	`diùG‘RªdomKey
(
£rv”
.
şu¡”
->
nodes
);

3242 
şu¡”Node
 *
this
 = 
	`diùG‘V®
(
de
);

3245 ià(
this
->
lšk
 =ğ
NULL
 ||his->
pšg_£Á
 != 0) ;

3246 ià(
this
->
æags
 & (
CLUSTER_NODE_MYSELF
|
CLUSTER_NODE_HANDSHAKE
))

3248 ià(
mš_pÚg_node
 =ğ
NULL
 || 
mš_pÚg
 > 
this
->
pÚg_»ûived
) {

3249 
mš_pÚg_node
 = 
this
;

3250 
mš_pÚg
 = 
this
->
pÚg_»ûived
;

3253 ià(
mš_pÚg_node
) {

3254 
	`£rv”Log
(
LL_DEBUG
,"Pšgšg‚od%.40s", 
mš_pÚg_node
->
Çme
);

3255 
	`şu¡”S’dPšg
(
mš_pÚg_node
->
lšk
, 
CLUSTERMSG_TYPE_PING
);

3265 
Üphªed_ma¡”s
 = 0;

3266 
max_¦aves
 = 0;

3267 
this_¦aves
 = 0;

3268 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3269 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3270 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3271 
now
 = 
	`m¡ime
();

3272 
m¡ime_t
 
d–ay
;

3274 ià(
node
->
æags
 &

3275 (
CLUSTER_NODE_MYSELF
|
CLUSTER_NODE_NOADDR
|
CLUSTER_NODE_HANDSHAKE
))

3280 ià(
	`nodeIsSÏve
(
my£lf
è&& 
	`nodeIsMa¡”
(
node
è&& !
	`nodeFaed
(node)) {

3281 
ok¦aves
 = 
	`şu¡”CouÁNÚFašgSÏves
(
node
);

3286 ià(
ok¦aves
 =ğ0 && 
node
->
num¦Ùs
 > 0 &&

3287 
node
->
æags
 & 
CLUSTER_NODE_MIGRATE_TO
)

3289 
Üphªed_ma¡”s
++;

3291 ià(
ok¦aves
 > 
max_¦aves
) max_slaves = okslaves;

3292 ià(
	`nodeIsSÏve
(
my£lf
è&& my£lf->
¦aveof
 =ğ
node
)

3293 
this_¦aves
 = 
ok¦aves
;

3299 ià(
node
->
lšk
 &&

3300 
now
 - 
node
->
lšk
->
ùime
 >

3301 
£rv”
.
şu¡”_node_timeout
 &&

3302 
node
->
pšg_£Á
 &&

3303 
node
->
pÚg_»ûived
 <‚ode->
pšg_£Á
 &&

3305 
now
 - 
node
->
pšg_£Á
 > 
£rv”
.
şu¡”_node_timeout
/2)

3308 
	`ä“Clu¡”Lšk
(
node
->
lšk
);

3315 ià(
node
->
lšk
 &&

3316 
node
->
pšg_£Á
 == 0 &&

3317 (
now
 - 
node
->
pÚg_»ûived
è> 
£rv”
.
şu¡”_node_timeout
/2)

3319 
	`şu¡”S’dPšg
(
node
->
lšk
, 
CLUSTERMSG_TYPE_PING
);

3325 ià(
£rv”
.
şu¡”
->
mf_’d
 &&

3326 
	`nodeIsMa¡”
(
my£lf
) &&

3327 
£rv”
.
şu¡”
->
mf_¦ave
 =ğ
node
 &&

3328 
node
->
lšk
)

3330 
	`şu¡”S’dPšg
(
node
->
lšk
, 
CLUSTERMSG_TYPE_PING
);

3335 ià(
node
->
pšg_£Á
 == 0) ;

3340 
d–ay
 = 
now
 - 
node
->
pšg_£Á
;

3342 ià(
d–ay
 > 
£rv”
.
şu¡”_node_timeout
) {

3345 ià(!(
node
->
æags
 & (
CLUSTER_NODE_PFAIL
|
CLUSTER_NODE_FAIL
))) {

3346 
	`£rv”Log
(
LL_DEBUG
,"*** NODE %.40s…ossibly failing",

3347 
node
->
Çme
);

3348 
node
->
æags
 |ğ
CLUSTER_NODE_PFAIL
;

3349 
upd©e_¡©e
 = 1;

3353 
	`diùR–—£I‹¿tÜ
(
di
);

3358 ià(
	`nodeIsSÏve
(
my£lf
) &&

3359 
£rv”
.
ma¡”ho¡
 =ğ
NULL
 &&

3360 
my£lf
->
¦aveof
 &&

3361 
	`nodeHasAddr
(
my£lf
->
¦aveof
))

3363 
	`»¶iÿtiÚS‘Ma¡”
(
my£lf
->
¦aveof
->

, my£lf->¦aveof->
pÜt
);

3367 
	`mªu®Faov”CheckTimeout
();

3369 ià(
	`nodeIsSÏve
(
my£lf
)) {

3370 
	`şu¡”HªdËMªu®Faov”
();

3371 
	`şu¡”HªdËSÏveFaov”
();

3377 ià(
Üphªed_ma¡”s
 && 
max_¦aves
 >ğ2 && 
this_¦aves
 == max_slaves)

3378 
	`şu¡”HªdËSÏveMig¿tiÚ
(
max_¦aves
);

3381 ià(
upd©e_¡©e
 || 
£rv”
.
şu¡”
->
¡©e
 =ğ
CLUSTER_FAIL
)

3382 
	`şu¡”Upd©eS‹
();

3383 
	}
}

3390 
	$şu¡”BefÜeSË•
() {

3393 ià(
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 & 
CLUSTER_TODO_HANDLE_FAILOVER
)

3394 
	`şu¡”HªdËSÏveFaov”
();

3397 ià(
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 & 
CLUSTER_TODO_UPDATE_STATE
)

3398 
	`şu¡”Upd©eS‹
();

3401 ià(
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 & 
CLUSTER_TODO_SAVE_CONFIG
) {

3402 
fsync
 = 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 &

3403 
CLUSTER_TODO_FSYNC_CONFIG
;

3404 
	`şu¡”SaveCÚfigOrD›
(
fsync
);

3409 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 = 0;

3410 
	}
}

3412 
	$şu¡”DoBefÜeSË•
(
æags
) {

3413 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 |ğ
æags
;

3414 
	}
}

3422 
	$b™m­Te¡B™
(*
b™m­
, 
pos
) {

3423 
off_t
 
by‹
 = 
pos
/8;

3424 
b™
 = 
pos
&7;

3425  (
b™m­
[
by‹
] & (1<<
b™
)) != 0;

3426 
	}
}

3429 
	$b™m­S‘B™
(*
b™m­
, 
pos
) {

3430 
off_t
 
by‹
 = 
pos
/8;

3431 
b™
 = 
pos
&7;

3432 
b™m­
[
by‹
] |ğ1<<
b™
;

3433 
	}
}

3436 
	$b™m­CË¬B™
(*
b™m­
, 
pos
) {

3437 
off_t
 
by‹
 = 
pos
/8;

3438 
b™
 = 
pos
&7;

3439 
b™m­
[
by‹
] &ğ~(1<<
b™
);

3440 
	}
}

3445 
	$şu¡”Ma¡”sHaveSÏves
() {

3446 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3447 
diùEÁry
 *
de
;

3448 
¦aves
 = 0;

3449 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3450 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3452 ià(
	`nodeIsSÏve
(
node
)) ;

3453 
¦aves
 +ğ
node
->
num¦aves
;

3455 
	`diùR–—£I‹¿tÜ
(
di
);

3456  
¦aves
 != 0;

3457 
	}
}

3460 
	$şu¡”NodeS‘SlÙB™
(
şu¡”Node
 *
n
, 
¦Ù
) {

3461 
Şd
 = 
	`b™m­Te¡B™
(
n
->
¦Ùs
,
¦Ù
);

3462 
	`b™m­S‘B™
(
n
->
¦Ùs
,
¦Ù
);

3463 ià(!
Şd
) {

3464 
n
->
num¦Ùs
++;

3478 ià(
n
->
num¦Ùs
 =ğ1 && 
	`şu¡”Ma¡”sHaveSÏves
())

3479 
n
->
æags
 |ğ
CLUSTER_NODE_MIGRATE_TO
;

3481  
Şd
;

3482 
	}
}

3485 
	$şu¡”NodeCË¬SlÙB™
(
şu¡”Node
 *
n
, 
¦Ù
) {

3486 
Şd
 = 
	`b™m­Te¡B™
(
n
->
¦Ùs
,
¦Ù
);

3487 
	`b™m­CË¬B™
(
n
->
¦Ùs
,
¦Ù
);

3488 ià(
Şd
è
n
->
num¦Ùs
--;

3489  
Şd
;

3490 
	}
}

3493 
	$şu¡”NodeG‘SlÙB™
(
şu¡”Node
 *
n
, 
¦Ù
) {

3494  
	`b™m­Te¡B™
(
n
->
¦Ùs
,
¦Ù
);

3495 
	}
}

3501 
	$şu¡”AddSlÙ
(
şu¡”Node
 *
n
, 
¦Ù
) {

3502 ià(
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
]è 
C_ERR
;

3503 
	`şu¡”NodeS‘SlÙB™
(
n
,
¦Ù
);

3504 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] = 
n
;

3505  
C_OK
;

3506 
	}
}

3511 
	$şu¡”D–SlÙ
(
¦Ù
) {

3512 
şu¡”Node
 *
n
 = 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
];

3514 ià(!
n
è 
C_ERR
;

3515 
	`£rv”As£¹
(
	`şu¡”NodeCË¬SlÙB™
(
n
,
¦Ù
) == 1);

3516 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] = 
NULL
;

3517  
C_OK
;

3518 
	}
}

3522 
	$şu¡”D–NodeSlÙs
(
şu¡”Node
 *
node
) {

3523 
d–‘ed
 = 0, 
j
;

3525 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3526 ià(
	`şu¡”NodeG‘SlÙB™
(
node
,
j
)è
	`şu¡”D–SlÙ
(j);

3527 
d–‘ed
++;

3529  
d–‘ed
;

3530 
	}
}

3534 
	$şu¡”Clo£AÎSlÙs
() {

3535 
	`mem£t
(
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
,0,

3536 (
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
));

3537 
	`mem£t
(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
,0,

3538 (
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
));

3539 
	}
}

3549 
	#CLUSTER_MAX_REJOIN_DELAY
 5000

	)

3550 
	#CLUSTER_MIN_REJOIN_DELAY
 500

	)

3551 
	#CLUSTER_WRITABLE_DELAY
 2000

	)

3553 
	$şu¡”Upd©eS‹
() {

3554 
j
, 
Ãw_¡©e
;

3555 
»achabË_ma¡”s
 = 0;

3556 
m¡ime_t
 
amÚg_mšÜ™y_time
;

3557 
m¡ime_t
 
fœ¡_ÿÎ_time
 = 0;

3559 
£rv”
.
şu¡”
->
todo_befÜe_¦“p
 &ğ~
CLUSTER_TODO_UPDATE_STATE
;

3567 ià(
fœ¡_ÿÎ_time
 =ğ0èfœ¡_ÿÎ_timğ
	`m¡ime
();

3568 ià(
	`nodeIsMa¡”
(
my£lf
) &&

3569 
£rv”
.
şu¡”
->
¡©e
 =ğ
CLUSTER_FAIL
 &&

3570 
	`m¡ime
(è- 
fœ¡_ÿÎ_time
 < 
CLUSTER_WRITABLE_DELAY
) ;

3574 
Ãw_¡©e
 = 
CLUSTER_OK
;

3577 ià(
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
) {

3578 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3579 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
NULL
 ||

3580 
£rv”
.
şu¡”
->
¦Ùs
[
j
]->
æags
 & (
CLUSTER_NODE_FAIL
))

3582 
Ãw_¡©e
 = 
CLUSTER_FAIL
;

3594 
diùI‹¿tÜ
 *
di
;

3595 
diùEÁry
 *
de
;

3597 
£rv”
.
şu¡”
->
size
 = 0;

3598 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3599 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3600 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3602 ià(
	`nodeIsMa¡”
(
node
è&&‚ode->
num¦Ùs
) {

3603 
£rv”
.
şu¡”
->
size
++;

3604 ià((
node
->
æags
 & (
CLUSTER_NODE_FAIL
|
CLUSTER_NODE_PFAIL
)) == 0)

3605 
»achabË_ma¡”s
++;

3608 
	`diùR–—£I‹¿tÜ
(
di
);

3614 
Ãeded_quÜum
 = (
£rv”
.
şu¡”
->
size
 / 2) + 1;

3616 ià(
»achabË_ma¡”s
 < 
Ãeded_quÜum
) {

3617 
Ãw_¡©e
 = 
CLUSTER_FAIL
;

3618 
amÚg_mšÜ™y_time
 = 
	`m¡ime
();

3623 ià(
Ãw_¡©e
 !ğ
£rv”
.
şu¡”
->
¡©e
) {

3624 
m¡ime_t
 
»još_d–ay
 = 
£rv”
.
şu¡”_node_timeout
;

3630 ià(
»još_d–ay
 > 
CLUSTER_MAX_REJOIN_DELAY
)

3631 
»još_d–ay
 = 
CLUSTER_MAX_REJOIN_DELAY
;

3632 ià(
»još_d–ay
 < 
CLUSTER_MIN_REJOIN_DELAY
)

3633 
»još_d–ay
 = 
CLUSTER_MIN_REJOIN_DELAY
;

3635 ià(
Ãw_¡©e
 =ğ
CLUSTER_OK
 &&

3636 
	`nodeIsMa¡”
(
my£lf
) &&

3637 
	`m¡ime
(è- 
amÚg_mšÜ™y_time
 < 
»još_d–ay
)

3643 
	`£rv”Log
(
LL_WARNING
,"Cluster state changed: %s",

3644 
Ãw_¡©e
 =ğ
CLUSTER_OK
 ? "ok" : "fail");

3645 
£rv”
.
şu¡”
->
¡©e
 = 
Ãw_¡©e
;

3647 
	}
}

3671 
	$v”ifyClu¡”CÚfigW™hD©a
() {

3672 
j
;

3673 
upd©e_cÚfig
 = 0;

3677 ià(
	`nodeIsSÏve
(
my£lf
)è 
C_OK
;

3680 
j
 = 1; j < 
£rv”
.
dbnum
; j++) {

3681 ià(
	`diùSize
(
£rv”
.
db
[
j
].
diù
)è 
C_ERR
;

3686 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3687 ià(!
	`couÁKeysInSlÙ
(
j
)) ;

3691 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
my£lf
 ||

3692 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
] !ğ
NULL
) ;

3698 
upd©e_cÚfig
++;

3700 ià(
£rv”
.
şu¡”
->
¦Ùs
[
j
] =ğ
NULL
) {

3701 
	`£rv”Log
(
LL_WARNING
, "I have keys for unassigned slot %d. "

3702 "Takšg„e¥Úsib™y fÜ it.",
j
);

3703 
	`şu¡”AddSlÙ
(
my£lf
,
j
);

3705 
	`£rv”Log
(
LL_WARNING
, "I have keys for slot %d, buthe slot is "

3707 "S‘tšg iˆtØimpÜtšg s‹.",
j
);

3708 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
] = s”v”.şu¡”->
¦Ùs
[j];

3711 ià(
upd©e_cÚfig
è
	`şu¡”SaveCÚfigOrD›
(1);

3712  
C_OK
;

3713 
	}
}

3721 
	$şu¡”S‘Ma¡”
(
şu¡”Node
 *
n
) {

3722 
	`£rv”As£¹
(
n
 !ğ
my£lf
);

3723 
	`£rv”As£¹
(
my£lf
->
num¦Ùs
 == 0);

3725 ià(
	`nodeIsMa¡”
(
my£lf
)) {

3726 
my£lf
->
æags
 &ğ~(
CLUSTER_NODE_MASTER
|
CLUSTER_NODE_MIGRATE_TO
);

3727 
my£lf
->
æags
 |ğ
CLUSTER_NODE_SLAVE
;

3728 
	`şu¡”Clo£AÎSlÙs
();

3730 ià(
my£lf
->
¦aveof
)

3731 
	`şu¡”NodeRemoveSÏve
(
my£lf
->
¦aveof
,myself);

3733 
my£lf
->
¦aveof
 = 
n
;

3734 
	`şu¡”NodeAddSÏve
(
n
,
my£lf
);

3735 
	`»¶iÿtiÚS‘Ma¡”
(
n
->

,‚->
pÜt
);

3736 
	`»£tMªu®Faov”
();

3737 
	}
}

3743 
	s»disNodeFÏgs
 {

3744 
ušt16_t
 
	mæag
;

3745 *
	mÇme
;

3748 
»disNodeFÏgs
 
	g»disNodeFÏgsTabË
[] = {

3749 {
CLUSTER_NODE_MYSELF
, "myself,"},

3750 {
CLUSTER_NODE_MASTER
, "master,"},

3751 {
CLUSTER_NODE_SLAVE
, "slave,"},

3752 {
CLUSTER_NODE_PFAIL
, "fail?,"},

3753 {
CLUSTER_NODE_FAIL
, "fail,"},

3754 {
CLUSTER_NODE_HANDSHAKE
, "handshake,"},

3755 {
CLUSTER_NODE_NOADDR
, "noaddr,"}

3760 
sds
 
	$»´e£ÁClu¡”NodeFÏgs
(
sds
 
ci
, 
ušt16_t
 
æags
) {

3761 ià(
æags
 == 0) {

3762 
ci
 = 
	`sdsÿt
(ci,"noflags,");

3764 
i
, 
size
 = (
»disNodeFÏgsTabË
)/(
»disNodeFÏgs
);

3765 
i
 = 0; i < 
size
; i++) {

3766 
»disNodeFÏgs
 *
nodeæag
 = 
»disNodeFÏgsTabË
 + 
i
;

3767 ià(
æags
 & 
nodeæag
->
æag
è
ci
 = 
	`sdsÿt
(ci,‚odeæag->
Çme
);

3770 
	`sdsInüL’
(
ci
,-1);

3771  
ci
;

3772 
	}
}

3778 
sds
 
	$şu¡”G’NodeDesütiÚ
(
şu¡”Node
 *
node
) {

3779 
j
, 
¡¬t
;

3780 
sds
 
ci
;

3783 
ci
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"%.40s %s:%d@%d ",

3784 
node
->
Çme
,

3785 
node
->

,

3786 
node
->
pÜt
,

3787 
node
->
ıÜt
);

3790 
ci
 = 
	`»´e£ÁClu¡”NodeFÏgs
(ci, 
node
->
æags
);

3793 ià(
node
->
¦aveof
)

3794 
ci
 = 
	`sdsÿrštf
(ci," %.40 ",
node
->
¦aveof
->
Çme
);

3796 
ci
 = 
	`sdsÿ’
(ci," - ",3);

3799 
ci
 = 
	`sdsÿrštf
(ci,"%lld %lld %llu %s",

3800 (è
node
->
pšg_£Á
,

3801 (è
node
->
pÚg_»ûived
,

3802 (è
node
->
cÚfigEpoch
,

3803 (
node
->
lšk
 ||‚ode->
æags
 & 
CLUSTER_NODE_MYSELF
) ?

3807 
¡¬t
 = -1;

3808 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3809 
b™
;

3811 ià((
b™
 = 
	`şu¡”NodeG‘SlÙB™
(
node
,
j
)) != 0) {

3812 ià(
¡¬t
 =ğ-1è¡¬ˆğ
j
;

3814 ià(
¡¬t
 !ğ-1 && (!
b™
 || 
j
 =ğ
CLUSTER_SLOTS
-1)) {

3815 ià(
b™
 && 
j
 =ğ
CLUSTER_SLOTS
-1) j++;

3817 ià(
¡¬t
 =ğ
j
-1) {

3818 
ci
 = 
	`sdsÿrštf
(ci," %d",
¡¬t
);

3820 
ci
 = 
	`sdsÿrštf
(ci," %d-%d",
¡¬t
,
j
-1);

3822 
¡¬t
 = -1;

3829 ià(
node
->
æags
 & 
CLUSTER_NODE_MYSELF
) {

3830 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3831 ià(
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
j
]) {

3832 
ci
 = 
	`sdsÿrštf
(ci," [%d->-%.40s]",
j
,

3833 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
j
]->
Çme
);

3834 } ià(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
]) {

3835 
ci
 = 
	`sdsÿrštf
(ci," [%d-<-%.40s]",
j
,

3836 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
]->
Çme
);

3840  
ci
;

3841 
	}
}

3855 
sds
 
	$şu¡”G’NodesDesütiÚ
(
f‹r
) {

3856 
sds
 
ci
 = 
	`sd£m±y
(), 
ni
;

3857 
diùI‹¿tÜ
 *
di
;

3858 
diùEÁry
 *
de
;

3860 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3861 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3862 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3864 ià(
node
->
æags
 & 
f‹r
) ;

3865 
ni
 = 
	`şu¡”G’NodeDesütiÚ
(
node
);

3866 
ci
 = 
	`sdsÿtsds
(ci,
ni
);

3867 
	`sdsä“
(
ni
);

3868 
ci
 = 
	`sdsÿ’
(ci,"\n",1);

3870 
	`diùR–—£I‹¿tÜ
(
di
);

3871  
ci
;

3872 
	}
}

3878 
	$g‘SlÙOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
) {

3879 
¦Ù
;

3881 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
¦Ù
è!ğ
C_OK
 ||

3882 
¦Ù
 < 0 || slÙ >ğ
CLUSTER_SLOTS
)

3884 
	`addR•lyE¼Ü
(
c
,"Invalid or out of„ange slot");

3887  (è
¦Ù
;

3888 
	}
}

3890 
	$şu¡”R•lyMuÉiBulkSlÙs
(
ş›Á
 *
c
) {

3902 
num_ma¡”s
 = 0;

3903 *
¦Ù_»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

3905 
diùEÁry
 *
de
;

3906 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
şu¡”
->
nodes
);

3907 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3908 
şu¡”Node
 *
node
 = 
	`diùG‘V®
(
de
);

3909 
j
 = 0, 
¡¬t
 = -1;

3913 ià(!
	`nodeIsMa¡”
(
node
è||‚ode->
num¦Ùs
 == 0) ;

3915 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

3916 
b™
, 
i
;

3918 ià((
b™
 = 
	`şu¡”NodeG‘SlÙB™
(
node
,
j
)) != 0) {

3919 ià(
¡¬t
 =ğ-1è¡¬ˆğ
j
;

3921 ià(
¡¬t
 !ğ-1 && (!
b™
 || 
j
 =ğ
CLUSTER_SLOTS
-1)) {

3922 
Ã¡ed_–em’ts
 = 3;

3923 *
Ã¡ed_»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

3925 ià(
b™
 && 
j
 =ğ
CLUSTER_SLOTS
-1) j++;

3929 ià(
¡¬t
 =ğ
j
-1) {

3930 
	`addR•lyLÚgLÚg
(
c
, 
¡¬t
);

3931 
	`addR•lyLÚgLÚg
(
c
, 
¡¬t
);

3933 
	`addR•lyLÚgLÚg
(
c
, 
¡¬t
);

3934 
	`addR•lyLÚgLÚg
(
c
, 
j
-1);

3936 
¡¬t
 = -1;

3939 
	`addR•lyMuÉiBulkL’
(
c
, 3);

3940 
	`addR•lyBulkCSŒšg
(
c
, 
node
->

);

3941 
	`addR•lyLÚgLÚg
(
c
, 
node
->
pÜt
);

3942 
	`addR•lyBulkCBufãr
(
c
, 
node
->
Çme
, 
CLUSTER_NAMELEN
);

3945 
i
 = 0; i < 
node
->
num¦aves
; i++) {

3948 ià(
	`nodeFaed
(
node
->
¦aves
[
i
])) ;

3949 
	`addR•lyMuÉiBulkL’
(
c
, 3);

3950 
	`addR•lyBulkCSŒšg
(
c
, 
node
->
¦aves
[
i
]->

);

3951 
	`addR•lyLÚgLÚg
(
c
, 
node
->
¦aves
[
i
]->
pÜt
);

3952 
	`addR•lyBulkCBufãr
(
c
, 
node
->
¦aves
[
i
]->
Çme
, 
CLUSTER_NAMELEN
);

3953 
Ã¡ed_–em’ts
++;

3955 
	`£tDeã¼edMuÉiBulkL’gth
(
c
, 
Ã¡ed_»¶yËn
, 
Ã¡ed_–em’ts
);

3956 
num_ma¡”s
++;

3960 
	`diùR–—£I‹¿tÜ
(
di
);

3961 
	`£tDeã¼edMuÉiBulkL’gth
(
c
, 
¦Ù_»¶yËn
, 
num_ma¡”s
);

3962 
	}
}

3964 
	$şu¡”Commªd
(
ş›Á
 *
c
) {

3965 ià(
£rv”
.
şu¡”_’abËd
 == 0) {

3966 
	`addR•lyE¼Ü
(
c
,"This instance has cluster support disabled");

3970 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"m“t"è&& (c->
¬gc
 == 4 || c->argc == 5)) {

3972 
pÜt
, 
ıÜt
;

3974 ià(
	`g‘LÚgLÚgFromObjeù
(
c
->
¬gv
[3], &
pÜt
è!ğ
C_OK
) {

3975 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid TCP base…ort specified: %s",

3976 (*)
c
->
¬gv
[3]->
±r
);

3980 ià(
c
->
¬gc
 == 5) {

3981 ià(
	`g‘LÚgLÚgFromObjeù
(
c
->
¬gv
[4], &
ıÜt
è!ğ
C_OK
) {

3982 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid TCP bus…ort specified: %s",

3983 (*)
c
->
¬gv
[4]->
±r
);

3987 
ıÜt
 = 
pÜt
 + 
CLUSTER_PORT_INCR
;

3990 ià(
	`şu¡”S¹Hªdshake
(
c
->
¬gv
[2]->
±r
,
pÜt
,
ıÜt
) == 0 &&

3991 
”ºo
 =ğ
EINVAL
)

3993 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid‚ode‡ddress specified: %s:%s",

3994 (*)
c
->
¬gv
[2]->
±r
, (*)c->argv[3]->ptr);

3996 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3998 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"nodes"è&& c->
¬gc
 == 2) {

4000 
robj
 *
o
;

4001 
sds
 
ci
 = 
	`şu¡”G’NodesDesütiÚ
(0);

4003 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
ci
);

4004 
	`addR•lyBulk
(
c
,
o
);

4005 
	`deüRefCouÁ
(
o
);

4006 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"myid"è&& c->
¬gc
 == 2) {

4008 
	`addR•lyBulkCBufãr
(
c
,
my£lf
->
Çme
, 
CLUSTER_NAMELEN
);

4009 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"¦Ùs"è&& c->
¬gc
 == 2) {

4011 
	`şu¡”R•lyMuÉiBulkSlÙs
(
c
);

4012 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"æush¦Ùs"è&& c->
¬gc
 == 2) {

4014 ià(
	`diùSize
(
£rv”
.
db
[0].
diù
) != 0) {

4015 
	`addR•lyE¼Ü
(
c
,"DB must beƒmptyo…erform CLUSTER FLUSHSLOTS.");

4018 
	`şu¡”D–NodeSlÙs
(
my£lf
);

4019 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

4020 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4021 } ià((!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"addslots") ||

4022 !
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"d–¦Ùs")è&& c->
¬gc
 >= 3)

4026 
j
, 
¦Ù
;

4027 *
¦Ùs
 = 
	`zm®loc
(
CLUSTER_SLOTS
);

4028 
d–
 = !
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"delslots");

4030 
	`mem£t
(
¦Ùs
,0,
CLUSTER_SLOTS
);

4033 
j
 = 2; j < 
c
->
¬gc
; j++) {

4034 ià((
¦Ù
 = 
	`g‘SlÙOrR•ly
(
c
,c->
¬gv
[
j
])) == -1) {

4035 
	`zä“
(
¦Ùs
);

4038 ià(
d–
 && 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] =ğ
NULL
) {

4039 
	`addR•lyE¼ÜFÜm©
(
c
,"SlÙ %d i ®»ady uÇssigÃd", 
¦Ù
);

4040 
	`zä“
(
¦Ùs
);

4042 } ià(!
d–
 && 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
]) {

4043 
	`addR•lyE¼ÜFÜm©
(
c
,"SlÙ %d i ®»ady busy", 
¦Ù
);

4044 
	`zä“
(
¦Ùs
);

4047 ià(
¦Ùs
[
¦Ù
]++ == 1) {

4048 
	`addR•lyE¼ÜFÜm©
(
c
,"Slot %d specified multipleimes",

4049 ()
¦Ù
);

4050 
	`zä“
(
¦Ùs
);

4054 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

4055 ià(
¦Ùs
[
j
]) {

4056 
»tv®
;

4060 ià(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
])

4061 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
j
] = 
NULL
;

4063 
»tv®
 = 
d–
 ? 
	`şu¡”D–SlÙ
(
j
) :

4064 
	`şu¡”AddSlÙ
(
my£lf
,
j
);

4065 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
»tv®
 =ğ
C_OK
);

4068 
	`zä“
(
¦Ùs
);

4069 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

4070 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4071 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"£t¦Ù"è&& c->
¬gc
 >= 4) {

4076 
¦Ù
;

4077 
şu¡”Node
 *
n
;

4079 ià(
	`nodeIsSÏve
(
my£lf
)) {

4080 
	`addR•lyE¼Ü
(
c
,"Please use SETSLOT only with masters.");

4084 ià((
¦Ù
 = 
	`g‘SlÙOrR•ly
(
c
,c->
¬gv
[2])) == -1) ;

4086 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[3]->
±r
,"mig¿tšg"è&& c->
¬gc
 == 5) {

4087 ià(
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] !ğ
my£lf
) {

4088 
	`addR•lyE¼ÜFÜm©
(
c
,"I'm‚ÙhowÃ¸oàhash slÙ %u",
¦Ù
);

4091 ià((
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[4]->
±r
)è=ğ
NULL
) {

4092 
	`addR•lyE¼ÜFÜm©
(
c
,"I don't know‡bout‚ode %s",

4093 (*)
c
->
¬gv
[4]->
±r
);

4096 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
] = 
n
;

4097 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[3]->
±r
,"impÜtšg"è&& c->
¬gc
 == 5) {

4098 ià(
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] =ğ
my£lf
) {

4099 
	`addR•lyE¼ÜFÜm©
(
c
,

4100 "I'm‡Ì—dyhowÃ¸oàhash slÙ %u",
¦Ù
);

4103 ià((
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[4]->
±r
)è=ğ
NULL
) {

4104 
	`addR•lyE¼ÜFÜm©
(
c
,"I don't know‡bout‚ode %s",

4105 (*)
c
->
¬gv
[3]->
±r
);

4108 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] = 
n
;

4109 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[3]->
±r
,"¡abË"è&& c->
¬gc
 == 4) {

4111 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] = 
NULL
;

4112 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
] = 
NULL
;

4113 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[3]->
±r
,"node"è&& c->
¬gc
 == 5) {

4115 
şu¡”Node
 *
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[4]->
±r
);

4117 ià(!
n
) {

4118 
	`addR•lyE¼ÜFÜm©
(
c
,"Unknown‚ode %s",

4119 (*)
c
->
¬gv
[4]->
±r
);

4124 ià(
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
] =ğ
my£lf
 && 
n
 != myself) {

4125 ià(
	`couÁKeysInSlÙ
(
¦Ù
) != 0) {

4126 
	`addR•lyE¼ÜFÜm©
(
c
,

4128 "whI stÈhŞd key fÜhi hash slÙ.", 
¦Ù
);

4135 ià(
	`couÁKeysInSlÙ
(
¦Ù
) == 0 &&

4136 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
])

4137 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
] = 
NULL
;

4141 ià(
n
 =ğ
my£lf
 &&

4142 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
])

4153 ià(
	`şu¡”BumpCÚfigEpochW™houtCÚ£nsus
(è=ğ
C_OK
) {

4154 
	`£rv”Log
(
LL_WARNING
,

4155 "cÚfigEpoch upd©ed‡á” impÜtšg slÙ %d", 
¦Ù
);

4157 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] = 
NULL
;

4159 
	`şu¡”D–SlÙ
(
¦Ù
);

4160 
	`şu¡”AddSlÙ
(
n
,
¦Ù
);

4162 
	`addR•lyE¼Ü
(
c
,

4166 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_SAVE_CONFIG
|
CLUSTER_TODO_UPDATE_STATE
);

4167 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4168 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"bum³poch"è&& c->
¬gc
 == 2) {

4170 
»tv®
 = 
	`şu¡”BumpCÚfigEpochW™houtCÚ£nsus
();

4171 
sds
 
»¶y
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"+%s %llu\r\n",

4172 (
»tv®
 =ğ
C_OK
) ? "BUMPED" : "STILL",

4173 (è
my£lf
->
cÚfigEpoch
);

4174 
	`addR•lySds
(
c
,
»¶y
);

4175 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"šfo"è&& c->
¬gc
 == 2) {

4177 *
¡©e¡r
[] = {"ok","fail","needhelp"};

4178 
¦Ùs_assigÃd
 = 0, 
¦Ùs_ok
 = 0, 
¦Ùs_pç
 = 0, 
¦Ùs_ç
 = 0;

4179 
ušt64_t
 
my•och
;

4180 
j
;

4182 
j
 = 0; j < 
CLUSTER_SLOTS
; j++) {

4183 
şu¡”Node
 *
n
 = 
£rv”
.
şu¡”
->
¦Ùs
[
j
];

4185 ià(
n
 =ğ
NULL
) ;

4186 
¦Ùs_assigÃd
++;

4187 ià(
	`nodeFaed
(
n
)) {

4188 
¦Ùs_ç
++;

4189 } ià(
	`nodeTimedOut
(
n
)) {

4190 
¦Ùs_pç
++;

4192 
¦Ùs_ok
++;

4196 
my•och
 = (
	`nodeIsSÏve
(
my£lf
è&& my£lf->
¦aveof
) ?

4197 
my£lf
->
¦aveof
->
cÚfigEpoch
 : myself->configEpoch;

4199 
sds
 
šfo
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

4211 , 
¡©e¡r
[
£rv”
.
şu¡”
->
¡©e
],

4212 
¦Ùs_assigÃd
,

4213 
¦Ùs_ok
,

4214 
¦Ùs_pç
,

4215 
¦Ùs_ç
,

4216 
	`diùSize
(
£rv”
.
şu¡”
->
nodes
),

4217 
£rv”
.
şu¡”
->
size
,

4218 (è
£rv”
.
şu¡”
->
cu¼’tEpoch
,

4219 (è
my•och
,

4220 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_£Á
,

4221 
£rv”
.
şu¡”
->
¡©s_bus_mes§ges_»ûived


4223 
	`addR•lySds
(
c
,
	`sdsÿrštf
(
	`sd£m±y
(),"$%lu\r\n",

4224 ()
	`sd¦’
(
šfo
)));

4225 
	`addR•lySds
(
c
,
šfo
);

4226 
	`addR•ly
(
c
,
sh¬ed
.
ülf
);

4227 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"§vecÚfig"è&& c->
¬gc
 == 2) {

4228 
»tv®
 = 
	`şu¡”SaveCÚfig
(1);

4230 ià(
»tv®
 == 0)

4231 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4233 
	`addR•lyE¼ÜFÜm©
(
c
,"error savinghe cluster‚ode config: %s",

4234 
	`¡»¼Ü
(
”ºo
));

4235 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"key¦Ù"è&& c->
¬gc
 == 3) {

4237 
sds
 
key
 = 
c
->
¬gv
[2]->
±r
;

4239 
	`addR•lyLÚgLÚg
(
c
,
	`keyHashSlÙ
(
key
,
	`sd¦’
(key)));

4240 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"couÁkeysš¦Ù"è&& c->
¬gc
 == 3) {

4242 
¦Ù
;

4244 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
¦Ù
,
NULL
è!ğ
C_OK
)

4246 ià(
¦Ù
 < 0 || slÙ >ğ
CLUSTER_SLOTS
) {

4247 
	`addR•lyE¼Ü
(
c
,"Invalid slot");

4250 
	`addR•lyLÚgLÚg
(
c
,
	`couÁKeysInSlÙ
(
¦Ù
));

4251 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"g‘keysš¦Ù"è&& c->
¬gc
 == 4) {

4253 
maxkeys
, 
¦Ù
;

4254 
numkeys
, 
j
;

4255 
robj
 **
keys
;

4257 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
¦Ù
,
NULL
è!ğ
C_OK
)

4259 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
maxkeys
,
NULL
)

4260 !ğ
C_OK
)

4262 ià(
¦Ù
 < 0 || slÙ >ğ
CLUSTER_SLOTS
 || 
maxkeys
 < 0) {

4263 
	`addR•lyE¼Ü
(
c
,"Invalid slot or‚umber of keys");

4267 
keys
 = 
	`zm®loc
((
robj
*)*
maxkeys
);

4268 
numkeys
 = 
	`g‘KeysInSlÙ
(
¦Ù
, 
keys
, 
maxkeys
);

4269 
	`addR•lyMuÉiBulkL’
(
c
,
numkeys
);

4270 
j
 = 0; j < 
numkeys
; j++) {

4271 
	`addR•lyBulk
(
c
,
keys
[
j
]);

4272 
	`deüRefCouÁ
(
keys
[
j
]);

4274 
	`zä“
(
keys
);

4275 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"fÜg‘"è&& c->
¬gc
 == 3) {

4277 
şu¡”Node
 *
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[2]->
±r
);

4279 ià(!
n
) {

4280 
	`addR•lyE¼ÜFÜm©
(
c
,"UnknowÀnod%s", (*)c->
¬gv
[2]->
±r
);

4282 } ià(
n
 =ğ
my£lf
) {

4283 
	`addR•lyE¼Ü
(
c
,"Iried hard but I can't forget myself...");

4285 } ià(
	`nodeIsSÏve
(
my£lf
è&& my£lf->
¦aveof
 =ğ
n
) {

4286 
	`addR•lyE¼Ü
(
c
,"Can't forget my master!");

4289 
	`şu¡”BÏckli¡AddNode
(
n
);

4290 
	`şu¡”D–Node
(
n
);

4291 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|

4292 
CLUSTER_TODO_SAVE_CONFIG
);

4293 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4294 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"»¶iÿ‹"è&& c->
¬gc
 == 3) {

4296 
şu¡”Node
 *
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[2]->
±r
);

4299 ià(!
n
) {

4300 
	`addR•lyE¼ÜFÜm©
(
c
,"UnknowÀnod%s", (*)c->
¬gv
[2]->
±r
);

4305 ià(
n
 =ğ
my£lf
) {

4306 
	`addR•lyE¼Ü
(
c
,"Can't„eplicate myself");

4311 ià(
	`nodeIsSÏve
(
n
)) {

4312 
	`addR•lyE¼Ü
(
c
,"I can only„eplicate‡ master,‚ot‡ slave.");

4319 ià(
	`nodeIsMa¡”
(
my£lf
) &&

4320 (
my£lf
->
num¦Ùs
 !ğ0 || 
	`diùSize
(
£rv”
.
db
[0].
diù
) != 0)) {

4321 
	`addR•lyE¼Ü
(
c
,

4328 
	`şu¡”S‘Ma¡”
(
n
);

4329 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|
CLUSTER_TODO_SAVE_CONFIG
);

4330 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4331 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"¦aves"è&& c->
¬gc
 == 3) {

4333 
şu¡”Node
 *
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[2]->
±r
);

4334 
j
;

4337 ià(!
n
) {

4338 
	`addR•lyE¼ÜFÜm©
(
c
,"UnknowÀnod%s", (*)c->
¬gv
[2]->
±r
);

4342 ià(
	`nodeIsSÏve
(
n
)) {

4343 
	`addR•lyE¼Ü
(
c
,"The specified‚ode is‚ot‡ master");

4347 
	`addR•lyMuÉiBulkL’
(
c
,
n
->
num¦aves
);

4348 
j
 = 0; j < 
n
->
num¦aves
; j++) {

4349 
sds
 
ni
 = 
	`şu¡”G’NodeDesütiÚ
(
n
->
¦aves
[
j
]);

4350 
	`addR•lyBulkCSŒšg
(
c
,
ni
);

4351 
	`sdsä“
(
ni
);

4353 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"count-failure-reports") &&

4354 
c
->
¬gc
 == 3)

4357 
şu¡”Node
 *
n
 = 
	`şu¡”LookupNode
(
c
->
¬gv
[2]->
±r
);

4359 ià(!
n
) {

4360 
	`addR•lyE¼ÜFÜm©
(
c
,"UnknowÀnod%s", (*)c->
¬gv
[2]->
±r
);

4363 
	`addR•lyLÚgLÚg
(
c
,
	`şu¡”NodeFau»R•ÜtsCouÁ
(
n
));

4365 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"failover") &&

4366 (
c
->
¬gc
 == 2 || c->argc == 3))

4369 
fÜû
 = 0, 
keov”
 = 0;

4371 ià(
c
->
¬gc
 == 3) {

4372 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"force")) {

4373 
fÜû
 = 1;

4374 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"takeover")) {

4375 
keov”
 = 1;

4376 
fÜû
 = 1;

4378 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

4384 ià(
	`nodeIsMa¡”
(
my£lf
)) {

4385 
	`addR•lyE¼Ü
(
c
,"You should send CLUSTER FAILOVERo‡ slave");

4387 } ià(
my£lf
->
¦aveof
 =ğ
NULL
) {

4388 
	`addR•lyE¼Ü
(
c
,"I'm‡ slave but my master is unknowno me");

4390 } ià(!
fÜû
 &&

4391 (
	`nodeFaed
(
my£lf
->
¦aveof
) ||

4392 
my£lf
->
¦aveof
->
lšk
 =ğ
NULL
))

4394 
	`addR•lyE¼Ü
(
c
,"Master is down or failed, "

4398 
	`»£tMªu®Faov”
();

4399 
£rv”
.
şu¡”
->
mf_’d
 = 
	`m¡ime
(è+ 
CLUSTER_MF_TIMEOUT
;

4401 ià(
keov”
) {

4406 
	`£rv”Log
(
LL_WARNING
,"Taking overhe master (user„equest).");

4407 
	`şu¡”BumpCÚfigEpochW™houtCÚ£nsus
();

4408 
	`şu¡”Faov”R•ÏûYourMa¡”
();

4409 } ià(
fÜû
) {

4413 
	`£rv”Log
(
LL_WARNING
,"Forced failover user„equest‡ccepted.");

4414 
£rv”
.
şu¡”
->
mf_ÿn_¡¬t
 = 1;

4416 
	`£rv”Log
(
LL_WARNING
,"Manual failover user„equest‡ccepted.");

4417 
	`şu¡”S’dMFS¹
(
my£lf
->
¦aveof
);

4419 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4420 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"£t-cÚfig-•och"è&& c->
¬gc
 == 3)

4429 
•och
;

4431 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
•och
,
NULL
è!ğ
C_OK
)

4434 ià(
•och
 < 0) {

4435 
	`addR•lyE¼ÜFÜm©
(
c
,"Inv®id cÚfigƒpoch s³cif›d: %Îd",
•och
);

4436 } ià(
	`diùSize
(
£rv”
.
şu¡”
->
nodes
) > 1) {

4437 
	`addR•lyE¼Ü
(
c
,"The user can‡ssign‡ configƒpoch only whenhe "

4439 } ià(
my£lf
->
cÚfigEpoch
 != 0) {

4440 
	`addR•lyE¼Ü
(
c
,"Node configƒpoch is‡lready‚on-zero");

4442 
my£lf
->
cÚfigEpoch
 = 
•och
;

4443 
	`£rv”Log
(
LL_WARNING
,

4445 (è
my£lf
->
cÚfigEpoch
);

4447 ià(
£rv”
.
şu¡”
->
cu¼’tEpoch
 < (
ušt64_t
)
•och
)

4448 
£rv”
.
şu¡”
->
cu¼’tEpoch
 = 
•och
;

4452 
	`şu¡”DoBefÜeSË•
(
CLUSTER_TODO_UPDATE_STATE
|

4453 
CLUSTER_TODO_SAVE_CONFIG
);

4454 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4456 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"reset") &&

4457 (
c
->
¬gc
 == 2 || c->argc == 3))

4460 
h¬d
 = 0;

4463 ià(
c
->
¬gc
 == 3) {

4464 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"hard")) {

4465 
h¬d
 = 1;

4466 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"soft")) {

4467 
h¬d
 = 0;

4469 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

4476 ià(
	`nodeIsMa¡”
(
my£lf
è&& 
	`diùSize
(
c
->
db
->
diù
) != 0) {

4477 
	`addR•lyE¼Ü
(
c
,"CLUSTER RESET can't be called with "

4481 
	`şu¡”Re£t
(
h¬d
);

4482 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4484 
	`addR•lyE¼Ü
(
c
,"Wrong CLUSTER subcommand or‚umber of‡rguments");

4486 
	}
}

4494 
	$ü—‹DumpPaylßd
(
rio
 *
·ylßd
, 
robj
 *
o
) {

4495 
buf
[2];

4496 
ušt64_t
 
üc
;

4500 
	`rioIn™W™hBufãr
(
·ylßd
,
	`sd£m±y
());

4501 
	`£rv”As£¹
(
	`rdbSaveObjeùTy³
(
·ylßd
,
o
));

4502 
	`£rv”As£¹
(
	`rdbSaveObjeù
(
·ylßd
,
o
));

4512 
buf
[0] = 
RDB_VERSION
 & 0xff;

4513 
buf
[1] = (
RDB_VERSION
 >> 8) & 0xff;

4514 
·ylßd
->
io
.
bufãr
.
±r
 = 
	`sdsÿ’
Õaylßd->io.bufãr.±r,
buf
,2);

4517 
üc
 = 
	`üc64
(0,(*)
·ylßd
->
io
.
bufãr
.
±r
,

4518 
	`sd¦’
(
·ylßd
->
io
.
bufãr
.
±r
));

4519 
	`mem»v64ifbe
(&
üc
);

4520 
·ylßd
->
io
.
bufãr
.
±r
 = 
	`sdsÿ’
Õaylßd->io.bufãr.±r,&
üc
,8);

4521 
	}
}

4527 
	$v”ifyDumpPaylßd
(*
p
, 
size_t
 
Ën
) {

4528 *
foÙ”
;

4529 
ušt16_t
 
rdbv”
;

4530 
ušt64_t
 
üc
;

4533 ià(
Ën
 < 10è 
C_ERR
;

4534 
foÙ”
 = 
p
+(
Ën
-10);

4537 
rdbv”
 = (
foÙ”
[1] << 8) | footer[0];

4538 ià(
rdbv”
 > 
RDB_VERSION
è 
C_ERR
;

4541 
üc
 = 
	`üc64
(0,
p
,
Ën
-8);

4542 
	`mem»v64ifbe
(&
üc
);

4543  (
	`memcmp
(&
üc
,
foÙ”
+2,8è=ğ0è? 
C_OK
 : 
C_ERR
;

4544 
	}
}

4549 
	$dumpCommªd
(
ş›Á
 *
c
) {

4550 
robj
 *
o
, *
dumpobj
;

4551 
rio
 
·ylßd
;

4554 ià((
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[1])è=ğ
NULL
) {

4555 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

4560 
	`ü—‹DumpPaylßd
(&
·ylßd
,
o
);

4563 
dumpobj
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
·ylßd
.
io
.
bufãr
.
±r
);

4564 
	`addR•lyBulk
(
c
,
dumpobj
);

4565 
	`deüRefCouÁ
(
dumpobj
);

4567 
	}
}

4570 
	$»¡ÜeCommªd
(
ş›Á
 *
c
) {

4571 
‰l
;

4572 
rio
 
·ylßd
;

4573 
j
, 
ty³
, 
»¶aû
 = 0;

4574 
robj
 *
obj
;

4577 
j
 = 4; j < 
c
->
¬gc
; j++) {

4578 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"replace")) {

4579 
»¶aû
 = 1;

4581 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

4587 ià(!
»¶aû
 && 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]è!ğ
NULL
) {

4588 
	`addR•ly
(
c
,
sh¬ed
.
busykey”r
);

4593 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
‰l
,
NULL
è!ğ
C_OK
) {

4595 } ià(
‰l
 < 0) {

4596 
	`addR•lyE¼Ü
(
c
,"Invalid TTL value, must be >= 0");

4601 ià(
	`v”ifyDumpPaylßd
(
c
->
¬gv
[3]->
±r
,
	`sd¦’
(c->¬gv[3]->±r)è=ğ
C_ERR
)

4603 
	`addR•lyE¼Ü
(
c
,"DUMP…ayload version or checksum‡re wrong");

4607 
	`rioIn™W™hBufãr
(&
·ylßd
,
c
->
¬gv
[3]->
±r
);

4608 ià(((
ty³
 = 
	`rdbLßdObjeùTy³
(&
·ylßd
)) == -1) ||

4609 ((
obj
 = 
	`rdbLßdObjeù
(
ty³
,&
·ylßd
)è=ğ
NULL
))

4611 
	`addR•lyE¼Ü
(
c
,"Bad data format");

4616 ià(
»¶aû
è
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

4619 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
obj
);

4620 ià(
‰l
è
	`£tExpœe
(
c
->
db
,c->
¬gv
[1],
	`m¡ime
()+ttl);

4621 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

4622 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4623 
£rv”
.
dœty
++;

4624 
	}
}

4632 
	#MIGRATE_SOCKET_CACHE_ITEMS
 64

	)

4633 
	#MIGRATE_SOCKET_CACHE_TTL
 10

	)

4635 
	smig¿‹CachedSock‘
 {

4636 
	mfd
;

4637 
	mÏ¡_dbid
;

4638 
time_t
 
	mÏ¡_u£_time
;

4639 } 
	tmig¿‹CachedSock‘
;

4652 
mig¿‹CachedSock‘
* 
	$mig¿‹G‘Sock‘
(
ş›Á
 *
c
, 
robj
 *
ho¡
,„obj *
pÜt
, 
timeout
) {

4653 
fd
;

4654 
sds
 
Çme
 = 
	`sd£m±y
();

4655 
mig¿‹CachedSock‘
 *
cs
;

4658 
Çme
 = 
	`sdsÿ’
Òame,
ho¡
->
±r
,
	`sd¦’
(host->ptr));

4659 
Çme
 = 
	`sdsÿ’
(name,":",1);

4660 
Çme
 = 
	`sdsÿ’
Òame,
pÜt
->
±r
,
	`sd¦’
(port->ptr));

4661 
cs
 = 
	`diùF‘chV®ue
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
Çme
);

4662 ià(
cs
) {

4663 
	`sdsä“
(
Çme
);

4664 
cs
->
Ï¡_u£_time
 = 
£rv”
.
unixtime
;

4665  
cs
;

4669 ià(
	`diùSize
(
£rv”
.
mig¿‹_ÿched_sock‘s
è=ğ
MIGRATE_SOCKET_CACHE_ITEMS
) {

4671 
diùEÁry
 *
de
 = 
	`diùG‘RªdomKey
(
£rv”
.
mig¿‹_ÿched_sock‘s
);

4672 
cs
 = 
	`diùG‘V®
(
de
);

4673 
	`şo£
(
cs
->
fd
);

4674 
	`zä“
(
cs
);

4675 
	`diùD–‘e
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
	`diùG‘Key
(
de
));

4679 
fd
 = 
	`ª‘TıNÚBlockCÚÃù
(
£rv”
.
Ã‹¼
,
c
->
¬gv
[1]->
±r
,

4680 
	`©oi
(
c
->
¬gv
[2]->
±r
));

4681 ià(
fd
 == -1) {

4682 
	`sdsä“
(
Çme
);

4683 
	`addR•lyE¼ÜFÜm©
(
c
,"Can't connectoarget‚ode: %s",

4684 
£rv”
.
Ã‹¼
);

4685  
NULL
;

4687 
	`ª‘EÇbËTıNoD–ay
(
£rv”
.
Ã‹¼
,
fd
);

4690 ià((
	`«Wa™
(
fd
,
AE_WRITABLE
,
timeout
) & AE_WRITABLE) == 0) {

4691 
	`sdsä“
(
Çme
);

4692 
	`addR•lySds
(
c
,

4693 
	`sd¢ew
("-IOERRƒrror orimeout connectingohe client\r\n"));

4694 
	`şo£
(
fd
);

4695  
NULL
;

4699 
cs
 = 
	`zm®loc
((*cs));

4700 
cs
->
fd
 = fd;

4701 
cs
->
Ï¡_dbid
 = -1;

4702 
cs
->
Ï¡_u£_time
 = 
£rv”
.
unixtime
;

4703 
	`diùAdd
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
Çme
,
cs
);

4704  
cs
;

4705 
	}
}

4708 
	$mig¿‹Clo£Sock‘
(
robj
 *
ho¡
,„obj *
pÜt
) {

4709 
sds
 
Çme
 = 
	`sd£m±y
();

4710 
mig¿‹CachedSock‘
 *
cs
;

4712 
Çme
 = 
	`sdsÿ’
Òame,
ho¡
->
±r
,
	`sd¦’
(host->ptr));

4713 
Çme
 = 
	`sdsÿ’
(name,":",1);

4714 
Çme
 = 
	`sdsÿ’
Òame,
pÜt
->
±r
,
	`sd¦’
(port->ptr));

4715 
cs
 = 
	`diùF‘chV®ue
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
Çme
);

4716 ià(!
cs
) {

4717 
	`sdsä“
(
Çme
);

4721 
	`şo£
(
cs
->
fd
);

4722 
	`zä“
(
cs
);

4723 
	`diùD–‘e
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
Çme
);

4724 
	`sdsä“
(
Çme
);

4725 
	}
}

4727 
	$mig¿‹Clo£TimedoutSock‘s
() {

4728 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
mig¿‹_ÿched_sock‘s
);

4729 
diùEÁry
 *
de
;

4731 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

4732 
mig¿‹CachedSock‘
 *
cs
 = 
	`diùG‘V®
(
de
);

4734 ià((
£rv”
.
unixtime
 - 
cs
->
Ï¡_u£_time
è> 
MIGRATE_SOCKET_CACHE_TTL
) {

4735 
	`şo£
(
cs
->
fd
);

4736 
	`zä“
(
cs
);

4737 
	`diùD–‘e
(
£rv”
.
mig¿‹_ÿched_sock‘s
,
	`diùG‘Key
(
de
));

4740 
	`diùR–—£I‹¿tÜ
(
di
);

4741 
	}
}

4748 
	$mig¿‹Commªd
(
ş›Á
 *
c
) {

4749 
mig¿‹CachedSock‘
 *
cs
;

4750 
cİy
, 
»¶aû
, 
j
;

4751 
timeout
;

4752 
dbid
;

4753 
‰l
, 
expœ—t
;

4754 
robj
 **
ov
 = 
NULL
;

4755 
robj
 **
kv
 = 
NULL
;

4756 
robj
 **
Ãw¬gv
 = 
NULL
;

4757 
rio
 
cmd
, 
·ylßd
;

4758 
may_»Œy
 = 1;

4759 
wr™e_”rÜ
 = 0;

4762 
fœ¡_key
 = 3;

4763 
num_keys
 = 1;

4766 
cİy
 = 0;

4767 
»¶aû
 = 0;

4768 
‰l
 = 0;

4771 
j
 = 6; j < 
c
->
¬gc
; j++) {

4772 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"copy")) {

4773 
cİy
 = 1;

4774 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"replace")) {

4775 
»¶aû
 = 1;

4776 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"keys")) {

4777 ià(
	`sd¦’
(
c
->
¬gv
[3]->
±r
) != 0) {

4778 
	`addR•lyE¼Ü
(
c
,

4783 
fœ¡_key
 = 
j
+1;

4784 
num_keys
 = 
c
->
¬gc
 - 
j
 - 1;

4787 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

4793 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[5],&
timeout
,
NULL
è!ğ
C_OK
 ||

4794 
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[4],&
dbid
,
NULL
è!ğ
C_OK
)

4798 ià(
timeout
 <= 0)imeout = 1000;

4805 
ov
 = 
	`z»®loc
(ov,(
robj
*)*
num_keys
);

4806 
kv
 = 
	`z»®loc
(kv,(
robj
*)*
num_keys
);

4807 
oi
 = 0;

4809 
j
 = 0; j < 
num_keys
; j++) {

4810 ià((
ov
[
oi
] = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
fœ¡_key
+
j
])è!ğ
NULL
) {

4811 
kv
[
oi
] = 
c
->
¬gv
[
fœ¡_key
+
j
];

4812 
oi
++;

4815 
num_keys
 = 
oi
;

4816 ià(
num_keys
 == 0) {

4817 
	`zä“
(
ov
); zä“(
kv
);

4818 
	`addR•lySds
(
c
,
	`sd¢ew
("+NOKEY\r\n"));

4822 
Œy_agaš
:

4823 
wr™e_”rÜ
 = 0;

4826 
cs
 = 
	`mig¿‹G‘Sock‘
(
c
,c->
¬gv
[1],c->¬gv[2],
timeout
);

4827 ià(
cs
 =ğ
NULL
) {

4828 
	`zä“
(
ov
); zä“(
kv
);

4832 
	`rioIn™W™hBufãr
(&
cmd
,
	`sd£m±y
());

4835 
£Ëù
 = 
cs
->
Ï¡_dbid
 !ğ
dbid
;

4836 ià(
£Ëù
) {

4837 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkCouÁ
(&
cmd
,'*',2));

4838 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkSŒšg
(&
cmd
,"SELECT",6));

4839 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkLÚgLÚg
(&
cmd
,
dbid
));

4843 
j
 = 0; j < 
num_keys
; j++) {

4844 
expœ—t
 = 
	`g‘Expœe
(
c
->
db
,
kv
[
j
]);

4845 ià(
expœ—t
 != -1) {

4846 
‰l
 = 
expœ—t
-
	`m¡ime
();

4847 ià(
‰l
 < 1)tl = 1;

4849 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkCouÁ
(&
cmd
,'*',
»¶aû
 ? 5 : 4));

4850 ià(
£rv”
.
şu¡”_’abËd
)

4851 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,

4852 
	`rioWr™eBulkSŒšg
(&
cmd
,"RESTORE-ASKING",14));

4854 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkSŒšg
(&
cmd
,"RESTORE",7));

4855 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`sdsEncodedObjeù
(
kv
[
j
]));

4856 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkSŒšg
(&
cmd
,
kv
[
j
]->
±r
,

4857 
	`sd¦’
(
kv
[
j
]->
±r
)));

4858 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkLÚgLÚg
(&
cmd
,
‰l
));

4862 
	`ü—‹DumpPaylßd
(&
·ylßd
,
ov
[
j
]);

4863 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,

4864 
	`rioWr™eBulkSŒšg
(&
cmd
,
·ylßd
.
io
.
bufãr
.
±r
,

4865 
	`sd¦’
(
·ylßd
.
io
.
bufãr
.
±r
)));

4866 
	`sdsä“
(
·ylßd
.
io
.
bufãr
.
±r
);

4870 ià(
»¶aû
)

4871 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`rioWr™eBulkSŒšg
(&
cmd
,"REPLACE",7));

4875 
”ºo
 = 0;

4877 
sds
 
buf
 = 
cmd
.
io
.
bufãr
.
±r
;

4878 
size_t
 
pos
 = 0, 
towr™e
;

4879 
nwr™‹n
 = 0;

4881 (
towr™e
 = 
	`sd¦’
(
buf
)-
pos
) > 0) {

4882 
towr™e
 = (towrite > (64*1024) ? (64*1024) :owrite);

4883 
nwr™‹n
 = 
	`syncWr™e
(
cs
->
fd
,
buf
+
pos
,
towr™e
,
timeout
);

4884 ià(
nwr™‹n
 !ğ(sigÃd)
towr™e
) {

4885 
wr™e_”rÜ
 = 1;

4886 
sock‘_”r
;

4888 
pos
 +ğ
nwr™‹n
;

4892 
buf1
[1024];

4893 
buf2
[1024];

4896 ià(
£Ëù
 && 
	`syncR—dLše
(
cs
->
fd
, 
buf1
, (buf1), 
timeout
) <= 0)

4897 
sock‘_”r
;

4900 
”rÜ_äom_rg‘
 = 0;

4901 
sock‘_”rÜ
 = 0;

4902 
d–_idx
 = 1;

4904 ià(!
cİy
è
Ãw¬gv
 = 
	`zm®loc
((
robj
*)*(
num_keys
+1));

4906 
j
 = 0; j < 
num_keys
; j++) {

4907 ià(
	`syncR—dLše
(
cs
->
fd
, 
buf2
, (buf2), 
timeout
) <= 0) {

4908 
sock‘_”rÜ
 = 1;

4911 ià((
£Ëù
 && 
buf1
[0] =ğ'-'è|| 
buf2
[0] == '-') {

4913 ià(!
”rÜ_äom_rg‘
) {

4914 
cs
->
Ï¡_dbid
 = -1;

4915 
	`addR•lyE¼ÜFÜm©
(
c
,"Target instance„eplied withƒrror: %s",

4916 (
£Ëù
 && 
buf1
[0] =ğ'-'è? buf1+1 : 
buf2
+1);

4917 
”rÜ_äom_rg‘
 = 1;

4920 ià(!
cİy
) {

4922 
	`dbD–‘e
(
c
->
db
,
kv
[
j
]);

4923 
	`sigÇlModif›dKey
(
c
->
db
,
kv
[
j
]);

4924 
£rv”
.
dœty
++;

4927 
Ãw¬gv
[
d–_idx
++] = 
kv
[
j
];

4928 
	`šüRefCouÁ
(
kv
[
j
]);

4936 ià(!
”rÜ_äom_rg‘
 && 
sock‘_”rÜ
 && 
j
 =ğ0 && 
may_»Œy
 &&

4937 
”ºo
 !ğ
ETIMEDOUT
)

4939 
sock‘_”r
;

4942 ià(!
cİy
) {

4944 ià(
d–_idx
 > 1) {

4945 
Ãw¬gv
[0] = 
	`ü—‹SŒšgObjeù
("DEL",3);

4947 
	`»¶aûCl›ÁCommªdVeùÜ
(
c
,
d–_idx
,
Ãw¬gv
);

4950 
	`zä“
(
Ãw¬gv
);

4952 
Ãw¬gv
 = 
NULL
;

4958 ià(!
”rÜ_äom_rg‘
 && 
sock‘_”rÜ
) {

4959 
may_»Œy
 = 0;

4960 
sock‘_”r
;

4963 ià(!
”rÜ_äom_rg‘
) {

4966 
cs
->
Ï¡_dbid
 = 
dbid
;

4967 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

4973 
	`sdsä“
(
cmd
.
io
.
bufãr
.
±r
);

4974 
	`zä“
(
ov
); zä“(
kv
); zä“(
Ãw¬gv
);

4975 ià(
sock‘_”rÜ
è
	`mig¿‹Clo£Sock‘
(
c
->
¬gv
[1],c->argv[2]);

4981 
sock‘_”r
:

4984 
	`sdsä“
(
cmd
.
io
.
bufãr
.
±r
);

4985 
	`mig¿‹Clo£Sock‘
(
c
->
¬gv
[1],c->argv[2]);

4986 
	`zä“
(
Ãw¬gv
);

4987 
Ãw¬gv
 = 
NULL
;

4991 ià(
”ºo
 !ğ
ETIMEDOUT
 && 
may_»Œy
) {

4992 
may_»Œy
 = 0;

4993 
Œy_agaš
;

4997 
	`zä“
(
ov
); zä“(
kv
);

4998 
	`addR•lySds
(
c
,

4999 
	`sdsÿrštf
(
	`sd£m±y
(),

5001 
wr™e_”rÜ
 ? "writing" : "reading"));

5003 
	}
}

5013 
	$askšgCommªd
(
ş›Á
 *
c
) {

5014 ià(
£rv”
.
şu¡”_’abËd
 == 0) {

5015 
	`addR•lyE¼Ü
(
c
,"This instance has cluster support disabled");

5018 
c
->
æags
 |ğ
CLIENT_ASKING
;

5019 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

5020 
	}
}

5025 
	$»adÚlyCommªd
(
ş›Á
 *
c
) {

5026 ià(
£rv”
.
şu¡”_’abËd
 == 0) {

5027 
	`addR•lyE¼Ü
(
c
,"This instance has cluster support disabled");

5030 
c
->
æags
 |ğ
CLIENT_READONLY
;

5031 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

5032 
	}
}

5035 
	$»adwr™eCommªd
(
ş›Á
 *
c
) {

5036 
c
->
æags
 &ğ~
CLIENT_READONLY
;

5037 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

5038 
	}
}

5072 
şu¡”Node
 *
	$g‘NodeByQu”y
(
ş›Á
 *
c
, 
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
hash¦Ù
, *
”rÜ_code
) {

5073 
şu¡”Node
 *
n
 = 
NULL
;

5074 
robj
 *
fœ¡key
 = 
NULL
;

5075 
muÉË_keys
 = 0;

5076 
muÉiS‹
 *
ms
, 
_ms
;

5077 
muÉiCmd
 
mc
;

5078 
i
, 
¦Ù
 = 0, 
mig¿tšg_¦Ù
 = 0, 
impÜtšg_¦Ù
 = 0, 
missšg_keys
 = 0;

5081 ià(
”rÜ_code
è*”rÜ_codğ
CLUSTER_REDIR_NONE
;

5085 ià(
cmd
->
´oc
 =ğ
execCommªd
) {

5088 ià(!(
c
->
æags
 & 
CLIENT_MULTI
)è 
my£lf
;

5089 
ms
 = &
c
->
m¡©e
;

5094 
ms
 = &
_ms
;

5095 
_ms
.
commªds
 = &
mc
;

5096 
_ms
.
couÁ
 = 1;

5097 
mc
.
¬gv
 =‡rgv;

5098 
mc
.
¬gc
 =‡rgc;

5099 
mc
.
cmd
 = cmd;

5104 
i
 = 0; i < 
ms
->
couÁ
; i++) {

5105 
»disCommªd
 *
mcmd
;

5106 
robj
 **
m¬gv
;

5107 
m¬gc
, *
keyšdex
, 
numkeys
, 
j
;

5109 
mcmd
 = 
ms
->
commªds
[
i
].
cmd
;

5110 
m¬gc
 = 
ms
->
commªds
[
i
].
¬gc
;

5111 
m¬gv
 = 
ms
->
commªds
[
i
].
¬gv
;

5113 
keyšdex
 = 
	`g‘KeysFromCommªd
(
mcmd
,
m¬gv
,
m¬gc
,&
numkeys
);

5114 
j
 = 0; j < 
numkeys
; j++) {

5115 
robj
 *
thiskey
 = 
m¬gv
[
keyšdex
[
j
]];

5116 
this¦Ù
 = 
	`keyHashSlÙ
((*)
thiskey
->
±r
,

5117 
	`sd¦’
(
thiskey
->
±r
));

5119 ià(
fœ¡key
 =ğ
NULL
) {

5122 
fœ¡key
 = 
thiskey
;

5123 
¦Ù
 = 
this¦Ù
;

5124 
n
 = 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
];

5130 ià(
n
 =ğ
NULL
) {

5131 
	`g‘KeysF»eResuÉ
(
keyšdex
);

5132 ià(
”rÜ_code
)

5133 *
”rÜ_code
 = 
CLUSTER_REDIR_DOWN_UNBOUND
;

5134  
NULL
;

5142 ià(
n
 =ğ
my£lf
 &&

5143 
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
] !ğ
NULL
)

5145 
mig¿tšg_¦Ù
 = 1;

5146 } ià(
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] !ğ
NULL
) {

5147 
impÜtšg_¦Ù
 = 1;

5152 ià(!
	`equ®SŒšgObjeùs
(
fœ¡key
,
thiskey
)) {

5153 ià(
¦Ù
 !ğ
this¦Ù
) {

5155 
	`g‘KeysF»eResuÉ
(
keyšdex
);

5156 ià(
”rÜ_code
)

5157 *
”rÜ_code
 = 
CLUSTER_REDIR_CROSS_SLOT
;

5158  
NULL
;

5162 
muÉË_keys
 = 1;

5168 ià((
mig¿tšg_¦Ù
 || 
impÜtšg_¦Ù
) &&

5169 
	`lookupKeyR—d
(&
£rv”
.
db
[0],
thiskey
è=ğ
NULL
)

5171 
missšg_keys
++;

5174 
	`g‘KeysF»eResuÉ
(
keyšdex
);

5179 ià(
n
 =ğ
NULL
è 
my£lf
;

5182 ià(
£rv”
.
şu¡”
->
¡©e
 !ğ
CLUSTER_OK
) {

5183 ià(
”rÜ_code
è*”rÜ_codğ
CLUSTER_REDIR_DOWN_STATE
;

5184  
NULL
;

5188 ià(
hash¦Ù
è*hash¦Ù = 
¦Ù
;

5193 ià((
mig¿tšg_¦Ù
 || 
impÜtšg_¦Ù
è&& 
cmd
->
´oc
 =ğ
mig¿‹Commªd
)

5194  
my£lf
;

5198 ià(
mig¿tšg_¦Ù
 && 
missšg_keys
) {

5199 ià(
”rÜ_code
è*”rÜ_codğ
CLUSTER_REDIR_ASK
;

5200  
£rv”
.
şu¡”
->
mig¿tšg_¦Ùs_to
[
¦Ù
];

5207 ià(
impÜtšg_¦Ù
 &&

5208 (
c
->
æags
 & 
CLIENT_ASKING
 || 
cmd
->æag & 
CMD_ASKING
))

5210 ià(
muÉË_keys
 && 
missšg_keys
) {

5211 ià(
”rÜ_code
è*”rÜ_codğ
CLUSTER_REDIR_UNSTABLE
;

5212  
NULL
;

5214  
my£lf
;

5221 ià(
c
->
æags
 & 
CLIENT_READONLY
 &&

5222 
cmd
->
æags
 & 
CMD_READONLY
 &&

5223 
	`nodeIsSÏve
(
my£lf
) &&

5224 
my£lf
->
¦aveof
 =ğ
n
)

5226  
my£lf
;

5231 ià(
n
 !ğ
my£lf
 && 
”rÜ_code
è*”rÜ_codğ
CLUSTER_REDIR_MOVED
;

5232  
n
;

5233 
	}
}

5242 
	$şu¡”RedœeùCl›Á
(
ş›Á
 *
c
, 
şu¡”Node
 *
n
, 
hash¦Ù
, 
”rÜ_code
) {

5243 ià(
”rÜ_code
 =ğ
CLUSTER_REDIR_CROSS_SLOT
) {

5244 
	`addR•lySds
(
c
,
	`sd¢ew
("-CROSSSLOT Keys in„equest don't hashohe same slot\r\n"));

5245 } ià(
”rÜ_code
 =ğ
CLUSTER_REDIR_UNSTABLE
) {

5249 
	`addR•lySds
(
c
,
	`sd¢ew
("-TRYAGAIN Multiple keys„equest during„ehashing of slot\r\n"));

5250 } ià(
”rÜ_code
 =ğ
CLUSTER_REDIR_DOWN_STATE
) {

5251 
	`addR•lySds
(
c
,
	`sd¢ew
("-CLUSTERDOWN The cluster is down\r\n"));

5252 } ià(
”rÜ_code
 =ğ
CLUSTER_REDIR_DOWN_UNBOUND
) {

5253 
	`addR•lySds
(
c
,
	`sd¢ew
("-CLUSTERDOWN Hash slot‚ot served\r\n"));

5254 } ià(
”rÜ_code
 =ğ
CLUSTER_REDIR_MOVED
 ||

5255 
”rÜ_code
 =ğ
CLUSTER_REDIR_ASK
)

5257 
	`addR•lySds
(
c
,
	`sdsÿrštf
(
	`sd£m±y
(),

5259 (
”rÜ_code
 =ğ
CLUSTER_REDIR_ASK
) ? "ASK" : "MOVED",

5260 
hash¦Ù
,
n
->

,n->
pÜt
));

5262 
	`£rv”Pªic
("getNodeByQuery() unknownƒrror.");

5264 
	}
}

5277 
	$şu¡”RedœeùBlockedCl›ÁIfN“ded
(
ş›Á
 *
c
) {

5278 ià(
c
->
æags
 & 
CLIENT_BLOCKED
 && c->
bty³
 =ğ
BLOCKED_LIST
) {

5279 
diùEÁry
 *
de
;

5280 
diùI‹¿tÜ
 *
di
;

5283 ià(
£rv”
.
şu¡”
->
¡©e
 =ğ
CLUSTER_FAIL
) {

5284 
	`şu¡”RedœeùCl›Á
(
c
,
NULL
,0,
CLUSTER_REDIR_DOWN_STATE
);

5288 
di
 = 
	`diùG‘I‹¿tÜ
(
c
->
bpİ
.
keys
);

5289 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

5290 
robj
 *
key
 = 
	`diùG‘Key
(
de
);

5291 
¦Ù
 = 
	`keyHashSlÙ
((*)
key
->
±r
, 
	`sd¦’
(key->ptr));

5292 
şu¡”Node
 *
node
 = 
£rv”
.
şu¡”
->
¦Ùs
[
¦Ù
];

5297 ià(
node
 !ğ
my£lf
 &&

5298 
£rv”
.
şu¡”
->
impÜtšg_¦Ùs_äom
[
¦Ù
] =ğ
NULL
)

5300 ià(
node
 =ğ
NULL
) {

5301 
	`şu¡”RedœeùCl›Á
(
c
,
NULL
,0,

5302 
CLUSTER_REDIR_DOWN_UNBOUND
);

5304 
	`şu¡”RedœeùCl›Á
(
c
,
node
,
¦Ù
,

5305 
CLUSTER_REDIR_MOVED
);

5310 
	`diùR–—£I‹¿tÜ
(
di
);

5313 
	}
}

	@cluster.h

1 #iâdeà
__CLUSTER_H


2 
	#__CLUSTER_H


	)

8 
	#CLUSTER_SLOTS
 16384

	)

9 
	#CLUSTER_OK
 0

	)

10 
	#CLUSTER_FAIL
 1

	)

11 
	#CLUSTER_NAMELEN
 40

	)

12 
	#CLUSTER_PORT_INCR
 10000

	)

16 
	#CLUSTER_DEFAULT_NODE_TIMEOUT
 15000

	)

17 
	#CLUSTER_DEFAULT_SLAVE_VALIDITY
 10

	)

18 
	#CLUSTER_DEFAULT_REQUIRE_FULL_COVERAGE
 1

	)

19 
	#CLUSTER_FAIL_REPORT_VALIDITY_MULT
 2

	)

20 
	#CLUSTER_FAIL_UNDO_TIME_MULT
 2

	)

21 
	#CLUSTER_FAIL_UNDO_TIME_ADD
 10

	)

22 
	#CLUSTER_FAILOVER_DELAY
 5

	)

23 
	#CLUSTER_DEFAULT_MIGRATION_BARRIER
 1

	)

24 
	#CLUSTER_MF_TIMEOUT
 5000

	)

25 
	#CLUSTER_MF_PAUSE_MULT
 2

	)

26 
	#CLUSTER_SLAVE_MIGRATION_DELAY
 5000

	)

29 
	#CLUSTER_REDIR_NONE
 0

	)

30 
	#CLUSTER_REDIR_CROSS_SLOT
 1

	)

31 
	#CLUSTER_REDIR_UNSTABLE
 2

	)

32 
	#CLUSTER_REDIR_ASK
 3

	)

33 
	#CLUSTER_REDIR_MOVED
 4

	)

34 
	#CLUSTER_REDIR_DOWN_STATE
 5

	)

35 
	#CLUSTER_REDIR_DOWN_UNBOUND
 6

	)

37 
	gşu¡”Node
;

40 
	sşu¡”Lšk
 {

41 
m¡ime_t
 
	mùime
;

42 
	mfd
;

43 
sds
 
	m¢dbuf
;

44 
sds
 
	mrcvbuf
;

45 
şu¡”Node
 *
	mnode
;

46 } 
	tşu¡”Lšk
;

49 
	#CLUSTER_NODE_MASTER
 1

	)

50 
	#CLUSTER_NODE_SLAVE
 2

	)

51 
	#CLUSTER_NODE_PFAIL
 4

	)

52 
	#CLUSTER_NODE_FAIL
 8

	)

53 
	#CLUSTER_NODE_MYSELF
 16

	)

54 
	#CLUSTER_NODE_HANDSHAKE
 32

	)

55 
	#CLUSTER_NODE_NOADDR
 64

	)

56 
	#CLUSTER_NODE_MEET
 128

	)

57 
	#CLUSTER_NODE_MIGRATE_TO
 256

	)

58 
	#CLUSTER_NODE_NULL_NAME
 "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"

	)

60 
	#nodeIsMa¡”
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_MASTER
)

	)

61 
	#nodeIsSÏve
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_SLAVE
)

	)

62 
	#nodeInHªdshake
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_HANDSHAKE
)

	)

63 
	#nodeHasAddr
(
n
è(!(Ò)->
æags
 & 
CLUSTER_NODE_NOADDR
))

	)

64 
	#nodeW™houtAddr
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_NOADDR
)

	)

65 
	#nodeTimedOut
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_PFAIL
)

	)

66 
	#nodeFaed
(
n
è(Ò)->
æags
 & 
CLUSTER_NODE_FAIL
)

	)

69 
	#CLUSTER_CANT_FAILOVER_NONE
 0

	)

70 
	#CLUSTER_CANT_FAILOVER_DATA_AGE
 1

	)

71 
	#CLUSTER_CANT_FAILOVER_WAITING_DELAY
 2

	)

72 
	#CLUSTER_CANT_FAILOVER_EXPIRED
 3

	)

73 
	#CLUSTER_CANT_FAILOVER_WAITING_VOTES
 4

	)

74 
	#CLUSTER_CANT_FAILOVER_RELOG_PERIOD
 (60*5è

	)

77 
	sşu¡”NodeFaR•Üt
 {

78 
şu¡”Node
 *
	mnode
;

79 
m¡ime_t
 
	mtime
;

80 } 
	tşu¡”NodeFaR•Üt
;

82 
	sşu¡”Node
 {

83 
m¡ime_t
 
	mùime
;

84 
	mÇme
[
CLUSTER_NAMELEN
];

85 
	mæags
;

86 
ušt64_t
 
	mcÚfigEpoch
;

87 
	m¦Ùs
[
CLUSTER_SLOTS
/8];

88 
	mnum¦Ùs
;

89 
	mnum¦aves
;

90 
şu¡”Node
 **
	m¦aves
;

91 
şu¡”Node
 *
	m¦aveof
;

95 
m¡ime_t
 
	mpšg_£Á
;

96 
m¡ime_t
 
	mpÚg_»ûived
;

97 
m¡ime_t
 
	mç_time
;

98 
m¡ime_t
 
	mvÙed_time
;

99 
m¡ime_t
 
	m»¶_off£t_time
;

100 
m¡ime_t
 
	mÜphªed_time
;

101 
	m»¶_off£t
;

102 
	m
[
NET_IP_STR_LEN
];

103 
	mpÜt
;

104 
	mıÜt
;

105 
şu¡”Lšk
 *
	mlšk
;

106 
li¡
 *
	mç_»pÜts
;

107 } 
	tşu¡”Node
;

109 
	sşu¡”S‹
 {

110 
şu¡”Node
 *
	mmy£lf
;

111 
ušt64_t
 
	mcu¼’tEpoch
;

112 
	m¡©e
;

113 
	msize
;

114 
diù
 *
	mnodes
;

115 
diù
 *
	mnodes_bÏck_li¡
;

116 
şu¡”Node
 *
	mmig¿tšg_¦Ùs_to
[
CLUSTER_SLOTS
];

117 
şu¡”Node
 *
	mimpÜtšg_¦Ùs_äom
[
CLUSTER_SLOTS
];

118 
şu¡”Node
 *
	m¦Ùs
[
CLUSTER_SLOTS
];

119 
zskli¡
 *
	m¦Ùs_to_keys
;

121 
m¡ime_t
 
	mçov”_auth_time
;

122 
	mçov”_auth_couÁ
;

123 
	mçov”_auth_£Á
;

124 
	mçov”_auth_¿nk
;

125 
ušt64_t
 
	mçov”_auth_•och
;

126 
	mÿÁ_çov”_»asÚ
;

129 
m¡ime_t
 
	mmf_’d
;

132 
şu¡”Node
 *
	mmf_¦ave
;

134 
	mmf_ma¡”_off£t
;

136 
	mmf_ÿn_¡¬t
;

139 
ušt64_t
 
	mÏ¡VÙeEpoch
;

140 
	mtodo_befÜe_¦“p
;

141 
	m¡©s_bus_mes§ges_£Á
;

142 
	m¡©s_bus_mes§ges_»ûived
;

143 } 
	tşu¡”S‹
;

146 
	#CLUSTER_TODO_HANDLE_FAILOVER
 (1<<0)

	)

147 
	#CLUSTER_TODO_UPDATE_STATE
 (1<<1)

	)

148 
	#CLUSTER_TODO_SAVE_CONFIG
 (1<<2)

	)

149 
	#CLUSTER_TODO_FSYNC_CONFIG
 (1<<3)

	)

157 
	#CLUSTERMSG_TYPE_PING
 0

	)

158 
	#CLUSTERMSG_TYPE_PONG
 1

	)

159 
	#CLUSTERMSG_TYPE_MEET
 2

	)

160 
	#CLUSTERMSG_TYPE_FAIL
 3

	)

161 
	#CLUSTERMSG_TYPE_PUBLISH
 4

	)

162 
	#CLUSTERMSG_TYPE_FAILOVER_AUTH_REQUEST
 5

	)

163 
	#CLUSTERMSG_TYPE_FAILOVER_AUTH_ACK
 6

	)

164 
	#CLUSTERMSG_TYPE_UPDATE
 7

	)

165 
	#CLUSTERMSG_TYPE_MFSTART
 8

	)

171 
	mnod’ame
[
CLUSTER_NAMELEN
];

172 
ušt32_t
 
	mpšg_£Á
;

173 
ušt32_t
 
	mpÚg_»ûived
;

174 
	m
[
NET_IP_STR_LEN
];

175 
ušt16_t
 
	mpÜt
;

176 
ušt16_t
 
	mıÜt
;

177 
ušt16_t
 
	mæags
;

178 
ušt32_t
 
	mnÙu£d1
;

179 } 
	tşu¡”MsgD©aGoss
;

182 
	mnod’ame
[
CLUSTER_NAMELEN
];

183 } 
	tşu¡”MsgD©aFa
;

186 
ušt32_t
 
	mchªÃl_Ën
;

187 
ušt32_t
 
	mmes§ge_Ën
;

191 
	mbulk_d©a
[8];

192 } 
	tşu¡”MsgD©aPublish
;

195 
ušt64_t
 
	mcÚfigEpoch
;

196 
	mnod’ame
[
CLUSTER_NAMELEN
];

197 
	m¦Ùs
[
CLUSTER_SLOTS
/8];

198 } 
	tşu¡”MsgD©aUpd©e
;

200 
	uşu¡”MsgD©a
 {

204 
şu¡”MsgD©aGoss
 
	mgoss
[1];

205 } 
	mpšg
;

209 
şu¡”MsgD©aFa
 
	mabout
;

210 } 
	mç
;

214 
şu¡”MsgD©aPublish
 
	mmsg
;

215 } 
	mpublish
;

219 
şu¡”MsgD©aUpd©e
 
	mnodecfg
;

220 } 
	mupd©e
;

223 
	#CLUSTER_PROTO_VER
 1

	)

226 
	msig
[4];

227 
ušt32_t
 
	mtÙËn
;

228 
ušt16_t
 
	mv”
;

229 
ušt16_t
 
	mpÜt
;

230 
ušt16_t
 
	mty³
;

231 
ušt16_t
 
	mcouÁ
;

232 
ušt64_t
 
	mcu¼’tEpoch
;

233 
ušt64_t
 
	mcÚfigEpoch
;

236 
ušt64_t
 
	moff£t
;

238 
	m£nd”
[
CLUSTER_NAMELEN
];

239 
	mmy¦Ùs
[
CLUSTER_SLOTS
/8];

240 
	m¦aveof
[
CLUSTER_NAMELEN
];

241 
	mmy
[
NET_IP_STR_LEN
];

242 
	mnÙu£d1
[34];

243 
ušt16_t
 
	mıÜt
;

244 
ušt16_t
 
	mæags
;

245 
	m¡©e
;

246 
	mmæags
[3];

247 
şu¡”MsgD©a
 
	md©a
;

248 } 
	tşu¡”Msg
;

250 
	#CLUSTERMSG_MIN_LEN
 ((
şu¡”Msg
)-(
şu¡”MsgD©a
))

	)

254 
	#CLUSTERMSG_FLAG0_PAUSED
 (1<<0è

	)

255 
	#CLUSTERMSG_FLAG0_FORCEACK
 (1<<1è

	)

259 
şu¡”Node
 *
g‘NodeByQu”y
(
ş›Á
 *
c
, 
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
hash¦Ù
, *
ask
);

260 
şu¡”RedœeùBlockedCl›ÁIfN“ded
(
ş›Á
 *
c
);

261 
şu¡”RedœeùCl›Á
(
ş›Á
 *
c
, 
şu¡”Node
 *
n
, 
hash¦Ù
, 
”rÜ_code
);

	@config.c

31 
	~"£rv”.h
"

32 
	~"şu¡”.h
"

34 
	~<fú.h
>

35 
	~<sys/¡©.h
>

41 
	scÚfigEnum
 {

42 cÚ¡ *
	mÇme
;

43 cÚ¡ 
	mv®
;

44 } 
	tcÚfigEnum
;

46 
cÚfigEnum
 
	gmaxmemÜy_pŞicy_’um
[] = {

47 {"vŞ©e-Ìu", 
MAXMEMORY_VOLATILE_LRU
},

48 {"vŞ©e-lfu", 
MAXMEMORY_VOLATILE_LFU
},

49 {"vŞ©e-¿ndom",
MAXMEMORY_VOLATILE_RANDOM
},

50 {"vŞ©e-‰l",
MAXMEMORY_VOLATILE_TTL
},

51 {"®lkeys-Ìu",
MAXMEMORY_ALLKEYS_LRU
},

52 {"®lkeys-lfu",
MAXMEMORY_ALLKEYS_LFU
},

53 {"®lkeys-¿ndom",
MAXMEMORY_ALLKEYS_RANDOM
},

54 {"nÛviùiÚ",
MAXMEMORY_NO_EVICTION
},

55 {
NULL
, 0}

58 
cÚfigEnum
 
	gsy¦og_çc™y_’um
[] = {

59 {"u£r", 
LOG_USER
},

60 {"loÿl0", 
LOG_LOCAL0
},

61 {"loÿl1", 
LOG_LOCAL1
},

62 {"loÿl2", 
LOG_LOCAL2
},

63 {"loÿl3", 
LOG_LOCAL3
},

64 {"loÿl4", 
LOG_LOCAL4
},

65 {"loÿl5", 
LOG_LOCAL5
},

66 {"loÿl6", 
LOG_LOCAL6
},

67 {"loÿl7", 
LOG_LOCAL7
},

68 {
NULL
, 0}

71 
cÚfigEnum
 
	glogËv–_’um
[] = {

72 {"debug", 
LL_DEBUG
},

73 {"v”bo£", 
LL_VERBOSE
},

74 {"nÙiû", 
LL_NOTICE
},

75 {"w¬nšg", 
LL_WARNING
},

76 {
NULL
,0}

79 
cÚfigEnum
 
	gsu³rvi£d_mode_’um
[] = {

80 {"up¡¬t", 
SUPERVISED_UPSTART
},

81 {"sy¡emd", 
SUPERVISED_SYSTEMD
},

82 {"auto", 
SUPERVISED_AUTODETECT
},

83 {"no", 
SUPERVISED_NONE
},

84 {
NULL
, 0}

87 
cÚfigEnum
 
	gaof_fsync_’um
[] = {

88 {"ev”y£c", 
AOF_FSYNC_EVERYSEC
},

89 {"®ways", 
AOF_FSYNC_ALWAYS
},

90 {"no", 
AOF_FSYNC_NO
},

91 {
NULL
, 0}

95 
ş›ÁBufãrLim™sCÚfig
 
	gş›ÁBufãrLim™sDeçuÉs
[
CLIENT_TYPE_OBUF_COUNT
] = {

106 
	$cÚfigEnumG‘V®ue
(
cÚfigEnum
 *
û
, *
Çme
) {

107 
û
->
Çme
 !ğ
NULL
) {

108 ià(!
	`¡rÿ£cmp
(
û
->
Çme
,Çme)è ce->
v®
;

109 
û
++;

111  
INT_MIN
;

112 
	}
}

115 cÚ¡ *
	$cÚfigEnumG‘Name
(
cÚfigEnum
 *
û
, 
v®
) {

116 
û
->
Çme
 !ğ
NULL
) {

117 ià(
û
->
v®
 =ğv®è ce->
Çme
;

118 
û
++;

120  
NULL
;

121 
	}
}

125 cÚ¡ *
	$cÚfigEnumG‘NameOrUnknown
(
cÚfigEnum
 *
û
, 
v®
) {

126 cÚ¡ *
Çme
 = 
	`cÚfigEnumG‘Name
(
û
,
v®
);

127  
Çme
 ?‚ame : "unknown";

128 
	}
}

131 cÚ¡ *
	$eviùPŞicyToSŒšg
() {

132  
	`cÚfigEnumG‘NameOrUnknown
(
maxmemÜy_pŞicy_’um
,
£rv”
.
maxmemÜy_pŞicy
);

133 
	}
}

139 
	$ye¢Ùoi
(*
s
) {

140 ià(!
	`¡rÿ£cmp
(
s
,"yes"))  1;

141 ià(!
	`¡rÿ£cmp
(
s
,"no"))  0;

143 
	}
}

145 
	$­³ndS”v”SaveP¬ams
(
time_t
 
£cÚds
, 
chªges
) {

146 
£rv”
.
§v•¬ams
 = 
	`z»®loc
(£rv”.§v•¬ams,(
§v•¬am
)*(£rv”.
§v•¬am¦’
+1));

147 
£rv”
.
§v•¬ams
[£rv”.
§v•¬am¦’
].
£cÚds
 = seconds;

148 
£rv”
.
§v•¬ams
[£rv”.
§v•¬am¦’
].
chªges
 = changes;

149 
£rv”
.
§v•¬am¦’
++;

150 
	}
}

152 
	$»£tS”v”SaveP¬ams
() {

153 
	`zä“
(
£rv”
.
§v•¬ams
);

154 
£rv”
.
§v•¬ams
 = 
NULL
;

155 
£rv”
.
§v•¬am¦’
 = 0;

156 
	}
}

158 
	$queueLßdModuË
(
sds
 
·th
, sd *
¬gv
, 
¬gc
) {

159 
i
;

160 
moduËLßdQueueEÁry
 *
lßdmod
;

162 
lßdmod
 = 
	`zm®loc
((
moduËLßdQueueEÁry
));

163 
lßdmod
->
¬gv
 = 
	`zm®loc
((
robj
*)*
¬gc
);

164 
lßdmod
->
·th
 = 
	`sd¢ew
(path);

165 
lßdmod
->
¬gc
 =‡rgc;

166 
i
 = 0; i < 
¬gc
; i++) {

167 
lßdmod
->
¬gv
[
i
] = 
	`ü—‹RawSŒšgObjeù
×rgv[i],
	`sd¦’
(argv[i]));

169 
	`li¡AddNodeTa
(
£rv”
.
lßdmoduË_queue
,
lßdmod
);

170 
	}
}

172 
	$lßdS”v”CÚfigFromSŒšg
(*
cÚfig
) {

173 *
”r
 = 
NULL
;

174 
lš’um
 = 0, 
tÙlšes
, 
i
;

175 
¦aveof_lš’um
 = 0;

176 
sds
 *
lšes
;

178 
lšes
 = 
	`sds¥l™Ën
(
cÚfig
,
	`¡¾’
(cÚfig),"\n",1,&
tÙlšes
);

180 
i
 = 0; i < 
tÙlšes
; i++) {

181 
sds
 *
¬gv
;

182 
¬gc
;

184 
lš’um
 = 
i
+1;

185 
lšes
[
i
] = 
	`sd¡rim
(lines[i]," \t\r\n");

188 ià(
lšes
[
i
][0] == '#' ||†ines[i][0] == '\0') ;

191 
¬gv
 = 
	`sds¥l™¬gs
(
lšes
[
i
],&
¬gc
);

192 ià(
¬gv
 =ğ
NULL
) {

193 
”r
 = "Unbalanced quotes in configuration†ine";

194 
lßd”r
;

198 ià(
¬gc
 == 0) {

199 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

202 
	`sd¡Şow”
(
¬gv
[0]);

205 ià(!
	`¡rÿ£cmp
(
¬gv
[0],"timeout"è&& 
¬gc
 == 2) {

206 
£rv”
.
maxidËtime
 = 
	`©oi
(
¬gv
[1]);

207 ià(
£rv”
.
maxidËtime
 < 0) {

208 
”r
 = "Inv®idimeouˆv®ue"; 
lßd”r
;

210 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"tı-k“·live"è&& 
¬gc
 == 2) {

211 
£rv”
.
tık“·live
 = 
	`©oi
(
¬gv
[1]);

212 ià(
£rv”
.
tık“·live
 < 0) {

213 
”r
 = "Inv®idı-k“·livv®ue"; 
lßd”r
;

215 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"´Ùeùed-mode"è&& 
¬gc
 == 2) {

216 ià((
£rv”
.
´Ùeùed_mode
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

217 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

219 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"pÜt"è&& 
¬gc
 == 2) {

220 
£rv”
.
pÜt
 = 
	`©oi
(
¬gv
[1]);

221 ià(
£rv”
.
pÜt
 < 0 || server.port > 65535) {

222 
”r
 = "Inv®id…Üt"; 
lßd”r
;

224 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"tı-backlog"è&& 
¬gc
 == 2) {

225 
£rv”
.
tı_backlog
 = 
	`©oi
(
¬gv
[1]);

226 ià(
£rv”
.
tı_backlog
 < 0) {

227 
”r
 = "Inv®id backlog v®ue"; 
lßd”r
;

229 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"bšd"è&& 
¬gc
 >= 2) {

230 
j
, 
add»s£s
 = 
¬gc
-1;

232 ià(
add»s£s
 > 
CONFIG_BINDADDR_MAX
) {

233 
”r
 = "ToØmªy bšd‡dd»s£ ¥ecif›d"; 
lßd”r
;

235 
j
 = 0; j < 
add»s£s
; j++)

236 
£rv”
.
bšdaddr
[
j
] = 
	`z¡rdup
(
¬gv
[j+1]);

237 
£rv”
.
bšdaddr_couÁ
 = 
add»s£s
;

238 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"unixsock‘"è&& 
¬gc
 == 2) {

239 
£rv”
.
unixsock‘
 = 
	`z¡rdup
(
¬gv
[1]);

240 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"unixsock‘³rm"è&& 
¬gc
 == 2) {

241 
”ºo
 = 0;

242 
£rv”
.
unixsock‘³rm
 = (
mode_t
)
	`¡¹Ş
(
¬gv
[1], 
NULL
, 8);

243 ià(
”ºo
 || 
£rv”
.
unixsock‘³rm
 > 0777) {

244 
”r
 = "Inv®id sock‘ f³rmissiÚs"; 
lßd”r
;

246 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"save")) {

247 ià(
¬gc
 == 3) {

248 
£cÚds
 = 
	`©oi
(
¬gv
[1]);

249 
chªges
 = 
	`©oi
(
¬gv
[2]);

250 ià(
£cÚds
 < 1 || 
chªges
 < 0) {

251 
”r
 = "Inv®id sav·¿m‘”s"; 
lßd”r
;

253 
	`­³ndS”v”SaveP¬ams
(
£cÚds
,
chªges
);

254 } ià(
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(
¬gv
[1],"")) {

255 
	`»£tS”v”SaveP¬ams
();

257 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"dœ"è&& 
¬gc
 == 2) {

258 ià(
	`chdœ
(
¬gv
[1]) == -1) {

259 
	`£rv”Log
(
LL_WARNING
,"Can't chdiro '%s': %s",

260 
¬gv
[1], 
	`¡»¼Ü
(
”ºo
));

261 
	`ex™
(1);

263 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"logËv–"è&& 
¬gc
 == 2) {

264 
£rv”
.
v”bos™y
 = 
	`cÚfigEnumG‘V®ue
(
logËv–_’um
,
¬gv
[1]);

265 ià(
£rv”
.
v”bos™y
 =ğ
INT_MIN
) {

266 
”r
 = "Invalid†og†evel. "

268 
lßd”r
;

270 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"logfe"è&& 
¬gc
 == 2) {

271 
FILE
 *
logå
;

273 
	`zä“
(
£rv”
.
logfe
);

274 
£rv”
.
logfe
 = 
	`z¡rdup
(
¬gv
[1]);

275 ià(
£rv”
.
logfe
[0] != '\0') {

278 
logå
 = 
	`fİ’
(
£rv”
.
logfe
,"a");

279 ià(
logå
 =ğ
NULL
) {

280 
”r
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

281 "Cª'ˆİ’hlog fe: %s", 
	`¡»¼Ü
(
”ºo
));

282 
lßd”r
;

284 
	`fşo£
(
logå
);

286 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"sy¦og-’abËd"è&& 
¬gc
 == 2) {

287 ià((
£rv”
.
sy¦og_’abËd
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

288 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

290 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"sy¦og-id’t"è&& 
¬gc
 == 2) {

291 ià(
£rv”
.
sy¦og_id’t
è
	`zä“
(server.syslog_ident);

292 
£rv”
.
sy¦og_id’t
 = 
	`z¡rdup
(
¬gv
[1]);

293 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"sy¦og-çc™y"è&& 
¬gc
 == 2) {

294 
£rv”
.
sy¦og_çc™y
 =

295 
	`cÚfigEnumG‘V®ue
(
sy¦og_çc™y_’um
,
¬gv
[1]);

296 ià(
£rv”
.
sy¦og_çc™y
 =ğ
INT_MIN
) {

297 
”r
 = "Invalid†og facility. Must be one of USER or between LOCAL0-LOCAL7";

298 
lßd”r
;

300 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"d©aba£s"è&& 
¬gc
 == 2) {

301 
£rv”
.
dbnum
 = 
	`©oi
(
¬gv
[1]);

302 ià(
£rv”
.
dbnum
 < 1) {

303 
”r
 = "Inv®id‚umb” oàd©aba£s"; 
lßd”r
;

305 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"šşude"è&& 
¬gc
 == 2) {

306 
	`lßdS”v”CÚfig
(
¬gv
[1],
NULL
);

307 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"maxş›Ás"è&& 
¬gc
 == 2) {

308 
£rv”
.
maxş›Ás
 = 
	`©oi
(
¬gv
[1]);

309 ià(
£rv”
.
maxş›Ás
 < 1) {

310 
”r
 = "Inv®id max cl›Á lim™"; 
lßd”r
;

312 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"maxmemÜy"è&& 
¬gc
 == 2) {

313 
£rv”
.
maxmemÜy
 = 
	`memtŞl
(
¬gv
[1],
NULL
);

314 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"maxmemÜy-pŞicy"è&& 
¬gc
 == 2) {

315 
£rv”
.
maxmemÜy_pŞicy
 =

316 
	`cÚfigEnumG‘V®ue
(
maxmemÜy_pŞicy_’um
,
¬gv
[1]);

317 ià(
£rv”
.
maxmemÜy_pŞicy
 =ğ
INT_MIN
) {

318 
”r
 = "Invalid maxmemory…olicy";

319 
lßd”r
;

321 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"maxmemÜy-§m¶es"è&& 
¬gc
 == 2) {

322 
£rv”
.
maxmemÜy_§m¶es
 = 
	`©oi
(
¬gv
[1]);

323 ià(
£rv”
.
maxmemÜy_§m¶es
 <= 0) {

324 
”r
 = "maxmemory-samples must be 1 or greater";

325 
lßd”r
;

327 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"lfu-log-çùÜ"è&& 
¬gc
 == 2) {

328 
£rv”
.
lfu_log_çùÜ
 = 
	`©oi
(
¬gv
[1]);

329 ià(
£rv”
.
maxmemÜy_§m¶es
 < 0) {

330 
”r
 = "lfu-log-factor must be 0 or greater";

331 
lßd”r
;

333 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"lfu-deÿy-time"è&& 
¬gc
 == 2) {

334 
£rv”
.
lfu_deÿy_time
 = 
	`©oi
(
¬gv
[1]);

335 ià(
£rv”
.
maxmemÜy_§m¶es
 < 1) {

336 
”r
 = "lfu-decay-time must be 0 or greater";

337 
lßd”r
;

339 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦aveof"è&& 
¬gc
 == 3) {

340 
¦aveof_lš’um
 = 
lš’um
;

341 
£rv”
.
ma¡”ho¡
 = 
	`sd¢ew
(
¬gv
[1]);

342 
£rv”
.
ma¡”pÜt
 = 
	`©oi
(
¬gv
[2]);

343 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

344 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-pšg-¦ave-³riod"è&& 
¬gc
 == 2) {

345 
£rv”
.
»¶_pšg_¦ave_³riod
 = 
	`©oi
(
¬gv
[1]);

346 ià(
£rv”
.
»¶_pšg_¦ave_³riod
 <= 0) {

347 
”r
 = "repl-ping-slave-period must be 1 or greater";

348 
lßd”r
;

350 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-timeout"è&& 
¬gc
 == 2) {

351 
£rv”
.
»¶_timeout
 = 
	`©oi
(
¬gv
[1]);

352 ià(
£rv”
.
»¶_timeout
 <= 0) {

353 
”r
 = "repl-timeout must be 1 or greater";

354 
lßd”r
;

356 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-di§bË-tı-nod–ay"è&& 
¬gc
==2) {

357 ià((
£rv”
.
»¶_di§bË_tı_nod–ay
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

358 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

360 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-diskËss-sync"è&& 
¬gc
==2) {

361 ià((
£rv”
.
»¶_diskËss_sync
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

362 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

364 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-diskËss-sync-d–ay"è&& 
¬gc
==2) {

365 
£rv”
.
»¶_diskËss_sync_d–ay
 = 
	`©oi
(
¬gv
[1]);

366 ià(
£rv”
.
»¶_diskËss_sync_d–ay
 < 0) {

367 
”r
 = "repl-diskless-sync-delay can't be‚egative";

368 
lßd”r
;

370 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-backlog-size"è&& 
¬gc
 == 2) {

371 
size
 = 
	`memtŞl
(
¬gv
[1],
NULL
);

372 ià(
size
 <= 0) {

373 
”r
 = "repl-backlog-size must be 1 or greater.";

374 
lßd”r
;

376 
	`»sizeR•liÿtiÚBacklog
(
size
);

377 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»¶-backlog-‰l"è&& 
¬gc
 == 2) {

378 
£rv”
.
»¶_backlog_time_lim™
 = 
	`©oi
(
¬gv
[1]);

379 ià(
£rv”
.
»¶_backlog_time_lim™
 < 0) {

380 
”r
 = "repl-backlog-ttl can't be‚egative ";

381 
lßd”r
;

383 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"ma¡”auth"è&& 
¬gc
 == 2) {

384 
	`zä“
(
£rv”
.
ma¡”auth
);

385 
£rv”
.
ma¡”auth
 = 
	`z¡rdup
(
¬gv
[1]);

386 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-£rve-¡®e-d©a"è&& 
¬gc
 == 2) {

387 ià((
£rv”
.
»¶_£rve_¡®e_d©a
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

388 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

390 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-»ad-Úly"è&& 
¬gc
 == 2) {

391 ià((
£rv”
.
»¶_¦ave_ro
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

392 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

394 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"rdbcom´essiÚ"è&& 
¬gc
 == 2) {

395 ià((
£rv”
.
rdb_com´essiÚ
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

396 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

398 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"rdbchecksum"è&& 
¬gc
 == 2) {

399 ià((
£rv”
.
rdb_checksum
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

400 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

402 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"aùiv”ehashšg"è&& 
¬gc
 == 2) {

403 ià((
£rv”
.
aùiv”ehashšg
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

404 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

406 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"Ïzyä“-Ïzy-eviùiÚ"è&& 
¬gc
 == 2) {

407 ià((
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

408 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

410 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"Ïzyä“-Ïzy-expœe"è&& 
¬gc
 == 2) {

411 ià((
£rv”
.
Ïzyä“_Ïzy_expœe
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

412 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

414 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"Ïzyä“-Ïzy-£rv”-d–"è&& 
¬gc
 == 2){

415 ià((
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

416 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

418 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-Ïzy-æush"è&& 
¬gc
 == 2) {

419 ià((
£rv”
.
»¶_¦ave_Ïzy_æush
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

420 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

422 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"d«mÚize"è&& 
¬gc
 == 2) {

423 ià((
£rv”
.
d«mÚize
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

424 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

426 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"hz"è&& 
¬gc
 == 2) {

427 
£rv”
.
hz
 = 
	`©oi
(
¬gv
[1]);

428 ià(
£rv”
.
hz
 < 
CONFIG_MIN_HZ
) server.hz = CONFIG_MIN_HZ;

429 ià(
£rv”
.
hz
 > 
CONFIG_MAX_HZ
) server.hz = CONFIG_MAX_HZ;

430 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"­³ndÚly"è&& 
¬gc
 == 2) {

431 
yes
;

433 ià((
yes
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

434 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

436 
£rv”
.
aof_¡©e
 = 
yes
 ? 
AOF_ON
 : 
AOF_OFF
;

437 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"­³ndf’ame"è&& 
¬gc
 == 2) {

438 ià(!
	`·thIsBa£Name
(
¬gv
[1])) {

439 
”r
 = "appendfilename can't be‡…ath, just‡ filename";

440 
lßd”r
;

442 
	`zä“
(
£rv”
.
aof_f’ame
);

443 
£rv”
.
aof_f’ame
 = 
	`z¡rdup
(
¬gv
[1]);

444 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"no-appendfsync-on-rewrite")

445 && 
¬gc
 == 2) {

446 ià((
£rv”
.
aof_no_fsync_Ú_»wr™e
ğ
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

447 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

449 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"­³ndfsync"è&& 
¬gc
 == 2) {

450 
£rv”
.
aof_fsync
 = 
	`cÚfigEnumG‘V®ue
(
aof_fsync_’um
,
¬gv
[1]);

451 ià(
£rv”
.
aof_fsync
 =ğ
INT_MIN
) {

452 
”r
 = "argument must be 'no', 'always' or 'everysec'";

453 
lßd”r
;

455 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"auto-aof-rewrite-percentage") &&

456 
¬gc
 == 2)

458 
£rv”
.
aof_»wr™e_³rc
 = 
	`©oi
(
¬gv
[1]);

459 ià(
£rv”
.
aof_»wr™e_³rc
 < 0) {

460 
”r
 = "Invalid‚egative…ercentage for AOF‡uto„ewrite";

461 
lßd”r
;

463 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"auto-aof-rewrite-min-size") &&

464 
¬gc
 == 2)

466 
£rv”
.
aof_»wr™e_mš_size
 = 
	`memtŞl
(
¬gv
[1],
NULL
);

467 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"aof-rewrite-incremental-fsync") &&

468 
¬gc
 == 2)

470 ià((
£rv”
.
aof_»wr™e_šüem’l_fsync
 =

471 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

472 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

474 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"aof-lßd-Œunÿ‹d"è&& 
¬gc
 == 2) {

475 ià((
£rv”
.
aof_lßd_Œunÿ‹d
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

476 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

478 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"aof-u£-rdb-´—mbË"è&& 
¬gc
 == 2) {

479 ià((
£rv”
.
aof_u£_rdb_´—mbË
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

480 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

482 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»quœ•ass"è&& 
¬gc
 == 2) {

483 ià(
	`¡¾’
(
¬gv
[1]è> 
CONFIG_AUTHPASS_MAX_LEN
) {

484 
”r
 = "Password is†ongerhan CONFIG_AUTHPASS_MAX_LEN";

485 
lßd”r
;

487 
£rv”
.
»quœ•ass
 = 
	`z¡rdup
(
¬gv
[1]);

488 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"pidfe"è&& 
¬gc
 == 2) {

489 
	`zä“
(
£rv”
.
pidfe
);

490 
£rv”
.
pidfe
 = 
	`z¡rdup
(
¬gv
[1]);

491 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"dbf’ame"è&& 
¬gc
 == 2) {

492 ià(!
	`·thIsBa£Name
(
¬gv
[1])) {

493 
”r
 = "dbfilename can't be‡…ath, just‡ filename";

494 
lßd”r
;

496 
	`zä“
(
£rv”
.
rdb_f’ame
);

497 
£rv”
.
rdb_f’ame
 = 
	`z¡rdup
(
¬gv
[1]);

498 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"hash-max-zli¡-’Œ›s"è&& 
¬gc
 == 2) {

499 
£rv”
.
hash_max_zli¡_’Œ›s
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

500 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"hash-max-zli¡-v®ue"è&& 
¬gc
 == 2) {

501 
£rv”
.
hash_max_zli¡_v®ue
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

502 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"li¡-max-zli¡-’Œ›s"è&& 
¬gc
 == 2){

504 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"li¡-max-zli¡-v®ue"è&& 
¬gc
 == 2) {

506 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"li¡-max-zli¡-size"è&& 
¬gc
 == 2) {

507 
£rv”
.
li¡_max_zli¡_size
 = 
	`©oi
(
¬gv
[1]);

508 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"li¡-com´ess-d•th"è&& 
¬gc
 == 2) {

509 
£rv”
.
li¡_com´ess_d•th
 = 
	`©oi
(
¬gv
[1]);

510 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"£t-max-št£t-’Œ›s"è&& 
¬gc
 == 2) {

511 
£rv”
.
£t_max_št£t_’Œ›s
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

512 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"z£t-max-zli¡-’Œ›s"è&& 
¬gc
 == 2) {

513 
£rv”
.
z£t_max_zli¡_’Œ›s
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

514 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"z£t-max-zli¡-v®ue"è&& 
¬gc
 == 2) {

515 
£rv”
.
z£t_max_zli¡_v®ue
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

516 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"hÎ-¥¬£-max-by‹s"è&& 
¬gc
 == 2) {

517 
£rv”
.
hÎ_¥¬£_max_by‹s
 = 
	`memtŞl
(
¬gv
[1], 
NULL
);

518 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"»Çme-commªd"è&& 
¬gc
 == 3) {

519 
»disCommªd
 *
cmd
 = 
	`lookupCommªd
(
¬gv
[1]);

520 
»tv®
;

522 ià(!
cmd
) {

523 
”r
 = "No such command in„ename-command";

524 
lßd”r
;

529 
»tv®
 = 
	`diùD–‘e
(
£rv”
.
commªds
, 
¬gv
[1]);

530 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

533 ià(
	`sd¦’
(
¬gv
[2]) != 0) {

534 
sds
 
cİy
 = 
	`sdsdup
(
¬gv
[2]);

536 
»tv®
 = 
	`diùAdd
(
£rv”
.
commªds
, 
cİy
, 
cmd
);

537 ià(
»tv®
 !ğ
DICT_OK
) {

538 
	`sdsä“
(
cİy
);

539 
”r
 = "T¬g‘ commªd‚am®»adyƒxi¡s"; 
lßd”r
;

542 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"şu¡”-’abËd"è&& 
¬gc
 == 2) {

543 ià((
£rv”
.
şu¡”_’abËd
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

544 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

546 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"şu¡”-cÚfig-fe"è&& 
¬gc
 == 2) {

547 
	`zä“
(
£rv”
.
şu¡”_cÚfigfe
);

548 
£rv”
.
şu¡”_cÚfigfe
 = 
	`z¡rdup
(
¬gv
[1]);

549 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"şu¡”-ªnounû-"è&& 
¬gc
 == 2) {

550 
	`zä“
(
£rv”
.
şu¡”_ªnounû_
);

551 
£rv”
.
şu¡”_ªnounû_
 = 
	`z¡rdup
(
¬gv
[1]);

552 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"şu¡”-ªnounû-pÜt"è&& 
¬gc
 == 2) {

553 
£rv”
.
şu¡”_ªnounû_pÜt
 = 
	`©oi
(
¬gv
[1]);

554 ià(
£rv”
.
şu¡”_ªnounû_pÜt
 < 0 ||

555 
£rv”
.
şu¡”_ªnounû_pÜt
 > 65535)

557 
”r
 = "Inv®id…Üt"; 
lßd”r
;

559 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cluster-announce-bus-port") &&

560 
¬gc
 == 2)

562 
£rv”
.
şu¡”_ªnounû_bus_pÜt
 = 
	`©oi
(
¬gv
[1]);

563 ià(
£rv”
.
şu¡”_ªnounû_bus_pÜt
 < 0 ||

564 
£rv”
.
şu¡”_ªnounû_bus_pÜt
 > 65535)

566 
”r
 = "Inv®id…Üt"; 
lßd”r
;

568 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cluster-require-full-coverage") &&

569 
¬gc
 == 2)

571 ià((
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1)

573 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

575 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"şu¡”-node-timeout"è&& 
¬gc
 == 2) {

576 
£rv”
.
şu¡”_node_timeout
 = 
	`¡¹Şl
(
¬gv
[1],
NULL
,10);

577 ià(
£rv”
.
şu¡”_node_timeout
 <= 0) {

578 
”r
 = "şu¡”‚odtimeouˆmu¡ b1 o¸g»©”"; 
lßd”r
;

580 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cluster-migration-barrier")

581 && 
¬gc
 == 2)

583 
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
 = 
	`©oi
(
¬gv
[1]);

584 ià(
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
 < 0) {

585 
”r
 = "cluster migration barrier must zero or…ositive";

586 
lßd”r
;

588 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cluster-slave-validity-factor")

589 && 
¬gc
 == 2)

591 
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
 = 
	`©oi
(
¬gv
[1]);

592 ià(
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
 < 0) {

593 
”r
 = "cluster slave validity factor must be zero or…ositive";

594 
lßd”r
;

596 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"lua-time-lim™"è&& 
¬gc
 == 2) {

597 
£rv”
.
lua_time_lim™
 = 
	`¡¹Şl
(
¬gv
[1],
NULL
,10);

598 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"slowlog-log-slower-than") &&

599 
¬gc
 == 2)

601 
£rv”
.
¦owlog_log_¦ow”_thª
 = 
	`¡¹Şl
(
¬gv
[1],
NULL
,10);

602 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"latency-monitor-threshold") &&

603 
¬gc
 == 2)

605 
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
 = 
	`¡¹Şl
(
¬gv
[1],
NULL
,10);

606 ià(
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
 < 0) {

607 
”r
 = "The†atencyhreshold can't be‚egative";

608 
lßd”r
;

610 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦owlog-max-Ën"è&& 
¬gc
 == 2) {

611 
£rv”
.
¦owlog_max_Ën
 = 
	`¡¹Şl
(
¬gv
[1],
NULL
,10);

612 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"client-output-buffer-limit") &&

613 
¬gc
 == 5)

615 
şass
 = 
	`g‘Cl›ÁTy³ByName
(
¬gv
[1]);

616 
h¬d
, 
soá
;

617 
soá_£cÚds
;

619 ià(
şass
 =ğ-1 || cÏs =ğ
CLIENT_TYPE_MASTER
) {

620 
”r
 = "Unrecognized client†imit class:he user specified "

622 
lßd”r
;

624 
h¬d
 = 
	`memtŞl
(
¬gv
[2],
NULL
);

625 
soá
 = 
	`memtŞl
(
¬gv
[3],
NULL
);

626 
soá_£cÚds
 = 
	`©oi
(
¬gv
[4]);

627 ià(
soá_£cÚds
 < 0) {

628 
”r
 = "Negative‚umber of seconds in soft†imit is invalid";

629 
lßd”r
;

631 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
h¬d_lim™_by‹s
 = 
h¬d
;

632 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_by‹s
 = 
soá
;

633 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_£cÚds
 = 
soá_£cÚds
;

634 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"stop-writes-on-bgsave-error") &&

635 
¬gc
 == 2) {

636 ià((
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
 = 
	`ye¢Ùoi
(
¬gv
[1])) == -1) {

637 
”r
 = "¬gum’ˆmu¡ b'yes' o¸'no'"; 
lßd”r
;

639 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-´iÜ™y"è&& 
¬gc
 == 2) {

640 
£rv”
.
¦ave_´iÜ™y
 = 
	`©oi
(
¬gv
[1]);

641 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-ªnounû-"è&& 
¬gc
 == 2) {

642 
	`zä“
(
£rv”
.
¦ave_ªnounû_
);

643 
£rv”
.
¦ave_ªnounû_
 = 
	`z¡rdup
(
¬gv
[1]);

644 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"¦ave-ªnounû-pÜt"è&& 
¬gc
 == 2) {

645 
£rv”
.
¦ave_ªnounû_pÜt
 = 
	`©oi
(
¬gv
[1]);

646 ià(
£rv”
.
¦ave_ªnounû_pÜt
 < 0 ||

647 
£rv”
.
¦ave_ªnounû_pÜt
 > 65535)

649 
”r
 = "Inv®id…Üt"; 
lßd”r
;

651 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"mš-¦aves-to-wr™e"è&& 
¬gc
 == 2) {

652 
£rv”
.
»¶_mš_¦aves_to_wr™e
 = 
	`©oi
(
¬gv
[1]);

653 ià(
£rv”
.
»¶_mš_¦aves_to_wr™e
 < 0) {

654 
”r
 = "Inv®id v®ufÜ mš-¦aves-to-wr™e."; 
lßd”r
;

656 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"mš-¦aves-max-Ïg"è&& 
¬gc
 == 2) {

657 
£rv”
.
»¶_mš_¦aves_max_Ïg
 = 
	`©oi
(
¬gv
[1]);

658 ià(
£rv”
.
»¶_mš_¦aves_max_Ïg
 < 0) {

659 
”r
 = "Inv®id v®ufÜ mš-¦aves-max-Ïg."; 
lßd”r
;

661 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"nÙify-key¥aû-ev’ts"è&& 
¬gc
 == 2) {

662 
æags
 = 
	`key¥aûEv’tsSŒšgToFÏgs
(
¬gv
[1]);

664 ià(
æags
 == -1) {

665 
”r
 = "Invalidƒvent class character. Use 'g$lshzxeA'.";

666 
lßd”r
;

668 
£rv”
.
nÙify_key¥aû_ev’ts
 = 
æags
;

669 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"su³rvi£d"è&& 
¬gc
 == 2) {

670 
£rv”
.
su³rvi£d_mode
 =

671 
	`cÚfigEnumG‘V®ue
(
su³rvi£d_mode_’um
,
¬gv
[1]);

673 ià(
£rv”
.
su³rvi£d_mode
 =ğ
INT_MIN
) {

674 
”r
 = "Invalid option for 'supervised'. "

676 
lßd”r
;

678 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"lßdmoduË"è&& 
¬gc
 >= 2) {

679 
	`queueLßdModuË
(
¬gv
[1],&¬gv[2],
¬gc
-2);

680 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"sentinel")) {

683 ià(
¬gc
 != 1) {

684 ià(!
£rv”
.
£Áš–_mode
) {

685 
”r
 = "sentinel directive while‚ot in sentinel mode";

686 
lßd”r
;

688 
”r
 = 
	`£Áš–HªdËCÚfigu¿tiÚ
(
¬gv
+1,
¬gc
-1);

689 ià(
”r
è
lßd”r
;

692 
”r
 = "Bad dœeùivÜ wrÚg‚umb” oà¬gum’ts"; 
lßd”r
;

694 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

698 ià(
£rv”
.
şu¡”_’abËd
 && s”v”.
ma¡”ho¡
) {

699 
lš’um
 = 
¦aveof_lš’um
;

700 
i
 = 
lš’um
-1;

701 
”r
 = "slaveof directive‚ot‡llowed in cluster mode";

702 
lßd”r
;

705 
	`sdsä“¥l™»s
(
lšes
,
tÙlšes
);

708 
lßd”r
:

709 
	`årštf
(
¡d”r
, "\n*** FATAL CONFIG FILE ERROR ***\n");

710 
	`årštf
(
¡d”r
, "R—dšghcÚfigu¿tiÚ fe,‡ˆlš%d\n", 
lš’um
);

711 
	`årštf
(
¡d”r
, ">>> '%s'\n", 
lšes
[
i
]);

712 
	`årštf
(
¡d”r
, "%s\n", 
”r
);

713 
	`ex™
(1);

714 
	}
}

723 
	$lßdS”v”CÚfig
(*
f’ame
, *
İtiÚs
) {

724 
sds
 
cÚfig
 = 
	`sd£m±y
();

725 
buf
[
CONFIG_MAX_LINE
+1];

728 ià(
f’ame
) {

729 
FILE
 *
å
;

731 ià(
f’ame
[0] == '-' && filename[1] == '\0') {

732 
å
 = 
¡dš
;

734 ià((
å
 = 
	`fİ’
(
f’ame
,"r")è=ğ
NULL
) {

735 
	`£rv”Log
(
LL_WARNING
,

736 "F©®ƒ¼Ü, cª'ˆİ’ cÚfig f'%s'", 
f’ame
);

737 
	`ex™
(1);

740 
	`fg‘s
(
buf
,
CONFIG_MAX_LINE
+1,
å
è!ğ
NULL
)

741 
cÚfig
 = 
	`sdsÿt
(cÚfig,
buf
);

742 ià(
å
 !ğ
¡dš
è
	`fşo£
(fp);

745 ià(
İtiÚs
) {

746 
cÚfig
 = 
	`sdsÿt
(config,"\n");

747 
cÚfig
 = 
	`sdsÿt
(cÚfig,
İtiÚs
);

749 
	`lßdS”v”CÚfigFromSŒšg
(
cÚfig
);

750 
	`sdsä“
(
cÚfig
);

751 
	}
}

757 
	#cÚfig_£t_boŞ_f›ld
(
_Çme
,
_v¬
) \

758 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,
_Çme
)) { \

759 
yn
 = 
	`ye¢Ùoi
(
o
->
±r
); \

760 ià(
yn
 =ğ-1è
badfmt
; \

761 
_v¬
 = 
yn
;

	)

763 
	#cÚfig_£t_num”iÿl_f›ld
(
_Çme
,
_v¬
,
mš
,
max
) \

764 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,
_Çme
)) { \

765 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
è
badfmt
; \

766 ià(
mš
 !ğ
LLONG_MIN
 && 
Î
 < mšè
badfmt
; \

767 ià(
max
 !ğ
LLONG_MAX
 && 
Î
 > maxè
badfmt
; \

768 
_v¬
 = 
Î
;

	)

770 
	#cÚfig_£t_memÜy_f›ld
(
_Çme
,
_v¬
) \

771 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,
_Çme
)) { \

772 
Î
 = 
	`memtŞl
(
o
->
±r
,&
”r
); \

773 ià(
”r
 || 
Î
 < 0è
badfmt
; \

774 
_v¬
 = 
Î
;

	)

776 
	#cÚfig_£t_’um_f›ld
(
_Çme
,
_v¬
,
_’umv¬
) \

777 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,
_Çme
)) { \

778 
’umv®
 = 
	`cÚfigEnumG‘V®ue
(
_’umv¬
,
o
->
±r
); \

779 ià(
’umv®
 =ğ
INT_MIN
è
badfmt
; \

780 
_v¬
 = 
’umv®
;

	)

782 
	#cÚfig_£t_¥ecŸl_f›ld
(
_Çme
) \

783 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,
_Çme
)è{

	)

785 
	#cÚfig_£t_–£
 } 

	)

787 
	$cÚfigS‘Commªd
(
ş›Á
 *
c
) {

788 
robj
 *
o
;

789 
Î
;

790 
”r
;

791 
	`£rv”As£¹W™hInfo
(
c
,c->
¬gv
[2],
	`sdsEncodedObjeù
(c->argv[2]));

792 
	`£rv”As£¹W™hInfo
(
c
,c->
¬gv
[3],
	`sdsEncodedObjeù
(c->argv[3]));

793 
o
 = 
c
->
¬gv
[3];

798 
	`cÚfig_£t_¥ecŸl_f›ld
("dbfilename") {

799 ià(!
	`·thIsBa£Name
(
o
->
±r
)) {

800 
	`addR•lyE¼Ü
(
c
, "dbfilename can't be‡…ath, just‡ filename");

803 
	`zä“
(
£rv”
.
rdb_f’ame
);

804 
£rv”
.
rdb_f’ame
 = 
	`z¡rdup
(
o
->
±r
);

805 } 
	`cÚfig_£t_¥ecŸl_f›ld
("requirepass") {

806 ià(
	`sd¦’
(
o
->
±r
è> 
CONFIG_AUTHPASS_MAX_LEN
è
badfmt
;

807 
	`zä“
(
£rv”
.
»quœ•ass
);

808 
£rv”
.
»quœ•ass
 = ((*)
o
->
±r
)[0] ? 
	`z¡rdup
(o->±rè: 
NULL
;

809 } 
	`cÚfig_£t_¥ecŸl_f›ld
("masterauth") {

810 
	`zä“
(
£rv”
.
ma¡”auth
);

811 
£rv”
.
ma¡”auth
 = ((*)
o
->
±r
)[0] ? 
	`z¡rdup
(o->±rè: 
NULL
;

812 } 
	`cÚfig_£t_¥ecŸl_f›ld
("cluster-announce-ip") {

813 
	`zä“
(
£rv”
.
şu¡”_ªnounû_
);

814 
£rv”
.
şu¡”_ªnounû_
 = ((*)
o
->
±r
)[0] ? 
	`z¡rdup
(o->±rè: 
NULL
;

815 } 
	`cÚfig_£t_¥ecŸl_f›ld
("maxclients") {

816 
Üig_v®ue
 = 
£rv”
.
maxş›Ás
;

818 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
 ||†È< 1è
badfmt
;

821 
£rv”
.
maxş›Ás
 = 
Î
;

822 ià(
Î
 > 
Üig_v®ue
) {

823 
	`adju¡O³nFesLim™
();

824 ià(
£rv”
.
maxş›Ás
 !ğ
Î
) {

825 
	`addR•lyE¼ÜFÜm©
(
c
,"Thİ”©šg sy¡em i nÙ‡bËØhªdËh¥ecif›d‚umb” oàş›Ás,ry w™h %d", 
£rv”
.
maxş›Ás
);

826 
£rv”
.
maxş›Ás
 = 
Üig_v®ue
;

829 ià((è
	`«G‘S‘Size
(
£rv”
.
–
) <

830 
£rv”
.
maxş›Ás
 + 
CONFIG_FDSET_INCR
)

832 ià(
	`«ResizeS‘Size
(
£rv”
.
–
,

833 
£rv”
.
maxş›Ás
 + 
CONFIG_FDSET_INCR
è=ğ
AE_ERR
)

835 
	`addR•lyE¼Ü
(
c
,"Theƒvent†oop API used by Redis is‚ot‡bleo handlehe specified‚umber of clients");

836 
£rv”
.
maxş›Ás
 = 
Üig_v®ue
;

841 } 
	`cÚfig_£t_¥ecŸl_f›ld
("appendonly") {

842 
’abË
 = 
	`ye¢Ùoi
(
o
->
±r
);

844 ià(
’abË
 =ğ-1è
badfmt
;

845 ià(
’abË
 =ğ0 && 
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

846 
	`¡İAµ’dOÆy
();

847 } ià(
’abË
 && 
£rv”
.
aof_¡©e
 =ğ
AOF_OFF
) {

848 ià(
	`¡¬tAµ’dOÆy
(è=ğ
C_ERR
) {

849 
	`addR•lyE¼Ü
(
c
,

854 } 
	`cÚfig_£t_¥ecŸl_f›ld
("save") {

855 
vËn
, 
j
;

856 
sds
 *
v
 = 
	`sds¥l™Ën
(
o
->
±r
,
	`sd¦’
(o->±r)," ",1,&
vËn
);

861 ià(
vËn
 & 1) {

862 
	`sdsä“¥l™»s
(
v
,
vËn
);

863 
badfmt
;

865 
j
 = 0; j < 
vËn
; j++) {

866 *
•Œ
;

867 
v®
;

869 
v®
 = 
	`¡¹Şl
(
v
[
j
], &
•Œ
, 10);

870 ià(
•Œ
[0] != '\0' ||

871 ((
j
 & 1è=ğ0 && 
v®
 < 1) ||

872 ((
j
 & 1è=ğ1 && 
v®
 < 0)) {

873 
	`sdsä“¥l™»s
(
v
,
vËn
);

874 
badfmt
;

878 
	`»£tS”v”SaveP¬ams
();

879 
j
 = 0; j < 
vËn
; j += 2) {

880 
time_t
 
£cÚds
;

881 
chªges
;

883 
£cÚds
 = 
	`¡¹Şl
(
v
[
j
],
NULL
,10);

884 
chªges
 = 
	`¡¹Şl
(
v
[
j
+1],
NULL
,10);

885 
	`­³ndS”v”SaveP¬ams
(
£cÚds
, 
chªges
);

887 
	`sdsä“¥l™»s
(
v
,
vËn
);

888 } 
	`cÚfig_£t_¥ecŸl_f›ld
("dir") {

889 ià(
	`chdœ
((*)
o
->
±r
) == -1) {

890 
	`addR•lyE¼ÜFÜm©
(
c
,"Chªgšg dœeùÜy: %s", 
	`¡»¼Ü
(
”ºo
));

893 } 
	`cÚfig_£t_¥ecŸl_f›ld
("client-output-buffer-limit") {

894 
vËn
, 
j
;

895 
sds
 *
v
 = 
	`sds¥l™Ën
(
o
->
±r
,
	`sd¦’
(o->±r)," ",1,&
vËn
);

898 ià(
vËn
 % 4) {

899 
	`sdsä“¥l™»s
(
v
,
vËn
);

900 
badfmt
;

906 
j
 = 0; j < 
vËn
; j++) {

907 
v®
;

909 ià((
j
 % 4) == 0) {

910 
şass
 = 
	`g‘Cl›ÁTy³ByName
(
v
[
j
]);

911 ià(
şass
 =ğ-1 || cÏs =ğ
CLIENT_TYPE_MASTER
) {

912 
	`sdsä“¥l™»s
(
v
,
vËn
);

913 
badfmt
;

916 
v®
 = 
	`memtŞl
(
v
[
j
], &
”r
);

917 ià(
”r
 || 
v®
 < 0) {

918 
	`sdsä“¥l™»s
(
v
,
vËn
);

919 
badfmt
;

924 
j
 = 0; j < 
vËn
; j += 4) {

925 
şass
;

926 
h¬d
, 
soá
;

927 
soá_£cÚds
;

929 
şass
 = 
	`g‘Cl›ÁTy³ByName
(
v
[
j
]);

930 
h¬d
 = 
	`¡¹Şl
(
v
[
j
+1],
NULL
,10);

931 
soá
 = 
	`¡¹Şl
(
v
[
j
+2],
NULL
,10);

932 
soá_£cÚds
 = 
	`¡¹Şl
(
v
[
j
+3],
NULL
,10);

934 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
h¬d_lim™_by‹s
 = 
h¬d
;

935 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_by‹s
 = 
soá
;

936 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_£cÚds
 = 
soá_£cÚds
;

938 
	`sdsä“¥l™»s
(
v
,
vËn
);

939 } 
	`cÚfig_£t_¥ecŸl_f›ld
("notify-keyspace-events") {

940 
æags
 = 
	`key¥aûEv’tsSŒšgToFÏgs
(
o
->
±r
);

942 ià(
æags
 =ğ-1è
badfmt
;

943 
£rv”
.
nÙify_key¥aû_ev’ts
 = 
æags
;

944 } 
	`cÚfig_£t_¥ecŸl_f›ld
("slave-announce-ip") {

945 
	`zä“
(
£rv”
.
¦ave_ªnounû_
);

946 
£rv”
.
¦ave_ªnounû_
 = ((*)
o
->
±r
)[0] ? 
	`z¡rdup
(o->±rè: 
NULL
;

950 } 
	`cÚfig_£t_boŞ_f›ld
(

951 "rdbcom´essiÚ", 
£rv”
.
rdb_com´essiÚ
) {

952 } 
	`cÚfig_£t_boŞ_f›ld
(

953 "»¶-di§bË-tı-nod–ay",
£rv”
.
»¶_di§bË_tı_nod–ay
) {

954 } 
	`cÚfig_£t_boŞ_f›ld
(

955 "»¶-diskËss-sync",
£rv”
.
»¶_diskËss_sync
) {

956 } 
	`cÚfig_£t_boŞ_f›ld
(

957 "şu¡”-»quœe-fuÎ-cov”age",
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
) {

958 } 
	`cÚfig_£t_boŞ_f›ld
(

959 "aof-»wr™e-šüem’l-fsync",
£rv”
.
aof_»wr™e_šüem’l_fsync
) {

960 } 
	`cÚfig_£t_boŞ_f›ld
(

961 "aof-lßd-Œunÿ‹d",
£rv”
.
aof_lßd_Œunÿ‹d
) {

962 } 
	`cÚfig_£t_boŞ_f›ld
(

963 "aof-u£-rdb-´—mbË",
£rv”
.
aof_u£_rdb_´—mbË
) {

964 } 
	`cÚfig_£t_boŞ_f›ld
(

965 "¦ave-£rve-¡®e-d©a",
£rv”
.
»¶_£rve_¡®e_d©a
) {

966 } 
	`cÚfig_£t_boŞ_f›ld
(

967 "¦ave-»ad-Úly",
£rv”
.
»¶_¦ave_ro
) {

968 } 
	`cÚfig_£t_boŞ_f›ld
(

969 "aùiv”ehashšg",
£rv”
.
aùiv”ehashšg
) {

970 } 
	`cÚfig_£t_boŞ_f›ld
(

971 "´Ùeùed-mode",
£rv”
.
´Ùeùed_mode
) {

972 } 
	`cÚfig_£t_boŞ_f›ld
(

973 "¡İ-wr™es-Ú-bg§ve-”rÜ",
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
) {

974 } 
	`cÚfig_£t_boŞ_f›ld
(

975 "Ïzyä“-Ïzy-eviùiÚ",
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
) {

976 } 
	`cÚfig_£t_boŞ_f›ld
(

977 "Ïzyä“-Ïzy-expœe",
£rv”
.
Ïzyä“_Ïzy_expœe
) {

978 } 
	`cÚfig_£t_boŞ_f›ld
(

979 "Ïzyä“-Ïzy-£rv”-d–",
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
) {

980 } 
	`cÚfig_£t_boŞ_f›ld
(

981 "¦ave-Ïzy-æush",
£rv”
.
»¶_¦ave_Ïzy_æush
) {

982 } 
	`cÚfig_£t_boŞ_f›ld
(

983 "no-­³ndfsync-Ú-»wr™e",
£rv”
.
aof_no_fsync_Ú_»wr™e
) {

987 } 
	`cÚfig_£t_num”iÿl_f›ld
(

988 "tı-k“·live",
£rv”
.
tık“·live
,0,
LLONG_MAX
) {

989 } 
	`cÚfig_£t_num”iÿl_f›ld
(

990 "maxmemÜy-§m¶es",
£rv”
.
maxmemÜy_§m¶es
,1,
LLONG_MAX
) {

991 } 
	`cÚfig_£t_num”iÿl_f›ld
(

992 "lfu-log-çùÜ",
£rv”
.
lfu_log_çùÜ
,0,
LLONG_MAX
) {

993 } 
	`cÚfig_£t_num”iÿl_f›ld
(

994 "lfu-deÿy-time",
£rv”
.
lfu_deÿy_time
,0,
LLONG_MAX
) {

995 } 
	`cÚfig_£t_num”iÿl_f›ld
(

996 "timeout",
£rv”
.
maxidËtime
,0,
LONG_MAX
) {

997 } 
	`cÚfig_£t_num”iÿl_f›ld
(

998 "auto-aof-»wr™e-³rûÁage",
£rv”
.
aof_»wr™e_³rc
,0,
LLONG_MAX
){

999 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1000 "auto-aof-»wr™e-mš-size",
£rv”
.
aof_»wr™e_mš_size
,0,
LLONG_MAX
) {

1001 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1002 "hash-max-zli¡-’Œ›s",
£rv”
.
hash_max_zli¡_’Œ›s
,0,
LLONG_MAX
) {

1003 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1004 "hash-max-zli¡-v®ue",
£rv”
.
hash_max_zli¡_v®ue
,0,
LLONG_MAX
) {

1005 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1006 "li¡-max-zli¡-size",
£rv”
.
li¡_max_zli¡_size
,
INT_MIN
,
INT_MAX
) {

1007 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1008 "li¡-com´ess-d•th",
£rv”
.
li¡_com´ess_d•th
,0,
INT_MAX
) {

1009 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1010 "£t-max-št£t-’Œ›s",
£rv”
.
£t_max_št£t_’Œ›s
,0,
LLONG_MAX
) {

1011 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1012 "z£t-max-zli¡-’Œ›s",
£rv”
.
z£t_max_zli¡_’Œ›s
,0,
LLONG_MAX
) {

1013 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1014 "z£t-max-zli¡-v®ue",
£rv”
.
z£t_max_zli¡_v®ue
,0,
LLONG_MAX
) {

1015 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1016 "hÎ-¥¬£-max-by‹s",
£rv”
.
hÎ_¥¬£_max_by‹s
,0,
LLONG_MAX
) {

1017 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1018 "lua-time-lim™",
£rv”
.
lua_time_lim™
,0,
LLONG_MAX
) {

1019 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1020 "¦owlog-log-¦ow”-thª",
£rv”
.
¦owlog_log_¦ow”_thª
,0,
LLONG_MAX
) {

1021 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1022 "¦owlog-max-Ën",
Î
,0,
LLONG_MAX
) {

1024 
£rv”
.
¦owlog_max_Ën
 = ()
Î
;

1025 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1026 "Ï‹ncy-mÚ™Ü-th»shŞd",
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
,0,
LLONG_MAX
){

1027 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1028 "»¶-pšg-¦ave-³riod",
£rv”
.
»¶_pšg_¦ave_³riod
,1,
LLONG_MAX
) {

1029 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1030 "»¶-timeout",
£rv”
.
»¶_timeout
,1,
LLONG_MAX
) {

1031 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1032 "»¶-backlog-‰l",
£rv”
.
»¶_backlog_time_lim™
,0,
LLONG_MAX
) {

1033 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1034 "»¶-diskËss-sync-d–ay",
£rv”
.
»¶_diskËss_sync_d–ay
,0,
LLONG_MAX
) {

1035 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1036 "¦ave-´iÜ™y",
£rv”
.
¦ave_´iÜ™y
,0,
LLONG_MAX
) {

1037 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1038 "¦ave-ªnounû-pÜt",
£rv”
.
¦ave_ªnounû_pÜt
,0,65535) {

1039 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1040 "mš-¦aves-to-wr™e",
£rv”
.
»¶_mš_¦aves_to_wr™e
,0,
LLONG_MAX
) {

1041 
	`»äeshGoodSÏvesCouÁ
();

1042 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1043 "mš-¦aves-max-Ïg",
£rv”
.
»¶_mš_¦aves_max_Ïg
,0,
LLONG_MAX
) {

1044 
	`»äeshGoodSÏvesCouÁ
();

1045 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1046 "şu¡”-node-timeout",
£rv”
.
şu¡”_node_timeout
,0,
LLONG_MAX
) {

1047 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1048 "şu¡”-ªnounû-pÜt",
£rv”
.
şu¡”_ªnounû_pÜt
,0,65535) {

1049 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1050 "şu¡”-ªnounû-bus-pÜt",
£rv”
.
şu¡”_ªnounû_bus_pÜt
,0,65535) {

1051 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1052 "şu¡”-mig¿tiÚ-b¬r›r",
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
,0,
LLONG_MAX
){

1053 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1054 "şu¡”-¦ave-v®id™y-çùÜ",
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
,0,
LLONG_MAX
) {

1055 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1056 "hz",
£rv”
.
hz
,0,
LLONG_MAX
) {

1059 ià(
£rv”
.
hz
 < 
CONFIG_MIN_HZ
) server.hz = CONFIG_MIN_HZ;

1060 ià(
£rv”
.
hz
 > 
CONFIG_MAX_HZ
) server.hz = CONFIG_MAX_HZ;

1061 } 
	`cÚfig_£t_num”iÿl_f›ld
(

1062 "w©chdog-³riod",
Î
,0,
LLONG_MAX
) {

1063 ià(
Î
)

1064 
	`’abËW©chdog
(
Î
);

1066 
	`di§bËW©chdog
();

1070 } 
	`cÚfig_£t_memÜy_f›ld
("maxmemÜy",
£rv”
.
maxmemÜy
) {

1071 ià(
£rv”
.
maxmemÜy
) {

1072 ià(
£rv”
.
maxmemÜy
 < 
	`zm®loc_u£d_memÜy
()) {

1073 
	`£rv”Log
(
LL_WARNING
,"WARNING:he‚ew maxmemory value set via CONFIG SET is smallerhanhe current memory usage. This will„esult in keysƒviction‡nd/or inabilityo‡ccept‚ew write commands depending onhe maxmemory-policy.");

1075 
	`ä“MemÜyIfN“ded
();

1077 } 
	`cÚfig_£t_memÜy_f›ld
("»¶-backlog-size",
Î
) {

1078 
	`»sizeR•liÿtiÚBacklog
(
Î
);

1082 } 
	`cÚfig_£t_’um_f›ld
(

1083 "logËv–",
£rv”
.
v”bos™y
,
logËv–_’um
) {

1084 } 
	`cÚfig_£t_’um_f›ld
(

1085 "maxmemÜy-pŞicy",
£rv”
.
maxmemÜy_pŞicy
,
maxmemÜy_pŞicy_’um
) {

1086 } 
	`cÚfig_£t_’um_f›ld
(

1087 "­³ndfsync",
£rv”
.
aof_fsync
,
aof_fsync_’um
) {

1090 } 
cÚfig_£t_–£
 {

1091 
	`addR•lyE¼ÜFÜm©
(
c
,"Unsupported CONFIG…arameter: %s",

1092 (*)
c
->
¬gv
[2]->
±r
);

1097 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1100 
badfmt
:

1101 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid‡rgument '%s' for CONFIG SET '%s'",

1102 (*)
o
->
±r
,

1103 (*)
c
->
¬gv
[2]->
±r
);

1110 
	#cÚfig_g‘_¡ršg_f›ld
(
_Çme
,
_v¬
) do { \

1111 ià(
	`¡ršgm©ch
(
·‰”n
,
_Çme
,1)) { \

1112 
	`addR•lyBulkCSŒšg
(
c
,
_Çme
); \

1113 
	`addR•lyBulkCSŒšg
(
c
,
_v¬
 ? _var : ""); \

1114 
m©ches
++; \

1116 } 0);

	)

1118 
	#cÚfig_g‘_boŞ_f›ld
(
_Çme
,
_v¬
) do { \

1119 ià(
	`¡ršgm©ch
(
·‰”n
,
_Çme
,1)) { \

1120 
	`addR•lyBulkCSŒšg
(
c
,
_Çme
); \

1121 
	`addR•lyBulkCSŒšg
(
c
,
_v¬
 ? "yes" : "no"); \

1122 
m©ches
++; \

1124 } 0);

	)

1126 
	#cÚfig_g‘_num”iÿl_f›ld
(
_Çme
,
_v¬
) do { \

1127 ià(
	`¡ršgm©ch
(
·‰”n
,
_Çme
,1)) { \

1128 
	`Î2¡ršg
(
buf
,(buf),
_v¬
); \

1129 
	`addR•lyBulkCSŒšg
(
c
,
_Çme
); \

1130 
	`addR•lyBulkCSŒšg
(
c
,
buf
); \

1131 
m©ches
++; \

1133 } 0);

	)

1135 
	#cÚfig_g‘_’um_f›ld
(
_Çme
,
_v¬
,
_’umv¬
) do { \

1136 ià(
	`¡ršgm©ch
(
·‰”n
,
_Çme
,1)) { \

1137 
	`addR•lyBulkCSŒšg
(
c
,
_Çme
); \

1138 
	`addR•lyBulkCSŒšg
(
c
,
	`cÚfigEnumG‘NameOrUnknown
(
_’umv¬
,
_v¬
)); \

1139 
m©ches
++; \

1141 } 0);

	)

1143 
	`cÚfigG‘Commªd
(
ş›Á
 *
c
) {

1144 
robj
 *
o
 = 
c
->
¬gv
[2];

1145 *
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

1146 *
·‰”n
 = 
o
->
±r
;

1147 
buf
[128];

1148 
m©ches
 = 0;

1149 
	`£rv”As£¹W™hInfo
(
c
,
o
,
	`sdsEncodedObjeù
(o));

1152 
	`cÚfig_g‘_¡ršg_f›ld
("dbf’ame",
£rv”
.
rdb_f’ame
);

1153 
	`cÚfig_g‘_¡ršg_f›ld
("»quœ•ass",
£rv”
.
»quœ•ass
);

1154 
	`cÚfig_g‘_¡ršg_f›ld
("ma¡”auth",
£rv”
.
ma¡”auth
);

1155 
	`cÚfig_g‘_¡ršg_f›ld
("şu¡”-ªnounû-",
£rv”
.
şu¡”_ªnounû_
);

1156 
	`cÚfig_g‘_¡ršg_f›ld
("unixsock‘",
£rv”
.
unixsock‘
);

1157 
	`cÚfig_g‘_¡ršg_f›ld
("logfe",
£rv”
.
logfe
);

1158 
	`cÚfig_g‘_¡ršg_f›ld
("pidfe",
£rv”
.
pidfe
);

1159 
	`cÚfig_g‘_¡ršg_f›ld
("¦ave-ªnounû-",
£rv”
.
¦ave_ªnounû_
);

1162 
	`cÚfig_g‘_num”iÿl_f›ld
("maxmemÜy",
£rv”
.
maxmemÜy
);

1163 
	`cÚfig_g‘_num”iÿl_f›ld
("maxmemÜy-§m¶es",
£rv”
.
maxmemÜy_§m¶es
);

1164 
	`cÚfig_g‘_num”iÿl_f›ld
("timeout",
£rv”
.
maxidËtime
);

1165 
	`cÚfig_g‘_num”iÿl_f›ld
("auto-aof-rewrite-percentage",

1166 
£rv”
.
aof_»wr™e_³rc
);

1167 
	`cÚfig_g‘_num”iÿl_f›ld
("auto-aof-rewrite-min-size",

1168 
£rv”
.
aof_»wr™e_mš_size
);

1169 
	`cÚfig_g‘_num”iÿl_f›ld
("hash-max-ziplist-entries",

1170 
£rv”
.
hash_max_zli¡_’Œ›s
);

1171 
	`cÚfig_g‘_num”iÿl_f›ld
("hash-max-ziplist-value",

1172 
£rv”
.
hash_max_zli¡_v®ue
);

1173 
	`cÚfig_g‘_num”iÿl_f›ld
("list-max-ziplist-size",

1174 
£rv”
.
li¡_max_zli¡_size
);

1175 
	`cÚfig_g‘_num”iÿl_f›ld
("list-compress-depth",

1176 
£rv”
.
li¡_com´ess_d•th
);

1177 
	`cÚfig_g‘_num”iÿl_f›ld
("set-max-intset-entries",

1178 
£rv”
.
£t_max_št£t_’Œ›s
);

1179 
	`cÚfig_g‘_num”iÿl_f›ld
("zset-max-ziplist-entries",

1180 
£rv”
.
z£t_max_zli¡_’Œ›s
);

1181 
	`cÚfig_g‘_num”iÿl_f›ld
("zset-max-ziplist-value",

1182 
£rv”
.
z£t_max_zli¡_v®ue
);

1183 
	`cÚfig_g‘_num”iÿl_f›ld
("hll-sparse-max-bytes",

1184 
£rv”
.
hÎ_¥¬£_max_by‹s
);

1185 
	`cÚfig_g‘_num”iÿl_f›ld
("lua-time-lim™",
£rv”
.
lua_time_lim™
);

1186 
	`cÚfig_g‘_num”iÿl_f›ld
("slowlog-log-slower-than",

1187 
£rv”
.
¦owlog_log_¦ow”_thª
);

1188 
	`cÚfig_g‘_num”iÿl_f›ld
("latency-monitor-threshold",

1189 
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
);

1190 
	`cÚfig_g‘_num”iÿl_f›ld
("slowlog-max-len",

1191 
£rv”
.
¦owlog_max_Ën
);

1192 
	`cÚfig_g‘_num”iÿl_f›ld
("pÜt",
£rv”
.
pÜt
);

1193 
	`cÚfig_g‘_num”iÿl_f›ld
("şu¡”-ªnounû-pÜt",
£rv”
.
şu¡”_ªnounû_pÜt
);

1194 
	`cÚfig_g‘_num”iÿl_f›ld
("şu¡”-ªnounû-bus-pÜt",
£rv”
.
şu¡”_ªnounû_bus_pÜt
);

1195 
	`cÚfig_g‘_num”iÿl_f›ld
("tı-backlog",
£rv”
.
tı_backlog
);

1196 
	`cÚfig_g‘_num”iÿl_f›ld
("d©aba£s",
£rv”
.
dbnum
);

1197 
	`cÚfig_g‘_num”iÿl_f›ld
("»¶-pšg-¦ave-³riod",
£rv”
.
»¶_pšg_¦ave_³riod
);

1198 
	`cÚfig_g‘_num”iÿl_f›ld
("»¶-timeout",
£rv”
.
»¶_timeout
);

1199 
	`cÚfig_g‘_num”iÿl_f›ld
("»¶-backlog-size",
£rv”
.
»¶_backlog_size
);

1200 
	`cÚfig_g‘_num”iÿl_f›ld
("»¶-backlog-‰l",
£rv”
.
»¶_backlog_time_lim™
);

1201 
	`cÚfig_g‘_num”iÿl_f›ld
("maxş›Ás",
£rv”
.
maxş›Ás
);

1202 
	`cÚfig_g‘_num”iÿl_f›ld
("w©chdog-³riod",
£rv”
.
w©chdog_³riod
);

1203 
	`cÚfig_g‘_num”iÿl_f›ld
("¦ave-´iÜ™y",
£rv”
.
¦ave_´iÜ™y
);

1204 
	`cÚfig_g‘_num”iÿl_f›ld
("¦ave-ªnounû-pÜt",
£rv”
.
¦ave_ªnounû_pÜt
);

1205 
	`cÚfig_g‘_num”iÿl_f›ld
("mš-¦aves-to-wr™e",
£rv”
.
»¶_mš_¦aves_to_wr™e
);

1206 
	`cÚfig_g‘_num”iÿl_f›ld
("mš-¦aves-max-Ïg",
£rv”
.
»¶_mš_¦aves_max_Ïg
);

1207 
	`cÚfig_g‘_num”iÿl_f›ld
("hz",
£rv”
.
hz
);

1208 
	`cÚfig_g‘_num”iÿl_f›ld
("şu¡”-node-timeout",
£rv”
.
şu¡”_node_timeout
);

1209 
	`cÚfig_g‘_num”iÿl_f›ld
("şu¡”-mig¿tiÚ-b¬r›r",
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
);

1210 
	`cÚfig_g‘_num”iÿl_f›ld
("şu¡”-¦ave-v®id™y-çùÜ",
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
);

1211 
	`cÚfig_g‘_num”iÿl_f›ld
("»¶-diskËss-sync-d–ay",
£rv”
.
»¶_diskËss_sync_d–ay
);

1212 
	`cÚfig_g‘_num”iÿl_f›ld
("tı-k“·live",
£rv”
.
tık“·live
);

1215 
	`cÚfig_g‘_boŞ_f›ld
("cluster-require-full-coverage",

1216 
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
);

1217 
	`cÚfig_g‘_boŞ_f›ld
("no-appendfsync-on-rewrite",

1218 
£rv”
.
aof_no_fsync_Ú_»wr™e
);

1219 
	`cÚfig_g‘_boŞ_f›ld
("slave-serve-stale-data",

1220 
£rv”
.
»¶_£rve_¡®e_d©a
);

1221 
	`cÚfig_g‘_boŞ_f›ld
("slave-read-only",

1222 
£rv”
.
»¶_¦ave_ro
);

1223 
	`cÚfig_g‘_boŞ_f›ld
("stop-writes-on-bgsave-error",

1224 
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
);

1225 
	`cÚfig_g‘_boŞ_f›ld
("d«mÚize", 
£rv”
.
d«mÚize
);

1226 
	`cÚfig_g‘_boŞ_f›ld
("rdbcom´essiÚ", 
£rv”
.
rdb_com´essiÚ
);

1227 
	`cÚfig_g‘_boŞ_f›ld
("rdbchecksum", 
£rv”
.
rdb_checksum
);

1228 
	`cÚfig_g‘_boŞ_f›ld
("aùiv”ehashšg", 
£rv”
.
aùiv”ehashšg
);

1229 
	`cÚfig_g‘_boŞ_f›ld
("´Ùeùed-mode", 
£rv”
.
´Ùeùed_mode
);

1230 
	`cÚfig_g‘_boŞ_f›ld
("repl-disable-tcp-nodelay",

1231 
£rv”
.
»¶_di§bË_tı_nod–ay
);

1232 
	`cÚfig_g‘_boŞ_f›ld
("repl-diskless-sync",

1233 
£rv”
.
»¶_diskËss_sync
);

1234 
	`cÚfig_g‘_boŞ_f›ld
("aof-rewrite-incremental-fsync",

1235 
£rv”
.
aof_»wr™e_šüem’l_fsync
);

1236 
	`cÚfig_g‘_boŞ_f›ld
("aof-load-truncated",

1237 
£rv”
.
aof_lßd_Œunÿ‹d
);

1238 
	`cÚfig_g‘_boŞ_f›ld
("aof-use-rdb-preamble",

1239 
£rv”
.
aof_u£_rdb_´—mbË
);

1240 
	`cÚfig_g‘_boŞ_f›ld
("lazyfree-lazy-eviction",

1241 
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
);

1242 
	`cÚfig_g‘_boŞ_f›ld
("lazyfree-lazy-expire",

1243 
£rv”
.
Ïzyä“_Ïzy_expœe
);

1244 
	`cÚfig_g‘_boŞ_f›ld
("lazyfree-lazy-server-del",

1245 
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
);

1246 
	`cÚfig_g‘_boŞ_f›ld
("slave-lazy-flush",

1247 
£rv”
.
»¶_¦ave_Ïzy_æush
);

1250 
	`cÚfig_g‘_’um_f›ld
("maxmemory-policy",

1251 
£rv”
.
maxmemÜy_pŞicy
,
maxmemÜy_pŞicy_’um
);

1252 
	`cÚfig_g‘_’um_f›ld
("loglevel",

1253 
£rv”
.
v”bos™y
,
logËv–_’um
);

1254 
	`cÚfig_g‘_’um_f›ld
("supervised",

1255 
£rv”
.
su³rvi£d_mode
,
su³rvi£d_mode_’um
);

1256 
	`cÚfig_g‘_’um_f›ld
("appendfsync",

1257 
£rv”
.
aof_fsync
,
aof_fsync_’um
);

1258 
	`cÚfig_g‘_’um_f›ld
("syslog-facility",

1259 
£rv”
.
sy¦og_çc™y
,
sy¦og_çc™y_’um
);

1263 ià(
	`¡ršgm©ch
(
·‰”n
,"appendonly",1)) {

1264 
	`addR•lyBulkCSŒšg
(
c
,"appendonly");

1265 
	`addR•lyBulkCSŒšg
(
c
,
£rv”
.
aof_¡©e
 =ğ
AOF_OFF
 ? "no" : "yes");

1266 
m©ches
++;

1268 ià(
	`¡ršgm©ch
(
·‰”n
,"dir",1)) {

1269 
buf
[1024];

1271 ià(
	`g‘cwd
(
buf
,(buf)è=ğ
NULL
)

1272 
buf
[0] = '\0';

1274 
	`addR•lyBulkCSŒšg
(
c
,"dir");

1275 
	`addR•lyBulkCSŒšg
(
c
,
buf
);

1276 
m©ches
++;

1278 ià(
	`¡ršgm©ch
(
·‰”n
,"save",1)) {

1279 
sds
 
buf
 = 
	`sd£m±y
();

1280 
j
;

1282 
j
 = 0; j < 
£rv”
.
§v•¬am¦’
; j++) {

1283 
buf
 = 
	`sdsÿrštf
(buf,"%jd %d",

1284 (
štmax_t
)
£rv”
.
§v•¬ams
[
j
].
£cÚds
,

1285 
£rv”
.
§v•¬ams
[
j
].
chªges
);

1286 ià(
j
 !ğ
£rv”
.
§v•¬am¦’
-1)

1287 
buf
 = 
	`sdsÿ’
(buf," ",1);

1289 
	`addR•lyBulkCSŒšg
(
c
,"save");

1290 
	`addR•lyBulkCSŒšg
(
c
,
buf
);

1291 
	`sdsä“
(
buf
);

1292 
m©ches
++;

1294 ià(
	`¡ršgm©ch
(
·‰”n
,"client-output-buffer-limit",1)) {

1295 
sds
 
buf
 = 
	`sd£m±y
();

1296 
j
;

1298 
j
 = 0; j < 
CLIENT_TYPE_OBUF_COUNT
; j++) {

1299 
buf
 = 
	`sdsÿrštf
(buf,"%s %llu %llu %ld",

1300 
	`g‘Cl›ÁTy³Name
(
j
),

1301 
£rv”
.
ş›Á_obuf_lim™s
[
j
].
h¬d_lim™_by‹s
,

1302 
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_by‹s
,

1303 (è
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_£cÚds
);

1304 ià(
j
 !ğ
CLIENT_TYPE_OBUF_COUNT
-1)

1305 
buf
 = 
	`sdsÿ’
(buf," ",1);

1307 
	`addR•lyBulkCSŒšg
(
c
,"client-output-buffer-limit");

1308 
	`addR•lyBulkCSŒšg
(
c
,
buf
);

1309 
	`sdsä“
(
buf
);

1310 
m©ches
++;

1312 ià(
	`¡ršgm©ch
(
·‰”n
,"unixsocketperm",1)) {

1313 
buf
[32];

1314 
	`¢´štf
(
buf
,(buf),"%o",
£rv”
.
unixsock‘³rm
);

1315 
	`addR•lyBulkCSŒšg
(
c
,"unixsocketperm");

1316 
	`addR•lyBulkCSŒšg
(
c
,
buf
);

1317 
m©ches
++;

1319 ià(
	`¡ršgm©ch
(
·‰”n
,"slaveof",1)) {

1320 
buf
[256];

1322 
	`addR•lyBulkCSŒšg
(
c
,"slaveof");

1323 ià(
£rv”
.
ma¡”ho¡
)

1324 
	`¢´štf
(
buf
,(buf),"%s %d",

1325 
£rv”
.
ma¡”ho¡
, s”v”.
ma¡”pÜt
);

1327 
buf
[0] = '\0';

1328 
	`addR•lyBulkCSŒšg
(
c
,
buf
);

1329 
m©ches
++;

1331 ià(
	`¡ršgm©ch
(
·‰”n
,"notify-keyspace-events",1)) {

1332 
robj
 *
æagsobj
 = 
	`ü—‹Objeù
(
OBJ_STRING
,

1333 
	`key¥aûEv’tsFÏgsToSŒšg
(
£rv”
.
nÙify_key¥aû_ev’ts
));

1335 
	`addR•lyBulkCSŒšg
(
c
,"notify-keyspace-events");

1336 
	`addR•lyBulk
(
c
,
æagsobj
);

1337 
	`deüRefCouÁ
(
æagsobj
);

1338 
m©ches
++;

1340 ià(
	`¡ršgm©ch
(
·‰”n
,"bind",1)) {

1341 
sds
 
aux
 = 
	`sdsjoš
(
£rv”
.
bšdaddr
,£rv”.
bšdaddr_couÁ
," ");

1343 
	`addR•lyBulkCSŒšg
(
c
,"bind");

1344 
	`addR•lyBulkCSŒšg
(
c
,
aux
);

1345 
	`sdsä“
(
aux
);

1346 
m©ches
++;

1348 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
m©ches
*2);

1355 
	#REDIS_CONFIG_REWRITE_SIGNATURE
 "# G’”©ed by CONFIG REWRITE"

	)

1360 
	`diùSdsCa£Hash
(cÚ¡ *
key
);

1361 
	`diùSdsKeyCa£Com·»
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
);

1362 
	`diùSdsDe¡ruùÜ
(*
´ivd©a
, *
v®
);

1363 
	`diùLi¡De¡ruùÜ
(*
´ivd©a
, *
v®
);

1367 
	`»wr™eCÚfigS’tš–O±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
);

1369 
diùTy³
 
İtiÚToLšeDiùTy³
 = {

1370 
diùSdsCa£Hash
,

1371 
NULL
,

1372 
NULL
,

1373 
diùSdsKeyCa£Com·»
,

1374 
diùSdsDe¡ruùÜ
,

1375 
diùLi¡De¡ruùÜ


1378 
diùTy³
 
İtiÚS‘DiùTy³
 = {

1379 
diùSdsCa£Hash
,

1380 
NULL
,

1381 
NULL
,

1382 
diùSdsKeyCa£Com·»
,

1383 
diùSdsDe¡ruùÜ
,

1384 
NULL


1388 
	s»wr™eCÚfigS‹
 {

1389 
diù
 *
İtiÚ_to_lše
;

1390 
diù
 *
»wr™‹n
;

1391 
numlšes
;

1392 
sds
 *
lšes
;

1393 
has_
;

1398 
	`»wr™eCÚfigAµ’dLše
(
»wr™eCÚfigS‹
 *
¡©e
, 
sds
 
lše
) {

1399 
¡©e
->
lšes
 = 
	`z»®loc
(¡©e->lšes, (*è* (¡©e->
numlšes
+1));

1400 
¡©e
->
lšes
[¡©e->
numlšes
++] = 
lše
;

1404 
	`»wr™eCÚfigAddLšeNumb”ToO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, 
sds
 
İtiÚ
, 
lš’um
) {

1405 
li¡
 *
l
 = 
	`diùF‘chV®ue
(
¡©e
->
İtiÚ_to_lše
,
İtiÚ
);

1407 ià(
l
 =ğ
NULL
) {

1408 
l
 = 
	`li¡C»©e
();

1409 
	`diùAdd
(
¡©e
->
İtiÚ_to_lše
,
	`sdsdup
(
İtiÚ
),
l
);

1411 
	`li¡AddNodeTa
(
l
,(*)()
lš’um
);

1418 
	`»wr™eCÚfigM¬kAsProûs£d
(
»wr™eCÚfigS‹
 *
¡©e
, cÚ¡ *
İtiÚ
) {

1419 
sds
 
İt
 = 
	`sd¢ew
(
İtiÚ
);

1421 ià(
	`diùAdd
(
¡©e
->
»wr™‹n
,
İt
,
NULL
è!ğ
DICT_OK
è
	`sdsä“
(opt);

1429 
»wr™eCÚfigS‹
 *
	`»wr™eCÚfigR—dOldFe
(*
·th
) {

1430 
FILE
 *
å
 = 
	`fİ’
(
·th
,"r");

1431 
»wr™eCÚfigS‹
 *
¡©e
 = 
	`zm®loc
((*state));

1432 
buf
[
CONFIG_MAX_LINE
+1];

1433 
lš’um
 = -1;

1435 ià(
å
 =ğ
NULL
 && 
”ºo
 !ğ
ENOENT
)  NULL;

1437 
¡©e
->
İtiÚ_to_lše
 = 
	`diùC»©e
(&
İtiÚToLšeDiùTy³
,
NULL
);

1438 
¡©e
->
»wr™‹n
 = 
	`diùC»©e
(&
İtiÚS‘DiùTy³
,
NULL
);

1439 
¡©e
->
numlšes
 = 0;

1440 
¡©e
->
lšes
 = 
NULL
;

1441 
¡©e
->
has_
 = 0;

1442 ià(
å
 =ğ
NULL
è 
¡©e
;

1445 
	`fg‘s
(
buf
,
CONFIG_MAX_LINE
+1,
å
è!ğ
NULL
) {

1446 
¬gc
;

1447 
sds
 *
¬gv
;

1448 
sds
 
lše
 = 
	`sd¡rim
(
	`sd¢ew
(
buf
),"\r\n\t ");

1450 
lš’um
++;

1453 ià(
lše
[0] == '#' ||†ine[0] == '\0') {

1454 ià(!
¡©e
->
has_
 && !
	`¡rcmp
(
lše
,
REDIS_CONFIG_REWRITE_SIGNATURE
))

1455 
¡©e
->
has_
 = 1;

1456 
	`»wr™eCÚfigAµ’dLše
(
¡©e
,
lše
);

1461 
¬gv
 = 
	`sds¥l™¬gs
(
lše
,&
¬gc
);

1462 ià(
¬gv
 =ğ
NULL
) {

1466 
sds
 
aux
 = 
	`sd¢ew
("# ??? ");

1467 
aux
 = 
	`sdsÿtsds
×ux,
lše
);

1468 
	`sdsä“
(
lše
);

1469 
	`»wr™eCÚfigAµ’dLše
(
¡©e
,
aux
);

1473 
	`sd¡Şow”
(
¬gv
[0]);

1477 
	`»wr™eCÚfigAµ’dLše
(
¡©e
,
lše
);

1478 
	`»wr™eCÚfigAddLšeNumb”ToO±iÚ
(
¡©e
,
¬gv
[0],
lš’um
);

1480 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

1482 
	`fşo£
(
å
);

1483  
¡©e
;

1502 
	`»wr™eCÚfigRewr™eLše
(
»wr™eCÚfigS‹
 *
¡©e
, cÚ¡ *
İtiÚ
, 
sds
 
lše
, 
fÜû
) {

1503 
sds
 
o
 = 
	`sd¢ew
(
İtiÚ
);

1504 
li¡
 *
l
 = 
	`diùF‘chV®ue
(
¡©e
->
İtiÚ_to_lše
,
o
);

1506 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,
İtiÚ
);

1508 ià(!
l
 && !
fÜû
) {

1510 
	`sdsä“
(
lše
);

1511 
	`sdsä“
(
o
);

1515 ià(
l
) {

1516 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
l
);

1517 
lš’um
 = (è
Ê
->
v®ue
;

1521 
	`li¡D–Node
(
l
,
Ê
);

1522 ià(
	`li¡L’gth
(
l
è=ğ0è
	`diùD–‘e
(
¡©e
->
İtiÚ_to_lše
,
o
);

1523 
	`sdsä“
(
¡©e
->
lšes
[
lš’um
]);

1524 
¡©e
->
lšes
[
lš’um
] = 
lše
;

1527 ià(!
¡©e
->
has_
) {

1528 
	`»wr™eCÚfigAµ’dLše
(
¡©e
,

1529 
	`sd¢ew
(
REDIS_CONFIG_REWRITE_SIGNATURE
));

1530 
¡©e
->
has_
 = 1;

1532 
	`»wr™eCÚfigAµ’dLše
(
¡©e
,
lše
);

1534 
	`sdsä“
(
o
);

1539 
	`»wr™eCÚfigFÜm©MemÜy
(*
buf
, 
size_t
 
Ën
, 
by‹s
) {

1540 
gb
 = 1024*1024*1024;

1541 
mb
 = 1024*1024;

1542 
kb
 = 1024;

1544 ià(
by‹s
 && (by‹ % 
gb
) == 0) {

1545  
	`¢´štf
(
buf
,
Ën
,"%Îdgb",
by‹s
/
gb
);

1546 } ià(
by‹s
 && (by‹ % 
mb
) == 0) {

1547  
	`¢´štf
(
buf
,
Ën
,"%Îdmb",
by‹s
/
mb
);

1548 } ià(
by‹s
 && (by‹ % 
kb
) == 0) {

1549  
	`¢´štf
(
buf
,
Ën
,"%Îdkb",
by‹s
/
kb
);

1551  
	`¢´štf
(
buf
,
Ën
,"%Îd",
by‹s
);

1556 
	`»wr™eCÚfigBy‹sO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, 
v®ue
, 
defv®ue
) {

1557 
buf
[64];

1558 
fÜû
 = 
v®ue
 !ğ
defv®ue
;

1559 
sds
 
lše
;

1561 
	`»wr™eCÚfigFÜm©MemÜy
(
buf
,(buf),
v®ue
);

1562 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %s",
İtiÚ
,
buf
);

1563 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1567 
	`»wr™eCÚfigYesNoO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, 
v®ue
, 
defv®ue
) {

1568 
fÜû
 = 
v®ue
 !ğ
defv®ue
;

1569 
sds
 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %s",
İtiÚ
,

1570 
v®ue
 ? "yes" : "no");

1572 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1576 
	`»wr™eCÚfigSŒšgO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, *
v®ue
, *
defv®ue
) {

1577 
fÜû
 = 1;

1578 
sds
 
lše
;

1582 ià(
v®ue
 =ğ
NULL
) {

1583 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,
İtiÚ
);

1588 ià(
defv®ue
 && 
	`¡rcmp
(
v®ue
,defv®ueè=ğ0è
fÜû
 = 0;

1590 
lše
 = 
	`sd¢ew
(
İtiÚ
);

1591 
lše
 = 
	`sdsÿ’
(line, " ", 1);

1592 
lše
 = 
	`sdsÿŒ•r
Öše, 
v®ue
, 
	`¡¾’
(value));

1594 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1598 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, 
v®ue
, 
defv®ue
) {

1599 
fÜû
 = 
v®ue
 !ğ
defv®ue
;

1600 
sds
 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %Îd",
İtiÚ
,
v®ue
);

1602 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1606 
	`»wr™eCÚfigOù®O±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, 
v®ue
, 
defv®ue
) {

1607 
fÜû
 = 
v®ue
 !ğ
defv®ue
;

1608 
sds
 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %o",
İtiÚ
,
v®ue
);

1610 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1616 
	`»wr™eCÚfigEnumO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
, *
İtiÚ
, 
v®ue
, 
cÚfigEnum
 *
û
, 
defv®
) {

1617 
sds
 
lše
;

1618 cÚ¡ *
Çme
 = 
	`cÚfigEnumG‘NameOrUnknown
(
û
,
v®ue
);

1619 
fÜû
 = 
v®ue
 !ğ
defv®
;

1621 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %s",
İtiÚ
,
Çme
);

1622 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1626 
	`»wr™eCÚfigSy¦ogçc™yO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1627 
v®ue
 = 
£rv”
.
sy¦og_çc™y
;

1628 
fÜû
 = 
v®ue
 !ğ
LOG_LOCAL0
;

1629 cÚ¡ *
Çme
 = 
NULL
, *
İtiÚ
 = "syslog-facility";

1630 
sds
 
lše
;

1632 
Çme
 = 
	`cÚfigEnumG‘NameOrUnknown
(
sy¦og_çc™y_’um
,
v®ue
);

1633 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% %s",
İtiÚ
,
Çme
);

1634 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1638 
	`»wr™eCÚfigSaveO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1639 
j
;

1640 
sds
 
lše
;

1645 
j
 = 0; j < 
£rv”
.
§v•¬am¦’
; j++) {

1646 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"save %ld %d",

1647 (è
£rv”
.
§v•¬ams
[
j
].
£cÚds
, s”v”.§v•¬ams[j].
chªges
);

1648 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"§ve",
lše
,1);

1651 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,"save");

1655 
	`»wr™eCÚfigDœO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1656 
cwd
[1024];

1658 ià(
	`g‘cwd
(
cwd
,(cwd)è=ğ
NULL
) {

1659 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,"dir");

1662 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"dœ",
cwd
,
NULL
);

1666 
	`»wr™eCÚfigSÏveofO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1667 *
İtiÚ
 = "slaveof";

1668 
sds
 
lše
;

1673 ià(
£rv”
.
şu¡”_’abËd
 || s”v”.
ma¡”ho¡
 =ğ
NULL
) {

1674 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,"slaveof");

1677 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"% % %d", 
İtiÚ
,

1678 
£rv”
.
ma¡”ho¡
, s”v”.
ma¡”pÜt
);

1679 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,1);

1683 
	`»wr™eCÚfigNÙifykey¥aûev’tsO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1684 
fÜû
 = 
£rv”
.
nÙify_key¥aû_ev’ts
 != 0;

1685 *
İtiÚ
 = "notify-keyspace-events";

1686 
sds
 
lše
, 
æags
;

1688 
æags
 = 
	`key¥aûEv’tsFÏgsToSŒšg
(
£rv”
.
nÙify_key¥aû_ev’ts
);

1689 
lše
 = 
	`sd¢ew
(
İtiÚ
);

1690 
lše
 = 
	`sdsÿ’
(line, " ", 1);

1691 
lše
 = 
	`sdsÿŒ•r
Öše, 
æags
, 
	`sd¦’
(flags));

1692 
	`sdsä“
(
æags
);

1693 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1697 
	`»wr™eCÚfigCl›Áouutbufã¾im™O±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1698 
j
;

1699 *
İtiÚ
 = "client-output-buffer-limit";

1701 
j
 = 0; j < 
CLIENT_TYPE_OBUF_COUNT
; j++) {

1702 
fÜû
 = (
£rv”
.
ş›Á_obuf_lim™s
[
j
].
h¬d_lim™_by‹s
 !=

1703 
ş›ÁBufãrLim™sDeçuÉs
[
j
].
h¬d_lim™_by‹s
) ||

1704 (
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_by‹s
 !=

1705 
ş›ÁBufãrLim™sDeçuÉs
[
j
].
soá_lim™_by‹s
) ||

1706 (
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_£cÚds
 !=

1707 
ş›ÁBufãrLim™sDeçuÉs
[
j
].
soá_lim™_£cÚds
);

1708 
sds
 
lše
;

1709 
h¬d
[64], 
soá
[64];

1711 
	`»wr™eCÚfigFÜm©MemÜy
(
h¬d
,(hard),

1712 
£rv”
.
ş›Á_obuf_lim™s
[
j
].
h¬d_lim™_by‹s
);

1713 
	`»wr™eCÚfigFÜm©MemÜy
(
soá
,(soft),

1714 
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_by‹s
);

1716 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"%s %s %s %s %ld",

1717 
İtiÚ
, 
	`g‘Cl›ÁTy³Name
(
j
), 
h¬d
, 
soá
,

1718 (è
£rv”
.
ş›Á_obuf_lim™s
[
j
].
soá_lim™_£cÚds
);

1719 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1724 
	`»wr™eCÚfigBšdO±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1725 
fÜû
 = 1;

1726 
sds
 
lše
, 
add»s£s
;

1727 *
İtiÚ
 = "bind";

1730 ià(
£rv”
.
bšdaddr_couÁ
 == 0) {

1731 
	`»wr™eCÚfigM¬kAsProûs£d
(
¡©e
,
İtiÚ
);

1736 
add»s£s
 = 
	`sdsjoš
(
£rv”
.
bšdaddr
,£rv”.
bšdaddr_couÁ
," ");

1737 
lše
 = 
	`sd¢ew
(
İtiÚ
);

1738 
lše
 = 
	`sdsÿ’
(line, " ", 1);

1739 
lše
 = 
	`sdsÿtsds
Öše, 
add»s£s
);

1740 
	`sdsä“
(
add»s£s
);

1742 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,
İtiÚ
,
lše
,
fÜû
);

1747 
sds
 
	`»wr™eCÚfigG‘CÚ‹ÁFromS‹
(
»wr™eCÚfigS‹
 *
¡©e
) {

1748 
sds
 
cÚ‹Á
 = 
	`sd£m±y
();

1749 
j
, 
was_em±y
 = 0;

1751 
j
 = 0; j < 
¡©e
->
numlšes
; j++) {

1753 ià(
	`sd¦’
(
¡©e
->
lšes
[
j
]) == 0) {

1754 ià(
was_em±y
) ;

1755 
was_em±y
 = 1;

1757 
was_em±y
 = 0;

1759 
cÚ‹Á
 = 
	`sdsÿtsds
(cÚ‹Á,
¡©e
->
lšes
[
j
]);

1760 
cÚ‹Á
 = 
	`sdsÿ’
(content,"\n",1);

1762  
cÚ‹Á
;

1766 
	`»wr™eCÚfigR–—£S‹
(
»wr™eCÚfigS‹
 *
¡©e
) {

1767 
	`sdsä“¥l™»s
(
¡©e
->
lšes
,¡©e->
numlšes
);

1768 
	`diùR–—£
(
¡©e
->
İtiÚ_to_lše
);

1769 
	`diùR–—£
(
¡©e
->
»wr™‹n
);

1770 
	`zä“
(
¡©e
);

1781 
	`»wr™eCÚfigRemoveO½hªed
(
»wr™eCÚfigS‹
 *
¡©e
) {

1782 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
¡©e
->
İtiÚ_to_lše
);

1783 
diùEÁry
 *
de
;

1785 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1786 
li¡
 *
l
 = 
	`diùG‘V®
(
de
);

1787 
sds
 
İtiÚ
 = 
	`diùG‘Key
(
de
);

1791 ià(
	`diùFšd
(
¡©e
->
»wr™‹n
,
İtiÚ
è=ğ
NULL
) {

1792 
	`£rv”Log
(
LL_DEBUG
,"NÙ„ewr™‹ÀİtiÚ: %s", 
İtiÚ
);

1796 
	`li¡L’gth
(
l
)) {

1797 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
l
);

1798 
lš’um
 = (è
Ê
->
v®ue
;

1800 
	`sdsä“
(
¡©e
->
lšes
[
lš’um
]);

1801 
¡©e
->
lšes
[
lš’um
] = 
	`sd£m±y
();

1802 
	`li¡D–Node
(
l
,
Ê
);

1805 
	`diùR–—£I‹¿tÜ
(
di
);

1820 
	`»wr™eCÚfigOv”wr™eFe
(*
cÚfigfe
, 
sds
 
cÚ‹Á
) {

1821 
»tv®
 = 0;

1822 
fd
 = 
	`İ’
(
cÚfigfe
,
O_RDWR
|
O_CREAT
,0644);

1823 
cÚ‹Á_size
 = 
	`sd¦’
(
cÚ‹Á
), 
·ddšg
 = 0;

1824 
¡©
 
sb
;

1825 
sds
 
cÚ‹Á_·dded
;

1829 ià(
fd
 == -1)  -1;

1830 ià(
	`f¡©
(
fd
,&
sb
) == -1) {

1831 
	`şo£
(
fd
);

1836 
cÚ‹Á_·dded
 = 
	`sdsdup
(
cÚ‹Á
);

1837 ià(
cÚ‹Á_size
 < 
sb
.
¡_size
) {

1840 
·ddšg
 = 
sb
.
¡_size
 - 
cÚ‹Á_size
;

1841 
cÚ‹Á_·dded
 = 
	`sdsgrowz”o
(cÚ‹Á_·dded,
sb
.
¡_size
);

1842 
cÚ‹Á_·dded
[
cÚ‹Á_size
] = '\n';

1843 
	`mem£t
(
cÚ‹Á_·dded
+
cÚ‹Á_size
+1,'#',
·ddšg
-1);

1847 ià(
	`wr™e
(
fd
,
cÚ‹Á_·dded
,
	`¡¾’
(content_padded)) == -1) {

1848 
»tv®
 = -1;

1849 
ş—nup
;

1853 ià(
·ddšg
) {

1854 ià(
	`árunÿ‹
(
fd
,
cÚ‹Á_size
) == -1) {

1859 
ş—nup
:

1860 
	`sdsä“
(
cÚ‹Á_·dded
);

1861 
	`şo£
(
fd
);

1862  
»tv®
;

1873 
	`»wr™eCÚfig
(*
·th
) {

1874 
»wr™eCÚfigS‹
 *
¡©e
;

1875 
sds
 
ÃwcÚ‹Á
;

1876 
»tv®
;

1879 ià((
¡©e
 = 
	`»wr™eCÚfigR—dOldFe
(
·th
)è=ğ
NULL
)  -1;

1884 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"d«mÚize",
£rv”
.
d«mÚize
,0);

1885 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"pidfe",
£rv”
.
pidfe
,
CONFIG_DEFAULT_PID_FILE
);

1886 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"pÜt",
£rv”
.
pÜt
,
CONFIG_DEFAULT_SERVER_PORT
);

1887 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"şu¡”-ªnounû-pÜt",
£rv”
.
şu¡”_ªnounû_pÜt
,
CONFIG_DEFAULT_CLUSTER_ANNOUNCE_PORT
);

1888 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"şu¡”-ªnounû-bus-pÜt",
£rv”
.
şu¡”_ªnounû_bus_pÜt
,
CONFIG_DEFAULT_CLUSTER_ANNOUNCE_BUS_PORT
);

1889 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"tı-backlog",
£rv”
.
tı_backlog
,
CONFIG_DEFAULT_TCP_BACKLOG
);

1890 
	`»wr™eCÚfigBšdO±iÚ
(
¡©e
);

1891 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"unixsock‘",
£rv”
.
unixsock‘
,
NULL
);

1892 
	`»wr™eCÚfigOù®O±iÚ
(
¡©e
,"unixsock‘³rm",
£rv”
.
unixsock‘³rm
,
CONFIG_DEFAULT_UNIX_SOCKET_PERM
);

1893 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"timeout",
£rv”
.
maxidËtime
,
CONFIG_DEFAULT_CLIENT_TIMEOUT
);

1894 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"tı-k“·live",
£rv”
.
tık“·live
,
CONFIG_DEFAULT_TCP_KEEPALIVE
);

1895 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"¦ave-ªnounû-pÜt",
£rv”
.
¦ave_ªnounû_pÜt
,
CONFIG_DEFAULT_SLAVE_ANNOUNCE_PORT
);

1896 
	`»wr™eCÚfigEnumO±iÚ
(
¡©e
,"logËv–",
£rv”
.
v”bos™y
,
logËv–_’um
,
CONFIG_DEFAULT_VERBOSITY
);

1897 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"logfe",
£rv”
.
logfe
,
CONFIG_DEFAULT_LOGFILE
);

1898 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"sy¦og-’abËd",
£rv”
.
sy¦og_’abËd
,
CONFIG_DEFAULT_SYSLOG_ENABLED
);

1899 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"sy¦og-id’t",
£rv”
.
sy¦og_id’t
,
CONFIG_DEFAULT_SYSLOG_IDENT
);

1900 
	`»wr™eCÚfigSy¦ogçc™yO±iÚ
(
¡©e
);

1901 
	`»wr™eCÚfigSaveO±iÚ
(
¡©e
);

1902 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"d©aba£s",
£rv”
.
dbnum
,
CONFIG_DEFAULT_DBNUM
);

1903 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"¡İ-wr™es-Ú-bg§ve-”rÜ",
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
,
CONFIG_DEFAULT_STOP_WRITES_ON_BGSAVE_ERROR
);

1904 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"rdbcom´essiÚ",
£rv”
.
rdb_com´essiÚ
,
CONFIG_DEFAULT_RDB_COMPRESSION
);

1905 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"rdbchecksum",
£rv”
.
rdb_checksum
,
CONFIG_DEFAULT_RDB_CHECKSUM
);

1906 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"dbf’ame",
£rv”
.
rdb_f’ame
,
CONFIG_DEFAULT_RDB_FILENAME
);

1907 
	`»wr™eCÚfigDœO±iÚ
(
¡©e
);

1908 
	`»wr™eCÚfigSÏveofO±iÚ
(
¡©e
);

1909 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"¦ave-ªnounû-",
£rv”
.
¦ave_ªnounû_
,
CONFIG_DEFAULT_SLAVE_ANNOUNCE_IP
);

1910 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"ma¡”auth",
£rv”
.
ma¡”auth
,
NULL
);

1911 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"şu¡”-ªnounû-",
£rv”
.
şu¡”_ªnounû_
,
NULL
);

1912 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"¦ave-£rve-¡®e-d©a",
£rv”
.
»¶_£rve_¡®e_d©a
,
CONFIG_DEFAULT_SLAVE_SERVE_STALE_DATA
);

1913 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"¦ave-»ad-Úly",
£rv”
.
»¶_¦ave_ro
,
CONFIG_DEFAULT_SLAVE_READ_ONLY
);

1914 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"»¶-pšg-¦ave-³riod",
£rv”
.
»¶_pšg_¦ave_³riod
,
CONFIG_DEFAULT_REPL_PING_SLAVE_PERIOD
);

1915 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"»¶-timeout",
£rv”
.
»¶_timeout
,
CONFIG_DEFAULT_REPL_TIMEOUT
);

1916 
	`»wr™eCÚfigBy‹sO±iÚ
(
¡©e
,"»¶-backlog-size",
£rv”
.
»¶_backlog_size
,
CONFIG_DEFAULT_REPL_BACKLOG_SIZE
);

1917 
	`»wr™eCÚfigBy‹sO±iÚ
(
¡©e
,"»¶-backlog-‰l",
£rv”
.
»¶_backlog_time_lim™
,
CONFIG_DEFAULT_REPL_BACKLOG_TIME_LIMIT
);

1918 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"»¶-di§bË-tı-nod–ay",
£rv”
.
»¶_di§bË_tı_nod–ay
,
CONFIG_DEFAULT_REPL_DISABLE_TCP_NODELAY
);

1919 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"»¶-diskËss-sync",
£rv”
.
»¶_diskËss_sync
,
CONFIG_DEFAULT_REPL_DISKLESS_SYNC
);

1920 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"»¶-diskËss-sync-d–ay",
£rv”
.
»¶_diskËss_sync_d–ay
,
CONFIG_DEFAULT_REPL_DISKLESS_SYNC_DELAY
);

1921 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"¦ave-´iÜ™y",
£rv”
.
¦ave_´iÜ™y
,
CONFIG_DEFAULT_SLAVE_PRIORITY
);

1922 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"mš-¦aves-to-wr™e",
£rv”
.
»¶_mš_¦aves_to_wr™e
,
CONFIG_DEFAULT_MIN_SLAVES_TO_WRITE
);

1923 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"mš-¦aves-max-Ïg",
£rv”
.
»¶_mš_¦aves_max_Ïg
,
CONFIG_DEFAULT_MIN_SLAVES_MAX_LAG
);

1924 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"»quœ•ass",
£rv”
.
»quœ•ass
,
NULL
);

1925 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"maxş›Ás",
£rv”
.
maxş›Ás
,
CONFIG_DEFAULT_MAX_CLIENTS
);

1926 
	`»wr™eCÚfigBy‹sO±iÚ
(
¡©e
,"maxmemÜy",
£rv”
.
maxmemÜy
,
CONFIG_DEFAULT_MAXMEMORY
);

1927 
	`»wr™eCÚfigEnumO±iÚ
(
¡©e
,"maxmemÜy-pŞicy",
£rv”
.
maxmemÜy_pŞicy
,
maxmemÜy_pŞicy_’um
,
CONFIG_DEFAULT_MAXMEMORY_POLICY
);

1928 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"maxmemÜy-§m¶es",
£rv”
.
maxmemÜy_§m¶es
,
CONFIG_DEFAULT_MAXMEMORY_SAMPLES
);

1929 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"­³ndÚly",
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
,0);

1930 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"­³ndf’ame",
£rv”
.
aof_f’ame
,
CONFIG_DEFAULT_AOF_FILENAME
);

1931 
	`»wr™eCÚfigEnumO±iÚ
(
¡©e
,"­³ndfsync",
£rv”
.
aof_fsync
,
aof_fsync_’um
,
CONFIG_DEFAULT_AOF_FSYNC
);

1932 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"no-­³ndfsync-Ú-»wr™e",
£rv”
.
aof_no_fsync_Ú_»wr™e
,
CONFIG_DEFAULT_AOF_NO_FSYNC_ON_REWRITE
);

1933 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"auto-aof-»wr™e-³rûÁage",
£rv”
.
aof_»wr™e_³rc
,
AOF_REWRITE_PERC
);

1934 
	`»wr™eCÚfigBy‹sO±iÚ
(
¡©e
,"auto-aof-»wr™e-mš-size",
£rv”
.
aof_»wr™e_mš_size
,
AOF_REWRITE_MIN_SIZE
);

1935 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"lua-time-lim™",
£rv”
.
lua_time_lim™
,
LUA_SCRIPT_TIME_LIMIT
);

1936 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"şu¡”-’abËd",
£rv”
.
şu¡”_’abËd
,0);

1937 
	`»wr™eCÚfigSŒšgO±iÚ
(
¡©e
,"şu¡”-cÚfig-fe",
£rv”
.
şu¡”_cÚfigfe
,
CONFIG_DEFAULT_CLUSTER_CONFIG_FILE
);

1938 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"şu¡”-»quœe-fuÎ-cov”age",
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
,
CLUSTER_DEFAULT_REQUIRE_FULL_COVERAGE
);

1939 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"şu¡”-node-timeout",
£rv”
.
şu¡”_node_timeout
,
CLUSTER_DEFAULT_NODE_TIMEOUT
);

1940 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"şu¡”-mig¿tiÚ-b¬r›r",
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
,
CLUSTER_DEFAULT_MIGRATION_BARRIER
);

1941 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"şu¡”-¦ave-v®id™y-çùÜ",
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
,
CLUSTER_DEFAULT_SLAVE_VALIDITY
);

1942 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"¦owlog-log-¦ow”-thª",
£rv”
.
¦owlog_log_¦ow”_thª
,
CONFIG_DEFAULT_SLOWLOG_LOG_SLOWER_THAN
);

1943 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"Ï‹ncy-mÚ™Ü-th»shŞd",
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
,
CONFIG_DEFAULT_LATENCY_MONITOR_THRESHOLD
);

1944 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"¦owlog-max-Ën",
£rv”
.
¦owlog_max_Ën
,
CONFIG_DEFAULT_SLOWLOG_MAX_LEN
);

1945 
	`»wr™eCÚfigNÙifykey¥aûev’tsO±iÚ
(
¡©e
);

1946 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"hash-max-zli¡-’Œ›s",
£rv”
.
hash_max_zli¡_’Œ›s
,
OBJ_HASH_MAX_ZIPLIST_ENTRIES
);

1947 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"hash-max-zli¡-v®ue",
£rv”
.
hash_max_zli¡_v®ue
,
OBJ_HASH_MAX_ZIPLIST_VALUE
);

1948 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"li¡-max-zli¡-size",
£rv”
.
li¡_max_zli¡_size
,
OBJ_LIST_MAX_ZIPLIST_SIZE
);

1949 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"li¡-com´ess-d•th",
£rv”
.
li¡_com´ess_d•th
,
OBJ_LIST_COMPRESS_DEPTH
);

1950 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"£t-max-št£t-’Œ›s",
£rv”
.
£t_max_št£t_’Œ›s
,
OBJ_SET_MAX_INTSET_ENTRIES
);

1951 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"z£t-max-zli¡-’Œ›s",
£rv”
.
z£t_max_zli¡_’Œ›s
,
OBJ_ZSET_MAX_ZIPLIST_ENTRIES
);

1952 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"z£t-max-zli¡-v®ue",
£rv”
.
z£t_max_zli¡_v®ue
,
OBJ_ZSET_MAX_ZIPLIST_VALUE
);

1953 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"hÎ-¥¬£-max-by‹s",
£rv”
.
hÎ_¥¬£_max_by‹s
,
CONFIG_DEFAULT_HLL_SPARSE_MAX_BYTES
);

1954 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"aùiv”ehashšg",
£rv”
.
aùiv”ehashšg
,
CONFIG_DEFAULT_ACTIVE_REHASHING
);

1955 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"´Ùeùed-mode",
£rv”
.
´Ùeùed_mode
,
CONFIG_DEFAULT_PROTECTED_MODE
);

1956 
	`»wr™eCÚfigCl›Áouutbufã¾im™O±iÚ
(
¡©e
);

1957 
	`»wr™eCÚfigNum”iÿlO±iÚ
(
¡©e
,"hz",
£rv”
.
hz
,
CONFIG_DEFAULT_HZ
);

1958 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"aof-»wr™e-šüem’l-fsync",
£rv”
.
aof_»wr™e_šüem’l_fsync
,
CONFIG_DEFAULT_AOF_REWRITE_INCREMENTAL_FSYNC
);

1959 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"aof-lßd-Œunÿ‹d",
£rv”
.
aof_lßd_Œunÿ‹d
,
CONFIG_DEFAULT_AOF_LOAD_TRUNCATED
);

1960 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"aof-u£-rdb-´—mbË",
£rv”
.
aof_u£_rdb_´—mbË
,
CONFIG_DEFAULT_AOF_USE_RDB_PREAMBLE
);

1961 
	`»wr™eCÚfigEnumO±iÚ
(
¡©e
,"su³rvi£d",
£rv”
.
su³rvi£d_mode
,
su³rvi£d_mode_’um
,
SUPERVISED_NONE
);

1962 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"Ïzyä“-Ïzy-eviùiÚ",
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
,
CONFIG_DEFAULT_LAZYFREE_LAZY_EVICTION
);

1963 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"Ïzyä“-Ïzy-expœe",
£rv”
.
Ïzyä“_Ïzy_expœe
,
CONFIG_DEFAULT_LAZYFREE_LAZY_EXPIRE
);

1964 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"Ïzyä“-Ïzy-£rv”-d–",
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
,
CONFIG_DEFAULT_LAZYFREE_LAZY_SERVER_DEL
);

1965 
	`»wr™eCÚfigYesNoO±iÚ
(
¡©e
,"¦ave-Ïzy-æush",
£rv”
.
»¶_¦ave_Ïzy_æush
,
CONFIG_DEFAULT_SLAVE_LAZY_FLUSH
);

1968 ià(
£rv”
.
£Áš–_mode
è
	`»wr™eCÚfigS’tš–O±iÚ
(
¡©e
);

1973 
	`»wr™eCÚfigRemoveO½hªed
(
¡©e
);

1977 
ÃwcÚ‹Á
 = 
	`»wr™eCÚfigG‘CÚ‹ÁFromS‹
(
¡©e
);

1978 
»tv®
 = 
	`»wr™eCÚfigOv”wr™eFe
(
£rv”
.
cÚfigfe
,
ÃwcÚ‹Á
);

1980 
	`sdsä“
(
ÃwcÚ‹Á
);

1981 
	`»wr™eCÚfigR–—£S‹
(
¡©e
);

1982  
»tv®
;

1989 
	`cÚfigCommªd
(
ş›Á
 *
c
) {

1991 ià(
£rv”
.
lßdšg
 && 
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"get")) {

1992 
	`addR•lyE¼Ü
(
c
,"Only CONFIG GET is‡llowed during†oading");

1996 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"set")) {

1997 ià(
c
->
¬gc
 !ğ4è
bad¬™y
;

1998 
	`cÚfigS‘Commªd
(
c
);

1999 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"get")) {

2000 ià(
c
->
¬gc
 !ğ3è
bad¬™y
;

2001 
	`cÚfigG‘Commªd
(
c
);

2002 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"resetstat")) {

2003 ià(
c
->
¬gc
 !ğ2è
bad¬™y
;

2004 
	`»£tS”v”Sts
();

2005 
	`»£tCommªdTabËSts
();

2006 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

2007 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"rewrite")) {

2008 ià(
c
->
¬gc
 !ğ2è
bad¬™y
;

2009 ià(
£rv”
.
cÚfigfe
 =ğ
NULL
) {

2010 
	`addR•lyE¼Ü
(
c
,"The server is„unning without‡ config file");

2013 ià(
	`»wr™eCÚfig
(
£rv”
.
cÚfigfe
) == -1) {

2014 
	`£rv”Log
(
LL_WARNING
,"CONFIG REWRITE faed: %s", 
	`¡»¼Ü
(
”ºo
));

2015 
	`addR•lyE¼ÜFÜm©
(
c
,"Rewr™šg cÚfig fe: %s", 
	`¡»¼Ü
(
”ºo
));

2017 
	`£rv”Log
(
LL_WARNING
,"CONFIG REWRITEƒxecuted with success.");

2018 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

2021 
	`addR•lyE¼Ü
(
c
,

2026 
bad¬™y
:

2027 
	`addR•lyE¼ÜFÜm©
(
c
,"Wrong‚umber of‡rguments for CONFIG %s",

2028 (*è
c
->
¬gv
[1]->
±r
);

	@config.h

30 #iâdeà
__CONFIG_H


31 
	#__CONFIG_H


	)

33 #ifdeà
__APPLE__


34 
	~<Avaab™yMaüos.h
>

37 #ifdeà
__lšux__


38 
	~<lšux/v”siÚ.h
>

39 
	~<ã©u»s.h
>

43 #ià
defšed
(
__APPLE__
è&& !defšed(
MAC_OS_X_VERSION_10_6
)

44 
	#»dis_f¡©
 
f¡©64


	)

45 
	#»dis_¡©
 
¡©64


	)

47 
	#»dis_f¡©
 
f¡©


	)

48 
	#»dis_¡©
 
¡©


	)

52 #ifdeà
__lšux__


53 
	#HAVE_PROC_STAT
 1

	)

54 
	#HAVE_PROC_MAPS
 1

	)

55 
	#HAVE_PROC_SMAPS
 1

	)

56 
	#HAVE_PROC_SOMAXCONN
 1

	)

60 #ià
defšed
(
__APPLE__
)

61 
	#HAVE_TASKINFO
 1

	)

65 #ià
defšed
(
__APPLE__
è|| (defšed(
__lšux__
è&& defšed(
__GLIBC__
))

66 
	#HAVE_BACKTRACE
 1

	)

70 #ifdeà
__lšux__


71 
	#HAVE_MSG_NOSIGNAL
 1

	)

75 #ifdeà
__lšux__


76 
	#HAVE_EPOLL
 1

	)

79 #ià(
defšed
(
__APPLE__
è&& defšed(
MAC_OS_X_VERSION_10_6
)è|| defšed(
__F»eBSD__
è|| defšed(
__O³nBSD__
è|| defšed (
__N‘BSD__
)

80 
	#HAVE_KQUEUE
 1

	)

83 #ifdeà
__sun


84 
	~<sys/ã©u»_‹¡s.h
>

85 #ifdeà
_DTRACE_VERSION


86 
	#HAVE_EVPORT
 1

	)

91 #ifdeà
__lšux__


92 
	#aof_fsync
 
fd©async


	)

94 
	#aof_fsync
 
fsync


	)

99 #ifdeà
__lšux__


100 #ià
defšed
(
__GLIBC__
è&& defšed(
__GLIBC_PREREQ
)

101 #ià(
LINUX_VERSION_CODE
 >ğ0x020611 && 
__GLIBC_PREREQ
(2, 6))

102 
	#HAVE_SYNC_FILE_RANGE
 1

	)

105 #ià(
LINUX_VERSION_CODE
 >= 0x020611)

106 
	#HAVE_SYNC_FILE_RANGE
 1

	)

111 #ifdeà
HAVE_SYNC_FILE_RANGE


112 
	#rdb_fsync_¿nge
(
fd
,
off
,
size
è
	`sync_fe_¿nge
(fd,off,size,
SYNC_FILE_RANGE_WAIT_BEFORE
|
SYNC_FILE_RANGE_WRITE
)

	)

114 
	#rdb_fsync_¿nge
(
fd
,
off
,
size
è
	`fsync
(fd)

	)

120 #ià(
defšed
 
__N‘BSD__
 || defšed 
__F»eBSD__
 || defšed 
__O³nBSD__
)

121 
	#USE_SETPROCTITLE


	)

124 #ià((
defšed
 
__lšux
 && defšed(
__GLIBC__
)è|| defšed 
__APPLE__
)

125 
	#USE_SETPROCTITLE


	)

126 
	#INIT_SETPROCTITLE_REPLACEMENT


	)

127 
¥t_š™
(
¬gc
, *
¬gv
[]);

128 
£roù™Ë
(cÚ¡ *
fmt
, ...);

132 
	~<sys/ty³s.h
>

134 #iâdeà
BYTE_ORDER


135 #ià(
BSD
 >= 199103)

136 
	~<machše/’dŸn.h
>

138 #ià
defšed
(
lšux
è|| defšed(
__lšux__
)

139 
	~<’dŸn.h
>

141 
	#LITTLE_ENDIAN
 1234

	)

142 
	#BIG_ENDIAN
 4321

	)

143 
	#PDP_ENDIAN
 3412

	)

145 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
è|| defšed(
__amd64__
) || \

146 
defšed
(
vax
è|| defšed(
ns32000
è|| defšed(
sun386
) || \

147 
defšed
(
MIPSEL
è|| defšed(
_MIPSEL
è|| defšed(
BIT_ZERO_ON_RIGHT
) || \

148 
defšed
(
__®pha__
è|| 
	$defšed
(
__®pha
)

149 
	#BYTE_ORDER
 
LITTLE_ENDIAN


	)

152 #ià
	`defšed
(
£l
è|| defšed(
pyr
è|| defšed(
mc68000
è|| defšed(
¥¬c
) || \

153 
	`defšed
(
is68k
è|| defšed(
hÛ
è|| defšed(
ibm032
è|| defšed(
ibm370
) || \

154 
	`defšed
(
MIPSEB
è|| defšed(
_MIPSEB
è|| defšed(
_IBMR2
è|| defšed(
DGUX
) ||\

155 
	`defšed
(
­Şlo
è|| defšed(
__cÚvex__
è|| defšed(
_CRAY
) || \

156 
	`defšed
(
__hµa
è|| defšed(
__hp9000
) || \

157 
	`defšed
(
__hp9000s300
è|| defšed(
__hp9000s700
) || \

158 
	`defšed
 (
BIT_ZERO_ON_LEFT
è|| defšed(
m68k
è|| 
	$defšed
(
__¥¬c
)

159 
	#BYTE_ORDER
 
BIG_ENDIAN


	)

169 #iâdeà
BYTE_ORDER


170 #ifdeà
__BYTE_ORDER


171 #ià
	`defšed
(
__LITTLE_ENDIAN
è&& defšed(
__BIG_ENDIAN
)

172 #iâdeà
LITTLE_ENDIAN


173 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

175 #iâdeà
BIG_ENDIAN


176 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

178 #ià(
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN
)

179 
	#BYTE_ORDER
 
LITTLE_ENDIAN


	)

181 
	#BYTE_ORDER
 
BIG_ENDIAN


	)

187 #ià!
	`defšed
(
BYTE_ORDER
) || \

188 (
BYTE_ORDER
 !ğ
BIG_ENDIAN
 && BYTE_ORDER !ğ
LITTLE_ENDIAN
)

197 #ià(
__i386
 || 
__amd64
 || 
__pow”pc__
è&& 
__GNUC__


198 
	#GNUC_VERSION
 (
__GNUC__
 * 10000 + 
__GNUC_MINOR__
 * 100 + 
__GNUC_PATCHLEVEL__
)

	)

199 #ià
	`defšed
(
__şªg__
)

200 
	#HAVE_ATOMIC


	)

202 #ià(
	`defšed
(
__GLIBC__
è&& defšed(
__GLIBC_PREREQ
))

203 #ià(
GNUC_VERSION
 >ğ40100 && 
	`__GLIBC_PREREQ
(2, 6))

204 
	#HAVE_ATOMIC


	)

	@crc16.c

1 
	~"£rv”.h
"

47 cÚ¡ 
ušt16_t
 
	güc16b
[256]= {

82 
ušt16_t
 
	$üc16
(cÚ¡ *
buf
, 
Ën
) {

83 
couÁ”
;

84 
ušt16_t
 
üc
 = 0;

85 
couÁ”
 = 0; couÁ” < 
Ën
; counter++)

86 
üc
 = (üc<<8è^ 
üc16b
[((üc>>8è^ *
buf
++)&0x00FF];

87  
üc
;

88 
	}
}

	@crc64.c

40 
	~<¡dšt.h
>

42 cÚ¡ 
ušt64_t
 
	güc64_b
[256] = {

43 
UINT64_C
(0x0000000000000000), UINT64_C(0x7ad870c830358979),

44 
UINT64_C
(0xf5b0e190606b12f2), UINT64_C(0x8f689158505e9b8b),

45 
UINT64_C
(0xc038e5739841b68f), UINT64_C(0xbae095bba8743ff6),

46 
UINT64_C
(0x358804e3f82aa47d), UINT64_C(0x4f50742bc81f2d04),

47 
UINT64_C
(0xab28ecb46814fe75), UINT64_C(0xd1f09c7c5821770c),

48 
UINT64_C
(0x5e980d24087fec87), UINT64_C(0x24407dec384a65fe),

49 
UINT64_C
(0x6b1009c7f05548fa), UINT64_C(0x11c8790fc060c183),

50 
UINT64_C
(0x9ea0e857903e5a08), UINT64_C(0xe478989fa00bd371),

51 
UINT64_C
(0x7d08ff3b88be6f81), UINT64_C(0x07d08ff3b88be6f8),

52 
UINT64_C
(0x88b81eabe8d57d73), UINT64_C(0xf2606e63d8e0f40a),

53 
UINT64_C
(0xbd301a4810ffd90e), UINT64_C(0xc7e86a8020ca5077),

54 
UINT64_C
(0x4880fbd87094cbfc), UINT64_C(0x32588b1040a14285),

55 
UINT64_C
(0xd620138fe0aa91f4), UINT64_C(0xacf86347d09f188d),

56 
UINT64_C
(0x2390f21f80c18306), UINT64_C(0x594882d7b0f40a7f),

57 
UINT64_C
(0x1618f6fc78eb277b), UINT64_C(0x6cc0863448deae02),

58 
UINT64_C
(0xe3a8176c18803589), UINT64_C(0x997067a428b5bcf0),

59 
UINT64_C
(0xfa11fe77117cdf02), UINT64_C(0x80c98ebf2149567b),

60 
UINT64_C
(0x0fa11fe77117cdf0), UINT64_C(0x75796f2f41224489),

61 
UINT64_C
(0x3a291b04893d698d), UINT64_C(0x40f16bccb908e0f4),

62 
UINT64_C
(0xcf99fa94e9567b7f), UINT64_C(0xb5418a5cd963f206),

63 
UINT64_C
(0x513912c379682177), UINT64_C(0x2be1620b495da80e),

64 
UINT64_C
(0xa489f35319033385), UINT64_C(0xde51839b2936bafc),

65 
UINT64_C
(0x9101f7b0e12997f8), UINT64_C(0xebd98778d11c1e81),

66 
UINT64_C
(0x64b116208142850a), UINT64_C(0x1e6966e8b1770c73),

67 
UINT64_C
(0x8719014c99c2b083), UINT64_C(0xfdc17184a9f739fa),

68 
UINT64_C
(0x72a9e0dcf9a9a271), UINT64_C(0x08719014c99c2b08),

69 
UINT64_C
(0x4721e43f0183060c), UINT64_C(0x3df994f731b68f75),

70 
UINT64_C
(0xb29105af61e814fe), UINT64_C(0xc849756751dd9d87),

71 
UINT64_C
(0x2c31edf8f1d64ef6), UINT64_C(0x56e99d30c1e3c78f),

72 
UINT64_C
(0xd9810c6891bd5c04), UINT64_C(0xa3597ca0a188d57d),

73 
UINT64_C
(0xec09088b6997f879), UINT64_C(0x96d1784359a27100),

74 
UINT64_C
(0x19b9e91b09fcea8b), UINT64_C(0x636199d339c963f2),

75 
UINT64_C
(0xdf7adabd7a6e2d6f), UINT64_C(0xa5a2aa754a5ba416),

76 
UINT64_C
(0x2aca3b2d1a053f9d), UINT64_C(0x50124be52a30b6e4),

77 
UINT64_C
(0x1f423fcee22f9be0), UINT64_C(0x659a4f06d21a1299),

78 
UINT64_C
(0xeaf2de5e82448912), UINT64_C(0x902aae96b271006b),

79 
UINT64_C
(0x74523609127ad31a), UINT64_C(0x0e8a46c1224f5a63),

80 
UINT64_C
(0x81e2d7997211c1e8), UINT64_C(0xfb3aa75142244891),

81 
UINT64_C
(0xb46ad37a8a3b6595), UINT64_C(0xceb2a3b2ba0eecec),

82 
UINT64_C
(0x41da32eaea507767), UINT64_C(0x3b024222da65fe1e),

83 
UINT64_C
(0xa2722586f2d042ee), UINT64_C(0xd8aa554ec2e5cb97),

84 
UINT64_C
(0x57c2c41692bb501c), UINT64_C(0x2d1ab4dea28ed965),

85 
UINT64_C
(0x624ac0f56a91f461), UINT64_C(0x1892b03d5aa47d18),

86 
UINT64_C
(0x97fa21650afae693), UINT64_C(0xed2251ad3acf6fea),

87 
UINT64_C
(0x095ac9329ac4bc9b), UINT64_C(0x7382b9faaaf135e2),

88 
UINT64_C
(0xfcea28a2faafae69), UINT64_C(0x8632586aca9a2710),

89 
UINT64_C
(0xc9622c4102850a14), UINT64_C(0xb3ba5c8932b0836d),

90 
UINT64_C
(0x3cd2cdd162ee18e6), UINT64_C(0x460abd1952db919f),

91 
UINT64_C
(0x256b24ca6b12f26d), UINT64_C(0x5fb354025b277b14),

92 
UINT64_C
(0xd0dbc55a0b79e09f), UINT64_C(0xaa03b5923b4c69e6),

93 
UINT64_C
(0xe553c1b9f35344e2), UINT64_C(0x9f8bb171c366cd9b),

94 
UINT64_C
(0x10e3202993385610), UINT64_C(0x6a3b50e1a30ddf69),

95 
UINT64_C
(0x8e43c87e03060c18), UINT64_C(0xf49bb8b633338561),

96 
UINT64_C
(0x7bf329ee636d1eea), UINT64_C(0x012b592653589793),

97 
UINT64_C
(0x4e7b2d0d9b47ba97), UINT64_C(0x34a35dc5ab7233ee),

98 
UINT64_C
(0xbbcbcc9dfb2ca865), UINT64_C(0xc113bc55cb19211c),

99 
UINT64_C
(0x5863dbf1e3ac9dec), UINT64_C(0x22bbab39d3991495),

100 
UINT64_C
(0xadd33a6183c78f1e), UINT64_C(0xd70b4aa9b3f20667),

101 
UINT64_C
(0x985b3e827bed2b63), UINT64_C(0xe2834e4a4bd8a21a),

102 
UINT64_C
(0x6debdf121b863991), UINT64_C(0x1733afda2bb3b0e8),

103 
UINT64_C
(0xf34b37458bb86399), UINT64_C(0x8993478dbb8deae0),

104 
UINT64_C
(0x06fbd6d5ebd3716b), UINT64_C(0x7c23a61ddbe6f812),

105 
UINT64_C
(0x3373d23613f9d516), UINT64_C(0x49aba2fe23cc5c6f),

106 
UINT64_C
(0xc6c333a67392c7e4), UINT64_C(0xbc1b436e43a74e9d),

107 
UINT64_C
(0x95ac9329ac4bc9b5), UINT64_C(0xef74e3e19c7e40cc),

108 
UINT64_C
(0x601c72b9cc20db47), UINT64_C(0x1ac40271fc15523e),

109 
UINT64_C
(0x5594765a340a7f3a), UINT64_C(0x2f4c0692043ff643),

110 
UINT64_C
(0xa02497ca54616dc8), UINT64_C(0xdafce7026454e4b1),

111 
UINT64_C
(0x3e847f9dc45f37c0), UINT64_C(0x445c0f55f46abeb9),

112 
UINT64_C
(0xcb349e0da4342532), UINT64_C(0xb1eceec59401ac4b),

113 
UINT64_C
(0xfebc9aee5c1e814f), UINT64_C(0x8464ea266c2b0836),

114 
UINT64_C
(0x0b0c7b7e3c7593bd), UINT64_C(0x71d40bb60c401ac4),

115 
UINT64_C
(0xe8a46c1224f5a634), UINT64_C(0x927c1cda14c02f4d),

116 
UINT64_C
(0x1d148d82449eb4c6), UINT64_C(0x67ccfd4a74ab3dbf),

117 
UINT64_C
(0x289c8961bcb410bb), UINT64_C(0x5244f9a98c8199c2),

118 
UINT64_C
(0xdd2c68f1dcdf0249), UINT64_C(0xa7f41839ecea8b30),

119 
UINT64_C
(0x438c80a64ce15841), UINT64_C(0x3954f06e7cd4d138),

120 
UINT64_C
(0xb63c61362c8a4ab3), UINT64_C(0xcce411fe1cbfc3ca),

121 
UINT64_C
(0x83b465d5d4a0eece), UINT64_C(0xf96c151de49567b7),

122 
UINT64_C
(0x76048445b4cbfc3c), UINT64_C(0x0cdcf48d84fe7545),

123 
UINT64_C
(0x6fbd6d5ebd3716b7), UINT64_C(0x15651d968d029fce),

124 
UINT64_C
(0x9a0d8ccedd5c0445), UINT64_C(0xe0d5fc06ed698d3c),

125 
UINT64_C
(0xaf85882d2576a038), UINT64_C(0xd55df8e515432941),

126 
UINT64_C
(0x5a3569bd451db2ca), UINT64_C(0x20ed197575283bb3),

127 
UINT64_C
(0xc49581ead523e8c2), UINT64_C(0xbe4df122e51661bb),

128 
UINT64_C
(0x3125607ab548fa30), UINT64_C(0x4bfd10b2857d7349),

129 
UINT64_C
(0x04ad64994d625e4d), UINT64_C(0x7e7514517d57d734),

130 
UINT64_C
(0xf11d85092d094cbf), UINT64_C(0x8bc5f5c11d3cc5c6),

131 
UINT64_C
(0x12b5926535897936), UINT64_C(0x686de2ad05bcf04f),

132 
UINT64_C
(0xe70573f555e26bc4), UINT64_C(0x9ddd033d65d7e2bd),

133 
UINT64_C
(0xd28d7716adc8cfb9), UINT64_C(0xa85507de9dfd46c0),

134 
UINT64_C
(0x273d9686cda3dd4b), UINT64_C(0x5de5e64efd965432),

135 
UINT64_C
(0xb99d7ed15d9d8743), UINT64_C(0xc3450e196da80e3a),

136 
UINT64_C
(0x4c2d9f413df695b1), UINT64_C(0x36f5ef890dc31cc8),

137 
UINT64_C
(0x79a59ba2c5dc31cc), UINT64_C(0x037deb6af5e9b8b5),

138 
UINT64_C
(0x8c157a32a5b7233e), UINT64_C(0xf6cd0afa9582aa47),

139 
UINT64_C
(0x4ad64994d625e4da), UINT64_C(0x300e395ce6106da3),

140 
UINT64_C
(0xbf66a804b64ef628), UINT64_C(0xc5bed8cc867b7f51),

141 
UINT64_C
(0x8aeeace74e645255), UINT64_C(0xf036dc2f7e51db2c),

142 
UINT64_C
(0x7f5e4d772e0f40a7), UINT64_C(0x05863dbf1e3ac9de),

143 
UINT64_C
(0xe1fea520be311aaf), UINT64_C(0x9b26d5e88e0493d6),

144 
UINT64_C
(0x144e44b0de5a085d), UINT64_C(0x6e963478ee6f8124),

145 
UINT64_C
(0x21c640532670ac20), UINT64_C(0x5b1e309b16452559),

146 
UINT64_C
(0xd476a1c3461bbed2), UINT64_C(0xaeaed10b762e37ab),

147 
UINT64_C
(0x37deb6af5e9b8b5b), UINT64_C(0x4d06c6676eae0222),

148 
UINT64_C
(0xc26e573f3ef099a9), UINT64_C(0xb8b627f70ec510d0),

149 
UINT64_C
(0xf7e653dcc6da3dd4), UINT64_C(0x8d3e2314f6efb4ad),

150 
UINT64_C
(0x0256b24ca6b12f26), UINT64_C(0x788ec2849684a65f),

151 
UINT64_C
(0x9cf65a1b368f752e), UINT64_C(0xe62e2ad306bafc57),

152 
UINT64_C
(0x6946bb8b56e467dc), UINT64_C(0x139ecb4366d1eea5),

153 
UINT64_C
(0x5ccebf68aecec3a1), UINT64_C(0x2616cfa09efb4ad8),

154 
UINT64_C
(0xa97e5ef8cea5d153), UINT64_C(0xd3a62e30fe90582a),

155 
UINT64_C
(0xb0c7b7e3c7593bd8), UINT64_C(0xca1fc72bf76cb2a1),

156 
UINT64_C
(0x45775673a732292a), UINT64_C(0x3faf26bb9707a053),

157 
UINT64_C
(0x70ff52905f188d57), UINT64_C(0x0a2722586f2d042e),

158 
UINT64_C
(0x854fb3003f739fa5), UINT64_C(0xff97c3c80f4616dc),

159 
UINT64_C
(0x1bef5b57af4dc5ad), UINT64_C(0x61372b9f9f784cd4),

160 
UINT64_C
(0xee5fbac7cf26d75f), UINT64_C(0x9487ca0fff135e26),

161 
UINT64_C
(0xdbd7be24370c7322), UINT64_C(0xa10fceec0739fa5b),

162 
UINT64_C
(0x2e675fb4576761d0), UINT64_C(0x54bf2f7c6752e8a9),

163 
UINT64_C
(0xcdcf48d84fe75459), UINT64_C(0xb71738107fd2dd20),

164 
UINT64_C
(0x387fa9482f8c46ab), UINT64_C(0x42a7d9801fb9cfd2),

165 
UINT64_C
(0x0df7adabd7a6e2d6), UINT64_C(0x772fdd63e7936baf),

166 
UINT64_C
(0xf8474c3bb7cdf024), UINT64_C(0x829f3cf387f8795d),

167 
UINT64_C
(0x66e7a46c27f3aa2c), UINT64_C(0x1c3fd4a417c62355),

168 
UINT64_C
(0x935745fc4798b8de), UINT64_C(0xe98f353477ad31a7),

169 
UINT64_C
(0xa6df411fbfb21ca3), UINT64_C(0xdc0731d78f8795da),

170 
UINT64_C
(0x536fa08fdfd90e51), UINT64_C(0x29b7d047efec8728),

173 
ušt64_t
 
	$üc64
(
ušt64_t
 
üc
, cÚ¡ *
s
, ušt64_ˆ
l
) {

174 
ušt64_t
 
j
;

176 
j
 = 0; j < 
l
; j++) {

177 
ušt8_t
 
by‹
 = 
s
[
j
];

178 
üc
 = 
üc64_b
[(
ušt8_t
)üø^ 
by‹
] ^ (crc >> 8);

180  
üc
;

181 
	}
}

184 #ifdeà
REDIS_TEST


185 
	~<¡dio.h
>

187 
	#UNUSED
(
x
è()(x)

	)

188 
	$üc64Te¡
(
¬gc
, *
¬gv
[]) {

189 
	`UNUSED
(
¬gc
);

190 
	`UNUSED
(
¬gv
);

191 
	`´štf
("e9c6d914c4b8d9ca == %016llx\n",

192 (è
	`üc64
(0,(*)"123456789",9));

194 
	}
}

	@crc64.h

1 #iâdeà
CRC64_H


2 
	#CRC64_H


	)

4 
	~<¡dšt.h
>

6 
ušt64_t
 
üc64
(ušt64_ˆ
üc
, cÚ¡ *
s
, ušt64_ˆ
l
);

8 #ifdeà
REDIS_TEST


9 
üc64Te¡
(
¬gc
, *
¬gv
[]);

	@db.c

30 
	~"£rv”.h
"

31 
	~"şu¡”.h
"

32 
	~"©omicv¬.h
"

34 
	~<sigÇl.h
>

35 
	~<ùy³.h
>

37 
¥¬£InU£
;

46 
robj
 *
	$lookupKey
(
»disDb
 *
db
, 
robj
 *
key
, 
æags
) {

47 if(!
¥¬£InU£
) {

48 
diùEÁry
 *
de
 = 
	`diùFšd
(
db
->
diù
,
key
->
±r
);

49 ià(
de
) {

50 
robj
 *
v®
 = 
	`diùG‘V®
(
de
);

55 ià(
£rv”
.
rdb_chd_pid
 == -1 &&

56 
£rv”
.
aof_chd_pid
 == -1 &&

57 !(
æags
 & 
LOOKUP_NOTOUCH
))

59 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

60 
ldt
 = 
v®
->
Ìu
 >> 8;

61 
couÁ”
 = 
	`LFULogInü
(
v®
->
Ìu
 & 255);

62 
v®
->
Ìu
 = (
ldt
 << 8è| 
couÁ”
;

64 
v®
->
Ìu
 = 
	`LRU_CLOCK
();

67  
v®
;

69  
NULL
;

73 
robj
* 
v®ue
;

74 
v®ue
 = 
	`zm®loc
Ğ(
robj
) );

75 
v®ue
->
»fcouÁ
 = 1;

77 ià(
£rv”
.
rdb_chd_pid
 == -1 &&

78 
£rv”
.
aof_chd_pid
 == -1 &&

79 !(
æags
 & 
LOOKUP_NOTOUCH
))

81 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

82 
ldt
 = 
v®ue
->
Ìu
 >> 8;

83 
couÁ”
 = 
	`LFULogInü
(
v®ue
->
Ìu
 & 255);

84 
v®ue
->
Ìu
 = (
ldt
 << 8è| 
couÁ”
;

86 
v®ue
->
Ìu
 = 
	`LRU_CLOCK
();

90 
v®ue
->
’codšg
 = 
OBJ_ENCODING_EMBSTR
;

91 
v®ue
->
ty³
 = 
OBJ_STRING
;

92 
diù
* 
d
 = 
db
->dict;

93 
HTI‹m
 *
™em
;

94 
™em
 = 
	`HashFšd
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT, 
key
->
±r
));

95 if(
™em
) {

96 
v®ue
->
±r
 = 
™em
->
d©a
;

97  
v®ue
;

99  
NULL
;

101 
	}
}

124 
robj
 *
	$lookupKeyR—dW™hFÏgs
(
»disDb
 *
db
, 
robj
 *
key
, 
æags
) {

125 
robj
 *
v®
;

127 ià(
	`expœeIfN“ded
(
db
,
key
) == 1) {

131 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
)  NULL;

145 ià(
£rv”
.
cu¼’t_ş›Á
 &&

146 
£rv”
.
cu¼’t_ş›Á
 !ğ£rv”.
ma¡”
 &&

147 
£rv”
.
cu¼’t_ş›Á
->
cmd
 &&

148 
£rv”
.
cu¼’t_ş›Á
->
cmd
->
æags
 & 
CMD_READONLY
)

150  
NULL
;

153 
v®
 = 
	`lookupKey
(
db
,
key
,
æags
);

155 ià(
v®
 =ğ
NULL
)

156 
£rv”
.
¡©_key¥aû_mis£s
++;

158 
£rv”
.
¡©_key¥aû_h™s
++;

159  
v®
;

160 
	}
}

164 
robj
 *
	$lookupKeyR—d
(
»disDb
 *
db
, 
robj
 *
key
) {

165  
	`lookupKeyR—dW™hFÏgs
(
db
,
key
,
LOOKUP_NONE
);

166 
	}
}

173 
robj
 *
	$lookupKeyWr™e
(
»disDb
 *
db
, 
robj
 *
key
) {

174 
	`expœeIfN“ded
(
db
,
key
);

175  
	`lookupKey
(
db
,
key
,
LOOKUP_NONE
);

176 
	}
}

178 
robj
 *
	$lookupKeyR—dOrR•ly
(
ş›Á
 *
c
, 
robj
 *
key
,„obj *
»¶y
) {

179 
robj
 *
o
 = 
	`lookupKeyR—d
(
c
->
db
, 
key
);

180 ià(!
o
è
	`addR•ly
(
c
,
»¶y
);

181  
o
;

182 
	}
}

184 
robj
 *
	$lookupKeyWr™eOrR•ly
(
ş›Á
 *
c
, 
robj
 *
key
,„obj *
»¶y
) {

185 
robj
 *
o
 = 
	`lookupKeyWr™e
(
c
->
db
, 
key
);

186 ià(!
o
è
	`addR•ly
(
c
,
»¶y
);

187  
o
;

188 
	}
}

194 
	$dbAdd
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
) {

195 
sds
 
cİy
 = 
	`sdsdup
(
key
->
±r
);

196 
»tv®
;

197 
»tv®
 = 
	`diùAdd
(
db
->
diù
, 
cİy
, 
v®
);

199 
	`£rv”As£¹W™hInfo
(
NULL
,
key
,
»tv®
 =ğ
DICT_OK
);

200 ià(
v®
->
ty³
 =ğ
OBJ_LIST
è
	`sigÇlLi¡AsR—dy
(
db
, 
key
);

201 ià(
£rv”
.
şu¡”_’abËd
è
	`¦ÙToKeyAdd
(
key
);

202 
	}
}

209 
	$dbOv”wr™e
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
) {

210 
diùEÁry
 *
de
 = 
	`diùFšd
(
db
->
diù
,
key
->
±r
);

212 
	`£rv”As£¹W™hInfo
(
NULL
,
key
,
de
 != NULL);

213 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

214 
robj
 *
Şd
 = 
	`diùG‘V®
(
de
);

215 
§ved_Ìu
 = 
Şd
->
Ìu
;

216 
	`diùR•Ïû
(
db
->
diù
, 
key
->
±r
, 
v®
);

217 
v®
->
Ìu
 = 
§ved_Ìu
;

219 
	`diùR•Ïû
(
db
->
diù
, 
key
->
±r
, 
v®
);

221 
	}
}

229 
	$£tKey
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
) {

230 if(!
¥¬£InU£
) {

231 ià(
	`lookupKeyWr™e
(
db
,
key
è=ğ
NULL
) {

232 
	`dbAdd
(
db
,
key
,
v®
);

234 
	`dbOv”wr™e
(
db
,
key
,
v®
);

236 
	`šüRefCouÁ
(
v®
);

237 
	`»moveExpœe
(
db
,
key
);

238 
	`sigÇlModif›dKey
(
db
,
key
);

240 
diù
* 
d
 = 
db
->dict;

241 
HTI‹m
 *
bck
;

242 
sds
 
v®ue
;

243 
bck
 = 
	`HashIn£¹
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT,
key
->
±r
),
v®
->ptr);

244 
bck
 = 
	`HashFšd
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT,
key
->
±r
));

245 if(
bck
) {

246 
v®ue
 = 
bck
->
d©a
;

249 
	`šüRefCouÁ
(
v®
);

252 
	`£rv”Log
(
LL_NOTICE
, "Not done!");

254 
	}
}

256 
	$dbExi¡s
(
»disDb
 *
db
, 
robj
 *
key
) {

257  
	`diùFšd
(
db
->
diù
,
key
->
±r
è!ğ
NULL
;

258 
	}
}

264 
robj
 *
	$dbRªdomKey
(
»disDb
 *
db
) {

265 
diùEÁry
 *
de
;

268 
sds
 
key
;

269 
robj
 *
keyobj
;

271 
de
 = 
	`diùG‘RªdomKey
(
db
->
diù
);

272 ià(
de
 =ğ
NULL
)  NULL;

274 
key
 = 
	`diùG‘Key
(
de
);

275 
keyobj
 = 
	`ü—‹SŒšgObjeù
(
key
,
	`sd¦’
(key));

276 ià(
	`diùFšd
(
db
->
expœes
,
key
)) {

277 ià(
	`expœeIfN“ded
(
db
,
keyobj
)) {

278 
	`deüRefCouÁ
(
keyobj
);

282  
keyobj
;

284 
	}
}

287 
	$dbSyncD–‘e
(
»disDb
 *
db
, 
robj
 *
key
) {

290 ià(
	`diùSize
(
db
->
expœes
è> 0è
	`diùD–‘e
(db->expœes,
key
->
±r
);

291 ià(
	`diùD–‘e
(
db
->
diù
,
key
->
±r
è=ğ
DICT_OK
) {

292 ià(
£rv”
.
şu¡”_’abËd
è
	`¦ÙToKeyD–
(
key
);

297 
	}
}

301 
	$dbD–‘e
(
»disDb
 *
db
, 
robj
 *
key
) {

302  
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
 ? 
	`dbAsyncD–‘e
(
db
,
key
) :

303 
	`dbSyncD–‘e
(
db
,
key
);

304 
	}
}

333 
robj
 *
	$dbUnsh¬eSŒšgV®ue
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
o
) {

334 
	`£rv”As£¹
(
o
->
ty³
 =ğ
OBJ_STRING
);

335 ià(
o
->
»fcouÁ
 !ğ1 || o->
’codšg
 !ğ
OBJ_ENCODING_RAW
) {

336 
robj
 *
decoded
 = 
	`g‘DecodedObjeù
(
o
);

337 
o
 = 
	`ü—‹RawSŒšgObjeù
(
decoded
->
±r
, 
	`sd¦’
(decoded->ptr));

338 
	`deüRefCouÁ
(
decoded
);

339 
	`dbOv”wr™e
(
db
,
key
,
o
);

341  
o
;

342 
	}
}

358 
em±yDb
(
dbnum
, 
æags
, (
ÿÎback
)(*)) {

359 
j
, 
async
 = (
æags
 & 
EMPTYDB_ASYNC
);

360 
»moved
 = 0;

362 ià(
dbnum
 < -1 || dbnum >ğ
£rv”
.dbnum) {

363 
”ºo
 = 
EINVAL
;

367 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

368 ià(
dbnum
 !ğ-1 && dbnum !ğ
j
) ;

369 
»moved
 +ğ
	`diùSize
(
£rv”
.
db
[
j
].
diù
);

370 ià(
async
) {

371 
	`em±yDbAsync
(&
£rv”
.
db
[
j
]);

373 
	`diùEm±y
(
£rv”
.
db
[
j
].
diù
,
ÿÎback
);

374 
	`diùEm±y
(
£rv”
.
db
[
j
].
expœes
,
ÿÎback
);

377 ià(
£rv”
.
şu¡”_’abËd
) {

378 ià(
async
) {

379 
	`¦ÙToKeyFlushAsync
();

381 
	`¦ÙToKeyFlush
();

384  
»moved
;

385 
	}
}

387 
	$£ËùDb
(
ş›Á
 *
c
, 
id
) {

388 ià(
id
 < 0 || id >ğ
£rv”
.
dbnum
)

389  
C_ERR
;

390 
c
->
db
 = &
£rv”
.db[
id
];

391  
C_OK
;

392 
	}
}

403 
	$sigÇlModif›dKey
(
»disDb
 *
db
, 
robj
 *
key
) {

404 
	`touchW©chedKey
(
db
,
key
);

405 
	}
}

407 
	$sigÇlFlushedDb
(
dbid
) {

408 
	`touchW©chedKeysOnFlush
(
dbid
);

409 
	}
}

423 
	$g‘FlushCommªdFÏgs
(
ş›Á
 *
c
, *
æags
) {

425 ià(
c
->
¬gc
 > 1) {

426 ià(
c
->
¬gc
 > 2 || 
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"async")) {

427 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

428  
C_ERR
;

430 *
æags
 = 
EMPTYDB_ASYNC
;

432 *
æags
 = 
EMPTYDB_NO_FLAGS
;

434  
C_OK
;

435 
	}
}

440 
	$æushdbCommªd
(
ş›Á
 *
c
) {

441 
æags
;

443 ià(
	`g‘FlushCommªdFÏgs
(
c
,&
æags
è=ğ
C_ERR
) ;

444 
	`sigÇlFlushedDb
(
c
->
db
->
id
);

445 
£rv”
.
dœty
 +ğ
	`em±yDb
(
c
->
db
->
id
,
æags
,
NULL
);

446 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

447 
	}
}

452 
	$æush®lCommªd
(
ş›Á
 *
c
) {

453 
æags
;

455 ià(
	`g‘FlushCommªdFÏgs
(
c
,&
æags
è=ğ
C_ERR
) ;

456 
	`sigÇlFlushedDb
(-1);

457 
£rv”
.
dœty
 +ğ
	`em±yDb
(-1,
æags
,
NULL
);

458 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

459 ià(
£rv”
.
rdb_chd_pid
 != -1) {

460 
	`kl
(
£rv”
.
rdb_chd_pid
,
SIGUSR1
);

461 
	`rdbRemoveTempFe
(
£rv”
.
rdb_chd_pid
);

463 ià(
£rv”
.
§v•¬am¦’
 > 0) {

466 
§ved_dœty
 = 
£rv”
.
dœty
;

467 
	`rdbSave
(
£rv”
.
rdb_f’ame
);

468 
£rv”
.
dœty
 = 
§ved_dœty
;

470 
£rv”
.
dœty
++;

471 
	}
}

474 
	$d–G’”icCommªd
(
ş›Á
 *
c
, 
Ïzy
) {

475 
numd–
 = 0, 
j
;

477 
j
 = 1; j < 
c
->
¬gc
; j++) {

478 
	`expœeIfN“ded
(
c
->
db
,c->
¬gv
[
j
]);

479 
d–‘ed
 = 
Ïzy
 ? 
	`dbAsyncD–‘e
(
c
->
db
,c->
¬gv
[
j
]) :

480 
	`dbSyncD–‘e
(
c
->
db
,c->
¬gv
[
j
]);

481 ià(
d–‘ed
) {

482 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[
j
]);

483 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,

484 "d–",
c
->
¬gv
[
j
],c->
db
->
id
);

485 
£rv”
.
dœty
++;

486 
numd–
++;

489 
	`addR•lyLÚgLÚg
(
c
,
numd–
);

490 
	}
}

492 
	$d–Commªd
(
ş›Á
 *
c
) {

493 
	`d–G’”icCommªd
(
c
,0);

494 
	}
}

496 
	$uÆškCommªd
(
ş›Á
 *
c
) {

497 
	`d–G’”icCommªd
(
c
,1);

498 
	}
}

502 
	$exi¡sCommªd
(
ş›Á
 *
c
) {

503 
couÁ
 = 0;

504 
j
;

506 
j
 = 1; j < 
c
->
¬gc
; j++) {

507 
	`expœeIfN“ded
(
c
->
db
,c->
¬gv
[
j
]);

508 ià(
	`dbExi¡s
(
c
->
db
,c->
¬gv
[
j
])è
couÁ
++;

510 
	`addR•lyLÚgLÚg
(
c
,
couÁ
);

511 
	}
}

513 
	$£ËùCommªd
(
ş›Á
 *
c
) {

514 
id
;

516 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[1], &
id
,

517 "šv®id DB index"è!ğ
C_OK
)

520 ià(
£rv”
.
şu¡”_’abËd
 && 
id
 != 0) {

521 
	`addR•lyE¼Ü
(
c
,"SELECT is‚ot‡llowed in cluster mode");

524 ià(
	`£ËùDb
(
c
,
id
è=ğ
C_ERR
) {

525 
	`addR•lyE¼Ü
(
c
,"invalid DB index");

527 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

529 
	}
}

531 
	$¿ndomkeyCommªd
(
ş›Á
 *
c
) {

532 
robj
 *
key
;

534 ià((
key
 = 
	`dbRªdomKey
(
c
->
db
)è=ğ
NULL
) {

535 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

539 
	`addR•lyBulk
(
c
,
key
);

540 
	`deüRefCouÁ
(
key
);

541 
	}
}

543 
	$keysCommªd
(
ş›Á
 *
c
) {

544 
diùI‹¿tÜ
 *
di
;

545 
diùEÁry
 *
de
;

546 
sds
 
·‰”n
 = 
c
->
¬gv
[1]->
±r
;

547 
¶’
 = 
	`sd¦’
(
·‰”n
), 
®lkeys
;

548 
numkeys
 = 0;

549 *
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

551 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
c
->
db
->
diù
);

552 
®lkeys
 = (
·‰”n
[0] == '*' &&…attern[1] == '\0');

553 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

554 
sds
 
key
 = 
	`diùG‘Key
(
de
);

555 
robj
 *
keyobj
;

557 ià(
®lkeys
 || 
	`¡ršgm©chËn
(
·‰”n
,
¶’
,
key
,
	`sd¦’
(key),0)) {

558 
keyobj
 = 
	`ü—‹SŒšgObjeù
(
key
,
	`sd¦’
(key));

559 ià(
	`expœeIfN“ded
(
c
->
db
,
keyobj
) == 0) {

560 
	`addR•lyBulk
(
c
,
keyobj
);

561 
numkeys
++;

563 
	`deüRefCouÁ
(
keyobj
);

566 
	`diùR–—£I‹¿tÜ
(
di
);

567 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
numkeys
);

568 
	}
}

572 
	$sÿnC®lback
(*
´ivd©a
, cÚ¡ 
diùEÁry
 *
de
) {

573 **
pd
 = (**è
´ivd©a
;

574 
li¡
 *
keys
 = 
pd
[0];

575 
robj
 *
o
 = 
pd
[1];

576 
robj
 *
key
, *
v®
 = 
NULL
;

578 ià(
o
 =ğ
NULL
) {

579 
sds
 
sdskey
 = 
	`diùG‘Key
(
de
);

580 
key
 = 
	`ü—‹SŒšgObjeù
(
sdskey
, 
	`sd¦’
(sdskey));

581 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

582 
sds
 
keysds
 = 
	`diùG‘Key
(
de
);

583 
key
 = 
	`ü—‹SŒšgObjeù
(
keysds
,
	`sd¦’
(keysds));

584 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

585 
sds
 
sdskey
 = 
	`diùG‘Key
(
de
);

586 
sds
 
sdsv®
 = 
	`diùG‘V®
(
de
);

587 
key
 = 
	`ü—‹SŒšgObjeù
(
sdskey
,
	`sd¦’
(sdskey));

588 
v®
 = 
	`ü—‹SŒšgObjeù
(
sdsv®
,
	`sd¦’
(sdsval));

589 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

590 
sds
 
sdskey
 = 
	`diùG‘Key
(
de
);

591 
key
 = 
	`ü—‹SŒšgObjeù
(
sdskey
,
	`sd¦’
(sdskey));

592 
v®
 = 
	`ü—‹SŒšgObjeùFromLÚgDoubË
(*(*)
	`diùG‘V®
(
de
),0);

594 
	`£rv”Pªic
("Type‚ot handled in SCAN callback.");

597 
	`li¡AddNodeTa
(
keys
, 
key
);

598 ià(
v®
è
	`li¡AddNodeTa
(
keys
, val);

599 
	}
}

605 
	$·r£SÿnCursÜOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
cursÜ
) {

606 *
•Œ
;

610 
”ºo
 = 0;

611 *
cursÜ
 = 
	`¡¹oul
(
o
->
±r
, &
•Œ
, 10);

612 ià(
	`is¥aû
(((*)
o
->
±r
)[0]è|| 
•Œ
[0] !ğ'\0' || 
”ºo
 =ğ
ERANGE
)

614 
	`addR•lyE¼Ü
(
c
, "invalid cursor");

615  
C_ERR
;

617  
C_OK
;

618 
	}
}

631 
	$sÿnG’”icCommªd
(
ş›Á
 *
c
, 
robj
 *
o
, 
cursÜ
) {

632 
i
, 
j
;

633 
li¡
 *
keys
 = 
	`li¡C»©e
();

634 
li¡Node
 *
node
, *
ÃxŠode
;

635 
couÁ
 = 10;

636 
sds
 
·t
 = 
NULL
;

637 
·’
 = 0, 
u£_·‰”n
 = 0;

638 
diù
 *
ht
;

642 
	`£rv”As£¹
(
o
 =ğ
NULL
 || o->
ty³
 =ğ
OBJ_SET
 || o->ty³ =ğ
OBJ_HASH
 ||

643 
o
->
ty³
 =ğ
OBJ_ZSET
);

646 
i
 = (
o
 =ğ
NULL
) ? 2 : 3;

649 
i
 < 
c
->
¬gc
) {

650 
j
 = 
c
->
¬gc
 - 
i
;

651 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
, "couÁ"è&& 
j
 >= 2) {

652 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
i
+1], &
couÁ
, 
NULL
)

653 !ğ
C_OK
)

655 
ş—nup
;

658 ià(
couÁ
 < 1) {

659 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

660 
ş—nup
;

663 
i
 += 2;

664 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
, "m©ch"è&& 
j
 >= 2) {

665 
·t
 = 
c
->
¬gv
[
i
+1]->
±r
;

666 
·’
 = 
	`sd¦’
(
·t
);

670 
u£_·‰”n
 = !(
·t
[0] =ğ'*' && 
·’
 == 1);

672 
i
 += 2;

674 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

675 
ş—nup
;

688 
ht
 = 
NULL
;

689 ià(
o
 =ğ
NULL
) {

690 
ht
 = 
c
->
db
->
diù
;

691 } ià(
o
->
ty³
 =ğ
OBJ_SET
 && o->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

692 
ht
 = 
o
->
±r
;

693 } ià(
o
->
ty³
 =ğ
OBJ_HASH
 && o->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

694 
ht
 = 
o
->
±r
;

695 
couÁ
 *= 2;

696 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
 && o->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

697 
z£t
 *
zs
 = 
o
->
±r
;

698 
ht
 = 
zs
->
diù
;

699 
couÁ
 *= 2;

702 ià(
ht
) {

703 *
´ivd©a
[2];

708 
max™”©iÚs
 = 
couÁ
*10;

713 
´ivd©a
[0] = 
keys
;

714 
´ivd©a
[1] = 
o
;

716 
cursÜ
 = 
	`diùSÿn
(
ht
, cursÜ, 
sÿnC®lback
, 
´ivd©a
);

717 } 
cursÜ
 &&

718 
max™”©iÚs
-- &&

719 
	`li¡L’gth
(
keys
è< ()
couÁ
);

720 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

721 
pos
 = 0;

722 
št64_t
 
Î
;

724 
	`št£tG‘
(
o
->
±r
,
pos
++,&
Î
))

725 
	`li¡AddNodeTa
(
keys
,
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î
));

726 
cursÜ
 = 0;

727 } ià(
o
->
ty³
 =ğ
OBJ_HASH
 || o->ty³ =ğ
OBJ_ZSET
) {

728 *
p
 = 
	`zli¡Index
(
o
->
±r
,0);

729 *
v¡r
;

730 
vËn
;

731 
vÎ
;

733 
p
) {

734 
	`zli¡G‘
(
p
,&
v¡r
,&
vËn
,&
vÎ
);

735 
	`li¡AddNodeTa
(
keys
,

736 (
v¡r
 !ğ
NULL
è? 
	`ü—‹SŒšgObjeù
((*)v¡r,
vËn
) :

737 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
vÎ
));

738 
p
 = 
	`zli¡Next
(
o
->
±r
,p);

740 
cursÜ
 = 0;

742 
	`£rv”Pªic
("Not handledƒncoding in SCAN.");

746 
node
 = 
	`li¡Fœ¡
(
keys
);

747 
node
) {

748 
robj
 *
kobj
 = 
	`li¡NodeV®ue
(
node
);

749 
ÃxŠode
 = 
	`li¡NextNode
(
node
);

750 
f‹r
 = 0;

753 ià(!
f‹r
 && 
u£_·‰”n
) {

754 ià(
	`sdsEncodedObjeù
(
kobj
)) {

755 ià(!
	`¡ršgm©chËn
(
·t
, 
·’
, 
kobj
->
±r
, 
	`sd¦’
(kobj->ptr), 0))

756 
f‹r
 = 1;

758 
buf
[
LONG_STR_SIZE
];

759 
Ën
;

761 
	`£rv”As£¹
(
kobj
->
’codšg
 =ğ
OBJ_ENCODING_INT
);

762 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),()
kobj
->
±r
);

763 ià(!
	`¡ršgm©chËn
(
·t
, 
·’
, 
buf
, 
Ën
, 0)è
f‹r
 = 1;

768 ià(!
f‹r
 && 
o
 =ğ
NULL
 && 
	`expœeIfN“ded
(
c
->
db
, 
kobj
)) filter = 1;

771 ià(
f‹r
) {

772 
	`deüRefCouÁ
(
kobj
);

773 
	`li¡D–Node
(
keys
, 
node
);

779 ià(
o
 && (o->
ty³
 =ğ
OBJ_ZSET
 || o->ty³ =ğ
OBJ_HASH
)) {

780 
node
 = 
ÃxŠode
;

781 
ÃxŠode
 = 
	`li¡NextNode
(
node
);

782 ià(
f‹r
) {

783 
kobj
 = 
	`li¡NodeV®ue
(
node
);

784 
	`deüRefCouÁ
(
kobj
);

785 
	`li¡D–Node
(
keys
, 
node
);

788 
node
 = 
ÃxŠode
;

792 
	`addR•lyMuÉiBulkL’
(
c
, 2);

793 
	`addR•lyBulkLÚgLÚg
(
c
,
cursÜ
);

795 
	`addR•lyMuÉiBulkL’
(
c
, 
	`li¡L’gth
(
keys
));

796 (
node
 = 
	`li¡Fœ¡
(
keys
)è!ğ
NULL
) {

797 
robj
 *
kobj
 = 
	`li¡NodeV®ue
(
node
);

798 
	`addR•lyBulk
(
c
, 
kobj
);

799 
	`deüRefCouÁ
(
kobj
);

800 
	`li¡D–Node
(
keys
, 
node
);

803 
ş—nup
:

804 
	`li¡S‘F»eM‘hod
(
keys
,
deüRefCouÁVoid
);

805 
	`li¡R–—£
(
keys
);

806 
	}
}

809 
	$sÿnCommªd
(
ş›Á
 *
c
) {

810 
cursÜ
;

811 ià(
	`·r£SÿnCursÜOrR•ly
(
c
,c->
¬gv
[1],&
cursÜ
è=ğ
C_ERR
) ;

812 
	`sÿnG’”icCommªd
(
c
,
NULL
,
cursÜ
);

813 
	}
}

815 
	$dbsizeCommªd
(
ş›Á
 *
c
) {

816 
	`addR•lyLÚgLÚg
(
c
,
	`diùSize
(c->
db
->
diù
));

817 
	}
}

819 
	$Ï¡§veCommªd
(
ş›Á
 *
c
) {

820 
	`addR•lyLÚgLÚg
(
c
,
£rv”
.
Ï¡§ve
);

821 
	}
}

823 
	$ty³Commªd
(
ş›Á
 *
c
) {

824 
robj
 *
o
;

825 *
ty³
;

827 
o
 = 
	`lookupKeyR—dW™hFÏgs
(
c
->
db
,c->
¬gv
[1],
LOOKUP_NOTOUCH
);

828 ià(
o
 =ğ
NULL
) {

829 
ty³
 = "none";

831 
o
->
ty³
) {

832 
OBJ_STRING
: 
ty³
 = "string"; ;

833 
OBJ_LIST
: 
ty³
 = "list"; ;

834 
OBJ_SET
: 
ty³
 = "set"; ;

835 
OBJ_ZSET
: 
ty³
 = "zset"; ;

836 
OBJ_HASH
: 
ty³
 = "hash"; ;

837 
OBJ_MODULE
: {

838 
moduËV®ue
 *
mv
 = 
o
->
±r
;

839 
ty³
 = 
mv
->ty³->
Çme
;

841 : 
ty³
 = "unknown"; ;

844 
	`addR•lyStus
(
c
,
ty³
);

845 
	}
}

847 
	$shutdownCommªd
(
ş›Á
 *
c
) {

848 
æags
 = 0;

850 ià(
c
->
¬gc
 > 2) {

851 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

853 } ià(
c
->
¬gc
 == 2) {

854 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"nosave")) {

855 
æags
 |ğ
SHUTDOWN_NOSAVE
;

856 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"save")) {

857 
æags
 |ğ
SHUTDOWN_SAVE
;

859 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

869 ià(
£rv”
.
lßdšg
 || s”v”.
£Áš–_mode
)

870 
æags
 = (æag & ~
SHUTDOWN_SAVE
è| 
SHUTDOWN_NOSAVE
;

871 ià(
	`´•¬eFÜShutdown
(
æags
è=ğ
C_OK
è
	`ex™
(0);

872 
	`addR•lyE¼Ü
(
c
,"Errorsryingo SHUTDOWN. Check†ogs.");

873 
	}
}

875 
	$»ÇmeG’”icCommªd
(
ş›Á
 *
c
, 
nx
) {

876 
robj
 *
o
;

877 
expœe
;

878 
§mekey
 = 0;

882 ià(
	`sdscmp
(
c
->
¬gv
[1]->
±r
,c->¬gv[2]->±rè=ğ0è
§mekey
 = 1;

884 ià((
o
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nokey”r
)è=ğ
NULL
)

887 ià(
§mekey
) {

888 
	`addR•ly
(
c
,
nx
 ? 
sh¬ed
.
cz”o
 : sh¬ed.
ok
);

892 
	`šüRefCouÁ
(
o
);

893 
expœe
 = 
	`g‘Expœe
(
c
->
db
,c->
¬gv
[1]);

894 ià(
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[2]è!ğ
NULL
) {

895 ià(
nx
) {

896 
	`deüRefCouÁ
(
o
);

897 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

902 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[2]);

904 
	`dbAdd
(
c
->
db
,c->
¬gv
[2],
o
);

905 ià(
expœe
 !ğ-1è
	`£tExpœe
(
c
->
db
,c->
¬gv
[2],expire);

906 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

907 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

908 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[2]);

909 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"rename_from",

910 
c
->
¬gv
[1],c->
db
->
id
);

911 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"rename_to",

912 
c
->
¬gv
[2],c->
db
->
id
);

913 
£rv”
.
dœty
++;

914 
	`addR•ly
(
c
,
nx
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
ok
);

915 
	}
}

917 
	$»ÇmeCommªd
(
ş›Á
 *
c
) {

918 
	`»ÇmeG’”icCommªd
(
c
,0);

919 
	}
}

921 
	$»Çm’xCommªd
(
ş›Á
 *
c
) {

922 
	`»ÇmeG’”icCommªd
(
c
,1);

923 
	}
}

925 
	$moveCommªd
(
ş›Á
 *
c
) {

926 
robj
 *
o
;

927 
»disDb
 *
¤c
, *
d¡
;

928 
¤cid
;

929 
dbid
, 
expœe
;

931 ià(
£rv”
.
şu¡”_’abËd
) {

932 
	`addR•lyE¼Ü
(
c
,"MOVE is‚ot‡llowed in cluster mode");

937 
¤c
 = 
c
->
db
;

938 
¤cid
 = 
c
->
db
->
id
;

940 ià(
	`g‘LÚgLÚgFromObjeù
(
c
->
¬gv
[2],&
dbid
è=ğ
C_ERR
 ||

941 
dbid
 < 
INT_MIN
 || dbid > 
INT_MAX
 ||

942 
	`£ËùDb
(
c
,
dbid
è=ğ
C_ERR
)

944 
	`addR•ly
(
c
,
sh¬ed
.
outoäªg“¼
);

947 
d¡
 = 
c
->
db
;

948 
	`£ËùDb
(
c
,
¤cid
);

952 ià(
¤c
 =ğ
d¡
) {

953 
	`addR•ly
(
c
,
sh¬ed
.
§meobjeù”r
);

958 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

959 ià(!
o
) {

960 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

963 
expœe
 = 
	`g‘Expœe
(
c
->
db
,c->
¬gv
[1]);

966 ià(
	`lookupKeyWr™e
(
d¡
,
c
->
¬gv
[1]è!ğ
NULL
) {

967 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

970 
	`dbAdd
(
d¡
,
c
->
¬gv
[1],
o
);

971 ià(
expœe
 !ğ-1è
	`£tExpœe
(
d¡
,
c
->
¬gv
[1],expire);

972 
	`šüRefCouÁ
(
o
);

975 
	`dbD–‘e
(
¤c
,
c
->
¬gv
[1]);

976 
£rv”
.
dœty
++;

977 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

978 
	}
}

984 
	$»moveExpœe
(
»disDb
 *
db
, 
robj
 *
key
) {

987 
	`£rv”As£¹W™hInfo
(
NULL
,
key
,
	`diùFšd
(
db
->
diù
,key->
±r
) != NULL);

988  
	`diùD–‘e
(
db
->
expœes
,
key
->
±r
è=ğ
DICT_OK
;

989 
	}
}

991 
	$£tExpœe
(
»disDb
 *
db
, 
robj
 *
key
, 
wh’
) {

992 
diùEÁry
 *
kde
, *
de
;

995 
kde
 = 
	`diùFšd
(
db
->
diù
,
key
->
±r
);

996 
	`£rv”As£¹W™hInfo
(
NULL
,
key
,
kde
 != NULL);

997 
de
 = 
	`diùAddOrFšd
(
db
->
expœes
,
	`diùG‘Key
(
kde
));

998 
	`diùS‘SigÃdIÁeg”V®
(
de
,
wh’
);

999 
	}
}

1003 
	$g‘Expœe
(
»disDb
 *
db
, 
robj
 *
key
) {

1004 
diùEÁry
 *
de
;

1007 ià(
	`diùSize
(
db
->
expœes
) == 0 ||

1008 (
de
 = 
	`diùFšd
(
db
->
expœes
,
key
->
±r
)è=ğ
NULL
)  -1;

1012 
	`£rv”As£¹W™hInfo
(
NULL
,
key
,
	`diùFšd
(
db
->
diù
,key->
±r
) != NULL);

1013  
	`diùG‘SigÃdIÁeg”V®
(
de
);

1014 
	}
}

1024 
	$´İag©eExpœe
(
»disDb
 *
db
, 
robj
 *
key
, 
Ïzy
) {

1025 
robj
 *
¬gv
[2];

1027 
¬gv
[0] = 
Ïzy
 ? 
sh¬ed
.
uÆšk
 : sh¬ed.
d–
;

1028 
¬gv
[1] = 
key
;

1029 
	`šüRefCouÁ
(
¬gv
[0]);

1030 
	`šüRefCouÁ
(
¬gv
[1]);

1032 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
)

1033 
	`ãedAµ’dOÆyFe
(
£rv”
.
d–Commªd
,
db
->
id
,
¬gv
,2);

1034 
	`»¶iÿtiÚF“dSÏves
(
£rv”
.
¦aves
,
db
->
id
,
¬gv
,2);

1036 
	`deüRefCouÁ
(
¬gv
[0]);

1037 
	`deüRefCouÁ
(
¬gv
[1]);

1038 
	}
}

1040 
	$expœeIfN“ded
(
»disDb
 *
db
, 
robj
 *
key
) {

1041 
m¡ime_t
 
wh’
 = 
	`g‘Expœe
(
db
,
key
);

1042 
m¡ime_t
 
now
;

1044 ià(
wh’
 < 0)  0;

1047 ià(
£rv”
.
lßdšg
)  0;

1054 
now
 = 
£rv”
.
lua_ÿÎ”
 ? s”v”.
lua_time_¡¬t
 : 
	`m¡ime
();

1063 ià(
£rv”
.
ma¡”ho¡
 !ğ
NULL
è 
now
 > 
wh’
;

1066 ià(
now
 <ğ
wh’
)  0;

1069 
£rv”
.
¡©_expœedkeys
++;

1070 
	`´İag©eExpœe
(
db
,
key
,
£rv”
.
Ïzyä“_Ïzy_expœe
);

1071 
	`nÙifyKey¥aûEv’t
(
NOTIFY_EXPIRED
,

1072 "expœed",
key
,
db
->
id
);

1073  
£rv”
.
Ïzyä“_Ïzy_expœe
 ? 
	`dbAsyncD–‘e
(
db
,
key
) :

1074 
	`dbSyncD–‘e
(
db
,
key
);

1075 
	}
}

1083 *
	$g‘KeysUsšgCommªdTabË
(
»disCommªd
 *
cmd
,
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1084 
j
, 
i
 = 0, 
Ï¡
, *
keys
;

1085 
	`UNUSED
(
¬gv
);

1087 ià(
cmd
->
fœ¡key
 == 0) {

1088 *
numkeys
 = 0;

1089  
NULL
;

1091 
Ï¡
 = 
cmd
->
Ï¡key
;

1092 ià(
Ï¡
 < 0èÏ¡ = 
¬gc
+last;

1093 
keys
 = 
	`zm®loc
(()*((
Ï¡
 - 
cmd
->
fœ¡key
)+1));

1094 
j
 = 
cmd
->
fœ¡key
; j <ğ
Ï¡
; j +ğcmd->
key¡•
) {

1095 
	`£rv”As£¹
(
j
 < 
¬gc
);

1096 
keys
[
i
++] = 
j
;

1098 *
numkeys
 = 
i
;

1099  
keys
;

1100 
	}
}

1113 *
	$g‘KeysFromCommªd
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1114 ià(
cmd
->
æags
 & 
CMD_MODULE_GETKEYS
) {

1115  
	`moduËG‘CommªdKeysVŸAPI
(
cmd
,
¬gv
,
¬gc
,
numkeys
);

1116 } ià(!(
cmd
->
æags
 & 
CMD_MODULE
è&& cmd->
g‘keys_´oc
) {

1117  
cmd
->
	`g‘keys_´oc
(cmd,
¬gv
,
¬gc
,
numkeys
);

1119  
	`g‘KeysUsšgCommªdTabË
(
cmd
,
¬gv
,
¬gc
,
numkeys
);

1121 
	}
}

1124 
	$g‘KeysF»eResuÉ
(*
»suÉ
) {

1125 
	`zä“
(
»suÉ
);

1126 
	}
}

1131 *
	$zuniÚIÁ”G‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1132 
i
, 
num
, *
keys
;

1133 
	`UNUSED
(
cmd
);

1135 
num
 = 
	`©oi
(
¬gv
[2]->
±r
);

1138 ià(
num
 > (
¬gc
-3)) {

1139 *
numkeys
 = 0;

1140  
NULL
;

1146 
keys
 = 
	`zm®loc
(()*(
num
+1));

1149 
i
 = 0; i < 
num
; i++è
keys
[i] = 3+i;

1152 
keys
[
num
] = 1;

1153 *
numkeys
 = 
num
+1;

1154  
keys
;

1155 
	}
}

1160 *
	$ev®G‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1161 
i
, 
num
, *
keys
;

1162 
	`UNUSED
(
cmd
);

1164 
num
 = 
	`©oi
(
¬gv
[2]->
±r
);

1167 ià(
num
 > (
¬gc
-3)) {

1168 *
numkeys
 = 0;

1169  
NULL
;

1172 
keys
 = 
	`zm®loc
(()*
num
);

1173 *
numkeys
 = 
num
;

1176 
i
 = 0; i < 
num
; i++è
keys
[i] = 3+i;

1178  
keys
;

1179 
	}
}

1188 *
	$sÜtG‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1189 
i
, 
j
, 
num
, *
keys
, 
found_¡Üe
 = 0;

1190 
	`UNUSED
(
cmd
);

1192 
num
 = 0;

1193 
keys
 = 
	`zm®loc
(()*2);

1195 
keys
[
num
++] = 1;

1202 *
Çme
;

1203 
sk
;

1204 } 
skli¡
[] = {

1208 {
NULL
, 0}

1211 
i
 = 2; i < 
¬gc
; i++) {

1212 
j
 = 0; 
skli¡
[j].
Çme
 !ğ
NULL
; j++) {

1213 ià(!
	`¡rÿ£cmp
(
¬gv
[
i
]->
±r
,
skli¡
[
j
].
Çme
)) {

1214 
i
 +ğ
skli¡
[
j
].
sk
;

1216 } ià(!
	`¡rÿ£cmp
(
¬gv
[
i
]->
±r
,"¡Üe"è&& i+1 < 
¬gc
) {

1220 
found_¡Üe
 = 1;

1221 
keys
[
num
] = 
i
+1;

1226 *
numkeys
 = 
num
 + 
found_¡Üe
;

1227  
keys
;

1228 
	}
}

1230 *
	$mig¿‹G‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

1231 
i
, 
num
, 
fœ¡
, *
keys
;

1232 
	`UNUSED
(
cmd
);

1235 
fœ¡
 = 3;

1236 
num
 = 1;

1239 ià(
¬gc
 > 6) {

1240 
i
 = 6; i < 
¬gc
; i++) {

1241 ià(!
	`¡rÿ£cmp
(
¬gv
[
i
]->
±r
,"keys") &&

1242 
	`sd¦’
(
¬gv
[3]->
±r
) == 0)

1244 
fœ¡
 = 
i
+1;

1245 
num
 = 
¬gc
-
fœ¡
;

1251 
keys
 = 
	`zm®loc
(()*
num
);

1252 
i
 = 0; i < 
num
; i++è
keys
[i] = 
fœ¡
+i;

1253 *
numkeys
 = 
num
;

1254  
keys
;

1255 
	}
}

1260 
	$¦ÙToKeyAdd
(
robj
 *
key
) {

1261 
hash¦Ù
 = 
	`keyHashSlÙ
(
key
->
±r
,
	`sd¦’
(key->ptr));

1263 
sds
 
sdskey
 = 
	`sdsdup
(
key
->
±r
);

1264 
	`z¦In£¹
(
£rv”
.
şu¡”
->
¦Ùs_to_keys
,
hash¦Ù
,
sdskey
);

1265 
	}
}

1267 
	$¦ÙToKeyD–
(
robj
 *
key
) {

1268 
hash¦Ù
 = 
	`keyHashSlÙ
(
key
->
±r
,
	`sd¦’
(key->ptr));

1269 
	`z¦D–‘e
(
£rv”
.
şu¡”
->
¦Ùs_to_keys
,
hash¦Ù
,
key
->
±r
,
NULL
);

1270 
	}
}

1272 
	$¦ÙToKeyFlush
() {

1273 
	`z¦F»e
(
£rv”
.
şu¡”
->
¦Ùs_to_keys
);

1274 
£rv”
.
şu¡”
->
¦Ùs_to_keys
 = 
	`z¦C»©e
();

1275 
	}
}

1280 
	$g‘KeysInSlÙ
(
hash¦Ù
, 
robj
 **
keys
, 
couÁ
) {

1281 
zskli¡Node
 *
n
;

1282 
z¿nge¥ec
 
¿nge
;

1283 
j
 = 0;

1285 
¿nge
.
mš
 =„ªge.
max
 = 
hash¦Ù
;

1286 
¿nge
.
mšex
 =„ªge.
maxex
 = 0;

1288 
n
 = 
	`z¦Fœ¡InRªge
(
£rv”
.
şu¡”
->
¦Ùs_to_keys
, &
¿nge
);

1289 
n
 &&‚->
scÜe
 =ğ
hash¦Ù
 && 
couÁ
--) {

1290 
keys
[
j
++] = 
	`ü—‹SŒšgObjeù
(
n
->
–e
,
	`sd¦’
(n->ele));

1291 
n
 =‚->
Ëv–
[0].
fÜw¬d
;

1293  
j
;

1294 
	}
}

1298 
	$d–KeysInSlÙ
(
hash¦Ù
) {

1299 
zskli¡Node
 *
n
;

1300 
z¿nge¥ec
 
¿nge
;

1301 
j
 = 0;

1303 
¿nge
.
mš
 =„ªge.
max
 = 
hash¦Ù
;

1304 
¿nge
.
mšex
 =„ªge.
maxex
 = 0;

1306 
n
 = 
	`z¦Fœ¡InRªge
(
£rv”
.
şu¡”
->
¦Ùs_to_keys
, &
¿nge
);

1307 
n
 &&‚->
scÜe
 =ğ
hash¦Ù
) {

1308 
sds
 
sdskey
 = 
n
->
–e
;

1309 
robj
 *
key
 = 
	`ü—‹SŒšgObjeù
(
sdskey
,
	`sd¦’
(sdskey));

1310 
n
 =‚->
Ëv–
[0].
fÜw¬d
;

1311 
	`dbD–‘e
(&
£rv”
.
db
[0],
key
);

1312 
	`deüRefCouÁ
(
key
);

1313 
j
++;

1315  
j
;

1316 
	}
}

1318 
	$couÁKeysInSlÙ
(
hash¦Ù
) {

1319 
zskli¡
 *
z¦
 = 
£rv”
.
şu¡”
->
¦Ùs_to_keys
;

1320 
zskli¡Node
 *
zn
;

1321 
z¿nge¥ec
 
¿nge
;

1322 
¿nk
, 
couÁ
 = 0;

1324 
¿nge
.
mš
 =„ªge.
max
 = 
hash¦Ù
;

1325 
¿nge
.
mšex
 =„ªge.
maxex
 = 0;

1328 
zn
 = 
	`z¦Fœ¡InRªge
(
z¦
, &
¿nge
);

1331 ià(
zn
 !ğ
NULL
) {

1332 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

1333 
couÁ
 = (
z¦
->
Ëngth
 - (
¿nk
 - 1));

1336 
zn
 = 
	`z¦La¡InRªge
(
z¦
, &
¿nge
);

1339 ià(
zn
 !ğ
NULL
) {

1340 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

1341 
couÁ
 -ğ(
z¦
->
Ëngth
 - 
¿nk
);

1344  
couÁ
;

1345 
	}
}

	@debug.c

30 
	~"£rv”.h
"

31 
	~"sha1.h
"

32 
	~"üc64.h
"

34 
	~<¬·/š‘.h
>

35 
	~<sigÇl.h
>

36 
	~<dlfú.h
>

38 #ifdeà
HAVE_BACKTRACE


39 
	~<execšfo.h
>

40 
	~<ucÚ‹xt.h
>

41 
	~<fú.h
>

42 
	~"bio.h
"

43 
	~<uni¡d.h
>

46 #ifdeà
__CYGWIN__


47 #iâdeà
SA_ONSTACK


48 
	#SA_ONSTACK
 0x08000000

	)

60 
	$xÜDige¡
(*
dige¡
, *
±r
, 
size_t
 
Ën
) {

61 
SHA1_CTX
 
ùx
;

62 
hash
[20], *
s
 = 
±r
;

63 
j
;

65 
	`SHA1In™
(&
ùx
);

66 
	`SHA1Upd©e
(&
ùx
,
s
,
Ën
);

67 
	`SHA1Fš®
(
hash
,&
ùx
);

69 
j
 = 0; j < 20; j++)

70 
dige¡
[
j
] ^ğ
hash
[j];

71 
	}
}

73 
	$xÜObjeùDige¡
(*
dige¡
, 
robj
 *
o
) {

74 
o
 = 
	`g‘DecodedObjeù
(o);

75 
	`xÜDige¡
(
dige¡
,
o
->
±r
,
	`sd¦’
(o->ptr));

76 
	`deüRefCouÁ
(
o
);

77 
	}
}

93 
	$mixDige¡
(*
dige¡
, *
±r
, 
size_t
 
Ën
) {

94 
SHA1_CTX
 
ùx
;

95 *
s
 = 
±r
;

97 
	`xÜDige¡
(
dige¡
,
s
,
Ën
);

98 
	`SHA1In™
(&
ùx
);

99 
	`SHA1Upd©e
(&
ùx
,
dige¡
,20);

100 
	`SHA1Fš®
(
dige¡
,&
ùx
);

101 
	}
}

103 
	$mixObjeùDige¡
(*
dige¡
, 
robj
 *
o
) {

104 
o
 = 
	`g‘DecodedObjeù
(o);

105 
	`mixDige¡
(
dige¡
,
o
->
±r
,
	`sd¦’
(o->ptr));

106 
	`deüRefCouÁ
(
o
);

107 
	}
}

115 
	$compu‹D©a£tDige¡
(*
fš®
) {

116 
dige¡
[20];

117 
buf
[128];

118 
diùI‹¿tÜ
 *
di
 = 
NULL
;

119 
diùEÁry
 *
de
;

120 
j
;

121 
ušt32_t
 
aux
;

123 
	`mem£t
(
fš®
,0,20);

125 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

126 
»disDb
 *
db
 = 
£rv”
.db+
j
;

128 ià(
	`diùSize
(
db
->
diù
) == 0) ;

129 
di
 = 
	`diùG‘I‹¿tÜ
(
db
->
diù
);

133 
aux
 = 
	`htÚl
(
j
);

134 
	`mixDige¡
(
fš®
,&
aux
,(aux));

137 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

138 
sds
 
key
;

139 
robj
 *
keyobj
, *
o
;

140 
expœ‘ime
;

142 
	`mem£t
(
dige¡
,0,20);

143 
key
 = 
	`diùG‘Key
(
de
);

144 
keyobj
 = 
	`ü—‹SŒšgObjeù
(
key
,
	`sd¦’
(key));

146 
	`mixDige¡
(
dige¡
,
key
,
	`sd¦’
(key));

148 
o
 = 
	`diùG‘V®
(
de
);

150 
aux
 = 
	`htÚl
(
o
->
ty³
);

151 
	`mixDige¡
(
dige¡
,&
aux
,(aux));

152 
expœ‘ime
 = 
	`g‘Expœe
(
db
,
keyobj
);

155 ià(
o
->
ty³
 =ğ
OBJ_STRING
) {

156 
	`mixObjeùDige¡
(
dige¡
,
o
);

157 } ià(
o
->
ty³
 =ğ
OBJ_LIST
) {

158 
li¡Ty³I‹¿tÜ
 *
li
 = 
	`li¡Ty³In™I‹¿tÜ
(
o
,0,
LIST_TAIL
);

159 
li¡Ty³EÁry
 
’Œy
;

160 
	`li¡Ty³Next
(
li
,&
’Œy
)) {

161 
robj
 *
–eobj
 = 
	`li¡Ty³G‘
(&
’Œy
);

162 
	`mixObjeùDige¡
(
dige¡
,
–eobj
);

163 
	`deüRefCouÁ
(
–eobj
);

165 
	`li¡Ty³R–—£I‹¿tÜ
(
li
);

166 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

167 
£tTy³I‹¿tÜ
 *
si
 = 
	`£tTy³In™I‹¿tÜ
(
o
);

168 
sds
 
sd£Ë
;

169 (
sd£Ë
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

170 
	`xÜDige¡
(
dige¡
,
sd£Ë
,
	`sd¦’
(sdsele));

171 
	`sdsä“
(
sd£Ë
);

173 
	`£tTy³R–—£I‹¿tÜ
(
si
);

174 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

175 
–edige¡
[20];

177 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

178 *
zl
 = 
o
->
±r
;

179 *
•Œ
, *
¥Œ
;

180 *
v¡r
;

181 
vËn
;

182 
vÎ
;

183 
scÜe
;

185 
•Œ
 = 
	`zli¡Index
(
zl
,0);

186 
	`£rv”As£¹
(
•Œ
 !ğ
NULL
);

187 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

188 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

190 
•Œ
 !ğ
NULL
) {

191 
	`£rv”As£¹
(
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vÎ
));

192 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

194 
	`mem£t
(
–edige¡
,0,20);

195 ià(
v¡r
 !ğ
NULL
) {

196 
	`mixDige¡
(
–edige¡
,
v¡r
,
vËn
);

198 
	`Î2¡ršg
(
buf
,(buf),
vÎ
);

199 
	`mixDige¡
(
–edige¡
,
buf
,
	`¡¾’
(buf));

202 
	`¢´štf
(
buf
,(buf),"%.17g",
scÜe
);

203 
	`mixDige¡
(
–edige¡
,
buf
,
	`¡¾’
(buf));

204 
	`xÜDige¡
(
dige¡
,
–edige¡
,20);

205 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

207 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

208 
z£t
 *
zs
 = 
o
->
±r
;

209 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
zs
->
diù
);

210 
diùEÁry
 *
de
;

212 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

213 
sds
 
sd£Ë
 = 
	`diùG‘Key
(
de
);

214 *
scÜe
 = 
	`diùG‘V®
(
de
);

216 
	`¢´štf
(
buf
,(buf),"%.17g",*
scÜe
);

217 
	`mem£t
(
–edige¡
,0,20);

218 
	`mixDige¡
(
–edige¡
,
sd£Ë
,
	`sd¦’
(sdsele));

219 
	`mixDige¡
(
–edige¡
,
buf
,
	`¡¾’
(buf));

220 
	`xÜDige¡
(
dige¡
,
–edige¡
,20);

222 
	`diùR–—£I‹¿tÜ
(
di
);

224 
	`£rv”Pªic
("Unknown sorted setƒncoding");

226 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

227 
hashTy³I‹¿tÜ
 *
hi
 = 
	`hashTy³In™I‹¿tÜ
(
o
);

228 
	`hashTy³Next
(
hi
è!ğ
C_ERR
) {

229 
–edige¡
[20];

230 
sds
 
sd£Ë
;

232 
	`mem£t
(
–edige¡
,0,20);

233 
sd£Ë
 = 
	`hashTy³Cu¼’tObjeùNewSds
(
hi
,
OBJ_HASH_KEY
);

234 
	`mixDige¡
(
–edige¡
,
sd£Ë
,
	`sd¦’
(sdsele));

235 
	`sdsä“
(
sd£Ë
);

236 
sd£Ë
 = 
	`hashTy³Cu¼’tObjeùNewSds
(
hi
,
OBJ_HASH_VALUE
);

237 
	`mixDige¡
(
–edige¡
,
sd£Ë
,
	`sd¦’
(sdsele));

238 
	`sdsä“
(
sd£Ë
);

239 
	`xÜDige¡
(
dige¡
,
–edige¡
,20);

241 
	`hashTy³R–—£I‹¿tÜ
(
hi
);

243 
	`£rv”Pªic
("Unknown objectype");

246 ià(
expœ‘ime
 !ğ-1è
	`xÜDige¡
(
dige¡
,"!!expire!!",10);

248 
	`xÜDige¡
(
fš®
,
dige¡
,20);

249 
	`deüRefCouÁ
(
keyobj
);

251 
	`diùR–—£I‹¿tÜ
(
di
);

253 
	}
}

255 
	$debugCommªd
(
ş›Á
 *
c
) {

256 ià(
c
->
¬gc
 == 1) {

257 
	`addR•lyE¼Ü
(
c
,"You must specify‡ subcommand for DEBUG. Try DEBUG HELP for info.");

261 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"help")) {

262 *
bËÅ
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

263 
bËn
 = 0;

264 
bËn
++; 
	`addR•lyStus
(
c
,

266 
bËn
++; 
	`addR•lyStus
(
c
,

268 
bËn
++; 
	`addR•lyStus
(
c
,

270 
bËn
++; 
	`addR•lyStus
(
c
,

272 
bËn
++; 
	`addR•lyStus
(
c
,

274 
bËn
++; 
	`addR•lyStus
(
c
,

276 
bËn
++; 
	`addR•lyStus
(
c
,

278 
bËn
++; 
	`addR•lyStus
(
c
,

280 
bËn
++; 
	`addR•lyStus
(
c
,

282 
bËn
++; 
	`addR•lyStus
(
c
,

284 
bËn
++; 
	`addR•lyStus
(
c
,

286 
bËn
++; 
	`addR•lyStus
(
c
,

288 
bËn
++; 
	`addR•lyStus
(
c
,

290 
bËn
++; 
	`addR•lyStus
(
c
,

292 
bËn
++; 
	`addR•lyStus
(
c
,

294 
bËn
++; 
	`addR•lyStus
(
c
,

296 
bËn
++; 
	`addR•lyStus
(
c
,

298 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
bËÅ
,
bËn
);

299 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"segfault")) {

301 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"restart") ||

302 !
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"crash-and-recover"))

304 
d–ay
 = 0;

305 ià(
c
->
¬gc
 >= 3) {

306 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
d–ay
, 
NULL
)

307 !ğ
C_OK
) ;

308 ià(
d–ay
 < 0) delay = 0;

310 
æags
 = !
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"restart") ?

311 (
RESTART_SERVER_GRACEFULLY
|
RESTART_SERVER_CONFIG_REWRITE
) :

312 
RESTART_SERVER_NONE
;

313 
	`»¡¬tS”v”
(
æags
,
d–ay
);

314 
	`addR•lyE¼Ü
(
c
,"failedo„estarthe server. Check server†ogs.");

315 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"oom")) {

316 *
±r
 = 
	`zm®loc
(
ULONG_MAX
);

317 
	`zä“
(
±r
);

318 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

319 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"assert")) {

320 ià(
c
->
¬gc
 >ğ3èc->
¬gv
[2] = 
	`ŒyObjeùEncodšg
(c->argv[2]);

321 
	`£rv”As£¹W™hInfo
(
c
,c->
¬gv
[0],1 == 2);

322 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"reload")) {

323 ià(
	`rdbSave
(
£rv”
.
rdb_f’ame
è!ğ
C_OK
) {

324 
	`addR•ly
(
c
,
sh¬ed
.
”r
);

327 
	`em±yDb
(-1,
EMPTYDB_NO_FLAGS
,
NULL
);

328 ià(
	`rdbLßd
(
£rv”
.
rdb_f’ame
è!ğ
C_OK
) {

329 
	`addR•lyE¼Ü
(
c
,"Errorryingo†oadhe RDB dump");

332 
	`£rv”Log
(
LL_WARNING
,"DB„eloaded by DEBUG RELOAD");

333 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

334 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"loadaof")) {

335 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_ON
è
	`æushAµ’dOÆyFe
(1);

336 
	`em±yDb
(-1,
EMPTYDB_NO_FLAGS
,
NULL
);

337 ià(
	`lßdAµ’dOÆyFe
(
£rv”
.
aof_f’ame
è!ğ
C_OK
) {

338 
	`addR•ly
(
c
,
sh¬ed
.
”r
);

341 
£rv”
.
dœty
 = 0;

342 
	`£rv”Log
(
LL_WARNING
,"Append Only File†oaded by DEBUG LOADAOF");

343 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

344 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"objeù"è&& c->
¬gc
 == 3) {

345 
diùEÁry
 *
de
;

346 
robj
 *
v®
;

347 *
¡»nc
;

349 ià((
de
 = 
	`diùFšd
(
c
->
db
->
diù
,c->
¬gv
[2]->
±r
)è=ğ
NULL
) {

350 
	`addR•ly
(
c
,
sh¬ed
.
nokey”r
);

353 
v®
 = 
	`diùG‘V®
(
de
);

354 
¡»nc
 = 
	`¡rEncodšg
(
v®
->
’codšg
);

356 
exŒa
[128] = {0};

357 ià(
v®
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

358 *
ÃxŒa
 = 
exŒa
;

359 
»maššg
 = (
exŒa
);

360 
quickli¡
 *
ql
 = 
v®
->
±r
;

362 
u£d
 = 
	`¢´štf
(
ÃxŒa
, 
»maššg
, " ql_nodes:%u", 
ql
->
Ën
);

363 
ÃxŒa
 +ğ
u£d
;

364 
»maššg
 -ğ
u£d
;

366 
avg
 = ()
ql
->
couÁ
/ql->
Ën
;

367 
u£d
 = 
	`¢´štf
(
ÃxŒa
, 
»maššg
, " ql_avg_node:%.2f", 
avg
);

368 
ÃxŒa
 +ğ
u£d
;

369 
»maššg
 -ğ
u£d
;

371 
u£d
 = 
	`¢´štf
(
ÃxŒa
, 
»maššg
, " ql_zli¡_max:%d", 
ql
->
fl
);

372 
ÃxŒa
 +ğ
u£d
;

373 
»maššg
 -ğ
u£d
;

375 
com´es£d
 = 
ql
->
com´ess
 != 0;

376 
u£d
 = 
	`¢´štf
(
ÃxŒa
, 
»maššg
, " ql_com´es£d:%d", 
com´es£d
);

377 
ÃxŒa
 +ğ
u£d
;

378 
»maššg
 -ğ
u£d
;

380 
sz
 = 0;

381 
quickli¡Node
 *
node
 = 
ql
->
h—d
;‚ode;‚odğnode->
Ãxt
) {

382 
sz
 +ğ
node
->sz;

384 
u£d
 = 
	`¢´štf
(
ÃxŒa
, 
»maššg
, " ql_uncom´es£d_size:%lu", 
sz
);

385 
ÃxŒa
 +ğ
u£d
;

386 
»maššg
 -ğ
u£d
;

389 
	`addR•lyStusFÜm©
(
c
,

393 (*)
v®
, v®->
»fcouÁ
,

394 
¡»nc
, 
	`rdbSavedObjeùL’
(
v®
),

395 
v®
->
Ìu
, 
	`e¡im©eObjeùIdËTime
(v®)/1000, 
exŒa
);

396 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"sd¦’"è&& c->
¬gc
 == 3) {

397 
diùEÁry
 *
de
;

398 
robj
 *
v®
;

399 
sds
 
key
;

401 ià((
de
 = 
	`diùFšd
(
c
->
db
->
diù
,c->
¬gv
[2]->
±r
)è=ğ
NULL
) {

402 
	`addR•ly
(
c
,
sh¬ed
.
nokey”r
);

405 
v®
 = 
	`diùG‘V®
(
de
);

406 
key
 = 
	`diùG‘Key
(
de
);

408 ià(
v®
->
ty³
 !ğ
OBJ_STRING
 || !
	`sdsEncodedObjeù
(val)) {

409 
	`addR•lyE¼Ü
(
c
,"Not‡n sdsƒncoded string.");

411 
	`addR•lyStusFÜm©
(
c
,

414 (è
	`sd¦’
(
key
),

415 (è
	`sd§va
(
key
),

416 (è
	`sdsZm®locSize
(
key
),

417 (è
	`sd¦’
(
v®
->
±r
),

418 (è
	`sd§va
(
v®
->
±r
),

419 (è
	`g‘SŒšgObjeùSdsU£dMemÜy
(
v®
));

421 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"populate") &&

422 (
c
->
¬gc
 == 3 || c->argc == 4)) {

423 
keys
, 
j
;

424 
robj
 *
key
, *
v®
;

425 
buf
[128];

427 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
keys
, 
NULL
è!ğ
C_OK
)

429 
	`diùEx·nd
(
c
->
db
->
diù
,
keys
);

430 
j
 = 0; j < 
keys
; j++) {

431 
	`¢´štf
(
buf
,(buf),"%s:%lu",

432 (
c
->
¬gc
 =ğ3è? "key" : (*)c->
¬gv
[3]->
±r
, 
j
);

433 
key
 = 
	`ü—‹SŒšgObjeù
(
buf
,
	`¡¾’
(buf));

434 ià(
	`lookupKeyWr™e
(
c
->
db
,
key
è!ğ
NULL
) {

435 
	`deüRefCouÁ
(
key
);

438 
	`¢´štf
(
buf
,(buf),"v®ue:%lu",
j
);

439 
v®
 = 
	`ü—‹SŒšgObjeù
(
buf
,
	`¡¾’
(buf));

440 
	`dbAdd
(
c
->
db
,
key
,
v®
);

441 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

442 
	`deüRefCouÁ
(
key
);

444 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

445 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"dige¡"è&& c->
¬gc
 == 2) {

446 
dige¡
[20];

447 
sds
 
d
 = 
	`sd£m±y
();

448 
j
;

450 
	`compu‹D©a£tDige¡
(
dige¡
);

451 
j
 = 0; j < 20; j++)

452 
d
 = 
	`sdsÿrštf
(d, "%02x",
dige¡
[
j
]);

453 
	`addR•lyStus
(
c
,
d
);

454 
	`sdsä“
(
d
);

455 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"¦“p"è&& c->
¬gc
 == 3) {

456 
dtime
 = 
	`¡¹od
(
c
->
¬gv
[2]->
±r
,
NULL
);

457 
utime
 = 
dtime
*1000000;

458 
time¥ec
 
tv
;

460 
tv
.
tv_£c
 = 
utime
 / 1000000;

461 
tv
.
tv_n£c
 = (
utime
 % 1000000) * 1000;

462 
	`Çno¦“p
(&
tv
, 
NULL
);

463 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

464 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"set-active-expire") &&

465 
c
->
¬gc
 == 3)

467 
£rv”
.
aùive_expœe_’abËd
 = 
	`©oi
(
c
->
¬gv
[2]->
±r
);

468 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

469 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"lua-always-replicate-commands") &&

470 
c
->
¬gc
 == 3)

472 
£rv”
.
lua_®ways_»¶iÿ‹_commªds
 = 
	`©oi
(
c
->
¬gv
[2]->
±r
);

473 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

474 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"”rÜ"è&& c->
¬gc
 == 3) {

475 
sds
 
”r¡r
 = 
	`sd¢ewËn
("-",1);

477 
”r¡r
 = 
	`sdsÿtsds
Ó¼¡r,
c
->
¬gv
[2]->
±r
);

478 
”r¡r
 = 
	`sdsm­ch¬s
(errstr,"\n\r"," ",2);

479 
”r¡r
 = 
	`sdsÿ’
(errstr,"\r\n",2);

480 
	`addR•lySds
(
c
,
”r¡r
);

481 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"¡ruùsize"è&& c->
¬gc
 == 2) {

482 
sds
 
sizes
 = 
	`sd£m±y
();

483 
sizes
 = 
	`sdsÿrštf
(sizes,"bits:%d ",((*) == 8)?64:32);

484 
sizes
 = 
	`sdsÿrštf
(sizes,"robj:%d ",()(
robj
));

485 
sizes
 = 
	`sdsÿrštf
(sizes,"diù’Œy:%d ",()(
diùEÁry
));

486 
sizes
 = 
	`sdsÿrštf
(sizes,"sdshdr5:%d ",()(
sdshdr5
));

487 
sizes
 = 
	`sdsÿrštf
(sizes,"sdshdr8:%d ",()(
sdshdr8
));

488 
sizes
 = 
	`sdsÿrštf
(sizes,"sdshdr16:%d ",()(
sdshdr16
));

489 
sizes
 = 
	`sdsÿrštf
(sizes,"sdshdr32:%d ",()(
sdshdr32
));

490 
sizes
 = 
	`sdsÿrštf
(sizes,"sdshdr64:%d ",()(
sdshdr64
));

491 
	`addR•lyBulkSds
(
c
,
sizes
);

492 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"ht¡©s"è&& c->
¬gc
 == 3) {

493 
dbid
;

494 
sds
 
¡©s
 = 
	`sd£m±y
();

495 
buf
[4096];

497 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
dbid
, 
NULL
è!ğ
C_OK
)

499 ià(
dbid
 < 0 || dbid >ğ
£rv”
.
dbnum
) {

500 
	`addR•lyE¼Ü
(
c
,"Out of„ange database");

504 
¡©s
 = 
	`sdsÿrštf
(stats,"[Dictionary HT]\n");

505 
	`diùG‘Sts
(
buf
,(buf),
£rv”
.
db
[
dbid
].
diù
);

506 
¡©s
 = 
	`sdsÿt
(¡©s,
buf
);

508 
¡©s
 = 
	`sdsÿrštf
(stats,"[Expires HT]\n");

509 
	`diùG‘Sts
(
buf
,(buf),
£rv”
.
db
[
dbid
].
expœes
);

510 
¡©s
 = 
	`sdsÿt
(¡©s,
buf
);

512 
	`addR•lyBulkSds
(
c
,
¡©s
);

514 
	`addR•lyE¼ÜFÜm©
(
c
, "Unknown DEBUG subcommand or wrong‚umber of‡rguments for '%s'",

515 (*)
c
->
¬gv
[1]->
±r
);

517 
	}
}

521 
	$_£rv”As£¹
(cÚ¡ *
e¡r
, cÚ¡ *
fe
, 
lše
) {

522 
	`bugR•ÜtS¹
();

523 
	`£rv”Log
(
LL_WARNING
,"=== ASSERTION FAILED ===");

524 
	`£rv”Log
(
LL_WARNING
,"==> %s:%d '%s' i nÙrue",
fe
,
lše
,
e¡r
);

525 #ifdeà
HAVE_BACKTRACE


526 
£rv”
.
as£¹_çed
 = 
e¡r
;

527 
£rv”
.
as£¹_fe
 = 
fe
;

528 
£rv”
.
as£¹_lše
 = 
lše
;

529 
	`£rv”Log
(
LL_WARNING
,"(forcing SIGSEGVo…rinthe bug„eport.)");

532 
	}
}

534 
	$_£rv”As£¹PrštCl›ÁInfo
(cÚ¡ 
ş›Á
 *
c
) {

535 
j
;

537 
	`bugR•ÜtS¹
();

538 
	`£rv”Log
(
LL_WARNING
,"=== ASSERTION FAILED CLIENT CONTEXT ===");

539 
	`£rv”Log
(
LL_WARNING
,"ş›Á->æag ğ%d", 
c
->
æags
);

540 
	`£rv”Log
(
LL_WARNING
,"ş›Á->fd = %d", 
c
->
fd
);

541 
	`£rv”Log
(
LL_WARNING
,"ş›Á->¬gøğ%d", 
c
->
¬gc
);

542 
j
=0; j < 
c
->
¬gc
; j++) {

543 
buf
[128];

544 *
¬g
;

546 ià(
c
->
¬gv
[
j
]->
ty³
 =ğ
OBJ_STRING
 && 
	`sdsEncodedObjeù
(c->argv[j])) {

547 
¬g
 = (*è
c
->
¬gv
[
j
]->
±r
;

549 
	`¢´štf
(
buf
,(buf),"Objectype: %u,ƒncoding: %u",

550 
c
->
¬gv
[
j
]->
ty³
, c->¬gv[j]->
’codšg
);

551 
¬g
 = 
buf
;

553 
	`£rv”Log
(
LL_WARNING
,"client->argv[%d] = \"%s\" (refcount: %d)",

554 
j
, 
¬g
, 
c
->
¬gv
[j]->
»fcouÁ
);

556 
	}
}

558 
	$£rv”LogObjeùDebugInfo
(cÚ¡ 
robj
 *
o
) {

559 
	`£rv”Log
(
LL_WARNING
,"Objeùy³: %d", 
o
->
ty³
);

560 
	`£rv”Log
(
LL_WARNING
,"Objeùƒncodšg: %d", 
o
->
’codšg
);

561 
	`£rv”Log
(
LL_WARNING
,"Objeù„efcouÁ: %d", 
o
->
»fcouÁ
);

562 ià(
o
->
ty³
 =ğ
OBJ_STRING
 && 
	`sdsEncodedObjeù
(o)) {

563 
	`£rv”Log
(
LL_WARNING
,"Objeù„aw sŒšg†’: %zu", 
	`sd¦’
(
o
->
±r
));

564 ià(
	`sd¦’
(
o
->
±r
) < 4096) {

565 
sds
 
»´
 = 
	`sdsÿŒ•r
(
	`sd£m±y
(),
o
->
±r
,
	`sd¦’
(o->ptr));

566 
	`£rv”Log
(
LL_WARNING
,"Objeù„aw sŒšg cÚ‹Á: %s", 
»´
);

567 
	`sdsä“
(
»´
);

569 } ià(
o
->
ty³
 =ğ
OBJ_LIST
) {

570 
	`£rv”Log
(
LL_WARNING
,"Li¡†’gth: %d", (è
	`li¡Ty³L’gth
(
o
));

571 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

572 
	`£rv”Log
(
LL_WARNING
,"S‘ size: %d", (è
	`£tTy³Size
(
o
));

573 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

574 
	`£rv”Log
(
LL_WARNING
,"Hash size: %d", (è
	`hashTy³L’gth
(
o
));

575 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

576 
	`£rv”Log
(
LL_WARNING
,"SÜ‹d s‘ size: %d", (è
	`z£tL’gth
(
o
));

577 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
)

578 
	`£rv”Log
(
LL_WARNING
,"Skli¡†ev–: %d", (è((cÚ¡ 
z£t
*)
o
->
±r
)->
z¦
->
Ëv–
);

580 
	}
}

582 
	$_£rv”As£¹PrštObjeù
(cÚ¡ 
robj
 *
o
) {

583 
	`bugR•ÜtS¹
();

584 
	`£rv”Log
(
LL_WARNING
,"=== ASSERTION FAILED OBJECT CONTEXT ===");

585 
	`£rv”LogObjeùDebugInfo
(
o
);

586 
	}
}

588 
	$_£rv”As£¹W™hInfo
(cÚ¡ 
ş›Á
 *
c
, cÚ¡ 
robj
 *
o
, cÚ¡ *
e¡r
, cÚ¡ *
fe
, 
lše
) {

589 ià(
c
è
	`_£rv”As£¹PrštCl›ÁInfo
(c);

590 ià(
o
è
	`_£rv”As£¹PrštObjeù
(o);

591 
	`_£rv”As£¹
(
e¡r
,
fe
,
lše
);

592 
	}
}

594 
	$_£rv”Pªic
(cÚ¡ *
msg
, cÚ¡ *
fe
, 
lše
) {

595 
	`bugR•ÜtS¹
();

596 
	`£rv”Log
(
LL_WARNING
,"------------------------------------------------");

597 
	`£rv”Log
(
LL_WARNING
,"!!! Software Failure. Press†eft mouse buttono continue");

598 
	`£rv”Log
(
LL_WARNING
,"Guru Med™©iÚ: % #%s:%d",
msg
,
fe
,
lše
);

599 #ifdeà
HAVE_BACKTRACE


600 
	`£rv”Log
(
LL_WARNING
,"(forcing SIGSEGV in ordero…rinthe stackrace)");

602 
	`£rv”Log
(
LL_WARNING
,"------------------------------------------------");

604 
	}
}

606 
	$bugR•ÜtS¹
() {

607 ià(
£rv”
.
bug_»pÜt_¡¬t
 == 0) {

608 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
,

610 
£rv”
.
bug_»pÜt_¡¬t
 = 1;

612 
	}
}

614 #ifdeà
HAVE_BACKTRACE


615 *
	$g‘McÚ‹xtE
(
ucÚ‹xt_t
 *
uc
) {

616 #ià
	`defšed
(
__APPLE__
è&& !defšed(
MAC_OS_X_VERSION_10_6
)

618 #ià
	`defšed
(
__x86_64__
)

619  (*è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r
;

620 #–ià
	`defšed
(
__i386__
)

621  (*è
uc
->
uc_mcÚ‹xt
->
__ss
.
__e
;

623  (*è
uc
->
uc_mcÚ‹xt
->
__ss
.
__¤r0
;

625 #–ià
	`defšed
(
__APPLE__
è&& defšed(
MAC_OS_X_VERSION_10_6
)

627 #ià
	`defšed
(
_STRUCT_X86_THREAD_STATE64
è&& !defšed(
__i386__
)

628  (*è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r
;

630  (*è
uc
->
uc_mcÚ‹xt
->
__ss
.
__e
;

632 #–ià
	`defšed
(
__lšux__
)

634 #ià
	`defšed
(
__i386__
)

635  (*è
uc
->
uc_mcÚ‹xt
.
g»gs
[14];

636 #–ià
	`defšed
(
__X86_64__
è|| defšed(
__x86_64__
)

637  (*è
uc
->
uc_mcÚ‹xt
.
g»gs
[16];

638 #–ià
	`defšed
(
__Ÿ64__
)

639  (*è
uc
->
uc_mcÚ‹xt
.
sc_
;

640 #–ià
	`defšed
(
__¬m__
)

641  (*è
uc
->
uc_mcÚ‹xt
.
¬m_pc
;

644  
NULL
;

646 
	}
}

648 
	$logSckCÚ‹Á
(**
¥
) {

649 
i
;

650 
i
 = 15; i >= 0; i--) {

651 
addr
 = (è
¥
+
i
;

652 
v®
 = (è
¥
[
i
];

655 
	`£rv”Log
(
LL_WARNING
, "(%08lxè-> %08lx", 
addr
, 
v®
);

657 
	`£rv”Log
(
LL_WARNING
, "(%016lxè-> %016lx", 
addr
, 
v®
);

659 
	}
}

661 
	$logRegi¡”s
(
ucÚ‹xt_t
 *
uc
) {

662 
	`£rv”Log
(
LL_WARNING
|
LL_RAW
, "\n------ REGISTERS ------\n");

665 #ià
	`defšed
(
__APPLE__
è&& defšed(
MAC_OS_X_VERSION_10_6
)

667 #ià
	`defšed
(
_STRUCT_X86_THREAD_STATE64
è&& !defšed(
__i386__
)

668 
	`£rv”Log
(
LL_WARNING
,

675 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__¿x
,

676 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rbx
,

677 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rcx
,

678 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rdx
,

679 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rdi
,

680 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rsi
,

681 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__rbp
,

682 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r¥
,

683 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r8
,

684 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r9
,

685 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r10
,

686 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r11
,

687 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r12
,

688 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r13
,

689 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r14
,

690 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r15
,

691 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__r
,

692 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__ræags
,

693 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__cs
,

694 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__fs
,

695 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__gs


697 
	`logSckCÚ‹Á
((**)
uc
->
uc_mcÚ‹xt
->
__ss
.
__r¥
);

700 
	`£rv”Log
(
LL_WARNING
,

706 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__—x
,

707 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__ebx
,

708 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__ecx
,

709 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__edx
,

710 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__edi
,

711 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__esi
,

712 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__ebp
,

713 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__e¥
,

714 (è
uc
->
uc_mcÚ‹xt
->
__ss
.__ss,

715 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__eæags
,

716 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__e
,

717 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__cs
,

718 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__ds
,

719 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__es
,

720 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__fs
,

721 (è
uc
->
uc_mcÚ‹xt
->
__ss
.
__gs


723 
	`logSckCÚ‹Á
((**)
uc
->
uc_mcÚ‹xt
->
__ss
.
__e¥
);

726 #–ià
	`defšed
(
__lšux__
)

728 #ià
	`defšed
(
__i386__
)

729 
	`£rv”Log
(
LL_WARNING
,

735 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[11],

736 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[8],

737 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[10],

738 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[9],

739 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[4],

740 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[5],

741 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[6],

742 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[7],

743 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[18],

744 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[17],

745 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[14],

746 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[15],

747 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[3],

748 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[2],

749 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[1],

750 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[0]

752 
	`logSckCÚ‹Á
((**)
uc
->
uc_mcÚ‹xt
.
g»gs
[7]);

753 #–ià
	`defšed
(
__X86_64__
è|| defšed(
__x86_64__
)

755 
	`£rv”Log
(
LL_WARNING
,

762 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[13],

763 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[11],

764 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[14],

765 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[12],

766 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[8],

767 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[9],

768 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[10],

769 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[15],

770 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[0],

771 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[1],

772 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[2],

773 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[3],

774 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[4],

775 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[5],

776 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[6],

777 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[7],

778 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[16],

779 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[17],

780 (è
uc
->
uc_mcÚ‹xt
.
g»gs
[18]

782 
	`logSckCÚ‹Á
((**)
uc
->
uc_mcÚ‹xt
.
g»gs
[15]);

785 
	`£rv”Log
(
LL_WARNING
,

788 
	}
}

796 
	$İ’DœeùLogFedes
() {

797 
log_to_¡dout
 = 
£rv”
.
logfe
[0] == '\0';

798 
fd
 = 
log_to_¡dout
 ?

799 
STDOUT_FILENO
 :

800 
	`İ’
(
£rv”
.
logfe
, 
O_APPEND
|
O_CREAT
|
O_WRONLY
, 0644);

801  
fd
;

802 
	}
}

805 
	$şo£DœeùLogFedes
(
fd
) {

806 
log_to_¡dout
 = 
£rv”
.
logfe
[0] == '\0';

807 ià(!
log_to_¡dout
è
	`şo£
(
fd
);

808 
	}
}

812 
	$logSckT¿û
(
ucÚ‹xt_t
 *
uc
) {

813 *
Œaû
[101];

814 
Œaû_size
 = 0, 
fd
 = 
	`İ’DœeùLogFedes
();

816 ià(
fd
 == -1) ;

819 
Œaû_size
 = 
	`backŒaû
(
Œaû
+1, 100);

821 ià(
	`g‘McÚ‹xtE
(
uc
è!ğ
NULL
) {

822 *
msg1
 = "EIP:\n";

823 *
msg2
 = "\nBacktrace:\n";

824 ià(
	`wr™e
(
fd
,
msg1
,
	`¡¾’
(msg1)) == -1) { };

825 
Œaû
[0] = 
	`g‘McÚ‹xtE
(
uc
);

826 
	`backŒaû_symbŞs_fd
(
Œaû
, 1, 
fd
);

827 ià(
	`wr™e
(
fd
,
msg2
,
	`¡¾’
(msg2)) == -1) { };

831 
	`backŒaû_symbŞs_fd
(
Œaû
+1, 
Œaû_size
, 
fd
);

834 
	`şo£DœeùLogFedes
(
fd
);

835 
	}
}

840 
	$logCu¼’tCl›Á
() {

841 ià(
£rv”
.
cu¼’t_ş›Á
 =ğ
NULL
) ;

843 
ş›Á
 *
cc
 = 
£rv”
.
cu¼’t_ş›Á
;

844 
sds
 
ş›Á
;

845 
j
;

847 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, "\n------ CURRENT CLIENT INFO ------\n");

848 
ş›Á
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
cc
);

849 
	`£rv”Log
(
LL_WARNING
|
LL_RAW
,"%s\n", 
ş›Á
);

850 
	`sdsä“
(
ş›Á
);

851 
j
 = 0; j < 
cc
->
¬gc
; j++) {

852 
robj
 *
decoded
;

854 
decoded
 = 
	`g‘DecodedObjeù
(
cc
->
¬gv
[
j
]);

855 
	`£rv”Log
(
LL_WARNING
|
LL_RAW
,"¬gv[%d]: '%s'\n", 
j
,

856 (*)
decoded
->
±r
);

857 
	`deüRefCouÁ
(
decoded
);

861 ià(
cc
->
¬gc
 >= 1) {

862 
robj
 *
v®
, *
key
;

863 
diùEÁry
 *
de
;

865 
key
 = 
	`g‘DecodedObjeù
(
cc
->
¬gv
[1]);

866 
de
 = 
	`diùFšd
(
cc
->
db
->
diù
, 
key
->
±r
);

867 ià(
de
) {

868 
v®
 = 
	`diùG‘V®
(
de
);

869 
	`£rv”Log
(
LL_WARNING
,"key '%s' found iÀDB cÚššghfŞlowšg objeù:", (*)
key
->
±r
);

870 
	`£rv”LogObjeùDebugInfo
(
v®
);

872 
	`deüRefCouÁ
(
key
);

874 
	}
}

876 #ià
defšed
(
HAVE_PROC_MAPS
)

878 
	#MEMTEST_MAX_REGIONS
 128

	)

881 
	$mem‹¡_‹¡_lšux_ªÚymous_m­s
() {

882 
FILE
 *
å
;

883 
lše
[1024];

884 
logbuf
[1024];

885 
size_t
 
¡¬t_addr
, 
’d_addr
, 
size
;

886 
size_t
 
¡¬t_veù
[
MEMTEST_MAX_REGIONS
];

887 
size_t
 
size_veù
[
MEMTEST_MAX_REGIONS
];

888 
»giÚs
 = 0, 
j
;

890 
fd
 = 
	`İ’DœeùLogFedes
();

891 ià(!
fd
)  0;

893 
å
 = 
	`fİ’
("/proc/self/maps","r");

894 ià(!
å
)  0;

895 
	`fg‘s
(
lše
,Öše),
å
è!ğ
NULL
) {

896 *
¡¬t
, *
’d
, *
p
 = 
lše
;

898 
¡¬t
 = 
p
;

899 
p
 = 
	`¡rchr
(p,'-');

900 ià(!
p
) ;

901 *
p
++ = '\0';

902 
’d
 = 
p
;

903 
p
 = 
	`¡rchr
(p,' ');

904 ià(!
p
) ;

905 *
p
++ = '\0';

906 ià(
	`¡r¡r
(
p
,"stack") ||

907 
	`¡r¡r
(
p
,"vdso") ||

908 
	`¡r¡r
(
p
,"vsyscall")) ;

909 ià(!
	`¡r¡r
(
p
,"00:00")) ;

910 ià(!
	`¡r¡r
(
p
,"rw")) ;

912 
¡¬t_addr
 = 
	`¡¹oul
(
¡¬t
,
NULL
,16);

913 
’d_addr
 = 
	`¡¹oul
(
’d
,
NULL
,16);

914 
size
 = 
’d_addr
-
¡¬t_addr
;

916 
¡¬t_veù
[
»giÚs
] = 
¡¬t_addr
;

917 
size_veù
[
»giÚs
] = 
size
;

918 
	`¢´štf
(
logbuf
,(logbuf),

920 (è
¡¬t_veù
[
»giÚs
],

921 (è
size_veù
[
»giÚs
]);

922 ià(
	`wr™e
(
fd
,
logbuf
,
	`¡¾’
(logbuf)) == -1) { }

923 
»giÚs
++;

926 
”rÜs
 = 0;

927 
j
 = 0; j < 
»giÚs
; j++) {

928 ià(
	`wr™e
(
fd
,".",1) == -1) { }

929 
”rÜs
 +ğ
	`mem‹¡_´e£rvšg_‹¡
((*)
¡¬t_veù
[
j
],
size_veù
[j],1);

930 ià(
	`wr™e
(
fd
, 
”rÜs
 ? "E" : "O",1) == -1) { }

932 ià(
	`wr™e
(
fd
,"\n",1) == -1) { }

937 
	`fşo£
(
å
);

938 
	`şo£DœeùLogFedes
(
fd
);

939  
”rÜs
;

940 
	}
}

946 
	$dumpX86C®ls
(*
addr
, 
size_t
 
Ën
) {

947 
size_t
 
j
;

948 *
p
 = 
addr
;

949 
Dl_šfo
 
šfo
;

952 
ht
[256] = {0};

954 ià(
Ën
 < 5) ;

955 
j
 = 0; j < 
Ën
-4; j++) {

956 ià(
p
[
j
] != 0xE8) ;

957 
rg‘
 = ()
addr
+
j
+5;

958 
rg‘
 +ğ*((
št32_t
*)(
p
+
j
+1));

959 ià(
	`dÏddr
((*)
rg‘
, &
šfo
è!ğ0 && info.
dli_¢ame
 !ğ
NULL
) {

960 ià(
ht
[
rg‘
&0xff] !=arget) {

961 
	`´štf
("FunùiÚ‡ˆ0x%lx i %s\n",
rg‘
,
šfo
.
dli_¢ame
);

962 
ht
[
rg‘
&0xff] =arget;

964 
j
 += 4;

967 
	}
}

969 
	$sig£gvHªdËr
(
sig
, 
sigšfo_t
 *
šfo
, *
£ü‘
) {

970 
ucÚ‹xt_t
 *
uc
 = (ucÚ‹xt_t*è
£ü‘
;

971 *
e
 = 
	`g‘McÚ‹xtE
(
uc
);

972 
sds
 
šfo¡ršg
, 
ş›Ás
;

973 
sigaùiÚ
 
aù
;

974 
	`UNUSED
(
šfo
);

976 
	`bugR•ÜtS¹
();

977 
	`£rv”Log
(
LL_WARNING
,

978 "Redi % üashed by sigÇl: %d", 
REDIS_VERSION
, 
sig
);

979 ià(
e
 !ğ
NULL
) {

980 
	`£rv”Log
(
LL_WARNING
,

981 "C¿shed„uÂšghš¡uùiÚ‡t: %p", 
e
);

983 ià(
sig
 =ğ
SIGSEGV
 || sig =ğ
SIGBUS
) {

984 
	`£rv”Log
(
LL_WARNING
,

985 "Acûssšg‡dd»ss: %p", (*)
šfo
->
si_addr
);

987 
	`£rv”Log
(
LL_WARNING
,

988 "Faed‡s£¹iÚ: % (%s:%d)", 
£rv”
.
as£¹_çed
,

989 
£rv”
.
as£¹_fe
, s”v”.
as£¹_lše
);

992 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, "\n------ STACK TRACE ------\n");

993 
	`logSckT¿û
(
uc
);

996 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, "\n------ INFO OUTPUT ------\n");

997 
šfo¡ršg
 = 
	`g’RedisInfoSŒšg
("all");

998 
šfo¡ršg
 = 
	`sdsÿrštf
(infostring, "hash_init_value: %u\n",

999 
	`diùG‘HashFunùiÚS“d
());

1000 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, 
šfo¡ršg
);

1001 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, "\n------ CLIENT LIST OUTPUT ------\n");

1002 
ş›Ás
 = 
	`g‘AÎCl›ÁsInfoSŒšg
();

1003 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, 
ş›Ás
);

1004 
	`sdsä“
(
šfo¡ršg
);

1005 
	`sdsä“
(
ş›Ás
);

1008 
	`logCu¼’tCl›Á
();

1011 
	`logRegi¡”s
(
uc
);

1013 #ià
	`defšed
(
HAVE_PROC_MAPS
)

1015 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
, "\n------ FAST MEMORY TEST ------\n");

1016 
	`bioKlTh»ads
();

1017 ià(
	`mem‹¡_‹¡_lšux_ªÚymous_m­s
()) {

1018 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
,

1021 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
,

1026 ià(
e
 !ğ
NULL
) {

1027 
Dl_šfo
 
šfo
;

1028 ià(
	`dÏddr
(
e
, &
šfo
) != 0) {

1029 
	`£rv”Log
(
LL_WARNING
|
LL_RAW
,

1036 
šfo
.
dli_¢ame
, info.
dli_§ddr
, info.
dli_âame
, info.
dli_fba£
,

1037 
šfo
.
dli_§ddr
);

1038 
size_t
 
Ën
 = ()
e
 - ()
šfo
.
dli_§ddr
;

1039 
sz
 = 
	`syscÚf
(
_SC_PAGESIZE
);

1040 ià(
Ën
 < 1<<13) {

1044 
Ãxt
 = (()
e
 + 
sz
) & ~(sz-1);

1045 
’d
 = ()
e
 + 128;

1046 ià(
’d
 > 
Ãxt
)ƒnd =‚ext;

1047 
Ën
 = 
’d
 - ()
šfo
.
dli_§ddr
;

1048 
	`£rv”LogHexDump
(
LL_WARNING
, "dump of function",

1049 
šfo
.
dli_§ddr
 ,
Ën
);

1050 
	`dumpX86C®ls
(
šfo
.
dli_§ddr
,
Ën
);

1055 
	`£rv”LogRaw
(
LL_WARNING
|
LL_RAW
,

1063 ià(
£rv”
.
d«mÚize
 && s”v”.
su³rvi£d
 =ğ0è
	`uÆšk
(£rv”.
pidfe
);

1067 
	`sigem±y£t
 (&
aù
.
§_mask
);

1068 
aù
.
§_æags
 = 
SA_NODEFER
 | 
SA_ONSTACK
 | 
SA_RESETHAND
;

1069 
aù
.
§_hªdËr
 = 
SIG_DFL
;

1070 
	`sigaùiÚ
 (
sig
, &
aù
, 
NULL
);

1071 
	`kl
(
	`g‘pid
(),
sig
);

1072 
	}
}

1077 
	$£rv”LogHexDump
(
Ëv–
, *
desü
, *
v®ue
, 
size_t
 
Ën
) {

1078 
buf
[65], *
b
;

1079 *
v
 = 
v®ue
;

1080 
ch¬£t
[] = "0123456789abcdef";

1082 
	`£rv”Log
(
Ëv–
,"% (hexdum°oà%zu by‹s):", 
desü
, 
Ën
);

1083 
b
 = 
buf
;

1084 
Ën
) {

1085 
b
[0] = 
ch¬£t
[(*
v
)>>4];

1086 
b
[1] = 
ch¬£t
[(*
v
)&0xf];

1087 
b
[2] = '\0';

1088 
b
 += 2;

1089 
Ën
--;

1090 
v
++;

1091 ià(
b
-
buf
 =ğ64 || 
Ën
 == 0) {

1092 
	`£rv”LogRaw
(
Ëv–
|
LL_RAW
,
buf
);

1093 
b
 = 
buf
;

1096 
	`£rv”LogRaw
(
Ëv–
|
LL_RAW
,"\n");

1097 
	}
}

1100 
	~<sys/time.h
>

1102 
	$w©chdogSigÇlHªdËr
(
sig
, 
sigšfo_t
 *
šfo
, *
£ü‘
) {

1103 #ifdeà
HAVE_BACKTRACE


1104 
ucÚ‹xt_t
 *
uc
 = (ucÚ‹xt_t*è
£ü‘
;

1106 
	`UNUSED
(
šfo
);

1107 
	`UNUSED
(
sig
);

1109 
	`£rv”LogFromHªdËr
(
LL_WARNING
,"\n--- WATCHDOG TIMER EXPIRED ---");

1110 #ifdeà
HAVE_BACKTRACE


1111 
	`logSckT¿û
(
uc
);

1113 
	`£rv”LogFromHªdËr
(
LL_WARNING
,"Sorry:‚o support for backtrace().");

1115 
	`£rv”LogFromHªdËr
(
LL_WARNING
,"--------\n");

1116 
	}
}

1121 
	$w©chdogScheduËSigÇl
(
³riod
) {

1122 
™im”v®
 
™
;

1125 
™
.
™_v®ue
.
tv_£c
 = 
³riod
/1000;

1126 
™
.
™_v®ue
.
tv_u£c
 = (
³riod
%1000)*1000;

1128 
™
.
™_š‹rv®
.
tv_£c
 = 0;

1129 
™
.
™_š‹rv®
.
tv_u£c
 = 0;

1130 
	`£t™im”
(
ITIMER_REAL
, &
™
, 
NULL
);

1131 
	}
}

1134 
	$’abËW©chdog
(
³riod
) {

1135 
mš_³riod
;

1137 ià(
£rv”
.
w©chdog_³riod
 == 0) {

1138 
sigaùiÚ
 
aù
;

1142 
	`sigem±y£t
(&
aù
.
§_mask
);

1143 
aù
.
§_æags
 = 
SA_ONSTACK
 | 
SA_SIGINFO
;

1144 
aù
.
§_sigaùiÚ
 = 
w©chdogSigÇlHªdËr
;

1145 
	`sigaùiÚ
(
SIGALRM
, &
aù
, 
NULL
);

1150 
mš_³riod
 = (1000/
£rv”
.
hz
)*2;

1151 ià(
³riod
 < 
mš_³riod
)…eriod = min_period;

1152 
	`w©chdogScheduËSigÇl
(
³riod
);

1153 
£rv”
.
w©chdog_³riod
 = 
³riod
;

1154 
	}
}

1157 
	$di§bËW©chdog
() {

1158 
sigaùiÚ
 
aù
;

1159 ià(
£rv”
.
w©chdog_³riod
 == 0) ;

1160 
	`w©chdogScheduËSigÇl
(0);

1164 
	`sigem±y£t
(&
aù
.
§_mask
);

1165 
aù
.
§_æags
 = 0;

1166 
aù
.
§_hªdËr
 = 
SIG_IGN
;

1167 
	`sigaùiÚ
(
SIGALRM
, &
aù
, 
NULL
);

1168 
£rv”
.
w©chdog_³riod
 = 0;

1169 
	}
}

	@debugmacro.h

33 
	~<¡dio.h
>

34 
	#D
(...) \

36 
FILE
 *
å
 = 
	`fİ’
("/tmp/log.txt","a"); \

37 
	`årštf
(
å
,"%s:%s:%d:\t", 
__FILE__
, 
__func__
, 
__LINE__
); \

38 
	`årštf
(
å
,
__VA_ARGS__
); \

39 
	`årštf
(
å
,"\n"); \

40 
	`fşo£
(
å
); \

41 } 0);

	)

	@dict.c

36 
	~"fmaüos.h
"

37 
	~<¡dio.h
>

38 
	~<¡dlib.h
>

39 
	~<¡ršg.h
>

40 
	~<¡d¬g.h
>

41 
	~<lim™s.h
>

42 
	~<sys/time.h
>

43 
	~<ùy³.h
>

45 
	~"diù.h
"

46 
	~"zm®loc.h
"

47 #iâdeà
DICT_BENCHMARK_MAIN


48 
	~"»di§s£¹.h
"

50 
	~<as£¹.h
>

61 
	gdiù_ÿn_»size
 = 1;

62 
	gdiù_fÜû_»size_¿tio
 = 5;

66 
_diùEx·ndIfN“ded
(
diù
 *
ht
);

67 
_diùNextPow”
(
size
);

68 
_diùKeyIndex
(
diù
 *
ht
, cÚ¡ *
key
, 
hash
, 
diùEÁry
 **
exi¡šg
);

69 
_diùIn™
(
diù
 *
ht
, 
diùTy³
 *
ty³
, *
´ivD©aPŒ
);

73 
ušt32_t
 
	gdiù_hash_funùiÚ_£ed
 = 5381;

75 
	$diùS‘HashFunùiÚS“d
(
ušt32_t
 
£ed
) {

76 
diù_hash_funùiÚ_£ed
 = 
£ed
;

77 
	}
}

79 
ušt32_t
 
	$diùG‘HashFunùiÚS“d
() {

80  
diù_hash_funùiÚ_£ed
;

81 
	}
}

94 
	$diùG’HashFunùiÚ
(cÚ¡ *
key
, 
Ën
) {

97 
ušt32_t
 
£ed
 = 
diù_hash_funùiÚ_£ed
;

98 cÚ¡ 
ušt32_t
 
m
 = 0x5bd1e995;

99 cÚ¡ 
r
 = 24;

102 
ušt32_t
 
h
 = 
£ed
 ^ 
Ën
;

105 cÚ¡ *
d©a
 = (cÚ¡ *)
key
;

107 
Ën
 >= 4) {

108 
ušt32_t
 
k
 = *(ušt32_t*)
d©a
;

110 
k
 *ğ
m
;

111 
k
 ^ğk >> 
r
;

112 
k
 *ğ
m
;

114 
h
 *ğ
m
;

115 
h
 ^ğ
k
;

117 
d©a
 += 4;

118 
Ën
 -= 4;

122 
Ën
) {

123 3: 
h
 ^ğ
d©a
[2] << 16;

124 2: 
h
 ^ğ
d©a
[1] << 8;

125 1: 
h
 ^ğ
d©a
[0]; h *ğ
m
;

130 
h
 ^= h >> 13;

131 
h
 *ğ
m
;

132 
h
 ^= h >> 15;

134  ()
h
;

135 
	}
}

138 
	$diùG’Ca£HashFunùiÚ
(cÚ¡ *
buf
, 
Ën
) {

139 
hash
 = ()
diù_hash_funùiÚ_£ed
;

141 
Ën
--)

142 
hash
 = ((hash << 5è+ hashè+ (
	`tŞow”
(*
buf
++));

143  
hash
;

144 
	}
}

150 
	$_diùRe£t
(
diùht
 *
ht
)

152 
ht
->
bË
 = 
NULL
;

153 
ht
->
size
 = 0;

154 
ht
->
sizemask
 = 0;

155 
ht
->
u£d
 = 0;

156 
	}
}

159 
diù
 *
	$diùC»©e
(
diùTy³
 *
ty³
,

160 *
´ivD©aPŒ
)

162 
diù
 *
d
 = 
	`zm®loc
((*d));

164 
	`_diùIn™
(
d
,
ty³
,
´ivD©aPŒ
);

165  
d
;

166 
	}
}

169 
	$_diùIn™
(
diù
 *
d
, 
diùTy³
 *
ty³
,

170 *
´ivD©aPŒ
)

172 
	`_diùRe£t
(&
d
->
ht
[0]);

173 
	`_diùRe£t
(&
d
->
ht
[1]);

174 
d
->
ty³
 =ype;

175 
d
->
´ivd©a
 = 
´ivD©aPŒ
;

176 
d
->
»hashidx
 = -1;

177 
d
->
™”©Üs
 = 0;

178 
d
->
¥mHT
 = 
	`AÎoÿ‹HashTabË
(4,0);

179  
DICT_OK
;

180 
	}
}

184 
	$diùResize
(
diù
 *
d
)

186 
mšim®
;

188 ià(!
diù_ÿn_»size
 || 
	`diùIsRehashšg
(
d
)è 
DICT_ERR
;

189 
mšim®
 = 
d
->
ht
[0].
u£d
;

190 ià(
mšim®
 < 
DICT_HT_INITIAL_SIZE
)

191 
mšim®
 = 
DICT_HT_INITIAL_SIZE
;

192  
	`diùEx·nd
(
d
, 
mšim®
);

193 
	}
}

196 
	$diùEx·nd
(
diù
 *
d
, 
size
)

198 
diùht
 
n
;

199 
»®size
 = 
	`_diùNextPow”
(
size
);

203 ià(
	`diùIsRehashšg
(
d
è|| d->
ht
[0].
u£d
 > 
size
)

204  
DICT_ERR
;

207 ià(
»®size
 =ğ
d
->
ht
[0].
size
è 
DICT_ERR
;

210 
n
.
size
 = 
»®size
;

211 
n
.
sizemask
 = 
»®size
-1;

212 
n
.
bË
 = 
	`zÿÎoc
(
»®size
*(
diùEÁry
*));

213 
n
.
u£d
 = 0;

217 ià(
d
->
ht
[0].
bË
 =ğ
NULL
) {

218 
d
->
ht
[0] = 
n
;

219  
DICT_OK
;

223 
d
->
ht
[1] = 
n
;

224 
d
->
»hashidx
 = 0;

225  
DICT_OK
;

226 
	}
}

237 
	$diùRehash
(
diù
 *
d
, 
n
) {

238 
em±y_vis™s
 = 
n
*10;

239 ià(!
	`diùIsRehashšg
(
d
))  0;

241 
n
-- && 
d
->
ht
[0].
u£d
 != 0) {

242 
diùEÁry
 *
de
, *
Ãxtde
;

246 
	`as£¹
(
d
->
ht
[0].
size
 > ()d->
»hashidx
);

247 
d
->
ht
[0].
bË
[d->
»hashidx
] =ğ
NULL
) {

248 
d
->
»hashidx
++;

249 ià(--
em±y_vis™s
 == 0)  1;

251 
de
 = 
d
->
ht
[0].
bË
[d->
»hashidx
];

253 
de
) {

254 
h
;

256 
Ãxtde
 = 
de
->
Ãxt
;

258 
h
 = 
	`diùHashKey
(
d
, 
de
->
key
è& d->
ht
[1].
sizemask
;

259 
de
->
Ãxt
 = 
d
->
ht
[1].
bË
[
h
];

260 
d
->
ht
[1].
bË
[
h
] = 
de
;

261 
d
->
ht
[0].
u£d
--;

262 
d
->
ht
[1].
u£d
++;

263 
de
 = 
Ãxtde
;

265 
d
->
ht
[0].
bË
[d->
»hashidx
] = 
NULL
;

266 
d
->
»hashidx
++;

270 ià(
d
->
ht
[0].
u£d
 == 0) {

271 
	`zä“
(
d
->
ht
[0].
bË
);

272 
d
->
ht
[0] = d->ht[1];

273 
	`_diùRe£t
(&
d
->
ht
[1]);

274 
d
->
»hashidx
 = -1;

280 
	}
}

282 
	$timeInMli£cÚds
() {

283 
timev®
 
tv
;

285 
	`g‘timeofday
(&
tv
,
NULL
);

286  ((()
tv
.
tv_£c
)*1000)+Ñv.
tv_u£c
/1000);

287 
	}
}

290 
	$diùRehashMli£cÚds
(
diù
 *
d
, 
ms
) {

291 
¡¬t
 = 
	`timeInMli£cÚds
();

292 
»hashes
 = 0;

294 
	`diùRehash
(
d
,100)) {

295 
»hashes
 += 100;

296 ià(
	`timeInMli£cÚds
()-
¡¬t
 > 
ms
) ;

298  
»hashes
;

299 
	}
}

309 
	$_diùRehashS‹p
(
diù
 *
d
) {

310 ià(
d
->
™”©Üs
 =ğ0è
	`diùRehash
(d,1);

311 
	}
}

314 
	$diùAdd
(
diù
 *
d
, *
key
, *
v®
)

316 
diùEÁry
 *
’Œy
 = 
	`diùAddRaw
(
d
,
key
,
NULL
);

318 ià(!
’Œy
è 
DICT_ERR
;

319 
	`diùS‘V®
(
d
, 
’Œy
, 
v®
);

320  
DICT_OK
;

321 
	}
}

341 
diùEÁry
 *
	$diùAddRaw
(
diù
 *
d
, *
key
, 
diùEÁry
 **
exi¡šg
)

343 
šdex
;

344 
diùEÁry
 *
’Œy
;

345 
diùht
 *
ht
;

347 ià(
	`diùIsRehashšg
(
d
)è
	`_diùRehashS‹p
(d);

351 ià((
šdex
 = 
	`_diùKeyIndex
(
d
, 
key
, 
	`diùHashKey
(d,key), 
exi¡šg
)) == -1)

352  
NULL
;

358 
ht
 = 
	`diùIsRehashšg
(
d
) ? &d->ht[1] : &d->ht[0];

359 
’Œy
 = 
	`zm®loc
((*entry));

360 
’Œy
->
Ãxt
 = 
ht
->
bË
[
šdex
];

361 
ht
->
bË
[
šdex
] = 
’Œy
;

362 
ht
->
u£d
++;

365 
	`diùS‘Key
(
d
, 
’Œy
, 
key
);

366  
’Œy
;

367 
	}
}

374 
	$diùR•Ïû
(
diù
 *
d
, *
key
, *
v®
)

376 
diùEÁry
 *
’Œy
, *
exi¡šg
, 
aux’Œy
;

380 
’Œy
 = 
	`diùAddRaw
(
d
,
key
,&
exi¡šg
);

381 ià(
’Œy
) {

382 
	`diùS‘V®
(
d
, 
’Œy
, 
v®
);

391 
aux’Œy
 = *
exi¡šg
;

392 
	`diùS‘V®
(
d
, 
exi¡šg
, 
v®
);

393 
	`diùF»eV®
(
d
, &
aux’Œy
);

395 
	}
}

404 
diùEÁry
 *
	$diùAddOrFšd
(
diù
 *
d
, *
key
) {

405 
diùEÁry
 *
’Œy
, *
exi¡šg
;

406 
’Œy
 = 
	`diùAddRaw
(
d
,
key
,&
exi¡šg
);

407  
’Œy
 ?ƒÁry : 
exi¡šg
;

408 
	}
}

413 
diùEÁry
 *
	$diùG’”icD–‘e
(
diù
 *
d
, cÚ¡ *
key
, 
noä“
) {

414 
h
, 
idx
;

415 
diùEÁry
 *
he
, *
´evHe
;

416 
bË
;

418 ià(
d
->
ht
[0].
u£d
 =ğ0 && d->ht[1].u£d =ğ0è 
NULL
;

420 ià(
	`diùIsRehashšg
(
d
)è
	`_diùRehashS‹p
(d);

421 
h
 = 
	`diùHashKey
(
d
, 
key
);

423 
bË
 = 0;able <= 1;able++) {

424 
idx
 = 
h
 & 
d
->
ht
[
bË
].
sizemask
;

425 
he
 = 
d
->
ht
[
bË
].bË[
idx
];

426 
´evHe
 = 
NULL
;

427 
he
) {

428 ià(
key
==
he
->key || 
	`diùCom·»Keys
(
d
, key, he->key)) {

430 ià(
´evHe
)

431 
´evHe
->
Ãxt
 = 
he
->next;

433 
d
->
ht
[
bË
].bË[
idx
] = 
he
->
Ãxt
;

434 ià(!
noä“
) {

435 
	`diùF»eKey
(
d
, 
he
);

436 
	`diùF»eV®
(
d
, 
he
);

437 
	`zä“
(
he
);

439 
d
->
ht
[
bË
].
u£d
--;

440  
he
;

442 
´evHe
 = 
he
;

443 
he
 = he->
Ãxt
;

445 ià(!
	`diùIsRehashšg
(
d
)) ;

447  
NULL
;

448 
	}
}

452 
	$diùD–‘e
(
diù
 *
ht
, cÚ¡ *
key
) {

453  
	`diùG’”icD–‘e
(
ht
,
key
,0è? 
DICT_OK
 : 
DICT_ERR
;

454 
	}
}

477 
diùEÁry
 *
	$diùUÆšk
(
diù
 *
ht
, cÚ¡ *
key
) {

478  
	`diùG’”icD–‘e
(
ht
,
key
,1);

479 
	}
}

483 
	$diùF»eUÆškedEÁry
(
diù
 *
d
, 
diùEÁry
 *
he
) {

484 ià(
he
 =ğ
NULL
) ;

485 
	`diùF»eKey
(
d
, 
he
);

486 
	`diùF»eV®
(
d
, 
he
);

487 
	`zä“
(
he
);

488 
	}
}

491 
_diùCË¬
(
diù
 *
d
, 
diùht
 *
ht
, (
ÿÎback
)(*)) {

492 
i
;

495 
i
 = 0; i < 
ht
->
size
 && ht->
u£d
 > 0; i++) {

496 
diùEÁry
 *
he
, *
ÃxtHe
;

498 ià(
ÿÎback
 && (
i
 & 65535è=ğ0è
	`ÿÎback
(
d
->
´ivd©a
);

500 ià((
he
 = 
ht
->
bË
[
i
]è=ğ
NULL
) ;

501 
he
) {

502 
ÃxtHe
 = 
he
->
Ãxt
;

503 
	`diùF»eKey
(
d
, 
he
);

504 
	`diùF»eV®
(
d
, 
he
);

505 
	`zä“
(
he
);

506 
ht
->
u£d
--;

507 
he
 = 
ÃxtHe
;

511 
	`zä“
(
ht
->
bË
);

513 
	`_diùRe£t
(
ht
);

514  
DICT_OK
;

515 
	}
}

518 
	$diùR–—£
(
diù
 *
d
)

520 
	`_diùCË¬
(
d
,&d->
ht
[0],
NULL
);

521 
	`_diùCË¬
(
d
,&d->
ht
[1],
NULL
);

523 
	`zä“
(
d
);

524 
	}
}

526 
diùEÁry
 *
	$diùFšd
(
diù
 *
d
, cÚ¡ *
key
)

528 
diùEÁry
 *
he
;

529 
h
, 
idx
, 
bË
;

531 ià(
d
->
ht
[0].
u£d
 + d->ht[1].u£d =ğ0è 
NULL
;

532 ià(
	`diùIsRehashšg
(
d
)è
	`_diùRehashS‹p
(d);

533 
h
 = 
	`diùHashKey
(
d
, 
key
);

534 
bË
 = 0;able <= 1;able++) {

535 
idx
 = 
h
 & 
d
->
ht
[
bË
].
sizemask
;

536 
he
 = 
d
->
ht
[
bË
].bË[
idx
];

537 
he
) {

538 ià(
key
==
he
->key || 
	`diùCom·»Keys
(
d
, key, he->key))

539  
he
;

540 
he
 = he->
Ãxt
;

542 ià(!
	`diùIsRehashšg
(
d
)è 
NULL
;

544  
NULL
;

545 
	}
}

547 *
	$diùF‘chV®ue
(
diù
 *
d
, cÚ¡ *
key
) {

548 
diùEÁry
 *
he
;

550 
he
 = 
	`diùFšd
(
d
,
key
);

551  
he
 ? 
	`diùG‘V®
(heè: 
NULL
;

552 
	}
}

560 
	$diùFšg”´št
(
diù
 *
d
) {

561 
š‹g”s
[6], 
hash
 = 0;

562 
j
;

564 
š‹g”s
[0] = (è
d
->
ht
[0].
bË
;

565 
š‹g”s
[1] = 
d
->
ht
[0].
size
;

566 
š‹g”s
[2] = 
d
->
ht
[0].
u£d
;

567 
š‹g”s
[3] = (è
d
->
ht
[1].
bË
;

568 
š‹g”s
[4] = 
d
->
ht
[1].
size
;

569 
š‹g”s
[5] = 
d
->
ht
[1].
u£d
;

578 
j
 = 0; j < 6; j++) {

579 
hash
 +ğ
š‹g”s
[
j
];

581 
hash
 = (~hash) + (hash << 21);

582 
hash
 = hash ^ (hash >> 24);

583 
hash
 = (hash + (hash << 3)) + (hash << 8);

584 
hash
 = hash ^ (hash >> 14);

585 
hash
 = (hash + (hash << 2)) + (hash << 4);

586 
hash
 = hash ^ (hash >> 28);

587 
hash
 = hash + (hash << 31);

589  
hash
;

590 
	}
}

592 
diùI‹¿tÜ
 *
	$diùG‘I‹¿tÜ
(
diù
 *
d
)

594 
diùI‹¿tÜ
 *
™”
 = 
	`zm®loc
((*iter));

596 
™”
->
d
 = d;

597 
™”
->
bË
 = 0;

598 
™”
->
šdex
 = -1;

599 
™”
->
§ã
 = 0;

600 
™”
->
’Œy
 = 
NULL
;

601 
™”
->
ÃxtEÁry
 = 
NULL
;

602  
™”
;

603 
	}
}

605 
diùI‹¿tÜ
 *
	$diùG‘SaãI‹¿tÜ
(
diù
 *
d
) {

606 
diùI‹¿tÜ
 *
i
 = 
	`diùG‘I‹¿tÜ
(
d
);

608 
i
->
§ã
 = 1;

609  
i
;

610 
	}
}

612 
diùEÁry
 *
	$diùNext
(
diùI‹¿tÜ
 *
™”
)

615 ià(
™”
->
’Œy
 =ğ
NULL
) {

616 
diùht
 *
ht
 = &
™”
->
d
->ht[™”->
bË
];

617 ià(
™”
->
šdex
 =ğ-1 && i‹r->
bË
 == 0) {

618 ià(
™”
->
§ã
)

619 
™”
->
d
->
™”©Üs
++;

621 
™”
->
fšg”´št
 = 
	`diùFšg”´št
(™”->
d
);

623 
™”
->
šdex
++;

624 ià(
™”
->
šdex
 >ğ(è
ht
->
size
) {

625 ià(
	`diùIsRehashšg
(
™”
->
d
è&& i‹r->
bË
 == 0) {

626 
™”
->
bË
++;

627 
™”
->
šdex
 = 0;

628 
ht
 = &
™”
->
d
->ht[1];

633 
™”
->
’Œy
 = 
ht
->
bË
[™”->
šdex
];

635 
™”
->
’Œy
 = i‹r->
ÃxtEÁry
;

637 ià(
™”
->
’Œy
) {

640 
™”
->
ÃxtEÁry
 = i‹r->
’Œy
->
Ãxt
;

641  
™”
->
’Œy
;

644  
NULL
;

645 
	}
}

647 
	$diùR–—£I‹¿tÜ
(
diùI‹¿tÜ
 *
™”
)

649 ià(!(
™”
->
šdex
 =ğ-1 && i‹r->
bË
 == 0)) {

650 ià(
™”
->
§ã
)

651 
™”
->
d
->
™”©Üs
--;

653 
	`as£¹
(
™”
->
fšg”´št
 =ğ
	`diùFšg”´št
(™”->
d
));

655 
	`zä“
(
™”
);

656 
	}
}

660 
diùEÁry
 *
	$diùG‘RªdomKey
(
diù
 *
d
)

662 
diùEÁry
 *
he
, *
Üighe
;

663 
h
;

664 
li¡Ën
, 
li¡–e
;

666 ià(
	`diùSize
(
d
è=ğ0è 
NULL
;

667 ià(
	`diùIsRehashšg
(
d
)è
	`_diùRehashS‹p
(d);

668 ià(
	`diùIsRehashšg
(
d
)) {

672 
h
 = 
d
->
»hashidx
 + (
	`¿ndom
(è% (d->
ht
[0].
size
 +

673 
d
->
ht
[1].
size
 -

674 
d
->
»hashidx
));

675 
he
 = (
h
 >ğ
d
->
ht
[0].
size
è? d->ht[1].
bË
[h - d->ht[0].size] :

676 
d
->
ht
[0].
bË
[
h
];

677 } 
he
 =ğ
NULL
);

680 
h
 = 
	`¿ndom
(è& 
d
->
ht
[0].
sizemask
;

681 
he
 = 
d
->
ht
[0].
bË
[
h
];

682 } 
he
 =ğ
NULL
);

689 
li¡Ën
 = 0;

690 
Üighe
 = 
he
;

691 
he
) {

692 
he
 = he->
Ãxt
;

693 
li¡Ën
++;

695 
li¡–e
 = 
	`¿ndom
(è% 
li¡Ën
;

696 
he
 = 
Üighe
;

697 
li¡–e
--è
he
 = he->
Ãxt
;

698  
he
;

699 
	}
}

723 
	$diùG‘SomeKeys
(
diù
 *
d
, 
diùEÁry
 **
des
, 
couÁ
) {

724 
j
;

725 
bËs
;

726 
¡Üed
 = 0, 
maxsizemask
;

727 
max¡•s
;

729 ià(
	`diùSize
(
d
è< 
couÁ
) count = dictSize(d);

730 
max¡•s
 = 
couÁ
*10;

733 
j
 = 0; j < 
couÁ
; j++) {

734 ià(
	`diùIsRehashšg
(
d
))

735 
	`_diùRehashS‹p
(
d
);

740 
bËs
 = 
	`diùIsRehashšg
(
d
) ? 2 : 1;

741 
maxsizemask
 = 
d
->
ht
[0].
sizemask
;

742 ià(
bËs
 > 1 && 
maxsizemask
 < 
d
->
ht
[1].
sizemask
)

743 
maxsizemask
 = 
d
->
ht
[1].
sizemask
;

746 
i
 = 
	`¿ndom
(è& 
maxsizemask
;

747 
em±yËn
 = 0;

748 
¡Üed
 < 
couÁ
 && 
max¡•s
--) {

749 
j
 = 0; j < 
bËs
; j++) {

753 ià(
bËs
 =ğ2 && 
j
 =ğ0 && 
i
 < (è
d
->
»hashidx
) {

758 ià(
i
 >ğ
d
->
ht
[1].
size
è˜ğd->
»hashidx
;

761 ià(
i
 >ğ
d
->
ht
[
j
].
size
) ;

762 
diùEÁry
 *
he
 = 
d
->
ht
[
j
].
bË
[
i
];

766 ià(
he
 =ğ
NULL
) {

767 
em±yËn
++;

768 ià(
em±yËn
 >ğ5 &&ƒm±yËÀ> 
couÁ
) {

769 
i
 = 
	`¿ndom
(è& 
maxsizemask
;

770 
em±yËn
 = 0;

773 
em±yËn
 = 0;

774 
he
) {

777 *
des
 = 
he
;

778 
des
++;

779 
he
 = he->
Ãxt
;

780 
¡Üed
++;

781 ià(
¡Üed
 =ğ
couÁ
)  stored;

785 
i
 = (i+1è& 
maxsizemask
;

787  
¡Üed
;

788 
	}
}

792 
	$»v
(
v
) {

793 
s
 = 8 * (
v
);

794 
mask
 = ~0;

795 (
s
 >>= 1) > 0) {

796 
mask
 ^ğ(mask << 
s
);

797 
v
 = ((v >> 
s
è& 
mask
) | ((v << s) & ~mask);

799  
v
;

800 
	}
}

886 
	$diùSÿn
(
diù
 *
d
,

887 
v
,

888 
diùSÿnFunùiÚ
 *
â
,

889 *
´ivd©a
)

891 
diùht
 *
t0
, *
t1
;

892 cÚ¡ 
diùEÁry
 *
de
, *
Ãxt
;

893 
m0
, 
m1
;

895 ià(
	`diùSize
(
d
) == 0)  0;

897 ià(!
	`diùIsRehashšg
(
d
)) {

898 
t0
 = &(
d
->
ht
[0]);

899 
m0
 = 
t0
->
sizemask
;

902 
de
 = 
t0
->
bË
[
v
 & 
m0
];

903 
de
) {

904 
Ãxt
 = 
de
->next;

905 
	`â
(
´ivd©a
, 
de
);

906 
de
 = 
Ãxt
;

910 
t0
 = &
d
->
ht
[0];

911 
t1
 = &
d
->
ht
[1];

914 ià(
t0
->
size
 > 
t1
->size) {

915 
t0
 = &
d
->
ht
[1];

916 
t1
 = &
d
->
ht
[0];

919 
m0
 = 
t0
->
sizemask
;

920 
m1
 = 
t1
->
sizemask
;

923 
de
 = 
t0
->
bË
[
v
 & 
m0
];

924 
de
) {

925 
Ãxt
 = 
de
->next;

926 
	`â
(
´ivd©a
, 
de
);

927 
de
 = 
Ãxt
;

934 
de
 = 
t1
->
bË
[
v
 & 
m1
];

935 
de
) {

936 
Ãxt
 = 
de
->next;

937 
	`â
(
´ivd©a
, 
de
);

938 
de
 = 
Ãxt
;

942 
v
 = (((v | 
m0
) + 1) & ~m0) | (v & m0);

945 } 
v
 & (
m0
 ^ 
m1
));

950 
v
 |ğ~
m0
;

953 
v
 = 
	`»v
(v);

954 
v
++;

955 
v
 = 
	`»v
(v);

957  
v
;

958 
	}
}

963 
	$_diùEx·ndIfN“ded
(
diù
 *
d
)

966 ià(
	`diùIsRehashšg
(
d
)è 
DICT_OK
;

969 ià(
d
->
ht
[0].
size
 =ğ0è 
	`diùEx·nd
(d, 
DICT_HT_INITIAL_SIZE
);

975 ià(
d
->
ht
[0].
u£d
 >ğd->ht[0].
size
 &&

976 (
diù_ÿn_»size
 ||

977 
d
->
ht
[0].
u£d
/d->ht[0].
size
 > 
diù_fÜû_»size_¿tio
))

979  
	`diùEx·nd
(
d
, d->
ht
[0].
u£d
*2);

981  
DICT_OK
;

982 
	}
}

985 
	$_diùNextPow”
(
size
)

987 
i
 = 
DICT_HT_INITIAL_SIZE
;

989 ià(
size
 >ğ
LONG_MAX
)  LONG_MAX;

991 ià(
i
 >ğ
size
)

992  
i
;

993 
i
 *= 2;

995 
	}
}

1004 
	$_diùKeyIndex
(
diù
 *
d
, cÚ¡ *
key
, 
hash
, 
diùEÁry
 **
exi¡šg
)

1006 
idx
, 
bË
;

1007 
diùEÁry
 *
he
;

1008 ià(
exi¡šg
è*exi¡šg = 
NULL
;

1011 ià(
	`_diùEx·ndIfN“ded
(
d
è=ğ
DICT_ERR
)

1013 
bË
 = 0;able <= 1;able++) {

1014 
idx
 = 
hash
 & 
d
->
ht
[
bË
].
sizemask
;

1016 
he
 = 
d
->
ht
[
bË
].bË[
idx
];

1017 
he
) {

1018 ià(
key
==
he
->key || 
	`diùCom·»Keys
(
d
, key, he->key)) {

1019 ià(
exi¡šg
è*exi¡šg = 
he
;

1022 
he
 = he->
Ãxt
;

1024 ià(!
	`diùIsRehashšg
(
d
)) ;

1026  
idx
;

1027 
	}
}

1029 
diùEm±y
(
diù
 *
d
, (
ÿÎback
)(*)) {

1030 
	`_diùCË¬
(
d
,&d->
ht
[0],
ÿÎback
);

1031 
	`_diùCË¬
(
d
,&d->
ht
[1],
ÿÎback
);

1032 
d
->
»hashidx
 = -1;

1033 
d
->
™”©Üs
 = 0;

1034 
	}
}

1036 
	$diùEÇbËResize
() {

1037 
diù_ÿn_»size
 = 1;

1038 
	}
}

1040 
	$diùDi§bËResize
() {

1041 
diù_ÿn_»size
 = 0;

1042 
	}
}

1046 
	#DICT_STATS_VECTLEN
 50

	)

1047 
size_t
 
	$_diùG‘StsHt
(*
buf
, 
size_t
 
bufsize
, 
diùht
 *
ht
, 
bËid
) {

1048 
i
, 
¦Ùs
 = 0, 
chašËn
, 
maxchašËn
 = 0;

1049 
tÙchašËn
 = 0;

1050 
şveùÜ
[
DICT_STATS_VECTLEN
];

1051 
size_t
 
l
 = 0;

1053 ià(
ht
->
u£d
 == 0) {

1054  
	`¢´štf
(
buf
,
bufsize
,

1059 
i
 = 0; i < 
DICT_STATS_VECTLEN
; i++è
şveùÜ
[i] = 0;

1060 
i
 = 0; i < 
ht
->
size
; i++) {

1061 
diùEÁry
 *
he
;

1063 ià(
ht
->
bË
[
i
] =ğ
NULL
) {

1064 
şveùÜ
[0]++;

1067 
¦Ùs
++;

1069 
chašËn
 = 0;

1070 
he
 = 
ht
->
bË
[
i
];

1071 
he
) {

1072 
chašËn
++;

1073 
he
 = he->
Ãxt
;

1075 
şveùÜ
[(
chašËn
 < 
DICT_STATS_VECTLEN
) ? chainlen : (DICT_STATS_VECTLEN-1)]++;

1076 ià(
chašËn
 > 
maxchašËn
) maxchainlen = chainlen;

1077 
tÙchašËn
 +ğ
chašËn
;

1081 
l
 +ğ
	`¢´štf
(
buf
+l,
bufsize
-l,

1090 
bËid
, (tableid == 0) ? "main hashable" : "rehashingarget",

1091 
ht
->
size
, ht->
u£d
, 
¦Ùs
, 
maxchašËn
,

1092 ()
tÙchašËn
/
¦Ùs
, ()
ht
->
u£d
/slots);

1094 
i
 = 0; i < 
DICT_STATS_VECTLEN
-1; i++) {

1095 ià(
şveùÜ
[
i
] == 0) ;

1096 ià(
l
 >ğ
bufsize
) ;

1097 
l
 +ğ
	`¢´štf
(
buf
+l,
bufsize
-l,

1099 (
i
 =ğ
DICT_STATS_VECTLEN
-1)?">= ":"",

1100 
i
, 
şveùÜ
[i], (()şveùÜ[i]/
ht
->
size
)*100);

1104 ià(
bufsize
è
buf
[bufsize-1] = '\0';

1105  
	`¡¾’
(
buf
);

1106 
	}
}

1108 
	$diùG‘Sts
(*
buf
, 
size_t
 
bufsize
, 
diù
 *
d
) {

1109 
size_t
 
l
;

1110 *
Üig_buf
 = 
buf
;

1111 
size_t
 
Üig_bufsize
 = 
bufsize
;

1113 
l
 = 
	`_diùG‘StsHt
(
buf
,
bufsize
,&
d
->
ht
[0],0);

1114 
buf
 +ğ
l
;

1115 
bufsize
 -ğ
l
;

1116 ià(
	`diùIsRehashšg
(
d
è&& 
bufsize
 > 0) {

1117 
	`_diùG‘StsHt
(
buf
,
bufsize
,&
d
->
ht
[1],1);

1120 ià(
Üig_bufsize
è
Üig_buf
[orig_bufsize-1] = '\0';

1121 
	}
}

1125 #ifdeà
DICT_BENCHMARK_MAIN


1127 
	~"sds.h
"

1129 
	$hashC®lback
(cÚ¡ *
key
) {

1130  
	`diùG’HashFunùiÚ
((*)
key
, 
	`sd¦’
((*)key));

1131 
	}
}

1133 
	$com·»C®lback
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
) {

1134 
l1
,
l2
;

1135 
	`DICT_NOTUSED
(
´ivd©a
);

1137 
l1
 = 
	`sd¦’
((
sds
)
key1
);

1138 
l2
 = 
	`sd¦’
((
sds
)
key2
);

1139 ià(
l1
 !ğ
l2
)  0;

1140  
	`memcmp
(
key1
, 
key2
, 
l1
) == 0;

1141 
	}
}

1143 
	$ä“C®lback
(*
´ivd©a
, *
v®
) {

1144 
	`DICT_NOTUSED
(
´ivd©a
);

1146 
	`sdsä“
(
v®
);

1147 
	}
}

1149 
diùTy³
 
	gB’chm¬kDiùTy³
 = {

1150 
hashC®lback
,

1151 
NULL
,

1152 
NULL
,

1153 
com·»C®lback
,

1154 
ä“C®lback
,

1155 
NULL


1158 
	#¡¬t_b’chm¬k
(è
¡¬t
 = 
	`timeInMli£cÚds
()

	)

1159 
	#’d_b’chm¬k
(
msg
) do { \

1160 
–­£d
 = 
	`timeInMli£cÚds
()-
¡¬t
; \

1161 
	`´štf
(
msg
 ": %ld i‹m š %Îd ms\n", 
couÁ
, 
–­£d
); \

1162 } 0);

	)

1165 
	$maš
(
¬gc
, **
¬gv
) {

1166 
j
;

1167 
¡¬t
, 
–­£d
;

1168 
diù
 *diù = 
	`diùC»©e
(&
B’chm¬kDiùTy³
,
NULL
);

1169 
couÁ
 = 0;

1171 ià(
¬gc
 == 2) {

1172 
couÁ
 = 
	`¡¹Ş
(
¬gv
[1],
NULL
,10);

1174 
couÁ
 = 5000000;

1177 
	`¡¬t_b’chm¬k
();

1178 
j
 = 0; j < 
couÁ
; j++) {

1179 
»tv®
 = 
	`diùAdd
(
diù
,
	`sdsäomlÚglÚg
(
j
),(*)j);

1180 
	`as£¹
(
»tv®
 =ğ
DICT_OK
);

1182 
	`’d_b’chm¬k
("Inserting");

1183 
	`as£¹
(()
	`diùSize
(
diù
è=ğ
couÁ
);

1186 
	`diùIsRehashšg
(
diù
)) {

1187 
	`diùRehashMli£cÚds
(
diù
,100);

1190 
	`¡¬t_b’chm¬k
();

1191 
j
 = 0; j < 
couÁ
; j++) {

1192 
sds
 
key
 = 
	`sdsäomlÚglÚg
(
j
);

1193 
diùEÁry
 *
de
 = 
	`diùFšd
(
diù
,
key
);

1194 
	`as£¹
(
de
 !ğ
NULL
);

1195 
	`sdsä“
(
key
);

1197 
	`’d_b’chm¬k
("Linear‡ccess ofƒxistingƒlements");

1199 
	`¡¬t_b’chm¬k
();

1200 
j
 = 0; j < 
couÁ
; j++) {

1201 
sds
 
key
 = 
	`sdsäomlÚglÚg
(
j
);

1202 
diùEÁry
 *
de
 = 
	`diùFšd
(
diù
,
key
);

1203 
	`as£¹
(
de
 !ğ
NULL
);

1204 
	`sdsä“
(
key
);

1206 
	`’d_b’chm¬k
("Linear‡ccess ofƒxistingƒlements (2nd„ound)");

1208 
	`¡¬t_b’chm¬k
();

1209 
j
 = 0; j < 
couÁ
; j++) {

1210 
sds
 
key
 = 
	`sdsäomlÚglÚg
(
	`¿nd
(è% 
couÁ
);

1211 
diùEÁry
 *
de
 = 
	`diùFšd
(
diù
,
key
);

1212 
	`as£¹
(
de
 !ğ
NULL
);

1213 
	`sdsä“
(
key
);

1215 
	`’d_b’chm¬k
("Random‡ccess ofƒxistingƒlements");

1217 
	`¡¬t_b’chm¬k
();

1218 
j
 = 0; j < 
couÁ
; j++) {

1219 
sds
 
key
 = 
	`sdsäomlÚglÚg
(
	`¿nd
(è% 
couÁ
);

1220 
key
[0] = 'X';

1221 
diùEÁry
 *
de
 = 
	`diùFšd
(
diù
,
key
);

1222 
	`as£¹
(
de
 =ğ
NULL
);

1223 
	`sdsä“
(
key
);

1225 
	`’d_b’chm¬k
("Accessing missing");

1227 
	`¡¬t_b’chm¬k
();

1228 
j
 = 0; j < 
couÁ
; j++) {

1229 
sds
 
key
 = 
	`sdsäomlÚglÚg
(
j
);

1230 
»tv®
 = 
	`diùD–‘e
(
diù
,
key
);

1231 
	`as£¹
(
»tv®
 =ğ
DICT_OK
);

1232 
key
[0] += 17;

1233 
»tv®
 = 
	`diùAdd
(
diù
,
key
,(*)
j
);

1234 
	`as£¹
(
»tv®
 =ğ
DICT_OK
);

1236 
	`’d_b’chm¬k
("Removing‡nd‡dding");

1237 
	}
}

	@dict.h

36 
	~<¡dšt.h
>

37 
	~"libchash.h
"

39 #iâdeà
__DICT_H


40 
	#__DICT_H


	)

42 
	#DICT_OK
 0

	)

43 
	#DICT_ERR
 1

	)

46 
	#DICT_NOTUSED
(
V
è((èV)

	)

48 
	sdiùEÁry
 {

49 *
	mkey
;

51 *
	mv®
;

52 
ušt64_t
 
	mu64
;

53 
št64_t
 
	ms64
;

54 
	md
;

55 } 
	mv
;

56 
diùEÁry
 *
	mÃxt
;

57 } 
	tdiùEÁry
;

59 
	sdiùTy³
 {

60 (*
	mhashFunùiÚ
)(cÚ¡ *
	mkey
);

61 *(*
	mkeyDup
)(*
	m´ivd©a
, cÚ¡ *
	mkey
);

62 *(*
	mv®Dup
)(*
	m´ivd©a
, cÚ¡ *
	mobj
);

63 (*
	mkeyCom·»
)(*
	m´ivd©a
, cÚ¡ *
	mkey1
, cÚ¡ *
	mkey2
);

64 (*
	mkeyDe¡ruùÜ
)(*
	m´ivd©a
, *
	mkey
);

65 (*
	mv®De¡ruùÜ
)(*
	m´ivd©a
, *
	mobj
);

66 } 
	tdiùTy³
;

70 
	sdiùht
 {

71 
diùEÁry
 **
	mbË
;

72 
	msize
;

73 
	msizemask
;

74 
	mu£d
;

75 } 
	tdiùht
;

77 
	sdiù
 {

78 
diùTy³
 *
	mty³
;

79 *
	m´ivd©a
;

80 
diùht
 
	mht
[2];

81 
	m»hashidx
;

82 
	m™”©Üs
;

83 
HashTabË
 *
	m¥mHT
;

84 } 
	tdiù
;

90 
	sdiùI‹¿tÜ
 {

91 
diù
 *
	md
;

92 
	mšdex
;

93 
	mbË
, 
	m§ã
;

94 
diùEÁry
 *
	m’Œy
, *
	mÃxtEÁry
;

96 
	mfšg”´št
;

97 } 
	tdiùI‹¿tÜ
;

99 (
	tdiùSÿnFunùiÚ
)(*
	t´ivd©a
, cÚ¡ 
	tdiùEÁry
 *
	tde
);

102 
	#DICT_HT_INITIAL_SIZE
 4

	)

105 
	#diùF»eV®
(
d
, 
’Œy
) \

106 ià((
d
)->
ty³
->
v®De¡ruùÜ
) \

107 (
d
)->
ty³
->
	`v®De¡ruùÜ
((d)->
´ivd©a
, (
’Œy
)->
v
.
v®
)

	)

109 
	#diùS‘V®
(
d
, 
’Œy
, 
_v®_
) do { \

110 ià((
d
)->
ty³
->
v®Dup
) \

111 (
’Œy
)->
v
.
v®
 = (
d
)->
ty³
->
	`v®Dup
((d)->
´ivd©a
, 
_v®_
); \

113 (
’Œy
)->
v
.
v®
 = (
_v®_
); \

114 
	}
} 0)

	)

116 
	#diùS‘SigÃdIÁeg”V®
(
’Œy
, 
_v®_
) \

117 dØ{ (
’Œy
)->
v
.
s64
 = 
_v®_
; } 0)

	)

119 
	#diùS‘UnsigÃdIÁeg”V®
(
’Œy
, 
_v®_
) \

120 dØ{ (
’Œy
)->
v
.
u64
 = 
_v®_
; } 0)

	)

122 
	#diùS‘DoubËV®
(
’Œy
, 
_v®_
) \

123 dØ{ (
’Œy
)->
v
.
d
 = 
_v®_
; } 0)

	)

125 
	#diùF»eKey
(
d
, 
’Œy
) \

126 ià((
d
)->
ty³
->
keyDe¡ruùÜ
) \

127 (
d
)->
ty³
->
	`keyDe¡ruùÜ
((d)->
´ivd©a
, (
’Œy
)->
key
)

	)

129 
	#diùS‘Key
(
d
, 
’Œy
, 
_key_
) do { \

130 ià((
d
)->
ty³
->
keyDup
) \

131 (
’Œy
)->
key
 = (
d
)->
ty³
->
	`keyDup
((d)->
´ivd©a
, 
_key_
); \

133 (
’Œy
)->
key
 = (
_key_
); \

134 } 0)

	)

136 
	#diùCom·»Keys
(
d
, 
key1
, 
key2
) \

137 (((
d
)->
ty³
->
keyCom·»
) ? \

138 (
d
)->
ty³
->
	`keyCom·»
((d)->
´ivd©a
, 
key1
, 
key2
) : \

139 (
key1
è=ğ(
key2
))

	)

141 
	#diùHashKey
(
d
, 
key
è(d)->
ty³
->
	`hashFunùiÚ
(key)

	)

142 
	#diùG‘Key
(
he
è((he)->
key
)

	)

143 
	#diùG‘V®
(
he
è((he)->
v
.
v®
)

	)

144 
	#diùG‘SigÃdIÁeg”V®
(
he
è((he)->
v
.
s64
)

	)

145 
	#diùG‘UnsigÃdIÁeg”V®
(
he
è((he)->
v
.
u64
)

	)

146 
	#diùG‘DoubËV®
(
he
è((he)->
v
.
d
)

	)

147 
	#diùSlÙs
(
d
è((d)->
ht
[0].
size
+(d)->ht[1].size)

	)

148 
	#diùSize
(
d
è((d)->
ht
[0].
u£d
+(d)->ht[1].u£d)

	)

149 
	#diùIsRehashšg
(
d
è((d)->
»hashidx
 !ğ-1)

	)

152 
diù
 *
diùC»©e
(
diùTy³
 *
ty³
, *
´ivD©aPŒ
);

153 
diùEx·nd
(
diù
 *
d
, 
size
);

154 
diùAdd
(
diù
 *
d
, *
key
, *
v®
);

155 
diùEÁry
 *
diùAddRaw
(
diù
 *
d
, *
key
, diùEÁry **
exi¡šg
);

156 
diùEÁry
 *
diùAddOrFšd
(
diù
 *
d
, *
key
);

157 
diùR•Ïû
(
diù
 *
d
, *
key
, *
v®
);

158 
diùD–‘e
(
diù
 *
d
, cÚ¡ *
key
);

159 
diùEÁry
 *
diùUÆšk
(
diù
 *
ht
, cÚ¡ *
key
);

160 
diùF»eUÆškedEÁry
(
diù
 *
d
, 
diùEÁry
 *
he
);

161 
diùR–—£
(
diù
 *
d
);

162 
diùEÁry
 * 
diùFšd
(
diù
 *
d
, cÚ¡ *
key
);

163 *
diùF‘chV®ue
(
diù
 *
d
, cÚ¡ *
key
);

164 
diùResize
(
diù
 *
d
);

165 
diùI‹¿tÜ
 *
diùG‘I‹¿tÜ
(
diù
 *
d
);

166 
diùI‹¿tÜ
 *
diùG‘SaãI‹¿tÜ
(
diù
 *
d
);

167 
diùEÁry
 *
diùNext
(
diùI‹¿tÜ
 *
™”
);

168 
diùR–—£I‹¿tÜ
(
diùI‹¿tÜ
 *
™”
);

169 
diùEÁry
 *
diùG‘RªdomKey
(
diù
 *
d
);

170 
diùG‘SomeKeys
(
diù
 *
d
, 
diùEÁry
 **
des
, 
couÁ
);

171 
diùG‘Sts
(*
buf
, 
size_t
 
bufsize
, 
diù
 *
d
);

172 
diùG’HashFunùiÚ
(cÚ¡ *
key
, 
Ën
);

173 
diùG’Ca£HashFunùiÚ
(cÚ¡ *
buf
, 
Ën
);

174 
diùEm±y
(
diù
 *
d
, (
ÿÎback
)(*));

175 
	`diùEÇbËResize
();

176 
	`diùDi§bËResize
();

177 
	`diùRehash
(
diù
 *
d
, 
n
);

178 
	`diùRehashMli£cÚds
(
diù
 *
d
, 
ms
);

179 
	`diùS‘HashFunùiÚS“d
(
š™v®
);

180 
	`diùG‘HashFunùiÚS“d
();

181 
	`diùSÿn
(
diù
 *
d
, 
v
, 
diùSÿnFunùiÚ
 *
â
, *
´ivd©a
);

184 
diùTy³
 
diùTy³H—pSŒšgCİyKey
;

185 
diùTy³
 
diùTy³H—pSŒšgs
;

186 
diùTy³
 
diùTy³H—pSŒšgCİyKeyV®ue
;

	@endianconv.c

45 
	~<¡dšt.h
>

49 
	$mem»v16
(*
p
) {

50 *
x
 = 
p
, 
t
;

52 
t
 = 
x
[0];

53 
x
[0] = x[1];

54 
x
[1] = 
t
;

55 
	}
}

59 
	$mem»v32
(*
p
) {

60 *
x
 = 
p
, 
t
;

62 
t
 = 
x
[0];

63 
x
[0] = x[3];

64 
x
[3] = 
t
;

65 
t
 = 
x
[1];

66 
x
[1] = x[2];

67 
x
[2] = 
t
;

68 
	}
}

72 
	$mem»v64
(*
p
) {

73 *
x
 = 
p
, 
t
;

75 
t
 = 
x
[0];

76 
x
[0] = x[7];

77 
x
[7] = 
t
;

78 
t
 = 
x
[1];

79 
x
[1] = x[6];

80 
x
[6] = 
t
;

81 
t
 = 
x
[2];

82 
x
[2] = x[5];

83 
x
[5] = 
t
;

84 
t
 = 
x
[3];

85 
x
[3] = x[4];

86 
x
[4] = 
t
;

87 
	}
}

89 
ušt16_t
 
	$šŒev16
(
ušt16_t
 
v
) {

90 
	`mem»v16
(&
v
);

91  
v
;

92 
	}
}

94 
ušt32_t
 
	$šŒev32
(
ušt32_t
 
v
) {

95 
	`mem»v32
(&
v
);

96  
v
;

97 
	}
}

99 
ušt64_t
 
	$šŒev64
(
ušt64_t
 
v
) {

100 
	`mem»v64
(&
v
);

101  
v
;

102 
	}
}

104 #ifdeà
REDIS_TEST


105 
	~<¡dio.h
>

107 
	#UNUSED
(
x
è()(x)

	)

108 
	$’dŸncÚvTe¡
(
¬gc
, *
¬gv
[]) {

109 
buf
[32];

111 
	`UNUSED
(
¬gc
);

112 
	`UNUSED
(
¬gv
);

114 
	`¥rštf
(
buf
,"ciaoroma");

115 
	`mem»v16
(
buf
);

116 
	`´štf
("%s\n", 
buf
);

118 
	`¥rštf
(
buf
,"ciaoroma");

119 
	`mem»v32
(
buf
);

120 
	`´štf
("%s\n", 
buf
);

122 
	`¥rštf
(
buf
,"ciaoroma");

123 
	`mem»v64
(
buf
);

124 
	`´štf
("%s\n", 
buf
);

127 
	}
}

	@endianconv.h

33 #iâdeà
__ENDIANCONV_H


34 
	#__ENDIANCONV_H


	)

36 
	~"cÚfig.h
"

37 
	~<¡dšt.h
>

39 
mem»v16
(*
p
);

40 
mem»v32
(*
p
);

41 
mem»v64
(*
p
);

42 
ušt16_t
 
šŒev16
(ušt16_ˆ
v
);

43 
ušt32_t
 
šŒev32
(ušt32_ˆ
v
);

44 
ušt64_t
 
šŒev64
(ušt64_ˆ
v
);

48 #ià(
BYTE_ORDER
 =ğ
LITTLE_ENDIAN
)

49 
	#mem»v16ifbe
(
p
)

	)

50 
	#mem»v32ifbe
(
p
)

	)

51 
	#mem»v64ifbe
(
p
)

	)

52 
	#šŒev16ifbe
(
v
è(v)

	)

53 
	#šŒev32ifbe
(
v
è(v)

	)

54 
	#šŒev64ifbe
(
v
è(v)

	)

56 
	#mem»v16ifbe
(
p
è
	`mem»v16
Õ)

	)

57 
	#mem»v32ifbe
(
p
è
	`mem»v32
Õ)

	)

58 
	#mem»v64ifbe
(
p
è
	`mem»v64
Õ)

	)

59 
	#šŒev16ifbe
(
v
è
	`šŒev16
(v)

	)

60 
	#šŒev32ifbe
(
v
è
	`šŒev32
(v)

	)

61 
	#šŒev64ifbe
(
v
è
	`šŒev64
(v)

	)

66 #ià(
BYTE_ORDER
 =ğ
BIG_ENDIAN
)

67 
	#htÚu64
(
v
è(v)

	)

68 
	#Áohu64
(
v
è(v)

	)

70 
	#htÚu64
(
v
è
	`šŒev64
(v)

	)

71 
	#Áohu64
(
v
è
	`šŒev64
(v)

	)

74 #ifdeà
REDIS_TEST


75 
’dŸncÚvTe¡
(
¬gc
, *
¬gv
[]);

	@evict.c

33 
	~"£rv”.h
"

34 
	~"bio.h
"

51 
	#EVPOOL_SIZE
 16

	)

52 
	#EVPOOL_CACHED_SDS_SIZE
 255

	)

53 
	seviùiÚPoŞEÁry
 {

54 
	midË
;

55 
sds
 
	mkey
;

56 
sds
 
	mÿched
;

57 
	mdbid
;

60 
eviùiÚPoŞEÁry
 *
	gEviùiÚPoŞLRU
;

62 
LFUDeüAndR‘uº
(
robj
 *
o
);

71 
	$g‘LRUClock
() {

72  (
	`m¡ime
()/
LRU_CLOCK_RESOLUTION
è& 
LRU_CLOCK_MAX
;

73 
	}
}

77 
	$e¡im©eObjeùIdËTime
(
robj
 *
o
) {

78 
Ìuşock
 = 
	`LRU_CLOCK
();

79 ià(
Ìuşock
 >ğ
o
->
Ìu
) {

80  (
Ìuşock
 - 
o
->
Ìu
è* 
LRU_CLOCK_RESOLUTION
;

82  (
Ìuşock
 + (
LRU_CLOCK_MAX
 - 
o
->
Ìu
)) *

83 
LRU_CLOCK_RESOLUTION
;

85 
	}
}

126 
	$eviùiÚPoŞAÎoc
() {

127 
eviùiÚPoŞEÁry
 *
•
;

128 
j
;

130 
•
 = 
	`zm®loc
((*•)*
EVPOOL_SIZE
);

131 
j
 = 0; j < 
EVPOOL_SIZE
; j++) {

132 
•
[
j
].
idË
 = 0;

133 
•
[
j
].
key
 = 
NULL
;

134 
•
[
j
].
ÿched
 = 
	`sd¢ewËn
(
NULL
,
EVPOOL_CACHED_SDS_SIZE
);

135 
•
[
j
].
dbid
 = 0;

137 
EviùiÚPoŞLRU
 = 
•
;

138 
	}
}

149 
	$eviùiÚPoŞPİuÏ‹
(
dbid
, 
diù
 *
§m¶ediù
, diù *
keydiù
, 
eviùiÚPoŞEÁry
 *
poŞ
) {

150 
j
, 
k
, 
couÁ
;

151 
diùEÁry
 *
§m¶es
[
£rv”
.
maxmemÜy_§m¶es
];

153 
couÁ
 = 
	`diùG‘SomeKeys
(
§m¶ediù
,
§m¶es
,
£rv”
.
maxmemÜy_§m¶es
);

154 
j
 = 0; j < 
couÁ
; j++) {

155 
idË
;

156 
sds
 
key
;

157 
robj
 *
o
;

158 
diùEÁry
 *
de
;

160 
de
 = 
§m¶es
[
j
];

161 
key
 = 
	`diùG‘Key
(
de
);

166 ià(
£rv”
.
maxmemÜy_pŞicy
 !ğ
MAXMEMORY_VOLATILE_TTL
) {

167 ià(
§m¶ediù
 !ğ
keydiù
è
de
 = 
	`diùFšd
(keydiù, 
key
);

168 
o
 = 
	`diùG‘V®
(
de
);

174 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LRU
) {

175 
idË
 = 
	`e¡im©eObjeùIdËTime
(
o
);

176 } ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

184 
idË
 = 255-
	`LFUDeüAndR‘uº
(
o
);

185 } ià(
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_VOLATILE_TTL
) {

187 
idË
 = 
ULLONG_MAX
 - ()
	`diùG‘V®
(
de
);

189 
	`£rv”Pªic
("Unknownƒviction…olicy inƒvictionPoolPopulate()");

195 
k
 = 0;

196 
k
 < 
EVPOOL_SIZE
 &&

197 
poŞ
[
k
].
key
 &&

198 
poŞ
[
k
].
idË
 < idle) k++;

199 ià(
k
 =ğ0 && 
poŞ
[
EVPOOL_SIZE
-1].
key
 !ğ
NULL
) {

203 } ià(
k
 < 
EVPOOL_SIZE
 && 
poŞ
[k].
key
 =ğ
NULL
) {

208 ià(
poŞ
[
EVPOOL_SIZE
-1].
key
 =ğ
NULL
) {

213 
sds
 
ÿched
 = 
poŞ
[
EVPOOL_SIZE
-1].cached;

214 
	`memmove
(
poŞ
+
k
+1,pool+k,

215 (
poŞ
[0])*(
EVPOOL_SIZE
-
k
-1));

216 
poŞ
[
k
].
ÿched
 = cached;

219 
k
--;

222 
sds
 
ÿched
 = 
poŞ
[0].cached;

223 ià(
poŞ
[0].
key
 !ğpoŞ[0].
ÿched
è
	`sdsä“
(pool[0].key);

224 
	`memmove
(
poŞ
,poŞ+1,ÕoŞ[0])*
k
);

225 
poŞ
[
k
].
ÿched
 = cached;

233 
kËn
 = 
	`sd¦’
(
key
);

234 ià(
kËn
 > 
EVPOOL_CACHED_SDS_SIZE
) {

235 
poŞ
[
k
].
key
 = 
	`sdsdup
(key);

237 
	`memıy
(
poŞ
[
k
].
ÿched
,
key
,
kËn
+1);

238 
	`sds£’
(
poŞ
[
k
].
ÿched
,
kËn
);

239 
poŞ
[
k
].
key
 =…oŞ[k].
ÿched
;

241 
poŞ
[
k
].
idË
 = idle;

242 
poŞ
[
k
].
dbid
 = dbid;

244 
	}
}

286 
	$LFUG‘TimeInMšu‹s
() {

287  (
£rv”
.
unixtime
/60) & 65535;

288 
	}
}

294 
	$LFUTimeEÏp£d
(
ldt
) {

295 
now
 = 
	`LFUG‘TimeInMšu‹s
();

296 ià(
now
 >ğ
ldt
) ‚ow-ldt;

297  65535-
ldt
+
now
;

298 
	}
}

302 
ušt8_t
 
	$LFULogInü
(
ušt8_t
 
couÁ”
) {

303 ià(
couÁ”
 == 255)  255;

304 
r
 = ()
	`¿nd
()/
RAND_MAX
;

305 
ba£v®
 = 
couÁ”
 - 
LFU_INIT_VAL
;

306 ià(
ba£v®
 < 0) baseval = 0;

307 
p
 = 1.0/(
ba£v®
*
£rv”
.
lfu_log_çùÜ
+1);

308 ià(
r
 < 
p
è
couÁ”
++;

309  
couÁ”
;

310 
	}
}

318 
	#LFU_DECR_INTERVAL
 1

	)

319 
	$LFUDeüAndR‘uº
(
robj
 *
o
) {

320 
ldt
 = 
o
->
Ìu
 >> 8;

321 
couÁ”
 = 
o
->
Ìu
 & 255;

322 ià(
	`LFUTimeEÏp£d
(
ldt
è>ğ
£rv”
.
lfu_deÿy_time
 && 
couÁ”
) {

323 ià(
couÁ”
 > 
LFU_INIT_VAL
*2) {

324 
couÁ”
 /= 2;

325 ià(
couÁ”
 < 
LFU_INIT_VAL
*2) counter = LFU_INIT_VAL*2;

327 
couÁ”
--;

329 
o
->
Ìu
 = (
	`LFUG‘TimeInMšu‹s
()<<8è| 
couÁ”
;

331  
couÁ”
;

332 
	}
}

339 
	$ä“MemÜyIfN“ded
() {

340 
size_t
 
mem_»pÜ‹d
, 
mem_u£d
, 
mem_toä“
, 
mem_ä“d
;

341 
¦aves
 = 
	`li¡L’gth
(
£rv”
.slaves);

342 
m¡ime_t
 
Ï‹ncy
, 
eviùiÚ_Ï‹ncy
;

343 
d–
;

347 
mem_»pÜ‹d
 = 
	`zm®loc_u£d_memÜy
();

348 ià(
mem_»pÜ‹d
 <ğ
£rv”
.
maxmemÜy
è 
C_OK
;

352 
mem_u£d
 = 
mem_»pÜ‹d
;

353 ià(
¦aves
) {

354 
li¡I‹r
 
li
;

355 
li¡Node
 *
Ê
;

357 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

358 (
Ê
 = 
	`li¡Next
(&
li
))) {

359 
ş›Á
 *
¦ave
 = 
	`li¡NodeV®ue
(
Ê
);

360 
obuf_by‹s
 = 
	`g‘Cl›ÁOuutBufãrMemÜyU§ge
(
¦ave
);

361 ià(
obuf_by‹s
 > 
mem_u£d
)

362 
mem_u£d
 = 0;

364 
mem_u£d
 -ğ
obuf_by‹s
;

367 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

368 
mem_u£d
 -ğ
	`sd¦’
(
£rv”
.
aof_buf
);

369 
mem_u£d
 -ğ
	`aofRewr™eBufãrSize
();

373 ià(
mem_u£d
 <ğ
£rv”
.
maxmemÜy
è 
C_OK
;

376 
mem_toä“
 = 
mem_u£d
 - 
£rv”
.
maxmemÜy
;

377 
mem_ä“d
 = 0;

379 ià(
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_NO_EVICTION
)

380 
ÿÁ_ä“
;

382 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

383 
mem_ä“d
 < 
mem_toä“
) {

384 
j
, 
k
, 
i
, 
keys_ä“d
 = 0;

385 
Ãxt_db
 = 0;

386 
sds
 
be¡key
 = 
NULL
;

387 
be¡dbid
;

388 
»disDb
 *
db
;

389 
diù
 *dict;

390 
diùEÁry
 *
de
;

392 ià(
£rv”
.
maxmemÜy_pŞicy
 & (
MAXMEMORY_FLAG_LRU
|
MAXMEMORY_FLAG_LFU
) ||

393 
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_VOLATILE_TTL
)

395 
eviùiÚPoŞEÁry
 *
poŞ
 = 
EviùiÚPoŞLRU
;

397 
be¡key
 =ğ
NULL
) {

398 
tÙ®_keys
 = 0, 
keys
;

403 
i
 = 0; i < 
£rv”
.
dbnum
; i++) {

404 
db
 = 
£rv”
.db+
i
;

405 
diù
 = (
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_ALLKEYS
) ?

406 
db
->
diù
 : db->
expœes
;

407 ià((
keys
 = 
	`diùSize
(
diù
)) != 0) {

408 
	`eviùiÚPoŞPİuÏ‹
(
i
, 
diù
, 
db
->diù, 
poŞ
);

409 
tÙ®_keys
 +ğ
keys
;

412 ià(!
tÙ®_keys
) ;

415 
k
 = 
EVPOOL_SIZE
-1; k >= 0; k--) {

416 ià(
poŞ
[
k
].
key
 =ğ
NULL
) ;

417 
be¡dbid
 = 
poŞ
[
k
].
dbid
;

419 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_ALLKEYS
) {

420 
de
 = 
	`diùFšd
(
£rv”
.
db
[
poŞ
[
k
].
dbid
].
diù
,

421 
poŞ
[
k
].
key
);

423 
de
 = 
	`diùFšd
(
£rv”
.
db
[
poŞ
[
k
].
dbid
].
expœes
,

424 
poŞ
[
k
].
key
);

428 ià(
poŞ
[
k
].
key
 !ğpoŞ[k].
ÿched
)

429 
	`sdsä“
(
poŞ
[
k
].
key
);

430 
poŞ
[
k
].
key
 = 
NULL
;

431 
poŞ
[
k
].
idË
 = 0;

435 ià(
de
) {

436 
be¡key
 = 
	`diùG‘Key
(
de
);

446 ià(
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_ALLKEYS_RANDOM
 ||

447 
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_VOLATILE_RANDOM
)

452 
i
 = 0; i < 
£rv”
.
dbnum
; i++) {

453 
j
 = (++
Ãxt_db
è% 
£rv”
.
dbnum
;

454 
db
 = 
£rv”
.db+
j
;

455 
diù
 = (
£rv”
.
maxmemÜy_pŞicy
 =ğ
MAXMEMORY_ALLKEYS_RANDOM
) ?

456 
db
->
diù
 : db->
expœes
;

457 ià(
	`diùSize
(
diù
) != 0) {

458 
de
 = 
	`diùG‘RªdomKey
(
diù
);

459 
be¡key
 = 
	`diùG‘Key
(
de
);

460 
be¡dbid
 = 
j
;

467 ià(
be¡key
) {

468 
db
 = 
£rv”
.db+
be¡dbid
;

469 
robj
 *
keyobj
 = 
	`ü—‹SŒšgObjeù
(
be¡key
,
	`sd¦’
(bestkey));

470 
	`´İag©eExpœe
(
db
,
keyobj
,
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
);

479 
d–
 = (è
	`zm®loc_u£d_memÜy
();

480 
	`Ï‹ncyS¹MÚ™Ü
(
eviùiÚ_Ï‹ncy
);

481 ià(
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
)

482 
	`dbAsyncD–‘e
(
db
,
keyobj
);

484 
	`dbSyncD–‘e
(
db
,
keyobj
);

485 
	`Ï‹ncyEndMÚ™Ü
(
eviùiÚ_Ï‹ncy
);

486 
	`Ï‹ncyAddSam¶eIfN“ded
("eviùiÚ-d–",
eviùiÚ_Ï‹ncy
);

487 
	`Ï‹ncyRemoveNe¡edEv’t
(
Ï‹ncy
,
eviùiÚ_Ï‹ncy
);

488 
d–
 -ğ(è
	`zm®loc_u£d_memÜy
();

489 
mem_ä“d
 +ğ
d–
;

490 
£rv”
.
¡©_eviùedkeys
++;

491 
	`nÙifyKey¥aûEv’t
(
NOTIFY_EVICTED
, "evicted",

492 
keyobj
, 
db
->
id
);

493 
	`deüRefCouÁ
(
keyobj
);

494 
keys_ä“d
++;

500 ià(
¦aves
è
	`æushSÏvesOuutBufãrs
();

503 ià(!
keys_ä“d
) {

504 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

505 
	`Ï‹ncyAddSam¶eIfN“ded
("eviùiÚ-cyşe",
Ï‹ncy
);

506 
ÿÁ_ä“
;

509 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

510 
	`Ï‹ncyAddSam¶eIfN“ded
("eviùiÚ-cyşe",
Ï‹ncy
);

511  
C_OK
;

513 
ÿÁ_ä“
:

517 
	`bioP’dšgJobsOfTy³
(
BIO_LAZY_FREE
)) {

518 ià(((
mem_»pÜ‹d
 - 
	`zm®loc_u£d_memÜy
()è+ 
mem_ä“d
è>ğ
mem_toä“
)

520 
	`u¦“p
(1000);

522  
C_ERR
;

523 
	}
}

	@expire.c

33 
	~"£rv”.h
"

54 
	$aùiveExpœeCyşeTryExpœe
(
»disDb
 *
db
, 
diùEÁry
 *
de
, 
now
) {

55 
t
 = 
	`diùG‘SigÃdIÁeg”V®
(
de
);

56 ià(
now
 > 
t
) {

57 
sds
 
key
 = 
	`diùG‘Key
(
de
);

58 
robj
 *
keyobj
 = 
	`ü—‹SŒšgObjeù
(
key
,
	`sd¦’
(key));

60 
	`´İag©eExpœe
(
db
,
keyobj
,
£rv”
.
Ïzyä“_Ïzy_expœe
);

61 ià(
£rv”
.
Ïzyä“_Ïzy_expœe
)

62 
	`dbAsyncD–‘e
(
db
,
keyobj
);

64 
	`dbSyncD–‘e
(
db
,
keyobj
);

65 
	`nÙifyKey¥aûEv’t
(
NOTIFY_EXPIRED
,

66 "expœed",
keyobj
,
db
->
id
);

67 
	`deüRefCouÁ
(
keyobj
);

68 
£rv”
.
¡©_expœedkeys
++;

73 
	}
}

97 
	$aùiveExpœeCyşe
(
ty³
) {

100 
cu¼’t_db
 = 0;

101 
tim–im™_ex™
 = 0;

102 
Ï¡_ç¡_cyşe
 = 0;

104 
j
, 
™”©iÚ
 = 0;

105 
dbs_³r_ÿÎ
 = 
CRON_DBS_PER_CALL
;

106 
¡¬t
 = 
	`u¡ime
(), 
tim–im™
;

108 ià(
ty³
 =ğ
ACTIVE_EXPIRE_CYCLE_FAST
) {

112 ià(!
tim–im™_ex™
) ;

113 ià(
¡¬t
 < 
Ï¡_ç¡_cyşe
 + 
ACTIVE_EXPIRE_CYCLE_FAST_DURATION
*2) ;

114 
Ï¡_ç¡_cyşe
 = 
¡¬t
;

124 ià(
dbs_³r_ÿÎ
 > 
£rv”
.
dbnum
 || 
tim–im™_ex™
)

125 
dbs_³r_ÿÎ
 = 
£rv”
.
dbnum
;

131 
tim–im™
 = 1000000*
ACTIVE_EXPIRE_CYCLE_SLOW_TIME_PERC
/
£rv”
.
hz
/100;

132 
tim–im™_ex™
 = 0;

133 ià(
tim–im™
 <= 0)imelimit = 1;

135 ià(
ty³
 =ğ
ACTIVE_EXPIRE_CYCLE_FAST
)

136 
tim–im™
 = 
ACTIVE_EXPIRE_CYCLE_FAST_DURATION
;

138 
j
 = 0; j < 
dbs_³r_ÿÎ
; j++) {

139 
expœed
;

140 
»disDb
 *
db
 = 
£rv”
.db+(
cu¼’t_db
 % s”v”.
dbnum
);

145 
cu¼’t_db
++;

150 
num
, 
¦Ùs
;

151 
now
, 
‰l_sum
;

152 
‰l_§m¶es
;

155 ià((
num
 = 
	`diùSize
(
db
->
expœes
)) == 0) {

156 
db
->
avg_‰l
 = 0;

159 
¦Ùs
 = 
	`diùSlÙs
(
db
->
expœes
);

160 
now
 = 
	`m¡ime
();

165 ià(
num
 && 
¦Ùs
 > 
DICT_HT_INITIAL_SIZE
 &&

166 (
num
*100/
¦Ùs
 < 1)) ;

170 
expœed
 = 0;

171 
‰l_sum
 = 0;

172 
‰l_§m¶es
 = 0;

174 ià(
num
 > 
ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP
)

175 
num
 = 
ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP
;

177 
num
--) {

178 
diùEÁry
 *
de
;

179 
‰l
;

181 ià((
de
 = 
	`diùG‘RªdomKey
(
db
->
expœes
)è=ğ
NULL
) ;

182 
‰l
 = 
	`diùG‘SigÃdIÁeg”V®
(
de
)-
now
;

183 ià(
	`aùiveExpœeCyşeTryExpœe
(
db
,
de
,
now
)è
expœed
++;

184 ià(
‰l
 > 0) {

186 
‰l_sum
 +ğ
‰l
;

187 
‰l_§m¶es
++;

192 ià(
‰l_§m¶es
) {

193 
avg_‰l
 = 
‰l_sum
/
‰l_§m¶es
;

198 ià(
db
->
avg_‰l
 == 0) db->avg_ttl =‡vg_ttl;

199 
db
->
avg_‰l
 = (db->avg_ttl/50)*49 + (avg_ttl/50);

205 
™”©iÚ
++;

206 ià((
™”©iÚ
 & 0xf) == 0) {

207 
–­£d
 = 
	`u¡ime
()-
¡¬t
;

209 
	`Ï‹ncyAddSam¶eIfN“ded
("expœe-cyşe",
–­£d
/1000);

210 ià(
–­£d
 > 
tim–im™
è
tim–im™_ex™
 = 1;

212 ià(
tim–im™_ex™
) ;

215 } 
expœed
 > 
ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP
/4);

217 
	}
}

230 
	$expœeG’”icCommªd
(
ş›Á
 *
c
, 
ba£time
, 
un™
) {

231 
robj
 *
key
 = 
c
->
¬gv
[1], *
·¿m
 = c->argv[2];

232 
wh’
;

234 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, 
·¿m
, &
wh’
, 
NULL
è!ğ
C_OK
)

237 ià(
un™
 =ğ
UNIT_SECONDS
è
wh’
 *= 1000;

238 
wh’
 +ğ
ba£time
;

241 ià(
	`lookupKeyWr™e
(
c
->
db
,
key
è=ğ
NULL
) {

242 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

252 ià(
wh’
 <ğ
	`m¡ime
(è&& !
£rv”
.
lßdšg
 && !£rv”.
ma¡”ho¡
) {

253 
robj
 *
aux
;

255 
d–‘ed
 = 
£rv”
.
Ïzyä“_Ïzy_expœe
 ? 
	`dbAsyncD–‘e
(
c
->
db
,
key
) :

256 
	`dbSyncD–‘e
(
c
->
db
,
key
);

257 
	`£rv”As£¹W™hInfo
(
c
,
key
,
d–‘ed
);

258 
£rv”
.
dœty
++;

261 
aux
 = 
£rv”
.
Ïzyä“_Ïzy_expœe
 ? 
sh¬ed
.
uÆšk
 : sh¬ed.
d–
;

262 
	`»wr™eCl›ÁCommªdVeùÜ
(
c
,2,
aux
,
key
);

263 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

264 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
key
,
c
->
db
->
id
);

265 
	`addR•ly
(
c
, 
sh¬ed
.
cÚe
);

268 
	`£tExpœe
(
c
->
db
,
key
,
wh’
);

269 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

270 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

271 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"expœe",
key
,
c
->
db
->
id
);

272 
£rv”
.
dœty
++;

275 
	}
}

278 
	$expœeCommªd
(
ş›Á
 *
c
) {

279 
	`expœeG’”icCommªd
(
c
,
	`m¡ime
(),
UNIT_SECONDS
);

280 
	}
}

283 
	$expœ—tCommªd
(
ş›Á
 *
c
) {

284 
	`expœeG’”icCommªd
(
c
,0,
UNIT_SECONDS
);

285 
	}
}

288 
	$³xpœeCommªd
(
ş›Á
 *
c
) {

289 
	`expœeG’”icCommªd
(
c
,
	`m¡ime
(),
UNIT_MILLISECONDS
);

290 
	}
}

293 
	$³xpœ—tCommªd
(
ş›Á
 *
c
) {

294 
	`expœeG’”icCommªd
(
c
,0,
UNIT_MILLISECONDS
);

295 
	}
}

298 
	$‰lG’”icCommªd
(
ş›Á
 *
c
, 
ouut_ms
) {

299 
expœe
, 
‰l
 = -1;

302 ià(
	`lookupKeyR—dW™hFÏgs
(
c
->
db
,c->
¬gv
[1],
LOOKUP_NOTOUCH
è=ğ
NULL
) {

303 
	`addR•lyLÚgLÚg
(
c
,-2);

308 
expœe
 = 
	`g‘Expœe
(
c
->
db
,c->
¬gv
[1]);

309 ià(
expœe
 != -1) {

310 
‰l
 = 
expœe
-
	`m¡ime
();

311 ià(
‰l
 < 0)tl = 0;

313 ià(
‰l
 == -1) {

314 
	`addR•lyLÚgLÚg
(
c
,-1);

316 
	`addR•lyLÚgLÚg
(
c
,
ouut_ms
 ? 
‰l
 : ((ttl+500)/1000));

318 
	}
}

321 
	$‰lCommªd
(
ş›Á
 *
c
) {

322 
	`‰lG’”icCommªd
(
c
, 0);

323 
	}
}

326 
	$±Commªd
(
ş›Á
 *
c
) {

327 
	`‰lG’”icCommªd
(
c
, 1);

328 
	}
}

331 
	$³rsi¡Commªd
(
ş›Á
 *
c
) {

332 
diùEÁry
 *
de
;

334 
de
 = 
	`diùFšd
(
c
->
db
->
diù
,c->
¬gv
[1]->
±r
);

335 ià(
de
 =ğ
NULL
) {

336 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

338 ià(
	`»moveExpœe
(
c
->
db
,c->
¬gv
[1])) {

339 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

340 
£rv”
.
dœty
++;

342 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

345 
	}
}

348 
	$touchCommªd
(
ş›Á
 *
c
) {

349 
touched
 = 0;

350 
j
 = 1; j < 
c
->
¬gc
; j++)

351 ià(
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
j
]è!ğ
NULL
è
touched
++;

352 
	`addR•lyLÚgLÚg
(
c
,
touched
);

353 
	}
}

	@fmacros.h

30 #iâdeà
_REDIS_FMACRO_H


31 
	#_REDIS_FMACRO_H


	)

33 
	#_BSD_SOURCE


	)

35 #ià
defšed
(
__lšux__
)

36 
	#_GNU_SOURCE


	)

37 
	#_DEFAULT_SOURCE


	)

40 #ià
defšed
(
_AIX
)

41 
	#_ALL_SOURCE


	)

44 #ià
defšed
(
__lšux__
è|| defšed(
__O³nBSD__
)

45 
	#_XOPEN_SOURCE
 700

	)

50 #–ià!
defšed
(
__N‘BSD__
)

51 
	#_XOPEN_SOURCE


	)

54 #ià
defšed
(
__sun
)

55 
	#_POSIX_C_SOURCE
 199506L

	)

58 
	#_LARGEFILE_SOURCE


	)

59 
	#_FILE_OFFSET_BITS
 64

	)

	@geo.c

31 
	~"geo.h
"

32 
	~"geohash_h–³r.h
"

33 
	~"debugmaüo.h
"

37 *
zzlFœ¡InRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
);

38 
z¦V®ueL‹Max
(
v®ue
, 
z¿nge¥ec
 *
¥ec
);

53 
geoA¼ay
 *
	$geoA¼ayC»©e
() {

54 
geoA¼ay
 *
ga
 = 
	`zm®loc
((*ga));

56 
ga
->
¬¿y
 = 
NULL
;

57 
ga
->
buck‘s
 = 0;

58 
ga
->
u£d
 = 0;

59  
ga
;

60 
	}
}

64 
geoPošt
 *
	$geoA¼ayAµ’d
(
geoA¼ay
 *
ga
) {

65 ià(
ga
->
u£d
 =ğga->
buck‘s
) {

66 
ga
->
buck‘s
 = (ga->buckets == 0) ? 8 : ga->buckets*2;

67 
ga
->
¬¿y
 = 
	`z»®loc
(ga->¬¿y,(
geoPošt
)*ga->
buck‘s
);

69 
geoPošt
 *
gp
 = 
ga
->
¬¿y
+ga->
u£d
;

70 
ga
->
u£d
++;

71  
gp
;

72 
	}
}

75 
	$geoA¼ayF»e
(
geoA¼ay
 *
ga
) {

76 
size_t
 
i
;

77 
i
 = 0; i < 
ga
->
u£d
; i++è
	`sdsä“
(ga->
¬¿y
[i].
memb”
);

78 
	`zä“
(
ga
->
¬¿y
);

79 
	`zä“
(
ga
);

80 
	}
}

85 
	$decodeGeohash
(
b™s
, *
xy
) {

86 
GeoHashB™s
 
hash
 = { .
b™s
 = (
ušt64_t
)b™s, .
¡•
 = 
GEO_STEP_MAX
 };

87  
	`geohashDecodeToLÚgL©WGS84
(
hash
, 
xy
);

88 
	}
}

93 
	$exŒaùLÚgL©OrR•ly
(
ş›Á
 *
c
, 
robj
 **
¬gv
, *
xy
) {

94 
i
;

95 
i
 = 0; i < 2; i++) {

96 ià(
	`g‘DoubËFromObjeùOrR•ly
(
c
, 
¬gv
[
i
], 
xy
 + i, 
NULL
) !=

97 
C_OK
) {

98  
C_ERR
;

101 ià(
xy
[0] < 
GEO_LONG_MIN
 || xy[0] > 
GEO_LONG_MAX
 ||

102 
xy
[1] < 
GEO_LAT_MIN
 || xy[1] > 
GEO_LAT_MAX
) {

103 
	`addR•lySds
(
c
, 
	`sdsÿrštf
(
	`sd£m±y
(),

104 "-ERR inv®id†Úg™ude,Ït™ud·œ %f,%f\r\n",
xy
[0],xy[1]));

105  
C_ERR
;

107  
C_OK
;

108 
	}
}

113 
	$lÚgL©FromMemb”
(
robj
 *
zobj
,„obj *
memb”
, *
xy
) {

114 
scÜe
 = 0;

116 ià(
	`z£tScÜe
(
zobj
, 
memb”
->
±r
, &
scÜe
è=ğ
C_ERR
)  C_ERR;

117 ià(!
	`decodeGeohash
(
scÜe
, 
xy
)è 
C_ERR
;

118  
C_OK
;

119 
	}
}

127 
	$exŒaùUn™OrR•ly
(
ş›Á
 *
c
, 
robj
 *
un™
) {

128 *
u
 = 
un™
->
±r
;

130 ià(!
	`¡rcmp
(
u
, "m")) {

132 } ià(!
	`¡rcmp
(
u
, "km")) {

134 } ià(!
	`¡rcmp
(
u
, "ft")) {

136 } ià(!
	`¡rcmp
(
u
, "mi")) {

139 
	`addR•lyE¼Ü
(
c
,

143 
	}
}

152 
	$exŒaùDi¡ªûOrR•ly
(
ş›Á
 *
c
, 
robj
 **
¬gv
,

153 *
cÚv”siÚ
) {

154 
di¡ªû
;

155 ià(
	`g‘DoubËFromObjeùOrR•ly
(
c
, 
¬gv
[0], &
di¡ªû
,

156 "Ãed‚um”iø¿dius"è!ğ
C_OK
) {

160 ià(
di¡ªû
 < 0) {

161 
	`addR•lyE¼Ü
(
c
,"radius cannot be‚egative");

165 
to_m‘”s
 = 
	`exŒaùUn™OrR•ly
(
c
,
¬gv
[1]);

166 ià(
to_m‘”s
 < 0) {

170 ià(
cÚv”siÚ
è*cÚv”siÚ = 
to_m‘”s
;

171  
di¡ªû
 * 
to_m‘”s
;

172 
	}
}

179 
	$addR•lyDoubËDi¡ªû
(
ş›Á
 *
c
, 
d
) {

180 
dbuf
[128];

181 
dËn
 = 
	`¢´štf
(
dbuf
, (dbuf), "%.4f", 
d
);

182 
	`addR•lyBulkCBufãr
(
c
, 
dbuf
, 
dËn
);

183 
	}
}

191 
	$geoAµ’dIfW™hšRadius
(
geoA¼ay
 *
ga
, 
lÚ
, 
Ït
, 
¿dius
, 
scÜe
, 
sds
 
memb”
) {

192 
di¡ªû
, 
xy
[2];

194 ià(!
	`decodeGeohash
(
scÜe
,
xy
)è 
C_ERR
;

197 ià(!
	`geohashG‘Di¡ªûIfInRadiusWGS84
(
lÚ
,
Ït
, 
xy
[0], xy[1],

198 
¿dius
, &
di¡ªû
))

200  
C_ERR
;

204 
geoPošt
 *
gp
 = 
	`geoA¼ayAµ’d
(
ga
);

205 
gp
->
lÚg™ude
 = 
xy
[0];

206 
gp
->
Ït™ude
 = 
xy
[1];

207 
gp
->
di¡
 = 
di¡ªû
;

208 
gp
->
memb”
 = member;

209 
gp
->
scÜe
 = score;

210  
C_OK
;

211 
	}
}

225 
	$geoG‘PoštsInRªge
(
robj
 *
zobj
, 
mš
, 
max
, 
lÚ
, 
Ït
, 
¿dius
, 
geoA¼ay
 *
ga
) {

228 
z¿nge¥ec
 
¿nge
 = { .
mš
 = mš, .
max
 = max, .
mšex
 = 0, .
maxex
 = 1 };

229 
size_t
 
ÜigšcouÁ
 = 
ga
->
u£d
;

230 
sds
 
memb”
;

232 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

233 *
zl
 = 
zobj
->
±r
;

234 *
•Œ
, *
¥Œ
;

235 *
v¡r
 = 
NULL
;

236 
vËn
 = 0;

237 
vlÚg
 = 0;

238 
scÜe
 = 0;

240 ià((
•Œ
 = 
	`zzlFœ¡InRªge
(
zl
, &
¿nge
)è=ğ
NULL
) {

245 
¥Œ
 = 
	`zli¡Next
(
zl
, 
•Œ
);

246 
•Œ
) {

247 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

250 ià(!
	`z¦V®ueL‹Max
(
scÜe
, &
¿nge
))

254 
	`zli¡G‘
(
•Œ
, &
v¡r
, &
vËn
, &
vlÚg
);

255 
memb”
 = (
v¡r
 =ğ
NULL
è? 
	`sdsäomlÚglÚg
(
vlÚg
) :

256 
	`sd¢ewËn
(
v¡r
,
vËn
);

257 ià(
	`geoAµ’dIfW™hšRadius
(
ga
,
lÚ
,
Ït
,
¿dius
,
scÜe
,
memb”
)

258 =ğ
C_ERR
è
	`sdsä“
(
memb”
);

259 
	`zzlNext
(
zl
, &
•Œ
, &
¥Œ
);

261 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

262 
z£t
 *
zs
 = 
zobj
->
±r
;

263 
zskli¡
 *
z¦
 = 
zs
->zsl;

264 
zskli¡Node
 *
Ê
;

266 ià((
Ê
 = 
	`z¦Fœ¡InRªge
(
z¦
, &
¿nge
)è=ğ
NULL
) {

271 
Ê
) {

272 
sds
 
–e
 = 
Ê
->ele;

274 ià(!
	`z¦V®ueL‹Max
(
Ê
->
scÜe
, &
¿nge
))

277 
–e
 = 
	`sdsdup
(ele);

278 ià(
	`geoAµ’dIfW™hšRadius
(
ga
,
lÚ
,
Ït
,
¿dius
,
Ê
->
scÜe
,
–e
)

279 =ğ
C_ERR
è
	`sdsä“
(
–e
);

280 
Ê
 =†n->
Ëv–
[0].
fÜw¬d
;

283  
ga
->
u£d
 - 
ÜigšcouÁ
;

284 
	}
}

289 
	$scÜesOfGeoHashBox
(
GeoHashB™s
 
hash
, 
GeoHashFix52B™s
 *
mš
, GeoHashFix52B™ *
max
) {

310 *
mš
 = 
	`geohashAlign52B™s
(
hash
);

311 
hash
.
b™s
++;

312 *
max
 = 
	`geohashAlign52B™s
(
hash
);

313 
	}
}

318 
	$memb”sOfGeoHashBox
(
robj
 *
zobj
, 
GeoHashB™s
 
hash
, 
geoA¼ay
 *
ga
, 
lÚ
, 
Ït
, 
¿dius
) {

319 
GeoHashFix52B™s
 
mš
, 
max
;

321 
	`scÜesOfGeoHashBox
(
hash
,&
mš
,&
max
);

322  
	`geoG‘PoštsInRªge
(
zobj
, 
mš
, 
max
, 
lÚ
, 
Ït
, 
¿dius
, 
ga
);

323 
	}
}

326 
	$memb”sOfAÎNeighbÜs
(
robj
 *
zobj
, 
GeoHashRadius
 
n
, 
lÚ
, 
Ït
, 
¿dius
, 
geoA¼ay
 *
ga
) {

327 
GeoHashB™s
 
ÃighbÜs
[9];

328 
i
, 
couÁ
 = 0, 
Ï¡_´oûs£d
 = 0;

330 
ÃighbÜs
[0] = 
n
.
hash
;

331 
ÃighbÜs
[1] = 
n
.ÃighbÜs.
nÜth
;

332 
ÃighbÜs
[2] = 
n
.ÃighbÜs.
south
;

333 
ÃighbÜs
[3] = 
n
.ÃighbÜs.
—¡
;

334 
ÃighbÜs
[4] = 
n
.ÃighbÜs.
we¡
;

335 
ÃighbÜs
[5] = 
n
.ÃighbÜs.
nÜth_—¡
;

336 
ÃighbÜs
[6] = 
n
.ÃighbÜs.
nÜth_we¡
;

337 
ÃighbÜs
[7] = 
n
.ÃighbÜs.
south_—¡
;

338 
ÃighbÜs
[8] = 
n
.ÃighbÜs.
south_we¡
;

342 
i
 = 0; i < (
ÃighbÜs
) / (*neighbors); i++) {

343 ià(
	`HASHISZERO
(
ÃighbÜs
[
i
]))

350 ià(
Ï¡_´oûs£d
 &&

351 
ÃighbÜs
[
i
].
b™s
 =ğÃighbÜs[
Ï¡_´oûs£d
].bits &&

352 
ÃighbÜs
[
i
].
¡•
 =ğÃighbÜs[
Ï¡_´oûs£d
].step)

354 
couÁ
 +ğ
	`memb”sOfGeoHashBox
(
zobj
, 
ÃighbÜs
[
i
], 
ga
, 
lÚ
, 
Ït
, 
¿dius
);

355 
Ï¡_´oûs£d
 = 
i
;

357  
couÁ
;

358 
	}
}

361 
	$sÜt_gp_asc
(cÚ¡ *
a
, cÚ¡ *
b
) {

362 cÚ¡ 
geoPošt
 *
g·
 = 
a
, *
gpb
 = 
b
;

365 ià(
g·
->
di¡
 > 
gpb
->dist)

367 ià(
g·
->
di¡
 =ğ
gpb
->dist)

371 
	}
}

373 
	$sÜt_gp_desc
(cÚ¡ *
a
, cÚ¡ *
b
) {

374  -
	`sÜt_gp_asc
(
a
, 
b
);

375 
	}
}

382 
	$geßddCommªd
(
ş›Á
 *
c
) {

384 ià((
c
->
¬gc
 - 2) % 3 != 0) {

386 
	`addR•lyE¼Ü
(
c
, "syntaxƒrror. Try GEOADD key [x1] [y1] [name1] "

391 
–em’ts
 = (
c
->
¬gc
 - 2) / 3;

392 
¬gc
 = 2+
–em’ts
*2;

393 
robj
 **
¬gv
 = 
	`zÿÎoc
(
¬gc
*(robj*));

394 
¬gv
[0] = 
	`ü—‹RawSŒšgObjeù
("zadd",4);

395 
¬gv
[1] = 
c
->argv[1];

396 
	`šüRefCouÁ
(
¬gv
[1]);

401 
i
;

402 
i
 = 0; i < 
–em’ts
; i++) {

403 
xy
[2];

405 ià(
	`exŒaùLÚgL©OrR•ly
(
c
, (c->
¬gv
+2)+(
i
*3),
xy
è=ğ
C_ERR
) {

406 
i
 = 0; i < 
¬gc
; i++)

407 ià(
¬gv
[
i
]è
	`deüRefCouÁ
(argv[i]);

408 
	`zä“
(
¬gv
);

413 
GeoHashB™s
 
hash
;

414 
	`geohashEncodeWGS84
(
xy
[0], xy[1], 
GEO_STEP_MAX
, &
hash
);

415 
GeoHashFix52B™s
 
b™s
 = 
	`geohashAlign52B™s
(
hash
);

416 
robj
 *
scÜe
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
	`sdsäomlÚglÚg
(
b™s
));

417 
robj
 *
v®
 = 
c
->
¬gv
[2 + 
i
 * 3 + 2];

418 
¬gv
[2+
i
*2] = 
scÜe
;

419 
¬gv
[3+
i
*2] = 
v®
;

420 
	`šüRefCouÁ
(
v®
);

424 
	`»¶aûCl›ÁCommªdVeùÜ
(
c
,
¬gc
,
¬gv
);

425 
	`zaddCommªd
(
c
);

426 
	}
}

428 
	#SORT_NONE
 0

	)

429 
	#SORT_ASC
 1

	)

430 
	#SORT_DESC
 2

	)

432 
	#RADIUS_COORDS
 1

	)

433 
	#RADIUS_MEMBER
 2

	)

438 
	$geÜadiusG’”ic
(
ş›Á
 *
c
, 
ty³
) {

439 
robj
 *
key
 = 
c
->
¬gv
[1];

440 
robj
 *
¡Üekey
 = 
NULL
;

441 
¡Üedi¡
 = 0;

444 
robj
 *
zobj
 = 
NULL
;

445 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, 
key
, 
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL
 ||

446 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
)) {

451 
ba£_¬gs
;

452 
xy
[2] = { 0 };

453 ià(
ty³
 =ğ
RADIUS_COORDS
) {

454 
ba£_¬gs
 = 6;

455 ià(
	`exŒaùLÚgL©OrR•ly
(
c
, c->
¬gv
 + 2, 
xy
è=ğ
C_ERR
)

457 } ià(
ty³
 =ğ
RADIUS_MEMBER
) {

458 
ba£_¬gs
 = 5;

459 
robj
 *
memb”
 = 
c
->
¬gv
[2];

460 ià(
	`lÚgL©FromMemb”
(
zobj
, 
memb”
, 
xy
è=ğ
C_ERR
) {

461 
	`addR•lyE¼Ü
(
c
, "could‚ot decode„equested zset member");

465 
	`addR•lyE¼Ü
(
c
, "unknown georadius searchype");

470 
¿dius_m‘”s
 = 0, 
cÚv”siÚ
 = 1;

471 ià((
¿dius_m‘”s
 = 
	`exŒaùDi¡ªûOrR•ly
(
c
, c->
¬gv
 + 
ba£_¬gs
 - 2,

472 &
cÚv”siÚ
)) < 0) {

477 
w™hdi¡
 = 0, 
w™hhash
 = 0, 
w™hcoÜds
 = 0;

478 
sÜt
 = 
SORT_NONE
;

479 
couÁ
 = 0;

480 ià(
c
->
¬gc
 > 
ba£_¬gs
) {

481 
»maššg
 = 
c
->
¬gc
 - 
ba£_¬gs
;

482 
i
 = 0; i < 
»maššg
; i++) {

483 *
¬g
 = 
c
->
¬gv
[
ba£_¬gs
 + 
i
]->
±r
;

484 ià(!
	`¡rÿ£cmp
(
¬g
, "withdist")) {

485 
w™hdi¡
 = 1;

486 } ià(!
	`¡rÿ£cmp
(
¬g
, "withhash")) {

487 
w™hhash
 = 1;

488 } ià(!
	`¡rÿ£cmp
(
¬g
, "withcoord")) {

489 
w™hcoÜds
 = 1;

490 } ià(!
	`¡rÿ£cmp
(
¬g
, "asc")) {

491 
sÜt
 = 
SORT_ASC
;

492 } ià(!
	`¡rÿ£cmp
(
¬g
, "desc")) {

493 
sÜt
 = 
SORT_DESC
;

494 } ià(!
	`¡rÿ£cmp
(
¬g
, "couÁ"è&& (
i
+1è< 
»maššg
) {

495 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
ba£_¬gs
+
i
+1],

496 &
couÁ
, 
NULL
è!ğ
C_OK
) ;

497 ià(
couÁ
 <= 0) {

498 
	`addR•lyE¼Ü
(
c
,"COUNT must be > 0");

501 
i
++;

502 } ià(!
	`¡rÿ£cmp
(
¬g
, "¡Üe"è&& (
i
+1è< 
»maššg
) {

503 
¡Üekey
 = 
c
->
¬gv
[
ba£_¬gs
+
i
+1];

504 
¡Üedi¡
 = 0;

505 
i
++;

506 } ià(!
	`¡rÿ£cmp
(
¬g
, "¡Üedi¡"è&& (
i
+1è< 
»maššg
) {

507 
¡Üekey
 = 
c
->
¬gv
[
ba£_¬gs
+
i
+1];

508 
¡Üedi¡
 = 1;

509 
i
++;

511 
	`addR•ly
(
c
, 
sh¬ed
.
syÁax”r
);

518 ià(
¡Üekey
 && (
w™hdi¡
 || 
w™hhash
 || 
w™hcoÜds
)) {

519 
	`addR•lyE¼Ü
(
c
,

527 ià(
couÁ
 !ğ0 && 
sÜt
 =ğ
SORT_NONE
èsÜˆğ
SORT_ASC
;

530 
GeoHashRadius
 
geÜadius
 =

531 
	`geohashG‘A»asByRadiusWGS84
(
xy
[0], xy[1], 
¿dius_m‘”s
);

534 
geoA¼ay
 *
ga
 = 
	`geoA¼ayC»©e
();

535 
	`memb”sOfAÎNeighbÜs
(
zobj
, 
geÜadius
, 
xy
[0], xy[1], 
¿dius_m‘”s
, 
ga
);

538 ià(
ga
->
u£d
 =ğ0 && 
¡Üekey
 =ğ
NULL
) {

539 
	`addR•ly
(
c
, 
sh¬ed
.
em±ymuÉibulk
);

540 
	`geoA¼ayF»e
(
ga
);

544 
»suÉ_Ëngth
 = 
ga
->
u£d
;

545 
»tuºed_™ems
 = (
couÁ
 =ğ0 || 
»suÉ_Ëngth
 < count) ?

546 
»suÉ_Ëngth
 : 
couÁ
;

547 
İtiÚ_Ëngth
 = 0;

550 ià(
sÜt
 =ğ
SORT_ASC
) {

551 
	`qsÜt
(
ga
->
¬¿y
, 
»suÉ_Ëngth
, (
geoPošt
), 
sÜt_gp_asc
);

552 } ià(
sÜt
 =ğ
SORT_DESC
) {

553 
	`qsÜt
(
ga
->
¬¿y
, 
»suÉ_Ëngth
, (
geoPošt
), 
sÜt_gp_desc
);

556 ià(
¡Üekey
 =ğ
NULL
) {

561 ià(
w™hdi¡
)

562 
İtiÚ_Ëngth
++;

564 ià(
w™hcoÜds
)

565 
İtiÚ_Ëngth
++;

567 ià(
w™hhash
)

568 
İtiÚ_Ëngth
++;

574 
	`addR•lyMuÉiBulkL’
(
c
, 
»tuºed_™ems
);

577 
i
;

578 
i
 = 0; i < 
»tuºed_™ems
; i++) {

579 
geoPošt
 *
gp
 = 
ga
->
¬¿y
+
i
;

580 
gp
->
di¡
 /ğ
cÚv”siÚ
;

585 ià(
İtiÚ_Ëngth
)

586 
	`addR•lyMuÉiBulkL’
(
c
, 
İtiÚ_Ëngth
 + 1);

588 
	`addR•lyBulkSds
(
c
,
gp
->
memb”
);

589 
gp
->
memb”
 = 
NULL
;

591 ià(
w™hdi¡
)

592 
	`addR•lyDoubËDi¡ªû
(
c
, 
gp
->
di¡
);

594 ià(
w™hhash
)

595 
	`addR•lyLÚgLÚg
(
c
, 
gp
->
scÜe
);

597 ià(
w™hcoÜds
) {

598 
	`addR•lyMuÉiBulkL’
(
c
, 2);

599 
	`addR•lyHumªLÚgDoubË
(
c
, 
gp
->
lÚg™ude
);

600 
	`addR•lyHumªLÚgDoubË
(
c
, 
gp
->
Ït™ude
);

605 
robj
 *
zobj
;

606 
z£t
 *
zs
;

607 
i
;

608 
size_t
 
max––’
 = 0;

610 ià(
»tuºed_™ems
) {

611 
zobj
 = 
	`ü—‹Z£tObjeù
();

612 
zs
 = 
zobj
->
±r
;

615 
i
 = 0; i < 
»tuºed_™ems
; i++) {

616 
zskli¡Node
 *
znode
;

617 
geoPošt
 *
gp
 = 
ga
->
¬¿y
+
i
;

618 
gp
->
di¡
 /ğ
cÚv”siÚ
;

619 
scÜe
 = 
¡Üedi¡
 ? 
gp
->
di¡
 : gp->score;

620 
size_t
 
––’
 = 
	`sd¦’
(
gp
->
memb”
);

622 ià(
max––’
 < 
––’
) maxelelen =ƒlelen;

623 
znode
 = 
	`z¦In£¹
(
zs
->
z¦
,
scÜe
,
gp
->
memb”
);

624 
	`£rv”As£¹
(
	`diùAdd
(
zs
->
diù
,
gp
->
memb”
,&
znode
->
scÜe
è=ğ
DICT_OK
);

625 
gp
->
memb”
 = 
NULL
;

628 ià(
»tuºed_™ems
) {

629 
	`z£tCÚv”tToZli¡IfN“ded
(
zobj
,
max––’
);

630 
	`£tKey
(
c
->
db
,
¡Üekey
,
zobj
);

631 
	`deüRefCouÁ
(
zobj
);

632 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"geÜadius¡Üe",
¡Üekey
,

633 
c
->
db
->
id
);

634 
£rv”
.
dœty
 +ğ
»tuºed_™ems
;

635 } ià(
	`dbD–‘e
(
c
->
db
,
¡Üekey
)) {

636 
	`sigÇlModif›dKey
(
c
->
db
,
¡Üekey
);

637 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
¡Üekey
,
c
->
db
->
id
);

638 
£rv”
.
dœty
++;

640 
	`addR•lyLÚgLÚg
(
c
, 
»tuºed_™ems
);

642 
	`geoA¼ayF»e
(
ga
);

643 
	}
}

646 
	$geÜadiusCommªd
(
ş›Á
 *
c
) {

647 
	`geÜadiusG’”ic
(
c
, 
RADIUS_COORDS
);

648 
	}
}

651 
	$geÜadiusByMemb”Commªd
(
ş›Á
 *
c
) {

652 
	`geÜadiusG’”ic
(
c
, 
RADIUS_MEMBER
);

653 
	}
}

659 
	$geohashCommªd
(
ş›Á
 *
c
) {

660 *
geßÍhab‘
= "0123456789bcdefghjkmnpqrstuvwxyz";

661 
j
;

664 
robj
 *
zobj
 = 
NULL
;

665 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, c->
¬gv
[1], 
sh¬ed
.
em±ymuÉibulk
))

666 =ğ
NULL
 || 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
)) ;

670 
	`addR•lyMuÉiBulkL’
(
c
,c->
¬gc
-2);

671 
j
 = 2; j < 
c
->
¬gc
; j++) {

672 
scÜe
;

673 ià(
	`z£tScÜe
(
zobj
, 
c
->
¬gv
[
j
]->
±r
, &
scÜe
è=ğ
C_ERR
) {

674 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

683 
xy
[2];

684 ià(!
	`decodeGeohash
(
scÜe
,
xy
)) {

685 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

690 
GeoHashRªge
 
r
[2];

691 
GeoHashB™s
 
hash
;

692 
r
[0].
mš
 = -180;

693 
r
[0].
max
 = 180;

694 
r
[1].
mš
 = -90;

695 
r
[1].
max
 = 90;

696 
	`geohashEncode
(&
r
[0],&r[1],
xy
[0],xy[1],26,&
hash
);

698 
buf
[12];

699 
i
;

700 
i
 = 0; i < 11; i++) {

701 
idx
 = (
hash
.
b™s
 >> (52-((
i
+1)*5))) & 0x1f;

702 
buf
[
i
] = 
geßÍhab‘
[
idx
];

704 
buf
[11] = '\0';

705 
	`addR•lyBulkCBufãr
(
c
,
buf
,11);

708 
	}
}

714 
	$geİosCommªd
(
ş›Á
 *
c
) {

715 
j
;

718 
robj
 *
zobj
 = 
NULL
;

719 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, c->
¬gv
[1], 
sh¬ed
.
em±ymuÉibulk
))

720 =ğ
NULL
 || 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
)) ;

724 
	`addR•lyMuÉiBulkL’
(
c
,c->
¬gc
-2);

725 
j
 = 2; j < 
c
->
¬gc
; j++) {

726 
scÜe
;

727 ià(
	`z£tScÜe
(
zobj
, 
c
->
¬gv
[
j
]->
±r
, &
scÜe
è=ğ
C_ERR
) {

728 
	`addR•ly
(
c
,
sh¬ed
.
nuÎmuÉibulk
);

731 
xy
[2];

732 ià(!
	`decodeGeohash
(
scÜe
,
xy
)) {

733 
	`addR•ly
(
c
,
sh¬ed
.
nuÎmuÉibulk
);

736 
	`addR•lyMuÉiBulkL’
(
c
,2);

737 
	`addR•lyHumªLÚgDoubË
(
c
,
xy
[0]);

738 
	`addR•lyHumªLÚgDoubË
(
c
,
xy
[1]);

741 
	}
}

748 
	$geodi¡Commªd
(
ş›Á
 *
c
) {

749 
to_m‘”
 = 1;

752 ià(
c
->
¬gc
 == 5) {

753 
to_m‘”
 = 
	`exŒaùUn™OrR•ly
(
c
,c->
¬gv
[4]);

754 ià(
to_m‘”
 < 0) ;

755 } ià(
c
->
¬gc
 > 5) {

756 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

761 
robj
 *
zobj
 = 
NULL
;

762 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, c->
¬gv
[1], 
sh¬ed
.
em±ybulk
))

763 =ğ
NULL
 || 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
)) ;

766 
scÜe1
, 
scÜe2
, 
xyxy
[4];

767 ià(
	`z£tScÜe
(
zobj
, 
c
->
¬gv
[2]->
±r
, &
scÜe1
è=ğ
C_ERR
 ||

768 
	`z£tScÜe
(
zobj
, 
c
->
¬gv
[3]->
±r
, &
scÜe2
è=ğ
C_ERR
)

770 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

775 ià(!
	`decodeGeohash
(
scÜe1
,
xyxy
è|| !decodeGeohash(
scÜe2
,xyxy+2))

776 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

778 
	`addR•lyDoubËDi¡ªû
(
c
,

779 
	`geohashG‘Di¡ªû
(
xyxy
[0],xyxy[1],xyxy[2],xyxy[3]è/ 
to_m‘”
);

780 
	}
}

	@geo.h

1 #iâdeà
__GEO_H__


2 
	#__GEO_H__


	)

4 
	~"£rv”.h
"

8 
	sgeoPošt
 {

9 
	mlÚg™ude
;

10 
	mÏt™ude
;

11 
	mdi¡
;

12 
	mscÜe
;

13 *
	mmemb”
;

14 } 
	tgeoPošt
;

16 
	sgeoA¼ay
 {

17 
geoPošt
 *
	m¬¿y
;

18 
size_t
 
	mbuck‘s
;

19 
size_t
 
	mu£d
;

20 } 
	tgeoA¼ay
;

	@geohash.c

31 
	~"geohash.h
"

52 
šlše
 
ušt64_t
 
	$š‹¾—ve64
(
ušt32_t
 
xlo
, ušt32_ˆ
ylo
) {

53 cÚ¡ 
ušt64_t
 
B
[] = {0x5555555555555555ULL, 0x3333333333333333ULL,

56 cÚ¡ 
S
[] = {1, 2, 4, 8, 16};

58 
ušt64_t
 
x
 = 
xlo
;

59 
ušt64_t
 
y
 = 
ylo
;

61 
x
 = (x | (x << 
S
[4])è& 
B
[4];

62 
y
 = (y | (y << 
S
[4])è& 
B
[4];

64 
x
 = (x | (x << 
S
[3])è& 
B
[3];

65 
y
 = (y | (y << 
S
[3])è& 
B
[3];

67 
x
 = (x | (x << 
S
[2])è& 
B
[2];

68 
y
 = (y | (y << 
S
[2])è& 
B
[2];

70 
x
 = (x | (x << 
S
[1])è& 
B
[1];

71 
y
 = (y | (y << 
S
[1])è& 
B
[1];

73 
x
 = (x | (x << 
S
[0])è& 
B
[0];

74 
y
 = (y | (y << 
S
[0])è& 
B
[0];

76  
x
 | (
y
 << 1);

77 
	}
}

82 
šlše
 
ušt64_t
 
	$deš‹¾—ve64
(
ušt64_t
 
š‹¾—ved
) {

83 cÚ¡ 
ušt64_t
 
B
[] = {0x5555555555555555ULL, 0x3333333333333333ULL,

86 cÚ¡ 
S
[] = {0, 1, 2, 4, 8, 16};

88 
ušt64_t
 
x
 = 
š‹¾—ved
;

89 
ušt64_t
 
y
 = 
š‹¾—ved
 >> 1;

91 
x
 = (x | (x >> 
S
[0])è& 
B
[0];

92 
y
 = (y | (y >> 
S
[0])è& 
B
[0];

94 
x
 = (x | (x >> 
S
[1])è& 
B
[1];

95 
y
 = (y | (y >> 
S
[1])è& 
B
[1];

97 
x
 = (x | (x >> 
S
[2])è& 
B
[2];

98 
y
 = (y | (y >> 
S
[2])è& 
B
[2];

100 
x
 = (x | (x >> 
S
[3])è& 
B
[3];

101 
y
 = (y | (y >> 
S
[3])è& 
B
[3];

103 
x
 = (x | (x >> 
S
[4])è& 
B
[4];

104 
y
 = (y | (y >> 
S
[4])è& 
B
[4];

106 
x
 = (x | (x >> 
S
[5])è& 
B
[5];

107 
y
 = (y | (y >> 
S
[5])è& 
B
[5];

109  
x
 | (
y
 << 32);

110 
	}
}

112 
	$geohashG‘CoÜdRªge
(
GeoHashRªge
 *
lÚg_¿nge
, GeoHashRªg*
Ït_¿nge
) {

115 
lÚg_¿nge
->
max
 = 
GEO_LONG_MAX
;

116 
lÚg_¿nge
->
mš
 = 
GEO_LONG_MIN
;

117 
Ït_¿nge
->
max
 = 
GEO_LAT_MAX
;

118 
Ït_¿nge
->
mš
 = 
GEO_LAT_MIN
;

119 
	}
}

121 
	$geohashEncode
(cÚ¡ 
GeoHashRªge
 *
lÚg_¿nge
, cÚ¡ GeoHashRªg*
Ït_¿nge
,

122 
lÚg™ude
, 
Ït™ude
, 
ušt8_t
 
¡•
,

123 
GeoHashB™s
 *
hash
) {

125 ià(
hash
 =ğ
NULL
 || 
¡•
 > 32 || step == 0 ||

126 
	`RANGEPISZERO
(
Ït_¿nge
è|| RANGEPISZERO(
lÚg_¿nge
))  0;

130 ià(
lÚg™ude
 > 180 ||†ongitude < -180 ||

131 
Ït™ude
 > 85.05112878 ||†atitude < -85.05112878)  0;

133 
hash
->
b™s
 = 0;

134 
hash
->
¡•
 = step;

136 ià(
Ït™ude
 < 
Ït_¿nge
->
mš
 ||†©™ud>†©_¿nge->
max
 ||

137 
lÚg™ude
 < 
lÚg_¿nge
->
mš
 ||†Úg™ud>†Úg_¿nge->
max
) {

141 
Ït_off£t
 =

142 (
Ït™ude
 - 
Ït_¿nge
->
mš
è/ (Ït_¿nge->
max
 -†at_range->min);

143 
lÚg_off£t
 =

144 (
lÚg™ude
 - 
lÚg_¿nge
->
mš
è/ (lÚg_¿nge->
max
 -†ong_range->min);

147 
Ït_off£t
 *ğ(1 << 
¡•
);

148 
lÚg_off£t
 *ğ(1 << 
¡•
);

149 
hash
->
b™s
 = 
	`š‹¾—ve64
(
Ït_off£t
, 
lÚg_off£t
);

151 
	}
}

153 
	$geohashEncodeTy³
(
lÚg™ude
, 
Ït™ude
, 
ušt8_t
 
¡•
, 
GeoHashB™s
 *
hash
) {

154 
GeoHashRªge
 
r
[2] = {{0}};

155 
	`geohashG‘CoÜdRªge
(&
r
[0], &r[1]);

156  
	`geohashEncode
(&
r
[0], &r[1], 
lÚg™ude
, 
Ït™ude
, 
¡•
, 
hash
);

157 
	}
}

159 
	$geohashEncodeWGS84
(
lÚg™ude
, 
Ït™ude
, 
ušt8_t
 
¡•
,

160 
GeoHashB™s
 *
hash
) {

161  
	`geohashEncodeTy³
(
lÚg™ude
, 
Ït™ude
, 
¡•
, 
hash
);

162 
	}
}

164 
	$geohashDecode
(cÚ¡ 
GeoHashRªge
 
lÚg_¿nge
, cÚ¡ GeoHashRªg
Ït_¿nge
,

165 cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
) {

166 ià(
	`HASHISZERO
(
hash
è|| 
NULL
 =ğ
¬—
 || 
	`RANGEISZERO
(
Ït_¿nge
) ||

167 
	`RANGEISZERO
(
lÚg_¿nge
)) {

171 
¬—
->
hash
 = hash;

172 
ušt8_t
 
¡•
 = 
hash
.step;

173 
ušt64_t
 
hash_£p
 = 
	`deš‹¾—ve64
(
hash
.
b™s
);

175 
Ït_sÿË
 = 
Ït_¿nge
.
max
 -†©_¿nge.
mš
;

176 
lÚg_sÿË
 = 
lÚg_¿nge
.
max
 -†Úg_¿nge.
mš
;

178 
ušt32_t
 
©o
 = 
hash_£p
;

179 
ušt32_t
 
Úo
 = 
hash_£p
 >> 32;

184 
¬—
->
Ït™ude
.
mš
 =

185 
Ït_¿nge
.
mš
 + (
©o
 * 1.0 / (1uÎ << 
¡•
)è* 
Ït_sÿË
;

186 
¬—
->
Ït™ude
.
max
 =

187 
Ït_¿nge
.
mš
 + ((
©o
 + 1è* 1.0 / (1uÎ << 
¡•
)è* 
Ït_sÿË
;

188 
¬—
->
lÚg™ude
.
mš
 =

189 
lÚg_¿nge
.
mš
 + (
Úo
 * 1.0 / (1uÎ << 
¡•
)è* 
lÚg_sÿË
;

190 
¬—
->
lÚg™ude
.
max
 =

191 
lÚg_¿nge
.
mš
 + ((
Úo
 + 1è* 1.0 / (1uÎ << 
¡•
)è* 
lÚg_sÿË
;

194 
	}
}

196 
	$geohashDecodeTy³
(cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
) {

197 
GeoHashRªge
 
r
[2] = {{0}};

198 
	`geohashG‘CoÜdRªge
(&
r
[0], &r[1]);

199  
	`geohashDecode
(
r
[0],„[1], 
hash
, 
¬—
);

200 
	}
}

202 
	$geohashDecodeWGS84
(cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
) {

203  
	`geohashDecodeTy³
(
hash
, 
¬—
);

204 
	}
}

206 
	$geohashDecodeA»aToLÚgL©
(cÚ¡ 
GeoHashA»a
 *
¬—
, *
xy
) {

207 ià(!
xy
)  0;

208 
xy
[0] = (
¬—
->
lÚg™ude
.
mš
 +‡»a->lÚg™ude.
max
) / 2;

209 
xy
[1] = (
¬—
->
Ït™ude
.
mš
 +‡»a->Ït™ude.
max
) / 2;

211 
	}
}

213 
	$geohashDecodeToLÚgL©Ty³
(cÚ¡ 
GeoHashB™s
 
hash
, *
xy
) {

214 
GeoHashA»a
 
¬—
 = {{0}};

215 ià(!
xy
 || !
	`geohashDecodeTy³
(
hash
, &
¬—
))

217  
	`geohashDecodeA»aToLÚgL©
(&
¬—
, 
xy
);

218 
	}
}

220 
	$geohashDecodeToLÚgL©WGS84
(cÚ¡ 
GeoHashB™s
 
hash
, *
xy
) {

221  
	`geohashDecodeToLÚgL©Ty³
(
hash
, 
xy
);

222 
	}
}

224 
	$geohash_move_x
(
GeoHashB™s
 *
hash
, 
št8_t
 
d
) {

225 ià(
d
 == 0)

228 
ušt64_t
 
x
 = 
hash
->
b™s
 & 0xaaaaaaaaaaaaaaaaULL;

229 
ušt64_t
 
y
 = 
hash
->
b™s
 & 0x5555555555555555ULL;

231 
ušt64_t
 
zz
 = 0x5555555555555555ULL >> (64 - 
hash
->
¡•
 * 2);

233 ià(
d
 > 0) {

234 
x
 = x + (
zz
 + 1);

236 
x
 = x | 
zz
;

237 
x
 = x - (
zz
 + 1);

240 
x
 &ğ(0x¯¯¯¯¯¯¯¯ULL >> (64 - 
hash
->
¡•
 * 2));

241 
hash
->
b™s
 = (
x
 | 
y
);

242 
	}
}

244 
	$geohash_move_y
(
GeoHashB™s
 *
hash
, 
št8_t
 
d
) {

245 ià(
d
 == 0)

248 
ušt64_t
 
x
 = 
hash
->
b™s
 & 0xaaaaaaaaaaaaaaaaULL;

249 
ušt64_t
 
y
 = 
hash
->
b™s
 & 0x5555555555555555ULL;

251 
ušt64_t
 
zz
 = 0x¯¯¯¯¯¯¯¯ULL >> (64 - 
hash
->
¡•
 * 2);

252 ià(
d
 > 0) {

253 
y
 = y + (
zz
 + 1);

255 
y
 = y | 
zz
;

256 
y
 = y - (
zz
 + 1);

258 
y
 &ğ(0x5555555555555555ULL >> (64 - 
hash
->
¡•
 * 2));

259 
hash
->
b™s
 = (
x
 | 
y
);

260 
	}
}

262 
	$geohashNeighbÜs
(cÚ¡ 
GeoHashB™s
 *
hash
, 
GeoHashNeighbÜs
 *
ÃighbÜs
) {

263 
ÃighbÜs
->
—¡
 = *
hash
;

264 
ÃighbÜs
->
we¡
 = *
hash
;

265 
ÃighbÜs
->
nÜth
 = *
hash
;

266 
ÃighbÜs
->
south
 = *
hash
;

267 
ÃighbÜs
->
south_—¡
 = *
hash
;

268 
ÃighbÜs
->
south_we¡
 = *
hash
;

269 
ÃighbÜs
->
nÜth_—¡
 = *
hash
;

270 
ÃighbÜs
->
nÜth_we¡
 = *
hash
;

272 
	`geohash_move_x
(&
ÃighbÜs
->
—¡
, 1);

273 
	`geohash_move_y
(&
ÃighbÜs
->
—¡
, 0);

275 
	`geohash_move_x
(&
ÃighbÜs
->
we¡
, -1);

276 
	`geohash_move_y
(&
ÃighbÜs
->
we¡
, 0);

278 
	`geohash_move_x
(&
ÃighbÜs
->
south
, 0);

279 
	`geohash_move_y
(&
ÃighbÜs
->
south
, -1);

281 
	`geohash_move_x
(&
ÃighbÜs
->
nÜth
, 0);

282 
	`geohash_move_y
(&
ÃighbÜs
->
nÜth
, 1);

284 
	`geohash_move_x
(&
ÃighbÜs
->
nÜth_we¡
, -1);

285 
	`geohash_move_y
(&
ÃighbÜs
->
nÜth_we¡
, 1);

287 
	`geohash_move_x
(&
ÃighbÜs
->
nÜth_—¡
, 1);

288 
	`geohash_move_y
(&
ÃighbÜs
->
nÜth_—¡
, 1);

290 
	`geohash_move_x
(&
ÃighbÜs
->
south_—¡
, 1);

291 
	`geohash_move_y
(&
ÃighbÜs
->
south_—¡
, -1);

293 
	`geohash_move_x
(&
ÃighbÜs
->
south_we¡
, -1);

294 
	`geohash_move_y
(&
ÃighbÜs
->
south_we¡
, -1);

295 
	}
}

	@geohash.h

32 #iâdeà
GEOHASH_H_


33 
	#GEOHASH_H_


	)

35 
	~<¡ddef.h
>

36 
	~<¡dšt.h
>

37 
	~<¡dšt.h
>

39 #ià
defšed
(
__ılu¥lus
)

43 
	#HASHISZERO
(
r
è(!Ô).
b™s
 && !Ô).
¡•
)

	)

44 
	#RANGEISZERO
(
r
è(!Ô).
max
 && !Ô).
mš
)

	)

45 
	#RANGEPISZERO
(
r
èÔ =ğ
NULL
 || 
	`RANGEISZERO
(*r))

	)

47 
	#GEO_STEP_MAX
 26

	)

50 
	#GEO_LAT_MIN
 -85.05112878

	)

51 
	#GEO_LAT_MAX
 85.05112878

	)

52 
	#GEO_LONG_MIN
 -180

	)

53 
	#GEO_LONG_MAX
 180

	)

56 
GEOHASH_NORTH
 = 0,

57 
GEOHASH_EAST
,

58 
GEOHASH_WEST
,

59 
GEOHASH_SOUTH
,

60 
GEOHASH_SOUTH_WEST
,

61 
GEOHASH_SOUTH_EAST
,

62 
GEOHASH_NORT_WEST
,

63 
GEOHASH_NORT_EAST


64 } 
	tGeoDœeùiÚ
;

67 
ušt64_t
 
b™s
;

68 
ušt8_t
 
¡•
;

69 } 
	tGeoHashB™s
;

72 
mš
;

73 
max
;

74 } 
	tGeoHashRªge
;

77 
GeoHashB™s
 
hash
;

78 
GeoHashRªge
 
lÚg™ude
;

79 
GeoHashRªge
 
Ït™ude
;

80 } 
	tGeoHashA»a
;

83 
GeoHashB™s
 
nÜth
;

84 
GeoHashB™s
 
—¡
;

85 
GeoHashB™s
 
we¡
;

86 
GeoHashB™s
 
south
;

87 
GeoHashB™s
 
nÜth_—¡
;

88 
GeoHashB™s
 
south_—¡
;

89 
GeoHashB™s
 
nÜth_we¡
;

90 
GeoHashB™s
 
south_we¡
;

91 } 
	tGeoHashNeighbÜs
;

97 
geohashG‘CoÜdRªge
(
GeoHashRªge
 *
lÚg_¿nge
, GeoHashRªg*
Ït_¿nge
);

98 
geohashEncode
(cÚ¡ 
GeoHashRªge
 *
lÚg_¿nge
, cÚ¡ GeoHashRªg*
Ït_¿nge
,

99 
lÚg™ude
, 
Ït™ude
, 
ušt8_t
 
¡•
,

100 
GeoHashB™s
 *
hash
);

101 
geohashEncodeTy³
(
lÚg™ude
, 
Ït™ude
,

102 
ušt8_t
 
¡•
, 
GeoHashB™s
 *
hash
);

103 
geohashEncodeWGS84
(
lÚg™ude
, 
Ït™ude
, 
ušt8_t
 
¡•
,

104 
GeoHashB™s
 *
hash
);

105 
geohashDecode
(cÚ¡ 
GeoHashRªge
 
lÚg_¿nge
, cÚ¡ GeoHashRªg
Ït_¿nge
,

106 cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
);

107 
geohashDecodeTy³
(cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
);

108 
geohashDecodeWGS84
(cÚ¡ 
GeoHashB™s
 
hash
, 
GeoHashA»a
 *
¬—
);

109 
geohashDecodeA»aToLÚgL©
(cÚ¡ 
GeoHashA»a
 *
¬—
, *
xy
);

110 
geohashDecodeToLÚgL©Ty³
(cÚ¡ 
GeoHashB™s
 
hash
, *
xy
);

111 
geohashDecodeToLÚgL©WGS84
(cÚ¡ 
GeoHashB™s
 
hash
, *
xy
);

112 
geohashDecodeToLÚgL©M”ÿtÜ
(cÚ¡ 
GeoHashB™s
 
hash
, *
xy
);

113 
geohashNeighbÜs
(cÚ¡ 
GeoHashB™s
 *
hash
, 
GeoHashNeighbÜs
 *
ÃighbÜs
);

115 #ià
defšed
(
__ılu¥lus
)

	@geohash_helper.c

37 
	~"fmaüos.h
"

38 
	~"geohash_h–³r.h
"

39 
	~"debugmaüo.h
"

40 
	~<m©h.h
>

42 
	#D_R
 (
M_PI
 / 180.0)

	)

43 
	#R_MAJOR
 6378137.0

	)

44 
	#R_MINOR
 6356752.3142

	)

45 
	#RATIO
 (
R_MINOR
 / 
R_MAJOR
)

	)

46 
	#ECCENT
 (
	`sq¹
(1.0 - (
RATIO
 *RATIO)))

	)

47 
	#COM
 (0.5 * 
ECCENT
)

	)

50 cÚ¡ 
	gDEG_TO_RAD
 = 0.017453292519943295769236907684886;

52 cÚ¡ 
	gEARTH_RADIUS_IN_METERS
 = 6372797.560856;

54 cÚ¡ 
	gMERCATOR_MAX
 = 20037726.37;

55 cÚ¡ 
	gMERCATOR_MIN
 = -20037726.37;

57 
šlše
 
	$deg_¿d
(
ªg
è{ ‡ng * 
D_R
; 
	}
}

58 
šlše
 
	$¿d_deg
(
ªg
è{ ‡ng / 
D_R
; 
	}
}

62 
ušt8_t
 
	$geohashE¡im©eS‹psByRadius
(
¿nge_m‘”s
, 
Ït
) {

63 ià(
¿nge_m‘”s
 == 0)  26;

64 
¡•
 = 1;

65 
¿nge_m‘”s
 < 
MERCATOR_MAX
) {

66 
¿nge_m‘”s
 *= 2;

67 
¡•
++;

69 
¡•
 -= 2;

74 ià(
Ït
 > 66 ||†at < -66) {

75 
¡•
--;

76 ià(
Ït
 > 80 ||†© < -80è
¡•
--;

80 ià(
¡•
 < 1) step = 1;

81 ià(
¡•
 > 26) step = 26;

82  
¡•
;

83 
	}
}

85 
	$geohashBoundšgBox
(
lÚg™ude
, 
Ït™ude
, 
¿dius_m‘”s
,

86 *
bounds
) {

87 ià(!
bounds
)  0;

89 
lÚr
, 
ÏŒ
;

90 
lÚr
 = 
	`deg_¿d
(
lÚg™ude
);

91 
ÏŒ
 = 
	`deg_¿d
(
Ït™ude
);

93 ià(
¿dius_m‘”s
 > 
EARTH_RADIUS_IN_METERS
)

94 
¿dius_m‘”s
 = 
EARTH_RADIUS_IN_METERS
;

95 
di¡ªû
 = 
¿dius_m‘”s
 / 
EARTH_RADIUS_IN_METERS
;

96 
mš_Ït™ude
 = 
ÏŒ
 - 
di¡ªû
;

97 
max_Ït™ude
 = 
ÏŒ
 + 
di¡ªû
;

100 
mš_lÚg™ude
, 
max_lÚg™ude
;

101 
difã»nû_lÚg™ude
 = 
	`asš
(
	`sš
(
di¡ªû
è/ 
	`cos
(
ÏŒ
));

102 
mš_lÚg™ude
 = 
lÚr
 - 
difã»nû_lÚg™ude
;

103 
max_lÚg™ude
 = 
lÚr
 + 
difã»nû_lÚg™ude
;

105 
bounds
[0] = 
	`¿d_deg
(
mš_lÚg™ude
);

106 
bounds
[1] = 
	`¿d_deg
(
mš_Ït™ude
);

107 
bounds
[2] = 
	`¿d_deg
(
max_lÚg™ude
);

108 
bounds
[3] = 
	`¿d_deg
(
max_Ït™ude
);

110 
	}
}

114 
GeoHashRadius
 
	$geohashG‘A»asByRadius
(
lÚg™ude
, 
Ït™ude
, 
¿dius_m‘”s
) {

115 
GeoHashRªge
 
lÚg_¿nge
, 
Ït_¿nge
;

116 
GeoHashRadius
 
¿dius
;

117 
GeoHashB™s
 
hash
;

118 
GeoHashNeighbÜs
 
ÃighbÜs
;

119 
GeoHashA»a
 
¬—
;

120 
mš_lÚ
, 
max_lÚ
, 
mš_Ït
, 
max_Ït
;

121 
bounds
[4];

122 
¡•s
;

124 
	`geohashBoundšgBox
(
lÚg™ude
, 
Ït™ude
, 
¿dius_m‘”s
, 
bounds
);

125 
mš_lÚ
 = 
bounds
[0];

126 
mš_Ït
 = 
bounds
[1];

127 
max_lÚ
 = 
bounds
[2];

128 
max_Ït
 = 
bounds
[3];

130 
¡•s
 = 
	`geohashE¡im©eS‹psByRadius
(
¿dius_m‘”s
,
Ït™ude
);

132 
	`geohashG‘CoÜdRªge
(&
lÚg_¿nge
,&
Ït_¿nge
);

133 
	`geohashEncode
(&
lÚg_¿nge
,&
Ït_¿nge
,
lÚg™ude
,
Ït™ude
,
¡•s
,&
hash
);

134 
	`geohashNeighbÜs
(&
hash
,&
ÃighbÜs
);

135 
	`geohashDecode
(
lÚg_¿nge
,
Ït_¿nge
,
hash
,&
¬—
);

142 
deü—£_¡•
 = 0;

144 
GeoHashA»a
 
nÜth
, 
south
, 
—¡
, 
we¡
;

146 
	`geohashDecode
(
lÚg_¿nge
, 
Ït_¿nge
, 
ÃighbÜs
.
nÜth
, &north);

147 
	`geohashDecode
(
lÚg_¿nge
, 
Ït_¿nge
, 
ÃighbÜs
.
south
, &south);

148 
	`geohashDecode
(
lÚg_¿nge
, 
Ït_¿nge
, 
ÃighbÜs
.
—¡
, &east);

149 
	`geohashDecode
(
lÚg_¿nge
, 
Ït_¿nge
, 
ÃighbÜs
.
we¡
, &west);

151 ià(
	`geohashG‘Di¡ªû
(
lÚg™ude
,
Ït™ude
,lÚg™ude,
nÜth
.Ït™ude.
max
)

152 < 
¿dius_m‘”s
è
deü—£_¡•
 = 1;

153 ià(
	`geohashG‘Di¡ªû
(
lÚg™ude
,
Ït™ude
,lÚg™ude,
south
.Ït™ude.
mš
)

154 < 
¿dius_m‘”s
è
deü—£_¡•
 = 1;

155 ià(
	`geohashG‘Di¡ªû
(
lÚg™ude
,
Ït™ude
,
—¡
.lÚg™ude.
max
,latitude)

156 < 
¿dius_m‘”s
è
deü—£_¡•
 = 1;

157 ià(
	`geohashG‘Di¡ªû
(
lÚg™ude
,
Ït™ude
,
we¡
.lÚg™ude.
mš
,latitude)

158 < 
¿dius_m‘”s
è
deü—£_¡•
 = 1;

161 ià(
deü—£_¡•
) {

162 
¡•s
--;

163 
	`geohashEncode
(&
lÚg_¿nge
,&
Ït_¿nge
,
lÚg™ude
,
Ït™ude
,
¡•s
,&
hash
);

164 
	`geohashNeighbÜs
(&
hash
,&
ÃighbÜs
);

165 
	`geohashDecode
(
lÚg_¿nge
,
Ït_¿nge
,
hash
,&
¬—
);

172 
GeoHashA»a
 
my¬—
 = {{0}};

173 
	`geohashDecode
(
lÚg_¿nge
, 
Ït_¿nge
, 
ÃighbÜs
.
we¡
, &
my¬—
);

176 
	`D
("Neighbors");

177 
	`D
("¬—.lÚg™ude.mš: %f\n", 
my¬—
.
lÚg™ude
.
mš
);

178 
	`D
("¬—.lÚg™ude.max: %f\n", 
my¬—
.
lÚg™ude
.
max
);

179 
	`D
("¬—.Ït™ude.mš: %f\n", 
my¬—
.
Ït™ude
.
mš
);

180 
	`D
("¬—.Ït™ude.max: %f\n", 
my¬—
.
Ït™ude
.
max
);

183 
	`D
("Area");

184 
	`D
("¬—.lÚg™ude.mš: %f\n", 
¬—
.
lÚg™ude
.
mš
);

185 
	`D
("¬—.lÚg™ude.max: %f\n", 
¬—
.
lÚg™ude
.
max
);

186 
	`D
("¬—.Ït™ude.mš: %f\n", 
¬—
.
Ït™ude
.
mš
);

187 
	`D
("¬—.Ït™ude.max: %f\n", 
¬—
.
Ït™ude
.
max
);

191 ià(
¬—
.
Ït™ude
.
mš
 < 
mš_Ït
) {

192 
	`GZERO
(
ÃighbÜs
.
south
);

193 
	`GZERO
(
ÃighbÜs
.
south_we¡
);

194 
	`GZERO
(
ÃighbÜs
.
south_—¡
);

196 ià(
¬—
.
Ït™ude
.
max
 > 
max_Ït
) {

197 
	`GZERO
(
ÃighbÜs
.
nÜth
);

198 
	`GZERO
(
ÃighbÜs
.
nÜth_—¡
);

199 
	`GZERO
(
ÃighbÜs
.
nÜth_we¡
);

201 ià(
¬—
.
lÚg™ude
.
mš
 < 
mš_lÚ
) {

202 
	`GZERO
(
ÃighbÜs
.
we¡
);

203 
	`GZERO
(
ÃighbÜs
.
south_we¡
);

204 
	`GZERO
(
ÃighbÜs
.
nÜth_we¡
);

206 ià(
¬—
.
lÚg™ude
.
max
 > 
max_lÚ
) {

207 
	`GZERO
(
ÃighbÜs
.
—¡
);

208 
	`GZERO
(
ÃighbÜs
.
south_—¡
);

209 
	`GZERO
(
ÃighbÜs
.
nÜth_—¡
);

211 
¿dius
.
hash
 = hash;

212 
¿dius
.
ÃighbÜs
 =‚eighbors;

213 
¿dius
.
¬—
 =‡rea;

214  
¿dius
;

215 
	}
}

217 
GeoHashRadius
 
	$geohashG‘A»asByRadiusWGS84
(
lÚg™ude
, 
Ït™ude
,

218 
¿dius_m‘”s
) {

219  
	`geohashG‘A»asByRadius
(
lÚg™ude
, 
Ït™ude
, 
¿dius_m‘”s
);

220 
	}
}

222 
GeoHashFix52B™s
 
	$geohashAlign52B™s
(cÚ¡ 
GeoHashB™s
 
hash
) {

223 
ušt64_t
 
b™s
 = 
hash
.bits;

224 
b™s
 <<ğ(52 - 
hash
.
¡•
 * 2);

225  
b™s
;

226 
	}
}

229 
	$geohashG‘Di¡ªû
(
lÚ1d
, 
Ït1d
, 
lÚ2d
, 
Ït2d
) {

230 
Ït1r
, 
lÚ1r
, 
Ït2r
, 
lÚ2r
, 
u
, 
v
;

231 
Ït1r
 = 
	`deg_¿d
(
Ït1d
);

232 
lÚ1r
 = 
	`deg_¿d
(
lÚ1d
);

233 
Ït2r
 = 
	`deg_¿d
(
Ït2d
);

234 
lÚ2r
 = 
	`deg_¿d
(
lÚ2d
);

235 
u
 = 
	`sš
((
Ït2r
 - 
Ït1r
) / 2);

236 
v
 = 
	`sš
((
lÚ2r
 - 
lÚ1r
) / 2);

237  2.0 * 
EARTH_RADIUS_IN_METERS
 *

238 
	`asš
(
	`sq¹
(
u
 * u + 
	`cos
(
Ït1r
è* cos(
Ït2r
è* 
v
 * v));

239 
	}
}

241 
	$geohashG‘Di¡ªûIfInRadius
(
x1
, 
y1
,

242 
x2
, 
y2
, 
¿dius
,

243 *
di¡ªû
) {

244 *
di¡ªû
 = 
	`geohashG‘Di¡ªû
(
x1
, 
y1
, 
x2
, 
y2
);

245 ià(*
di¡ªû
 > 
¿dius
)  0;

247 
	}
}

249 
	$geohashG‘Di¡ªûIfInRadiusWGS84
(
x1
, 
y1
, 
x2
,

250 
y2
, 
¿dius
,

251 *
di¡ªû
) {

252  
	`geohashG‘Di¡ªûIfInRadius
(
x1
, 
y1
, 
x2
, 
y2
, 
¿dius
, 
di¡ªû
);

253 
	}
}

	@geohash_helper.h

32 #iâdeà
GEOHASH_HELPER_HPP_


33 
	#GEOHASH_HELPER_HPP_


	)

35 
	~"geohash.h
"

37 
	#GZERO
(
s
ès.
b™s
 = s.
¡•
 = 0;

	)

38 
	#GISZERO
(
s
è(!s.
b™s
 && !s.
¡•
)

	)

39 
	#GISNOTZERO
(
s
è(s.
b™s
 || s.
¡•
)

	)

41 
ušt64_t
 
	tGeoHashFix52B™s
;

42 
ušt64_t
 
	tGeoHashV¬B™s
;

45 
GeoHashB™s
 
	mhash
;

46 
GeoHashA»a
 
	m¬—
;

47 
GeoHashNeighbÜs
 
	mÃighbÜs
;

48 } 
	tGeoHashRadius
;

50 
GeoHashB™sCom·¿tÜ
(cÚ¡ 
GeoHashB™s
 *
a
, cÚ¡ GeoHashB™ *
b
);

51 
ušt8_t
 
geohashE¡im©eS‹psByRadius
(
¿nge_m‘”s
, 
Ït
);

52 
geohashBoundšgBox
(
lÚg™ude
, 
Ït™ude
, 
¿dius_m‘”s
,

53 *
bounds
);

54 
GeoHashRadius
 
geohashG‘A»asByRadius
(
lÚg™ude
,

55 
Ït™ude
, 
¿dius_m‘”s
);

56 
GeoHashRadius
 
geohashG‘A»asByRadiusWGS84
(
lÚg™ude
, 
Ït™ude
,

57 
¿dius_m‘”s
);

58 
GeoHashRadius
 
geohashG‘A»asByRadiusM”ÿtÜ
(
lÚg™ude
, 
Ït™ude
,

59 
¿dius_m‘”s
);

60 
GeoHashFix52B™s
 
geohashAlign52B™s
(cÚ¡ 
GeoHashB™s
 
hash
);

61 
geohashG‘Di¡ªû
(
lÚ1d
, 
Ït1d
,

62 
lÚ2d
, 
Ït2d
);

63 
geohashG‘Di¡ªûIfInRadius
(
x1
, 
y1
,

64 
x2
, 
y2
, 
¿dius
,

65 *
di¡ªû
);

66 
geohashG‘Di¡ªûIfInRadiusWGS84
(
x1
, 
y1
, 
x2
,

67 
y2
, 
¿dius
,

68 *
di¡ªû
);

	@help.h

3 #iâdeà
__REDIS_HELP_H


4 
	#__REDIS_HELP_H


	)

6 *
	gcommªdGroups
[] = {

23 
	scommªdH–p
 {

24 *
	mÇme
;

25 *
	m·¿ms
;

26 *
	msumm¬y
;

27 
	mgroup
;

28 *
	msšû
;

29 } 
	gcommªdH–p
[] = {

	@hyperloglog.c

32 
	~"£rv”.h
"

34 
	~<¡dšt.h
>

35 
	~<m©h.h
>

182 
	shÎhdr
 {

183 
	mmagic
[4];

184 
ušt8_t
 
	m’codšg
;

185 
ušt8_t
 
	mnÙu£d
[3];

186 
ušt8_t
 
	mÿrd
[8];

187 
ušt8_t
 
	m»gi¡”s
[];

191 
	#HLL_INVALIDATE_CACHE
(
hdr
è(hdr)->
ÿrd
[7] |ğ(1<<7)

	)

192 
	#HLL_VALID_CACHE
(
hdr
è(((hdr)->
ÿrd
[7] & (1<<7)è=ğ0)

	)

194 
	#HLL_P
 14

	)

195 
	#HLL_REGISTERS
 (1<<
HLL_P
è

	)

196 
	#HLL_P_MASK
 (
HLL_REGISTERS
-1è

	)

197 
	#HLL_BITS
 6

	)

198 
	#HLL_REGISTER_MAX
 ((1<<
HLL_BITS
)-1)

	)

199 
	#HLL_HDR_SIZE
 (
hÎhdr
)

	)

200 
	#HLL_DENSE_SIZE
 (
HLL_HDR_SIZE
+((
HLL_REGISTERS
*
HLL_BITS
+7)/8))

	)

201 
	#HLL_DENSE
 0

	)

202 
	#HLL_SPARSE
 1

	)

203 
	#HLL_RAW
 255

	)

204 
	#HLL_MAX_ENCODING
 1

	)

206 *
	gšv®id_hÎ_”r
 = "-INVALIDOBJ Corrupted HLL object detected\r\n";

337 
	#HLL_DENSE_GET_REGISTER
(
rg‘
,
p
,
»gnum
) do { \

338 
ušt8_t
 *
_p
 = (ušt8_t*è
p
; \

339 
_by‹
 = 
»gnum
*
HLL_BITS
/8; \

340 
_fb
 = 
»gnum
*
HLL_BITS
&7; \

341 
_fb8
 = 8 - 
_fb
; \

342 
b0
 = 
_p
[
_by‹
]; \

343 
b1
 = 
_p
[
_by‹
+1]; \

344 
rg‘
 = ((
b0
 >> 
_fb
è| (
b1
 << 
_fb8
)è& 
HLL_REGISTER_MAX
; \

345 } 0)

	)

349 
	#HLL_DENSE_SET_REGISTER
(
p
,
»gnum
,
v®
) do { \

350 
ušt8_t
 *
_p
 = (ušt8_t*è
p
; \

351 
_by‹
 = 
»gnum
*
HLL_BITS
/8; \

352 
_fb
 = 
»gnum
*
HLL_BITS
&7; \

353 
_fb8
 = 8 - 
_fb
; \

354 
_v
 = 
v®
; \

355 
_p
[
_by‹
] &ğ~(
HLL_REGISTER_MAX
 << 
_fb
); \

356 
_p
[
_by‹
] |ğ
_v
 << 
_fb
; \

357 
_p
[
_by‹
+1] &ğ~(
HLL_REGISTER_MAX
 >> 
_fb8
); \

358 
_p
[
_by‹
+1] |ğ
_v
 >> 
_fb8
; \

359 } 0)

	)

363 
	#HLL_SPARSE_XZERO_BIT
 0x40

	)

364 
	#HLL_SPARSE_VAL_BIT
 0x80

	)

365 
	#HLL_SPARSE_IS_ZERO
(
p
è(((*Õ)è& 0xc0è=ğ0è

	)

366 
	#HLL_SPARSE_IS_XZERO
(
p
è(((*Õ)è& 0xc0è=ğ
HLL_SPARSE_XZERO_BIT
)

	)

367 
	#HLL_SPARSE_IS_VAL
(
p
è((*Õ)è& 
HLL_SPARSE_VAL_BIT
)

	)

368 
	#HLL_SPARSE_ZERO_LEN
(
p
è(((*Õ)è& 0x3f)+1)

	)

369 
	#HLL_SPARSE_XZERO_LEN
(
p
è(((((*Õ)è& 0x3fè<< 8è| (*(Õ)+1)))+1)

	)

370 
	#HLL_SPARSE_VAL_VALUE
(
p
è((((*Õ)è>> 2è& 0x1f)+1)

	)

371 
	#HLL_SPARSE_VAL_LEN
(
p
è(((*Õ)è& 0x3)+1)

	)

372 
	#HLL_SPARSE_VAL_MAX_VALUE
 32

	)

373 
	#HLL_SPARSE_VAL_MAX_LEN
 4

	)

374 
	#HLL_SPARSE_ZERO_MAX_LEN
 64

	)

375 
	#HLL_SPARSE_XZERO_MAX_LEN
 16384

	)

376 
	#HLL_SPARSE_VAL_SET
(
p
,
v®
,
Ën
) do { \

377 *(
p
èğ(((
v®
)-1)<<2|((
Ën
)-1))|
HLL_SPARSE_VAL_BIT
; \

378 } 0)

	)

379 
	#HLL_SPARSE_ZERO_SET
(
p
,
Ën
) do { \

380 *(
p
èğ(
Ën
)-1; \

381 } 0)

	)

382 
	#HLL_SPARSE_XZERO_SET
(
p
,
Ën
) do { \

383 
_l
 = (
Ën
)-1; \

384 *(
p
èğ(
_l
>>8è| 
HLL_SPARSE_XZERO_BIT
; \

385 *((
p
)+1èğ(
_l
&0xff); \

386 } 0)

	)

393 
ušt64_t
 
	$MurmurHash64A
 (cÚ¡ * 
key
, 
Ën
, 
£ed
) {

394 cÚ¡ 
ušt64_t
 
m
 = 0xc6a4a7935bd1e995;

395 cÚ¡ 
r
 = 47;

396 
ušt64_t
 
h
 = 
£ed
 ^ (
Ën
 * 
m
);

397 cÚ¡ 
ušt8_t
 *
d©a
 = (cÚ¡ ušt8_ˆ*)
key
;

398 cÚ¡ 
ušt8_t
 *
’d
 = 
d©a
 + (
Ën
-(len&7));

400 
d©a
 !ğ
’d
) {

401 
ušt64_t
 
k
;

403 #ià(
BYTE_ORDER
 =ğ
LITTLE_ENDIAN
)

404 
k
 = *((
ušt64_t
*)
d©a
);

406 
k
 = (
ušt64_t
è
d©a
[0];

407 
k
 |ğ(
ušt64_t
è
d©a
[1] << 8;

408 
k
 |ğ(
ušt64_t
è
d©a
[2] << 16;

409 
k
 |ğ(
ušt64_t
è
d©a
[3] << 24;

410 
k
 |ğ(
ušt64_t
è
d©a
[4] << 32;

411 
k
 |ğ(
ušt64_t
è
d©a
[5] << 40;

412 
k
 |ğ(
ušt64_t
è
d©a
[6] << 48;

413 
k
 |ğ(
ušt64_t
è
d©a
[7] << 56;

416 
k
 *ğ
m
;

417 
k
 ^ğk >> 
r
;

418 
k
 *ğ
m
;

419 
h
 ^ğ
k
;

420 
h
 *ğ
m
;

421 
d©a
 += 8;

424 
Ën
 & 7) {

425 7: 
h
 ^ğ(
ušt64_t
)
d©a
[6] << 48;

426 6: 
h
 ^ğ(
ušt64_t
)
d©a
[5] << 40;

427 5: 
h
 ^ğ(
ušt64_t
)
d©a
[4] << 32;

428 4: 
h
 ^ğ(
ušt64_t
)
d©a
[3] << 24;

429 3: 
h
 ^ğ(
ušt64_t
)
d©a
[2] << 16;

430 2: 
h
 ^ğ(
ušt64_t
)
d©a
[1] << 8;

431 1: 
h
 ^ğ(
ušt64_t
)
d©a
[0];

432 
h
 *ğ
m
;

435 
h
 ^ğh >> 
r
;

436 
h
 *ğ
m
;

437 
h
 ^ğh >> 
r
;

438  
h
;

439 
	}
}

444 
	$hÎP©L’
(*
–e
, 
size_t
 
–esize
, *
»gp
) {

445 
ušt64_t
 
hash
, 
b™
, 
šdex
;

446 
couÁ
;

459 
hash
 = 
	`MurmurHash64A
(
–e
,
–esize
,0xadc83b19ULL);

460 
šdex
 = 
hash
 & 
HLL_P_MASK
;

461 
hash
 |ğ((
ušt64_t
)1<<63);

462 
b™
 = 
HLL_REGISTERS
;

463 
couÁ
 = 1;

464 (
hash
 & 
b™
) == 0) {

465 
couÁ
++;

466 
b™
 <<= 1;

468 *
»gp
 = (è
šdex
;

469  
couÁ
;

470 
	}
}

485 
	$hÎD’£Add
(
ušt8_t
 *
»gi¡”s
, *
–e
, 
size_t
 
–esize
) {

486 
ušt8_t
 
ŞdcouÁ
, 
couÁ
;

487 
šdex
;

490 
couÁ
 = 
	`hÎP©L’
(
–e
,
–esize
,&
šdex
);

491 
	`HLL_DENSE_GET_REGISTER
(
ŞdcouÁ
,
»gi¡”s
,
šdex
);

492 ià(
couÁ
 > 
ŞdcouÁ
) {

493 
	`HLL_DENSE_SET_REGISTER
(
»gi¡”s
,
šdex
,
couÁ
);

498 
	}
}

504 
	$hÎD’£Sum
(
ušt8_t
 *
»gi¡”s
, *
PE
, *
ezp
) {

505 
E
 = 0;

506 
j
, 
ez
 = 0;

511 ià(
HLL_REGISTERS
 =ğ16384 && 
HLL_BITS
 == 6) {

512 
ušt8_t
 *
r
 = 
»gi¡”s
;

513 
r0
, 
r1
, 
r2
, 
r3
, 
r4
, 
r5
, 
r6
, 
r7
, 
r8
, 
r9
,

514 
r10
, 
r11
, 
r12
, 
r13
, 
r14
, 
r15
;

515 
j
 = 0; j < 1024; j++) {

517 
r0
 = 
r
[0] & 63; iàÔ0 =ğ0è
ez
++;

518 
r1
 = (
r
[0] >> 6 |„[1] << 2è& 63; iàÔ1 =ğ0è
ez
++;

519 
r2
 = (
r
[1] >> 4 |„[2] << 4è& 63; iàÔ2 =ğ0è
ez
++;

520 
r3
 = (
r
[2] >> 2è& 63; iàÔ3 =ğ0è
ez
++;

521 
r4
 = 
r
[3] & 63; iàÔ4 =ğ0è
ez
++;

522 
r5
 = (
r
[3] >> 6 |„[4] << 2è& 63; iàÔ5 =ğ0è
ez
++;

523 
r6
 = (
r
[4] >> 4 |„[5] << 4è& 63; iàÔ6 =ğ0è
ez
++;

524 
r7
 = (
r
[5] >> 2è& 63; iàÔ7 =ğ0è
ez
++;

525 
r8
 = 
r
[6] & 63; iàÔ8 =ğ0è
ez
++;

526 
r9
 = (
r
[6] >> 6 |„[7] << 2è& 63; iàÔ9 =ğ0è
ez
++;

527 
r10
 = (
r
[7] >> 4 |„[8] << 4è& 63; iàÔ10 =ğ0è
ez
++;

528 
r11
 = (
r
[8] >> 2è& 63; iàÔ11 =ğ0è
ez
++;

529 
r12
 = 
r
[9] & 63; iàÔ12 =ğ0è
ez
++;

530 
r13
 = (
r
[9] >> 6 |„[10] << 2è& 63; iàÔ13 =ğ0è
ez
++;

531 
r14
 = (
r
[10] >> 4 |„[11] << 4è& 63; iàÔ14 =ğ0è
ez
++;

532 
r15
 = (
r
[11] >> 2è& 63; iàÔ15 =ğ0è
ez
++;

537 
E
 +ğ(
PE
[
r0
] + PE[
r1
]è+ (PE[
r2
] + PE[
r3
]è+ (PE[
r4
] + PE[
r5
]) +

538 (
PE
[
r6
] + PE[
r7
]è+ (PE[
r8
] + PE[
r9
]è+ (PE[
r10
] + PE[
r11
]) +

539 (
PE
[
r12
] + PE[
r13
]è+ (PE[
r14
] + PE[
r15
]);

540 
r
 += 12;

543 
j
 = 0; j < 
HLL_REGISTERS
; j++) {

544 
»g
;

546 
	`HLL_DENSE_GET_REGISTER
(
»g
,
»gi¡”s
,
j
);

547 ià(
»g
 == 0) {

548 
ez
++;

551 
E
 +ğ
PE
[
»g
];

554 
E
 +ğ
ez
;

556 *
ezp
 = 
ez
;

557  
E
;

558 
	}
}

568 
	$hÎS·r£ToD’£
(
robj
 *
o
) {

569 
sds
 
¥¬£
 = 
o
->
±r
, 
d’£
;

570 
hÎhdr
 *
hdr
, *
Şdhdr
 = (hÎhdr*)
¥¬£
;

571 
idx
 = 0, 
ruÆ’
, 
»gv®
;

572 
ušt8_t
 *
p
 = (ušt8_t*)
¥¬£
, *
’d
 =…+
	`sd¦’
(sparse);

575 
hdr
 = (
hÎhdr
*è
¥¬£
;

576 ià(
hdr
->
’codšg
 =ğ
HLL_DENSE
è 
C_OK
;

581 
d’£
 = 
	`sd¢ewËn
(
NULL
,
HLL_DENSE_SIZE
);

582 
hdr
 = (
hÎhdr
*è
d’£
;

583 *
hdr
 = *
Şdhdr
;

584 
hdr
->
’codšg
 = 
HLL_DENSE
;

588 
p
 +ğ
HLL_HDR_SIZE
;

589 
p
 < 
’d
) {

590 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

591 
ruÆ’
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

592 
idx
 +ğ
ruÆ’
;

593 
p
++;

594 } ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

595 
ruÆ’
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

596 
idx
 +ğ
ruÆ’
;

597 
p
 += 2;

599 
ruÆ’
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

600 
»gv®
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

601 
ruÆ’
--) {

602 
	`HLL_DENSE_SET_REGISTER
(
hdr
->
»gi¡”s
,
idx
,
»gv®
);

603 
idx
++;

605 
p
++;

611 ià(
idx
 !ğ
HLL_REGISTERS
) {

612 
	`sdsä“
(
d’£
);

613  
C_ERR
;

617 
	`sdsä“
(
o
->
±r
);

618 
o
->
±r
 = 
d’£
;

619  
C_OK
;

620 
	}
}

638 
	$hÎS·r£Add
(
robj
 *
o
, *
–e
, 
size_t
 
–esize
) {

639 
hÎhdr
 *
hdr
;

640 
ušt8_t
 
ŞdcouÁ
, 
couÁ
, *
¥¬£
, *
’d
, *
p
, *
´ev
, *
Ãxt
;

641 
šdex
, 
fœ¡
, 
¥ª
;

642 
is_z”o
 = 0, 
is_xz”o
 = 0, 
is_v®
 = 0, 
ruÆ’
 = 0;

645 
couÁ
 = 
	`hÎP©L’
(
–e
,
–esize
,&
šdex
);

649 ià(
couÁ
 > 
HLL_SPARSE_VAL_MAX_VALUE
è
´omÙe
;

656 
o
->
±r
 = 
	`sdsMakeRoomFÜ
(o->ptr,3);

660 
¥¬£
 = 
p
 = ((
ušt8_t
*)
o
->
±r
è+ 
HLL_HDR_SIZE
;

661 
’d
 = 
p
 + 
	`sd¦’
(
o
->
±r
è- 
HLL_HDR_SIZE
;

663 
fœ¡
 = 0;

664 
´ev
 = 
NULL
;

665 
Ãxt
 = 
NULL
;

666 
¥ª
 = 0;

667 
p
 < 
’d
) {

668 
İËn
;

675 
İËn
 = 1;

676 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

677 
¥ª
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

678 } ià(
	`HLL_SPARSE_IS_VAL
(
p
)) {

679 
¥ª
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

681 
¥ª
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

682 
İËn
 = 2;

685 ià(
šdex
 <ğ
fœ¡
+
¥ª
-1) ;

686 
´ev
 = 
p
;

687 
p
 +ğ
İËn
;

688 
fœ¡
 +ğ
¥ª
;

690 ià(
¥ª
 == 0)  -1;

692 
Ãxt
 = 
	`HLL_SPARSE_IS_XZERO
(
p
) ?…+2 :…+1;

693 ià(
Ãxt
 >ğ
’d
èÃxˆğ
NULL
;

698 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

699 
is_z”o
 = 1;

700 
ruÆ’
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

701 } ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

702 
is_xz”o
 = 1;

703 
ruÆ’
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

705 
is_v®
 = 1;

706 
ruÆ’
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

730 ià(
is_v®
) {

731 
ŞdcouÁ
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

733 ià(
ŞdcouÁ
 >ğ
couÁ
)  0;

736 ià(
ruÆ’
 == 1) {

737 
	`HLL_SPARSE_VAL_SET
(
p
,
couÁ
,1);

738 
upd©ed
;

744 ià(
is_z”o
 && 
ruÆ’
 == 1) {

745 
	`HLL_SPARSE_VAL_SET
(
p
,
couÁ
,1);

746 
upd©ed
;

764 
ušt8_t
 
£q
[5], *
n
 = seq;

765 
Ï¡
 = 
fœ¡
+
¥ª
-1;

766 
Ën
;

768 ià(
is_z”o
 || 
is_xz”o
) {

770 ià(
šdex
 !ğ
fœ¡
) {

771 
Ën
 = 
šdex
-
fœ¡
;

772 ià(
Ën
 > 
HLL_SPARSE_ZERO_MAX_LEN
) {

773 
	`HLL_SPARSE_XZERO_SET
(
n
,
Ën
);

774 
n
 += 2;

776 
	`HLL_SPARSE_ZERO_SET
(
n
,
Ën
);

777 
n
++;

780 
	`HLL_SPARSE_VAL_SET
(
n
,
couÁ
,1);

781 
n
++;

782 ià(
šdex
 !ğ
Ï¡
) {

783 
Ën
 = 
Ï¡
-
šdex
;

784 ià(
Ën
 > 
HLL_SPARSE_ZERO_MAX_LEN
) {

785 
	`HLL_SPARSE_XZERO_SET
(
n
,
Ën
);

786 
n
 += 2;

788 
	`HLL_SPARSE_ZERO_SET
(
n
,
Ën
);

789 
n
++;

794 
curv®
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

796 ià(
šdex
 !ğ
fœ¡
) {

797 
Ën
 = 
šdex
-
fœ¡
;

798 
	`HLL_SPARSE_VAL_SET
(
n
,
curv®
,
Ën
);

799 
n
++;

801 
	`HLL_SPARSE_VAL_SET
(
n
,
couÁ
,1);

802 
n
++;

803 ià(
šdex
 !ğ
Ï¡
) {

804 
Ën
 = 
Ï¡
-
šdex
;

805 
	`HLL_SPARSE_VAL_SET
(
n
,
curv®
,
Ën
);

806 
n
++;

814 
£qËn
 = 
n
-
£q
;

815 
ŞdËn
 = 
is_xz”o
 ? 2 : 1;

816 
d–Ën
 = 
£qËn
-
ŞdËn
;

818 ià(
d–Ën
 > 0 &&

819 
	`sd¦’
(
o
->
±r
)+
d–Ën
 > 
£rv”
.
hÎ_¥¬£_max_by‹s
è
´omÙe
;

820 ià(
d–Ën
 && 
Ãxt
è
	`memmove
Òext+d–Ën,Ãxt,
’d
-next);

821 
	`sdsInüL’
(
o
->
±r
,
d–Ën
);

822 
	`memıy
(
p
,
£q
,
£qËn
);

823 
’d
 +ğ
d–Ën
;

825 
upd©ed
:

831 
p
 = 
´ev
 ?…»v : 
¥¬£
;

832 
sÿÆ’
 = 5;

833 
p
 < 
’d
 && 
sÿÆ’
--) {

834 ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

835 
p
 += 2;

837 } ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

838 
p
++;

843 ià(
p
+1 < 
’d
 && 
	`HLL_SPARSE_IS_VAL
(p+1)) {

844 
v1
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

845 
v2
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
+1);

846 ià(
v1
 =ğ
v2
) {

847 
Ën
 = 
	`HLL_SPARSE_VAL_LEN
(
p
)+HLL_SPARSE_VAL_LEN(p+1);

848 ià(
Ën
 <ğ
HLL_SPARSE_VAL_MAX_LEN
) {

849 
	`HLL_SPARSE_VAL_SET
(
p
+1,
v1
,
Ën
);

850 
	`memmove
(
p
,p+1,
’d
-p);

851 
	`sdsInüL’
(
o
->
±r
,-1);

852 
’d
--;

860 
p
++;

864 
hdr
 = 
o
->
±r
;

865 
	`HLL_INVALIDATE_CACHE
(
hdr
);

868 
´omÙe
:

869 ià(
	`hÎS·r£ToD’£
(
o
è=ğ
C_ERR
)  -1;

870 
hdr
 = 
o
->
±r
;

879 
d’£_»tv®
 = 
	`hÎD’£Add
(
hdr
->
»gi¡”s
, 
–e
, 
–esize
);

880 
	`£rv”As£¹
(
d’£_»tv®
 == 1);

881  
d’£_»tv®
;

882 
	}
}

888 
	$hÎS·r£Sum
(
ušt8_t
 *
¥¬£
, 
¥¬£Ën
, *
PE
, *
ezp
, *
šv®id
) {

889 
E
 = 0;

890 
ez
 = 0, 
idx
 = 0, 
ruÆ’
, 
»gv®
;

891 
ušt8_t
 *
’d
 = 
¥¬£
+
¥¬£Ën
, *
p
 = sparse;

893 
p
 < 
’d
) {

894 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

895 
ruÆ’
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

896 
idx
 +ğ
ruÆ’
;

897 
ez
 +ğ
ruÆ’
;

899 
p
++;

900 } ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

901 
ruÆ’
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

902 
idx
 +ğ
ruÆ’
;

903 
ez
 +ğ
ruÆ’
;

905 
p
 += 2;

907 
ruÆ’
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

908 
»gv®
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

909 
idx
 +ğ
ruÆ’
;

910 
E
 +ğ
PE
[
»gv®
]*
ruÆ’
;

911 
p
++;

914 ià(
idx
 !ğ
HLL_REGISTERS
 && 
šv®id
) *invalid = 1;

915 
E
 +ğ
ez
;

916 *
ezp
 = 
ez
;

917  
E
;

918 
	}
}

928 
	$hÎRawSum
(
ušt8_t
 *
»gi¡”s
, *
PE
, *
ezp
) {

929 
E
 = 0;

930 
j
, 
ez
 = 0;

931 
ušt64_t
 *
wÜd
 = (ušt64_t*è
»gi¡”s
;

932 
ušt8_t
 *
by‹s
;

934 
j
 = 0; j < 
HLL_REGISTERS
/8; j++) {

935 ià(*
wÜd
 == 0) {

936 
ez
 += 8;

938 
by‹s
 = (
ušt8_t
*è
wÜd
;

939 ià(
by‹s
[0]è
E
 +ğ
PE
[by‹s[0]]; 
ez
++;

940 ià(
by‹s
[1]è
E
 +ğ
PE
[by‹s[1]]; 
ez
++;

941 ià(
by‹s
[2]è
E
 +ğ
PE
[by‹s[2]]; 
ez
++;

942 ià(
by‹s
[3]è
E
 +ğ
PE
[by‹s[3]]; 
ez
++;

943 ià(
by‹s
[4]è
E
 +ğ
PE
[by‹s[4]]; 
ez
++;

944 ià(
by‹s
[5]è
E
 +ğ
PE
[by‹s[5]]; 
ez
++;

945 ià(
by‹s
[6]è
E
 +ğ
PE
[by‹s[6]]; 
ez
++;

946 ià(
by‹s
[7]è
E
 +ğ
PE
[by‹s[7]]; 
ez
++;

948 
wÜd
++;

950 
E
 +ğ
ez
;

952 *
ezp
 = 
ez
;

953  
E
;

954 
	}
}

967 
ušt64_t
 
	$hÎCouÁ
(
hÎhdr
 *
hdr
, *
šv®id
) {

968 
m
 = 
HLL_REGISTERS
;

969 
E
, 
®pha
 = 0.7213/(1+1.079/
m
);

970 
j
, 
ez
;

974 
š™Ÿlized
 = 0;

975 
PE
[64];

976 ià(!
š™Ÿlized
) {

977 
PE
[0] = 1;

978 
j
 = 1; j < 64; j++) {

980 
PE
[
j
] = 1.0/(1ULL << j);

982 
š™Ÿlized
 = 1;

986 ià(
hdr
->
’codšg
 =ğ
HLL_DENSE
) {

987 
E
 = 
	`hÎD’£Sum
(
hdr
->
»gi¡”s
,
PE
,&
ez
);

988 } ià(
hdr
->
’codšg
 =ğ
HLL_SPARSE
) {

989 
E
 = 
	`hÎS·r£Sum
(
hdr
->
»gi¡”s
,

990 
	`sd¦’
((
sds
)
hdr
)-
HLL_HDR_SIZE
,
PE
,&
ez
,
šv®id
);

991 } ià(
hdr
->
’codšg
 =ğ
HLL_RAW
) {

992 
E
 = 
	`hÎRawSum
(
hdr
->
»gi¡”s
,
PE
,&
ez
);

994 
	`£rv”Pªic
("Unknown HyperLogLogƒncoding in hllCount()");

998 
E
 = (1/E)*
®pha
*
m
*m;

1005 ià(
E
 < 
m
*2.5 && 
ez
 != 0) {

1006 
E
 = 
m
*
	`log
(m/
ez
);

1007 } ià(
m
 =ğ16384 && 
E
 < 72000) {

1012 
bŸs
 = 5.9119*1.0e-18*(
E
*E*E*E)

1013 -1.4253*1.0e-12*(
E
*E*E)+

1014 1.2940*1.0e-7*(
E
*E)

1015 -5.2921*1.0e-3*
E
+

1017 
E
 -ğE*(
bŸs
/100);

1023  (
ušt64_t
è
E
;

1024 
	}
}

1027 
	$hÎAdd
(
robj
 *
o
, *
–e
, 
size_t
 
–esize
) {

1028 
hÎhdr
 *
hdr
 = 
o
->
±r
;

1029 
hdr
->
’codšg
) {

1030 
HLL_DENSE
:  
	`hÎD’£Add
(
hdr
->
»gi¡”s
,
–e
,
–esize
);

1031 
HLL_SPARSE
:  
	`hÎS·r£Add
(
o
,
–e
,
–esize
);

1034 
	}
}

1044 
	$hÎM”ge
(
ušt8_t
 *
max
, 
robj
 *
hÎ
) {

1045 
hÎhdr
 *
hdr
 = 
hÎ
->
±r
;

1046 
i
;

1048 ià(
hdr
->
’codšg
 =ğ
HLL_DENSE
) {

1049 
ušt8_t
 
v®
;

1051 
i
 = 0; i < 
HLL_REGISTERS
; i++) {

1052 
	`HLL_DENSE_GET_REGISTER
(
v®
,
hdr
->
»gi¡”s
,
i
);

1053 ià(
v®
 > 
max
[
i
]) max[i] = val;

1056 
ušt8_t
 *
p
 = 
hÎ
->
±r
, *
’d
 =… + 
	`sd¦’
(hll->ptr);

1057 
ruÆ’
, 
»gv®
;

1059 
p
 +ğ
HLL_HDR_SIZE
;

1060 
i
 = 0;

1061 
p
 < 
’d
) {

1062 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

1063 
ruÆ’
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

1064 
i
 +ğ
ruÆ’
;

1065 
p
++;

1066 } ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

1067 
ruÆ’
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

1068 
i
 +ğ
ruÆ’
;

1069 
p
 += 2;

1071 
ruÆ’
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

1072 
»gv®
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

1073 
ruÆ’
--) {

1074 ià(
»gv®
 > 
max
[
i
]) max[i] =„egval;

1075 
i
++;

1077 
p
++;

1080 ià(
i
 !ğ
HLL_REGISTERS
è 
C_ERR
;

1082  
C_OK
;

1083 
	}
}

1089 
robj
 *
	$ü—‹HLLObjeù
() {

1090 
robj
 *
o
;

1091 
hÎhdr
 *
hdr
;

1092 
sds
 
s
;

1093 
ušt8_t
 *
p
;

1094 
¥¬£Ën
 = 
HLL_HDR_SIZE
 +

1095 (((
HLL_REGISTERS
+(
HLL_SPARSE_XZERO_MAX_LEN
-1)) /

1096 
HLL_SPARSE_XZERO_MAX_LEN
)*2);

1097 
aux
;

1101 
aux
 = 
HLL_REGISTERS
;

1102 
s
 = 
	`sd¢ewËn
(
NULL
,
¥¬£Ën
);

1103 
p
 = (
ušt8_t
*)
s
 + 
HLL_HDR_SIZE
;

1104 
aux
) {

1105 
xz”o
 = 
HLL_SPARSE_XZERO_MAX_LEN
;

1106 ià(
xz”o
 > 
aux
) xzero =‡ux;

1107 
	`HLL_SPARSE_XZERO_SET
(
p
,
xz”o
);

1108 
p
 += 2;

1109 
aux
 -ğ
xz”o
;

1111 
	`£rv”As£¹
((
p
-(
ušt8_t
*)
s
è=ğ
¥¬£Ën
);

1114 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
s
);

1115 
hdr
 = 
o
->
±r
;

1116 
	`memıy
(
hdr
->
magic
,"HYLL",4);

1117 
hdr
->
’codšg
 = 
HLL_SPARSE
;

1118  
o
;

1119 
	}
}

1124 
	$isHLLObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
) {

1125 
hÎhdr
 *
hdr
;

1128 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
))

1129  
C_ERR
;

1131 ià(
	`¡ršgObjeùL’
(
o
è< (*
hdr
)è
šv®id
;

1132 
hdr
 = 
o
->
±r
;

1135 ià(
hdr
->
magic
[0] != 'H' || hdr->magic[1] != 'Y' ||

1136 
hdr
->
magic
[2] !ğ'L' || hdr->magic[3] !ğ'L'è
šv®id
;

1138 ià(
hdr
->
’codšg
 > 
HLL_MAX_ENCODING
è
šv®id
;

1141 ià(
hdr
->
’codšg
 =ğ
HLL_DENSE
 &&

1142 
	`¡ršgObjeùL’
(
o
è!ğ
HLL_DENSE_SIZE
è
šv®id
;

1145  
C_OK
;

1147 
šv®id
:

1148 
	`addR•lySds
(
c
,

1149 
	`sd¢ew
("-WRONGTYPE Key is‚ot‡ valid "

1151  
C_ERR
;

1152 
	}
}

1155 
	$pçddCommªd
(
ş›Á
 *
c
) {

1156 
robj
 *
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

1157 
hÎhdr
 *
hdr
;

1158 
upd©ed
 = 0, 
j
;

1160 ià(
o
 =ğ
NULL
) {

1164 
o
 = 
	`ü—‹HLLObjeù
();

1165 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
o
);

1166 
upd©ed
++;

1168 ià(
	`isHLLObjeùOrR•ly
(
c
,
o
è!ğ
C_OK
) ;

1169 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

1172 
j
 = 2; j < 
c
->
¬gc
; j++) {

1173 
»tv®
 = 
	`hÎAdd
(
o
, (*)
c
->
¬gv
[
j
]->
±r
,

1174 
	`sd¦’
(
c
->
¬gv
[
j
]->
±r
));

1175 
»tv®
) {

1177 
upd©ed
++;

1180 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1184 
hdr
 = 
o
->
±r
;

1185 ià(
upd©ed
) {

1186 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

1187 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"pçdd",
c
->
¬gv
[1],c->
db
->
id
);

1188 
£rv”
.
dœty
++;

1189 
	`HLL_INVALIDATE_CACHE
(
hdr
);

1191 
	`addR•ly
(
c
, 
upd©ed
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

1192 
	}
}

1195 
	$pfcouÁCommªd
(
ş›Á
 *
c
) {

1196 
robj
 *
o
;

1197 
hÎhdr
 *
hdr
;

1198 
ušt64_t
 
ÿrd
;

1204 ià(
c
->
¬gc
 > 2) {

1205 
ušt8_t
 
max
[
HLL_HDR_SIZE
+
HLL_REGISTERS
], *
»gi¡”s
;

1206 
j
;

1209 
	`mem£t
(
max
,0,(max));

1210 
hdr
 = (
hÎhdr
*è
max
;

1211 
hdr
->
’codšg
 = 
HLL_RAW
;

1212 
»gi¡”s
 = 
max
 + 
HLL_HDR_SIZE
;

1213 
j
 = 1; j < 
c
->
¬gc
; j++) {

1215 
robj
 *
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
j
]);

1216 ià(
o
 =ğ
NULL
) ;

1217 ià(
	`isHLLObjeùOrR•ly
(
c
,
o
è!ğ
C_OK
) ;

1221 ià(
	`hÎM”ge
(
»gi¡”s
,
o
è=ğ
C_ERR
) {

1222 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1228 
	`addR•lyLÚgLÚg
(
c
,
	`hÎCouÁ
(
hdr
,
NULL
));

1236 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

1237 ià(
o
 =ğ
NULL
) {

1240 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

1242 ià(
	`isHLLObjeùOrR•ly
(
c
,
o
è!ğ
C_OK
) ;

1243 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

1246 
hdr
 = 
o
->
±r
;

1247 ià(
	`HLL_VALID_CACHE
(
hdr
)) {

1249 
ÿrd
 = (
ušt64_t
)
hdr
->card[0];

1250 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[1] << 8;

1251 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[2] << 16;

1252 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[3] << 24;

1253 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[4] << 32;

1254 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[5] << 40;

1255 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[6] << 48;

1256 
ÿrd
 |ğ(
ušt64_t
)
hdr
->card[7] << 56;

1258 
šv®id
 = 0;

1260 
ÿrd
 = 
	`hÎCouÁ
(
hdr
,&
šv®id
);

1261 ià(
šv®id
) {

1262 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1265 
hdr
->
ÿrd
[0] = card & 0xff;

1266 
hdr
->
ÿrd
[1] = (card >> 8) & 0xff;

1267 
hdr
->
ÿrd
[2] = (card >> 16) & 0xff;

1268 
hdr
->
ÿrd
[3] = (card >> 24) & 0xff;

1269 
hdr
->
ÿrd
[4] = (card >> 32) & 0xff;

1270 
hdr
->
ÿrd
[5] = (card >> 40) & 0xff;

1271 
hdr
->
ÿrd
[6] = (card >> 48) & 0xff;

1272 
hdr
->
ÿrd
[7] = (card >> 56) & 0xff;

1277 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

1278 
£rv”
.
dœty
++;

1280 
	`addR•lyLÚgLÚg
(
c
,
ÿrd
);

1282 
	}
}

1285 
	$pfm”geCommªd
(
ş›Á
 *
c
) {

1286 
ušt8_t
 
max
[
HLL_REGISTERS
];

1287 
hÎhdr
 *
hdr
;

1288 
j
;

1293 
	`mem£t
(
max
,0,(max));

1294 
j
 = 1; j < 
c
->
¬gc
; j++) {

1296 
robj
 *
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
j
]);

1297 ià(
o
 =ğ
NULL
) ;

1298 ià(
	`isHLLObjeùOrR•ly
(
c
,
o
è!ğ
C_OK
) ;

1302 ià(
	`hÎM”ge
(
max
,
o
è=ğ
C_ERR
) {

1303 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1309 
robj
 *
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

1310 ià(
o
 =ğ
NULL
) {

1314 
o
 = 
	`ü—‹HLLObjeù
();

1315 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
o
);

1320 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

1324 ià(
	`hÎS·r£ToD’£
(
o
è=ğ
C_ERR
) {

1325 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1331 
hdr
 = 
o
->
±r
;

1332 
j
 = 0; j < 
HLL_REGISTERS
; j++) {

1333 
	`HLL_DENSE_SET_REGISTER
(
hdr
->
»gi¡”s
,
j
,
max
[j]);

1335 
	`HLL_INVALIDATE_CACHE
(
hdr
);

1337 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

1340 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"pçdd",
c
->
¬gv
[1],c->
db
->
id
);

1341 
£rv”
.
dœty
++;

1342 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1343 
	}
}

1350 
	#HLL_TEST_CYCLES
 1000

	)

1351 
	$pf£láe¡Commªd
(
ş›Á
 *
c
) {

1352 
j
, 
i
;

1353 
sds
 
b™couÁ”s
 = 
	`sd¢ewËn
(
NULL
,
HLL_DENSE_SIZE
);

1354 
hÎhdr
 *
hdr
 = (hÎhdr*è
b™couÁ”s
, *
hdr2
;

1355 
robj
 *
o
 = 
NULL
;

1356 
ušt8_t
 
by‹couÁ”s
[
HLL_REGISTERS
];

1362 
j
 = 0; j < 
HLL_TEST_CYCLES
; j++) {

1365 
i
 = 0; i < 
HLL_REGISTERS
; i++) {

1366 
r
 = 
	`¿nd
(è& 
HLL_REGISTER_MAX
;

1368 
by‹couÁ”s
[
i
] = 
r
;

1369 
	`HLL_DENSE_SET_REGISTER
(
hdr
->
»gi¡”s
,
i
,
r
);

1372 
i
 = 0; i < 
HLL_REGISTERS
; i++) {

1373 
v®
;

1375 
	`HLL_DENSE_GET_REGISTER
(
v®
,
hdr
->
»gi¡”s
,
i
);

1376 ià(
v®
 !ğ
by‹couÁ”s
[
i
]) {

1377 
	`addR•lyE¼ÜFÜm©
(
c
,

1379 
i
, (è
by‹couÁ”s
[i], (è
v®
);

1380 
ş—nup
;

1395 
	`mem£t
(
hdr
->
»gi¡”s
,0,
HLL_DENSE_SIZE
-
HLL_HDR_SIZE
);

1396 
o
 = 
	`ü—‹HLLObjeù
();

1397 
»Ë¼
 = 1.04/
	`sq¹
(
HLL_REGISTERS
);

1398 
št64_t
 
checkpošt
 = 1;

1399 
ušt64_t
 
£ed
 = (ušt64_t)
	`¿nd
() | (uint64_t)rand() << 32;

1400 
ušt64_t
 
–e
;

1401 
j
 = 1; j <= 10000000; j++) {

1402 
–e
 = 
j
 ^ 
£ed
;

1403 
	`hÎD’£Add
(
hdr
->
»gi¡”s
,(*)&
–e
,(ele));

1404 
	`hÎAdd
(
o
,(*)&
–e
,(ele));

1408 ià(
j
 =ğ
checkpošt
 && j < 
£rv”
.
hÎ_¥¬£_max_by‹s
/2) {

1409 
hdr2
 = 
o
->
±r
;

1410 ià(
hdr2
->
’codšg
 !ğ
HLL_SPARSE
) {

1411 
	`addR•lyE¼Ü
(
c
, "TESTFAILED sparseƒncoding‚ot used");

1412 
ş—nup
;

1417 ià(
j
 =ğ
checkpošt
 && 
	`hÎCouÁ
(
hdr
,
NULL
è!ğhÎCouÁ(
o
->
±r
,NULL)) {

1418 
	`addR•lyE¼Ü
(
c
, "TESTFAILED dense/sparse disagree");

1419 
ş—nup
;

1423 ià(
j
 =ğ
checkpošt
) {

1424 
št64_t
 
ab£¼
 = 
checkpošt
 - (št64_t)
	`hÎCouÁ
(
hdr
,
NULL
);

1425 
ušt64_t
 
max”r
 = 
	`û
(
»Ë¼
*6*
checkpošt
);

1431 ià(
j
 =ğ10è
max”r
 = 1;

1433 ià(
ab£¼
 < 0)‡bserr = -abserr;

1434 ià(
ab£¼
 > (
št64_t
)
max”r
) {

1435 
	`addR•lyE¼ÜFÜm©
(
c
,

1437 (è
checkpošt
,

1438 (è
ab£¼
);

1439 
ş—nup
;

1441 
checkpošt
 *= 10;

1446 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1448 
ş—nup
:

1449 
	`sdsä“
(
b™couÁ”s
);

1450 ià(
o
è
	`deüRefCouÁ
(o);

1451 
	}
}

1455 
	$pfdebugCommªd
(
ş›Á
 *
c
) {

1456 *
cmd
 = 
c
->
¬gv
[1]->
±r
;

1457 
hÎhdr
 *
hdr
;

1458 
robj
 *
o
;

1459 
j
;

1461 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[2]);

1462 ià(
o
 =ğ
NULL
) {

1463 
	`addR•lyE¼Ü
(
c
,"The specified key does‚otƒxist");

1466 ià(
	`isHLLObjeùOrR•ly
(
c
,
o
è!ğ
C_OK
) ;

1467 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[2],o);

1468 
hdr
 = 
o
->
±r
;

1471 ià(!
	`¡rÿ£cmp
(
cmd
,"getreg")) {

1472 ià(
c
->
¬gc
 !ğ3è
¬™y”r
;

1474 ià(
hdr
->
’codšg
 =ğ
HLL_SPARSE
) {

1475 ià(
	`hÎS·r£ToD’£
(
o
è=ğ
C_ERR
) {

1476 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1479 
£rv”
.
dœty
++;

1482 
hdr
 = 
o
->
±r
;

1483 
	`addR•lyMuÉiBulkL’
(
c
,
HLL_REGISTERS
);

1484 
j
 = 0; j < 
HLL_REGISTERS
; j++) {

1485 
ušt8_t
 
v®
;

1487 
	`HLL_DENSE_GET_REGISTER
(
v®
,
hdr
->
»gi¡”s
,
j
);

1488 
	`addR•lyLÚgLÚg
(
c
,
v®
);

1492 ià(!
	`¡rÿ£cmp
(
cmd
,"decode")) {

1493 ià(
c
->
¬gc
 !ğ3è
¬™y”r
;

1495 
ušt8_t
 *
p
 = 
o
->
±r
, *
’d
 =…+
	`sd¦’
(o->ptr);

1496 
sds
 
decoded
 = 
	`sd£m±y
();

1498 ià(
hdr
->
’codšg
 !ğ
HLL_SPARSE
) {

1499 
	`addR•lyE¼Ü
(
c
,"HLLƒncoding is‚ot sparse");

1503 
p
 +ğ
HLL_HDR_SIZE
;

1504 
p
 < 
’d
) {

1505 
ruÆ’
, 
»gv®
;

1507 ià(
	`HLL_SPARSE_IS_ZERO
(
p
)) {

1508 
ruÆ’
 = 
	`HLL_SPARSE_ZERO_LEN
(
p
);

1509 
p
++;

1510 
decoded
 = 
	`sdsÿrštf
(decoded,"z:%d ",
ruÆ’
);

1511 } ià(
	`HLL_SPARSE_IS_XZERO
(
p
)) {

1512 
ruÆ’
 = 
	`HLL_SPARSE_XZERO_LEN
(
p
);

1513 
p
 += 2;

1514 
decoded
 = 
	`sdsÿrštf
(decoded,"Z:%d ",
ruÆ’
);

1516 
ruÆ’
 = 
	`HLL_SPARSE_VAL_LEN
(
p
);

1517 
»gv®
 = 
	`HLL_SPARSE_VAL_VALUE
(
p
);

1518 
p
++;

1519 
decoded
 = 
	`sdsÿrštf
(decoded,"v:%d,%d ",
»gv®
,
ruÆ’
);

1522 
decoded
 = 
	`sd¡rim
(decoded," ");

1523 
	`addR•lyBulkCBufãr
(
c
,
decoded
,
	`sd¦’
(decoded));

1524 
	`sdsä“
(
decoded
);

1527 ià(!
	`¡rÿ£cmp
(
cmd
,"encoding")) {

1528 *
’codšg¡r
[2] = {"dense","sparse"};

1529 ià(
c
->
¬gc
 !ğ3è
¬™y”r
;

1531 
	`addR•lyStus
(
c
,
’codšg¡r
[
hdr
->
’codšg
]);

1534 ià(!
	`¡rÿ£cmp
(
cmd
,"todense")) {

1535 
cÚv
 = 0;

1536 ià(
c
->
¬gc
 !ğ3è
¬™y”r
;

1538 ià(
hdr
->
’codšg
 =ğ
HLL_SPARSE
) {

1539 ià(
	`hÎS·r£ToD’£
(
o
è=ğ
C_ERR
) {

1540 
	`addR•lySds
(
c
,
	`sd¢ew
(
šv®id_hÎ_”r
));

1543 
cÚv
 = 1;

1544 
£rv”
.
dœty
++;

1546 
	`addR•ly
(
c
,
cÚv
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

1548 
	`addR•lyE¼ÜFÜm©
(
c
,"UnknowÀPFDEBUG subcommªd '%s'", 
cmd
);

1552 
¬™y”r
:

1553 
	`addR•lyE¼ÜFÜm©
(
c
,

1554 "WrÚg‚umb” oà¬gum’t fÜh'%s' subcommªd",
cmd
);

1555 
	}
}

	@intset.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

34 
	~"št£t.h
"

35 
	~"zm®loc.h
"

36 
	~"’dŸncÚv.h
"

40 
	#INTSET_ENC_INT16
 ((
št16_t
))

	)

41 
	#INTSET_ENC_INT32
 ((
št32_t
))

	)

42 
	#INTSET_ENC_INT64
 ((
št64_t
))

	)

45 
ušt8_t
 
	$_št£tV®ueEncodšg
(
št64_t
 
v
) {

46 ià(
v
 < 
INT32_MIN
 || v > 
INT32_MAX
)

47  
INTSET_ENC_INT64
;

48 ià(
v
 < 
INT16_MIN
 || v > 
INT16_MAX
)

49  
INTSET_ENC_INT32
;

51  
INTSET_ENC_INT16
;

52 
	}
}

55 
št64_t
 
	$_št£tG‘Encoded
(
št£t
 *
is
, 
pos
, 
ušt8_t
 
’c
) {

56 
št64_t
 
v64
;

57 
št32_t
 
v32
;

58 
št16_t
 
v16
;

60 ià(
’c
 =ğ
INTSET_ENC_INT64
) {

61 
	`memıy
(&
v64
,((
št64_t
*)
is
->
cÚ‹Ás
)+
pos
,(v64));

62 
	`mem»v64ifbe
(&
v64
);

63  
v64
;

64 } ià(
’c
 =ğ
INTSET_ENC_INT32
) {

65 
	`memıy
(&
v32
,((
št32_t
*)
is
->
cÚ‹Ás
)+
pos
,(v32));

66 
	`mem»v32ifbe
(&
v32
);

67  
v32
;

69 
	`memıy
(&
v16
,((
št16_t
*)
is
->
cÚ‹Ás
)+
pos
,(v16));

70 
	`mem»v16ifbe
(&
v16
);

71  
v16
;

73 
	}
}

76 
št64_t
 
	$_št£tG‘
(
št£t
 *
is
, 
pos
) {

77  
	`_št£tG‘Encoded
(
is
,
pos
,
	`šŒev32ifbe
(is->
’codšg
));

78 
	}
}

81 
	$_št£tS‘
(
št£t
 *
is
, 
pos
, 
št64_t
 
v®ue
) {

82 
ušt32_t
 
’codšg
 = 
	`šŒev32ifbe
(
is
->encoding);

84 ià(
’codšg
 =ğ
INTSET_ENC_INT64
) {

85 ((
št64_t
*)
is
->
cÚ‹Ás
)[
pos
] = 
v®ue
;

86 
	`mem»v64ifbe
(((
št64_t
*)
is
->
cÚ‹Ás
)+
pos
);

87 } ià(
’codšg
 =ğ
INTSET_ENC_INT32
) {

88 ((
št32_t
*)
is
->
cÚ‹Ás
)[
pos
] = 
v®ue
;

89 
	`mem»v32ifbe
(((
št32_t
*)
is
->
cÚ‹Ás
)+
pos
);

91 ((
št16_t
*)
is
->
cÚ‹Ás
)[
pos
] = 
v®ue
;

92 
	`mem»v16ifbe
(((
št16_t
*)
is
->
cÚ‹Ás
)+
pos
);

94 
	}
}

97 
št£t
 *
	$št£tNew
() {

98 
št£t
 *
is
 = 
	`zm®loc
((intset));

99 
is
->
’codšg
 = 
	`šŒev32ifbe
(
INTSET_ENC_INT16
);

100 
is
->
Ëngth
 = 0;

101  
is
;

102 
	}
}

105 
št£t
 *
	$št£tResize
(
št£t
 *
is
, 
ušt32_t
 
Ën
) {

106 
ušt32_t
 
size
 = 
Ën
*
	`šŒev32ifbe
(
is
->
’codšg
);

107 
is
 = 
	`z»®loc
(is,(
št£t
)+
size
);

108  
is
;

109 
	}
}

115 
ušt8_t
 
	$št£tS—rch
(
št£t
 *
is
, 
št64_t
 
v®ue
, 
ušt32_t
 *
pos
) {

116 
mš
 = 0, 
max
 = 
	`šŒev32ifbe
(
is
->
Ëngth
)-1, 
mid
 = -1;

117 
št64_t
 
cur
 = -1;

120 ià(
	`šŒev32ifbe
(
is
->
Ëngth
) == 0) {

121 ià(
pos
) *pos = 0;

126 ià(
v®ue
 > 
	`_št£tG‘
(
is
,
	`šŒev32ifbe
(is->
Ëngth
)-1)) {

127 ià(
pos
è*po ğ
	`šŒev32ifbe
(
is
->
Ëngth
);

129 } ià(
v®ue
 < 
	`_št£tG‘
(
is
,0)) {

130 ià(
pos
) *pos = 0;

135 
max
 >ğ
mš
) {

136 
mid
 = (()
mš
 + ()
max
) >> 1;

137 
cur
 = 
	`_št£tG‘
(
is
,
mid
);

138 ià(
v®ue
 > 
cur
) {

139 
mš
 = 
mid
+1;

140 } ià(
v®ue
 < 
cur
) {

141 
max
 = 
mid
-1;

147 ià(
v®ue
 =ğ
cur
) {

148 ià(
pos
è*po ğ
mid
;

151 ià(
pos
è*po ğ
mš
;

154 
	}
}

157 
št£t
 *
	$št£tUpg¿deAndAdd
(
št£t
 *
is
, 
št64_t
 
v®ue
) {

158 
ušt8_t
 
cu»nc
 = 
	`šŒev32ifbe
(
is
->
’codšg
);

159 
ušt8_t
 
Ãw’c
 = 
	`_št£tV®ueEncodšg
(
v®ue
);

160 
Ëngth
 = 
	`šŒev32ifbe
(
is
->length);

161 
´•’d
 = 
v®ue
 < 0 ? 1 : 0;

164 
is
->
’codšg
 = 
	`šŒev32ifbe
(
Ãw’c
);

165 
is
 = 
	`št£tResize
(is,
	`šŒev32ifbe
(is->
Ëngth
)+1);

170 
Ëngth
--)

171 
	`_št£tS‘
(
is
,
Ëngth
+
´•’d
,
	`_št£tG‘Encoded
(is,Ëngth,
cu»nc
));

174 ià(
´•’d
)

175 
	`_št£tS‘
(
is
,0,
v®ue
);

177 
	`_št£tS‘
(
is
,
	`šŒev32ifbe
(is->
Ëngth
),
v®ue
);

178 
is
->
Ëngth
 = 
	`šŒev32ifbe
(intrev32ifbe(is->length)+1);

179  
is
;

180 
	}
}

182 
	$št£tMoveTa
(
št£t
 *
is
, 
ušt32_t
 
äom
, ušt32_ˆ
to
) {

183 *
¤c
, *
d¡
;

184 
ušt32_t
 
by‹s
 = 
	`šŒev32ifbe
(
is
->
Ëngth
)-
äom
;

185 
ušt32_t
 
’codšg
 = 
	`šŒev32ifbe
(
is
->encoding);

187 ià(
’codšg
 =ğ
INTSET_ENC_INT64
) {

188 
¤c
 = (
št64_t
*)
is
->
cÚ‹Ás
+
äom
;

189 
d¡
 = (
št64_t
*)
is
->
cÚ‹Ás
+
to
;

190 
by‹s
 *ğ(
št64_t
);

191 } ià(
’codšg
 =ğ
INTSET_ENC_INT32
) {

192 
¤c
 = (
št32_t
*)
is
->
cÚ‹Ás
+
äom
;

193 
d¡
 = (
št32_t
*)
is
->
cÚ‹Ás
+
to
;

194 
by‹s
 *ğ(
št32_t
);

196 
¤c
 = (
št16_t
*)
is
->
cÚ‹Ás
+
äom
;

197 
d¡
 = (
št16_t
*)
is
->
cÚ‹Ás
+
to
;

198 
by‹s
 *ğ(
št16_t
);

200 
	`memmove
(
d¡
,
¤c
,
by‹s
);

201 
	}
}

204 
št£t
 *
	$št£tAdd
(
št£t
 *
is
, 
št64_t
 
v®ue
, 
ušt8_t
 *
sucûss
) {

205 
ušt8_t
 
v®’c
 = 
	`_št£tV®ueEncodšg
(
v®ue
);

206 
ušt32_t
 
pos
;

207 ià(
sucûss
) *success = 1;

212 ià(
v®’c
 > 
	`šŒev32ifbe
(
is
->
’codšg
)) {

214  
	`št£tUpg¿deAndAdd
(
is
,
v®ue
);

219 ià(
	`št£tS—rch
(
is
,
v®ue
,&
pos
)) {

220 ià(
sucûss
) *success = 0;

221  
is
;

224 
is
 = 
	`št£tResize
(is,
	`šŒev32ifbe
(is->
Ëngth
)+1);

225 ià(
pos
 < 
	`šŒev32ifbe
(
is
->
Ëngth
)è
	`št£tMoveTa
(is,pos,pos+1);

228 
	`_št£tS‘
(
is
,
pos
,
v®ue
);

229 
is
->
Ëngth
 = 
	`šŒev32ifbe
(intrev32ifbe(is->length)+1);

230  
is
;

231 
	}
}

234 
št£t
 *
	$št£tRemove
(
št£t
 *
is
, 
št64_t
 
v®ue
, *
sucûss
) {

235 
ušt8_t
 
v®’c
 = 
	`_št£tV®ueEncodšg
(
v®ue
);

236 
ušt32_t
 
pos
;

237 ià(
sucûss
) *success = 0;

239 ià(
v®’c
 <ğ
	`šŒev32ifbe
(
is
->
’codšg
è&& 
	`št£tS—rch
(is,
v®ue
,&
pos
)) {

240 
ušt32_t
 
Ën
 = 
	`šŒev32ifbe
(
is
->
Ëngth
);

243 ià(
sucûss
) *success = 1;

246 ià(
pos
 < (
Ën
-1)è
	`št£tMoveTa
(
is
,pos+1,pos);

247 
is
 = 
	`št£tResize
(is,
Ën
-1);

248 
is
->
Ëngth
 = 
	`šŒev32ifbe
(
Ën
-1);

250  
is
;

251 
	}
}

254 
ušt8_t
 
	$št£tFšd
(
št£t
 *
is
, 
št64_t
 
v®ue
) {

255 
ušt8_t
 
v®’c
 = 
	`_št£tV®ueEncodšg
(
v®ue
);

256  
v®’c
 <ğ
	`šŒev32ifbe
(
is
->
’codšg
è&& 
	`št£tS—rch
(is,
v®ue
,
NULL
);

257 
	}
}

260 
št64_t
 
	$št£tRªdom
(
št£t
 *
is
) {

261  
	`_št£tG‘
(
is
,
	`¿nd
()%
	`šŒev32ifbe
(is->
Ëngth
));

262 
	}
}

266 
ušt8_t
 
	$št£tG‘
(
št£t
 *
is
, 
ušt32_t
 
pos
, 
št64_t
 *
v®ue
) {

267 ià(
pos
 < 
	`šŒev32ifbe
(
is
->
Ëngth
)) {

268 *
v®ue
 = 
	`_št£tG‘
(
is
,
pos
);

272 
	}
}

275 
ušt32_t
 
	$št£tL’
(cÚ¡ 
št£t
 *
is
) {

276  
	`šŒev32ifbe
(
is
->
Ëngth
);

277 
	}
}

280 
size_t
 
	$št£tBlobL’
(
št£t
 *
is
) {

281  (
št£t
)+
	`šŒev32ifbe
(
is
->
Ëngth
)*šŒev32ifbe(is->
’codšg
);

282 
	}
}

284 #ifdeà
REDIS_TEST


285 
	~<sys/time.h
>

286 
	~<time.h
>

289 
	$št£tR•r
(
št£t
 *
is
) {

290 
ušt32_t
 
i
 = 0; i < 
	`šŒev32ifbe
(
is
->
Ëngth
); i++) {

291 
	`´štf
("%Îd\n", (
ušt64_t
)
	`_št£tG‘
(
is
,
i
));

293 
	`´štf
("\n");

294 
	}
}

296 
	$”rÜ
(*
”r
) {

297 
	`´štf
("%s\n", 
”r
);

298 
	`ex™
(1);

299 
	}
}

302 
	$ok
() {

303 
	`´štf
("OK\n");

304 
	}
}

306 
	$u£c
() {

307 
timev®
 
tv
;

308 
	`g‘timeofday
(&
tv
,
NULL
);

309  ((()
tv
.
tv_£c
)*1000000)+tv.
tv_u£c
;

310 
	}
}

312 
	#as£¹
(
_e
è((_e)?()0:(
	`_as£¹
(#_e,
__FILE__
,
__LINE__
),
	`ex™
(1)))

	)

313 
	$_as£¹
(*
e¡r
, *
fe
, 
lše
) {

314 
	`´štf
("\n\n=== ASSERTION FAILED ===\n");

315 
	`´štf
("==> %s:%d '%s' i nÙrue\n",
fe
,
lše
,
e¡r
);

316 
	}
}

318 
št£t
 *
	$ü—‹S‘
(
b™s
, 
size
) {

319 
ušt64_t
 
mask
 = (1<<
b™s
)-1;

320 
ušt64_t
 
v®ue
;

321 
št£t
 *
is
 = 
	`št£tNew
();

323 
i
 = 0; i < 
size
; i++) {

324 ià(
b™s
 > 32) {

325 
v®ue
 = (
	`¿nd
()*¿nd()è& 
mask
;

327 
v®ue
 = 
	`¿nd
(è& 
mask
;

329 
is
 = 
	`št£tAdd
(is,
v®ue
,
NULL
);

331  
is
;

332 
	}
}

334 
	$checkCÚsi¡’cy
(
št£t
 *
is
) {

335 
ušt32_t
 
i
 = 0; i < (
	`šŒev32ifbe
(
is
->
Ëngth
)-1); i++) {

336 
ušt32_t
 
’codšg
 = 
	`šŒev32ifbe
(
is
->encoding);

338 ià(
’codšg
 =ğ
INTSET_ENC_INT16
) {

339 
št16_t
 *
i16
 = (št16_t*)
is
->
cÚ‹Ás
;

340 
	`as£¹
(
i16
[
i
] < i16[i+1]);

341 } ià(
’codšg
 =ğ
INTSET_ENC_INT32
) {

342 
št32_t
 *
i32
 = (št32_t*)
is
->
cÚ‹Ás
;

343 
	`as£¹
(
i32
[
i
] < i32[i+1]);

345 
št64_t
 *
i64
 = (št64_t*)
is
->
cÚ‹Ás
;

346 
	`as£¹
(
i64
[
i
] < i64[i+1]);

349 
	}
}

351 
	#UNUSED
(
x
è()(x)

	)

352 
	$št£tTe¡
(
¬gc
, **
¬gv
) {

353 
ušt8_t
 
sucûss
;

354 
i
;

355 
št£t
 *
is
;

356 
	`¤ªd
(
	`time
(
NULL
));

358 
	`UNUSED
(
¬gc
);

359 
	`UNUSED
(
¬gv
);

361 
	`´štf
("Valueƒncodings: "); {

362 
	`as£¹
(
	`_št£tV®ueEncodšg
(-32768è=ğ
INTSET_ENC_INT16
);

363 
	`as£¹
(
	`_št£tV®ueEncodšg
(+32767è=ğ
INTSET_ENC_INT16
);

364 
	`as£¹
(
	`_št£tV®ueEncodšg
(-32769è=ğ
INTSET_ENC_INT32
);

365 
	`as£¹
(
	`_št£tV®ueEncodšg
(+32768è=ğ
INTSET_ENC_INT32
);

366 
	`as£¹
(
	`_št£tV®ueEncodšg
(-2147483648è=ğ
INTSET_ENC_INT32
);

367 
	`as£¹
(
	`_št£tV®ueEncodšg
(+2147483647è=ğ
INTSET_ENC_INT32
);

368 
	`as£¹
(
	`_št£tV®ueEncodšg
(-2147483649è=ğ
INTSET_ENC_INT64
);

369 
	`as£¹
(
	`_št£tV®ueEncodšg
(+2147483648è=ğ
INTSET_ENC_INT64
);

370 
	`as£¹
(
	`_št£tV®ueEncodšg
(-9223372036854775808ull) ==

371 
INTSET_ENC_INT64
);

372 
	`as£¹
(
	`_št£tV®ueEncodšg
(+9223372036854775807ull) ==

373 
INTSET_ENC_INT64
);

374 
	`ok
();

377 
	`´štf
("Basic‡dding: "); {

378 
is
 = 
	`št£tNew
();

379 
is
 = 
	`št£tAdd
(is,5,&
sucûss
); 
	`as£¹
(success);

380 
is
 = 
	`št£tAdd
(is,6,&
sucûss
); 
	`as£¹
(success);

381 
is
 = 
	`št£tAdd
(is,4,&
sucûss
); 
	`as£¹
(success);

382 
is
 = 
	`št£tAdd
(is,4,&
sucûss
); 
	`as£¹
(!success);

383 
	`ok
();

386 
	`´štf
("Large‚umber of„andom‡dds: "); {

387 
ušt32_t
 
š£¹s
 = 0;

388 
is
 = 
	`št£tNew
();

389 
i
 = 0; i < 1024; i++) {

390 
is
 = 
	`št£tAdd
(is,
	`¿nd
()%0x800,&
sucûss
);

391 ià(
sucûss
è
š£¹s
++;

393 
	`as£¹
(
	`šŒev32ifbe
(
is
->
Ëngth
è=ğ
š£¹s
);

394 
	`checkCÚsi¡’cy
(
is
);

395 
	`ok
();

398 
	`´štf
("Upgrade from int16o int32: "); {

399 
is
 = 
	`št£tNew
();

400 
is
 = 
	`št£tAdd
(is,32,
NULL
);

401 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT16
);

402 
is
 = 
	`št£tAdd
(is,65535,
NULL
);

403 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT32
);

404 
	`as£¹
(
	`št£tFšd
(
is
,32));

405 
	`as£¹
(
	`št£tFšd
(
is
,65535));

406 
	`checkCÚsi¡’cy
(
is
);

408 
is
 = 
	`št£tNew
();

409 
is
 = 
	`št£tAdd
(is,32,
NULL
);

410 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT16
);

411 
is
 = 
	`št£tAdd
(is,-65535,
NULL
);

412 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT32
);

413 
	`as£¹
(
	`št£tFšd
(
is
,32));

414 
	`as£¹
(
	`št£tFšd
(
is
,-65535));

415 
	`checkCÚsi¡’cy
(
is
);

416 
	`ok
();

419 
	`´štf
("Upgrade from int16o int64: "); {

420 
is
 = 
	`št£tNew
();

421 
is
 = 
	`št£tAdd
(is,32,
NULL
);

422 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT16
);

423 
is
 = 
	`št£tAdd
(is,4294967295,
NULL
);

424 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT64
);

425 
	`as£¹
(
	`št£tFšd
(
is
,32));

426 
	`as£¹
(
	`št£tFšd
(
is
,4294967295));

427 
	`checkCÚsi¡’cy
(
is
);

429 
is
 = 
	`št£tNew
();

430 
is
 = 
	`št£tAdd
(is,32,
NULL
);

431 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT16
);

432 
is
 = 
	`št£tAdd
(is,-4294967295,
NULL
);

433 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT64
);

434 
	`as£¹
(
	`št£tFšd
(
is
,32));

435 
	`as£¹
(
	`št£tFšd
(
is
,-4294967295));

436 
	`checkCÚsi¡’cy
(
is
);

437 
	`ok
();

440 
	`´štf
("Upgrade from int32o int64: "); {

441 
is
 = 
	`št£tNew
();

442 
is
 = 
	`št£tAdd
(is,65535,
NULL
);

443 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT32
);

444 
is
 = 
	`št£tAdd
(is,4294967295,
NULL
);

445 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT64
);

446 
	`as£¹
(
	`št£tFšd
(
is
,65535));

447 
	`as£¹
(
	`št£tFšd
(
is
,4294967295));

448 
	`checkCÚsi¡’cy
(
is
);

450 
is
 = 
	`št£tNew
();

451 
is
 = 
	`št£tAdd
(is,65535,
NULL
);

452 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT32
);

453 
is
 = 
	`št£tAdd
(is,-4294967295,
NULL
);

454 
	`as£¹
(
	`šŒev32ifbe
(
is
->
’codšg
è=ğ
INTSET_ENC_INT64
);

455 
	`as£¹
(
	`št£tFšd
(
is
,65535));

456 
	`as£¹
(
	`št£tFšd
(
is
,-4294967295));

457 
	`checkCÚsi¡’cy
(
is
);

458 
	`ok
();

461 
	`´štf
("Stress†ookups: "); {

462 
num
 = 100000, 
size
 = 10000;

463 
i
, 
b™s
 = 20;

464 
¡¬t
;

465 
is
 = 
	`ü—‹S‘
(
b™s
,
size
);

466 
	`checkCÚsi¡’cy
(
is
);

468 
¡¬t
 = 
	`u£c
();

469 
i
 = 0; i < 
num
; i++è
	`št£tS—rch
(
is
,
	`¿nd
(è% ((1<<
b™s
)-1),
NULL
);

470 
	`´štf
("%ld†ookups, %ldƒlement set, %lldusec\n",

471 
num
,
size
,
	`u£c
()-
¡¬t
);

474 
	`´štf
("Stress‡dd+delete: "); {

475 
i
, 
v1
, 
v2
;

476 
is
 = 
	`št£tNew
();

477 
i
 = 0; i < 0xffff; i++) {

478 
v1
 = 
	`¿nd
() % 0xfff;

479 
is
 = 
	`št£tAdd
(is,
v1
,
NULL
);

480 
	`as£¹
(
	`št£tFšd
(
is
,
v1
));

482 
v2
 = 
	`¿nd
() % 0xfff;

483 
is
 = 
	`št£tRemove
(is,
v2
,
NULL
);

484 
	`as£¹
(!
	`št£tFšd
(
is
,
v2
));

486 
	`checkCÚsi¡’cy
(
is
);

487 
	`ok
();

491 
	}
}

	@intset.h

31 #iâdeà
__INTSET_H


32 
	#__INTSET_H


	)

33 
	~<¡dšt.h
>

35 
	sšt£t
 {

36 
ušt32_t
 
	m’codšg
;

37 
ušt32_t
 
	mËngth
;

38 
št8_t
 
	mcÚ‹Ás
[];

39 } 
	tšt£t
;

41 
št£t
 *
št£tNew
();

42 
št£t
 *
št£tAdd
(št£ˆ*
is
, 
št64_t
 
v®ue
, 
ušt8_t
 *
sucûss
);

43 
št£t
 *
št£tRemove
(št£ˆ*
is
, 
št64_t
 
v®ue
, *
sucûss
);

44 
ušt8_t
 
št£tFšd
(
št£t
 *
is
, 
št64_t
 
v®ue
);

45 
št64_t
 
št£tRªdom
(
št£t
 *
is
);

46 
ušt8_t
 
št£tG‘
(
št£t
 *
is
, 
ušt32_t
 
pos
, 
št64_t
 *
v®ue
);

47 
ušt32_t
 
št£tL’
(cÚ¡ 
št£t
 *
is
);

48 
size_t
 
št£tBlobL’
(
št£t
 *
is
);

50 #ifdeà
REDIS_TEST


51 
št£tTe¡
(
¬gc
, *
¬gv
[]);

	@latency.c

36 
	~"£rv”.h
"

39 
	$diùSŒšgKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
) {

40 
	`UNUSED
(
´ivd©a
);

41  
	`¡rcmp
(
key1
,
key2
) == 0;

42 
	}
}

44 
	$diùSŒšgHash
(cÚ¡ *
key
) {

45  
	`diùG’HashFunùiÚ
(
key
, 
	`¡¾’
(key));

46 
	}
}

48 
diùVªÏF»e
(*
´ivd©a
, *
v®
);

50 
diùTy³
 
	gÏ‹ncyTimeS”›sDiùTy³
 = {

51 
diùSŒšgHash
,

52 
NULL
,

53 
NULL
,

54 
diùSŒšgKeyCom·»
,

55 
diùVªÏF»e
,

56 
diùVªÏF»e


61 #ifdeà
__lšux__


64 
	$THPIsEÇbËd
() {

65 
buf
[1024];

67 
FILE
 *
å
 = 
	`fİ’
("/sys/kernel/mm/transparent_hugepage/enabled","r");

68 ià(!
å
)  0;

69 ià(
	`fg‘s
(
buf
,(buf),
å
è=ğ
NULL
) {

70 
	`fşo£
(
å
);

73 
	`fşo£
(
å
);

74  (
	`¡r¡r
(
buf
,"[Ãv”]"è=ğ
NULL
) ? 1 : 0;

75 
	}
}

81 
	$THPG‘AnÚHugePagesSize
() {

82  
	`zm®loc_g‘_sm­_by‹s_by_f›ld
("AnonHugePages:",-1);

83 
	}
}

90 
	$Ï‹ncyMÚ™ÜIn™
() {

91 
£rv”
.
Ï‹ncy_ev’ts
 = 
	`diùC»©e
(&
Ï‹ncyTimeS”›sDiùTy³
,
NULL
);

92 
	}
}

98 
	$Ï‹ncyAddSam¶e
(*
ev’t
, 
m¡ime_t
 
Ï‹ncy
) {

99 
Ï‹ncyTimeS”›s
 *
ts
 = 
	`diùF‘chV®ue
(
£rv”
.
Ï‹ncy_ev’ts
,
ev’t
);

100 
time_t
 
now
 = 
	`time
(
NULL
);

101 
´ev
;

104 ià(
ts
 =ğ
NULL
) {

105 
ts
 = 
	`zm®loc
((*ts));

106 
ts
->
idx
 = 0;

107 
ts
->
max
 = 0;

108 
	`mem£t
(
ts
->
§m¶es
,0,(ts->samples));

109 
	`diùAdd
(
£rv”
.
Ï‹ncy_ev’ts
,
	`z¡rdup
(
ev’t
),
ts
);

114 
´ev
 = (
ts
->
idx
 + 
LATENCY_TS_LEN
 - 1) % LATENCY_TS_LEN;

115 ià(
ts
->
§m¶es
[
´ev
].
time
 =ğ
now
) {

116 ià(
Ï‹ncy
 > 
ts
->
§m¶es
[
´ev
].latency)

117 
ts
->
§m¶es
[
´ev
].
Ï‹ncy
 =†atency;

121 
ts
->
§m¶es
[ts->
idx
].
time
 = 
	`time
(
NULL
);

122 
ts
->
§m¶es
[ts->
idx
].
Ï‹ncy
 =†atency;

123 ià(
Ï‹ncy
 > 
ts
->
max
)s->max =†atency;

125 
ts
->
idx
++;

126 ià(
ts
->
idx
 =ğ
LATENCY_TS_LEN
)s->idx = 0;

127 
	}
}

134 
	$Ï‹ncyRe£tEv’t
(*
ev’t_to_»£t
) {

135 
diùI‹¿tÜ
 *
di
;

136 
diùEÁry
 *
de
;

137 
»£ts
 = 0;

139 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
Ï‹ncy_ev’ts
);

140 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

141 *
ev’t
 = 
	`diùG‘Key
(
de
);

143 ià(
ev’t_to_»£t
 =ğ
NULL
 || 
	`¡rÿ£cmp
(
ev’t
,event_to_reset) == 0) {

144 
	`diùD–‘e
(
£rv”
.
Ï‹ncy_ev’ts
, 
ev’t
);

145 
»£ts
++;

148 
	`diùR–—£I‹¿tÜ
(
di
);

149  
»£ts
;

150 
	}
}

159 
	$ª®yzeL©’cyFÜEv’t
(*
ev’t
, 
Ï‹ncySts
 *
ls
) {

160 
Ï‹ncyTimeS”›s
 *
ts
 = 
	`diùF‘chV®ue
(
£rv”
.
Ï‹ncy_ev’ts
,
ev’t
);

161 
j
;

162 
ušt64_t
 
sum
;

164 
ls
->
®l_time_high
 = 
ts
 ?s->
max
 : 0;

165 
ls
->
avg
 = 0;

166 
ls
->
mš
 = 0;

167 
ls
->
max
 = 0;

168 
ls
->
mad
 = 0;

169 
ls
->
§m¶es
 = 0;

170 
ls
->
³riod
 = 0;

171 ià(!
ts
) ;

174 
sum
 = 0;

175 
j
 = 0; j < 
LATENCY_TS_LEN
; j++) {

176 ià(
ts
->
§m¶es
[
j
].
time
 == 0) ;

177 
ls
->
§m¶es
++;

178 ià(
ls
->
§m¶es
 == 1) {

179 
ls
->
mš
 =†s->
max
 = 
ts
->
§m¶es
[
j
].
Ï‹ncy
;

181 ià(
ls
->
mš
 > 
ts
->
§m¶es
[
j
].
Ï‹ncy
)

182 
ls
->
mš
 = 
ts
->
§m¶es
[
j
].
Ï‹ncy
;

183 ià(
ls
->
max
 < 
ts
->
§m¶es
[
j
].
Ï‹ncy
)

184 
ls
->
max
 = 
ts
->
§m¶es
[
j
].
Ï‹ncy
;

186 
sum
 +ğ
ts
->
§m¶es
[
j
].
Ï‹ncy
;

189 ià(
ls
->
³riod
 =ğ0 || 
ts
->
§m¶es
[
j
].
time
 <†s->period)

190 
ls
->
³riod
 = 
ts
->
§m¶es
[
j
].
time
;

196 ià(
ls
->
§m¶es
) {

197 
ls
->
avg
 = 
sum
 /†s->
§m¶es
;

198 
ls
->
³riod
 = 
	`time
(
NULL
) -†s->period;

199 ià(
ls
->
³riod
 == 0)†s->period = 1;

203 
sum
 = 0;

204 
j
 = 0; j < 
LATENCY_TS_LEN
; j++) {

205 
št64_t
 
d–
;

207 ià(
ts
->
§m¶es
[
j
].
time
 == 0) ;

208 
d–
 = (
št64_t
)
ls
->
avg
 - 
ts
->
§m¶es
[
j
].
Ï‹ncy
;

209 ià(
d–
 < 0) delta = -delta;

210 
sum
 +ğ
d–
;

212 ià(
ls
->
§m¶es
èls->
mad
 = 
sum
 /†s->samples;

213 
	}
}

216 
sds
 
	$ü—‹L©’cyR•Üt
() {

217 
sds
 
»pÜt
 = 
	`sd£m±y
();

218 
advi£_b‘‹r_vm
 = 0;

219 
advi£_¦owlog_’abËd
 = 0;

220 
advi£_¦owlog_tunšg
 = 0;

221 
advi£_¦owlog_š¥eù
 = 0;

222 
advi£_disk_cÚ‹ÁiÚ
 = 0;

223 
advi£_scheduËr
 = 0;

224 
advi£_d©a_wr™eback
 = 0;

225 
advi£_no_­³ndfsync
 = 0;

226 
advi£_loÿl_disk
 = 0;

227 
advi£_ssd
 = 0;

228 
advi£_wr™e_lßd_šfo
 = 0;

229 
advi£_hz
 = 0;

230 
advi£_Ïrge_objeùs
 = 0;

231 
advi£_mass_eviùiÚ
 = 0;

232 
advi£_»Ïx_fsync_pŞicy
 = 0;

233 
advi£_di§bË_thp
 = 0;

234 
adviûs
 = 0;

238 ià(
	`diùSize
(
£rv”
.
Ï‹ncy_ev’ts
) == 0 &&

239 
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
 == 0)

241 
»pÜt
 = 
	`sdsÿt
(report,"I'm sorry, Dave, I can't dohat. Latency monitoring is disabled inhis Redis instance. You may use \"CONFIG SET†atency-monitor-threshold <milliseconds>.\" in orderoƒnable it. If we weren't in‡ deep space mission I'd suggestoake‡†ook‡t http://redis.io/topics/latency-monitor.\n");

242  
»pÜt
;

247 
diùI‹¿tÜ
 *
di
;

248 
diùEÁry
 *
de
;

249 
ev’Šum
 = 0;

251 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
Ï‹ncy_ev’ts
);

252 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

253 *
ev’t
 = 
	`diùG‘Key
(
de
);

254 
Ï‹ncyTimeS”›s
 *
ts
 = 
	`diùG‘V®
(
de
);

255 
Ï‹ncySts
 
ls
;

257 ià(
ts
 =ğ
NULL
) ;

258 
ev’Šum
++;

259 ià(
ev’Šum
 == 1) {

260 
»pÜt
 = 
	`sdsÿt
(report,"Dave, I have observed†atency spikes inhis Redis instance. You don't mindalking‡bout it, do you Dave?\n\n");

262 
	`ª®yzeL©’cyFÜEv’t
(
ev’t
,&
ls
);

264 
»pÜt
 = 
	`sdsÿrštf
(report,

266 
ev’Šum
, 
ev’t
,

267 
ls
.
§m¶es
,

268 (è
ls
.
avg
,

269 (è
ls
.
mad
,

270 (è
ls
.
³riod
/ls.
§m¶es
,

271 (è
ts
->
max
);

274 ià(!
	`¡rÿ£cmp
(
ev’t
,"fork")) {

275 *
fÜk_qu®™y
;

276 ià(
£rv”
.
¡©_fÜk_¿‹
 < 10) {

277 
fÜk_qu®™y
 = "terrible";

278 
advi£_b‘‹r_vm
 = 1;

279 
adviûs
++;

280 } ià(
£rv”
.
¡©_fÜk_¿‹
 < 25) {

281 
fÜk_qu®™y
 = "poor";

282 
advi£_b‘‹r_vm
 = 1;

283 
adviûs
++;

284 } ià(
£rv”
.
¡©_fÜk_¿‹
 < 100) {

285 
fÜk_qu®™y
 = "good";

287 
fÜk_qu®™y
 = "excellent";

289 
»pÜt
 = 
	`sdsÿrštf
(report,

290 " FÜk„©i %.2àGB/£ø(%s).", 
£rv”
.
¡©_fÜk_¿‹
,

291 
fÜk_qu®™y
);

295 ià(!
	`¡rÿ£cmp
(
ev’t
,"command")) {

296 ià(
£rv”
.
¦owlog_log_¦ow”_thª
 == 0) {

297 
advi£_¦owlog_’abËd
 = 1;

298 
adviûs
++;

299 } ià(
£rv”
.
¦owlog_log_¦ow”_thª
/1000 >

300 
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
)

302 
advi£_¦owlog_tunšg
 = 1;

303 
adviûs
++;

305 
advi£_¦owlog_š¥eù
 = 1;

306 
advi£_Ïrge_objeùs
 = 1;

307 
adviûs
 += 2;

311 ià(!
	`¡rÿ£cmp
(
ev’t
,"fast-command")) {

312 
advi£_scheduËr
 = 1;

313 
adviûs
++;

317 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-write-pending-fsync")) {

318 
advi£_loÿl_disk
 = 1;

319 
advi£_disk_cÚ‹ÁiÚ
 = 1;

320 
advi£_ssd
 = 1;

321 
advi£_d©a_wr™eback
 = 1;

322 
adviûs
 += 4;

325 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-write-active-child")) {

326 
advi£_no_­³ndfsync
 = 1;

327 
advi£_d©a_wr™eback
 = 1;

328 
advi£_ssd
 = 1;

329 
adviûs
 += 3;

332 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-write-alone")) {

333 
advi£_loÿl_disk
 = 1;

334 
advi£_d©a_wr™eback
 = 1;

335 
advi£_ssd
 = 1;

336 
adviûs
 += 3;

339 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-fsync-always")) {

340 
advi£_»Ïx_fsync_pŞicy
 = 1;

341 
adviûs
++;

344 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-fstat") ||

345 !
	`¡rÿ£cmp
(
ev’t
,"rdb-unlik-temp-file")) {

346 
advi£_disk_cÚ‹ÁiÚ
 = 1;

347 
advi£_loÿl_disk
 = 1;

348 
adviûs
 += 2;

351 ià(!
	`¡rÿ£cmp
(
ev’t
,"aof-rewrite-diff-write") ||

352 !
	`¡rÿ£cmp
(
ev’t
,"aof-rename")) {

353 
advi£_wr™e_lßd_šfo
 = 1;

354 
advi£_d©a_wr™eback
 = 1;

355 
advi£_ssd
 = 1;

356 
advi£_loÿl_disk
 = 1;

357 
adviûs
 += 4;

361 ià(!
	`¡rÿ£cmp
(
ev’t
,"expire-cycle")) {

362 
advi£_hz
 = 1;

363 
advi£_Ïrge_objeùs
 = 1;

364 
adviûs
 += 2;

368 ià(!
	`¡rÿ£cmp
(
ev’t
,"eviction-del")) {

369 
advi£_Ïrge_objeùs
 = 1;

370 
adviûs
++;

373 ià(!
	`¡rÿ£cmp
(
ev’t
,"eviction-cycle")) {

374 
advi£_mass_eviùiÚ
 = 1;

375 
adviûs
++;

378 
»pÜt
 = 
	`sdsÿ’
(report,"\n",1);

380 
	`diùR–—£I‹¿tÜ
(
di
);

383 ià(
	`THPG‘AnÚHugePagesSize
() > 0) {

384 
advi£_di§bË_thp
 = 1;

385 
adviûs
++;

388 ià(
ev’Šum
 =ğ0 && 
adviûs
 == 0) {

389 
»pÜt
 = 
	`sdsÿt
(report,"Dave,‚o†atency spike was observed duringhe†ifetime ofhis Redis instance,‚ot inhe slightest bit. I honestlyhink you oughto sit down calmly,ake‡ stress…ill,‡ndhinkhings over.\n");

390 } ià(
ev’Šum
 > 0 && 
adviûs
 == 0) {

391 
»pÜt
 = 
	`sdsÿt
(report,"\nWhilehere‡re†atencyƒvents†ogged, I'm‚ot‡bleo suggest‡nyƒasy fix. Please usehe Redis communityo get some help,…rovidinghis„eport in your help„equest.\n");

396 
»pÜt
 = 
	`sdsÿt
(report,"\nI have‡ few‡dvices for you:\n\n");

397 ià(
advi£_b‘‹r_vm
) {

398 
»pÜt
 = 
	`sdsÿt
(report,"- If you‡re using‡ virtual machine, consider upgrading it with‡ faster one using‡n hypervisiorhat…rovides†ess†atency during fork() calls. Xen is knowno have…oor fork()…erformance. Even inhe context ofhe same VM…rovider, certain kinds of instances canƒxecute fork fasterhan others.\n");

402 ià(
advi£_¦owlog_’abËd
) {

403 
»pÜt
 = 
	`sdsÿrštf
Ô•Üt,"- Th”¬Ï‹ncy issue w™h…Ù’tŸÎy slow commªd you‡» usšg. TryØ’abËhSlow Log Redi ã©u» usšghcommªd 'CONFIG SET slowlog-log-¦ow”-thª %Îu'. IàthSlow†og i di§bËd Redi i nÙ‡bËØlog slow commªd executiÚ fÜ you.\n", ()
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
*1000);

406 ià(
advi£_¦owlog_tunšg
) {

407 
»pÜt
 = 
	`sdsÿrštf
Ô•Üt,"- You¸cu¼’ˆSlow Log cÚfigu¿tiÚ oÆy†og ev’t th©‡» slow”hª you¸cÚfigu»d†©’cy mÚ™Üh»shŞd. PËa£ u£ 'CONFIG SET slowlog-log-¦ow”-thª %Îu'.\n", ()
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
*1000);

410 ià(
advi£_¦owlog_š¥eù
) {

411 
»pÜt
 = 
	`sdsÿt
(report,"- Check your Slow Logo understand what‡rehe commands you‡re„unning which‡reoo slowoƒxecute. Please check http://redis.io/commands/slowlog for more information.\n");

415 ià(
advi£_scheduËr
) {

416 
»pÜt
 = 
	`sdsÿt
(report,"- The system is slowoƒxecute Redis code…aths‚ot containing system calls. This usually meanshe system does‚ot…rovide Redis CPUimeo„un for†ong…eriods. You shouldryo:\n"

425 ià(
advi£_loÿl_disk
) {

426 
»pÜt
 = 
	`sdsÿt
(report,"- It is strongly‡dvisedo use†ocal disks for…ersistence,ƒspecially if you‡re using AOF. Remote disks…rovided by…latform-as-a-service…roviders‡re knowno be slow.\n");

429 ià(
advi£_ssd
) {

430 
»pÜt
 = 
	`sdsÿt
(report,"- SSD disks‡re‡bleo„educe fsync†atency,‡ndotalime‚eeded for snapshotting‡nd AOF†og„ewriting (resulting in smaller memory usage‡nd smaller final AOF„ewrite buffer flushes). Withƒxtremely high write†oad SSD disks can be‡ good option. However Redis should…erform„easonably with high†oad using‚ormal disks. Usehis‡dvice‡s‡†ast„esort.\n");

433 ià(
advi£_d©a_wr™eback
) {

434 
»pÜt
 = 
	`sdsÿt
(report,"- Mountingƒxt3/4 filesystems with data=writeback can…rovide‡…erformance boost comparedo data=ordered, howeverhis mode of operation…rovides†ess guarantees,‡nd sometimes it can happenhat‡fter‡ hard crashhe AOF file will have‡n half-written command‡theƒnd‡nd will„equireo be„epaired before Redis„estarts.\n");

437 ià(
advi£_disk_cÚ‹ÁiÚ
) {

438 
»pÜt
 = 
	`sdsÿt
(report,"- Tryo†owerhe disk contention. This is often caused by other disk intensive…rocesses„unning inhe same computer (including other Redis instances).\n");

441 ià(
advi£_no_­³ndfsync
) {

442 
»pÜt
 = 
	`sdsÿt
(report,"- Assuming fromhe…oint of view of data safetyhis is viable in yourƒnvironment, you couldryoƒnablehe 'no-appendfsync-on-rewrite' option, sohat fsync will‚ot be…erformed whilehere is‡ child„ewritinghe AOF file or…roducing‡n RDB file (the moment wherehere is high disk contention).\n");

445 ià(
advi£_»Ïx_fsync_pŞicy
 && 
£rv”
.
aof_fsync
 =ğ
AOF_FSYNC_ALWAYS
) {

446 
»pÜt
 = 
	`sdsÿt
(report,"- Your fsync…olicy is seto 'always'. It is very hardo get good…erformances with such‡ setup, if…ossibleryo„elaxhe fsync…olicyo 'onesec'.\n");

449 ià(
advi£_wr™e_lßd_šfo
) {

450 
»pÜt
 = 
	`sdsÿt
(report,"- Latency duringhe AOF‡tomic„ename operation or whenhe final difference is flushedohe AOF file‡theƒnd ofhe„ewrite, sometimes is caused by very high write†oad, causinghe AOF buffero get very†arge. If…ossibleryo send†ess commandso‡ccomplishhe same work, or use Lua scriptso group multiple operations into‡ single EVALSHA call.\n");

453 ià(
advi£_hz
 && 
£rv”
.
hz
 < 100) {

454 
»pÜt
 = 
	`sdsÿt
(report,"- In ordero makehe Redis keysƒxpiring…rocess more incremental,ryo sethe 'hz' configuration…arametero 100 using 'CONFIG SET hz 100'.\n");

457 ià(
advi£_Ïrge_objeùs
) {

458 
»pÜt
 = 
	`sdsÿt
(report,"- Deleting,ƒxpiring orƒvicting (because of maxmemory…olicy)†arge objects is‡ blocking operation. If you have very†arge objectshat‡re often deleted,ƒxpired, orƒvicted,ryo fragmenthose objects into multiple smaller objects.\n");

461 ià(
advi£_mass_eviùiÚ
) {

462 
»pÜt
 = 
	`sdsÿt
(report,"- Sudden changesohe 'maxmemory' setting via 'CONFIG SET', or‡llocation of†arge objects via sets or sorted sets intersections, STORE option of SORT, Redis Cluster†arge keys migrations (RESTORE command), may create sudden memory…ressure forcinghe servero blockryingoƒvict keys. \n");

465 ià(
advi£_di§bË_thp
) {

466 
»pÜt
 = 
	`sdsÿt
(report,"- I detected‡‚on zero‡mount of‡nonymous huge…ages used by your…rocess. This creates very serious†atencyƒvents in different conditions,ƒspecially when Redis is…ersisting on disk. To disable THP support usehe command 'echo‚ever > /sys/kernel/mm/transparent_hugepage/enabled', make sureo‡lso‡dd it into /etc/rc.local sohathe command will beƒxecuted‡gain‡fter‡„eboot. Notehatƒven if you have‡lready disabled THP, you still‚eedo„estarthe Redis…rocesso get„id ofhe huge…ages‡lready created.\n");

470  
»pÜt
;

471 
	}
}

477 
	$Ï‹ncyCommªdR•lyW™hSam¶es
(
ş›Á
 *
c
, 
Ï‹ncyTimeS”›s
 *
ts
) {

478 *
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

479 
§m¶es
 = 0, 
j
;

481 
j
 = 0; j < 
LATENCY_TS_LEN
; j++) {

482 
i
 = (
ts
->
idx
 + 
j
è% 
LATENCY_TS_LEN
;

484 ià(
ts
->
§m¶es
[
i
].
time
 == 0) ;

485 
	`addR•lyMuÉiBulkL’
(
c
,2);

486 
	`addR•lyLÚgLÚg
(
c
,
ts
->
§m¶es
[
i
].
time
);

487 
	`addR•lyLÚgLÚg
(
c
,
ts
->
§m¶es
[
i
].
Ï‹ncy
);

488 
§m¶es
++;

490 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
§m¶es
);

491 
	}
}

495 
	$Ï‹ncyCommªdR•lyW™hL©e¡Ev’ts
(
ş›Á
 *
c
) {

496 
diùI‹¿tÜ
 *
di
;

497 
diùEÁry
 *
de
;

499 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
£rv”
.
Ï‹ncy_ev’ts
));

500 
di
 = 
	`diùG‘I‹¿tÜ
(
£rv”
.
Ï‹ncy_ev’ts
);

501 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

502 *
ev’t
 = 
	`diùG‘Key
(
de
);

503 
Ï‹ncyTimeS”›s
 *
ts
 = 
	`diùG‘V®
(
de
);

504 
Ï¡
 = (
ts
->
idx
 + 
LATENCY_TS_LEN
 - 1) % LATENCY_TS_LEN;

506 
	`addR•lyMuÉiBulkL’
(
c
,4);

507 
	`addR•lyBulkCSŒšg
(
c
,
ev’t
);

508 
	`addR•lyLÚgLÚg
(
c
,
ts
->
§m¶es
[
Ï¡
].
time
);

509 
	`addR•lyLÚgLÚg
(
c
,
ts
->
§m¶es
[
Ï¡
].
Ï‹ncy
);

510 
	`addR•lyLÚgLÚg
(
c
,
ts
->
max
);

512 
	`diùR–—£I‹¿tÜ
(
di
);

513 
	}
}

515 
	#LATENCY_GRAPH_COLS
 80

	)

516 
sds
 
	$Ï‹ncyCommªdG’S·rk–še
(*
ev’t
, 
Ï‹ncyTimeS”›s
 *
ts
) {

517 
j
;

518 
£qu’û
 *
£q
 = 
	`ü—‹S·rklšeSequ’û
();

519 
sds
 
g¿ph
 = 
	`sd£m±y
();

520 
ušt32_t
 
mš
 = 0, 
max
 = 0;

522 
j
 = 0; j < 
LATENCY_TS_LEN
; j++) {

523 
i
 = (
ts
->
idx
 + 
j
è% 
LATENCY_TS_LEN
;

524 
–­£d
;

525 
buf
[64];

527 ià(
ts
->
§m¶es
[
i
].
time
 == 0) ;

529 ià(
£q
->
Ëngth
 == 0) {

530 
mš
 = 
max
 = 
ts
->
§m¶es
[
i
].
Ï‹ncy
;

532 ià(
ts
->
§m¶es
[
i
].
Ï‹ncy
 > 
max
) max =s->samples[i].latency;

533 ià(
ts
->
§m¶es
[
i
].
Ï‹ncy
 < 
mš
) min =s->samples[i].latency;

537 
–­£d
 = 
	`time
(
NULL
è- 
ts
->
§m¶es
[
i
].
time
;

538 ià(
–­£d
 < 60)

539 
	`¢´štf
(
buf
,(buf),"%ds",
–­£d
);

540 ià(
–­£d
 < 3600)

541 
	`¢´štf
(
buf
,(buf),"%dm",
–­£d
/60);

542 ià(
–­£d
 < 3600*24)

543 
	`¢´štf
(
buf
,(buf),"%dh",
–­£d
/3600);

545 
	`¢´štf
(
buf
,(buf),"%dd",
–­£d
/(3600*24));

546 
	`¥¬klšeSequ’ûAddSam¶e
(
£q
,
ts
->
§m¶es
[
i
].
Ï‹ncy
,
buf
);

549 
g¿ph
 = 
	`sdsÿrštf
(graph,

550 "% - high %lu ms,†ow %lu m ×Îimhigh %lu ms)\n", 
ev’t
,

551 (è
max
, (è
mš
, (è
ts
->max);

552 
j
 = 0; j < 
LATENCY_GRAPH_COLS
; j++)

553 
g¿ph
 = 
	`sdsÿ’
(graph,"-",1);

554 
g¿ph
 = 
	`sdsÿ’
(graph,"\n",1);

555 
g¿ph
 = 
	`¥¬klšeR’d”
(g¿ph,
£q
,
LATENCY_GRAPH_COLS
,4,
SPARKLINE_FILL
);

556 
	`ä“S·rklšeSequ’û
(
£q
);

557  
g¿ph
;

558 
	}
}

567 
	$Ï‹ncyCommªd
(
ş›Á
 *
c
) {

568 
Ï‹ncyTimeS”›s
 *
ts
;

570 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"hi¡Üy"è&& c->
¬gc
 == 3) {

572 
ts
 = 
	`diùF‘chV®ue
(
£rv”
.
Ï‹ncy_ev’ts
,
c
->
¬gv
[2]->
±r
);

573 ià(
ts
 =ğ
NULL
) {

574 
	`addR•lyMuÉiBulkL’
(
c
,0);

576 
	`Ï‹ncyCommªdR•lyW™hSam¶es
(
c
,
ts
);

578 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"g¿ph"è&& c->
¬gc
 == 3) {

580 
sds
 
g¿ph
;

581 
diùEÁry
 *
de
;

582 *
ev’t
;

584 
de
 = 
	`diùFšd
(
£rv”
.
Ï‹ncy_ev’ts
,
c
->
¬gv
[2]->
±r
);

585 ià(
de
 =ğ
NULL
è
nod©«¼
;

586 
ts
 = 
	`diùG‘V®
(
de
);

587 
ev’t
 = 
	`diùG‘Key
(
de
);

589 
g¿ph
 = 
	`Ï‹ncyCommªdG’S·rk–še
(
ev’t
,
ts
);

590 
	`addR•lyBulkCSŒšg
(
c
,
g¿ph
);

591 
	`sdsä“
(
g¿ph
);

592 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"Ï‹¡"è&& c->
¬gc
 == 2) {

594 
	`Ï‹ncyCommªdR•lyW™hL©e¡Ev’ts
(
c
);

595 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"doùÜ"è&& c->
¬gc
 == 2) {

597 
sds
 
»pÜt
 = 
	`ü—‹L©’cyR•Üt
();

599 
	`addR•lyBulkCBufãr
(
c
,
»pÜt
,
	`sd¦’
(report));

600 
	`sdsä“
(
»pÜt
);

601 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"»£t"è&& c->
¬gc
 >= 2) {

603 ià(
c
->
¬gc
 == 2) {

604 
	`addR•lyLÚgLÚg
(
c
,
	`Ï‹ncyRe£tEv’t
(
NULL
));

606 
j
, 
»£ts
 = 0;

608 
j
 = 2; j < 
c
->
¬gc
; j++)

609 
»£ts
 +ğ
	`Ï‹ncyRe£tEv’t
(
c
->
¬gv
[
j
]->
±r
);

610 
	`addR•lyLÚgLÚg
(
c
,
»£ts
);

613 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

617 
nod©«¼
:

620 
	`addR•lyE¼ÜFÜm©
(
c
,

621 "NØ§m¶e avaabË fÜƒv’ˆ'%s'", (*è
c
->
¬gv
[2]->
±r
);

622 
	}
}

	@latency.h

34 #iâdeà
__LATENCY_H


35 
	#__LATENCY_H


	)

37 
	#LATENCY_TS_LEN
 160

	)

41 
	sÏ‹ncySam¶e
 {

42 
št32_t
 
	mtime
;

43 
ušt32_t
 
	mÏ‹ncy
;

47 
	sÏ‹ncyTimeS”›s
 {

48 
	midx
;

49 
ušt32_t
 
	mmax
;

50 
Ï‹ncySam¶e
 
	m§m¶es
[
LATENCY_TS_LEN
];

54 
	sÏ‹ncySts
 {

55 
ušt32_t
 
	m®l_time_high
;

56 
ušt32_t
 
	mavg
;

57 
ušt32_t
 
	mmš
;

58 
ušt32_t
 
	mmax
;

59 
ušt32_t
 
	mmad
;

60 
ušt32_t
 
	m§m¶es
;

61 
time_t
 
	m³riod
;

64 
Ï‹ncyMÚ™ÜIn™
();

65 
Ï‹ncyAddSam¶e
(*
ev’t
, 
m¡ime_t
 
Ï‹ncy
);

66 
THPIsEÇbËd
();

71 
	#Ï‹ncyS¹MÚ™Ü
(
v¬
èià(
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
) { \

72 
v¬
 = 
	`m¡ime
(); \

74 
v¬
 = 0; \

75 }

	)

79 
	#Ï‹ncyEndMÚ™Ü
(
v¬
èià(
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
) { \

80 
v¬
 = 
	`m¡ime
() - var; \

81 }

	)

84 
	#Ï‹ncyAddSam¶eIfN“ded
(
ev’t
,
v¬
) \

85 ià(
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
 && \

86 (
v¬
è>ğ
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
) \

87 
	`Ï‹ncyAddSam¶e
((
ev’t
),(
v¬
));

	)

90 
	#Ï‹ncyRemoveNe¡edEv’t
(
ev’t_v¬
,
Ã¡ed_v¬
) \

91 
ev’t_v¬
 +ğ
Ã¡ed_v¬
;

	)

	@lazyfree.c

1 
	~"£rv”.h
"

2 
	~"bio.h
"

3 
	~"©omicv¬.h
"

4 
	~"şu¡”.h
"

6 
size_t
 
	gÏzyä“_objeùs
 = 0;

7 
±h»ad_mu‹x_t
 
	gÏzyä“_objeùs_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

10 
size_t
 
	$Ïzyä“G‘P’dšgObjeùsCouÁ
() {

11  
Ïzyä“_objeùs
;

12 
	}
}

29 
size_t
 
	$Ïzyä“G‘F»eEffÜt
(
robj
 *
obj
) {

30 ià(
obj
->
ty³
 =ğ
OBJ_LIST
) {

31 
quickli¡
 *
ql
 = 
obj
->
±r
;

32  
ql
->
Ën
;

33 } ià(
obj
->
ty³
 =ğ
OBJ_SET
 && obj->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

34 
diù
 *
ht
 = 
obj
->
±r
;

35  
	`diùSize
(
ht
);

36 } ià(
obj
->
ty³
 =ğ
OBJ_ZSET
 && obj->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
){

37 
z£t
 *
zs
 = 
obj
->
±r
;

38  
zs
->
z¦
->
Ëngth
;

39 } ià(
obj
->
ty³
 =ğ
OBJ_HASH
 && obj->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

40 
diù
 *
ht
 = 
obj
->
±r
;

41  
	`diùSize
(
ht
);

45 
	}
}

51 
	#LAZYFREE_THRESHOLD
 64

	)

52 
	$dbAsyncD–‘e
(
»disDb
 *
db
, 
robj
 *
key
) {

55 ià(
	`diùSize
(
db
->
expœes
è> 0è
	`diùD–‘e
(db->expœes,
key
->
±r
);

60 
diùEÁry
 *
de
 = 
	`diùUÆšk
(
db
->
diù
,
key
->
±r
);

61 ià(
de
) {

62 
robj
 *
v®
 = 
	`diùG‘V®
(
de
);

63 
size_t
 
ä“_effÜt
 = 
	`Ïzyä“G‘F»eEffÜt
(
v®
);

67 ià(
ä“_effÜt
 > 
LAZYFREE_THRESHOLD
) {

68 
	`©omicInü
(
Ïzyä“_objeùs
,1,
Ïzyä“_objeùs_mu‹x
);

69 
	`bioC»©eBackgroundJob
(
BIO_LAZY_FREE
,
v®
,
NULL
,NULL);

70 
	`diùS‘V®
(
db
->
diù
,
de
,
NULL
);

76 ià(
de
) {

77 
	`diùF»eUÆškedEÁry
(
db
->
diù
,
de
);

78 ià(
£rv”
.
şu¡”_’abËd
è
	`¦ÙToKeyD–
(
key
);

83 
	}
}

88 
	$em±yDbAsync
(
»disDb
 *
db
) {

89 
diù
 *
Şdht1
 = 
db
->diù, *
Şdht2
 = db->
expœes
;

90 
db
->
diù
 = 
	`diùC»©e
(&
dbDiùTy³
,
NULL
);

91 
db
->
expœes
 = 
	`diùC»©e
(&
key±rDiùTy³
,
NULL
);

92 
	`©omicInü
(
Ïzyä“_objeùs
,
	`diùSize
(
Şdht1
),

93 
Ïzyä“_objeùs_mu‹x
);

94 
	`bioC»©eBackgroundJob
(
BIO_LAZY_FREE
,
NULL
,
Şdht1
,
Şdht2
);

95 
	}
}

99 
	$¦ÙToKeyFlushAsync
() {

100 
zskli¡
 *
Şd¦
 = 
£rv”
.
şu¡”
->
¦Ùs_to_keys
;

101 
£rv”
.
şu¡”
->
¦Ùs_to_keys
 = 
	`z¦C»©e
();

102 
	`©omicInü
(
Ïzyä“_objeùs
,
Şd¦
->
Ëngth
,

103 
Ïzyä“_objeùs_mu‹x
);

104 
	`bioC»©eBackgroundJob
(
BIO_LAZY_FREE
,
NULL
,NULL,
Şd¦
);

105 
	}
}

109 
	$Ïzyä“F»eObjeùFromBioTh»ad
(
robj
 *
o
) {

110 
	`deüRefCouÁ
(
o
);

111 
	`©omicDeü
(
Ïzyä“_objeùs
,1,
Ïzyä“_objeùs_mu‹x
);

112 
	}
}

119 
	$Ïzyä“F»eD©aba£FromBioTh»ad
(
diù
 *
ht1
, diù *
ht2
) {

120 
size_t
 
numkeys
 = 
	`diùSize
(
ht1
);

121 
	`diùR–—£
(
ht1
);

122 
	`diùR–—£
(
ht2
);

123 
	`©omicDeü
(
Ïzyä“_objeùs
,
numkeys
,
Ïzyä“_objeùs_mu‹x
);

124 
	}
}

128 
	$Ïzyä“F»eSlÙsM­FromBioTh»ad
(
zskli¡
 *
¦
) {

129 
size_t
 
Ën
 = 
¦
->
Ëngth
;

130 
	`z¦F»e
(
¦
);

131 
	`©omicDeü
(
Ïzyä“_objeùs
,
Ën
,
Ïzyä“_objeùs_mu‹x
);

132 
	}
}

	@libchash.c

122 
	~<¡dlib.h
>

123 
	~<¡dio.h
>

124 
	~<¡ršg.h
>

125 
	~<sys/ty³s.h
>

126 
	~<Ãtš‘/š.h
>

127 
	~<as£¹.h
>

128 
	~"libchash.h
"

129 
	~"zm®loc.h
"

133 
	ggrgKeyTruncMask
[(
ulÚg
)][(ulong)];

134 
	#KEY_TRUNC
(
ht
, 
key
) \

135 Ğ
	`STORES_PTR
(
ht
è|| (ht)->
cchKey
 =ğ(
ulÚg
) \

136 ? (
key
è: ((keyè& *(
ulÚg
 *)&(
grgKeyTruncMask
[(
ht
)->
cchKey
][0])è)

	)

139 
	#WORD_ROUND
(
num
èĞ(Òum-1è| ((1<<(
LOG_WORD_SIZE
-3))-1)è+ 1 )

	)

140 
	#NULL_TERMINATED
 0

	)

144 
	#KEY_CMP
(
ht
, 
key1
, 
key2
èĞ!
	`STORES_PTR
(ht) ? (key1) - (key2) : \

145 (
key1
è=ğ(
key2
) ? 0 : \

146 
	`HashKeySize
(
ht
è=ğ
NULL_TERMINATED
 ? \

147 
	`¡rcmp
((*)
key1
, (*)
key2
) :\

148 
	`memcmp
((*)
key1
, (*)
key2
, \

149 
	`HashKeySize
(
ht
)è)

	)

151 
	#COPY_KEY
(
ht
, 
keyTo
, 
keyFrom
) do \

152 iàĞ!
	`STORES_PTR
(
ht
è|| !(ht)->
fSaveKeys
 ) \

153 (
keyTo
èğ(
keyFrom
); \

154 iàĞ(
ht
)->
cchKey
 =ğ
NULL_TERMINATED
 ) \

156 (
keyTo
èğ(
ulÚg
)
	`zm®loc
Ğ
	`WORD_ROUND
(
	`¡¾’
((*)(
keyFrom
))+1) ); \

157 
	`¡rıy
((*)(
keyTo
), (*)(
keyFrom
)); \

161 (
keyTo
èğ(
ulÚg
è
	`zm®loc
Ğ
	`WORD_ROUND
((
ht
)->
cchKey
) ); \

162 
	`memıy
Ğ(*)(
keyTo
), (*)(
keyFrom
), (
ht
)->
cchKey
); \

164  0 )

	)

166 
	#FREE_KEY
(
ht
, 
key
) do \

167 iàĞ
	`STORES_PTR
(
ht
è&& (ht)->
fSaveKeys
 ) \

168 iàĞ(
ht
)->
cchKey
 =ğ
NULL_TERMINATED
 ) \

169 
	`HTä“
((*)(
key
), 
	`WORD_ROUND
(
	`¡¾’
((*)(key))+1)); \

171 
	`HTä“
((*)(
key
), 
	`WORD_ROUND
((
ht
)->
cchKey
)); \

172  0 )

	)

176 
ulÚg
 
	tHTB™m­P¬t
;

177 
HTB™m­P¬t
 
	tHTB™m­
[1<<
LOG_BM_WORDS
];

178 
ulÚg
 
	tHTOff£t
;

180 
	#BM_BYTES
(
cBuck‘s
) \

181 Ğ(((
cBuck‘s
è+ 8*(
ulÚg
)-1è>> 
LOG_WORD_SIZE
è<< (LOG_WORD_SIZE-3è)

	)

182 
	#MOD2
(
i
, 
logmod
èĞ(iè& ((1<<Öogmod))-1è)

	)

183 
	#DIV_NUM_ENTRIES
(
i
èĞ(iè>> 
LOG_WORD_SIZE
 )

	)

184 
	#MOD_NUM_ENTRIES
(
i
èĞ
	`MOD2
(i, 
LOG_WORD_SIZE
è)

	)

185 
	#MODBIT
(
i
èĞ((
ulÚg
)1è<< 
	`MOD_NUM_ENTRIES
(iè)

	)

187 
	#TEST_BITMAP
(
bm
, 
i
èĞ(bm)[
	`DIV_NUM_ENTRIES
(i)] & 
	`MODBIT
(iè? 1 : 0 )

	)

188 
	#SET_BITMAP
(
bm
, 
i
è(bm)[
	`DIV_NUM_ENTRIES
(i)] |ğ
	`MODBIT
(i)

	)

189 
	#CLEAR_BITMAP
(
bm
, 
i
è(bm)[
	`DIV_NUM_ENTRIES
(i)] &ğ~
	`MODBIT
(i)

	)

192 
	#READ_UL
(
å
, 
d©a
) \

194 
_ul
; \

195 
	`ä—d
(&
_ul
, (_ul), 1, (
å
)); \

196 
d©a
 = 
	`Áohl
(
_ul
); \

197 } 0)

	)

199 
	#WRITE_UL
(
å
, 
d©a
) \

201 
_ul
 = 
	`htÚl
(()(
d©a
)); \

202 
	`fwr™e
(&
_ul
, (_ul), 1, (
å
)); \

203 } 0)

	)

207 
	#LOAD_AND_RETURN
(
ht
, 
lßdCommªd
) \

208 iàĞ!(
ht
)->
åD©a
 ) \

209  (
lßdCommªd
); \

212 
cchD©a
; \

213 
HTI‹m
 *
bck
; \

214 iàĞ(
ht
)->
bckD©a
.
d©a
 ) 
	`ä“
((*)(ht)->bckData.data); \

215 
ht
->
bckD©a
.
d©a
 = (
ulÚg
)
NULL
; \

216 
bck
 = (
lßdCommªd
); \

217 iàĞ
bck
 =ğ
NULL
 ) \

218  
NULL
; \

220 (
ht
)->
bckD©a
 = *
bck
; \

221 
	`f£ek
(
ht
->
åD©a
, (ht)->
bckD©a
.
d©a
, 
SEEK_SET
); \

222 
	`READ_UL
((
ht
)->
åD©a
, 
cchD©a
); \

223 (
ht
)->
bckD©a
.
d©a
 = (
ulÚg
)(ht)->
	`d©aR—d
((ht)->
åD©a
, 
cchD©a
); \

224  &((
ht
)->
bckD©a
); \

225 }

	)

235 *
	$HTsm®loc
(
size
)

237 *
»tv®
;

239 iàĞ
size
 == 0 )

240  
NULL
;

241 
»tv®
 = (*)
	`m®loc
(
size
);

242 iàĞ!
»tv®
 )

244 
	`årštf
(
¡d”r
, "HTsmalloc: Unableo‡llocate %lu bytes of memory\n",

245 
size
);

246 
	`ex™
(1);

248  
»tv®
;

249 
	}
}

255 *
	$HTsÿÎoc
(
size
)

257 *
»tv®
;

259 
»tv®
 = (*)
	`ÿÎoc
(
size
, 1);

260 iàĞ!
»tv®
 && 
size
 > 0 )

262 
	`årštf
(
¡d”r
, "HTscalloc: Unableo‡llocate %lu bytes of memory\n",

263 
size
);

264 
	`ex™
(1);

266  
»tv®
;

267 
	}
}

273 *
	$HT¤—Îoc
(*
±r
, 
Ãw_size
, 
d–
)

275 iàĞ
±r
 =ğ
NULL
 )

276  
	`zm®loc
(
Ãw_size
);

277 
±r
 = 
	`»®loc
ÕŒ, 
Ãw_size
);

278 iàĞ!
±r
 && 
Ãw_size
 > 0 )

280 
	`årštf
(
¡d”r
, "HTsrealloc: Unableo„eallocate %lu bytes of memory\n",

281 
Ãw_size
);

282 
	`ex™
(1);

284  
±r
;

285 
	}
}

291 
	$HTä“
(*
±r
, 
size
)

293 iàĞ
size
 > 0 )

294 
	`ä“
(
±r
);

295 
	}
}

303 
	$HTcİy
(*
ul
)

305 
»tv®
;

307 
	`memıy
(&
»tv®
, 
ul
, (retval));

308  
»tv®
;

309 
	}
}

317 
	$HTS‘upKeyTrunc
()

319 
i
, 
j
;

321  
i
 = 0; i < (); i++ )

322  
j
 = 0; j < (); j++ )

323 
grgKeyTruncMask
[
i
][
j
] = j < i ? 255 : 0;

324 
	}
}

361 #iâdeà
S·r£Buck‘


362 
	#S·r£Buck‘
 
HTI‹m


	)

365 
	sS·r£Bš
 {

366 
S·r£Buck‘
 *
	mbšS·r£
;

367 
HTB™m­
 
	mbmOccup›d
;

368 
	mcOccup›d
;

369 } 
	tS·r£Bš
;

371 
	sS·r£I‹¿tÜ
 {

372 
	mposGroup
;

373 
	mposOff£t
;

374 
S·r£Bš
 *
	mbšS·r£
;

375 
ulÚg
 
	mcBuck‘s
;

376 } 
	tS·r£I‹¿tÜ
;

378 
	#LOG_LOW_BIN_SIZE
 ( 
LOG_BM_WORDS
+
LOG_WORD_SIZE
 )

	)

379 
	#SPARSE_GROUPS
(
cBuck‘s
èĞ(((cBuck‘s)-1è>> 
LOG_LOW_BIN_SIZE
è+ 1 )

	)

382 
HTOff£t
 
	$EÁr›sU±o
(
HTB™m­P¬t
 *
bm
, 
i
)

384 
HTOff£t
 
»tv®
 = 0;

385 
HTOff£t
 
rgcB™s
[256] =

403 iàĞ
i
 == 0 )  0;

404  ; 
i
 > (*
bm
)*8; i -= (*bm)*8, bm++ )

406 #ià
LOG_WORD_SIZE
 >= 3

407 
»tv®
 +ğ
rgcB™s
[*
bm
 & 255];

408 #ià
LOG_WORD_SIZE
 >= 4

409 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 8) & 255];

410 #ià
LOG_WORD_SIZE
 >= 5

411 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 16) & 255];

412 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 24) & 255];

413 #ià
LOG_WORD_SIZE
 >= 6

414 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 32) & 255];

415 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 40) & 255];

416 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 48) & 255];

417 
»tv®
 +ğ
rgcB™s
[(*
bm
 >> 56) & 255];

418 #ià
LOG_WORD_SIZE
 >= 7

419 #”rÜ 
N“d
 
to
 
»wr™e
 
EÁr›sU±o
Ø
suµÜt
 
such
 
big
 
wÜds


426  
i
 ) {

428  
»tv®
;

429 #ià
LOG_WORD_SIZE
 >= 3

431  (
»tv®
 + 
rgcB™s
[*
bm
 & ((1 << 
i
)-1)]);

432 #ià
LOG_WORD_SIZE
 >= 4

434  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +

435 
rgcB™s
[(*
bm
 >> 8è& ((1 << (
i
-8))-1)]);

436 #ià
LOG_WORD_SIZE
 >= 5

438  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

439 
rgcB™s
[(*
bm
 >> 16è& ((1 << (
i
-16))-1)]);

441  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

442 
rgcB™s
[(*
bm
 >> 16) & 255] +

443 
rgcB™s
[(*
bm
 >> 24è& ((1 << (
i
-24))-1)]);

444 #ià
LOG_WORD_SIZE
 >= 6

446  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

447 
rgcB™s
[(*
bm
 >> 16) & 255] +„gcBits[(*bm >> 24) & 255] +

448 
rgcB™s
[(*
bm
 >> 32è& ((1 << (
i
-32))-1)]);

450  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

451 
rgcB™s
[(*
bm
 >> 16) & 255] +„gcBits[(*bm >> 24) & 255] +

452 
rgcB™s
[(*
bm
 >> 32) & 255] +

453 
rgcB™s
[(*
bm
 >> 40è& ((1 << (
i
-40))-1)]);

455  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

456 
rgcB™s
[(*
bm
 >> 16) & 255] +„gcBits[(*bm >> 24) & 255] +

457 
rgcB™s
[(*
bm
 >> 32) & 255] +„gcBits[(*bm >> 40) & 255] +

458 
rgcB™s
[(*
bm
 >> 48è& ((1 << (
i
-48))-1)]);

460  (
»tv®
 + 
rgcB™s
[*
bm
 & 255] +„gcBits[(*bm >> 8) & 255] +

461 
rgcB™s
[(*
bm
 >> 16) & 255] +„gcBits[(*bm >> 24) & 255] +

462 
rgcB™s
[(*
bm
 >> 32) & 255] +„gcBits[(*bm >> 40) & 255] +

463 
rgcB™s
[(*
bm
 >> 48) & 255] +

464 
rgcB™s
[(*
bm
 >> 56è& ((1 << (
i
-56))-1)]);

470 
	`as£¹
("" == "word size isoo big in EntriesUpto()");

472 
	}
}

473 
	#SPARSE_POS_TO_OFFSET
(
bm
, 
i
èĞ
	`EÁr›sU±o
(&((bm)[0]), iè)

	)

474 
	#SPARSE_BUCKET
(
bš
, 
loÿtiÚ
) \

475 Ğ(
bš
)[(
loÿtiÚ
è>> 
LOG_LOW_BIN_SIZE
].
bšS·r£
 + \

476 
	`SPARSE_POS_TO_OFFSET
((
bš
)[(
loÿtiÚ
)>>
LOG_LOW_BIN_SIZE
].
bmOccup›d
, \

477 
	`MOD2
(
loÿtiÚ
, 
LOG_LOW_BIN_SIZE
)è)

	)

489 
ulÚg
 
	$S·r£AÎoÿ‹
(
S·r£Bš
 **
pbšS·r£
, 
ulÚg
 
cBuck‘s
)

491 
cGroups
 = 
	`SPARSE_GROUPS
(
cBuck‘s
);

493 *
pbšS·r£
 = (
S·r£Bš
 *è
	`zÿÎoc
((**pbšS·r£è* 
cGroups
);

494  
cGroups
 << 
LOG_LOW_BIN_SIZE
;

495 
	}
}

497 
S·r£Bš
 *
	$S·r£F»e
(
S·r£Bš
 *
bšS·r£
, 
ulÚg
 
cBuck‘s
)

499 
ulÚg
 
iGroup
, 
cGroups
 = 
	`SPARSE_GROUPS
(
cBuck‘s
);

501  
iGroup
 = 0; iGrou°< 
cGroups
; iGroup++ )

502 
	`HTä“
(
bšS·r£
[
iGroup
].binSparse, ((*binSparse[iGroup].binSparse)

503 * 
bšS·r£
[
iGroup
].
cOccup›d
));

504 
	`HTä“
(
bšS·r£
, (*bšS·r£è* 
cGroups
);

505  
NULL
;

506 
	}
}

516 
	$S·r£IsEm±y
(
S·r£Bš
 *
bšS·r£
, 
ulÚg
 
loÿtiÚ
)

518  !
	`TEST_BITMAP
(
bšS·r£
[
loÿtiÚ
>>
LOG_LOW_BIN_SIZE
].
bmOccup›d
,

519 
	`MOD2
(
loÿtiÚ
, 
LOG_LOW_BIN_SIZE
));

520 
	}
}

522 
S·r£Buck‘
 *
	$S·r£Fšd
(
S·r£Bš
 *
bšS·r£
, 
ulÚg
 
loÿtiÚ
)

524 iàĞ
	`S·r£IsEm±y
(
bšS·r£
, 
loÿtiÚ
) )

525  
NULL
;

526  
	`SPARSE_BUCKET
(
bšS·r£
, 
loÿtiÚ
);

527 
	}
}

538 
S·r£Buck‘
 *
	$S·r£In£¹
(
S·r£Bš
 *
bšS·r£
, 
S·r£Buck‘
 *
bckIn£¹
,

539 
ulÚg
 
loÿtiÚ
, *
pfOv”wr™e
)

541 
S·r£Buck‘
 *
bckPÏû
;

542 
HTOff£t
 
off£t
;

544 
bckPÏû
 = 
	`S·r£Fšd
(
bšS·r£
, 
loÿtiÚ
);

545 iàĞ
bckPÏû
 )

547 iàĞ*
pfOv”wr™e
 )

548 *
bckPÏû
 = *
bckIn£¹
;

549 *
pfOv”wr™e
 = 1;

550  
bckPÏû
;

553 
bšS·r£
 +ğ(
loÿtiÚ
 >> 
LOG_LOW_BIN_SIZE
);

554 
off£t
 = 
	`SPARSE_POS_TO_OFFSET
(
bšS·r£
->
bmOccup›d
,

555 
	`MOD2
(
loÿtiÚ
, 
LOG_LOW_BIN_SIZE
));

556 
bšS·r£
->bšS·r£ = (
S·r£Buck‘
 *)

557 
	`z»®loc
(
bšS·r£
->binSparse,

558 (*
bšS·r£
->bšS·r£è* ++bšS·r£->
cOccup›d
);

559 
	`memmove
(
bšS·r£
->bšS·r£ + 
off£t
+1,

560 
bšS·r£
->bšS·r£ + 
off£t
,

561 (
bšS·r£
->
cOccup›d
-1 - 
off£t
) * (*binSparse->binSparse));

562 
bšS·r£
->bšS·r£[
off£t
] = *
bckIn£¹
;

563 
	`SET_BITMAP
(
bšS·r£
->
bmOccup›d
, 
	`MOD2
(
loÿtiÚ
, 
LOG_LOW_BIN_SIZE
));

564 *
pfOv”wr™e
 = 0;

565  
bšS·r£
->bšS·r£ + 
off£t
;

566 
	}
}

576 
S·r£Buck‘
 *
	$S·r£NextBuck‘
(
S·r£I‹¿tÜ
 *
™”
)

578 iàĞ
™”
->
posOff£t
 != -1 &&

579 (++
™”
->
posOff£t
 < i‹r->
bšS·r£
[™”->
posGroup
].
cOccup›d
) )

580  
™”
->
bšS·r£
[™”->
posGroup
].bšS·r£ + i‹r->
posOff£t
;

582 
™”
->
posOff£t
 = 0;

583  
™”
->
posGroup
++; i‹r->posGrou°< 
	`SPARSE_GROUPS
(™”->
cBuck‘s
);

584 
™”
->
posGroup
++ )

585 iàĞ
™”
->
bšS·r£
[™”->
posGroup
].
cOccup›d
 > 0 )

586  
™”
->
bšS·r£
[™”->
posGroup
].binSparse;

587  
NULL
;

588 
	}
}

590 
S·r£Buck‘
 *
	$S·r£Fœ¡Buck‘
(
S·r£I‹¿tÜ
 *
™”
,

591 
S·r£Bš
 *
bšS·r£
, 
ulÚg
 
cBuck‘s
)

593 
™”
->
bšS·r£
 = binSparse;

594 
™”
->
cBuck‘s
 = cBuckets;

595 
™”
->
posOff£t
 = -1;

596 
™”
->
posGroup
 = -1;

597  
	`S·r£NextBuck‘
(
™”
);

598 
	}
}

609 
	$S·r£Wr™e
(
FILE
 *
å
, 
S·r£Bš
 *
bšS·r£
, 
ulÚg
 
cBuck‘s
)

611 
ulÚg
 
i
, 
j
;

613 
	`WRITE_UL
(
å
, 
cBuck‘s
);

614  
i
 = 0; i < 
	`SPARSE_GROUPS
(
cBuck‘s
); i++ )

615  
j
 = 0; j < (1<<
LOG_BM_WORDS
); j++ )

616 
	`WRITE_UL
(
å
, 
bšS·r£
[
i
].
bmOccup›d
[
j
]);

617 
	}
}

619 
ulÚg
 
	$S·r£R—d
(
FILE
 *
å
, 
S·r£Bš
 **
pbšS·r£
)

621 
ulÚg
 
i
, 
j
, 
cBuck‘s
;

623 
	`READ_UL
(
å
, 
cBuck‘s
);

624 
cBuck‘s
 = 
	`S·r£AÎoÿ‹
(
pbšS·r£
, cBuckets);

625  
i
 = 0; i < 
	`SPARSE_GROUPS
(
cBuck‘s
); i++ )

627  
j
 = 0; j < (1<<
LOG_BM_WORDS
); j++ )

628 
	`READ_UL
(
å
, (*
pbšS·r£
)[
i
].
bmOccup›d
[
j
]);

629 (*
pbšS·r£
)[
i
].
cOccup›d
 =

630 
	`SPARSE_POS_TO_OFFSET
((*
pbšS·r£
)[
i
].
bmOccup›d
,1<<
LOG_LOW_BIN_SIZE
);

631 (*
pbšS·r£
)[
i
].
bšS·r£
 =

632 (
S·r£Buck‘
 *è
	`zm®loc
((*((*
pbšS·r£
)[
i
].
bšS·r£
)) *

633 (*
pbšS·r£
)[
i
].
cOccup›d
);

635  
cBuck‘s
;

636 
	}
}

645 
ulÚg
 
	$S·r£MemÜy
(
ulÚg
 
cBuck‘s
, ulÚg 
cOccup›d
)

647  ( 
cOccup›d
 * (
S·r£Buck‘
) +

648 
	`SPARSE_GROUPS
(
cBuck‘s
è* (
S·r£Bš
) );

649 
	}
}

659 #iâdeà
D’£Buck‘


660 
	#D’£Buck‘
 
HTI‹m


	)

663 
	sD’£Bš
 {

664 
D’£Buck‘
 *
	mrgBuck‘s
;

665 } 
	tD’£Bš
;

667 
	sD’£I‹¿tÜ
 {

668 
	mpos
;

669 
D’£Bš
 *
	mbš
;

670 
ulÚg
 
	mcBuck‘s
;

671 } 
	tD’£I‹¿tÜ
;

673 
	#DENSE_IS_EMPTY
(
bš
, 
i
èĞ(bš)[i].
d©a
 =ğ
EMPTY
 )

	)

674 
	#DENSE_SET_EMPTY
(
bš
, 
i
è(bš)[i].
d©a
 = 
EMPTY


	)

675 
	#DENSE_SET_OCCUPIED
(
bš
, 
i
è(bš)[i].
d©a
 = 1

	)

677 
	$D’£CË¬
(
D’£Bš
 *
bš
, 
ulÚg
 
cBuck‘s
)

679  
cBuck‘s
-- )

680 
	`DENSE_SET_EMPTY
(
bš
->
rgBuck‘s
, 
cBuck‘s
);

681 
	}
}

683 
ulÚg
 
	$D’£AÎoÿ‹
(
D’£Bš
 **
pbš
, 
ulÚg
 
cBuck‘s
)

685 *
pbš
 = (
D’£Bš
 *è
	`zm®loc
((*pbin));

686 (*
pbš
)->
rgBuck‘s
 = (
D’£Buck‘
 *è
	`zm®loc
((*(*pbin)->rgBuckets)

687 * 
cBuck‘s
);

688 
	`D’£CË¬
(*
pbš
, 
cBuck‘s
);

689  
cBuck‘s
;

690 
	}
}

692 
D’£Bš
 *
	$D’£F»e
(
D’£Bš
 *
bš
, 
ulÚg
 
cBuck‘s
)

694 
	`HTä“
(
bš
->
rgBuck‘s
, (*bš->rgBuck‘sè* 
cBuck‘s
);

695 
	`HTä“
(
bš
, (*bin));

696  
NULL
;

697 
	}
}

699 
	$D’£IsEm±y
(
D’£Bš
 *
bš
, 
ulÚg
 
loÿtiÚ
)

701  
	`DENSE_IS_EMPTY
(
bš
->
rgBuck‘s
, 
loÿtiÚ
);

702 
	}
}

704 
D’£Buck‘
 *
	$D’£Fšd
(
D’£Bš
 *
bš
, 
ulÚg
 
loÿtiÚ
)

706 iàĞ
	`D’£IsEm±y
(
bš
, 
loÿtiÚ
) )

707  
NULL
;

708  
bš
->
rgBuck‘s
 + 
loÿtiÚ
;

709 
	}
}

711 
D’£Buck‘
 *
	$D’£In£¹
(
D’£Bš
 *
bš
, 
D’£Buck‘
 *
bckIn£¹
,

712 
ulÚg
 
loÿtiÚ
, *
pfOv”wr™e
)

714 
D’£Buck‘
 *
bckPÏû
;

716 
bckPÏû
 = 
	`D’£Fšd
(
bš
, 
loÿtiÚ
);

717 iàĞ
bckPÏû
 )

719 iàĞ*
pfOv”wr™e
 )

720 *
bckPÏû
 = *
bckIn£¹
;

721 *
pfOv”wr™e
 = 1;

722  
bckPÏû
;

726 
bš
->
rgBuck‘s
[
loÿtiÚ
] = *
bckIn£¹
;

727 *
pfOv”wr™e
 = 0;

728  
bš
->
rgBuck‘s
 + 
loÿtiÚ
;

730 
	}
}

732 
D’£Buck‘
 *
	$D’£NextBuck‘
(
D’£I‹¿tÜ
 *
™”
)

734  
™”
->
pos
++; i‹r->po < i‹r->
cBuck‘s
; iter->pos++ )

735 iàĞ!
	`D’£IsEm±y
(
™”
->
bš
, i‹r->
pos
) )

736  
™”
->
bš
->
rgBuck‘s
 + i‹r->
pos
;

737  
NULL
;

738 
	}
}

740 
D’£Buck‘
 *
	$D’£Fœ¡Buck‘
(
D’£I‹¿tÜ
 *
™”
,

741 
D’£Bš
 *
bš
, 
ulÚg
 
cBuck‘s
)

743 
™”
->
bš
 = bin;

744 
™”
->
cBuck‘s
 = cBuckets;

745 
™”
->
pos
 = -1;

746  
	`D’£NextBuck‘
(
™”
);

747 
	}
}

749 
	$D’£Wr™e
(
FILE
 *
å
, 
D’£Bš
 *
bš
, 
ulÚg
 
cBuck‘s
)

751 
ulÚg
 
pos
 = 0, 
b™
, 
bm
;

753 
	`WRITE_UL
(
å
, 
cBuck‘s
);

754  
pos
 < 
cBuck‘s
 )

756 
bm
 = 0;

757  
b™
 = 0; b™ < 8*(
ulÚg
); bit++ )

759 iàĞ!
	`D’£IsEm±y
(
bš
, 
pos
) )

760 
	`SET_BITMAP
(&
bm
, 
b™
);

761 iàĞ++
pos
 =ğ
cBuck‘s
 )

764 
	`WRITE_UL
(
å
, 
bm
);

766 
	}
}

768 
ulÚg
 
	$D’£R—d
(
FILE
 *
å
, 
D’£Bš
 **
pbš
)

770 
ulÚg
 
pos
 = 0, 
b™
, 
bm
, 
cBuck‘s
;

772 
	`READ_UL
(
å
, 
cBuck‘s
);

773 
cBuck‘s
 = 
	`D’£AÎoÿ‹
(
pbš
, cBuckets);

774  
pos
 < 
cBuck‘s
 )

776 
	`READ_UL
(
å
, 
bm
);

777  
b™
 = 0; b™ < 8*(
ulÚg
); bit++ )

779 iàĞ
	`TEST_BITMAP
(&
bm
, 
b™
) )

780 
	`DENSE_SET_OCCUPIED
((*
pbš
)->
rgBuck‘s
, 
pos
);

782 
	`DENSE_SET_EMPTY
((*
pbš
)->
rgBuck‘s
, 
pos
);

783 iàĞ++
pos
 =ğ
cBuck‘s
 )

787  
cBuck‘s
;

788 
	}
}

790 
ulÚg
 
	$D’£MemÜy
(
ulÚg
 
cBuck‘s
, ulÚg 
cOccup›d
)

792  
cBuck‘s
 * (
D’£Buck‘
);

793 
	}
}

834 #ià
LOG_WORD_SIZE
 == 5

836 
	#mix
(
a
,
b
,
c
) \

838 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>13); \

839 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<8); \

840 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>13); \

841 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>12); \

842 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<16); \

843 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>5); \

844 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>3); \

845 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<10); \

846 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>15); \

847 }

	)

848 #ifdeà
WORD_HASH


849 
	#WORD_AT
(
±r
èĞ*(
ulÚg
 *)ÕŒè)

	)

851 
	#WORD_AT
(
±r
èĞÕŒ)[0] + ((
ulÚg
)(ptr)[1]<<8) + \

852 ((
ulÚg
)(
±r
)[2]<<16è+ ((ulÚg)ÕŒ)[3]<<24è)

	)

855 #–ià
LOG_WORD_SIZE
 == 6

857 
	#mix
(
a
,
b
,
c
) \

859 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>43); \

860 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<9); \

861 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>8); \

862 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>38); \

863 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<23); \

864 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>5); \

865 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>35); \

866 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<49); \

867 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>11); \

868 
a
 -ğ
b
;‡ -ğ
c
;‡ ^= (c>>12); \

869 
b
 -ğ
c
; b -ğ
a
; b ^= (a<<18); \

870 
c
 -ğ
a
; c -ğ
b
; c ^= (b>>22); \

871 }

	)

872 #ifdeà
WORD_HASH


873 
	#WORD_AT
(
±r
èĞ*(
ulÚg
 *)ÕŒè)

	)

875 
	#WORD_AT
(
±r
èĞÕŒ)[0] + ((
ulÚg
)(ptr)[1]<<8) + \

876 ((
ulÚg
)(
±r
)[2]<<16) + ((ulong)(ptr)[3]<<24) + \

877 ((
ulÚg
)(
±r
)[4]<<32) + ((ulong)(ptr)[5]<<40) + \

878 ((
ulÚg
)(
±r
)[6]<<48è+ ((ulÚg)ÕŒ)[7]<<56è)

	)

882 #”rÜ 
This
 
hash
 
funùiÚ
 
ÿn
 
Úly
 hash 32 
Ü
 64 
b™
 
wÜds
. 
SÜry
.

885 
ulÚg
 
	$Hash
(
HashTabË
 *
ht
, *
key
, 
ulÚg
 
cBuck‘s
)

887 
ulÚg
 
buck‘
;

888 
ulÚg
 
a
, 
b
, 
c
, 
cchKey
, 
cchKeyOrig
;

889 
keyL’
 = 0;

890 
cchKeyOrig
 = 
ht
->
cchKey
 =ğ
NULL_TERMINATED
 ? 
	`¡¾’
(
key
) : ht->cchKey;

891 
a
 = 
b
 = 
c
 = 0x9e3779b9;

893  
cchKey
 = 
cchKeyOrig
; cchKey >ğ3 * (
ulÚg
);

894 
cchKey
 -ğ3 * (
ulÚg
), 
key
 += 3 * (ulong) )

896 
a
 +ğ
	`WORD_AT
(
key
);

897 
b
 +ğ
	`WORD_AT
(
key
 + (
ulÚg
));

898 
c
 +ğ
	`WORD_AT
(
key
 + (
ulÚg
)*2);

899 
	`mix
(
a
,
b
,
c
);

902 
c
 +ğ
cchKeyOrig
;

903  
cchKey
 ) {

904 #ià
LOG_WORD_SIZE
 == 5

905 11: 
c
 +ğ(
ulÚg
)
key
[10]<<24;

906 10: 
c
 +ğ(
ulÚg
)
key
[9]<<16;

907 9 : 
c
 +ğ(
ulÚg
)
key
[8]<<8;

909 8 : 
b
 +ğ
	`WORD_AT
(
key
+4); 
a
+= WORD_AT(key); ;

910 7 : 
b
 +ğ(
ulÚg
)
key
[6]<<16;

911 6 : 
b
 +ğ(
ulÚg
)
key
[5]<<8;

912 5 : 
b
 +ğ
key
[4];

913 4 : 
a
 +ğ
	`WORD_AT
(
key
); ;

914 3 : 
a
 +ğ(
ulÚg
)
key
[2]<<16;

915 2 : 
a
 +ğ(
ulÚg
)
key
[1]<<8;

916 1 : 
a
 +ğ
key
[0];

918 #–ià
LOG_WORD_SIZE
 == 6

919 23: 
c
 +ğ(
ulÚg
)
key
[22]<<56;

920 22: 
c
 +ğ(
ulÚg
)
key
[21]<<48;

921 21: 
c
 +ğ(
ulÚg
)
key
[20]<<40;

922 20: 
c
 +ğ(
ulÚg
)
key
[19]<<32;

923 19: 
c
 +ğ(
ulÚg
)
key
[18]<<24;

924 18: 
c
 +ğ(
ulÚg
)
key
[17]<<16;

925 17: 
c
 +ğ(
ulÚg
)
key
[16]<<8;

927 16: 
b
 +ğ
	`WORD_AT
(
key
+8); 
a
+= WORD_AT(key); ;

928 15: 
b
 +ğ(
ulÚg
)
key
[14]<<48;

929 14: 
b
 +ğ(
ulÚg
)
key
[13]<<40;

930 13: 
b
 +ğ(
ulÚg
)
key
[12]<<32;

931 12: 
b
 +ğ(
ulÚg
)
key
[11]<<24;

932 11: 
b
 +ğ(
ulÚg
)
key
[10]<<16;

933 10: 
b
 +ğ(
ulÚg
)
key
[ 9]<<8;

934 9: 
b
 +ğ(
ulÚg
)
key
[ 8];

935 8: 
a
 +ğ
	`WORD_AT
(
key
); ;

936 7: 
a
 +ğ(
ulÚg
)
key
[ 6]<<48;

937 6: 
a
 +ğ(
ulÚg
)
key
[ 5]<<40;

938 5: 
a
 +ğ(
ulÚg
)
key
[ 4]<<32;

939 4: 
a
 +ğ(
ulÚg
)
key
[ 3]<<24;

940 3: 
a
 +ğ(
ulÚg
)
key
[ 2]<<16;

941 2: 
a
 +ğ(
ulÚg
)
key
[ 1]<<8;

942 1: 
a
 +ğ(
ulÚg
)
key
[ 0];

946 
	`mix
(
a
,
b
,
c
);

947 
buck‘
 = 
c
 & (
cBuck‘s
-1);

948  
buck‘
;

949 
	}
}

961 
HTI‹m
 *
	$Rehash
(
HashTabË
 *
ht
, 
ulÚg
 
cNewBuck‘s
, 
HTI‹m
 *
bckW©ch
)

963 
TabË
 *
bËNew
;

964 
ulÚg
 
iBuck‘Fœ¡
;

965 
HTI‹m
 *
bck
, *
bckNew
 = 
NULL
;

966 
ulÚg
 
off£t
;

967 
fOv”wr™e
 = 0;

969 
	`as£¹
Ğ
ht
->
bË
 );

970 
cNewBuck‘s
 = 
	`TabË
(
AÎoÿ‹
)(&
bËNew
, cNewBuckets);

975  
bck
 = 
	`HashFœ¡Buck‘
(
ht
); ; bck = 
	`HashNextBuck‘
(ht) )

977 iàĞ
bck
 =ğ
NULL
 )

979 
bck
 = 
bckW©ch
;

980 iàĞ
bck
 =ğ
NULL
 )

983 iàĞ
bck
 =ğ
bckW©ch
 )

986 
off£t
 = 0;

987  
iBuck‘Fœ¡
 = 
	`Hash
(
ht
, 
	`KEY_PTR
(ht, 
bck
->
key
), 
cNewBuck‘s
);

988 !
	`TabË
(
IsEm±y
)(
bËNew
, 
iBuck‘Fœ¡
);

989 
iBuck‘Fœ¡
 = (iBuck‘Fœ¡ + 
	`JUMP
(
	`KEY_PTR
(
ht
,
bck
->
key
), 
off£t
))

990 & (
cNewBuck‘s
-1) )

992 
bckNew
 = 
	`TabË
(
In£¹
)(
bËNew
, 
bck
, 
iBuck‘Fœ¡
, &
fOv”wr™e
);

993 iàĞ
bck
 =ğ
bckW©ch
 )

996 
	`TabË
(
F»e
)(
ht
->
bË
, ht->
cBuck‘s
);

997 
ht
->
bË
 = 
bËNew
;

998 
ht
->
cBuck‘s
 = 
cNewBuck‘s
;

999 
ht
->
cD–‘edI‹ms
 = 0;

1000  
bckNew
;

1001 
	}
}

1012 
HTI‹m
 *
	$Fšd
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg *
piEm±y
)

1014 
ulÚg
 
iBuck‘Fœ¡
;

1015 
HTI‹m
 *
™em
;

1016 
ulÚg
 
off£t
 = 0;

1017 
fFoundEm±y
 = 0;

1019 
ht
->
posLa¡Fšd
 = 
NULL
;

1020 iàĞ
ht
->
bË
 =ğ
NULL
 )

1021  
NULL
;

1023 
iBuck‘Fœ¡
 = 
	`Hash
(
ht
, 
	`KEY_PTR
(ht, 
key
), ht->
cBuck‘s
);

1026 
™em
 = 
	`TabË
(
Fšd
)(
ht
->
bË
, 
iBuck‘Fœ¡
);

1027 iàĞ
™em
 =ğ
NULL
 )

1029 iàĞ
piEm±y
 && !
fFoundEm±y
 ) *piEm±y = 
iBuck‘Fœ¡
;

1030  
NULL
;

1034 iàĞ
	`IS_BCK_DELETED
(
™em
) )

1036 iàĞ
piEm±y
 && !
fFoundEm±y
 )

1038 *
piEm±y
 = 
iBuck‘Fœ¡
;

1039 
fFoundEm±y
 = 1;

1042 iàĞ!
	`KEY_CMP
(
ht
, 
key
, 
™em
->key) )

1044 
ht
->
posLa¡Fšd
 = 
™em
;

1045  
™em
;

1048 
iBuck‘Fœ¡
 = ((iBuck‘Fœ¡ + 
	`JUMP
(
	`KEY_PTR
(
ht
, 
key
), 
off£t
))

1049 & (
ht
->
cBuck‘s
-1));

1051 
	}
}

1064 
ulÚg
 
	$NextPow2
(
ulÚg
 
x
)

1066 iàĞ((
x
 << 1) >> 1) != x )

1067 
x
 >>= 1;

1068  (
x
 & (x-1)) != 0 )

1069 
x
 &= (x-1);

1070  
x
 << 1;

1071 
	}
}

1073 
HTI‹m
 *
	$In£¹
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg 
d©a
, 
fOv”wr™e
)

1075 
HTI‹m
 *
™em
, 
bckIn£¹
;

1076 
ulÚg
 
iEm±y
;

1078 iàĞ
ht
->
bË
 =ğ
NULL
 )

1079  
NULL
;

1080 
™em
 = 
	`Fšd
(
ht
, 
key
, &
iEm±y
);

1081 
ht
->
posLa¡Fšd
 = 
NULL
;

1082 iàĞ
™em
 )

1084 iàĞ
fOv”wr™e
 )

1085 
™em
->
d©a
 = data;

1086  
™em
;

1089 
	`COPY_KEY
(
ht
, 
bckIn£¹
.
key
, key);

1090 
bckIn£¹
.
d©a
 = data;

1091 
™em
 = 
	`TabË
(
In£¹
)(
ht
->
bË
, &
bckIn£¹
, 
iEm±y
, &
fOv”wr™e
);

1092 iàĞ
fOv”wr™e
 )

1093 
ht
->
cD–‘edI‹ms
--;

1094 
ht
->
cI‹ms
++;

1095 iàĞ
ht
->
cD–GßlSize
 > 0 )

1096 
ht
->
cD–GßlSize
--;

1097 iàĞ
ht
->
cI‹ms
 + ht->
cD–‘edI‹ms
 >ğht->
cBuck‘s
 * 
OCCUPANCY_PCT


1098 || 
ht
->
cD–GßlSize
 < 0 )

1099 
™em
 = 
	`Rehash
(
ht
,

1100 
	`NextPow2
((
ulÚg
)(((
ht
->
cD–GßlSize
 > 0 ?

1101 
ht
->
cD–GßlSize
 : 0)

1102 + 
ht
->
cI‹ms
è/ 
OCCUPANCY_PCT
)),

1103 
™em
);

1104  
™em
;

1105 
	}
}

1118 
	$D–‘e
(
HashTabË
 *
ht
, 
ulÚg
 
key
, 
fShršk
, 
fLa¡FšdS‘
)

1120 iàĞ!
fLa¡FšdS‘
 && !
	`Fšd
(
ht
, 
key
, 
NULL
) )

1122 
	`SET_BCK_DELETED
(
ht
, ht->
posLa¡Fšd
);

1123 
ht
->
cI‹ms
--;

1124 
ht
->
cD–‘edI‹ms
++;

1125 iàĞ
ht
->
cD–GßlSize
 < 0 )

1126 
ht
->
cD–GßlSize
++;

1128 iàĞ
fShršk
 && 
ht
->
cI‹ms
 < ht->
cBuck‘s
 * 
OCCUPANCY_PCT
*0.4

1129 && 
ht
->
cD–GßlSize
 >= 0

1130 && (
ht
->
cBuck‘s
 >> 1è>ğ
MIN_HASH_SIZE
 )

1131 
	`Rehash
(
ht
,

1132 
	`NextPow2
((
ulÚg
)((
ht
->
cI‹ms
+ht->
cD–GßlSize
)/
OCCUPANCY_PCT
)),

1133 
NULL
);

1134 
ht
->
posLa¡Fšd
 = 
NULL
;

1136 
	}
}

1160 
HashTabË
 *
	$AÎoÿ‹HashTabË
(
cchKey
, 
fSaveKeys
)

1162 
HashTabË
 *
ht
;

1164 
ht
 = (
HashTabË
 *è
	`zm®loc
((*ht));

1165 
ht
->
cBuck‘s
 = 
	`TabË
(
AÎoÿ‹
)(&ht->
bË
, 
MIN_HASH_SIZE
);

1166 
ht
->
cchKey
 = cchKey <ğ0 ? 
NULL_TERMINATED
 : cchKey;

1167 
ht
->
cI‹ms
 = 0;

1168 
ht
->
cD–‘edI‹ms
 = 0;

1169 
ht
->
fSaveKeys
 = fSaveKeys;

1170 
ht
->
cD–GßlSize
 = 0;

1171 
ht
->
™”
 = 
	`zm®loc
Ğ(
TabËI‹¿tÜ
) );

1173 
ht
->
åD©a
 = 
NULL
;

1174 
ht
->
bckD©a
.
d©a
 = (
ulÚg
è
NULL
;

1175 
	`HTS‘upKeyTrunc
();

1176  
ht
;

1177 
	}
}

1179 
	$CË¬HashTabË
(
HashTabË
 *
ht
)

1181 
HTI‹m
 *
bck
;

1183 iàĞ
	`STORES_PTR
(
ht
è&& ht->
fSaveKeys
 )

1184  
bck
 = 
	`HashFœ¡Buck‘
(
ht
); bck; bck = 
	`HashNextBuck‘
(ht) )

1186 
	`FREE_KEY
(
ht
, 
bck
->
key
);

1187 iàĞ
ht
->
fSaveKeys
 == 2 )

1190 
	`TabË
(
F»e
)(
ht
->
bË
, ht->
cBuck‘s
);

1191 
ht
->
cBuck‘s
 = 
	`TabË
(
AÎoÿ‹
)(&ht->
bË
, 
MIN_HASH_SIZE
);

1193 
ht
->
cI‹ms
 = 0;

1194 
ht
->
cD–‘edI‹ms
 = 0;

1195 
ht
->
cD–GßlSize
 = 0;

1196 
ht
->
posLa¡Fšd
 = 
NULL
;

1197 
ht
->
åD©a
 = 
NULL
;

1198 iàĞ
ht
->
bckD©a
.
d©a
 ) 
	`ä“
( (*)(ht)->bckData.data);

1199 
ht
->
bckD©a
.
d©a
 = (
ulÚg
è
NULL
;

1200 
	}
}

1202 
	$F»eHashTabË
(
HashTabË
 *
ht
)

1204 
	`CË¬HashTabË
(
ht
);

1205 iàĞ
ht
->
™”
 ) 
	`HTä“
(ht->™”, (
TabËI‹¿tÜ
));

1206 iàĞ
ht
->
bË
 ) 
	`TabË
(
F»e
)(ht->bË, ht->
cBuck‘s
);

1207 
	`ä“
(
ht
);

1208 
	}
}

1222 
HTI‹m
 *
	$HashFšd
(
HashTabË
 *
ht
, 
ulÚg
 
key
)

1224 
	`LOAD_AND_RETURN
(
ht
, 
	`Fšd
(ht, 
	`KEY_TRUNC
(ht, 
key
), 
NULL
));

1225 
	}
}

1227 
HTI‹m
 *
	$HashFšdLa¡
(
HashTabË
 *
ht
)

1229 
	`LOAD_AND_RETURN
(
ht
, ht->
posLa¡Fšd
);

1230 
	}
}

1244 
HTI‹m
 *
	$HashFšdOrIn£¹
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg 
d©aIn£¹
)

1247  
	`In£¹
(
ht
, 
	`KEY_TRUNC
(ht, 
key
), 
d©aIn£¹
, 0);

1248 
	}
}

1250 
HTI‹m
 *
	$HashFšdOrIn£¹I‹m
(
HashTabË
 *
ht
, 
HTI‹m
 *
pI‹m
)

1252  
	`HashFšdOrIn£¹
(
ht
, 
pI‹m
->
key
,…I‹m->
d©a
);

1253 
	}
}

1255 
HTI‹m
 *
	$HashIn£¹
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg 
d©a
)

1257  
	`In£¹
(
ht
, 
	`KEY_TRUNC
(ht, 
key
), 
d©a
, 
SAMEKEY_OVERWRITE
);

1258 
	}
}

1260 
HTI‹m
 *
	$HashIn£¹I‹m
(
HashTabË
 *
ht
, 
HTI‹m
 *
pI‹m
)

1262  
	`HashIn£¹
(
ht
, 
pI‹m
->
key
,…I‹m->
d©a
);

1263 
	}
}

1265 
	$HashD–‘e
(
HashTabË
 *
ht
, 
ulÚg
 
key
)

1267  
	`D–‘e
(
ht
, 
	`KEY_TRUNC
(ht, 
key
), !
FAST_DELETE
, 0);

1268 
	}
}

1270 
	$HashD–‘eLa¡
(
HashTabË
 *
ht
)

1272 iàĞ!
ht
->
posLa¡Fšd
 )

1274  
	`D–‘e
(
ht
, 0, !
FAST_DELETE
, 1);

1275 
	}
}

1286 
HTI‹m
 *
	$HashFœ¡Buck‘
(
HashTabË
 *
ht
)

1288 
HTI‹m
 *
»tv®
;

1290  
»tv®
 = 
	`TabË
(
Fœ¡Buck‘
)(
ht
->
™”
, ht->
bË
, ht->
cBuck‘s
);

1291 
»tv®
;„‘v® = 
	`TabË
(
NextBuck‘
)(
ht
->
™”
) )

1292 iàĞ!
	`IS_BCK_DELETED
(
»tv®
) )

1293 
	`LOAD_AND_RETURN
(
ht
, 
»tv®
);

1294  
NULL
;

1295 
	}
}

1297 
HTI‹m
 *
	$HashNextBuck‘
(
HashTabË
 *
ht
)

1299 
HTI‹m
 *
»tv®
;

1301  (
»tv®
=
	`TabË
(
NextBuck‘
)(
ht
->
™”
)) )

1302 iàĞ!
	`IS_BCK_DELETED
(
»tv®
) )

1303 
	`LOAD_AND_RETURN
(
ht
, 
»tv®
);

1304  
NULL
;

1305 
	}
}

1316 
	$HashS‘D–GßlSize
(
HashTabË
 *
ht
, 
d–
)

1318 
ht
->
cD–GßlSize
 = 
d–
;

1319 #ià
FAST_DELETE
 =ğ1 || 
defšed
 
INSERT_ONLY


1320 iàĞ
ht
->
cD–GßlSize
 < 0 )

1321 
ht
->
cD–GßlSize
 = 0;

1323  
ht
->
cD–GßlSize
;

1324 
	}
}

1352 
HashSave
(
FILE
 *
å
, 
HashTabË
 *
ht
, (*
d©aWr™e
)(FILE *, *))

1354 
cchD©a
, 
posS¹
;

1355 
HTI‹m
 *
bck
;

1374 
	`årštf
(
å
, "%s", 
MAGIC_KEY
);

1375 
	`WRITE_UL
(
å
, 
ht
->
cchKey
);

1376 
	`WRITE_UL
(
å
, 
ht
->
cI‹ms
);

1377 
	`WRITE_UL
(
å
, 
ht
->
cD–‘edI‹ms
);

1378 
	`TabË
(
Wr™e
)(
å
, 
ht
->
bË
, ht->
cBuck‘s
);

1380 
	`WRITE_UL
(
å
, 0);

1381 
posS¹
 = 
	`á–l
(
å
);

1382  
bck
 = 
	`HashFœ¡Buck‘
(
ht
); bck; bck = 
	`HashNextBuck‘
(ht) )

1383 
	`fwr™e
(
	`KEY_PTR
(
ht
, 
bck
->
key
), 1,

1384 (
ht
->
cchKey
 =ğ
NULL_TERMINATED
 ?

1385 
	`¡¾’
(
	`KEY_PTR
(
ht
, 
bck
->
key
))+1 : ht->
cchKey
), 
å
);

1386 
cchD©a
 = 
	`á–l
(
å
è- 
posS¹
;

1387 
	`f£ek
(
å
, 
posS¹
 - (), 
SEEK_SET
);

1388 
	`WRITE_UL
(
å
, 
cchD©a
);

1389 
	`f£ek
(
å
, 0, 
SEEK_END
);

1392  
bck
 = 
	`TabË
(
Fœ¡Buck‘
)(
ht
->
™”
, ht->
bË
, ht->
cBuck‘s
);

1393 
bck
; bck = 
	`TabË
(
NextBuck‘
)(
ht
->
™”
) )

1394 iàĞ
d©aWr™e
 =ğ
NULL
 || 
	`IS_BCK_DELETED
(
bck
) )

1395 
	`WRITE_UL
(
å
, 
bck
->
d©a
);

1398 
	`WRITE_UL
(
å
, (*
d©aWr™e
)(
NULL
, (*)
bck
->
d©a
));

1399 (*
d©aWr™e
)(
å
, (*)
bck
->
d©a
);

1401 
	}
}

1403 
HashTabË
 *
HashDoLßd
(
FILE
 *
å
, * (*
d©aR—d
)(FILE *, ),

1404 
HashTabË
 *
ht
)

1406 
ulÚg
 
	gcchKey
;

1407 
	gszMagicKey
[4], *
	grgchKeys
;

1408 
HTI‹m
 *
	gbck
;

1410 
ä—d
(
szMagicKey
, 1, 4, 
å
);

1411 iàĞ
¡ºcmp
(
szMagicKey
, 
MAGIC_KEY
, 4) )

1413 
årštf
(
¡d”r
, "ERROR:‚ot‡ hashable (magic key is %4.4s,‚ot %s)\n",

1414 
szMagicKey
, 
MAGIC_KEY
);

1415 
ex™
(3);

1417 
TabË
(
F»e
)(
	ght
->
	gbË
, ht->
	gcBuck‘s
);

1419 
READ_UL
(
å
, 
ht
->
cchKey
);

1420 
READ_UL
(
å
, 
ht
->
cI‹ms
);

1421 
READ_UL
(
å
, 
ht
->
cD–‘edI‹ms
);

1422 
	ght
->
	gcBuck‘s
 = 
TabË
(
R—d
)(
å
, &ht->
	gbË
);

1424 
READ_UL
(
å
, 
cchKey
);

1425 
	grgchKeys
 = (*è
zm®loc
Ğ
cchKey
 );

1426 
ä—d
(
rgchKeys
, 1, 
cchKey
, 
å
);

1428  
	gbck
 = 
TabË
(
Fœ¡Buck‘
)(
ht
->
™”
, 
	ght
->
	gbË
, ht->
	gcBuck‘s
);

1429 
	gbck
; bck = 
TabË
(
NextBuck‘
)(
ht
->
™”
) )

1431 
READ_UL
(
å
, 
bck
->
d©a
);

1432 iàĞ
IS_BCK_DELETED
(
bck
) )

1434 iàĞ
	gd©aR—d
 !ğ
NULL
 )

1435 iàĞ!
ht
->
åD©a
 )

1436 
bck
->
d©a
 = (
ulÚg
)
d©aR—d
(
å
, bck->data);

1439 
f£ek
(
å
, 
bck
->
d©a
, 
SEEK_CUR
);

1440 
	gbck
->
	gd©a
 = 
á–l
(
å
è- 
bck
->
d©a
 - ();

1443 iàĞ
	ght
->
	gcchKey
 =ğ
NULL_TERMINATED
 )

1445 
bck
->
key
 = (
ulÚg
è
rgchKeys
;

1446 
	grgchKeys
 = 
¡rchr
(
rgchKeys
, '\0') + 1;

1450 iàĞ
STORES_PTR
(
ht
) )

1451 
	gbck
->
	gkey
 = (
ulÚg
è
rgchKeys
;

1453 
memıy
(&
bck
->
key
, 
rgchKeys
, 
ht
->
cchKey
);

1454 
	grgchKeys
 +ğ
ht
->
cchKey
;

1457 iàĞ!
STORES_PTR
(
ht
) )

1458 
HTä“
(
rgchKeys
 - 
cchKey
, cchKey);

1459  
	ght
;

1462 
HashTabË
 *
HashLßd
(
FILE
 *
å
, * (*
d©aR—d
)(FILE *, ))

1464 
HashTabË
 *
	ght
;

1465 
	ght
 = 
AÎoÿ‹HashTabË
(0, 2);

1466  
HashDoLßd
(
å
, 
d©aR—d
, 
ht
);

1469 
HashTabË
 *
HashLßdKeys
(
FILE
 *
å
, * (*
d©aR—d
)(FILE *, ))

1471 
HashTabË
 *
	ght
;

1473 iàĞ
	gd©aR—d
 =ğ
NULL
 )

1474  
HashLßd
(
å
, 
NULL
);

1475 
	ght
 = 
AÎoÿ‹HashTabË
(0, 2);

1476 
	ght
->
	gåD©a
 = 
å
;

1477 
	ght
->
	gd©aR—d
 = 
d©aR—d
;

1478  
HashDoLßd
(
å
, 
d©aR—d
, 
ht
);

1492 
ulÚg
 
	$PrštHashTabË
(
HashTabË
 *
ht
, 
time
, 
iFÜm
)

1494 
ulÚg
 
cbD©a
 = 0, 
cbBš
 = 0, 
cI‹ms
 = 0, 
cOccup›d
 = 0;

1495 
HTI‹m
 *
™em
;

1497 
	`´štf
("HASH TABLE.\n");

1498 iàĞ
time
 > -1.0 )

1500 
	`´štf
("----------\n");

1501 
	`´štf
("Time: %27.2f\n", 
time
);

1504  
™em
 = 
	`TabË
(
Fœ¡Buck‘
)(
ht
->
™”
, ht->
bË
, ht->
cBuck‘s
);

1505 
™em
; i‹m = 
	`TabË
(
NextBuck‘
)(
ht
->
™”
) )

1507 
cOccup›d
++;

1508 iàĞ
	`IS_BCK_DELETED
(
™em
) )

1510 
cI‹ms
++;

1511 iàĞ
	`STORES_PTR
(
ht
) )

1512 
cbD©a
 +ğ
ht
->
cchKey
 =ğ
NULL_TERMINATED
 ?

1513 
	`WORD_ROUND
(
	`¡¾’
((*)
™em
->
key
)+1è: 
ht
->
cchKey
;

1515 
cbBš
 -ğ(
™em
->
key
), 
cbD©a
 += (item->key);

1516 
cbBš
 -ğ(
™em
->
d©a
), 
cbD©a
 += (item->data);

1517 iàĞ
iFÜm
 != 0 )

1519 iàĞ
iFÜm
 =ğ2 && 
ht
->
cchKey
 =ğ
NULL_TERMINATED
 )

1520 
	`´štf
("%s/%lu\n", (*)
™em
->
key
, i‹m->
d©a
);

1521 iàĞ
iFÜm
 =ğ2 && 
	`STORES_PTR
(
ht
) )

1522 
	`´štf
("%.*s/%lu\n",

1523 ()
ht
->
cchKey
, (*)
™em
->
key
, i‹m->
d©a
);

1525 
	`´štf
("%lu/%lu\n", 
™em
->
key
, i‹m->
d©a
);

1528 
	`as£¹
Ğ
cI‹ms
 =ğ
ht
->cItems );

1529 
cbBš
 = 
	`TabË
(
MemÜy
)(
ht
->
cBuck‘s
, 
cOccup›d
);

1531 
	`´štf
("----------\n");

1532 
	`´štf
("%lu buckets (%lu bytes). %luƒmpty. %lu hold deleted items.\n"

1535 
ht
->
cBuck‘s
, 
cbBš
, ht->cBuck‘ - 
cOccup›d
, cOccup›d - ht->
cI‹ms
,

1536 
ht
->
cI‹ms
, 
cbD©a
,

1537 
cbD©a
 + 
cbBš
, cbBin, cbBin*100.0/(cbBin+cbData));

1539  
cbD©a
 + 
cbBš
;

1540 
	}
}

1542 
	$Te¡In£¹
() {

1543 
HashTabË
* 
ht
;

1544 
HTI‹m
* 
bck
;

1546 
ht
 = 
	`AÎoÿ‹HashTabË
(1, 0);

1547 
	`´štf
("\nPršˆthkey 1 %lu\n",
	`PTR_KEY
(
ht
,"January"));

1548 
bck
 = 
	`HashIn£¹
(
ht
, 
	`PTR_KEY
(ht, "January"), 31);

1549 
	`´štf
("\nPršˆthkey 2 %lu\n",
	`PTR_KEY
(
ht
,"January"));

1550 
	`´štf
("\nBck key: %lu\n",
bck
->
key
);

1551 
bck
 = 
	`HashIn£¹
(
ht
, 
	`PTR_KEY
(ht, "February"), 28);

1552 
bck
 = 
	`HashIn£¹
(
ht
, 
	`PTR_KEY
(ht, "March"), 31);

1553 
bck
 = 
	`HashIn£¹
(
ht
, 
	`PTR_KEY
(ht, "March"), 32);

1555 
bck
 = 
	`HashFšd
(
ht
, 
	`PTR_KEY
(ht, "February"));

1556 
	`as£¹
(
bck
);

1557 
	`as£¹
(
bck
->
d©a
 == 28);

1558 *
key
 = "January";

1559 
ulÚg
 
key1
 = 
	`PTR_KEY
(
ht
,"January");

1560 
	`´štf
("\nkey : %lu‡nd key1: %lu \n",
key
,
key1
);

1561 if(
	`HashD–‘e
(
ht
, 
	`PTR_KEY
(ht,"January")) == 1)

1562 
	`´štf
("Deletion was successful\n");

1564 
	`´štf
("\nDeletion‚ot successful\n");

1565 
	`PrštHashTabË
(
ht
,1,1);

1566 
	`F»eHashTabË
(
ht
);

1567 
	}
}

1569 
	$Te¡FšdOrIn£¹
() {

1570 
HashTabË
* 
ht
;

1571 
i
;

1572 
™”©iÚs
 = 1000000;

1573 
¿nge
 = 30;

1575 
ht
 = 
	`AÎoÿ‹HashTabË
(4, 0);

1578 
i
 = 0; i < 
™”©iÚs
; ++i) {

1579 
key
 = 
	`¿nd
(è% 
¿nge
;

1580 
HTI‹m
* 
bck
 = 
	`HashFšdOrIn£¹
(
ht
, 
key
, 0);

1581 
bck
->
d©a
++;

1584 
i
 = 0; i < 
¿nge
; ++i) {

1585 
HTI‹m
* 
bck
 = 
	`HashFšd
(
ht
, 
i
);

1586 ià(
bck
) {

1587 
	`´štf
("%3d: %d\n", 
bck
->
key
, bck->
d©a
);

1589 
	`´štf
("%3d: 0\n", 
i
);

1593 
	`F»eHashTabË
(
ht
);

1594 
	}
}

1596 
	$maš
(
¬gc
, ** 
¬gv
) {

1597 
	`Te¡In£¹
();

1598 
	`Te¡FšdOrIn£¹
();

1600 
	}
}

	@libchash.h

119 
	~<sys/ty³s.h
>

120 
	#ulÚg
 

	)

122 
	#MAGIC_KEY
 "CHsh"

	)

124 #iâdeà
LOG_WORD_SIZE


125 #ià
defšed
 (
__LP64__
è|| defšed (
_LP64
)

126 
	#LOG_WORD_SIZE
 6

	)

128 
	#LOG_WORD_SIZE
 5

	)

134 #iâdeà
LOG_BM_WORDS


135 
	#LOG_BM_WORDS
 0

	)

139 #iâdeà
JUMP


140 
	#JUMP
(
key
, 
off£t
èĞ++(off£tèè

	)

142 #iâdeà
TabË


143 
	#TabË
(
x
è
D’£
##x

145 #iâdeà
FAST_DELETE


	)

146 
	#FAST_DELETE
 0

	)

148 #iâdeà
SAMEKEY_OVERWRITE


149 
	#SAMEKEY_OVERWRITE
 1

	)

151 #iâdeà
OCCUPANCY_PCT


152 
	#OCCUPANCY_PCT
 0.5

	)

154 #iâdeà
MIN_HASH_SIZE


155 
	#MIN_HASH_SIZE
 512

	)

161 #iâdeà
INSERT_ONLY


162 
	#DELETED
 -2UL

	)

163 
	#IS_BCK_DELETED
(
bck
èĞ(bckè&& (bck)->
d©a
 =ğ
DELETED
 )

	)

164 
	#SET_BCK_DELETED
(
ht
, 
bck
èdØ{ (bck)->
d©a
 = 
DELETED
; \

165 
	`FREE_KEY
(
ht
, (
bck
)->
key
); }  0 )

	)

167 
	#IS_BCK_DELETED
(
bck
è0

	)

168 
	#SET_BCK_DELETED
(
ht
, 
bck
) \

169 dØ{ 
	`årštf
(
¡d”r
, "Deletion‚ot supported for insert-only hashtable\n");\

170 
	`ex™
(2); }  0 )

	)

175 
	#EMPTY
 -3UL

	)

180 
ulÚg
 
	md©a
;

181 
ulÚg
 
	mkey
;

182 } 
	tHTI‹m
;

184 
TabË
(
Bš
);

185 
TabË
(
I‹¿tÜ
);

186 
	$TabË
(
	tBš
è
	tTabË
;

187 
	$TabË
(
	tI‹¿tÜ
è
	tTabËI‹¿tÜ
;

190 
	sHashTabË
 {

191 
ulÚg
 
cchKey
;

192 
ulÚg
 
cI‹ms
;

193 
ulÚg
 
cD–‘edI‹ms
;

194 
ulÚg
 
cBuck‘s
;

195 
TabË
 *
bË
;

196 
fSaveKeys
;

197 
cD–GßlSize
;

198 
HTI‹m
 *
posLa¡Fšd
;

199 
TabËI‹¿tÜ
 *
™”
;

201 
FILE
 *
åD©a
;

202 * (*
d©aR—d
)(
FILE
 *, );

203 
HTI‹m
 
bckD©a
;

204 } 
	tHashTabË
;

215 
	#HashKeySize
(
ht
èĞ((
ulÚg
 *)(ht))[0] )

	)

216 
	#HashSize
(
ht
èĞ((
ulÚg
 *)(ht))[1] )

	)

218 
	#STORES_PTR
(
ht
èĞ
	`HashKeySize
(ht) == 0 || \

219 
	`HashKeySize
(
ht
è> (
ulÚg
è)

	)

220 
	#KEY_PTR
(
ht
, 
key
èĞ
	`STORES_PTR
(htè? (*)(keyè: (*)&(keyè)

	)

221 #ifdeà
DONT_HAVE_TO_WORRY_ABOUT_BUS_ERRORS


222 
	#PTR_KEY
(
ht
, 
±r
èĞ
	`STORES_PTR
(htè? (
ulÚg
)ÕŒè: *(ulÚg *)ÕŒè)

	)

224 
	#PTR_KEY
(
ht
, 
±r
èĞ
	`STORES_PTR
(htè? (
ulÚg
)ÕŒè: 
	`HTcİy
((*íŒ))

	)

229 
	`HTcİy
(*
pul
);

231 
HashTabË
 *
	`AÎoÿ‹HashTabË
(
cchKey
, 
fSaveKeys
);

232 
	`CË¬HashTabË
(
HashTabË
 *
ht
);

233 
	`F»eHashTabË
(
HashTabË
 *
ht
);

235 
HTI‹m
 *
	`HashFšd
(
HashTabË
 *
ht
, 
ulÚg
 
key
);

236 
HTI‹m
 *
	`HashFšdLa¡
(
HashTabË
 *
ht
);

237 
HTI‹m
 *
	`HashFšdOrIn£¹
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg 
d©aIn£¹
);

238 
HTI‹m
 *
	`HashFšdOrIn£¹I‹m
(
HashTabË
 *
ht
, HTI‹m *
pI‹m
);

240 
HTI‹m
 *
	`HashIn£¹
(
HashTabË
 *
ht
, 
ulÚg
 
key
, ulÚg 
d©a
);

241 
HTI‹m
 *
	`HashIn£¹I‹m
(
HashTabË
 *
ht
, HTI‹m *
pI‹m
);

243 
	`HashD–‘e
(
HashTabË
 *
ht
, 
ulÚg
 
key
);

244 
	`HashD–‘eLa¡
(
HashTabË
 *
ht
);

246 
HTI‹m
 *
	`HashFœ¡Buck‘
(
HashTabË
 *
ht
);

247 
HTI‹m
 *
	`HashNextBuck‘
(
HashTabË
 *
ht
);

249 
	`HashS‘D–GßlSize
(
HashTabË
 *
ht
, 
d–
);

251 
	`HashSave
(
FILE
 *
å
, 
HashTabË
 *
ht
, (*
wr™e
)(FILE *, *));

252 
HashTabË
 *
	`HashLßd
(
FILE
 *
å
, * (*
»ad
)(FILE *, ));

253 
HashTabË
 *
	`HashLßdKeys
(
FILE
 *
å
, * (*
»ad
)(FILE *, ));

	@lzf.h

37 #iâdeà
LZF_H


38 
	#LZF_H


	)

49 
	#LZF_VERSION
 0x0105

	)

77 
lzf_com´ess
 (cÚ¡ *cÚ¡ 
š_d©a
, 
š_Ën
,

78 *
out_d©a
, 
out_Ën
);

96 
lzf_decom´ess
 (cÚ¡ *cÚ¡ 
š_d©a
, 
š_Ën
,

97 *
out_d©a
, 
out_Ën
);

	@lzfP.h

37 #iâdeà
LZFP_h


38 
	#LZFP_h


	)

40 
	#STANDALONE
 1

	)

42 #iâdeà
STANDALONE


43 
	~"lzf.h
"

54 #iâdeà
HLOG


55 
	#HLOG
 16

	)

63 #iâdeà
VERY_FAST


64 
	#VERY_FAST
 1

	)

74 #iâdeà
ULTRA_FAST


75 
	#ULTRA_FAST
 0

	)

81 #iâdeà
STRICT_ALIGN


82 
	#STRICT_ALIGN
 !(
	`defšed
(
__i386
è|| defšed (
__amd64
))

	)

90 #iâdeà
INIT_HTAB


91 
	#INIT_HTAB
 0

	)

99 #iâdeà
AVOID_ERRNO


100 
	#AVOID_ERRNO
 0

	)

108 #iâdeà
LZF_STATE_ARG


109 
	#LZF_STATE_ARG
 0

	)

120 #iâdeà
CHECK_INPUT


121 
	#CHECK_INPUT
 1

	)

134 #ifdeà
__ılu¥lus


135 
	~<c¡ršg
>

136 
	~<şim™s
>

137 
usšg
 
Çme¥aû
 
	g¡d
;

139 
	~<¡ršg.h
>

140 
	~<lim™s.h
>

143 #iâdeà
LZF_USE_OFFSETS


144 #ià
defšed
 (
WIN32
)

145 
	#LZF_USE_OFFSETS
 
	`defšed
(
_M_X64
)

	)

147 #ià
__ılu¥lus
 > 199711L

148 
	~<c¡dšt
>

150 
	~<¡dšt.h
>

152 
	#LZF_USE_OFFSETS
 (
UINTPTR_MAX
 > 0xffffffffU)

	)

156 
	tu8
;

158 #ià
LZF_USE_OFFSETS


159 
	#LZF_HSLOT_BIAS
 ((cÚ¡ 
u8
 *)
š_d©a
)

	)

160 
	tLZF_HSLOT
;

162 
	#LZF_HSLOT_BIAS
 0

	)

163 cÚ¡ 
	tu8
 *
	tLZF_HSLOT
;

166 
LZF_HSLOT
 
	tLZF_STATE
[1 << (
HLOG
)];

168 #ià!
STRICT_ALIGN


170 #ià
USHRT_MAX
 == 65535

171 
	tu16
;

172 #–ià
UINT_MAX
 == 65535

173 
	tu16
;

175 #undeà
STRICT_ALIGN


176 
	#STRICT_ALIGN
 1

	)

180 #ià
ULTRA_FAST


181 #undeà
VERY_FAST


	@lzf_c.c

37 
	~"lzfP.h
"

39 
	#HSIZE
 (1 << (
HLOG
))

	)

47 #iâdeà
FRST


48 
	#FRST
(
p
è((Õ[0]è<< 8è|…[1])

	)

49 
	#NEXT
(
v
,
p
è(((vè<< 8è|…[2])

	)

50 #ià
ULTRA_FAST


51 
	#IDX
(
h
è((Ğh >> (3*8 - 
HLOG
)è- h ) & (
HSIZE
 - 1))

	)

52 #–ià
VERY_FAST


53 
	#IDX
(
h
è((Ğh >> (3*8 - 
HLOG
)è- h*5è& (
HSIZE
 - 1))

	)

55 
	#IDX
(
h
è((((h ^ (h << 5)è>> (3*8 - 
HLOG
)è- h*5è& (
HSIZE
 - 1))

	)

69 
	#FRST
(
p
èÕ[0] << 5è^…[1]

	)

70 
	#NEXT
(
v
,
p
è((vè<< 5è^…[2]

	)

71 
	#IDX
(
h
è((hè& (
HSIZE
 - 1))

	)

74 
	#MAX_LIT
 (1 << 5)

	)

75 
	#MAX_OFF
 (1 << 13)

	)

76 
	#MAX_REF
 ((1 << 8è+ (1 << 3))

	)

78 #ià
__GNUC__
 >= 3

79 
	#ex³ù
(
ex´
,
v®ue
è
	`__butš_ex³ù
 (Óx´),(v®ue))

	)

80 
	#šlše
 
šlše


	)

82 
	#ex³ù
(
ex´
,
v®ue
èÓx´)

	)

83 
	#šlše
 

	)

86 
	#ex³ù_çl£
(
ex´
è
	`ex³ù
 (Óx´è!ğ0, 0)

	)

87 
	#ex³ù_Œue
(
ex´
è
	`ex³ù
 (Óx´è!ğ0, 1)

	)

99 
lzf_com´ess
 (cÚ¡ *cÚ¡ 
š_d©a
, 
š_Ën
,

100 *
out_d©a
, 
out_Ën


101 #ià
LZF_STATE_ARG


102 , 
LZF_STATE
 
hb


106 #ià!
LZF_STATE_ARG


107 
LZF_STATE
 
	ghb
;

109 cÚ¡ 
u8
 *
	g
 = (cÚ¡ u8 *)
š_d©a
;

110 
u8
 *
	gİ
 = (u8 *)
out_d©a
;

111 cÚ¡ 
u8
 *
	gš_’d
 = 

 + 
š_Ën
;

112 
u8
 *
	gout_’d
 = 
İ
 + 
out_Ën
;

113 cÚ¡ 
u8
 *
	g»f
;

122 #ià
defšed
 (
WIN32
è&& defšed (
_M_X64
)

123 
_št64
 
	goff
;

125 
	goff
;

127 
	ghv®
;

128 
	gl™
;

130 ià(!
	gš_Ën
 || !
	gout_Ën
)

133 #ià
INIT_HTAB


134 
mem£t
 (
hb
, 0,  (htab));

137 
	gl™
 = 0; 
	gİ
++;

139 
	ghv®
 = 
FRST
 (

);

140 
	g
 < 
	gš_’d
 - 2)

142 
LZF_HSLOT
 *
	gh¦Ù
;

144 
	ghv®
 = 
NEXT
 (
hv®
, 

);

145 
	gh¦Ù
 = 
hb
 + 
IDX
 (
hv®
);

146 
	g»f
 = *
h¦Ù
 + 
LZF_HSLOT_BIAS
; *
	gh¦Ù
 = 

 - LZF_HSLOT_BIAS;

149 #ià
INIT_HTAB


150 && 
	g»f
 < 
	g


152 && (
	goff
 = 

 - 
»f
 - 1è< 
MAX_OFF


153 && 
»f
 > (
u8
 *)
š_d©a


154 && 
»f
[2] =ğ

[2]

155 #ià
STRICT_ALIGN


156 && ((
»f
[1] << 8è|„ef[0]è=ğ((

[1] << 8) | ip[0])

158 && *(
u16
 *)
»f
 =ğ*(u16 *)



163 
Ën
 = 2;

164 
	gmaxËn
 = 
š_’d
 - 

 - 
Ën
;

165 
	gmaxËn
 = 
maxËn
 > 
MAX_REF
 ? MAX_REF : maxlen;

167 ià(
ex³ù_çl£
 (
İ
 + 3 + 1 >ğ
out_’d
))

168 ià(
İ
 - !
l™
 + 3 + 1 >ğ
out_’d
)

171 
	gİ
 [- 
l™
 - 1] =†it - 1;

172 
	gİ
 -ğ!
l™
;

176 ià(
ex³ù_Œue
 (
maxËn
 > 16))

178 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

179 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

180 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

181 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

183 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

184 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

185 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

186 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

188 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

189 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

190 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

191 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

193 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

194 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

195 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

196 
	gËn
++; ià(
	g»f
 [
Ën
] !ğ

 [len]) ;

200 
	gËn
++;

201 
	gËn
 < 
	gmaxËn
 && 
	g»f
[
Ën
] =ğ

[len]);

206 
	gËn
 -= 2;

207 
	g
++;

209 ià(
	gËn
 < 7)

211 *
	gİ
++ = (
off
 >> 8è+ (
Ën
 << 5);

215 *
	gİ
++ = (
off
 >> 8) + ( 7 << 5);

216 *
	gİ
++ = 
Ën
 - 7;

219 *
	gİ
++ = 
off
;

221 
	gl™
 = 0; 
	gİ
++;

223 
	g
 +ğ
Ën
 + 1;

225 ià(
ex³ù_çl£
 (

 >ğ
š_’d
 - 2))

228 #ià
ULTRA_FAST
 || 
VERY_FAST


229 --
	g
;

230 #ià
VERY_FAST
 && !
ULTRA_FAST


231 --
	g
;

233 
	ghv®
 = 
FRST
 (

);

235 
	ghv®
 = 
NEXT
 (
hv®
, 

);

236 
	ghb
[
IDX
 (
hv®
)] = 

 - 
LZF_HSLOT_BIAS
;

237 
	g
++;

239 #ià
VERY_FAST
 && !
ULTRA_FAST


240 
	ghv®
 = 
NEXT
 (
hv®
, 

);

241 
	ghb
[
IDX
 (
hv®
)] = 

 - 
LZF_HSLOT_BIAS
;

242 
	g
++;

245 
	g
 -ğ
Ën
 + 1;

249 
	ghv®
 = 
NEXT
 (
hv®
, 

);

250 
	ghb
[
IDX
 (
hv®
)] = 

 - 
LZF_HSLOT_BIAS
;

251 
	g
++;

253 
	gËn
--);

259 ià(
ex³ù_çl£
 (
İ
 >ğ
out_’d
))

262 
	gl™
++; *
	gİ
++ = *

++;

264 ià(
ex³ù_çl£
 (
l™
 =ğ
MAX_LIT
))

266 
İ
 [- 
l™
 - 1] =†it - 1;

267 
	gl™
 = 0; 
	gİ
++;

272 ià(
	gİ
 + 3 > 
	gout_’d
)

275 
	g
 < 
	gš_’d
)

277 
	gl™
++; *
	gİ
++ = *

++;

279 ià(
ex³ù_çl£
 (
l™
 =ğ
MAX_LIT
))

281 
İ
 [- 
l™
 - 1] =†it - 1;

282 
	gl™
 = 0; 
	gİ
++;

286 
	gİ
 [- 
l™
 - 1] =†it - 1;

287 
	gİ
 -ğ!
l™
;

289  
	gİ
 - (
	gu8
 *)
	gout_d©a
;

	@lzf_d.c

37 
	~"lzfP.h
"

39 #ià
AVOID_ERRNO


40 
	#SET_ERRNO
(
n
)

	)

42 
	~<”ºo.h
>

43 
	#SET_ERRNO
(
n
è
”ºo
 = (n)

	)

46 #ià
USE_REP_MOVSB


47 #ià(
__i386
 || 
__amd64
è&& 
__GNUC__
 >= 3

48 
	#lzf_movsb
(
d¡
, 
¤c
, 
Ën
) \

49 
	`asm
 ("rep movsb" \

50 : "=D" (
d¡
), "=S" (
¤c
), "=c" (
Ën
) \

51 : "0" (
d¡
), "1" (
¤c
), "2" (
Ën
));

	)

56 
	$lzf_decom´ess
 (cÚ¡ *cÚ¡ 
š_d©a
, 
š_Ën
,

57 *
out_d©a
, 
out_Ën
)

59 
u8
 cÚ¡ *

 = (cÚ¡ u8 *)
š_d©a
;

60 
u8
 *
İ
 = (u8 *)
out_d©a
;

61 
u8
 cÚ¡ *cÚ¡ 
š_’d
 = 

 + 
š_Ën
;

62 
u8
 *cÚ¡ 
out_’d
 = 
İ
 + 
out_Ën
;

66 
ù¾
 = *

++;

68 ià(
ù¾
 < (1 << 5))

70 
ù¾
++;

72 ià(
İ
 + 
ù¾
 > 
out_’d
)

74 
	`SET_ERRNO
 (
E2BIG
);

78 #ià
CHECK_INPUT


79 ià(

 + 
ù¾
 > 
š_’d
)

81 
	`SET_ERRNO
 (
EINVAL
);

86 #ifdeà
lzf_movsb


87 
	`lzf_movsb
 (
İ
, 

, 
ù¾
);

89 
ù¾
)

91 32: *
İ
++ = *

++; 31: *op++ = *ip++; 30: *op++ = *ip++; 29: *op++ = *ip++;

92 28: *
İ
++ = *

++; 27: *op++ = *ip++; 26: *op++ = *ip++; 25: *op++ = *ip++;

93 24: *
İ
++ = *

++; 23: *op++ = *ip++; 22: *op++ = *ip++; 21: *op++ = *ip++;

94 20: *
İ
++ = *

++; 19: *op++ = *ip++; 18: *op++ = *ip++; 17: *op++ = *ip++;

95 16: *
İ
++ = *

++; 15: *op++ = *ip++; 14: *op++ = *ip++; 13: *op++ = *ip++;

96 12: *
İ
++ = *

++; 11: *op++ = *ip++; 10: *op++ = *ip++; 9: *op++ = *ip++;

97 8: *
İ
++ = *

++; 7: *op++ = *ip++; 6: *op++ = *ip++; 5: *op++ = *ip++;

98 4: *
İ
++ = *

++; 3: *op++ = *ip++; 2: *op++ = *ip++; 1: *op++ = *ip++;

104 
Ën
 = 
ù¾
 >> 5;

106 
u8
 *
»f
 = 
İ
 - ((
ù¾
 & 0x1f) << 8) - 1;

108 #ià
CHECK_INPUT


109 ià(

 >ğ
š_’d
)

111 
	`SET_ERRNO
 (
EINVAL
);

115 ià(
Ën
 == 7)

117 
Ën
 +ğ*

++;

118 #ià
CHECK_INPUT


119 ià(

 >ğ
š_’d
)

121 
	`SET_ERRNO
 (
EINVAL
);

127 
»f
 -ğ*

++;

129 ià(
İ
 + 
Ën
 + 2 > 
out_’d
)

131 
	`SET_ERRNO
 (
E2BIG
);

135 ià(
»f
 < (
u8
 *)
out_d©a
)

137 
	`SET_ERRNO
 (
EINVAL
);

141 #ifdeà
lzf_movsb


142 
Ën
 += 2;

143 
	`lzf_movsb
 (
İ
, 
»f
, 
Ën
);

145 
Ën
)

148 
Ën
 += 2;

150 ià(
İ
 >ğ
»f
 + 
Ën
)

153 
	`memıy
 (
İ
, 
»f
, 
Ën
);

154 
İ
 +ğ
Ën
;

160 *
İ
++ = *
»f
++;

161 --
Ën
);

166 9: *
İ
++ = *
»f
++;

167 8: *
İ
++ = *
»f
++;

168 7: *
İ
++ = *
»f
++;

169 6: *
İ
++ = *
»f
++;

170 5: *
İ
++ = *
»f
++;

171 4: *
İ
++ = *
»f
++;

172 3: *
İ
++ = *
»f
++;

173 2: *
İ
++ = *
»f
++;

174 1: *
İ
++ = *
»f
++;

175 0: *
İ
++ = *
»f
++;

176 *
İ
++ = *
»f
++;

181 

 < 
š_’d
);

183  
İ
 - (
u8
 *)
out_d©a
;

184 
	}
}

	@memtest.c

29 
	~<¡dšt.h
>

30 
	~<¡dlib.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<as£¹.h
>

34 
	~<lim™s.h
>

35 
	~<”ºo.h
>

36 
	~<‹rmios.h
>

37 
	~<sys/ioùl.h
>

38 #ià
defšed
(
__sun
)

39 
	~<¡rİts.h
>

41 
	~"cÚfig.h
"

43 #ià(
ULONG_MAX
 == 4294967295UL)

44 
	#MEMTEST_32BIT


	)

45 #–ià(
ULONG_MAX
 == 18446744073709551615ULL)

46 
	#MEMTEST_64BIT


	)

51 #ifdeà
MEMTEST_32BIT


52 
	#ULONG_ONEZERO
 0x¯¯¯¯UL

	)

53 
	#ULONG_ZEROONE
 0x55555555UL

	)

55 
	#ULONG_ONEZERO
 0x¯¯¯¯¯¯¯¯UL

	)

56 
	#ULONG_ZEROONE
 0x5555555555555555UL

	)

59 
wšsize
 
	gws
;

60 
size_t
 
	g´og»ss_´š‹d
;

61 
size_t
 
	g´og»ss_fuÎ
;

63 
	$mem‹¡_´og»ss_¡¬t
(*
t™Ë
, 
·ss
) {

64 
j
;

66 
	`´štf
("\x1b[H\x1b[2J");

68 
j
 = 0; j < 
ws
.
ws_cŞ
*(ws.
ws_row
-2); j++è
	`´štf
(".");

69 
	`´štf
("Please keepheest„unning several minutes…er GB of memory.\n");

70 
	`´štf
("Also check http://www.memtest86.com/‡nd http://pyropus.ca/software/memtester/");

71 
	`´štf
("\x1b[H\x1b[2K");

72 
	`´štf
("% [%d]\n", 
t™Ë
, 
·ss
);

73 
´og»ss_´š‹d
 = 0;

74 
´og»ss_fuÎ
 = 
ws
.
ws_cŞ
*(ws.
ws_row
-3);

75 
	`fæush
(
¡dout
);

76 
	}
}

78 
	$mem‹¡_´og»ss_’d
() {

79 
	`´štf
("\x1b[H\x1b[2J");

80 
	}
}

82 
	$mem‹¡_´og»ss_¡•
(
size_t
 
cu¼
, size_ˆ
size
, 
c
) {

83 
size_t
 
ch¬s
 = (()
cu¼
*
´og»ss_fuÎ
)/
size
, 
j
;

85 
j
 = 0; j < 
ch¬s
-
´og»ss_´š‹d
; j++è
	`´štf
("%c",
c
);

86 
´og»ss_´š‹d
 = 
ch¬s
;

87 
	`fæush
(
¡dout
);

88 
	}
}

93 
	$mem‹¡_add»ssšg
(*
l
, 
size_t
 
by‹s
, 
š‹¿ùive
) {

94 
wÜds
 = 
by‹s
/();

95 
j
, *
p
;

98 
p
 = 
l
;

99 
j
 = 0; j < 
wÜds
; j++) {

100 *
p
 = ()p;

101 
p
++;

102 ià((
j
 & 0xffffè=ğ0 && 
š‹¿ùive
)

103 
	`mem‹¡_´og»ss_¡•
(
j
,
wÜds
*2,'A');

106 
p
 = 
l
;

107 
j
 = 0; j < 
wÜds
; j++) {

108 ià(*
p
 != ()p) {

109 ià(
š‹¿ùive
) {

110 
	`´štf
("\n*** MEMORY ADDRESSING ERROR: %p contains %lu\n",

111 (*è
p
, *p);

112 
	`ex™
(1);

116 
p
++;

117 ià((
j
 & 0xffffè=ğ0 && 
š‹¿ùive
)

118 
	`mem‹¡_´og»ss_¡•
(
j
+
wÜds
,words*2,'A');

121 
	}
}

131 
	#xÜshiá64¡¬_Ãxt
() do { \

132 
r£ed
 ^=„seed >> 12; \

133 
r£ed
 ^=„seed << 25; \

134 
r£ed
 ^=„seed >> 27; \

135 
rout
 = 
r£ed
 * 
	`UINT64_C
(2685821657736338717); \

136 } 0)

	)

138 
	$mem‹¡_fl_¿ndom
(*
l
, 
size_t
 
by‹s
, 
š‹¿ùive
) {

139 
¡•
 = 4096/();

140 
wÜds
 = 
by‹s
/()/2;

141 
iwÜds
 = 
wÜds
/
¡•
;

142 
off
, 
w
, *
l1
, *
l2
;

143 
ušt64_t
 
r£ed
 = 
	`UINT64_C
(0xd13133de9afdb566);

144 
ušt64_t
 
rout
 = 0;

146 
	`as£¹
((
by‹s
 & 4095) == 0);

147 
off
 = 0; ofà< 
¡•
; off++) {

148 
l1
 = 
l
+
off
;

149 
l2
 = 
l1
+
wÜds
;

150 
w
 = 0; w < 
iwÜds
; w++) {

151 
	`xÜshiá64¡¬_Ãxt
();

152 *
l1
 = *
l2
 = (è
rout
;

153 
l1
 +ğ
¡•
;

154 
l2
 +ğ
¡•
;

155 ià((
w
 & 0xffffè=ğ0 && 
š‹¿ùive
)

156 
	`mem‹¡_´og»ss_¡•
(
w
+
iwÜds
*
off
,
wÜds
,'R');

159 
	}
}

163 
	$mem‹¡_fl_v®ue
(*
l
, 
size_t
 
by‹s
, 
v1
,

164 
v2
, 
sym
, 
š‹¿ùive
)

166 
¡•
 = 4096/();

167 
wÜds
 = 
by‹s
/()/2;

168 
iwÜds
 = 
wÜds
/
¡•
;

169 
off
, 
w
, *
l1
, *
l2
, 
v
;

171 
	`as£¹
((
by‹s
 & 4095) == 0);

172 
off
 = 0; ofà< 
¡•
; off++) {

173 
l1
 = 
l
+
off
;

174 
l2
 = 
l1
+
wÜds
;

175 
v
 = (
off
 & 1è? 
v2
 : 
v1
;

176 
w
 = 0; w < 
iwÜds
; w++) {

177 #ifdeà
MEMTEST_32BIT


178 *
l1
 = *
l2
 = ((è
v
) |

179 (((è
v
) << 16);

181 *
l1
 = *
l2
 = ((è
v
) |

182 (((è
v
) << 16) |

183 (((è
v
) << 32) |

184 (((è
v
) << 48);

186 
l1
 +ğ
¡•
;

187 
l2
 +ğ
¡•
;

188 ià((
w
 & 0xffffè=ğ0 && 
š‹¿ùive
)

189 
	`mem‹¡_´og»ss_¡•
(
w
+
iwÜds
*
off
,
wÜds
,
sym
);

192 
	}
}

194 
	$mem‹¡_com·»
(*
l
, 
size_t
 
by‹s
, 
š‹¿ùive
) {

195 
wÜds
 = 
by‹s
/()/2;

196 
w
, *
l1
, *
l2
;

198 
	`as£¹
((
by‹s
 & 4095) == 0);

199 
l1
 = 
l
;

200 
l2
 = 
l1
+
wÜds
;

201 
w
 = 0; w < 
wÜds
; w++) {

202 ià(*
l1
 !ğ*
l2
) {

203 ià(
š‹¿ùive
) {

204 
	`´štf
("\n*** MEMORY ERROR DETECTED: %p != %p (%lu vs %lu)\n",

205 (*)
l1
, (*)
l2
, *l1, *l2);

206 
	`ex™
(1);

210 
l1
 ++;

211 
l2
 ++;

212 ià((
w
 & 0xffffè=ğ0 && 
š‹¿ùive
)

213 
	`mem‹¡_´og»ss_¡•
(
w
,
wÜds
,'=');

216 
	}
}

218 
	$mem‹¡_com·»_times
(*
m
, 
size_t
 
by‹s
, 
·ss
, 
times
,

219 
š‹¿ùive
)

221 
j
;

222 
”rÜs
 = 0;

224 
j
 = 0; j < 
times
; j++) {

225 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_¡¬t
("Com·»",
·ss
);

226 
”rÜs
 +ğ
	`mem‹¡_com·»
(
m
,
by‹s
,
š‹¿ùive
);

227 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_’d
();

229  
”rÜs
;

230 
	}
}

237 
	$mem‹¡_‹¡
(*
m
, 
size_t
 
by‹s
, 
·s£s
, 
š‹¿ùive
) {

238 
·ss
 = 0;

239 
”rÜs
 = 0;

241 
·ss
 !ğ
·s£s
) {

242 
·ss
++;

244 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_¡¬t
("Add»ssšge¡",
·ss
);

245 
”rÜs
 +ğ
	`mem‹¡_add»ssšg
(
m
,
by‹s
,
š‹¿ùive
);

246 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_’d
();

248 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_¡¬t
("Rªdom fl",
·ss
);

249 
	`mem‹¡_fl_¿ndom
(
m
,
by‹s
,
š‹¿ùive
);

250 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_’d
();

251 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
m
,
by‹s
,
·ss
,4,
š‹¿ùive
);

253 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_¡¬t
("SŞid fl",
·ss
);

254 
	`mem‹¡_fl_v®ue
(
m
,
by‹s
,0,()-1,'S',
š‹¿ùive
);

255 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_’d
();

256 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
m
,
by‹s
,
·ss
,4,
š‹¿ùive
);

258 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_¡¬t
("Check”bßrd fl",
·ss
);

259 
	`mem‹¡_fl_v®ue
(
m
,
by‹s
,
ULONG_ONEZERO
,
ULONG_ZEROONE
,'C',
š‹¿ùive
);

260 ià(
š‹¿ùive
è
	`mem‹¡_´og»ss_’d
();

261 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
m
,
by‹s
,
·ss
,4,
š‹¿ùive
);

263  
”rÜs
;

264 
	}
}

275 
	#MEMTEST_BACKUP_WORDS
 (1024*(1024/()))

	)

279 
	#MEMTEST_DECACHE_SIZE
 (1024*8)

	)

280 
	$mem‹¡_´e£rvšg_‹¡
(*
m
, 
size_t
 
by‹s
, 
·s£s
) {

281 
backup
[
MEMTEST_BACKUP_WORDS
];

282 *
p
 = 
m
;

283 *
’d
 = (*è(((*)
m
)+(
by‹s
-
MEMTEST_DECACHE_SIZE
));

284 
size_t
 
Ëá
 = 
by‹s
;

285 
”rÜs
 = 0;

287 ià(
by‹s
 & 4095)  0;

288 ià(
by‹s
 < 4096*2)  0;

290 
Ëá
) {

294 ià(
Ëá
 == 4096) {

295 
Ëá
 += 4096;

296 
p
 -= 4096/();

299 
·ss
 = 0;

300 
size_t
 
Ën
 = (
Ëá
 > (
backup
)) ? (backup) :†eft;

303 ià(
Ën
/4096 % 2)†en -= 4096;

305 
	`memıy
(
backup
,
p
,
Ën
);

306 
·ss
 !ğ
·s£s
) {

307 
·ss
++;

308 
”rÜs
 +ğ
	`mem‹¡_add»ssšg
(
p
,
Ën
,0);

309 
	`mem‹¡_fl_¿ndom
(
p
,
Ën
,0);

310 ià(
by‹s
 >ğ
MEMTEST_DECACHE_SIZE
) {

311 
	`mem‹¡_com·»_times
(
m
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

312 
	`mem‹¡_com·»_times
(
’d
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

314 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
p
,
Ën
,
·ss
,4,0);

315 
	`mem‹¡_fl_v®ue
(
p
,
Ën
,0,()-1,'S',0);

316 ià(
by‹s
 >ğ
MEMTEST_DECACHE_SIZE
) {

317 
	`mem‹¡_com·»_times
(
m
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

318 
	`mem‹¡_com·»_times
(
’d
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

320 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
p
,
Ën
,
·ss
,4,0);

321 
	`mem‹¡_fl_v®ue
(
p
,
Ën
,
ULONG_ONEZERO
,
ULONG_ZEROONE
,'C',0);

322 ià(
by‹s
 >ğ
MEMTEST_DECACHE_SIZE
) {

323 
	`mem‹¡_com·»_times
(
m
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

324 
	`mem‹¡_com·»_times
(
’d
,
MEMTEST_DECACHE_SIZE
,
·ss
,1,0);

326 
”rÜs
 +ğ
	`mem‹¡_com·»_times
(
p
,
Ën
,
·ss
,4,0);

328 
	`memıy
(
p
,
backup
,
Ën
);

329 
Ëá
 -ğ
Ën
;

330 
p
 +ğ
Ën
/();

332  
”rÜs
;

333 
	}
}

336 
	$mem‹¡_®loc_ªd_‹¡
(
size_t
 
megaby‹s
, 
·s£s
) {

337 
size_t
 
by‹s
 = 
megaby‹s
*1024*1024;

338 *
m
 = 
	`m®loc
(
by‹s
);

340 ià(
m
 =ğ
NULL
) {

341 
	`årštf
(
¡d”r
,"Unableo‡llocate %zu megabytes: %s",

342 
megaby‹s
, 
	`¡»¼Ü
(
”ºo
));

343 
	`ex™
(1);

345 
	`mem‹¡_‹¡
(
m
,
by‹s
,
·s£s
,1);

346 
	`ä“
(
m
);

347 
	}
}

349 
	$mem‹¡
(
size_t
 
megaby‹s
, 
·s£s
) {

350 ià(
	`ioùl
(1, 
TIOCGWINSZ
, &
ws
) == -1) {

351 
ws
.
ws_cŞ
 = 80;

352 
ws
.
ws_row
 = 20;

354 
	`mem‹¡_®loc_ªd_‹¡
(
megaby‹s
,
·s£s
);

355 
	`´štf
("\nYour memory…assedhisest.\n");

356 
	`´štf
("Please if you‡re still in doubt usehe followingwoools:\n");

357 
	`´štf
("1) memtest86: http://www.memtest86.com/\n");

358 
	`´štf
("2) memtester: http://pyropus.ca/software/memtester/\n");

359 
	`ex™
(0);

360 
	}
}

	@module.c

30 
	~"£rv”.h
"

31 
	~"şu¡”.h
"

32 
	~<dlfú.h
>

34 
	#REDISMODULE_CORE
 1

	)

35 
	~"»dismoduË.h
"

44 
	sRedisModuË
 {

45 *
	mhªdË
;

46 *
	mÇme
;

47 
	mv”
;

48 
	m­iv”
;

49 
li¡
 *
	mty³s
;

51 
RedisModuË
 
	tRedisModuË
;

53 
diù
 *
	gmoduËs
;

57 
	sAutoMemEÁry
 {

58 *
	m±r
;

59 
	mty³
;

63 
	#REDISMODULE_AM_KEY
 0

	)

64 
	#REDISMODULE_AM_STRING
 1

	)

65 
	#REDISMODULE_AM_REPLY
 2

	)

66 
	#REDISMODULE_AM_FREED
 3

	)

81 
	#REDISMODULE_POOL_ALLOC_MIN_SIZE
 (1024*8)

	)

82 
	#REDISMODULE_POOL_ALLOC_ALIGN
 ((*))

	)

84 
	sRedisModuËPoŞAÎocBlock
 {

85 
ušt32_t
 
	msize
;

86 
ušt32_t
 
	mu£d
;

87 
RedisModuËPoŞAÎocBlock
 *
	mÃxt
;

88 
	mmemÜy
[];

89 } 
	tRedisModuËPoŞAÎocBlock
;

98 
	sRedisModuËCtx
 {

99 *
	mg‘­ifunıŒ
;

100 
RedisModuË
 *
	mmoduË
;

101 
ş›Á
 *
	mş›Á
;

102 
AutoMemEÁry
 *
	mamqueue
;

103 
	mamqueue_Ën
;

104 
	mamqueue_u£d
;

105 
	mæags
;

106 **
	mpo¡pÚed_¬¿ys
;

107 
	mpo¡pÚed_¬¿ys_couÁ
;

110 *
	mkeys_pos
;

111 
	mkeys_couÁ
;

113 
RedisModuËPoŞAÎocBlock
 *
	m·_h—d
;

115 
RedisModuËCtx
 
	tRedisModuËCtx
;

117 
	#REDISMODULE_CTX_INIT
 {(*)()&
RM_G‘Api
, 
NULL
, NULL, NULL, 0, 0, 0, NULL, 0, NULL, 0, NULL}

	)

118 
	#REDISMODULE_CTX_MULTI_EMITTED
 (1<<0)

	)

119 
	#REDISMODULE_CTX_AUTO_MEMORY
 (1<<1)

	)

120 
	#REDISMODULE_CTX_KEYS_POS_REQUEST
 (1<<2)

	)

123 
	sRedisModuËKey
 {

124 
RedisModuËCtx
 *
	mùx
;

125 
»disDb
 *
	mdb
;

126 
robj
 *
	mkey
;

127 
robj
 *
	mv®ue
;

128 *
	m™”
;

129 
	mmode
;

132 
ušt32_t
 
	mzty³
;

133 
z¿nge¥ec
 
	mzrs
;

134 
zËx¿nge¥ec
 
	mzÌs
;

135 
ušt32_t
 
	mz¡¬t
;

136 
ušt32_t
 
	mz’d
;

137 *
	mzcu¼’t
;

138 
	mz”
;

141 
RedisModuËKey
 
	tRedisModuËKey
;

144 
	#REDISMODULE_ZSET_RANGE_NONE
 0

	)

145 
	#REDISMODULE_ZSET_RANGE_LEX
 1

	)

146 
	#REDISMODULE_ZSET_RANGE_SCORE
 2

	)

147 
	#REDISMODULE_ZSET_RANGE_POS
 3

	)

151 (*
	tRedisModuËCmdFunc
è(
	tRedisModuËCtx
 *
	tùx
, **
	t¬gv
, 
	t¬gc
);

154 
	sRedisModuËCommªdProxy
 {

155 
RedisModuË
 *
moduË
;

156 
RedisModuËCmdFunc
 
func
;

157 
»disCommªd
 *
»discmd
;

159 
RedisModuËCommªdProxy
 
	tRedisModuËCommªdProxy
;

161 
	#REDISMODULE_REPLYFLAG_NONE
 0

	)

162 
	#REDISMODULE_REPLYFLAG_TOPARSE
 (1<<0è

	)

163 
	#REDISMODULE_REPLYFLAG_NESTED
 (1<<1è

	)

169 
	sRedisModuËC®lR•ly
 {

170 
RedisModuËCtx
 *
ùx
;

171 
ty³
;

172 
æags
;

173 
size_t
 
Ën
;

174 *
´Ùo
;

175 
size_t
 
´ÙŞ’
;

177 cÚ¡ *
¡r
;

181 
Î
;

182 
RedisModuËC®lR•ly
 *
¬¿y
;

183 } 
v®
;

184 } 
	tRedisModuËC®lR•ly
;

190 
	`RM_F»eC®lR•ly
(
RedisModuËC®lR•ly
 *
»¶y
);

191 
	`RM_Clo£Key
(
RedisModuËKey
 *
key
);

192 
	`autoMemÜyCŞËù
(
RedisModuËCtx
 *
ùx
);

193 
robj
 **
	`moduËC»©eArgvFromU£rFÜm©
(cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, *
¬gı
, *
æags
, 
va_li¡
 
­
);

194 
	`moduËR•liÿ‹MuÉiIfN“ded
(
RedisModuËCtx
 *
ùx
);

195 
	`RM_Z£tRªgeStİ
(
RedisModuËKey
 *
kp
);

196 
	`z£tKeyRe£t
(
RedisModuËKey
 *
key
);

206 *
	$RM_AÎoc
(
size_t
 
by‹s
) {

207  
	`zm®loc
(
by‹s
);

208 
	}
}

214 *
	$RM_C®loc
(
size_t
 
nmemb
, size_ˆ
size
) {

215  
	`zÿÎoc
(
nmemb
*
size
);

216 
	}
}

219 * 
	$RM_R—Îoc
(*
±r
, 
size_t
 
by‹s
) {

220  
	`z»®loc
(
±r
,
by‹s
);

221 
	}
}

226 
	$RM_F»e
(*
±r
) {

227 
	`zä“
(
±r
);

228 
	}
}

231 *
	$RM_SŒdup
(cÚ¡ *
¡r
) {

232  
	`z¡rdup
(
¡r
);

233 
	}
}

240 
	$poŞAÎocR–—£
(
RedisModuËCtx
 *
ùx
) {

241 
RedisModuËPoŞAÎocBlock
 *
h—d
 = 
ùx
->
·_h—d
, *
Ãxt
;

243 
h—d
 !ğ
NULL
) {

244 
Ãxt
 = 
h—d
->next;

245 
	`zä“
(
h—d
);

246 
h—d
 = 
Ãxt
;

248 
ùx
->
·_h—d
 = 
NULL
;

249 
	}
}

263 *
	$RM_PoŞAÎoc
(
RedisModuËCtx
 *
ùx
, 
size_t
 
by‹s
) {

264 ià(
by‹s
 =ğ0è 
NULL
;

265 
RedisModuËPoŞAÎocBlock
 *
b
 = 
ùx
->
·_h—d
;

266 
size_t
 
Ëá
 = 
b
 ? b->
size
 - b->
u£d
 : 0;

269 ià(
Ëá
 >ğ
by‹s
) {

270 
size_t
 
®ignm’t
 = 
REDISMODULE_POOL_ALLOC_ALIGN
;

271 
by‹s
 < 
®ignm’t
 &&‡lignment/2 >= bytes)‡lignment /= 2;

272 ià(
b
->
u£d
 % 
®ignm’t
)

273 
b
->
u£d
 +ğ
®ignm’t
 - (b->used %‡lignment);

274 
Ëá
 = (
b
->
u£d
 > b->
size
) ? 0 : b->size - b->used;

278 ià(
Ëá
 < 
by‹s
) {

279 
size_t
 
blocksize
 = 
REDISMODULE_POOL_ALLOC_MIN_SIZE
;

280 ià(
blocksize
 < 
by‹s
) blocksize = bytes;

281 
b
 = 
	`zm®loc
((*bè+ 
blocksize
);

282 
b
->
size
 = 
blocksize
;

283 
b
->
u£d
 = 0;

284 
b
->
Ãxt
 = 
ùx
->
·_h—d
;

285 
ùx
->
·_h—d
 = 
b
;

288 *
»tv®
 = 
b
->
memÜy
 + b->
u£d
;

289 
b
->
u£d
 +ğ
by‹s
;

290  
»tv®
;

291 
	}
}

309 
	$moduËC»©eEm±yKey
(
RedisModuËKey
 *
key
, 
ty³
) {

310 
robj
 *
obj
;

313 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
è|| key->
v®ue
)

314  
REDISMODULE_ERR
;

316 
ty³
) {

317 
REDISMODULE_KEYTYPE_LIST
:

318 
obj
 = 
	`ü—‹Quickli¡Objeù
();

319 
	`quickli¡S‘O±iÚs
(
obj
->
±r
, 
£rv”
.
li¡_max_zli¡_size
,

320 
£rv”
.
li¡_com´ess_d•th
);

322 
REDISMODULE_KEYTYPE_ZSET
:

323 
obj
 = 
	`ü—‹Z£tZli¡Objeù
();

325 
REDISMODULE_KEYTYPE_HASH
:

326 
obj
 = 
	`ü—‹HashObjeù
();

328 :  
REDISMODULE_ERR
;

330 
	`dbAdd
(
key
->
db
,key->key,
obj
);

331 
key
->
v®ue
 = 
obj
;

332  
REDISMODULE_OK
;

333 
	}
}

345 
	$moduËD–KeyIfEm±y
(
RedisModuËKey
 *
key
) {

346 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
è|| key->
v®ue
 =ğ
NULL
)  0;

347 
i£m±y
;

348 
robj
 *
o
 = 
key
->
v®ue
;

350 
o
->
ty³
) {

351 
OBJ_LIST
: 
i£m±y
 = 
	`li¡Ty³L’gth
(
o
) == 0; ;

352 
OBJ_SET
: 
i£m±y
 = 
	`£tTy³Size
(
o
) == 0; ;

353 
OBJ_ZSET
: 
i£m±y
 = 
	`z£tL’gth
(
o
) == 0; ;

354 
OBJ_HASH
 : 
i£m±y
 = 
	`hashTy³L’gth
(
o
) == 0; ;

355 : 
i£m±y
 = 0;

358 ià(
i£m±y
) {

359 
	`dbD–‘e
(
key
->
db
,key->key);

360 
key
->
v®ue
 = 
NULL
;

365 
	}
}

383 
	$RM_G‘Api
(cÚ¡ *
funúame
, **
rg‘PŒPŒ
) {

384 
diùEÁry
 *
he
 = 
	`diùFšd
(
£rv”
.
moduË­i
, 
funúame
);

385 ià(!
he
è 
REDISMODULE_ERR
;

386 *
rg‘PŒPŒ
 = 
	`diùG‘V®
(
he
);

387  
REDISMODULE_OK
;

388 
	}
}

391 
	$moduËF»eCÚ‹xt
(
RedisModuËCtx
 *
ùx
) {

392 
	`autoMemÜyCŞËù
(
ùx
);

393 
	`poŞAÎocR–—£
(
ùx
);

394 ià(
ùx
->
po¡pÚed_¬¿ys
) {

395 
	`zä“
(
ùx
->
po¡pÚed_¬¿ys
);

396 
ùx
->
po¡pÚed_¬¿ys_couÁ
 = 0;

397 
	`£rv”Log
(
LL_WARNING
,

402 
ùx
->
moduË
->
Çme
);

404 
	}
}

408 
	$RedisModuËCommªdDi¥©ch”
(
ş›Á
 *
c
) {

409 
RedisModuËCommªdProxy
 *
ı
 = (*)()
c
->
cmd
->
g‘keys_´oc
;

410 
RedisModuËCtx
 
ùx
 = 
REDISMODULE_CTX_INIT
;

412 
ùx
.
moduË
 = 
ı
->module;

413 
ùx
.
ş›Á
 = 
c
;

414 
ı
->
	`func
(&
ùx
,(**)
c
->
¬gv
,c->
¬gc
);

415 
	`´ev’tCommªdPrİag©iÚ
(
c
);

419 ià(
ùx
.
æags
 & 
REDISMODULE_CTX_MULTI_EMITTED
) {

420 
robj
 *
´İ¬gv
[1];

421 
´İ¬gv
[0] = 
	`ü—‹SŒšgObjeù
("EXEC",4);

422 
	`®soPrİag©e
(
£rv”
.
execCommªd
,
c
->
db
->
id
,
´İ¬gv
,1,

423 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

424 
	`deüRefCouÁ
(
´İ¬gv
[0]);

426 
	`moduËF»eCÚ‹xt
(&
ùx
);

427 
	}
}

438 *
	$moduËG‘CommªdKeysVŸAPI
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
) {

439 
RedisModuËCommªdProxy
 *
ı
 = (*)()
cmd
->
g‘keys_´oc
;

440 
RedisModuËCtx
 
ùx
 = 
REDISMODULE_CTX_INIT
;

442 
ùx
.
moduË
 = 
ı
->module;

443 
ùx
.
ş›Á
 = 
NULL
;

444 
ùx
.
æags
 |ğ
REDISMODULE_CTX_KEYS_POS_REQUEST
;

445 
ı
->
	`func
(&
ùx
,(**)
¬gv
,
¬gc
);

446 *
»s
 = 
ùx
.
keys_pos
;

447 ià(
numkeys
è*numkey ğ
ùx
.
keys_couÁ
;

448 
	`moduËF»eCÚ‹xt
(&
ùx
);

449  
»s
;

450 
	}
}

455 
	$RM_IsKeysPos™iÚReque¡
(
RedisModuËCtx
 *
ùx
) {

456  (
ùx
->
æags
 & 
REDISMODULE_CTX_KEYS_POS_REQUEST
) != 0;

457 
	}
}

473 
	$RM_KeyAtPos
(
RedisModuËCtx
 *
ùx
, 
pos
) {

474 ià(!(
ùx
->
æags
 & 
REDISMODULE_CTX_KEYS_POS_REQUEST
)) ;

475 ià(
pos
 <= 0) ;

476 
ùx
->
keys_pos
 = 
	`z»®loc
(ùx->keys_pos,()*(ùx->
keys_couÁ
+1));

477 
ùx
->
keys_pos
[ùx->
keys_couÁ
++] = 
pos
;

478 
	}
}

484 
	$commªdFÏgsFromSŒšg
(*
s
) {

485 
couÁ
, 
j
;

486 
æags
 = 0;

487 
sds
 *
tok’s
 = 
	`sds¥l™Ën
(
s
,
	`¡¾’
(s)," ",1,&
couÁ
);

488 
j
 = 0; j < 
couÁ
; j++) {

489 *
t
 = 
tok’s
[
j
];

490 ià(!
	`¡rÿ£cmp
(
t
,"wr™e")è
æags
 |ğ
CMD_WRITE
;

491 ià(!
	`¡rÿ£cmp
(
t
,"»adÚly")è
æags
 |ğ
CMD_READONLY
;

492 ià(!
	`¡rÿ£cmp
(
t
,"admš")è
æags
 |ğ
CMD_ADMIN
;

493 ià(!
	`¡rÿ£cmp
(
t
,"d’y-oom")è
æags
 |ğ
CMD_DENYOOM
;

494 ià(!
	`¡rÿ£cmp
(
t
,"d’y-süt")è
æags
 |ğ
CMD_NOSCRIPT
;

495 ià(!
	`¡rÿ£cmp
(
t
,"®low-lßdšg")è
æags
 |ğ
CMD_LOADING
;

496 ià(!
	`¡rÿ£cmp
(
t
,"pubsub")è
æags
 |ğ
CMD_PUBSUB
;

497 ià(!
	`¡rÿ£cmp
(
t
,"¿ndom")è
æags
 |ğ
CMD_RANDOM
;

498 ià(!
	`¡rÿ£cmp
(
t
,"®low-¡®e")è
æags
 |ğ
CMD_STALE
;

499 ià(!
	`¡rÿ£cmp
(
t
,"no-mÚ™Ü")è
æags
 |ğ
CMD_SKIP_MONITOR
;

500 ià(!
	`¡rÿ£cmp
(
t
,"ç¡")è
æags
 |ğ
CMD_FAST
;

501 ià(!
	`¡rÿ£cmp
(
t
,"g‘keys-­i")è
æags
 |ğ
CMD_MODULE_GETKEYS
;

502 ià(!
	`¡rÿ£cmp
(
t
,"no-şu¡”")è
æags
 |ğ
CMD_MODULE_NO_CLUSTER
;

505 
	`sdsä“¥l™»s
(
tok’s
,
couÁ
);

506 ià(
j
 !ğ
couÁ
)  -1;

507  
æags
;

508 
	}
}

563 
	$RM_C»©eCommªd
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
RedisModuËCmdFunc
 
cmdfunc
, cÚ¡ *
¡ræags
, 
fœ¡key
, 
Ï¡key
, 
key¡•
) {

564 
æags
 = 
¡ræags
 ? 
	`commªdFÏgsFromSŒšg
((*)strflags) : 0;

565 ià(
æags
 =ğ-1è 
REDISMODULE_ERR
;

566 ià((
æags
 & 
CMD_MODULE_NO_CLUSTER
è&& 
£rv”
.
şu¡”_’abËd
)

567  
REDISMODULE_ERR
;

569 
»disCommªd
 *
»discmd
;

570 
RedisModuËCommªdProxy
 *
ı
;

571 
sds
 
cmdÇme
 = 
	`sd¢ew
(
Çme
);

574 ià(
	`lookupCommªd
((*)
Çme
è!ğ
NULL
) {

575 
	`sdsä“
(
cmdÇme
);

576  
REDISMODULE_ERR
;

586 
ı
 = 
	`zm®loc
((*cp));

587 
ı
->
moduË
 = 
ùx
->module;

588 
ı
->
func
 = 
cmdfunc
;

589 
ı
->
»discmd
 = 
	`zm®loc
((*rediscmd));

590 
ı
->
»discmd
->
Çme
 = 
cmdÇme
;

591 
ı
->
»discmd
->
´oc
 = 
RedisModuËCommªdDi¥©ch”
;

592 
ı
->
»discmd
->
¬™y
 = -1;

593 
ı
->
»discmd
->
æags
 = fÏg | 
CMD_MODULE
;

594 
ı
->
»discmd
->
g‘keys_´oc
 = (
»disG‘KeysProc
*)()cp;

595 
ı
->
»discmd
->
fœ¡key
 = firstkey;

596 
ı
->
»discmd
->
Ï¡key
 =†astkey;

597 
ı
->
»discmd
->
key¡•
 = keystep;

598 
ı
->
»discmd
->
miüo£cÚds
 = 0;

599 
ı
->
»discmd
->
ÿÎs
 = 0;

600 
	`diùAdd
(
£rv”
.
commªds
,
	`sdsdup
(
cmdÇme
),
ı
->
»discmd
);

601 
	`diùAdd
(
£rv”
.
Üig_commªds
,
	`sdsdup
(
cmdÇme
),
ı
->
»discmd
);

602  
REDISMODULE_OK
;

603 
	}
}

609 
	$RM_S‘ModuËA‰ribs
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
v”
, 
­iv”
){

610 
RedisModuË
 *
moduË
;

612 ià(
ùx
->
moduË
 !ğ
NULL
) ;

613 
moduË
 = 
	`zm®loc
((*module));

614 
moduË
->
Çme
 = 
	`sd¢ew
((*)name);

615 
moduË
->
v”
 = ver;

616 
moduË
->
­iv”
 =‡piver;

617 
moduË
->
ty³s
 = 
	`li¡C»©e
();

618 
ùx
->
moduË
 = module;

619 
	}
}

629 
	$RM_AutoMemÜy
(
RedisModuËCtx
 *
ùx
) {

630 
ùx
->
æags
 |ğ
REDISMODULE_CTX_AUTO_MEMORY
;

631 
	}
}

634 
	$autoMemÜyAdd
(
RedisModuËCtx
 *
ùx
, 
ty³
, *
±r
) {

635 ià(!(
ùx
->
æags
 & 
REDISMODULE_CTX_AUTO_MEMORY
)) ;

636 ià(
ùx
->
amqueue_u£d
 =ğùx->
amqueue_Ën
) {

637 
ùx
->
amqueue_Ën
 *= 2;

638 ià(
ùx
->
amqueue_Ën
 < 16) ctx->amqueue_len = 16;

639 
ùx
->
amqueue
 = 
	`z»®loc
(ùx->amqueue,(
AutoMemEÁry
)*ùx->
amqueue_Ën
);

641 
ùx
->
amqueue
[ùx->
amqueue_u£d
].
ty³
 =ype;

642 
ùx
->
amqueue
[ùx->
amqueue_u£d
].
±r
 =…tr;

643 
ùx
->
amqueue_u£d
++;

644 
	}
}

651 
	$autoMemÜyF»ed
(
RedisModuËCtx
 *
ùx
, 
ty³
, *
±r
) {

652 ià(!(
ùx
->
æags
 & 
REDISMODULE_CTX_AUTO_MEMORY
))  0;

654 
couÁ
 = (
ùx
->
amqueue_u£d
+1)/2;

655 
j
 = 0; j < 
couÁ
; j++) {

656 
side
 = 0; side < 2; side++) {

659 
i
 = (
side
 =ğ0è? (
ùx
->
amqueue_u£d
 - 1 - 
j
) : j;

660 ià(
ùx
->
amqueue
[
i
].
ty³
 ==ype &&

661 
ùx
->
amqueue
[
i
].
±r
 ==…tr)

663 
ùx
->
amqueue
[
i
].
ty³
 = 
REDISMODULE_AM_FREED
;

667 ià(
i
 !ğ
ùx
->
amqueue_u£d
-1) {

668 
ùx
->
amqueue
[
i
] = ctx->amqueue[ùx->
amqueue_u£d
-1];

673 
ùx
->
amqueue_u£d
--;

679 
	}
}

682 
	$autoMemÜyCŞËù
(
RedisModuËCtx
 *
ùx
) {

683 ià(!(
ùx
->
æags
 & 
REDISMODULE_CTX_AUTO_MEMORY
)) ;

687 
ùx
->
æags
 &ğ~
REDISMODULE_CTX_AUTO_MEMORY
;

688 
j
;

689 
j
 = 0; j < 
ùx
->
amqueue_u£d
; j++) {

690 *
±r
 = 
ùx
->
amqueue
[
j
].ptr;

691 
ùx
->
amqueue
[
j
].
ty³
) {

692 
REDISMODULE_AM_STRING
: 
	`deüRefCouÁ
(
±r
); ;

693 
REDISMODULE_AM_REPLY
: 
	`RM_F»eC®lR•ly
(
±r
); ;

694 
REDISMODULE_AM_KEY
: 
	`RM_Clo£Key
(
±r
); ;

697 
ùx
->
æags
 |ğ
REDISMODULE_CTX_AUTO_MEMORY
;

698 
	`zä“
(
ùx
->
amqueue
);

699 
ùx
->
amqueue
 = 
NULL
;

700 
ùx
->
amqueue_Ën
 = 0;

701 
ùx
->
amqueue_u£d
 = 0;

702 
	}
}

713 
RedisModuËSŒšg
 *
	$RM_C»©eSŒšg
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
±r
, 
size_t
 
Ën
) {

714 
RedisModuËSŒšg
 *
o
 = 
	`ü—‹SŒšgObjeù
(
±r
,
Ën
);

715 
	`autoMemÜyAdd
(
ùx
,
REDISMODULE_AM_STRING
,
o
);

716  
o
;

717 
	}
}

725 
RedisModuËSŒšg
 *
	$RM_C»©eSŒšgPrštf
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
fmt
, ...) {

726 
sds
 
s
 = 
	`sd£m±y
();

728 
va_li¡
 
­
;

729 
	`va_¡¬t
(
­
, 
fmt
);

730 
s
 = 
	`sdsÿtv´štf
(s, 
fmt
, 
­
);

731 
	`va_’d
(
­
);

733 
RedisModuËSŒšg
 *
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
s
);

734 
	`autoMemÜyAdd
(
ùx
,
REDISMODULE_AM_STRING
,
o
);

736  
o
;

737 
	}
}

745 
RedisModuËSŒšg
 *
	$RM_C»©eSŒšgFromLÚgLÚg
(
RedisModuËCtx
 *
ùx
, 
Î
) {

746 
buf
[
LONG_STR_SIZE
];

747 
size_t
 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),
Î
);

748  
	`RM_C»©eSŒšg
(
ùx
,
buf
,
Ën
);

749 
	}
}

756 
RedisModuËSŒšg
 *
	$RM_C»©eSŒšgFromSŒšg
(
RedisModuËCtx
 *
ùx
, cÚ¡ 
RedisModuËSŒšg
 *
¡r
) {

757 
RedisModuËSŒšg
 *
o
 = 
	`dupSŒšgObjeù
(
¡r
);

758 
	`autoMemÜyAdd
(
ùx
,
REDISMODULE_AM_STRING
,
o
);

759  
o
;

760 
	}
}

768 
	$RM_F»eSŒšg
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
) {

769 
	`deüRefCouÁ
(
¡r
);

770 
	`autoMemÜyF»ed
(
ùx
,
REDISMODULE_AM_STRING
,
¡r
);

771 
	}
}

795 
	$RM_R‘ašSŒšg
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
) {

796 ià(!
	`autoMemÜyF»ed
(
ùx
,
REDISMODULE_AM_STRING
,
¡r
)) {

806 
	`šüRefCouÁ
(
¡r
);

808 
	}
}

813 cÚ¡ *
	$RM_SŒšgPŒL’
(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, 
size_t
 *
Ën
) {

814 ià(
¡r
 =ğ
NULL
) {

815 cÚ¡ *
”rmsg
 = "(NULL string„eply„eferenced in module)";

816 ià(
Ën
è*ËÀğ
	`¡¾’
(
”rmsg
);

817  
”rmsg
;

819 ià(
Ën
è*ËÀğ
	`sd¦’
(
¡r
->
±r
);

820  
¡r
->
±r
;

821 
	}
}

831 
	$RM_SŒšgToLÚgLÚg
(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, *
Î
) {

832  
	`¡ršg2Î
(
¡r
->
±r
,
	`sd¦’
(¡r->±r),
Î
è? 
REDISMODULE_OK
 :

833 
REDISMODULE_ERR
;

834 
	}
}

839 
	$RM_SŒšgToDoubË
(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, *
d
) {

840 
»tv®
 = 
	`g‘DoubËFromObjeù
(
¡r
,
d
);

841  (
»tv®
 =ğ
C_OK
è? 
REDISMODULE_OK
 : 
REDISMODULE_ERR
;

842 
	}
}

847 
	$RM_SŒšgCom·»
(
RedisModuËSŒšg
 *
a
, RedisModuËSŒšg *
b
) {

848  
	`com·»SŒšgObjeùs
(
a
,
b
);

849 
	}
}

853 
RedisModuËSŒšg
 *
	$moduËAs£¹Unsh¬edSŒšg
(
RedisModuËSŒšg
 *
¡r
) {

854 ià(
¡r
->
»fcouÁ
 != 1) {

855 
	`£rv”Log
(
LL_WARNING
,

859  
NULL
;

861 ià(
¡r
->
’codšg
 =ğ
OBJ_ENCODING_EMBSTR
) {

864 
¡r
->
±r
 = 
	`sd¢ewËn
(¡r->±r,
	`sd¦’
(str->ptr));

865 
¡r
->
’codšg
 = 
OBJ_ENCODING_RAW
;

866 } ià(
¡r
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

868 
¡r
->
±r
 = 
	`sdsäomlÚglÚg
(()str->ptr);

869 
¡r
->
’codšg
 = 
OBJ_ENCODING_RAW
;

871  
¡r
;

872 
	}
}

877 
	$RM_SŒšgAµ’dBufãr
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

878 
	`UNUSED
(
ùx
);

879 
¡r
 = 
	`moduËAs£¹Unsh¬edSŒšg
(str);

880 ià(
¡r
 =ğ
NULL
è 
REDISMODULE_ERR
;

881 
¡r
->
±r
 = 
	`sdsÿ’
(¡r->±r,
buf
,
Ën
);

882  
REDISMODULE_OK
;

883 
	}
}

902 
	$RM_WrÚgAr™y
(
RedisModuËCtx
 *
ùx
) {

903 
	`addR•lyE¼ÜFÜm©
(
ùx
->
ş›Á
,

905 (*)
ùx
->
ş›Á
->
¬gv
[0]->
±r
);

906  
REDISMODULE_OK
;

907 
	}
}

911 
	$RM_R•lyW™hLÚgLÚg
(
RedisModuËCtx
 *
ùx
, 
Î
) {

912 
	`addR•lyLÚgLÚg
(
ùx
->
ş›Á
,
Î
);

913  
REDISMODULE_OK
;

914 
	}
}

919 
	$»¶yW™hStus
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
msg
, *
´efix
) {

920 
sds
 
¡rmsg
 = 
	`sd¢ewËn
(
´efix
,1);

921 
¡rmsg
 = 
	`sdsÿt
(¡rmsg,
msg
);

922 
¡rmsg
 = 
	`sdsÿ’
(strmsg,"\r\n",2);

923 
	`addR•lySds
(
ùx
->
ş›Á
,
¡rmsg
);

924  
REDISMODULE_OK
;

925 
	}
}

941 
	$RM_R•lyW™hE¼Ü
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
”r
) {

942  
	`»¶yW™hStus
(
ùx
,
”r
,"-");

943 
	}
}

950 
	$RM_R•lyW™hSim¶eSŒšg
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
msg
) {

951  
	`»¶yW™hStus
(
ùx
,
msg
,"+");

952 
	}
}

965 
	$RM_R•lyW™hA¼ay
(
RedisModuËCtx
 *
ùx
, 
Ën
) {

966 ià(
Ën
 =ğ
REDISMODULE_POSTPONED_ARRAY_LEN
) {

967 
ùx
->
po¡pÚed_¬¿ys
 = 
	`z»®loc
(ctx->postponed_arrays,(*)*

968 (
ùx
->
po¡pÚed_¬¿ys_couÁ
+1));

969 
ùx
->
po¡pÚed_¬¿ys
[ùx->
po¡pÚed_¬¿ys_couÁ
] =

970 
	`addDeã¼edMuÉiBulkL’gth
(
ùx
->
ş›Á
);

971 
ùx
->
po¡pÚed_¬¿ys_couÁ
++;

973 
	`addR•lyMuÉiBulkL’
(
ùx
->
ş›Á
,
Ën
);

975  
REDISMODULE_OK
;

976 
	}
}

1004 
	$RM_R•lyS‘A¼ayL’gth
(
RedisModuËCtx
 *
ùx
, 
Ën
) {

1005 ià(
ùx
->
po¡pÚed_¬¿ys_couÁ
 == 0) {

1006 
	`£rv”Log
(
LL_WARNING
,

1010 "ÿÎ.", 
ùx
->
moduË
->
Çme
);

1013 
ùx
->
po¡pÚed_¬¿ys_couÁ
--;

1014 
	`£tDeã¼edMuÉiBulkL’gth
(
ùx
->
ş›Á
,

1015 
ùx
->
po¡pÚed_¬¿ys
[ùx->
po¡pÚed_¬¿ys_couÁ
],

1016 
Ën
);

1017 ià(
ùx
->
po¡pÚed_¬¿ys_couÁ
 == 0) {

1018 
	`zä“
(
ùx
->
po¡pÚed_¬¿ys
);

1019 
ùx
->
po¡pÚed_¬¿ys
 = 
NULL
;

1021 
	}
}

1026 
	$RM_R•lyW™hSŒšgBufãr
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

1027 
	`addR•lyBulkCBufãr
(
ùx
->
ş›Á
,(*)
buf
,
Ën
);

1028  
REDISMODULE_OK
;

1029 
	}
}

1034 
	$RM_R•lyW™hSŒšg
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
) {

1035 
	`addR•lyBulk
(
ùx
->
ş›Á
,
¡r
);

1036  
REDISMODULE_OK
;

1037 
	}
}

1043 
	$RM_R•lyW™hNuÎ
(
RedisModuËCtx
 *
ùx
) {

1044 
	`addR•ly
(
ùx
->
ş›Á
,
sh¬ed
.
nuÎbulk
);

1045  
REDISMODULE_OK
;

1046 
	}
}

1054 
	$RM_R•lyW™hC®lR•ly
(
RedisModuËCtx
 *
ùx
, 
RedisModuËC®lR•ly
 *
»¶y
) {

1055 
sds
 
´Ùo
 = 
	`sd¢ewËn
(
»¶y
->´Ùo,„•ly->
´ÙŞ’
);

1056 
	`addR•lySds
(
ùx
->
ş›Á
,
´Ùo
);

1057  
REDISMODULE_OK
;

1058 
	}
}

1066 
	$RM_R•lyW™hDoubË
(
RedisModuËCtx
 *
ùx
, 
d
) {

1067 
	`addR•lyDoubË
(
ùx
->
ş›Á
,
d
);

1068  
REDISMODULE_OK
;

1069 
	}
}

1078 
	$moduËR•liÿ‹MuÉiIfN“ded
(
RedisModuËCtx
 *
ùx
) {

1079 ià(
ùx
->
æags
 & 
REDISMODULE_CTX_MULTI_EMITTED
) ;

1080 
	`execCommªdPrİag©eMuÉi
(
ùx
->
ş›Á
);

1081 
ùx
->
æags
 |ğ
REDISMODULE_CTX_MULTI_EMITTED
;

1082 
	}
}

1103 
	$RM_R•liÿ‹
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...) {

1104 
»disCommªd
 *
cmd
;

1105 
robj
 **
¬gv
 = 
NULL
;

1106 
¬gc
 = 0, 
æags
 = 0, 
j
;

1107 
va_li¡
 
­
;

1109 
cmd
 = 
	`lookupCommªdByCSŒšg
((*)
cmdÇme
);

1110 ià(!
cmd
è 
REDISMODULE_ERR
;

1113 
	`va_¡¬t
(
­
, 
fmt
);

1114 
¬gv
 = 
	`moduËC»©eArgvFromU£rFÜm©
(
cmdÇme
,
fmt
,&
¬gc
,&
æags
,
­
);

1115 
	`va_’d
(
­
);

1116 ià(
¬gv
 =ğ
NULL
è 
REDISMODULE_ERR
;

1119 
	`moduËR•liÿ‹MuÉiIfN“ded
(
ùx
);

1120 
	`®soPrİag©e
(
cmd
,
ùx
->
ş›Á
->
db
->
id
,
¬gv
,
¬gc
,

1121 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

1124 
j
 = 0; j < 
¬gc
; j++è
	`deüRefCouÁ
(
¬gv
[j]);

1125 
	`zä“
(
¬gv
);

1126  
REDISMODULE_OK
;

1127 
	}
}

1140 
	$RM_R•liÿ‹V”b©im
(
RedisModuËCtx
 *
ùx
) {

1141 
	`®soPrİag©e
(
ùx
->
ş›Á
->
cmd
,ùx->ş›Á->
db
->
id
,

1142 
ùx
->
ş›Á
->
¬gv
,ùx->ş›Á->
¬gc
,

1143 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

1144  
REDISMODULE_OK
;

1145 
	}
}

1162 
	$RM_G‘Cl›ÁId
(
RedisModuËCtx
 *
ùx
) {

1163 ià(
ùx
->
ş›Á
 =ğ
NULL
)  0;

1164  
ùx
->
ş›Á
->
id
;

1165 
	}
}

1168 
	$RM_G‘S–eùedDb
(
RedisModuËCtx
 *
ùx
) {

1169  
ùx
->
ş›Á
->
db
->
id
;

1170 
	}
}

1182 
	$RM_S–eùDb
(
RedisModuËCtx
 *
ùx
, 
Ãwid
) {

1183 
»tv®
 = 
	`£ËùDb
(
ùx
->
ş›Á
,
Ãwid
);

1184  (
»tv®
 =ğ
C_OK
è? 
REDISMODULE_OK
 : 
REDISMODULE_ERR
;

1185 
	}
}

1201 *
	$RM_O³nKey
(
RedisModuËCtx
 *
ùx
, 
robj
 *
keyÇme
, 
mode
) {

1202 
RedisModuËKey
 *
kp
;

1203 
robj
 *
v®ue
;

1205 ià(
mode
 & 
REDISMODULE_WRITE
) {

1206 
v®ue
 = 
	`lookupKeyWr™e
(
ùx
->
ş›Á
->
db
,
keyÇme
);

1208 
v®ue
 = 
	`lookupKeyR—d
(
ùx
->
ş›Á
->
db
,
keyÇme
);

1209 ià(
v®ue
 =ğ
NULL
) {

1210  
NULL
;

1215 
kp
 = 
	`zm®loc
((*kp));

1216 
kp
->
ùx
 = ctx;

1217 
kp
->
db
 = 
ùx
->
ş›Á
->db;

1218 
kp
->
key
 = 
keyÇme
;

1219 
	`šüRefCouÁ
(
keyÇme
);

1220 
kp
->
v®ue
 = value;

1221 
kp
->
™”
 = 
NULL
;

1222 
kp
->
mode
 = mode;

1223 
	`z£tKeyRe£t
(
kp
);

1224 
	`autoMemÜyAdd
(
ùx
,
REDISMODULE_AM_KEY
,
kp
);

1225  (*)
kp
;

1226 
	}
}

1229 
	$RM_Clo£Key
(
RedisModuËKey
 *
key
) {

1230 ià(
key
 =ğ
NULL
) ;

1231 ià(
key
->
mode
 & 
REDISMODULE_WRITE
è
	`sigÇlModif›dKey
(key->
db
,key->key);

1233 
	`RM_Z£tRªgeStİ
(
key
);

1234 
	`deüRefCouÁ
(
key
->key);

1235 
	`autoMemÜyF»ed
(
key
->
ùx
,
REDISMODULE_AM_KEY
,key);

1236 
	`zä“
(
key
);

1237 
	}
}

1241 
	$RM_KeyTy³
(
RedisModuËKey
 *
key
) {

1242 ià(
key
 =ğ
NULL
 || key->
v®ue
 =ğNULLè 
REDISMODULE_KEYTYPE_EMPTY
;

1245 
key
->
v®ue
->
ty³
) {

1246 
OBJ_STRING
:  
REDISMODULE_KEYTYPE_STRING
;

1247 
OBJ_LIST
:  
REDISMODULE_KEYTYPE_LIST
;

1248 
OBJ_SET
:  
REDISMODULE_KEYTYPE_SET
;

1249 
OBJ_ZSET
:  
REDISMODULE_KEYTYPE_ZSET
;

1250 
OBJ_HASH
:  
REDISMODULE_KEYTYPE_HASH
;

1251 
OBJ_MODULE
:  
REDISMODULE_KEYTYPE_MODULE
;

1254 
	}
}

1261 
size_t
 
	$RM_V®ueL’gth
(
RedisModuËKey
 *
key
) {

1262 ià(
key
 =ğ
NULL
 || key->
v®ue
 == NULL)  0;

1263 
key
->
v®ue
->
ty³
) {

1264 
OBJ_STRING
:  
	`¡ršgObjeùL’
(
key
->
v®ue
);

1265 
OBJ_LIST
:  
	`li¡Ty³L’gth
(
key
->
v®ue
);

1266 
OBJ_SET
:  
	`£tTy³Size
(
key
->
v®ue
);

1267 
OBJ_ZSET
:  
	`z£tL’gth
(
key
->
v®ue
);

1268 
OBJ_HASH
:  
	`hashTy³L’gth
(
key
->
v®ue
);

1271 
	}
}

1277 
	$RM_D–‘eKey
(
RedisModuËKey
 *
key
) {

1278 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1279 ià(
key
->
v®ue
) {

1280 
	`dbD–‘e
(
key
->
db
,key->key);

1281 
key
->
v®ue
 = 
NULL
;

1283  
REDISMODULE_OK
;

1284 
	}
}

1289 
m¡ime_t
 
	$RM_G‘Expœe
(
RedisModuËKey
 *
key
) {

1290 
m¡ime_t
 
expœe
 = 
	`g‘Expœe
(
key
->
db
,key->key);

1291 ià(
expœe
 =ğ-1 || 
key
->
v®ue
 =ğ
NULL
)  -1;

1292 
expœe
 -ğ
	`m¡ime
();

1293  
expœe
 >= 0 ?ƒxpire : 0;

1294 
	}
}

1305 
	$RM_S‘Expœe
(
RedisModuËKey
 *
key
, 
m¡ime_t
 
expœe
) {

1306 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
è|| key->
v®ue
 =ğ
NULL
)

1307  
REDISMODULE_ERR
;

1308 ià(
expœe
 !ğ
REDISMODULE_NO_EXPIRE
) {

1309 
expœe
 +ğ
	`m¡ime
();

1310 
	`£tExpœe
(
key
->
db
,key->key,
expœe
);

1312 
	`»moveExpœe
(
key
->
db
,key->key);

1314  
REDISMODULE_OK
;

1315 
	}
}

1325 
	$RM_SŒšgS‘
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
¡r
) {

1326 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
è|| key->
™”
è 
REDISMODULE_ERR
;

1327 
	`RM_D–‘eKey
(
key
);

1328 
	`£tKey
(
key
->
db
,key->key,
¡r
);

1329 
key
->
v®ue
 = 
¡r
;

1330  
REDISMODULE_OK
;

1331 
	}
}

1362 *
	$RM_SŒšgDMA
(
RedisModuËKey
 *
key
, 
size_t
 *
Ën
, 
mode
) {

1367 *
em±y¡ršg
 = "<dma-empty-string>";

1368 ià(
key
->
v®ue
 =ğ
NULL
) {

1369 *
Ën
 = 0;

1370  
em±y¡ršg
;

1373 ià(
key
->
v®ue
->
ty³
 !ğ
OBJ_STRING
è 
NULL
;

1377 ià((
mode
 & 
REDISMODULE_WRITE
è|| 
key
->
v®ue
->
’codšg
 !ğ
OBJ_ENCODING_RAW
)

1378 
key
->
v®ue
 = 
	`dbUnsh¬eSŒšgV®ue
(key->
db
, key->key, key->value);

1380 *
Ën
 = 
	`sd¦’
(
key
->
v®ue
->
±r
);

1381  
key
->
v®ue
->
±r
;

1382 
	}
}

1396 
	$RM_SŒšgTrunÿ‹
(
RedisModuËKey
 *
key
, 
size_t
 
ÃwËn
) {

1397 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1398 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_STRING
è 
REDISMODULE_ERR
;

1399 ià(
ÃwËn
 > 512*1024*1024è 
REDISMODULE_ERR
;

1403 ià(
key
->
v®ue
 =ğ
NULL
 && 
ÃwËn
 =ğ0è 
REDISMODULE_OK
;

1405 ià(
key
->
v®ue
 =ğ
NULL
) {

1407 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ewËn
(
NULL
, 
ÃwËn
));

1408 
	`£tKey
(
key
->
db
,key->key,
o
);

1409 
key
->
v®ue
 = 
o
;

1410 
	`deüRefCouÁ
(
o
);

1413 
key
->
v®ue
 = 
	`dbUnsh¬eSŒšgV®ue
(key->
db
, key->key, key->value);

1414 
size_t
 
cu¾’
 = 
	`sd¦’
(
key
->
v®ue
->
±r
);

1415 ià(
ÃwËn
 > 
cu¾’
) {

1416 
key
->
v®ue
->
±r
 = 
	`sdsgrowz”o
(key->v®ue->±r,
ÃwËn
);

1417 } ià(
ÃwËn
 < 
cu¾’
) {

1418 
	`sd¤ªge
(
key
->
v®ue
->
±r
,0,
ÃwËn
-1);

1420 ià(
	`sd¦’
(
key
->
v®ue
->
±r
è< 
	`sd§va
(key->value->ptr))

1421 
key
->
v®ue
->
±r
 = 
	`sdsRemoveF»eS·û
(key->value->ptr);

1424  
REDISMODULE_OK
;

1425 
	}
}

1435 
	$RM_Li¡Push
(
RedisModuËKey
 *
key
, 
wh”e
, 
RedisModuËSŒšg
 *
–e
) {

1436 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1437 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_LIST
è 
REDISMODULE_ERR
;

1438 ià(
key
->
v®ue
 =ğ
NULL
è
	`moduËC»©eEm±yKey
(key,
REDISMODULE_KEYTYPE_LIST
);

1439 
	`li¡Ty³Push
(
key
->
v®ue
, 
–e
,

1440 (
wh”e
 =ğ
REDISMODULE_LIST_HEAD
è? 
QUICKLIST_HEAD
 : 
QUICKLIST_TAIL
);

1441  
REDISMODULE_OK
;

1442 
	}
}

1451 
RedisModuËSŒšg
 *
	$RM_Li¡Pİ
(
RedisModuËKey
 *
key
, 
wh”e
) {

1452 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
) ||

1453 
key
->
v®ue
 =ğ
NULL
 ||

1454 
key
->
v®ue
->
ty³
 !ğ
OBJ_LIST
è 
NULL
;

1455 
robj
 *
–e
 = 
	`li¡Ty³Pİ
(
key
->
v®ue
,

1456 (
wh”e
 =ğ
REDISMODULE_LIST_HEAD
è? 
QUICKLIST_HEAD
 : 
QUICKLIST_TAIL
);

1457 
robj
 *
decoded
 = 
	`g‘DecodedObjeù
(
–e
);

1458 
	`deüRefCouÁ
(
–e
);

1459 
	`moduËD–KeyIfEm±y
(
key
);

1460 
	`autoMemÜyAdd
(
key
->
ùx
,
REDISMODULE_AM_STRING
,
decoded
);

1461  
decoded
;

1462 
	}
}

1470 
	$RM_Z£tAddFÏgsToCÜeFÏgs
(
æags
) {

1471 
»tæags
 = 0;

1472 ià(
æags
 & 
REDISMODULE_ZADD_XX
è
»tæags
 |ğ
ZADD_XX
;

1473 ià(
æags
 & 
REDISMODULE_ZADD_NX
è
»tæags
 |ğ
ZADD_NX
;

1474  
»tæags
;

1475 
	}
}

1478 
	$RM_Z£tAddFÏgsFromCÜeFÏgs
(
æags
) {

1479 
»tæags
 = 0;

1480 ià(
æags
 & 
ZADD_ADDED
è
»tæags
 |ğ
REDISMODULE_ZADD_ADDED
;

1481 ià(
æags
 & 
ZADD_UPDATED
è
»tæags
 |ğ
REDISMODULE_ZADD_UPDATED
;

1482 ià(
æags
 & 
ZADD_NOP
è
»tæags
 |ğ
REDISMODULE_ZADD_NOP
;

1483  
»tæags
;

1484 
	}
}

1514 
	$RM_Z£tAdd
(
RedisModuËKey
 *
key
, 
scÜe
, 
RedisModuËSŒšg
 *
–e
, *
æag¥Œ
) {

1515 
æags
 = 0;

1516 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1517 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1518 ià(
key
->
v®ue
 =ğ
NULL
è
	`moduËC»©eEm±yKey
(key,
REDISMODULE_KEYTYPE_ZSET
);

1519 ià(
æag¥Œ
è
æags
 = 
	`RM_Z£tAddFÏgsToCÜeFÏgs
(*flagsptr);

1520 ià(
	`z£tAdd
(
key
->
v®ue
,
scÜe
,
–e
->
±r
,&
æags
,
NULL
) == 0) {

1521 ià(
æag¥Œ
) *flagsptr = 0;

1522  
REDISMODULE_ERR
;

1524 ià(
æag¥Œ
è*æag¥Œ = 
	`RM_Z£tAddFÏgsFromCÜeFÏgs
(
æags
);

1525  
REDISMODULE_OK
;

1526 
	}
}

1541 
	$RM_Z£tInüby
(
RedisModuËKey
 *
key
, 
scÜe
, 
RedisModuËSŒšg
 *
–e
, *
æag¥Œ
, *
ÃwscÜe
) {

1542 
æags
 = 0;

1543 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1544 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1545 ià(
key
->
v®ue
 =ğ
NULL
è
	`moduËC»©eEm±yKey
(key,
REDISMODULE_KEYTYPE_ZSET
);

1546 ià(
æag¥Œ
è
æags
 = 
	`RM_Z£tAddFÏgsToCÜeFÏgs
(*flagsptr);

1547 
æags
 |ğ
ZADD_INCR
;

1548 ià(
	`z£tAdd
(
key
->
v®ue
,
scÜe
,
–e
->
±r
,&
æags
,
ÃwscÜe
) == 0) {

1549 ià(
æag¥Œ
) *flagsptr = 0;

1550  
REDISMODULE_ERR
;

1553 ià(
æag¥Œ
 && (*æag¥Œ & 
ZADD_NAN
)) {

1554 *
æag¥Œ
 = 0;

1555  
REDISMODULE_ERR
;

1557 ià(
æag¥Œ
è*æag¥Œ = 
	`RM_Z£tAddFÏgsFromCÜeFÏgs
(
æags
);

1558  
REDISMODULE_OK
;

1559 
	}
}

1579 
	$RM_Z£tRem
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
–e
, *
d–‘ed
) {

1580 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
)è 
REDISMODULE_ERR
;

1581 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1582 ià(
key
->
v®ue
 !ğ
NULL
 && 
	`z£tD–
(key->v®ue,
–e
->
±r
)) {

1583 ià(
d–‘ed
) *deleted = 1;

1585 ià(
d–‘ed
) *deleted = 0;

1587  
REDISMODULE_OK
;

1588 
	}
}

1598 
	$RM_Z£tScÜe
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
–e
, *
scÜe
) {

1599 ià(
key
->
v®ue
 =ğ
NULL
è 
REDISMODULE_ERR
;

1600 ià(
key
->
v®ue
->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1601 ià(
	`z£tScÜe
(
key
->
v®ue
,
–e
->
±r
,
scÜe
è=ğ
C_ERR
è 
REDISMODULE_ERR
;

1602  
REDISMODULE_OK
;

1603 
	}
}

1609 
	$z£tKeyRe£t
(
RedisModuËKey
 *
key
) {

1610 
key
->
zty³
 = 
REDISMODULE_ZSET_RANGE_NONE
;

1611 
key
->
zcu¼’t
 = 
NULL
;

1612 
key
->
z”
 = 1;

1613 
	}
}

1616 
	$RM_Z£tRªgeStİ
(
RedisModuËKey
 *
key
) {

1618 ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_LEX
)

1619 
	`z¦F»eLexRªge
(&
key
->
zÌs
);

1623 
	`z£tKeyRe£t
(
key
);

1624 
	}
}

1627 
	$RM_Z£tRªgeEndR—ched
(
RedisModuËKey
 *
key
) {

1628  
key
->
z”
;

1629 
	}
}

1637 
	$z£tIn™ScÜeRªge
(
RedisModuËKey
 *
key
, 
mš
, 
max
, 
mšex
, 
maxex
, 
fœ¡
) {

1638 ià(!
key
->
v®ue
 || key->v®ue->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1640 
	`RM_Z£tRªgeStİ
(
key
);

1641 
key
->
zty³
 = 
REDISMODULE_ZSET_RANGE_SCORE
;

1642 
key
->
z”
 = 0;

1646 
z¿nge¥ec
 *
zrs
 = &
key
->zrs;

1647 
zrs
->
mš
 = min;

1648 
zrs
->
max
 = max;

1649 
zrs
->
mšex
 = minex;

1650 
zrs
->
maxex
 = maxex;

1652 ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1653 
key
->
zcu¼’t
 = 
fœ¡
 ? 
	`zzlFœ¡InRªge
(key->
v®ue
->
±r
,
zrs
) :

1654 
	`zzlLa¡InRªge
(
key
->
v®ue
->
±r
,
zrs
);

1655 } ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1656 
z£t
 *
zs
 = 
key
->
v®ue
->
±r
;

1657 
zskli¡
 *
z¦
 = 
zs
->zsl;

1658 
key
->
zcu¼’t
 = 
fœ¡
 ? 
	`z¦Fœ¡InRªge
(
z¦
,
zrs
) :

1659 
	`z¦La¡InRªge
(
z¦
,
zrs
);

1661 
	`£rv”Pªic
("Unsupported zsetƒncoding");

1663 ià(
key
->
zcu¼’t
 =ğ
NULL
èkey->
z”
 = 1;

1664  
REDISMODULE_OK
;

1665 
	}
}

1682 
	$RM_Z£tFœ¡InScÜeRªge
(
RedisModuËKey
 *
key
, 
mš
, 
max
, 
mšex
, 
maxex
) {

1683  
	`z£tIn™ScÜeRªge
(
key
,
mš
,
max
,
mšex
,
maxex
,1);

1684 
	}
}

1688 
	$RM_Z£tLa¡InScÜeRªge
(
RedisModuËKey
 *
key
, 
mš
, 
max
, 
mšex
, 
maxex
) {

1689  
	`z£tIn™ScÜeRªge
(
key
,
mš
,
max
,
mšex
,
maxex
,0);

1690 
	}
}

1701 
	$z£tIn™LexRªge
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
mš
, RedisModuËSŒšg *
max
, 
fœ¡
) {

1702 ià(!
key
->
v®ue
 || key->v®ue->
ty³
 !ğ
OBJ_ZSET
è 
REDISMODULE_ERR
;

1704 
	`RM_Z£tRªgeStİ
(
key
);

1705 
key
->
z”
 = 0;

1709 
zËx¿nge¥ec
 *
zÌs
 = &
key
->zlrs;

1710 ià(
	`z¦P¬£LexRªge
(
mš
, 
max
, 
zÌs
è=ğ
C_ERR
è 
REDISMODULE_ERR
;

1714 
key
->
zty³
 = 
REDISMODULE_ZSET_RANGE_LEX
;

1716 ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1717 
key
->
zcu¼’t
 = 
fœ¡
 ? 
	`zzlFœ¡InLexRªge
(key->
v®ue
->
±r
,
zÌs
) :

1718 
	`zzlLa¡InLexRªge
(
key
->
v®ue
->
±r
,
zÌs
);

1719 } ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1720 
z£t
 *
zs
 = 
key
->
v®ue
->
±r
;

1721 
zskli¡
 *
z¦
 = 
zs
->zsl;

1722 
key
->
zcu¼’t
 = 
fœ¡
 ? 
	`z¦Fœ¡InLexRªge
(
z¦
,
zÌs
) :

1723 
	`z¦La¡InLexRªge
(
z¦
,
zÌs
);

1725 
	`£rv”Pªic
("Unsupported zsetƒncoding");

1727 ià(
key
->
zcu¼’t
 =ğ
NULL
èkey->
z”
 = 1;

1729  
REDISMODULE_OK
;

1730 
	}
}

1744 
	$RM_Z£tFœ¡InLexRªge
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
mš
, RedisModuËSŒšg *
max
) {

1745  
	`z£tIn™LexRªge
(
key
,
mš
,
max
,1);

1746 
	}
}

1750 
	$RM_Z£tLa¡InLexRªge
(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
mš
, RedisModuËSŒšg *
max
) {

1751  
	`z£tIn™LexRªge
(
key
,
mš
,
max
,0);

1752 
	}
}

1757 
RedisModuËSŒšg
 *
	$RM_Z£tRªgeCu¼’tEËm’t
(
RedisModuËKey
 *
key
, *
scÜe
) {

1758 
RedisModuËSŒšg
 *
¡r
;

1760 ià(
key
->
zcu¼’t
 =ğ
NULL
)  NULL;

1761 ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1762 *
•Œ
, *
¥Œ
;

1763 
•Œ
 = 
key
->
zcu¼’t
;

1764 
sds
 
–e
 = 
	`zli¡G‘Objeù
(
•Œ
);

1765 ià(
scÜe
) {

1766 
¥Œ
 = 
	`zli¡Next
(
key
->
v®ue
->
±r
,
•Œ
);

1767 *
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

1769 
¡r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
–e
);

1770 } ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1771 
zskli¡Node
 *
Ê
 = 
key
->
zcu¼’t
;

1772 ià(
scÜe
è*scÜğ
Ê
->score;

1773 
¡r
 = 
	`ü—‹SŒšgObjeù
(
Ê
->
–e
,
	`sd¦’
(ln->ele));

1775 
	`£rv”Pªic
("Unsupported zsetƒncoding");

1777 
	`autoMemÜyAdd
(
key
->
ùx
,
REDISMODULE_AM_STRING
,
¡r
);

1778  
¡r
;

1779 
	}
}

1784 
	$RM_Z£tRªgeNext
(
RedisModuËKey
 *
key
) {

1785 ià(!
key
->
zty³
 || !key->
zcu¼’t
)  0;

1787 ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1788 *
zl
 = 
key
->
v®ue
->
±r
;

1789 *
•Œ
 = 
key
->
zcu¼’t
;

1790 *
Ãxt
;

1791 
Ãxt
 = 
	`zli¡Next
(
zl
,
•Œ
);

1792 ià(
Ãxt
èÃxˆğ
	`zli¡Next
(
zl
,next);

1793 ià(
Ãxt
 =ğ
NULL
) {

1794 
key
->
z”
 = 1;

1798 ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_SCORE
) {

1801 *
§ved_Ãxt
 = 
Ãxt
;

1802 
Ãxt
 = 
	`zli¡Next
(
zl
,next);

1803 
scÜe
 = 
	`zzlG‘ScÜe
(
Ãxt
);

1804 ià(!
	`z¦V®ueL‹Max
(
scÜe
,&
key
->
zrs
)) {

1805 
key
->
z”
 = 1;

1808 
Ãxt
 = 
§ved_Ãxt
;

1809 } ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_LEX
) {

1810 ià(!
	`zzlLexV®ueL‹Max
(
Ãxt
,&
key
->
zÌs
)) {

1811 
key
->
z”
 = 1;

1815 
key
->
zcu¼’t
 = 
Ãxt
;

1818 } ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1819 
zskli¡Node
 *
Ê
 = 
key
->
zcu¼’t
, *
Ãxt
 =†n->
Ëv–
[0].
fÜw¬d
;

1820 ià(
Ãxt
 =ğ
NULL
) {

1821 
key
->
z”
 = 1;

1825 ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_SCORE
 &&

1826 !
	`z¦V®ueL‹Max
(
Ê
->
scÜe
,&
key
->
zrs
))

1828 
key
->
z”
 = 1;

1830 } ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_LEX
) {

1831 ià(!
	`z¦LexV®ueL‹Max
(
Ê
->
–e
,&
key
->
zÌs
)) {

1832 
key
->
z”
 = 1;

1836 
key
->
zcu¼’t
 = 
Ãxt
;

1840 
	`£rv”Pªic
("Unsupported zsetƒncoding");

1842 
	}
}

1847 
	$RM_Z£tRªgeP»v
(
RedisModuËKey
 *
key
) {

1848 ià(!
key
->
zty³
 || !key->
zcu¼’t
)  0;

1850 ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1851 *
zl
 = 
key
->
v®ue
->
±r
;

1852 *
•Œ
 = 
key
->
zcu¼’t
;

1853 *
´ev
;

1854 
´ev
 = 
	`zli¡P»v
(
zl
,
•Œ
);

1855 ià(
´ev
è´ev = 
	`zli¡P»v
(
zl
,prev);

1856 ià(
´ev
 =ğ
NULL
) {

1857 
key
->
z”
 = 1;

1861 ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_SCORE
) {

1864 *
§ved_´ev
 = 
´ev
;

1865 
´ev
 = 
	`zli¡Next
(
zl
,prev);

1866 
scÜe
 = 
	`zzlG‘ScÜe
(
´ev
);

1867 ià(!
	`z¦V®ueG‹Mš
(
scÜe
,&
key
->
zrs
)) {

1868 
key
->
z”
 = 1;

1871 
´ev
 = 
§ved_´ev
;

1872 } ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_LEX
) {

1873 ià(!
	`zzlLexV®ueG‹Mš
(
´ev
,&
key
->
zÌs
)) {

1874 
key
->
z”
 = 1;

1878 
key
->
zcu¼’t
 = 
´ev
;

1881 } ià(
key
->
v®ue
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1882 
zskli¡Node
 *
Ê
 = 
key
->
zcu¼’t
, *
´ev
 =†n->
backw¬d
;

1883 ià(
´ev
 =ğ
NULL
) {

1884 
key
->
z”
 = 1;

1888 ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_SCORE
 &&

1889 !
	`z¦V®ueG‹Mš
(
Ê
->
scÜe
,&
key
->
zrs
))

1891 
key
->
z”
 = 1;

1893 } ià(
key
->
zty³
 =ğ
REDISMODULE_ZSET_RANGE_LEX
) {

1894 ià(!
	`z¦LexV®ueG‹Mš
(
´ev
->
–e
,&
key
->
zÌs
)) {

1895 
key
->
z”
 = 1;

1899 
key
->
zcu¼’t
 = 
´ev
;

1903 
	`£rv”Pªic
("Unsupported zsetƒncoding");

1905 
	}
}

1961 
	$RM_HashS‘
(
RedisModuËKey
 *
key
, 
æags
, ...) {

1962 
va_li¡
 
­
;

1963 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
))  0;

1964 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_HASH
)  0;

1965 ià(
key
->
v®ue
 =ğ
NULL
è
	`moduËC»©eEm±yKey
(key,
REDISMODULE_KEYTYPE_HASH
);

1967 
upd©ed
 = 0;

1968 
	`va_¡¬t
(
­
, 
æags
);

1970 
RedisModuËSŒšg
 *
f›ld
, *
v®ue
;

1972 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
) {

1973 *
cf›ld
 = 
	`va_¬g
(
­
,*);

1974 ià(
cf›ld
 =ğ
NULL
) ;

1975 
f›ld
 = 
	`ü—‹RawSŒšgObjeù
(
cf›ld
,
	`¡¾’
(cfield));

1977 
f›ld
 = 
	`va_¬g
(
­
,
RedisModuËSŒšg
*);

1978 ià(
f›ld
 =ğ
NULL
) ;

1980 
v®ue
 = 
	`va_¬g
(
­
,
RedisModuËSŒšg
*);

1983 ià(
æags
 & (
REDISMODULE_HASH_XX
|
REDISMODULE_HASH_NX
)) {

1984 
exi¡s
 = 
	`hashTy³Exi¡s
(
key
->
v®ue
, 
f›ld
->
±r
);

1985 ià(((
æags
 & 
REDISMODULE_HASH_XX
è&& !
exi¡s
) ||

1986 ((
æags
 & 
REDISMODULE_HASH_NX
è&& 
exi¡s
))

1988 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
è
	`deüRefCouÁ
(
f›ld
);

1994 ià(
v®ue
 =ğ
REDISMODULE_HASH_DELETE
) {

1995 
upd©ed
 +ğ
	`hashTy³D–‘e
(
key
->
v®ue
, 
f›ld
->
±r
);

1996 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
è
	`deüRefCouÁ
(
f›ld
);

2000 
low_æags
 = 
HASH_SET_COPY
;

2004 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
)

2005 
low_æags
 |ğ
HASH_SET_TAKE_FIELD
;

2006 
upd©ed
 +ğ
	`hashTy³S‘
(
key
->
v®ue
, 
f›ld
->
±r
, v®ue->±r, 
low_æags
);

2010 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
) {

2011 
f›ld
->
±r
 = 
NULL
;

2012 
	`deüRefCouÁ
(
f›ld
);

2015 
	`va_’d
(
­
);

2016 
	`moduËD–KeyIfEm±y
(
key
);

2017  
upd©ed
;

2018 
	}
}

2061 
	$RM_HashG‘
(
RedisModuËKey
 *
key
, 
æags
, ...) {

2062 
va_li¡
 
­
;

2063 ià(
key
->
v®ue
 && key->v®ue->
ty³
 !ğ
OBJ_HASH
è 
REDISMODULE_ERR
;

2065 
	`va_¡¬t
(
­
, 
æags
);

2067 
RedisModuËSŒšg
 *
f›ld
, **
v®u•Œ
;

2068 *
exi¡¥Œ
;

2070 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
) {

2071 *
cf›ld
 = 
	`va_¬g
(
­
,*);

2072 ià(
cf›ld
 =ğ
NULL
) ;

2073 
f›ld
 = 
	`ü—‹RawSŒšgObjeù
(
cf›ld
,
	`¡¾’
(cfield));

2075 
f›ld
 = 
	`va_¬g
(
­
,
RedisModuËSŒšg
*);

2076 ià(
f›ld
 =ğ
NULL
) ;

2080 ià(
æags
 & 
REDISMODULE_HASH_EXISTS
) {

2081 
exi¡¥Œ
 = 
	`va_¬g
(
­
,*);

2082 ià(
key
->
v®ue
)

2083 *
exi¡¥Œ
 = 
	`hashTy³Exi¡s
(
key
->
v®ue
,
f›ld
->
±r
);

2085 *
exi¡¥Œ
 = 0;

2087 
v®u•Œ
 = 
	`va_¬g
(
­
,
RedisModuËSŒšg
**);

2088 ià(
key
->
v®ue
) {

2089 *
v®u•Œ
 = 
	`hashTy³G‘V®ueObjeù
(
key
->
v®ue
,
f›ld
->
±r
);

2090 ià(*
v®u•Œ
) {

2091 
robj
 *
decoded
 = 
	`g‘DecodedObjeù
(*
v®u•Œ
);

2092 
	`deüRefCouÁ
(*
v®u•Œ
);

2093 *
v®u•Œ
 = 
decoded
;

2095 ià(*
v®u•Œ
)

2096 
	`autoMemÜyAdd
(
key
->
ùx
,
REDISMODULE_AM_STRING
,*
v®u•Œ
);

2098 *
v®u•Œ
 = 
NULL
;

2103 ià(
æags
 & 
REDISMODULE_HASH_CFIELDS
è
	`deüRefCouÁ
(
f›ld
);

2105 
	`va_’d
(
­
);

2106  
REDISMODULE_OK
;

2107 
	}
}

2117 
RedisModuËC®lR•ly
 *
	$moduËC»©eC®lR•lyFromPrÙo
(
RedisModuËCtx
 *
ùx
, 
sds
 
´Ùo
) {

2118 
RedisModuËC®lR•ly
 *
»¶y
 = 
	`zm®loc
((*reply));

2119 
»¶y
->
ùx
 = ctx;

2120 
»¶y
->
´Ùo
 =…roto;

2121 
»¶y
->
´ÙŞ’
 = 
	`sd¦’
(
´Ùo
);

2122 
»¶y
->
æags
 = 
REDISMODULE_REPLYFLAG_TOPARSE
;

2123 
´Ùo
[0]) {

2125 '+': 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_STRING
; ;

2126 '-': 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_ERROR
; ;

2127 ':': 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_INTEGER
; ;

2128 '*': 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_ARRAY
; ;

2129 : 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_UNKNOWN
; ;

2131 ià((
´Ùo
[0] == '*' ||…roto[0] == '$') &&…roto[1] == '-')

2132 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_NULL
;

2133  
»¶y
;

2134 
	}
}

2136 
moduËP¬£C®lR•ly_IÁ
(
RedisModuËC®lR•ly
 *
»¶y
);

2137 
moduËP¬£C®lR•ly_BulkSŒšg
(
RedisModuËC®lR•ly
 *
»¶y
);

2138 
moduËP¬£C®lR•ly_Sim¶eSŒšg
(
RedisModuËC®lR•ly
 *
»¶y
);

2139 
moduËP¬£C®lR•ly_A¼ay
(
RedisModuËC®lR•ly
 *
»¶y
);

2144 
	$moduËP¬£C®lR•ly
(
RedisModuËC®lR•ly
 *
»¶y
) {

2145 ià(!(
»¶y
->
æags
 & 
REDISMODULE_REPLYFLAG_TOPARSE
)) ;

2146 
»¶y
->
æags
 &ğ~
REDISMODULE_REPLYFLAG_TOPARSE
;

2148 
»¶y
->
´Ùo
[0]) {

2149 ':': 
	`moduËP¬£C®lR•ly_IÁ
(
»¶y
); ;

2150 '$': 
	`moduËP¬£C®lR•ly_BulkSŒšg
(
»¶y
); ;

2152 '+': 
	`moduËP¬£C®lR•ly_Sim¶eSŒšg
(
»¶y
); ;

2153 '*': 
	`moduËP¬£C®lR•ly_A¼ay
(
»¶y
); ;

2155 
	}
}

2157 
	$moduËP¬£C®lR•ly_IÁ
(
RedisModuËC®lR•ly
 *
»¶y
) {

2158 *
´Ùo
 = 
»¶y
->proto;

2159 *
p
 = 
	`¡rchr
(
´Ùo
+1,'\r');

2161 
	`¡ršg2Î
(
´Ùo
+1,
p
-´Ùo-1,&
»¶y
->
v®
.
Î
);

2162 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
+2;

2163 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_INTEGER
;

2164 
	}
}

2166 
	$moduËP¬£C®lR•ly_BulkSŒšg
(
RedisModuËC®lR•ly
 *
»¶y
) {

2167 *
´Ùo
 = 
»¶y
->proto;

2168 *
p
 = 
	`¡rchr
(
´Ùo
+1,'\r');

2169 
bulkËn
;

2171 
	`¡ršg2Î
(
´Ùo
+1,
p
-´Ùo-1,&
bulkËn
);

2172 ià(
bulkËn
 == -1) {

2173 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
+2;

2174 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_NULL
;

2176 
»¶y
->
v®
.
¡r
 = 
p
+2;

2177 
»¶y
->
Ën
 = 
bulkËn
;

2178 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
+2+
bulkËn
+2;

2179 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_STRING
;

2181 
	}
}

2183 
	$moduËP¬£C®lR•ly_Sim¶eSŒšg
(
RedisModuËC®lR•ly
 *
»¶y
) {

2184 *
´Ùo
 = 
»¶y
->proto;

2185 *
p
 = 
	`¡rchr
(
´Ùo
+1,'\r');

2187 
»¶y
->
v®
.
¡r
 = 
´Ùo
+1;

2188 
»¶y
->
Ën
 = 
p
-
´Ùo
-1;

2189 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
+2;

2190 
»¶y
->
ty³
 = 
´Ùo
[0] =ğ'+' ? 
REDISMODULE_REPLY_STRING
 :

2191 
REDISMODULE_REPLY_ERROR
;

2192 
	}
}

2194 
	$moduËP¬£C®lR•ly_A¼ay
(
RedisModuËC®lR•ly
 *
»¶y
) {

2195 *
´Ùo
 = 
»¶y
->proto;

2196 *
p
 = 
	`¡rchr
(
´Ùo
+1,'\r');

2197 
¬¿yËn
, 
j
;

2199 
	`¡ršg2Î
(
´Ùo
+1,
p
-´Ùo-1,&
¬¿yËn
);

2200 
p
 += 2;

2202 ià(
¬¿yËn
 == -1) {

2203 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
;

2204 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_NULL
;

2208 
»¶y
->
v®
.
¬¿y
 = 
	`zm®loc
((
RedisModuËC®lR•ly
)*
¬¿yËn
);

2209 
»¶y
->
Ën
 = 
¬¿yËn
;

2210 
j
 = 0; j < 
¬¿yËn
; j++) {

2211 
RedisModuËC®lR•ly
 *
–e
 = 
»¶y
->
v®
.
¬¿y
+
j
;

2212 
–e
->
æags
 = 
REDISMODULE_REPLYFLAG_NESTED
 |

2213 
REDISMODULE_REPLYFLAG_TOPARSE
;

2214 
–e
->
´Ùo
 = 
p
;

2215 
–e
->
ùx
 = 
»¶y
->ctx;

2216 
	`moduËP¬£C®lR•ly
(
–e
);

2217 
p
 +ğ
–e
->
´ÙŞ’
;

2219 
»¶y
->
´ÙŞ’
 = 
p
-
´Ùo
;

2220 
»¶y
->
ty³
 = 
REDISMODULE_REPLY_ARRAY
;

2221 
	}
}

2225 
	$RM_F»eC®lR•ly_Rec
(
RedisModuËC®lR•ly
 *
»¶y
, 
ä“Ã¡ed
){

2229 ià(!
ä“Ã¡ed
 && 
»¶y
->
æags
 & 
REDISMODULE_REPLYFLAG_NESTED
) ;

2231 ià(!(
»¶y
->
æags
 & 
REDISMODULE_REPLYFLAG_TOPARSE
)) {

2232 ià(
»¶y
->
ty³
 =ğ
REDISMODULE_REPLY_ARRAY
) {

2233 
size_t
 
j
;

2234 
j
 = 0; j < 
»¶y
->
Ën
; j++)

2235 
	`RM_F»eC®lR•ly_Rec
(
»¶y
->
v®
.
¬¿y
+
j
,1);

2236 
	`zä“
(
»¶y
->
v®
.
¬¿y
);

2244 ià(!(
»¶y
->
æags
 & 
REDISMODULE_REPLYFLAG_NESTED
)) {

2245 ià(
»¶y
->
´Ùo
è
	`sdsä“
(reply->proto);

2246 
	`zä“
(
»¶y
);

2248 
	}
}

2253 
	$RM_F»eC®lR•ly
(
RedisModuËC®lR•ly
 *
»¶y
) {

2254 
	`RM_F»eC®lR•ly_Rec
(
»¶y
,0);

2255 
	`autoMemÜyF»ed
(
»¶y
->
ùx
,
REDISMODULE_AM_REPLY
,reply);

2256 
	}
}

2259 
	$RM_C®lR•lyTy³
(
RedisModuËC®lR•ly
 *
»¶y
) {

2260 ià(!
»¶y
è 
REDISMODULE_REPLY_UNKNOWN
;

2261  
»¶y
->
ty³
;

2262 
	}
}

2265 
size_t
 
	$RM_C®lR•lyL’gth
(
RedisModuËC®lR•ly
 *
»¶y
) {

2266 
	`moduËP¬£C®lR•ly
(
»¶y
);

2267 
»¶y
->
ty³
) {

2268 
REDISMODULE_REPLY_STRING
:

2269 
REDISMODULE_REPLY_ERROR
:

2270 
REDISMODULE_REPLY_ARRAY
:

2271  
»¶y
->
Ën
;

2275 
	}
}

2279 
RedisModuËC®lR•ly
 *
	$RM_C®lR•lyA¼ayEËm’t
(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 
idx
) {

2280 
	`moduËP¬£C®lR•ly
(
»¶y
);

2281 ià(
»¶y
->
ty³
 !ğ
REDISMODULE_REPLY_ARRAY
è 
NULL
;

2282 ià(
idx
 >ğ
»¶y
->
Ën
è 
NULL
;

2283  
»¶y
->
v®
.
¬¿y
+
idx
;

2284 
	}
}

2287 
	$RM_C®lR•lyIÁeg”
(
RedisModuËC®lR•ly
 *
»¶y
) {

2288 
	`moduËP¬£C®lR•ly
(
»¶y
);

2289 ià(
»¶y
->
ty³
 !ğ
REDISMODULE_REPLY_INTEGER
è 
LLONG_MIN
;

2290  
»¶y
->
v®
.
Î
;

2291 
	}
}

2294 cÚ¡ *
	$RM_C®lR•lySŒšgPŒ
(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 *
Ën
) {

2295 
	`moduËP¬£C®lR•ly
(
»¶y
);

2296 ià(
»¶y
->
ty³
 !ğ
REDISMODULE_REPLY_STRING
 &&

2297 
»¶y
->
ty³
 !ğ
REDISMODULE_REPLY_ERROR
è 
NULL
;

2298 ià(
Ën
è*ËÀğ
»¶y
->len;

2299  
»¶y
->
v®
.
¡r
;

2300 
	}
}

2304 
RedisModuËSŒšg
 *
	$RM_C»©eSŒšgFromC®lR•ly
(
RedisModuËC®lR•ly
 *
»¶y
) {

2305 
	`moduËP¬£C®lR•ly
(
»¶y
);

2306 
»¶y
->
ty³
) {

2307 
REDISMODULE_REPLY_STRING
:

2308 
REDISMODULE_REPLY_ERROR
:

2309  
	`RM_C»©eSŒšg
(
»¶y
->
ùx
,»¶y->
v®
.
¡r
,»¶y->
Ën
);

2310 
REDISMODULE_REPLY_INTEGER
: {

2311 
buf
[64];

2312 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),
»¶y
->
v®
.
Î
);

2313  
	`RM_C»©eSŒšg
(
»¶y
->
ùx
,
buf
,
Ën
);

2315 :  
NULL
;

2317 
	}
}

2331 
	#REDISMODULE_ARGV_REPLICATE
 (1<<0)

	)

2333 
robj
 **
	$moduËC»©eArgvFromU£rFÜm©
(cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, *
¬gı
, *
æags
, 
va_li¡
 
­
) {

2334 
¬gc
 = 0, 
¬gv_size
, 
j
;

2335 
robj
 **
¬gv
 = 
NULL
;

2339 
¬gv_size
 = 
	`¡¾’
(
fmt
)+1;

2340 
¬gv
 = 
	`z»®loc
×rgv,(
robj
*)*
¬gv_size
);

2343 
¬gv
[0] = 
	`ü—‹SŒšgObjeù
(
cmdÇme
,
	`¡¾’
(cmdname));

2344 
¬gc
++;

2347 cÚ¡ *
p
 = 
fmt
;

2348 *
p
) {

2349 ià(*
p
 == 'c') {

2350 *
c¡r
 = 
	`va_¬g
(
­
,*);

2351 
¬gv
[
¬gc
++] = 
	`ü—‹SŒšgObjeù
(
c¡r
,
	`¡¾’
(cstr));

2352 } ià(*
p
 == 's') {

2353 
robj
 *
obj
 = 
	`va_¬g
(
­
,*);

2354 
¬gv
[
¬gc
++] = 
obj
;

2355 
	`šüRefCouÁ
(
obj
);

2356 } ià(*
p
 == 'b') {

2357 *
buf
 = 
	`va_¬g
(
­
,*);

2358 
size_t
 
Ën
 = 
	`va_¬g
(
­
,size_t);

2359 
¬gv
[
¬gc
++] = 
	`ü—‹SŒšgObjeù
(
buf
,
Ën
);

2360 } ià(*
p
 == 'l') {

2361 
Î
 = 
	`va_¬g
(
­
,);

2362 
¬gv
[
¬gc
++] = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î
);

2363 } ià(*
p
 == 'v') {

2365 
robj
 **
v
 = 
	`va_¬g
(
­
, *);

2366 
size_t
 
vËn
 = 
	`va_¬g
(
­
, size_t);

2371 
¬gv_size
 +ğ
vËn
-1;

2372 
¬gv
 = 
	`z»®loc
×rgv,(
robj
*)*
¬gv_size
);

2374 
size_t
 
i
 = 0;

2375 
i
 = 0; i < 
vËn
; i++) {

2376 
	`šüRefCouÁ
(
v
[
i
]);

2377 
¬gv
[
¬gc
++] = 
v
[
i
];

2379 } ià(*
p
 == '!') {

2380 ià(
æags
è(*æagsè|ğ
REDISMODULE_ARGV_REPLICATE
;

2382 
fm‹¼
;

2384 
p
++;

2386 *
¬gı
 = 
¬gc
;

2387  
¬gv
;

2389 
fm‹¼
:

2390 
j
 = 0; j < 
¬gc
; j++)

2391 
	`deüRefCouÁ
(
¬gv
[
j
]);

2392 
	`zä“
(
¬gv
);

2393  
NULL
;

2394 
	}
}

2402 
RedisModuËC®lR•ly
 *
	$RM_C®l
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...) {

2403 
»disCommªd
 *
cmd
;

2404 
ş›Á
 *
c
 = 
NULL
;

2405 
robj
 **
¬gv
 = 
NULL
;

2406 
¬gc
 = 0, 
æags
 = 0;

2407 
va_li¡
 
­
;

2408 
RedisModuËC®lR•ly
 *
»¶y
 = 
NULL
;

2409 
»¶iÿ‹
 = 0;

2411 
cmd
 = 
	`lookupCommªdByCSŒšg
((*)
cmdÇme
);

2412 ià(!
cmd
) {

2413 
”ºo
 = 
EINVAL
;

2414  
NULL
;

2418 
	`va_¡¬t
(
­
, 
fmt
);

2419 
c
 = 
	`ü—‹Cl›Á
(-1);

2420 
¬gv
 = 
	`moduËC»©eArgvFromU£rFÜm©
(
cmdÇme
,
fmt
,&
¬gc
,&
æags
,
­
);

2421 
»¶iÿ‹
 = 
æags
 & 
REDISMODULE_ARGV_REPLICATE
;

2422 
	`va_’d
(
­
);

2425 
c
->
æags
 |ğ
CLIENT_MODULE
;

2426 
c
->
¬gv
 =‡rgv;

2427 
c
->
¬gc
 =‡rgc;

2428 
c
->
cmd
 = c->
Ï¡cmd
 = cmd;

2431 ià(
¬gv
 =ğ
NULL
è
ş—nup
;

2434 ià((
cmd
->
¬™y
 > 0 && cmd->¬™y !ğ
¬gc
) || (argc < -cmd->arity)) {

2435 
”ºo
 = 
EINVAL
;

2436 
ş—nup
;

2442 ià(
£rv”
.
şu¡”_’abËd
 && !(
ùx
->
ş›Á
->
æags
 & 
CLIENT_MASTER
)) {

2444 
c
->
æags
 &ğ~(
CLIENT_READONLY
|
CLIENT_ASKING
);

2445 
c
->
æags
 |ğ
ùx
->
ş›Á
->æag & (
CLIENT_READONLY
|
CLIENT_ASKING
);

2446 ià(
	`g‘NodeByQu”y
(
c
,c->
cmd
,c->
¬gv
,c->
¬gc
,
NULL
,NULL) !=

2447 
£rv”
.
şu¡”
->
my£lf
)

2449 
”ºo
 = 
EPERM
;

2450 
ş—nup
;

2457 ià(
»¶iÿ‹
è
	`moduËR•liÿ‹MuÉiIfN“ded
(
ùx
);

2460 
ÿÎ_æags
 = 
CMD_CALL_SLOWLOG
 | 
CMD_CALL_STATS
;

2461 ià(
»¶iÿ‹
) {

2462 
ÿÎ_æags
 |ğ
CMD_CALL_PROPAGATE_AOF
;

2463 
ÿÎ_æags
 |ğ
CMD_CALL_PROPAGATE_REPL
;

2465 
	`ÿÎ
(
c
,
ÿÎ_æags
);

2470 
sds
 
´Ùo
 = 
	`sd¢ewËn
(
c
->
buf
,c->
buåos
);

2471 
c
->
buåos
 = 0;

2472 
	`li¡L’gth
(
c
->
»¶y
)) {

2473 
sds
 
o
 = 
	`li¡NodeV®ue
(
	`li¡Fœ¡
(
c
->
»¶y
));

2475 
´Ùo
 = 
	`sdsÿtsds
ÕrÙo,
o
);

2476 
	`li¡D–Node
(
c
->
»¶y
,
	`li¡Fœ¡
(c->reply));

2478 
»¶y
 = 
	`moduËC»©eC®lR•lyFromPrÙo
(
ùx
,
´Ùo
);

2479 
	`autoMemÜyAdd
(
ùx
,
REDISMODULE_AM_REPLY
,
»¶y
);

2481 
ş—nup
:

2482 
	`ä“Cl›Á
(
c
);

2483  
»¶y
;

2484 
	}
}

2488 cÚ¡ *
	$RM_C®lR•lyPrÙo
(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 *
Ën
) {

2489 ià(
»¶y
->
´Ùo
è*
Ën
 = 
	`sd¦’
(reply->proto);

2490  
»¶y
->
´Ùo
;

2491 
	}
}

2526 cÚ¡ *
	gModuËTy³NameCh¬S‘
 =

2531 
ušt64_t
 
	$moduËTy³EncodeId
(cÚ¡ *
Çme
, 
’cv”
) {

2534 cÚ¡ *
c£t
 = 
ModuËTy³NameCh¬S‘
;

2535 ià(
	`¡¾’
(
Çme
) != 9)  0;

2536 ià(
’cv”
 < 0 ||ƒncver > 1023)  0;

2538 
ušt64_t
 
id
 = 0;

2539 
j
 = 0; j < 9; j++) {

2540 *
p
 = 
	`¡rchr
(
c£t
,
Çme
[
j
]);

2541 ià(!
p
)  0;

2542 
pos
 = 
p
-
c£t
;

2543 
id
 = (id << 6è| 
pos
;

2545 
id
 = (id << 10è| 
’cv”
;

2546  
id
;

2547 
	}
}

2552 
moduËTy³
 *
	$moduËTy³LookupModuËByName
(cÚ¡ *
Çme
) {

2553 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
moduËs
);

2554 
diùEÁry
 *
de
;

2556 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2557 
RedisModuË
 *
moduË
 = 
	`diùG‘V®
(
de
);

2558 
li¡I‹r
 
li
;

2559 
li¡Node
 *
Ê
;

2561 
	`li¡Rewšd
(
moduË
->
ty³s
,&
li
);

2562 (
Ê
 = 
	`li¡Next
(&
li
))) {

2563 
moduËTy³
 *
mt
 = 
Ê
->
v®ue
;

2564 ià(
	`memcmp
(
Çme
,
mt
->name,(mt->name)) == 0) {

2565 
	`diùR–—£I‹¿tÜ
(
di
);

2566  
mt
;

2570 
	`diùR–—£I‹¿tÜ
(
di
);

2571  
NULL
;

2572 
	}
}

2577 
	#MODULE_LOOKUP_CACHE_SIZE
 3

	)

2579 
moduËTy³
 *
	$moduËTy³LookupModuËByID
(
ušt64_t
 
id
) {

2581 
ušt64_t
 
id
;

2582 
moduËTy³
 *
mt
;

2583 } 
ÿche
[
MODULE_LOOKUP_CACHE_SIZE
];

2586 
j
;

2587 
j
 = 0; j < 
MODULE_LOOKUP_CACHE_SIZE
; j++)

2588 ià(
ÿche
[
j
].
id
 =ğidè cache[j].
mt
;

2591 
moduËTy³
 *
mt
 = 
NULL
;

2592 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
moduËs
);

2593 
diùEÁry
 *
de
;

2595 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2596 
RedisModuË
 *
moduË
 = 
	`diùG‘V®
(
de
);

2597 
li¡I‹r
 
li
;

2598 
li¡Node
 *
Ê
;

2600 
	`li¡Rewšd
(
moduË
->
ty³s
,&
li
);

2601 (
Ê
 = 
	`li¡Next
(&
li
))) {

2602 
mt
 = 
Ê
->
v®ue
;

2605 ià(
mt
->
id
 >> 10 == id >> 10) ;

2608 
	`diùR–—£I‹¿tÜ
(
di
);

2611 ià(
mt
 && 
j
 < 
MODULE_LOOKUP_CACHE_SIZE
) {

2612 
ÿche
[
j
].
id
 = id;

2613 
ÿche
[
j
].
mt
 = mt;

2615  
mt
;

2616 
	}
}

2620 
	$moduËTy³NameByID
(*
Çme
, 
ušt64_t
 
moduËid
) {

2621 cÚ¡ *
c£t
 = 
ModuËTy³NameCh¬S‘
;

2623 
Çme
[0] = '\0';

2624 *
p
 = 
Çme
+8;

2625 
moduËid
 >>= 10;

2626 
j
 = 0; j < 9; j++) {

2627 *
p
-- = 
c£t
[
moduËid
 & 63];

2628 
moduËid
 >>= 6;

2630 
	}
}

2677 
moduËTy³
 *
	$RM_C»©eD©aTy³
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
’cv”
, 
moduËTy³LßdFunc
 
rdb_lßd
, 
moduËTy³SaveFunc
 
rdb_§ve
, 
moduËTy³Rewr™eFunc
 
aof_»wr™e
, 
moduËTy³Dige¡Func
 
dige¡
, 
moduËTy³F»eFunc
 
ä“
) {

2678 
ušt64_t
 
id
 = 
	`moduËTy³EncodeId
(
Çme
,
’cv”
);

2679 ià(
id
 =ğ0è 
NULL
;

2680 ià(
	`moduËTy³LookupModuËByName
(
Çme
è!ğ
NULL
)  NULL;

2682 
moduËTy³
 *
mt
 = 
	`zm®loc
((*mt));

2683 
mt
->
id
 = id;

2684 
mt
->
moduË
 = 
ùx
->module;

2685 
mt
->
rdb_lßd
 =„db_load;

2686 
mt
->
rdb_§ve
 =„db_save;

2687 
mt
->
aof_»wr™e
 =‡of_rewrite;

2688 
mt
->
dige¡
 = digest;

2689 
mt
->
ä“
 = free;

2690 
	`memıy
(
mt
->
Çme
,name,(mt->name));

2691 
	`li¡AddNodeTa
(
ùx
->
moduË
->
ty³s
,
mt
);

2692  
mt
;

2693 
	}
}

2699 
	$RM_ModuËTy³S‘V®ue
(
RedisModuËKey
 *
key
, 
moduËTy³
 *
mt
, *
v®ue
) {

2700 ià(!(
key
->
mode
 & 
REDISMODULE_WRITE
è|| key->
™”
è 
REDISMODULE_ERR
;

2701 
	`RM_D–‘eKey
(
key
);

2702 
robj
 *
o
 = 
	`ü—‹ModuËObjeù
(
mt
,
v®ue
);

2703 
	`£tKey
(
key
->
db
,key->key,
o
);

2704 
	`deüRefCouÁ
(
o
);

2705 
key
->
v®ue
 = 
o
;

2706  
REDISMODULE_OK
;

2707 
	}
}

2714 
moduËTy³
 *
	$RM_ModuËTy³G‘Ty³
(
RedisModuËKey
 *
key
) {

2715 ià(
key
 =ğ
NULL
 ||

2716 
key
->
v®ue
 =ğ
NULL
 ||

2717 
	`RM_KeyTy³
(
key
è!ğ
REDISMODULE_KEYTYPE_MODULE
è 
NULL
;

2718 
moduËV®ue
 *
mv
 = 
key
->
v®ue
->
±r
;

2719  
mv
->
ty³
;

2720 
	}
}

2728 *
	$RM_ModuËTy³G‘V®ue
(
RedisModuËKey
 *
key
) {

2729 ià(
key
 =ğ
NULL
 ||

2730 
key
->
v®ue
 =ğ
NULL
 ||

2731 
	`RM_KeyTy³
(
key
è!ğ
REDISMODULE_KEYTYPE_MODULE
è 
NULL
;

2732 
moduËV®ue
 *
mv
 = 
key
->
v®ue
->
±r
;

2733  
mv
->
v®ue
;

2734 
	}
}

2742 
	$moduËRDBLßdE¼Ü
(
RedisModuËIO
 *
io
) {

2743 
	`£rv”Log
(
LL_WARNING
,

2747 
io
->
ty³
->
moduË
->
Çme
,

2748 
io
->
ty³
->
Çme
,

2749 ()
io
->
by‹s
);

2750 
	`ex™
(1);

2751 
	}
}

2756 
	$RM_SaveUnsigÃd
(
RedisModuËIO
 *
io
, 
ušt64_t
 
v®ue
) {

2757 ià(
io
->
”rÜ
) ;

2758 
»tv®
 = 
	`rdbSaveL’
(
io
->
rio
, 
v®ue
);

2759 ià(
»tv®
 == -1) {

2760 
io
->
”rÜ
 = 1;

2762 
io
->
by‹s
 +ğ
»tv®
;

2764 
	}
}

2769 
ušt64_t
 
	$RM_LßdUnsigÃd
(
RedisModuËIO
 *
io
) {

2770 
ušt64_t
 
v®ue
;

2771 
»tv®
 = 
	`rdbLßdL’ByRef
(
io
->
rio
, 
NULL
, &
v®ue
);

2772 ià(
»tv®
 == -1) {

2773 
	`moduËRDBLßdE¼Ü
(
io
);

2776  
v®ue
;

2777 
	}
}

2780 
	$RM_SaveSigÃd
(
RedisModuËIO
 *
io
, 
št64_t
 
v®ue
) {

2781 uniÚ {
ušt64_t
 
u
; 
št64_t
 
i
;} 
cÚv
;

2782 
cÚv
.
i
 = 
v®ue
;

2783 
	`RM_SaveUnsigÃd
(
io
,
cÚv
.
u
);

2784 
	}
}

2787 
št64_t
 
	$RM_LßdSigÃd
(
RedisModuËIO
 *
io
) {

2788 uniÚ {
ušt64_t
 
u
; 
št64_t
 
i
;} 
cÚv
;

2789 
cÚv
.
u
 = 
	`RM_LßdUnsigÃd
(
io
);

2790  
cÚv
.
i
;

2791 
	}
}

2799 
	$RM_SaveSŒšg
(
RedisModuËIO
 *
io
, 
RedisModuËSŒšg
 *
s
) {

2800 ià(
io
->
”rÜ
) ;

2801 
»tv®
 = 
	`rdbSaveSŒšgObjeù
(
io
->
rio
,
s
);

2802 ià(
»tv®
 == -1) {

2803 
io
->
”rÜ
 = 1;

2805 
io
->
by‹s
 +ğ
»tv®
;

2807 
	}
}

2811 
	$RM_SaveSŒšgBufãr
(
RedisModuËIO
 *
io
, cÚ¡ *
¡r
, 
size_t
 
Ën
) {

2812 ià(
io
->
”rÜ
) ;

2813 
»tv®
 = 
	`rdbSaveRawSŒšg
(
io
->
rio
,(*)
¡r
,
Ën
);

2814 ià(
»tv®
 == -1) {

2815 
io
->
”rÜ
 = 1;

2817 
io
->
by‹s
 +ğ
»tv®
;

2819 
	}
}

2822 *
	$moduËLßdSŒšg
(
RedisModuËIO
 *
io
, 
¶aš
, 
size_t
 *
ËÅŒ
) {

2823 *
s
 = 
	`rdbG’”icLßdSŒšgObjeù
(
io
->
rio
,

2824 
¶aš
 ? 
RDB_LOAD_PLAIN
 : 
RDB_LOAD_NONE
, 
ËÅŒ
);

2825 ià(
s
 =ğ
NULL
) {

2826 
	`moduËRDBLßdE¼Ü
(
io
);

2827  
NULL
;

2829  
s
;

2830 
	}
}

2841 
RedisModuËSŒšg
 *
	$RM_LßdSŒšg
(
RedisModuËIO
 *
io
) {

2842  
	`moduËLßdSŒšg
(
io
,0,
NULL
);

2843 
	}
}

2852 *
	$RM_LßdSŒšgBufãr
(
RedisModuËIO
 *
io
, 
size_t
 *
ËÅŒ
) {

2853  
	`moduËLßdSŒšg
(
io
,1,
ËÅŒ
);

2854 
	}
}

2859 
	$RM_SaveDoubË
(
RedisModuËIO
 *
io
, 
v®ue
) {

2860 ià(
io
->
”rÜ
) ;

2861 
»tv®
 = 
	`rdbSaveBš¬yDoubËV®ue
(
io
->
rio
, 
v®ue
);

2862 ià(
»tv®
 == -1) {

2863 
io
->
”rÜ
 = 1;

2865 
io
->
by‹s
 +ğ
»tv®
;

2867 
	}
}

2871 
	$RM_LßdDoubË
(
RedisModuËIO
 *
io
) {

2872 
v®ue
;

2873 
»tv®
 = 
	`rdbLßdBš¬yDoubËV®ue
(
io
->
rio
, &
v®ue
);

2874 ià(
»tv®
 == -1) {

2875 
	`moduËRDBLßdE¼Ü
(
io
);

2878  
v®ue
;

2879 
	}
}

2884 
	$RM_SaveFlßt
(
RedisModuËIO
 *
io
, 
v®ue
) {

2885 ià(
io
->
”rÜ
) ;

2886 
»tv®
 = 
	`rdbSaveBš¬yFlßtV®ue
(
io
->
rio
, 
v®ue
);

2887 ià(
»tv®
 == -1) {

2888 
io
->
”rÜ
 = 1;

2890 
io
->
by‹s
 +ğ
»tv®
;

2892 
	}
}

2896 
	$RM_LßdFlßt
(
RedisModuËIO
 *
io
) {

2897 
v®ue
;

2898 
»tv®
 = 
	`rdbLßdBš¬yFlßtV®ue
(
io
->
rio
, &
v®ue
);

2899 ià(
»tv®
 == -1) {

2900 
	`moduËRDBLßdE¼Ü
(
io
);

2903  
v®ue
;

2904 
	}
}

2915 
	$RM_Em™AOF
(
RedisModuËIO
 *
io
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...) {

2916 ià(
io
->
”rÜ
) ;

2917 
»disCommªd
 *
cmd
;

2918 
robj
 **
¬gv
 = 
NULL
;

2919 
¬gc
 = 0, 
æags
 = 0, 
j
;

2920 
va_li¡
 
­
;

2922 
cmd
 = 
	`lookupCommªdByCSŒšg
((*)
cmdÇme
);

2923 ià(!
cmd
) {

2924 
	`£rv”Log
(
LL_WARNING
,

2927 
io
->
ty³
->
Çme
, 
cmdÇme
);

2928 
io
->
”rÜ
 = 1;

2929 
”ºo
 = 
EINVAL
;

2934 
	`va_¡¬t
(
­
, 
fmt
);

2935 
¬gv
 = 
	`moduËC»©eArgvFromU£rFÜm©
(
cmdÇme
,
fmt
,&
¬gc
,&
æags
,
­
);

2936 
	`va_’d
(
­
);

2937 ià(
¬gv
 =ğ
NULL
) {

2938 
	`£rv”Log
(
LL_WARNING
,

2941 
io
->
ty³
->
Çme
, 
fmt
);

2942 
io
->
”rÜ
 = 1;

2943 
”ºo
 = 
EINVAL
;

2948 ià(!
io
->
”rÜ
 && 
	`rioWr™eBulkCouÁ
(io->
rio
,'*',
¬gc
) == 0)

2949 
io
->
”rÜ
 = 1;

2952 
j
 = 0; j < 
¬gc
; j++) {

2953 ià(!
io
->
”rÜ
 && 
	`rioWr™eBulkObjeù
(io->
rio
,
¬gv
[
j
]) == 0)

2954 
io
->
”rÜ
 = 1;

2955 
	`deüRefCouÁ
(
¬gv
[
j
]);

2957 
	`zä“
(
¬gv
);

2959 
	}
}

2965 
RedisModuËCtx
 *
	$RM_G‘CÚ‹xtFromIO
(
RedisModuËIO
 *
io
) {

2966 ià(
io
->
ùx
)  io->ctx;

2967 
RedisModuËCtx
 
ùx‹m¶©e
 = 
REDISMODULE_CTX_INIT
;

2968 
io
->
ùx
 = 
	`zm®loc
((*io));

2969 *(
io
->
ùx
èğ
ùx‹m¶©e
;

2970 
io
->
ùx
->
moduË
 = io->
ty³
->module;

2971 
io
->
ùx
->
ş›Á
 = 
NULL
;

2972  
io
->
ùx
;

2973 
	}
}

2985 
	$RM_LogRaw
(
RedisModuË
 *
moduË
, cÚ¡ *
Ëv–¡r
, cÚ¡ *
fmt
, 
va_li¡
 
­
) {

2986 
msg
[
LOG_MAX_LEN
];

2987 
size_t
 
Çme_Ën
;

2988 
Ëv–
;

2990 ià(!
	`¡rÿ£cmp
(
Ëv–¡r
,"debug")è
Ëv–
 = 
LL_DEBUG
;

2991 ià(!
	`¡rÿ£cmp
(
Ëv–¡r
,"v”bo£")è
Ëv–
 = 
LL_VERBOSE
;

2992 ià(!
	`¡rÿ£cmp
(
Ëv–¡r
,"nÙiû")è
Ëv–
 = 
LL_NOTICE
;

2993 ià(!
	`¡rÿ£cmp
(
Ëv–¡r
,"w¬nšg")è
Ëv–
 = 
LL_WARNING
;

2994 
Ëv–
 = 
LL_VERBOSE
;

2996 
Çme_Ën
 = 
	`¢´štf
(
msg
, (msg),"<%s> ", 
moduË
->
Çme
);

2997 
	`v¢´štf
(
msg
 + 
Çme_Ën
, (msgè-‚ame_Ën, 
fmt
, 
­
);

2998 
	`£rv”LogRaw
(
Ëv–
,
msg
);

2999 
	}
}

3016 
	$RM_Log
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Ëv–¡r
, cÚ¡ *
fmt
, ...) {

3017 ià(!
ùx
->
moduË
) ;

3019 
va_li¡
 
­
;

3020 
	`va_¡¬t
(
­
, 
fmt
);

3021 
	`RM_LogRaw
(
ùx
->
moduË
,
Ëv–¡r
,
fmt
,
­
);

3022 
	`va_’d
(
­
);

3023 
	}
}

3030 
	$RM_LogIOE¼Ü
(
RedisModuËIO
 *
io
, cÚ¡ *
Ëv–¡r
, cÚ¡ *
fmt
, ...) {

3031 
va_li¡
 
­
;

3032 
	`va_¡¬t
(
­
, 
fmt
);

3033 
	`RM_LogRaw
(
io
->
ty³
->
moduË
,
Ëv–¡r
,
fmt
,
­
);

3034 
	`va_’d
(
­
);

3035 
	}
}

3044 
	$diùCSŒšgKeyHash
(cÚ¡ *
key
) {

3045  
	`diùG’HashFunùiÚ
((*)
key
, 
	`¡¾’
((*)key));

3046 
	}
}

3048 
	$diùCSŒšgKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
) {

3049 
	`DICT_NOTUSED
(
´ivd©a
);

3050  
	`¡rcmp
(
key1
,
key2
) == 0;

3051 
	}
}

3053 
diùTy³
 
	gmoduËAPIDiùTy³
 = {

3054 
diùCSŒšgKeyHash
,

3055 
NULL
,

3056 
NULL
,

3057 
diùCSŒšgKeyCom·»
,

3058 
NULL
,

3059 
NULL


3062 
	$moduËRegi¡”Api
(cÚ¡ *
funúame
, *
funıŒ
) {

3063  
	`diùAdd
(
£rv”
.
moduË­i
, (*)
funúame
, 
funıŒ
);

3064 
	}
}

3066 
	#REGISTER_API
(
Çme
) \

3067 
	`moduËRegi¡”Api
("RedisModuË_" #Çme, (*)()
RM_
 ## 
Çme
)

	)

3070 
moduËRegi¡”CÜeAPI
();

3072 
	$moduËIn™ModuËsSy¡em
() {

3073 
£rv”
.
lßdmoduË_queue
 = 
	`li¡C»©e
();

3074 
moduËs
 = 
	`diùC»©e
(&
moduËsDiùTy³
,
NULL
);

3075 
	`moduËRegi¡”CÜeAPI
();

3076 
	}
}

3087 
	$moduËLßdFromQueue
() {

3088 
li¡I‹r
 
li
;

3089 
li¡Node
 *
Ê
;

3091 
	`li¡Rewšd
(
£rv”
.
lßdmoduË_queue
,&
li
);

3092 (
Ê
 = 
	`li¡Next
(&
li
))) {

3093 
moduËLßdQueueEÁry
 *
lßdmod
 = 
Ê
->
v®ue
;

3094 ià(
	`moduËLßd
(
lßdmod
->
·th
,(**îßdmod->
¬gv
,lßdmod->
¬gc
)

3095 =ğ
C_ERR
)

3097 
	`£rv”Log
(
LL_WARNING
,

3099 
lßdmod
->
·th
);

3100 
	`ex™
(1);

3103 
	}
}

3105 
	$moduËF»eModuËSŒuùu»
(
RedisModuË
 *
moduË
) {

3106 
	`li¡R–—£
(
moduË
->
ty³s
);

3107 
	`sdsä“
(
moduË
->
Çme
);

3108 
	`zä“
(
moduË
);

3109 
	}
}

3113 
	$moduËLßd
(cÚ¡ *
·th
, **
moduË_¬gv
, 
moduË_¬gc
) {

3114 (*
Úlßd
)(*, **, );

3115 *
hªdË
;

3116 
RedisModuËCtx
 
ùx
 = 
REDISMODULE_CTX_INIT
;

3118 
hªdË
 = 
	`dlİ’
(
·th
,
RTLD_NOW
|
RTLD_LOCAL
);

3119 ià(
hªdË
 =ğ
NULL
) {

3120 
	`£rv”Log
(
LL_WARNING
, "ModuË % çedØlßd: %s", 
·th
, 
	`dË¼Ü
());

3121  
C_ERR
;

3123 
Úlßd
 = ((*)(*, **, ))(è
	`dlsym
(
hªdË
,"RedisModule_OnLoad");

3124 ià(
Úlßd
 =ğ
NULL
) {

3125 
	`£rv”Log
(
LL_WARNING
,

3127 "symbŞ. ModuË‚Ù†ßded.",
·th
);

3128  
C_ERR
;

3130 ià(
	`Úlßd
((*)&
ùx
,
moduË_¬gv
,
moduË_¬gc
è=ğ
REDISMODULE_ERR
) {

3131 ià(
ùx
.
moduË
è
	`moduËF»eModuËSŒuùu»
(ctx.module);

3132 
	`dlşo£
(
hªdË
);

3133 
	`£rv”Log
(
LL_WARNING
,

3134 "ModuË % š™Ÿliz©iÚ faed. ModuË‚Ù†ßded",
·th
);

3135  
C_ERR
;

3139 
	`diùAdd
(
moduËs
,
ùx
.
moduË
->
Çme
,ctx.module);

3140 
ùx
.
moduË
->
hªdË
 = handle;

3141 
	`£rv”Log
(
LL_NOTICE
,"ModuË '%s'†ßded from %s",
ùx
.
moduË
->
Çme
,
·th
);

3142 
	`moduËF»eCÚ‹xt
(&
ùx
);

3143  
C_OK
;

3144 
	}
}

3152 
	$moduËUÆßd
(
sds
 
Çme
) {

3153 
RedisModuË
 *
moduË
 = 
	`diùF‘chV®ue
(
moduËs
,
Çme
);

3155 ià(
moduË
 =ğ
NULL
) {

3156 
”ºo
 = 
ENOENT
;

3157  
REDISMODULE_ERR
;

3160 ià(
	`li¡L’gth
(
moduË
->
ty³s
)) {

3161 
”ºo
 = 
EBUSY
;

3162  
REDISMODULE_ERR
;

3166 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘SaãI‹¿tÜ
(
£rv”
.
commªds
);

3167 
diùEÁry
 *
de
;

3168 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3169 
»disCommªd
 *
cmd
 = 
	`diùG‘V®
(
de
);

3170 ià(
cmd
->
´oc
 =ğ
RedisModuËCommªdDi¥©ch”
) {

3171 
RedisModuËCommªdProxy
 *
ı
 =

3172 (*)()
cmd
->
g‘keys_´oc
;

3173 
sds
 
cmdÇme
 = 
ı
->
»discmd
->
Çme
;

3174 ià(
ı
->
moduË
 == module) {

3175 
	`diùD–‘e
(
£rv”
.
commªds
,
cmdÇme
);

3176 
	`diùD–‘e
(
£rv”
.
Üig_commªds
,
cmdÇme
);

3177 
	`sdsä“
(
cmdÇme
);

3178 
	`zä“
(
ı
->
»discmd
);

3179 
	`zä“
(
ı
);

3183 
	`diùR–—£I‹¿tÜ
(
di
);

3188 ià(
	`dlşo£
(
moduË
->
hªdË
) == -1) {

3189 *
”rÜ
 = 
	`dË¼Ü
();

3190 ià(
”rÜ
 =ğ
NULL
)ƒrror = "Unknownƒrror";

3191 
	`£rv”Log
(
LL_WARNING
,"Error whenryingo closehe %s module: %s",

3192 
moduË
->
Çme
, 
”rÜ
);

3196 
	`£rv”Log
(
LL_NOTICE
,"ModuË % uÆßded",
moduË
->
Çme
);

3197 
	`diùD–‘e
(
moduËs
,
moduË
->
Çme
);

3198 
moduË
->
Çme
 = 
NULL
;

3199 
	`moduËF»eModuËSŒuùu»
(
moduË
);

3201  
REDISMODULE_OK
;

3202 
	}
}

3207 
	$moduËCommªd
(
ş›Á
 *
c
) {

3208 *
subcmd
 = 
c
->
¬gv
[1]->
±r
;

3210 ià(!
	`¡rÿ£cmp
(
subcmd
,"lßd"è&& 
c
->
¬gc
 >= 3) {

3211 
robj
 **
¬gv
 = 
NULL
;

3212 
¬gc
 = 0;

3214 ià(
c
->
¬gc
 > 3) {

3215 
¬gc
 = 
c
->argc - 3;

3216 
¬gv
 = &
c
->argv[3];

3219 ià(
	`moduËLßd
(
c
->
¬gv
[2]->
±r
,(**ïrgv,
¬gc
è=ğ
C_OK
)

3220 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3222 
	`addR•lyE¼Ü
(
c
,

3224 } ià(!
	`¡rÿ£cmp
(
subcmd
,"uÆßd"è&& 
c
->
¬gc
 == 3) {

3225 ià(
	`moduËUÆßd
(
c
->
¬gv
[2]->
±r
è=ğ
C_OK
)

3226 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3228 *
”rmsg
;

3229 
”ºo
) {

3230 
ENOENT
:

3231 
”rmsg
 = "no such module withhat‚ame";

3233 
EBUSY
:

3234 
”rmsg
 = "the moduleƒxports one or more module-side dataypes, can't unload";

3237 
”rmsg
 = "operation‚ot…ossible.";

3240 
	`addR•lyE¼ÜFÜm©
(
c
,"E¼Ü uÆßdšg moduË: %s",
”rmsg
);

3242 } ià(!
	`¡rÿ£cmp
(
subcmd
,"li¡"è&& 
c
->
¬gc
 == 2) {

3243 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
moduËs
);

3244 
diùEÁry
 *
de
;

3246 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
moduËs
));

3247 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3248 
sds
 
Çme
 = 
	`diùG‘Key
(
de
);

3249 
RedisModuË
 *
moduË
 = 
	`diùG‘V®
(
de
);

3250 
	`addR•lyMuÉiBulkL’
(
c
,4);

3251 
	`addR•lyBulkCSŒšg
(
c
,"name");

3252 
	`addR•lyBulkCBufãr
(
c
,
Çme
,
	`sd¦’
(name));

3253 
	`addR•lyBulkCSŒšg
(
c
,"ver");

3254 
	`addR•lyLÚgLÚg
(
c
,
moduË
->
v”
);

3256 
	`diùR–—£I‹¿tÜ
(
di
);

3258 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

3260 
	}
}

3264 
	$moduËRegi¡”CÜeAPI
() {

3265 
£rv”
.
moduË­i
 = 
	`diùC»©e
(&
moduËAPIDiùTy³
,
NULL
);

3266 
	`REGISTER_API
(
AÎoc
);

3267 
	`REGISTER_API
(
C®loc
);

3268 
	`REGISTER_API
(
R—Îoc
);

3269 
	`REGISTER_API
(
F»e
);

3270 
	`REGISTER_API
(
SŒdup
);

3271 
	`REGISTER_API
(
C»©eCommªd
);

3272 
	`REGISTER_API
(
S‘ModuËA‰ribs
);

3273 
	`REGISTER_API
(
WrÚgAr™y
);

3274 
	`REGISTER_API
(
R•lyW™hLÚgLÚg
);

3275 
	`REGISTER_API
(
R•lyW™hE¼Ü
);

3276 
	`REGISTER_API
(
R•lyW™hSim¶eSŒšg
);

3277 
	`REGISTER_API
(
R•lyW™hA¼ay
);

3278 
	`REGISTER_API
(
R•lyS‘A¼ayL’gth
);

3279 
	`REGISTER_API
(
R•lyW™hSŒšg
);

3280 
	`REGISTER_API
(
R•lyW™hSŒšgBufãr
);

3281 
	`REGISTER_API
(
R•lyW™hNuÎ
);

3282 
	`REGISTER_API
(
R•lyW™hC®lR•ly
);

3283 
	`REGISTER_API
(
R•lyW™hDoubË
);

3284 
	`REGISTER_API
(
G‘S–eùedDb
);

3285 
	`REGISTER_API
(
S–eùDb
);

3286 
	`REGISTER_API
(
O³nKey
);

3287 
	`REGISTER_API
(
Clo£Key
);

3288 
	`REGISTER_API
(
KeyTy³
);

3289 
	`REGISTER_API
(
V®ueL’gth
);

3290 
	`REGISTER_API
(
Li¡Push
);

3291 
	`REGISTER_API
(
Li¡Pİ
);

3292 
	`REGISTER_API
(
SŒšgToLÚgLÚg
);

3293 
	`REGISTER_API
(
SŒšgToDoubË
);

3294 
	`REGISTER_API
(
C®l
);

3295 
	`REGISTER_API
(
C®lR•lyPrÙo
);

3296 
	`REGISTER_API
(
F»eC®lR•ly
);

3297 
	`REGISTER_API
(
C®lR•lyIÁeg”
);

3298 
	`REGISTER_API
(
C®lR•lyTy³
);

3299 
	`REGISTER_API
(
C®lR•lyL’gth
);

3300 
	`REGISTER_API
(
C®lR•lyA¼ayEËm’t
);

3301 
	`REGISTER_API
(
C®lR•lySŒšgPŒ
);

3302 
	`REGISTER_API
(
C»©eSŒšgFromC®lR•ly
);

3303 
	`REGISTER_API
(
C»©eSŒšg
);

3304 
	`REGISTER_API
(
C»©eSŒšgFromLÚgLÚg
);

3305 
	`REGISTER_API
(
C»©eSŒšgFromSŒšg
);

3306 
	`REGISTER_API
(
C»©eSŒšgPrštf
);

3307 
	`REGISTER_API
(
F»eSŒšg
);

3308 
	`REGISTER_API
(
SŒšgPŒL’
);

3309 
	`REGISTER_API
(
AutoMemÜy
);

3310 
	`REGISTER_API
(
R•liÿ‹
);

3311 
	`REGISTER_API
(
R•liÿ‹V”b©im
);

3312 
	`REGISTER_API
(
D–‘eKey
);

3313 
	`REGISTER_API
(
SŒšgS‘
);

3314 
	`REGISTER_API
(
SŒšgDMA
);

3315 
	`REGISTER_API
(
SŒšgTrunÿ‹
);

3316 
	`REGISTER_API
(
S‘Expœe
);

3317 
	`REGISTER_API
(
G‘Expœe
);

3318 
	`REGISTER_API
(
Z£tAdd
);

3319 
	`REGISTER_API
(
Z£tInüby
);

3320 
	`REGISTER_API
(
Z£tScÜe
);

3321 
	`REGISTER_API
(
Z£tRem
);

3322 
	`REGISTER_API
(
Z£tRªgeStİ
);

3323 
	`REGISTER_API
(
Z£tFœ¡InScÜeRªge
);

3324 
	`REGISTER_API
(
Z£tLa¡InScÜeRªge
);

3325 
	`REGISTER_API
(
Z£tFœ¡InLexRªge
);

3326 
	`REGISTER_API
(
Z£tLa¡InLexRªge
);

3327 
	`REGISTER_API
(
Z£tRªgeCu¼’tEËm’t
);

3328 
	`REGISTER_API
(
Z£tRªgeNext
);

3329 
	`REGISTER_API
(
Z£tRªgeP»v
);

3330 
	`REGISTER_API
(
Z£tRªgeEndR—ched
);

3331 
	`REGISTER_API
(
HashS‘
);

3332 
	`REGISTER_API
(
HashG‘
);

3333 
	`REGISTER_API
(
IsKeysPos™iÚReque¡
);

3334 
	`REGISTER_API
(
KeyAtPos
);

3335 
	`REGISTER_API
(
G‘Cl›ÁId
);

3336 
	`REGISTER_API
(
PoŞAÎoc
);

3337 
	`REGISTER_API
(
C»©eD©aTy³
);

3338 
	`REGISTER_API
(
ModuËTy³S‘V®ue
);

3339 
	`REGISTER_API
(
ModuËTy³G‘Ty³
);

3340 
	`REGISTER_API
(
ModuËTy³G‘V®ue
);

3341 
	`REGISTER_API
(
SaveUnsigÃd
);

3342 
	`REGISTER_API
(
LßdUnsigÃd
);

3343 
	`REGISTER_API
(
SaveSigÃd
);

3344 
	`REGISTER_API
(
LßdSigÃd
);

3345 
	`REGISTER_API
(
SaveSŒšg
);

3346 
	`REGISTER_API
(
SaveSŒšgBufãr
);

3347 
	`REGISTER_API
(
LßdSŒšg
);

3348 
	`REGISTER_API
(
LßdSŒšgBufãr
);

3349 
	`REGISTER_API
(
SaveDoubË
);

3350 
	`REGISTER_API
(
LßdDoubË
);

3351 
	`REGISTER_API
(
SaveFlßt
);

3352 
	`REGISTER_API
(
LßdFlßt
);

3353 
	`REGISTER_API
(
Em™AOF
);

3354 
	`REGISTER_API
(
Log
);

3355 
	`REGISTER_API
(
LogIOE¼Ü
);

3356 
	`REGISTER_API
(
SŒšgAµ’dBufãr
);

3357 
	`REGISTER_API
(
R‘ašSŒšg
);

3358 
	`REGISTER_API
(
SŒšgCom·»
);

3359 
	`REGISTER_API
(
G‘CÚ‹xtFromIO
);

3360 
	}
}

	@modules/hellotype.c

38 
	~"../»dismoduË.h
"

39 
	~<¡dio.h
>

40 
	~<¡dlib.h
>

41 
	~<ùy³.h
>

42 
	~<¡ršg.h
>

43 
	~<¡dšt.h
>

45 
RedisModuËTy³
 *
	gH–loTy³
;

53 
	sH–loTy³Node
 {

54 
št64_t
 
	mv®ue
;

55 
H–loTy³Node
 *
	mÃxt
;

58 
	sH–loTy³Objeù
 {

59 
H–loTy³Node
 *
	mh—d
;

60 
size_t
 
	mËn
;

63 
H–loTy³Objeù
 *
	$ü—‹H–loTy³Objeù
() {

64 
H–loTy³Objeù
 *
o
;

65 
o
 = 
	`RedisModuË_AÎoc
((*o));

66 
o
->
h—d
 = 
NULL
;

67 
o
->
Ën
 = 0;

68  
o
;

69 
	}
}

71 
	$H–loTy³In£¹
(
H–loTy³Objeù
 *
o
, 
št64_t
 
–e
) {

72 
H–loTy³Node
 *
Ãxt
 = 
o
->
h—d
, *
Ãwnode
, *
´ev
 = 
NULL
;

74 
Ãxt
 &&‚ext->
v®ue
 < 
–e
) {

75 
´ev
 = 
Ãxt
;

76 
Ãxt
 =‚ext->next;

78 
Ãwnode
 = 
	`RedisModuË_AÎoc
((*newnode));

79 
Ãwnode
->
v®ue
 = 
–e
;

80 
Ãwnode
->
Ãxt
 =‚ext;

81 ià(
´ev
) {

82 
´ev
->
Ãxt
 = 
Ãwnode
;

84 
o
->
h—d
 = 
Ãwnode
;

86 
o
->
Ën
++;

87 
	}
}

89 
	$H–loTy³R–—£Objeù
(
H–loTy³Objeù
 *
o
) {

90 
H–loTy³Node
 *
cur
, *
Ãxt
;

91 
cur
 = 
o
->
h—d
;

92 
cur
) {

93 
Ãxt
 = 
cur
->next;

94 
	`RedisModuË_F»e
(
cur
);

95 
cur
 = 
Ãxt
;

97 
	`RedisModuË_F»e
(
o
);

98 
	}
}

103 
	$H–loTy³In£¹_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

104 
	`RedisModuË_AutoMemÜy
(
ùx
);

106 ià(
¬gc
 !ğ3è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

107 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

108 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

109 
ty³
 = 
	`RedisModuË_KeyTy³
(
key
);

110 ià(
ty³
 !ğ
REDISMODULE_KEYTYPE_EMPTY
 &&

111 
	`RedisModuË_ModuËTy³G‘Ty³
(
key
è!ğ
H–loTy³
)

113  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

116 
v®ue
;

117 ià((
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[2],&
v®ue
è!ğ
REDISMODULE_OK
)) {

118  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid value: must be‡ signed 64 bit integer");

122 
H–loTy³Objeù
 *
hto
;

123 ià(
ty³
 =ğ
REDISMODULE_KEYTYPE_EMPTY
) {

124 
hto
 = 
	`ü—‹H–loTy³Objeù
();

125 
	`RedisModuË_ModuËTy³S‘V®ue
(
key
,
H–loTy³
,
hto
);

127 
hto
 = 
	`RedisModuË_ModuËTy³G‘V®ue
(
key
);

131 
	`H–loTy³In£¹
(
hto
,
v®ue
);

133 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
hto
->
Ën
);

134 
	`RedisModuË_R•liÿ‹V”b©im
(
ùx
);

135  
REDISMODULE_OK
;

136 
	}
}

139 
	$H–loTy³Rªge_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

140 
	`RedisModuË_AutoMemÜy
(
ùx
);

142 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

143 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

144 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

145 
ty³
 = 
	`RedisModuË_KeyTy³
(
key
);

146 ià(
ty³
 !ğ
REDISMODULE_KEYTYPE_EMPTY
 &&

147 
	`RedisModuË_ModuËTy³G‘Ty³
(
key
è!ğ
H–loTy³
)

149  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

152 
fœ¡
, 
couÁ
;

153 ià(
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[2],&
fœ¡
è!ğ
REDISMODULE_OK
 ||

154 
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[3],&
couÁ
è!ğ
REDISMODULE_OK
 ||

155 
fœ¡
 < 0 || 
couÁ
 < 0)

157  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,

161 
H–loTy³Objeù
 *
hto
 = 
	`RedisModuË_ModuËTy³G‘V®ue
(
key
);

162 
H–loTy³Node
 *
node
 = 
hto
 ? hto->
h—d
 : 
NULL
;

163 
	`RedisModuË_R•lyW™hA¼ay
(
ùx
,
REDISMODULE_POSTPONED_ARRAY_LEN
);

164 
¬¿yËn
 = 0;

165 
node
 && 
couÁ
--) {

166 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
node
->
v®ue
);

167 
¬¿yËn
++;

168 
node
 =‚ode->
Ãxt
;

170 
	`RedisModuË_R•lyS‘A¼ayL’gth
(
ùx
,
¬¿yËn
);

171  
REDISMODULE_OK
;

172 
	}
}

175 
	$H–loTy³L’_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

176 
	`RedisModuË_AutoMemÜy
(
ùx
);

178 ià(
¬gc
 !ğ2è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

179 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

180 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

181 
ty³
 = 
	`RedisModuË_KeyTy³
(
key
);

182 ià(
ty³
 !ğ
REDISMODULE_KEYTYPE_EMPTY
 &&

183 
	`RedisModuË_ModuËTy³G‘Ty³
(
key
è!ğ
H–loTy³
)

185  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

188 
H–loTy³Objeù
 *
hto
 = 
	`RedisModuË_ModuËTy³G‘V®ue
(
key
);

189 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
hto
 ? hto->
Ën
 : 0);

190  
REDISMODULE_OK
;

191 
	}
}

196 *
	$H–loTy³RdbLßd
(
RedisModuËIO
 *
rdb
, 
’cv”
) {

197 ià(
’cv”
 != 0) {

199  
NULL
;

201 
ušt64_t
 
–em’ts
 = 
	`RedisModuË_LßdUnsigÃd
(
rdb
);

202 
H–loTy³Objeù
 *
hto
 = 
	`ü—‹H–loTy³Objeù
();

203 
–em’ts
--) {

204 
št64_t
 
–e
 = 
	`RedisModuË_LßdSigÃd
(
rdb
);

205 
	`H–loTy³In£¹
(
hto
,
–e
);

207  
hto
;

208 
	}
}

210 
	$H–loTy³RdbSave
(
RedisModuËIO
 *
rdb
, *
v®ue
) {

211 
H–loTy³Objeù
 *
hto
 = 
v®ue
;

212 
H–loTy³Node
 *
node
 = 
hto
->
h—d
;

213 
	`RedisModuË_SaveUnsigÃd
(
rdb
,
hto
->
Ën
);

214 
node
) {

215 
	`RedisModuË_SaveSigÃd
(
rdb
,
node
->
v®ue
);

216 
node
 =‚ode->
Ãxt
;

218 
	}
}

220 
	$H–loTy³AofRewr™e
(
RedisModuËIO
 *
aof
, 
RedisModuËSŒšg
 *
key
, *
v®ue
) {

221 
H–loTy³Objeù
 *
hto
 = 
v®ue
;

222 
H–loTy³Node
 *
node
 = 
hto
->
h—d
;

223 
node
) {

224 
	`RedisModuË_Em™AOF
(
aof
,"HELLOTYPE.INSERT","¦",
key
,
node
->
v®ue
);

225 
node
 =‚ode->
Ãxt
;

227 
	}
}

229 
	$H–loTy³Dige¡
(
RedisModuËDige¡
 *
dige¡
, *
v®ue
) {

231 
	}
}

233 
	$H–loTy³F»e
(*
v®ue
) {

234 
	`H–loTy³R–—£Objeù
(
v®ue
);

235 
	}
}

239 
	$RedisModuË_OnLßd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

240 ià(
	`RedisModuË_In™
(
ùx
,"h–lÙy³",1,
REDISMODULE_APIVER_1
)

241 =ğ
REDISMODULE_ERR
)  REDISMODULE_ERR;

243 
H–loTy³
 = 
	`RedisModuË_C»©eD©aTy³
(
ùx
,"h–lÙy³",0,
H–loTy³RdbLßd
,
H–loTy³RdbSave
,
H–loTy³AofRewr™e
,
H–loTy³Dige¡
,
H–loTy³F»e
);

244 ià(
H–loTy³
 =ğ
NULL
è 
REDISMODULE_ERR
;

246 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hellotype.insert",

247 
H–loTy³In£¹_RedisCommªd
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

248  
REDISMODULE_ERR
;

250 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hellotype.range",

251 
H–loTy³Rªge_RedisCommªd
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

252  
REDISMODULE_ERR
;

254 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hellotype.len",

255 
H–loTy³L’_RedisCommªd
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

256  
REDISMODULE_ERR
;

258  
REDISMODULE_OK
;

259 
	}
}

	@modules/helloworld.c

37 
	~"../»dismoduË.h
"

38 
	~<¡dio.h
>

39 
	~<¡dlib.h
>

40 
	~<ùy³.h
>

41 
	~<¡ršg.h
>

48 
	$H–loSim¶e_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

49 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
	`RedisModuË_G‘S–eùedDb
(ctx));

50  
REDISMODULE_OK
;

51 
	}
}

59 
	$H–loPushN©ive_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
)

61 ià(
¬gc
 !ğ3è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

63 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

64 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

66 
	`RedisModuË_Li¡Push
(
key
,
REDISMODULE_LIST_TAIL
,
¬gv
[2]);

67 
size_t
 
ÃwËn
 = 
	`RedisModuË_V®ueL’gth
(
key
);

68 
	`RedisModuË_Clo£Key
(
key
);

69 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
ÃwËn
);

70  
REDISMODULE_OK
;

71 
	}
}

78 
	$H–loPushC®l_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
)

80 ià(
¬gc
 !ğ3è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

82 
RedisModuËC®lR•ly
 *
»¶y
;

84 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"RPUSH","ss",
¬gv
[1],argv[2]);

85 
Ën
 = 
	`RedisModuË_C®lR•lyIÁeg”
(
»¶y
);

86 
	`RedisModuË_F»eC®lR•ly
(
»¶y
);

87 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
Ën
);

88  
REDISMODULE_OK
;

89 
	}
}

94 
	$H–loPushC®l2_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
)

96 ià(
¬gc
 !ğ3è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

98 
RedisModuËC®lR•ly
 *
»¶y
;

100 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"RPUSH","ss",
¬gv
[1],argv[2]);

101 
	`RedisModuË_R•lyW™hC®lR•ly
(
ùx
,
»¶y
);

102 
	`RedisModuË_F»eC®lR•ly
(
»¶y
);

103  
REDISMODULE_OK
;

104 
	}
}

109 
	$H–loLi¡SumL’_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
)

111 ià(
¬gc
 !ğ2è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

113 
RedisModuËC®lR•ly
 *
»¶y
;

115 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"LRANGE","¦l",
¬gv
[1],()0,()-1);

116 
size_t
 
¡¾’
 = 0;

117 
size_t
 
™ems
 = 
	`RedisModuË_C®lR•lyL’gth
(
»¶y
);

118 
size_t
 
j
;

119 
j
 = 0; j < 
™ems
; j++) {

120 
RedisModuËC®lR•ly
 *
–e
 = 
	`RedisModuË_C®lR•lyA¼ayEËm’t
(
»¶y
,
j
);

121 
¡¾’
 +ğ
	`RedisModuË_C®lR•lyL’gth
(
–e
);

123 
	`RedisModuË_F»eC®lR•ly
(
»¶y
);

124 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
¡¾’
);

125  
REDISMODULE_OK
;

126 
	}
}

132 
	$H–loLi¡S¶iû_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

133 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

135 
RedisModuËKey
 *
¤ckey
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

136 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

137 
RedisModuËKey
 *
d¡key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[2],

138 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

141 ià((
	`RedisModuË_KeyTy³
(
¤ckey
è!ğ
REDISMODULE_KEYTYPE_LIST
 &&

142 
	`RedisModuË_KeyTy³
(
¤ckey
è!ğ
REDISMODULE_KEYTYPE_EMPTY
) ||

143 (
	`RedisModuË_KeyTy³
(
d¡key
è!ğ
REDISMODULE_KEYTYPE_LIST
 &&

144 
	`RedisModuË_KeyTy³
(
d¡key
è!ğ
REDISMODULE_KEYTYPE_EMPTY
))

146 
	`RedisModuË_Clo£Key
(
¤ckey
);

147 
	`RedisModuË_Clo£Key
(
d¡key
);

148  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

151 
couÁ
;

152 ià((
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[3],&
couÁ
è!ğ
REDISMODULE_OK
) ||

153 (
couÁ
 < 0)) {

154 
	`RedisModuË_Clo£Key
(
¤ckey
);

155 
	`RedisModuË_Clo£Key
(
d¡key
);

156  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid count");

159 
couÁ
-- > 0) {

160 
RedisModuËSŒšg
 *
–e
;

162 
–e
 = 
	`RedisModuË_Li¡Pİ
(
¤ckey
,
REDISMODULE_LIST_TAIL
);

163 ià(
–e
 =ğ
NULL
) ;

164 
	`RedisModuË_Li¡Push
(
d¡key
,
REDISMODULE_LIST_HEAD
,
–e
);

165 
	`RedisModuË_F»eSŒšg
(
ùx
,
–e
);

168 
size_t
 
Ën
 = 
	`RedisModuË_V®ueL’gth
(
¤ckey
);

169 
	`RedisModuË_Clo£Key
(
¤ckey
);

170 
	`RedisModuË_Clo£Key
(
d¡key
);

171 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
Ën
);

172  
REDISMODULE_OK
;

173 
	}
}

177 
	$H–loLi¡S¶iûAuto_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

178 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

180 
	`RedisModuË_AutoMemÜy
(
ùx
);

182 
RedisModuËKey
 *
¤ckey
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

183 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

184 
RedisModuËKey
 *
d¡key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[2],

185 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

188 ià((
	`RedisModuË_KeyTy³
(
¤ckey
è!ğ
REDISMODULE_KEYTYPE_LIST
 &&

189 
	`RedisModuË_KeyTy³
(
¤ckey
è!ğ
REDISMODULE_KEYTYPE_EMPTY
) ||

190 (
	`RedisModuË_KeyTy³
(
d¡key
è!ğ
REDISMODULE_KEYTYPE_LIST
 &&

191 
	`RedisModuË_KeyTy³
(
d¡key
è!ğ
REDISMODULE_KEYTYPE_EMPTY
))

193  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

196 
couÁ
;

197 ià((
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[3],&
couÁ
è!ğ
REDISMODULE_OK
) ||

198 (
couÁ
 < 0))

200  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid count");

203 
couÁ
-- > 0) {

204 
RedisModuËSŒšg
 *
–e
;

206 
–e
 = 
	`RedisModuË_Li¡Pİ
(
¤ckey
,
REDISMODULE_LIST_TAIL
);

207 ià(
–e
 =ğ
NULL
) ;

208 
	`RedisModuË_Li¡Push
(
d¡key
,
REDISMODULE_LIST_HEAD
,
–e
);

211 
size_t
 
Ën
 = 
	`RedisModuË_V®ueL’gth
(
¤ckey
);

212 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
Ën
);

213  
REDISMODULE_OK
;

214 
	}
}

219 
	$H–loRªdA¼ay_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

220 ià(
¬gc
 !ğ2è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

221 
couÁ
;

222 ià(
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[1],&
couÁ
è!ğ
REDISMODULE_OK
 ||

223 
couÁ
 < 0)

224  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid count");

229 
	`RedisModuË_R•lyW™hA¼ay
(
ùx
,
couÁ
);

230 
couÁ
--è
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
	`¿nd
());

231  
REDISMODULE_OK
;

232 
	}
}

238 
	$H–loR•l1_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
)

240 
RedisModuËC®lR•ly
 *
»¶y
;

241 
	`RedisModuË_AutoMemÜy
(
ùx
);

253 
	`RedisModuË_R•liÿ‹
(
ùx
,"ECHO","c","foo");

257 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"INCR","c!","foo");

258 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"INCR","c!","bar");

260 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,0);

262  
REDISMODULE_OK
;

263 
	}
}

275 
	$H–loR•l2_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

276 ià(
¬gc
 !ğ2è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

278 
	`RedisModuË_AutoMemÜy
(
ùx
);

279 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

280 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

282 ià(
	`RedisModuË_KeyTy³
(
key
è!ğ
REDISMODULE_KEYTYPE_LIST
)

283  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

285 
size_t
 
li¡Ën
 = 
	`RedisModuË_V®ueL’gth
(
key
);

286 
sum
 = 0;

289 
li¡Ën
--) {

290 
RedisModuËSŒšg
 *
–e
 = 
	`RedisModuË_Li¡Pİ
(
key
,
REDISMODULE_LIST_TAIL
);

291 
v®
;

292 ià(
	`RedisModuË_SŒšgToLÚgLÚg
(
–e
,&
v®
è!ğ
REDISMODULE_OK
) val = 0;

293 
v®
++;

294 
sum
 +ğ
v®
;

295 
RedisModuËSŒšg
 *
Ãw–e
 = 
	`RedisModuË_C»©eSŒšgFromLÚgLÚg
(
ùx
,
v®
);

296 
	`RedisModuË_Li¡Push
(
key
,
REDISMODULE_LIST_HEAD
,
Ãw–e
);

298 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
sum
);

299 
	`RedisModuË_R•liÿ‹V”b©im
(
ùx
);

300  
REDISMODULE_OK
;

301 
	}
}

311 
	$H–loToggËCa£_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

312 ià(
¬gc
 !ğ2è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

314 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

315 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

317 
keyty³
 = 
	`RedisModuË_KeyTy³
(
key
);

318 ià(
keyty³
 !ğ
REDISMODULE_KEYTYPE_STRING
 &&

319 
keyty³
 !ğ
REDISMODULE_KEYTYPE_EMPTY
)

321 
	`RedisModuË_Clo£Key
(
key
);

322  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

325 ià(
keyty³
 =ğ
REDISMODULE_KEYTYPE_STRING
) {

326 
size_t
 
Ën
, 
j
;

327 *
s
 = 
	`RedisModuË_SŒšgDMA
(
key
,&
Ën
,
REDISMODULE_WRITE
);

328 
j
 = 0; j < 
Ën
; j++) {

329 ià(
	`isuµ”
(
s
[
j
])) {

330 
s
[
j
] = 
	`tŞow”
(s[j]);

332 
s
[
j
] = 
	`touµ”
(s[j]);

337 
	`RedisModuË_Clo£Key
(
key
);

338 
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,"OK");

339 
	`RedisModuË_R•liÿ‹V”b©im
(
ùx
);

340  
REDISMODULE_OK
;

341 
	}
}

347 
	$H–loMÜeExpœe_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

348 
	`RedisModuË_AutoMemÜy
(
ùx
);

349 ià(
¬gc
 !ğ3è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

351 
m¡ime_t
 
addms
, 
expœe
;

353 ià(
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[2],&
addms
è!ğ
REDISMODULE_OK
)

354  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalidƒxpireime");

356 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

357 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

358 
expœe
 = 
	`RedisModuË_G‘Expœe
(
key
);

359 ià(
expœe
 !ğ
REDISMODULE_NO_EXPIRE
) {

360 
expœe
 +ğ
addms
;

361 
	`RedisModuË_S‘Expœe
(
key
,
expœe
);

363  
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,"OK");

364 
	}
}

372 
	$H–loZsumRªge_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

373 
scÜe_¡¬t
, 
scÜe_’d
;

374 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

376 ià(
	`RedisModuË_SŒšgToDoubË
(
¬gv
[2],&
scÜe_¡¬t
è!ğ
REDISMODULE_OK
 ||

377 
	`RedisModuË_SŒšgToDoubË
(
¬gv
[3],&
scÜe_’d
è!ğ
REDISMODULE_OK
)

379  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid„ange");

382 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

383 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

384 ià(
	`RedisModuË_KeyTy³
(
key
è!ğ
REDISMODULE_KEYTYPE_ZSET
) {

385  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

388 
scÜesum_a
 = 0;

389 
scÜesum_b
 = 0;

391 
	`RedisModuË_Z£tFœ¡InScÜeRªge
(
key
,
scÜe_¡¬t
,
scÜe_’d
,0,0);

392 !
	`RedisModuË_Z£tRªgeEndR—ched
(
key
)) {

393 
scÜe
;

394 
RedisModuËSŒšg
 *
–e
 = 
	`RedisModuË_Z£tRªgeCu¼’tEËm’t
(
key
,&
scÜe
);

395 
	`RedisModuË_F»eSŒšg
(
ùx
,
–e
);

396 
scÜesum_a
 +ğ
scÜe
;

397 
	`RedisModuË_Z£tRªgeNext
(
key
);

399 
	`RedisModuË_Z£tRªgeStİ
(
key
);

401 
	`RedisModuË_Z£tLa¡InScÜeRªge
(
key
,
scÜe_¡¬t
,
scÜe_’d
,0,0);

402 !
	`RedisModuË_Z£tRªgeEndR—ched
(
key
)) {

403 
scÜe
;

404 
RedisModuËSŒšg
 *
–e
 = 
	`RedisModuË_Z£tRªgeCu¼’tEËm’t
(
key
,&
scÜe
);

405 
	`RedisModuË_F»eSŒšg
(
ùx
,
–e
);

406 
scÜesum_b
 +ğ
scÜe
;

407 
	`RedisModuË_Z£tRªgeP»v
(
key
);

410 
	`RedisModuË_Z£tRªgeStİ
(
key
);

412 
	`RedisModuË_Clo£Key
(
key
);

414 
	`RedisModuË_R•lyW™hA¼ay
(
ùx
,2);

415 
	`RedisModuË_R•lyW™hDoubË
(
ùx
,
scÜesum_a
);

416 
	`RedisModuË_R•lyW™hDoubË
(
ùx
,
scÜesum_b
);

417  
REDISMODULE_OK
;

418 
	}
}

427 
	$H–loLexRªge_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

428 
	`RedisModuË_AutoMemÜy
(
ùx
);

430 ià(
¬gc
 !ğ6è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

432 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

433 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

434 ià(
	`RedisModuË_KeyTy³
(
key
è!ğ
REDISMODULE_KEYTYPE_ZSET
) {

435  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

438 ià(
	`RedisModuË_Z£tFœ¡InLexRªge
(
key
,
¬gv
[2],¬gv[3]è!ğ
REDISMODULE_OK
) {

439  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"invalid„ange");

442 
¬¿yËn
 = 0;

443 
	`RedisModuË_R•lyW™hA¼ay
(
ùx
,
REDISMODULE_POSTPONED_ARRAY_LEN
);

444 !
	`RedisModuË_Z£tRªgeEndR—ched
(
key
)) {

445 
scÜe
;

446 
RedisModuËSŒšg
 *
–e
 = 
	`RedisModuË_Z£tRªgeCu¼’tEËm’t
(
key
,&
scÜe
);

447 
	`RedisModuË_R•lyW™hSŒšg
(
ùx
,
–e
);

448 
	`RedisModuË_F»eSŒšg
(
ùx
,
–e
);

449 
	`RedisModuË_Z£tRªgeNext
(
key
);

450 
¬¿yËn
++;

452 
	`RedisModuË_Z£tRªgeStİ
(
key
);

453 
	`RedisModuË_R•lyS‘A¼ayL’gth
(
ùx
,
¬¿yËn
);

454 
	`RedisModuË_Clo£Key
(
key
);

455  
REDISMODULE_OK
;

456 
	}
}

465 
	$H–loHCİy_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

466 
	`RedisModuË_AutoMemÜy
(
ùx
);

468 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

469 
RedisModuËKey
 *
key
 = 
	`RedisModuË_O³nKey
(
ùx
,
¬gv
[1],

470 
REDISMODULE_READ
|
REDISMODULE_WRITE
);

471 
ty³
 = 
	`RedisModuË_KeyTy³
(
key
);

472 ià(
ty³
 !ğ
REDISMODULE_KEYTYPE_HASH
 &&

473 
ty³
 !ğ
REDISMODULE_KEYTYPE_EMPTY
)

475  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,
REDISMODULE_ERRORMSG_WRONGTYPE
);

479 
RedisModuËSŒšg
 *
Şdv®
;

480 
	`RedisModuË_HashG‘
(
key
,
REDISMODULE_HASH_NONE
,
¬gv
[2],&
Şdv®
,
NULL
);

481 ià(
Şdv®
) {

482 
	`RedisModuË_HashS‘
(
key
,
REDISMODULE_HASH_NONE
,
¬gv
[3],
Şdv®
,
NULL
);

484 
	`RedisModuË_R•lyW™hLÚgLÚg
(
ùx
,
Şdv®
 !ğ
NULL
);

485  
REDISMODULE_OK
;

486 
	}
}

506 
	$H–loLeáPad_RedisCommªd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

507 
	`RedisModuË_AutoMemÜy
(
ùx
);

508 
·dËn
;

510 ià(
¬gc
 !ğ4è 
	`RedisModuË_WrÚgAr™y
(
ùx
);

512 ià((
	`RedisModuË_SŒšgToLÚgLÚg
(
¬gv
[2],&
·dËn
è!ğ
REDISMODULE_OK
) ||

513 (
·dËn
< 0)) {

514  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,"ERR invalid…adding†ength");

516 
size_t
 
¡¾’
, 
chËn
;

517 cÚ¡ *
¡r
 = 
	`RedisModuË_SŒšgPŒL’
(
¬gv
[1], &
¡¾’
);

518 cÚ¡ *
ch
 = 
	`RedisModuË_SŒšgPŒL’
(
¬gv
[3], &
chËn
);

522 ià(
¡¾’
 >ğ
·dËn
)

523  
	`RedisModuË_R•lyW™hSŒšg
(
ùx
,
¬gv
[1]);

526 ià(
chËn
 != 1)

527  
	`RedisModuË_R•lyW™hE¼Ü
(
ùx
,

531 
·dËn
 -ğ
¡¾’
;

532 *
buf
 = 
	`RedisModuË_PoŞAÎoc
(
ùx
,
·dËn
+
¡¾’
);

533 
size_t
 
j
 = 0; j < 
·dËn
; j++è
buf
[j] = *
ch
;

534 
	`memıy
(
buf
+
·dËn
,
¡r
,
¡¾’
);

536 
	`RedisModuË_R•lyW™hSŒšgBufãr
(
ùx
,
buf
,
·dËn
+
¡¾’
);

537  
REDISMODULE_OK
;

538 
	}
}

542 
	$RedisModuË_OnLßd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

543 ià(
	`RedisModuË_In™
(
ùx
,"h–lowÜld",1,
REDISMODULE_APIVER_1
)

544 =ğ
REDISMODULE_ERR
)  REDISMODULE_ERR;

547 
j
 = 0; j < 
¬gc
; j++) {

548 cÚ¡ *
s
 = 
	`RedisModuË_SŒšgPŒL’
(
¬gv
[
j
],
NULL
);

549 
	`´štf
("ModuË†ßded w™h ARGV[%d] = %s\n", 
j
, 
s
);

552 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.simple",

553 
H–loSim¶e_RedisCommªd
,"»adÚly",0,0,0è=ğ
REDISMODULE_ERR
)

554  
REDISMODULE_ERR
;

556 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.push.native",

557 
H–loPushN©ive_RedisCommªd
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

558  
REDISMODULE_ERR
;

560 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.push.call",

561 
H–loPushC®l_RedisCommªd
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

562  
REDISMODULE_ERR
;

564 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.push.call2",

565 
H–loPushC®l2_RedisCommªd
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

566  
REDISMODULE_ERR
;

568 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.list.sum.len",

569 
H–loLi¡SumL’_RedisCommªd
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

570  
REDISMODULE_ERR
;

572 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.list.splice",

573 
H–loLi¡S¶iû_RedisCommªd
,"wr™d’y-oom",1,2,1è=ğ
REDISMODULE_ERR
)

574  
REDISMODULE_ERR
;

576 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.list.splice.auto",

577 
H–loLi¡S¶iûAuto_RedisCommªd
,

578 "wr™d’y-oom",1,2,1è=ğ
REDISMODULE_ERR
)

579  
REDISMODULE_ERR
;

581 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.rand.array",

582 
H–loRªdA¼ay_RedisCommªd
,"»adÚly",0,0,0è=ğ
REDISMODULE_ERR
)

583  
REDISMODULE_ERR
;

585 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.repl1",

586 
H–loR•l1_RedisCommªd
,"wr™e",0,0,0è=ğ
REDISMODULE_ERR
)

587  
REDISMODULE_ERR
;

589 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.repl2",

590 
H–loR•l2_RedisCommªd
,"wr™e",1,1,1è=ğ
REDISMODULE_ERR
)

591  
REDISMODULE_ERR
;

593 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.toggle.case",

594 
H–loToggËCa£_RedisCommªd
,"wr™e",1,1,1è=ğ
REDISMODULE_ERR
)

595  
REDISMODULE_ERR
;

597 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.more.expire",

598 
H–loMÜeExpœe_RedisCommªd
,"wr™e",1,1,1è=ğ
REDISMODULE_ERR
)

599  
REDISMODULE_ERR
;

601 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.zsumrange",

602 
H–loZsumRªge_RedisCommªd
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

603  
REDISMODULE_ERR
;

605 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.lexrange",

606 
H–loLexRªge_RedisCommªd
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

607  
REDISMODULE_ERR
;

609 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.hcopy",

610 
H–loHCİy_RedisCommªd
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

611  
REDISMODULE_ERR
;

613 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"hello.leftpad",

614 
H–loLeáPad_RedisCommªd
,"",1,1,1è=ğ
REDISMODULE_ERR
)

615  
REDISMODULE_ERR
;

617  
REDISMODULE_OK
;

618 
	}
}

	@modules/testmodule.c

33 
	~"../»dismoduË.h
"

34 
	~<¡ršg.h
>

39 
	$Te¡M©chR•ly
(
RedisModuËC®lR•ly
 *
»¶y
, *
¡r
) {

40 
RedisModuËSŒšg
 *
my¡r
;

41 
my¡r
 = 
	`RedisModuË_C»©eSŒšgFromC®lR•ly
(
»¶y
);

42 ià(!
my¡r
)  0;

43 cÚ¡ *
±r
 = 
	`RedisModuË_SŒšgPŒL’
(
my¡r
,
NULL
);

44  
	`¡rcmp
(
±r
,
¡r
) == 0;

45 
	}
}

50 
	$Te¡C®l
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

51 
	`RedisModuË_AutoMemÜy
(
ùx
);

52 
RedisModuËC®lR•ly
 *
»¶y
;

54 
	`RedisModuË_C®l
(
ùx
,"DEL","c","mylist");

55 
RedisModuËSŒšg
 *
my¡r
 = 
	`RedisModuË_C»©eSŒšg
(
ùx
,"foo",3);

56 
	`RedisModuË_C®l
(
ùx
,"RPUSH","c¦","myli¡",
my¡r
,()1234);

57 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,"LRANGE","ccc","mylist","0","-1");

58 
™ems
 = 
	`RedisModuË_C®lR•lyL’gth
(
»¶y
);

59 ià(
™ems
 !ğ2è
ç
;

61 
RedisModuËC®lR•ly
 *
™em0
, *
™em1
;

63 
™em0
 = 
	`RedisModuË_C®lR•lyA¼ayEËm’t
(
»¶y
,0);

64 
™em1
 = 
	`RedisModuË_C®lR•lyA¼ayEËm’t
(
»¶y
,1);

65 ià(!
	`Te¡M©chR•ly
(
™em0
,"foo")è
ç
;

66 ià(!
	`Te¡M©chR•ly
(
™em1
,"1234")è
ç
;

68 
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,"OK");

69  
REDISMODULE_OK
;

71 
ç
:

72 
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,"ERR");

73  
REDISMODULE_OK
;

74 
	}
}

77 
	$Te¡SŒšgAµ’d
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

78 
RedisModuËSŒšg
 *
s
 = 
	`RedisModuË_C»©eSŒšg
(
ùx
,"foo",3);

79 
	`RedisModuË_SŒšgAµ’dBufãr
(
ùx
,
s
,"bar",3);

80 
	`RedisModuË_R•lyW™hSŒšg
(
ùx
,
s
);

81 
	`RedisModuË_F»eSŒšg
(
ùx
,
s
);

82  
REDISMODULE_OK
;

83 
	}
}

86 
	$Te¡SŒšgAµ’dAM
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

87 
	`RedisModuË_AutoMemÜy
(
ùx
);

88 
RedisModuËSŒšg
 *
s
 = 
	`RedisModuË_C»©eSŒšg
(
ùx
,"foo",3);

89 
	`RedisModuË_R‘ašSŒšg
(
ùx
,
s
);

90 
	`RedisModuË_SŒšgAµ’dBufãr
(
ùx
,
s
,"bar",3);

91 
	`RedisModuË_R•lyW™hSŒšg
(
ùx
,
s
);

92 
	`RedisModuË_F»eSŒšg
(
ùx
,
s
);

93  
REDISMODULE_OK
;

94 
	}
}

97 
	$Te¡SŒšgPrštf
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

98 
	`RedisModuË_AutoMemÜy
(
ùx
);

99 ià(
¬gc
 < 3) {

100  
	`RedisModuË_WrÚgAr™y
(
ùx
);

102 
RedisModuËSŒšg
 *
s
 = 
	`RedisModuË_C»©eSŒšgPrštf
(
ùx
,

104 
¬gc
,

105 
	`RedisModuË_SŒšgPŒL’
(
¬gv
[1], 
NULL
),

106 
	`RedisModuË_SŒšgPŒL’
(
¬gv
[2], 
NULL
)

109 
	`RedisModuË_R•lyW™hSŒšg
(
ùx
,
s
);

111  
REDISMODULE_OK
;

112 
	}
}

119 
	$Te¡As£¹SŒšgR•ly
(
RedisModuËCtx
 *
ùx
, 
RedisModuËC®lR•ly
 *
»¶y
, *
¡r
, 
size_t
 
Ën
) {

120 
RedisModuËSŒšg
 *
my¡r
, *
ex³ùed
;

122 ià(
	`RedisModuË_C®lR•lyTy³
(
»¶y
è!ğ
REDISMODULE_REPLY_STRING
) {

123 
	`RedisModuË_Log
(
ùx
,"warning","Unexpected„eplyype %d",

124 
	`RedisModuË_C®lR•lyTy³
(
»¶y
));

127 
my¡r
 = 
	`RedisModuË_C»©eSŒšgFromC®lR•ly
(
»¶y
);

128 
ex³ùed
 = 
	`RedisModuË_C»©eSŒšg
(
ùx
,
¡r
,
Ën
);

129 ià(
	`RedisModuË_SŒšgCom·»
(
my¡r
,
ex³ùed
) != 0) {

130 cÚ¡ *
my¡r_±r
 = 
	`RedisModuË_SŒšgPŒL’
(
my¡r
,
NULL
);

131 cÚ¡ *
ex³ùed_±r
 = 
	`RedisModuË_SŒšgPŒL’
(
ex³ùed
,
NULL
);

132 
	`RedisModuË_Log
(
ùx
,"warning",

134 
my¡r_±r
, 
ex³ùed_±r
);

138 
	}
}

142 
	$Te¡As£¹IÁeg”R•ly
(
RedisModuËCtx
 *
ùx
, 
RedisModuËC®lR•ly
 *
»¶y
, 
ex³ùed
) {

143 ià(
	`RedisModuË_C®lR•lyTy³
(
»¶y
è!ğ
REDISMODULE_REPLY_INTEGER
) {

144 
	`RedisModuË_Log
(
ùx
,"warning","Unexpected„eplyype %d",

145 
	`RedisModuË_C®lR•lyTy³
(
»¶y
));

148 
v®
 = 
	`RedisModuË_C®lR•lyIÁeg”
(
»¶y
);

149 ià(
v®
 !ğ
ex³ùed
) {

150 
	`RedisModuË_Log
(
ùx
,"warning",

152 
v®
, 
ex³ùed
);

156 
	}
}

158 
	#T
(
Çme
,...) \

160 
	`RedisModuË_Log
(
ùx
,"w¬nšg","Te¡šg %s", 
Çme
); \

161 
»¶y
 = 
	`RedisModuË_C®l
(
ùx
,
Çme
,
__VA_ARGS__
); \

162 } 0);

	)

165 
	$Te¡It
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

166 
	`RedisModuË_AutoMemÜy
(
ùx
);

167 
RedisModuËC®lR•ly
 *
»¶y
;

170 
	`T
("dbsize","");

171 ià(!
	`Te¡As£¹IÁeg”R•ly
(
ùx
,
»¶y
,0)è
ç
;

173 
	`T
("ping","");

174 ià(!
	`Te¡As£¹SŒšgR•ly
(
ùx
,
»¶y
,"PONG",4)è
ç
;

176 
	`T
("test.call","");

177 ià(!
	`Te¡As£¹SŒšgR•ly
(
ùx
,
»¶y
,"OK",2)è
ç
;

179 
	`T
("test.string.append","");

180 ià(!
	`Te¡As£¹SŒšgR•ly
(
ùx
,
»¶y
,"foob¬",6)è
ç
;

182 
	`T
("test.string.append.am","");

183 ià(!
	`Te¡As£¹SŒšgR•ly
(
ùx
,
»¶y
,"foob¬",6)è
ç
;

185 
	`T
("test.string.printf", "cc", "foo", "bar");

186 ià(!
	`Te¡As£¹SŒšgR•ly
(
ùx
,
»¶y
,"GÙ 3‡rgs.‡rgv[1]: foo,‡rgv[2]: b¬",38)è
ç
;

188 
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,"ALL TESTS PASSED");

189  
REDISMODULE_OK
;

191 
ç
:

192 
	`RedisModuË_R•lyW™hSim¶eSŒšg
(
ùx
,

194  
REDISMODULE_OK
;

195 
	}
}

197 
	$RedisModuË_OnLßd
(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 **
¬gv
, 
¬gc
) {

198 ià(
	`RedisModuË_In™
(
ùx
,"‹¡",1,
REDISMODULE_APIVER_1
)

199 =ğ
REDISMODULE_ERR
)  REDISMODULE_ERR;

201 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"test.call",

202 
Te¡C®l
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

203  
REDISMODULE_ERR
;

205 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"test.string.append",

206 
Te¡SŒšgAµ’d
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

207  
REDISMODULE_ERR
;

209 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"test.string.append.am",

210 
Te¡SŒšgAµ’dAM
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

211  
REDISMODULE_ERR
;

213 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"test.string.printf",

214 
Te¡SŒšgPrštf
,"wr™d’y-oom",1,1,1è=ğ
REDISMODULE_ERR
)

215  
REDISMODULE_ERR
;

217 ià(
	`RedisModuË_C»©eCommªd
(
ùx
,"test.it",

218 
Te¡It
,"»adÚly",1,1,1è=ğ
REDISMODULE_ERR
)

219  
REDISMODULE_ERR
;

221  
REDISMODULE_OK
;

222 
	}
}

	@multi.c

30 
	~"£rv”.h
"

35 
	$š™Cl›ÁMuÉiS‹
(
ş›Á
 *
c
) {

36 
c
->
m¡©e
.
commªds
 = 
NULL
;

37 
c
->
m¡©e
.
couÁ
 = 0;

38 
	}
}

41 
	$ä“Cl›ÁMuÉiS‹
(
ş›Á
 *
c
) {

42 
j
;

44 
j
 = 0; j < 
c
->
m¡©e
.
couÁ
; j++) {

45 
i
;

46 
muÉiCmd
 *
mc
 = 
c
->
m¡©e
.
commªds
+
j
;

48 
i
 = 0; i < 
mc
->
¬gc
; i++)

49 
	`deüRefCouÁ
(
mc
->
¬gv
[
i
]);

50 
	`zä“
(
mc
->
¬gv
);

52 
	`zä“
(
c
->
m¡©e
.
commªds
);

53 
	}
}

56 
	$queueMuÉiCommªd
(
ş›Á
 *
c
) {

57 
muÉiCmd
 *
mc
;

58 
j
;

60 
c
->
m¡©e
.
commªds
 = 
	`z»®loc
(c->mstate.commands,

61 (
muÉiCmd
)*(
c
->
m¡©e
.
couÁ
+1));

62 
mc
 = 
c
->
m¡©e
.
commªds
+c->m¡©e.
couÁ
;

63 
mc
->
cmd
 = 
c
->cmd;

64 
mc
->
¬gc
 = 
c
->argc;

65 
mc
->
¬gv
 = 
	`zm®loc
((
robj
*)*
c
->
¬gc
);

66 
	`memıy
(
mc
->
¬gv
,
c
->¬gv,(
robj
*)*c->
¬gc
);

67 
j
 = 0; j < 
c
->
¬gc
; j++)

68 
	`šüRefCouÁ
(
mc
->
¬gv
[
j
]);

69 
c
->
m¡©e
.
couÁ
++;

70 
	}
}

72 
	$disÿrdT¿n§ùiÚ
(
ş›Á
 *
c
) {

73 
	`ä“Cl›ÁMuÉiS‹
(
c
);

74 
	`š™Cl›ÁMuÉiS‹
(
c
);

75 
c
->
æags
 &ğ~(
CLIENT_MULTI
|
CLIENT_DIRTY_CAS
|
CLIENT_DIRTY_EXEC
);

76 
	`unw©chAÎKeys
(
c
);

77 
	}
}

81 
	$æagT¿n§ùiÚ
(
ş›Á
 *
c
) {

82 ià(
c
->
æags
 & 
CLIENT_MULTI
)

83 
c
->
æags
 |ğ
CLIENT_DIRTY_EXEC
;

84 
	}
}

86 
	$muÉiCommªd
(
ş›Á
 *
c
) {

87 ià(
c
->
æags
 & 
CLIENT_MULTI
) {

88 
	`addR•lyE¼Ü
(
c
,"MULTI calls can‚ot be‚ested");

91 
c
->
æags
 |ğ
CLIENT_MULTI
;

92 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

93 
	}
}

95 
	$disÿrdCommªd
(
ş›Á
 *
c
) {

96 ià(!(
c
->
æags
 & 
CLIENT_MULTI
)) {

97 
	`addR•lyE¼Ü
(
c
,"DISCARD without MULTI");

100 
	`disÿrdT¿n§ùiÚ
(
c
);

101 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

102 
	}
}

106 
	$execCommªdPrİag©eMuÉi
(
ş›Á
 *
c
) {

107 
robj
 *
muÉi¡ršg
 = 
	`ü—‹SŒšgObjeù
("MULTI",5);

109 
	`´İag©e
(
£rv”
.
muÉiCommªd
,
c
->
db
->
id
,&
muÉi¡ršg
,1,

110 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

111 
	`deüRefCouÁ
(
muÉi¡ršg
);

112 
	}
}

114 
	$execCommªd
(
ş›Á
 *
c
) {

115 
j
;

116 
robj
 **
Üig_¬gv
;

117 
Üig_¬gc
;

118 
»disCommªd
 *
Üig_cmd
;

119 
mu¡_´İag©e
 = 0;

121 ià(!(
c
->
æags
 & 
CLIENT_MULTI
)) {

122 
	`addR•lyE¼Ü
(
c
,"EXEC without MULTI");

132 ià(
c
->
æags
 & (
CLIENT_DIRTY_CAS
|
CLIENT_DIRTY_EXEC
)) {

133 
	`addR•ly
(
c
, c->
æags
 & 
CLIENT_DIRTY_EXEC
 ? 
sh¬ed
.
exeÿbÜ‹¼
 :

134 
sh¬ed
.
nuÎmuÉibulk
);

135 
	`disÿrdT¿n§ùiÚ
(
c
);

136 
hªdË_mÚ™Ü
;

140 
	`unw©chAÎKeys
(
c
);

141 
Üig_¬gv
 = 
c
->
¬gv
;

142 
Üig_¬gc
 = 
c
->
¬gc
;

143 
Üig_cmd
 = 
c
->
cmd
;

144 
	`addR•lyMuÉiBulkL’
(
c
,c->
m¡©e
.
couÁ
);

145 
j
 = 0; j < 
c
->
m¡©e
.
couÁ
; j++) {

146 
c
->
¬gc
 = c->
m¡©e
.
commªds
[
j
].argc;

147 
c
->
¬gv
 = c->
m¡©e
.
commªds
[
j
].argv;

148 
c
->
cmd
 = c->
m¡©e
.
commªds
[
j
].cmd;

154 ià(!
mu¡_´İag©e
 && !(
c
->
cmd
->
æags
 & 
CMD_READONLY
)) {

155 
	`execCommªdPrİag©eMuÉi
(
c
);

156 
mu¡_´İag©e
 = 1;

159 
	`ÿÎ
(
c
,
CMD_CALL_FULL
);

162 
c
->
m¡©e
.
commªds
[
j
].
¬gc
 = c->argc;

163 
c
->
m¡©e
.
commªds
[
j
].
¬gv
 = c->argv;

164 
c
->
m¡©e
.
commªds
[
j
].
cmd
 = c->cmd;

166 
c
->
¬gv
 = 
Üig_¬gv
;

167 
c
->
¬gc
 = 
Üig_¬gc
;

168 
c
->
cmd
 = 
Üig_cmd
;

169 
	`disÿrdT¿n§ùiÚ
(
c
);

172 ià(
mu¡_´İag©e
è
£rv”
.
dœty
++;

174 
hªdË_mÚ™Ü
:

180 ià(
	`li¡L’gth
(
£rv”
.
mÚ™Üs
è&& !£rv”.
lßdšg
)

181 
	`»¶iÿtiÚF“dMÚ™Üs
(
c
,
£rv”
.
mÚ™Üs
,c->
db
->
id
,c->
¬gv
,c->
¬gc
);

182 
	}
}

196 
	sw©chedKey
 {

197 
robj
 *
	mkey
;

198 
»disDb
 *
	mdb
;

199 } 
	tw©chedKey
;

202 
	$w©chFÜKey
(
ş›Á
 *
c
, 
robj
 *
key
) {

203 
li¡
 *
ş›Ás
 = 
NULL
;

204 
li¡I‹r
 
li
;

205 
li¡Node
 *
Ê
;

206 
w©chedKey
 *
wk
;

209 
	`li¡Rewšd
(
c
->
w©ched_keys
,&
li
);

210 (
Ê
 = 
	`li¡Next
(&
li
))) {

211 
wk
 = 
	`li¡NodeV®ue
(
Ê
);

212 ià(
wk
->
db
 =ğ
c
->db && 
	`equ®SŒšgObjeùs
(
key
,wk->key))

216 
ş›Ás
 = 
	`diùF‘chV®ue
(
c
->
db
->
w©ched_keys
,
key
);

217 ià(!
ş›Ás
) {

218 
ş›Ás
 = 
	`li¡C»©e
();

219 
	`diùAdd
(
c
->
db
->
w©ched_keys
,
key
,
ş›Ás
);

220 
	`šüRefCouÁ
(
key
);

222 
	`li¡AddNodeTa
(
ş›Ás
,
c
);

224 
wk
 = 
	`zm®loc
((*wk));

225 
wk
->
key
 = key;

226 
wk
->
db
 = 
c
->db;

227 
	`šüRefCouÁ
(
key
);

228 
	`li¡AddNodeTa
(
c
->
w©ched_keys
,
wk
);

229 
	}
}

233 
	$unw©chAÎKeys
(
ş›Á
 *
c
) {

234 
li¡I‹r
 
li
;

235 
li¡Node
 *
Ê
;

237 ià(
	`li¡L’gth
(
c
->
w©ched_keys
) == 0) ;

238 
	`li¡Rewšd
(
c
->
w©ched_keys
,&
li
);

239 (
Ê
 = 
	`li¡Next
(&
li
))) {

240 
li¡
 *
ş›Ás
;

241 
w©chedKey
 *
wk
;

245 
wk
 = 
	`li¡NodeV®ue
(
Ê
);

246 
ş›Ás
 = 
	`diùF‘chV®ue
(
wk
->
db
->
w©ched_keys
, wk->
key
);

247 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
ş›Ás
 != NULL);

248 
	`li¡D–Node
(
ş›Ás
,
	`li¡S—rchKey
(ş›Ás,
c
));

250 ià(
	`li¡L’gth
(
ş›Ás
) == 0)

251 
	`diùD–‘e
(
wk
->
db
->
w©ched_keys
, wk->
key
);

253 
	`li¡D–Node
(
c
->
w©ched_keys
,
Ê
);

254 
	`deüRefCouÁ
(
wk
->
key
);

255 
	`zä“
(
wk
);

257 
	}
}

261 
	$touchW©chedKey
(
»disDb
 *
db
, 
robj
 *
key
) {

262 
li¡
 *
ş›Ás
;

263 
li¡I‹r
 
li
;

264 
li¡Node
 *
Ê
;

266 ià(
	`diùSize
(
db
->
w©ched_keys
) == 0) ;

267 
ş›Ás
 = 
	`diùF‘chV®ue
(
db
->
w©ched_keys
, 
key
);

268 ià(!
ş›Ás
) ;

272 
	`li¡Rewšd
(
ş›Ás
,&
li
);

273 (
Ê
 = 
	`li¡Next
(&
li
))) {

274 
ş›Á
 *
c
 = 
	`li¡NodeV®ue
(
Ê
);

276 
c
->
æags
 |ğ
CLIENT_DIRTY_CAS
;

278 
	}
}

284 
	$touchW©chedKeysOnFlush
(
dbid
) {

285 
li¡I‹r
 
li1
, 
li2
;

286 
li¡Node
 *
Ê
;

289 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li1
);

290 (
Ê
 = 
	`li¡Next
(&
li1
))) {

291 
ş›Á
 *
c
 = 
	`li¡NodeV®ue
(
Ê
);

292 
	`li¡Rewšd
(
c
->
w©ched_keys
,&
li2
);

293 (
Ê
 = 
	`li¡Next
(&
li2
))) {

294 
w©chedKey
 *
wk
 = 
	`li¡NodeV®ue
(
Ê
);

299 ià(
dbid
 =ğ-1 || 
wk
->
db
->
id
 == dbid) {

300 ià(
	`diùFšd
(
wk
->
db
->
diù
, wk->
key
->
±r
è!ğ
NULL
)

301 
c
->
æags
 |ğ
CLIENT_DIRTY_CAS
;

305 
	}
}

307 
	$w©chCommªd
(
ş›Á
 *
c
) {

308 
j
;

310 ià(
c
->
æags
 & 
CLIENT_MULTI
) {

311 
	`addR•lyE¼Ü
(
c
,"WATCH inside MULTI is‚ot‡llowed");

314 
j
 = 1; j < 
c
->
¬gc
; j++)

315 
	`w©chFÜKey
(
c
,c->
¬gv
[
j
]);

316 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

317 
	}
}

319 
	$unw©chCommªd
(
ş›Á
 *
c
) {

320 
	`unw©chAÎKeys
(
c
);

321 
c
->
æags
 &ğ(~
CLIENT_DIRTY_CAS
);

322 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

323 
	}
}

	@networking.c

30 
	~"£rv”.h
"

31 
	~<sys/uio.h
>

32 
	~<m©h.h
>

34 
¥¬£InU£
;

36 
£tPrÙocŞE¼Ü
(
ş›Á
 *
c
, 
pos
);

41 
size_t
 
	$sdsZm®locSize
(
sds
 
s
) {

42 *
sh
 = 
	`sdsAÎocPŒ
(
s
);

43  
	`zm®loc_size
(
sh
);

44 
	}
}

48 
size_t
 
	$g‘SŒšgObjeùSdsU£dMemÜy
(
robj
 *
o
) {

49 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

50 
o
->
’codšg
) {

51 
OBJ_ENCODING_RAW
:  
	`sdsZm®locSize
(
o
->
±r
);

52 
OBJ_ENCODING_EMBSTR
:  
	`zm®loc_size
(
o
)-(
robj
);

55 
	}
}

58 *
	$dupCl›ÁR•lyV®ue
(*
o
) {

59  
	`sdsdup
(
o
);

60 
	}
}

62 
	$ä“Cl›ÁR•lyV®ue
(*
o
) {

63 
	`sdsä“
(
o
);

64 
	}
}

66 
	$li¡M©chObjeùs
(*
a
, *
b
) {

67  
	`equ®SŒšgObjeùs
(
a
,
b
);

68 
	}
}

70 
ş›Á
 *
	$ü—‹Cl›Á
(
fd
) {

71 
ş›Á
 *
c
 = 
	`zm®loc
((client));

77 ià(
fd
 != -1) {

78 
	`ª‘NÚBlock
(
NULL
,
fd
);

79 
	`ª‘EÇbËTıNoD–ay
(
NULL
,
fd
);

80 ià(
£rv”
.
tık“·live
)

81 
	`ª‘K“pAlive
(
NULL
,
fd
,
£rv”
.
tık“·live
);

82 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
,

83 
»adQu”yFromCl›Á
, 
c
è=ğ
AE_ERR
)

85 
	`şo£
(
fd
);

86 
	`zä“
(
c
);

87  
NULL
;

91 
	`£ËùDb
(
c
,0);

92 
c
->
id
 = 
£rv”
.
Ãxt_ş›Á_id
++;

93 
c
->
fd
 = fd;

94 
c
->
Çme
 = 
NULL
;

95 
c
->
buåos
 = 0;

96 
c
->
qu”ybuf
 = 
	`sd£m±y
();

97 
c
->
qu”ybuf_³ak
 = 0;

98 
c
->
»qty³
 = 0;

99 
c
->
¬gc
 = 0;

100 
c
->
¬gv
 = 
NULL
;

101 
c
->
cmd
 = c->
Ï¡cmd
 = 
NULL
;

102 
c
->
muÉibulkËn
 = 0;

103 
c
->
bulkËn
 = -1;

104 
c
->
£ÁËn
 = 0;

105 
c
->
æags
 = 0;

106 
c
->
ùime
 = c->
Ï¡š‹¿ùiÚ
 = 
£rv”
.
unixtime
;

107 
c
->
auth’tiÿ‹d
 = 0;

108 
c
->
»¶¡©e
 = 
REPL_STATE_NONE
;

109 
c
->
»¶_put_Úlše_Ú_ack
 = 0;

110 
c
->
»¶off
 = 0;

111 
c
->
»¶_ack_off
 = 0;

112 
c
->
»¶_ack_time
 = 0;

113 
c
->
¦ave_li¡’šg_pÜt
 = 0;

114 
c
->
¦ave_
[0] = '\0';

115 
c
->
¦ave_ÿ·
 = 
SLAVE_CAPA_NONE
;

116 
c
->
»¶y
 = 
	`li¡C»©e
();

117 
c
->
»¶y_by‹s
 = 0;

118 
c
->
obuf_soá_lim™_»ached_time
 = 0;

119 
	`li¡S‘F»eM‘hod
(
c
->
»¶y
,
ä“Cl›ÁR•lyV®ue
);

120 
	`li¡S‘DupM‘hod
(
c
->
»¶y
,
dupCl›ÁR•lyV®ue
);

121 
c
->
bty³
 = 
BLOCKED_NONE
;

122 
c
->
bpİ
.
timeout
 = 0;

123 
c
->
bpİ
.
keys
 = 
	`diùC»©e
(&
objeùKeyPoš‹rV®ueDiùTy³
,
NULL
);

124 
c
->
bpİ
.
rg‘
 = 
NULL
;

125 
c
->
bpİ
.
num»¶iÿs
 = 0;

126 
c
->
bpİ
.
»¶off£t
 = 0;

127 
c
->
woff
 = 0;

128 
c
->
w©ched_keys
 = 
	`li¡C»©e
();

129 
c
->
pubsub_chªÃls
 = 
	`diùC»©e
(&
objeùKeyPoš‹rV®ueDiùTy³
,
NULL
);

130 
c
->
pubsub_·‰”ns
 = 
	`li¡C»©e
();

131 
c
->
³”id
 = 
NULL
;

132 
	`li¡S‘F»eM‘hod
(
c
->
pubsub_·‰”ns
,
deüRefCouÁVoid
);

133 
	`li¡S‘M©chM‘hod
(
c
->
pubsub_·‰”ns
,
li¡M©chObjeùs
);

134 ià(
fd
 !ğ-1è
	`li¡AddNodeTa
(
£rv”
.
ş›Ás
,
c
);

135 
	`š™Cl›ÁMuÉiS‹
(
c
);

136  
c
;

137 
	}
}

161 
	$´•¬eCl›ÁToWr™e
(
ş›Á
 *
c
) {

164 ià(
c
->
æags
 & (
CLIENT_LUA
|
CLIENT_MODULE
)è 
C_OK
;

167 ià(
c
->
æags
 & (
CLIENT_REPLY_OFF
|
CLIENT_REPLY_SKIP
)è 
C_ERR
;

171 ià((
c
->
æags
 & 
CLIENT_MASTER
) &&

172 !(
c
->
æags
 & 
CLIENT_MASTER_FORCE_REPLY
)è 
C_ERR
;

174 ià(
c
->
fd
 <ğ0è 
C_ERR
;

180 ià(!
	`ş›ÁHasP’dšgR•l›s
(
c
) &&

181 !(
c
->
æags
 & 
CLIENT_PENDING_WRITE
) &&

182 (
c
->
»¶¡©e
 =ğ
REPL_STATE_NONE
 ||

183 (
c
->
»¶¡©e
 =ğ
SLAVE_STATE_ONLINE
 && !c->
»¶_put_Úlše_Ú_ack
)))

191 
c
->
æags
 |ğ
CLIENT_PENDING_WRITE
;

192 
	`li¡AddNodeH—d
(
£rv”
.
ş›Ás_³ndšg_wr™e
,
c
);

196  
C_OK
;

197 
	}
}

203 
	$_addR•lyToBufãr
(
ş›Á
 *
c
, cÚ¡ *
s
, 
size_t
 
Ën
) {

204 
size_t
 
avaabË
 = (
c
->
buf
)-c->
buåos
;

206 ià(
c
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
è 
C_OK
;

210 ià(
	`li¡L’gth
(
c
->
»¶y
è> 0è 
C_ERR
;

213 ià(
Ën
 > 
avaabË
è 
C_ERR
;

216 
	`memıy
(
c
->
buf
+c->
buåos
,
s
,
Ën
);

217 
c
->
buåos
+=
Ën
;

218  
C_OK
;

219 
	}
}

221 
	$_addR•lyObjeùToLi¡
(
ş›Á
 *
c
, 
robj
 *
o
) {

222 ià(
c
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
) ;

224 ià(
	`li¡L’gth
(
c
->
»¶y
) == 0) {

225 
sds
 
s
 = 
	`sdsdup
(
o
->
±r
);

226 
	`li¡AddNodeTa
(
c
->
»¶y
,
s
);

227 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
s
);

230 
li¡Node
 *
Ê
 = 
	`li¡La¡
(
c
->
»¶y
);

231 
sds
 

 = 
	`li¡NodeV®ue
(
Ê
);

236 ià(

 && 
	`sd¦’
Ña)+sd¦’(
o
->
±r
è<ğ
PROTO_REPLY_CHUNK_BYTES
) {

237 

 = 
	`sdsÿtsds
Ña,
o
->
±r
);

238 
	`li¡NodeV®ue
(
Ê
èğ

;

239 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
o
->
±r
);

241 
sds
 
s
 = 
	`sdsdup
(
o
->
±r
);

242 
	`li¡AddNodeTa
(
c
->
»¶y
,
s
);

243 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
s
);

247 
	`asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
c
);

248 
	}
}

252 
	$_addR•lySdsToLi¡
(
ş›Á
 *
c
, 
sds
 
s
) {

253 ià(
c
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
) {

254 
	`sdsä“
(
s
);

258 ià(
	`li¡L’gth
(
c
->
»¶y
) == 0) {

259 
	`li¡AddNodeTa
(
c
->
»¶y
,
s
);

260 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
s
);

262 
li¡Node
 *
Ê
 = 
	`li¡La¡
(
c
->
»¶y
);

263 
sds
 

 = 
	`li¡NodeV®ue
(
Ê
);

267 ià(

 && 
	`sd¦’
Ña)+sd¦’(
s
è<ğ
PROTO_REPLY_CHUNK_BYTES
) {

268 

 = 
	`sdsÿtsds
Ña,
s
);

269 
	`li¡NodeV®ue
(
Ê
èğ

;

270 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
s
);

271 
	`sdsä“
(
s
);

273 
	`li¡AddNodeTa
(
c
->
»¶y
,
s
);

274 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
s
);

277 
	`asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
c
);

278 
	}
}

280 
	$_addR•lySŒšgToLi¡
(
ş›Á
 *
c
, cÚ¡ *
s
, 
size_t
 
Ën
) {

281 ià(
c
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
) ;

283 ià(
	`li¡L’gth
(
c
->
»¶y
) == 0) {

284 
sds
 
node
 = 
	`sd¢ewËn
(
s
,
Ën
);

285 
	`li¡AddNodeTa
(
c
->
»¶y
,
node
);

286 
c
->
»¶y_by‹s
 +ğ
Ën
;

288 
li¡Node
 *
Ê
 = 
	`li¡La¡
(
c
->
»¶y
);

289 
sds
 

 = 
	`li¡NodeV®ue
(
Ê
);

293 ià(

 && 
	`sd¦’
Ña)+
Ën
 <ğ
PROTO_REPLY_CHUNK_BYTES
) {

294 

 = 
	`sdsÿ’
Ña,
s
,
Ën
);

295 
	`li¡NodeV®ue
(
Ê
èğ

;

296 
c
->
»¶y_by‹s
 +ğ
Ën
;

298 
sds
 
node
 = 
	`sd¢ewËn
(
s
,
Ën
);

299 
	`li¡AddNodeTa
(
c
->
»¶y
,
node
);

300 
c
->
»¶y_by‹s
 +ğ
Ën
;

303 
	`asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
c
);

304 
	}
}

311 
	$addR•ly
(
ş›Á
 *
c
, 
robj
 *
obj
) {

312 ià(
	`´•¬eCl›ÁToWr™e
(
c
è!ğ
C_OK
) ;

321 ià(
	`sdsEncodedObjeù
(
obj
)) {

323 ià(
	`_addR•lyToBufãr
(
c
,
obj
->
±r
,
	`sd¦’
(obj->±r)è!ğ
C_OK
)

324 
	`_addR•lyObjeùToLi¡
(
c
,
obj
);

325 } ià(
obj
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

329 ià(
	`li¡L’gth
(
c
->
»¶y
è=ğ0 && ((c->
buf
è- c->
buåos
) >= 32) {

330 
buf
[32];

331 
Ën
;

333 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),()
obj
->
±r
);

334 ià(
	`_addR•lyToBufãr
(
c
,
buf
,
Ën
è=ğ
C_OK
) {

341 
obj
 = 
	`g‘DecodedObjeù
(obj);

342 ià(
	`_addR•lyToBufãr
(
c
,
obj
->
±r
,
	`sd¦’
(obj->±r)è!ğ
C_OK
)

343 
	`_addR•lyObjeùToLi¡
(
c
,
obj
);

344 
	`deüRefCouÁ
(
obj
);

346 
	`£rv”Pªic
("Wrong obj->encoding in‡ddReply()");

349 
	}
}

351 
	$addR•lySds
(
ş›Á
 *
c
, 
sds
 
s
) {

352 ià(
	`´•¬eCl›ÁToWr™e
(
c
è!ğ
C_OK
) {

354 
	`sdsä“
(
s
);

357 ià(
	`_addR•lyToBufãr
(
c
,
s
,
	`sd¦’
(s)è=ğ
C_OK
) {

358 
	`sdsä“
(
s
);

361 
	`_addR•lySdsToLi¡
(
c
,
s
);

363 
	}
}

365 
	$addR•lySŒšg
(
ş›Á
 *
c
, cÚ¡ *
s
, 
size_t
 
Ën
) {

366 ià(
	`´•¬eCl›ÁToWr™e
(
c
è!ğ
C_OK
) ;

367 ià(
	`_addR•lyToBufãr
(
c
,
s
,
Ën
è!ğ
C_OK
)

368 
	`_addR•lySŒšgToLi¡
(
c
,
s
,
Ën
);

369 
	}
}

371 
	$addR•lyE¼ÜL’gth
(
ş›Á
 *
c
, cÚ¡ *
s
, 
size_t
 
Ën
) {

372 
	`addR•lySŒšg
(
c
,"-ERR ",5);

373 
	`addR•lySŒšg
(
c
,
s
,
Ën
);

374 
	`addR•lySŒšg
(
c
,"\r\n",2);

375 
	}
}

377 
	$addR•lyE¼Ü
(
ş›Á
 *
c
, cÚ¡ *
”r
) {

378 
	`addR•lyE¼ÜL’gth
(
c
,
”r
,
	`¡¾’
(err));

379 
	}
}

381 
	$addR•lyE¼ÜFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...) {

382 
size_t
 
l
, 
j
;

383 
va_li¡
 
­
;

384 
	`va_¡¬t
(
­
,
fmt
);

385 
sds
 
s
 = 
	`sdsÿtv´štf
(
	`sd£m±y
(),
fmt
,
­
);

386 
	`va_’d
(
­
);

389 
l
 = 
	`sd¦’
(
s
);

390 
j
 = 0; j < 
l
; j++) {

391 ià(
s
[
j
] == '\r' || s[j] == '\n') s[j] = ' ';

393 
	`addR•lyE¼ÜL’gth
(
c
,
s
,
	`sd¦’
(s));

394 
	`sdsä“
(
s
);

395 
	}
}

397 
	$addR•lyStusL’gth
(
ş›Á
 *
c
, cÚ¡ *
s
, 
size_t
 
Ën
) {

398 
	`addR•lySŒšg
(
c
,"+",1);

399 
	`addR•lySŒšg
(
c
,
s
,
Ën
);

400 
	`addR•lySŒšg
(
c
,"\r\n",2);

401 
	}
}

403 
	$addR•lyStus
(
ş›Á
 *
c
, cÚ¡ *
¡©us
) {

404 
	`addR•lyStusL’gth
(
c
,
¡©us
,
	`¡¾’
(status));

405 
	}
}

407 
	$addR•lyStusFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...) {

408 
va_li¡
 
­
;

409 
	`va_¡¬t
(
­
,
fmt
);

410 
sds
 
s
 = 
	`sdsÿtv´štf
(
	`sd£m±y
(),
fmt
,
­
);

411 
	`va_’d
(
­
);

412 
	`addR•lyStusL’gth
(
c
,
s
,
	`sd¦’
(s));

413 
	`sdsä“
(
s
);

414 
	}
}

418 *
	$addDeã¼edMuÉiBulkL’gth
(
ş›Á
 *
c
) {

422 ià(
	`´•¬eCl›ÁToWr™e
(
c
è!ğ
C_OK
è 
NULL
;

423 
	`li¡AddNodeTa
(
c
->
»¶y
,
NULL
);

424  
	`li¡La¡
(
c
->
»¶y
);

425 
	}
}

428 
	$£tDeã¼edMuÉiBulkL’gth
(
ş›Á
 *
c
, *
node
, 
Ëngth
) {

429 
li¡Node
 *
Ê
 = (li¡Node*)
node
;

430 
sds
 
Ën
, 
Ãxt
;

434 ià(
node
 =ğ
NULL
) ;

436 
Ën
 = 
	`sdsÿrštf
(
	`sd¢ewËn
("*",1),"%ld\r\n",
Ëngth
);

437 
	`li¡NodeV®ue
(
Ê
èğ
Ën
;

438 
c
->
»¶y_by‹s
 +ğ
	`sd¦’
(
Ën
);

439 ià(
Ê
->
Ãxt
 !ğ
NULL
) {

440 
Ãxt
 = 
	`li¡NodeV®ue
(
Ê
->next);

443 ià(
Ãxt
 !ğ
NULL
) {

444 
Ën
 = 
	`sdsÿtsds
Ö’,
Ãxt
);

445 
	`li¡D–Node
(
c
->
»¶y
,
Ê
->
Ãxt
);

446 
	`li¡NodeV®ue
(
Ê
èğ
Ën
;

451 
	`asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
c
);

452 
	}
}

455 
	$addR•lyDoubË
(
ş›Á
 *
c
, 
d
) {

456 
dbuf
[128], 
sbuf
[128];

457 
dËn
, 
¦’
;

458 ià(
	`isšf
(
d
)) {

461 
	`addR•lyBulkCSŒšg
(
c
, 
d
 > 0 ? "inf" : "-inf");

463 
dËn
 = 
	`¢´štf
(
dbuf
,(dbuf),"%.17g",
d
);

464 
¦’
 = 
	`¢´štf
(
sbuf
,(sbuf),"$%d\r\n%s\r\n",
dËn
,
dbuf
);

465 
	`addR•lySŒšg
(
c
,
sbuf
,
¦’
);

467 
	}
}

472 
	$addR•lyHumªLÚgDoubË
(
ş›Á
 *
c
, 
d
) {

473 
robj
 *
o
 = 
	`ü—‹SŒšgObjeùFromLÚgDoubË
(
d
,1);

474 
	`addR•lyBulk
(
c
,
o
);

475 
	`deüRefCouÁ
(
o
);

476 
	}
}

480 
	$addR•lyLÚgLÚgW™hP»fix
(
ş›Á
 *
c
, 
Î
, 
´efix
) {

481 
buf
[128];

482 
Ën
;

487 ià(
´efix
 =ğ'*' && 
Î
 < 
OBJ_SHARED_BULKHDR_LEN
 &&†l >= 0) {

488 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[
Î
]);

490 } ià(
´efix
 =ğ'$' && 
Î
 < 
OBJ_SHARED_BULKHDR_LEN
 &&†l >= 0) {

491 
	`addR•ly
(
c
,
sh¬ed
.
bulkhdr
[
Î
]);

495 
buf
[0] = 
´efix
;

496 
Ën
 = 
	`Î2¡ršg
(
buf
+1,(buf)-1,
Î
);

497 
buf
[
Ën
+1] = '\r';

498 
buf
[
Ën
+2] = '\n';

499 
	`addR•lySŒšg
(
c
,
buf
,
Ën
+3);

500 
	}
}

502 
	$addR•lyLÚgLÚg
(
ş›Á
 *
c
, 
Î
) {

503 ià(
Î
 == 0)

504 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

505 ià(
Î
 == 1)

506 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

508 
	`addR•lyLÚgLÚgW™hP»fix
(
c
,
Î
,':');

509 
	}
}

511 
	$addR•lyMuÉiBulkL’
(
ş›Á
 *
c
, 
Ëngth
) {

512 ià(
Ëngth
 < 
OBJ_SHARED_BULKHDR_LEN
)

513 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[
Ëngth
]);

515 
	`addR•lyLÚgLÚgW™hP»fix
(
c
,
Ëngth
,'*');

516 
	}
}

519 
	$addR•lyBulkL’
(
ş›Á
 *
c
, 
robj
 *
obj
) {

520 
size_t
 
Ën
;

523 ià(
	`sdsEncodedObjeù
(
obj
)) {

524 
Ën
 = 
	`sd¦’
(
obj
->
±r
);

526 
n
 = ()
obj
->
±r
;

529 
Ën
 = 1;

530 ià(
n
 < 0) {

531 
Ën
++;

532 
n
 = -n;

534 (
n
 =‚/10) != 0) {

535 
Ën
++;

539 ià(
Ën
 < 
OBJ_SHARED_BULKHDR_LEN
)

540 
	`addR•ly
(
c
,
sh¬ed
.
bulkhdr
[
Ën
]);

542 
	`addR•lyLÚgLÚgW™hP»fix
(
c
,
Ën
,'$');

543 
	}
}

546 
	$addR•lyBulk
(
ş›Á
 *
c
, 
robj
 *
obj
) {

548 
	`addR•lyBulkL’
(
c
,
obj
);

549 
	`addR•ly
(
c
,
obj
);

550 
	`addR•ly
(
c
,
sh¬ed
.
ülf
);

551 
	}
}

554 
	$addR•lyBulkCBufãr
(
ş›Á
 *
c
, cÚ¡ *
p
, 
size_t
 
Ën
) {

555 
	`addR•lyLÚgLÚgW™hP»fix
(
c
,
Ën
,'$');

556 
	`addR•lySŒšg
(
c
,
p
,
Ën
);

557 
	`addR•ly
(
c
,
sh¬ed
.
ülf
);

558 
	}
}

561 
	$addR•lyBulkSds
(
ş›Á
 *
c
, 
sds
 
s
) {

562 
	`addR•lySds
(
c
,
	`sdsÿtfmt
(
	`sd£m±y
(),"$%u\r\n",

563 ()
	`sd¦’
(
s
)));

564 
	`addR•lySds
(
c
,
s
);

565 
	`addR•ly
(
c
,
sh¬ed
.
ülf
);

566 
	}
}

569 
	$addR•lyBulkCSŒšg
(
ş›Á
 *
c
, cÚ¡ *
s
) {

570 ià(
s
 =ğ
NULL
) {

571 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

573 
	`addR•lyBulkCBufãr
(
c
,
s
,
	`¡¾’
(s));

575 
	}
}

578 
	$addR•lyBulkLÚgLÚg
(
ş›Á
 *
c
, 
Î
) {

579 
buf
[64];

580 
Ën
;

582 
Ën
 = 
	`Î2¡ršg
(
buf
,64,
Î
);

583 
	`addR•lyBulkCBufãr
(
c
,
buf
,
Ën
);

584 
	}
}

589 
	$cİyCl›ÁOuutBufãr
(
ş›Á
 *
d¡
, cl›Á *
¤c
) {

590 
	`li¡R–—£
(
d¡
->
»¶y
);

591 
d¡
->
»¶y
 = 
	`li¡Dup
(
¤c
->reply);

592 
	`memıy
(
d¡
->
buf
,
¤c
->buf,¤c->
buåos
);

593 
d¡
->
buåos
 = 
¤c
->bufpos;

594 
d¡
->
»¶y_by‹s
 = 
¤c
->reply_bytes;

595 
	}
}

599 
	$ş›ÁHasP’dšgR•l›s
(
ş›Á
 *
c
) {

600  
c
->
buåos
 || 
	`li¡L’gth
(c->
»¶y
);

601 
	}
}

603 
	#MAX_ACCEPTS_PER_CALL
 1000

	)

604 
	$acû±CommÚHªdËr
(
fd
, 
æags
, *

) {

605 
ş›Á
 *
c
;

606 ià((
c
 = 
	`ü—‹Cl›Á
(
fd
)è=ğ
NULL
) {

607 
	`£rv”Log
(
LL_WARNING
,

609 
	`¡»¼Ü
(
”ºo
),
fd
);

610 
	`şo£
(
fd
);

617 ià(
	`li¡L’gth
(
£rv”
.
ş›Ás
è> s”v”.
maxş›Ás
) {

618 *
”r
 = "-ERR max‚umber of clients„eached\r\n";

621 ià(
	`wr™e
(
c
->
fd
,
”r
,
	`¡¾’
(err)) == -1) {

624 
£rv”
.
¡©_»jeùed_cÚn
++;

625 
	`ä“Cl›Á
(
c
);

633 ià(
£rv”
.
´Ùeùed_mode
 &&

634 
£rv”
.
bšdaddr_couÁ
 == 0 &&

635 
£rv”
.
»quœ•ass
 =ğ
NULL
 &&

636 !(
æags
 & 
CLIENT_UNIX_SOCKET
) &&

637 

 !ğ
NULL
)

639 ià(
	`¡rcmp
(

,"127.0.0.1") && strcmp(ip,"::1")) {

640 *
”r
 =

661 ià(
	`wr™e
(
c
->
fd
,
”r
,
	`¡¾’
(err)) == -1) {

664 
£rv”
.
¡©_»jeùed_cÚn
++;

665 
	`ä“Cl›Á
(
c
);

670 
£rv”
.
¡©_numcÚÃùiÚs
++;

671 
c
->
æags
 |= flags;

672 
	}
}

674 
	$acû±TıHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

675 
ıÜt
, 
cfd
, 
max
 = 
MAX_ACCEPTS_PER_CALL
;

676 
c
[
NET_IP_STR_LEN
];

677 
	`UNUSED
(
–
);

678 
	`UNUSED
(
mask
);

679 
	`UNUSED
(
´ivd©a
);

681 
max
--) {

682 
cfd
 = 
	`ª‘TıAcû±
(
£rv”
.
Ã‹¼
, 
fd
, 
c
, (c), &
ıÜt
);

683 ià(
cfd
 =ğ
ANET_ERR
) {

684 ià(
”ºo
 !ğ
EWOULDBLOCK
)

685 
	`£rv”Log
(
LL_WARNING
,

686 "Acû±šg cl›Á cÚÃùiÚ: %s", 
£rv”
.
Ã‹¼
);

689 
	`£rv”Log
(
LL_VERBOSE
,"Acû±ed %s:%d", 
c
, 
ıÜt
);

690 
	`acû±CommÚHªdËr
(
cfd
,0,
c
);

692 
	}
}

694 
	$acû±UnixHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

695 
cfd
, 
max
 = 
MAX_ACCEPTS_PER_CALL
;

696 
	`UNUSED
(
–
);

697 
	`UNUSED
(
mask
);

698 
	`UNUSED
(
´ivd©a
);

700 
max
--) {

701 
cfd
 = 
	`ª‘UnixAcû±
(
£rv”
.
Ã‹¼
, 
fd
);

702 ià(
cfd
 =ğ
ANET_ERR
) {

703 ià(
”ºo
 !ğ
EWOULDBLOCK
)

704 
	`£rv”Log
(
LL_WARNING
,

705 "Acû±šg cl›Á cÚÃùiÚ: %s", 
£rv”
.
Ã‹¼
);

708 
	`£rv”Log
(
LL_VERBOSE
,"Acû±ed cÚÃùiÚØ%s", 
£rv”
.
unixsock‘
);

709 
	`acû±CommÚHªdËr
(
cfd
,
CLIENT_UNIX_SOCKET
,
NULL
);

711 
	}
}

713 
	$ä“Cl›ÁArgv
(
ş›Á
 *
c
) {

714 
j
;

715 
j
 = 0; j < 
c
->
¬gc
; j++)

716 
	`deüRefCouÁ
(
c
->
¬gv
[
j
]);

717 
c
->
¬gc
 = 0;

718 
c
->
cmd
 = 
NULL
;

719 
	}
}

724 
	$discÚÃùSÏves
() {

725 
	`li¡L’gth
(
£rv”
.
¦aves
)) {

726 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
£rv”
.
¦aves
);

727 
	`ä“Cl›Á
((
ş›Á
*)
Ê
->
v®ue
);

729 
	}
}

734 
	$uÆškCl›Á
(
ş›Á
 *
c
) {

735 
li¡Node
 *
Ê
;

738 ià(
£rv”
.
cu¼’t_ş›Á
 =ğ
c
è£rv”.cu¼’t_ş›Á = 
NULL
;

743 ià(
c
->
fd
 != -1) {

745 
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
ş›Ás
,
c
);

746 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

747 
	`li¡D–Node
(
£rv”
.
ş›Ás
,
Ê
);

750 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
c
->
fd
,
AE_READABLE
);

751 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
c
->
fd
,
AE_WRITABLE
);

752 
	`şo£
(
c
->
fd
);

753 
c
->
fd
 = -1;

757 ià(
c
->
æags
 & 
CLIENT_PENDING_WRITE
) {

758 
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
ş›Ás_³ndšg_wr™e
,
c
);

759 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

760 
	`li¡D–Node
(
£rv”
.
ş›Ás_³ndšg_wr™e
,
Ê
);

761 
c
->
æags
 &ğ~
CLIENT_PENDING_WRITE
;

766 ià(
c
->
æags
 & 
CLIENT_UNBLOCKED
) {

767 
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
unblocked_ş›Ás
,
c
);

768 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

769 
	`li¡D–Node
(
£rv”
.
unblocked_ş›Ás
,
Ê
);

770 
c
->
æags
 &ğ~
CLIENT_UNBLOCKED
;

772 
	}
}

774 
	$ä“Cl›Á
(
ş›Á
 *
c
) {

775 
li¡Node
 *
Ê
;

782 ià(
£rv”
.
ma¡”
 && 
c
->
æags
 & 
CLIENT_MASTER
) {

783 
	`£rv”Log
(
LL_WARNING
,"Connection with master†ost.");

784 ià(!(
c
->
æags
 & (
CLIENT_CLOSE_AFTER_REPLY
|

785 
CLIENT_CLOSE_ASAP
|

786 
CLIENT_BLOCKED
|

787 
CLIENT_UNBLOCKED
)))

789 
	`»¶iÿtiÚCacheMa¡”
(
c
);

795 ià((
c
->
æags
 & 
CLIENT_SLAVE
è&& !(c->æag & 
CLIENT_MONITOR
)) {

796 
	`£rv”Log
(
LL_WARNING
,"Connection with slave %s†ost.",

797 
	`»¶iÿtiÚG‘SÏveName
(
c
));

801 
	`sdsä“
(
c
->
qu”ybuf
);

802 
c
->
qu”ybuf
 = 
NULL
;

805 ià(
c
->
æags
 & 
CLIENT_BLOCKED
è
	`unblockCl›Á
(c);

806 
	`diùR–—£
(
c
->
bpİ
.
keys
);

809 
	`unw©chAÎKeys
(
c
);

810 
	`li¡R–—£
(
c
->
w©ched_keys
);

813 
	`pubsubUnsubsüibeAÎChªÃls
(
c
,0);

814 
	`pubsubUnsubsüibeAÎP©‹ºs
(
c
,0);

815 
	`diùR–—£
(
c
->
pubsub_chªÃls
);

816 
	`li¡R–—£
(
c
->
pubsub_·‰”ns
);

819 
	`li¡R–—£
(
c
->
»¶y
);

820 
	`ä“Cl›ÁArgv
(
c
);

825 
	`uÆškCl›Á
(
c
);

829 ià(
c
->
æags
 & 
CLIENT_SLAVE
) {

830 ià(
c
->
»¶¡©e
 =ğ
SLAVE_STATE_SEND_BULK
) {

831 ià(
c
->
»¶dbfd
 !ğ-1è
	`şo£
(c->repldbfd);

832 ià(
c
->
»¶´—mbË
è
	`sdsä“
(c->replpreamble);

834 
li¡
 *
l
 = (
c
->
æags
 & 
CLIENT_MONITOR
è? 
£rv”
.
mÚ™Üs
 : s”v”.
¦aves
;

835 
Ê
 = 
	`li¡S—rchKey
(
l
,
c
);

836 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

837 
	`li¡D–Node
(
l
,
Ê
);

841 ià(
c
->
æags
 & 
CLIENT_SLAVE
 && 
	`li¡L’gth
(
£rv”
.
¦aves
) == 0)

842 
£rv”
.
»¶_no_¦aves_sšû
 = s”v”.
unixtime
;

843 
	`»äeshGoodSÏvesCouÁ
();

848 ià(
c
->
æags
 & 
CLIENT_MASTER
è
	`»¶iÿtiÚHªdËMa¡”DiscÚÃùiÚ
();

852 ià(
c
->
æags
 & 
CLIENT_CLOSE_ASAP
) {

853 
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
ş›Ás_to_şo£
,
c
);

854 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

855 
	`li¡D–Node
(
£rv”
.
ş›Ás_to_şo£
,
Ê
);

860 ià(
c
->
Çme
è
	`deüRefCouÁ
(c->name);

861 
	`zä“
(
c
->
¬gv
);

862 
	`ä“Cl›ÁMuÉiS‹
(
c
);

863 
	`sdsä“
(
c
->
³”id
);

864 
	`zä“
(
c
);

865 
	}
}

871 
	$ä“Cl›ÁAsync
(
ş›Á
 *
c
) {

872 ià(
c
->
æags
 & 
CLIENT_CLOSE_ASAP
 || c->æag & 
CLIENT_LUA
) ;

873 
c
->
æags
 |ğ
CLIENT_CLOSE_ASAP
;

874 
	`li¡AddNodeTa
(
£rv”
.
ş›Ás_to_şo£
,
c
);

875 
	}
}

877 
	$ä“Cl›ÁsInAsyncF»eQueue
() {

878 
	`li¡L’gth
(
£rv”
.
ş›Ás_to_şo£
)) {

879 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
£rv”
.
ş›Ás_to_şo£
);

880 
ş›Á
 *
c
 = 
	`li¡NodeV®ue
(
Ê
);

882 
c
->
æags
 &ğ~
CLIENT_CLOSE_ASAP
;

883 
	`ä“Cl›Á
(
c
);

884 
	`li¡D–Node
(
£rv”
.
ş›Ás_to_şo£
,
Ê
);

886 
	}
}

890 
	$wr™eToCl›Á
(
fd
, 
ş›Á
 *
c
, 
hªdËr_š¡®Ëd
) {

891 
ssize_t
 
nwr™‹n
 = 0, 
tÙwr™‹n
 = 0;

892 
size_t
 
objËn
;

893 
sds
 
o
;

895 
	`ş›ÁHasP’dšgR•l›s
(
c
)) {

896 ià(
c
->
buåos
 > 0) {

897 
nwr™‹n
 = 
	`wr™e
(
fd
,
c
->
buf
+c->
£ÁËn
,c->
buåos
-c->sentlen);

898 ià(
nwr™‹n
 <= 0) ;

899 
c
->
£ÁËn
 +ğ
nwr™‹n
;

900 
tÙwr™‹n
 +ğ
nwr™‹n
;

904 ià(()
c
->
£ÁËn
 =ğc->
buåos
) {

905 
c
->
buåos
 = 0;

906 
c
->
£ÁËn
 = 0;

909 
o
 = 
	`li¡NodeV®ue
(
	`li¡Fœ¡
(
c
->
»¶y
));

910 
objËn
 = 
	`sd¦’
(
o
);

912 ià(
objËn
 == 0) {

913 
	`li¡D–Node
(
c
->
»¶y
,
	`li¡Fœ¡
(c->reply));

917 
nwr™‹n
 = 
	`wr™e
(
fd
, 
o
 + 
c
->
£ÁËn
, 
objËn
 - c->sentlen);

918 ià(
nwr™‹n
 <= 0) ;

919 
c
->
£ÁËn
 +ğ
nwr™‹n
;

920 
tÙwr™‹n
 +ğ
nwr™‹n
;

923 ià(
c
->
£ÁËn
 =ğ
objËn
) {

924 
	`li¡D–Node
(
c
->
»¶y
,
	`li¡Fœ¡
(c->reply));

925 
c
->
£ÁËn
 = 0;

926 
c
->
»¶y_by‹s
 -ğ
objËn
;

937 
£rv”
.
¡©_Ãt_ouut_by‹s
 +ğ
tÙwr™‹n
;

938 ià(
tÙwr™‹n
 > 
NET_MAX_WRITES_PER_EVENT
 &&

939 (
£rv”
.
maxmemÜy
 == 0 ||

940 
	`zm®loc_u£d_memÜy
(è< 
£rv”
.
maxmemÜy
)) ;

942 ià(
nwr™‹n
 == -1) {

943 ià(
”ºo
 =ğ
EAGAIN
) {

944 
nwr™‹n
 = 0;

946 
	`£rv”Log
(
LL_VERBOSE
,

947 "E¼Ü wr™šgØş›Á: %s", 
	`¡»¼Ü
(
”ºo
));

948 
	`ä“Cl›Á
(
c
);

949  
C_ERR
;

952 ià(
tÙwr™‹n
 > 0) {

957 ià(!(
c
->
æags
 & 
CLIENT_MASTER
)èc->
Ï¡š‹¿ùiÚ
 = 
£rv”
.
unixtime
;

959 ià(!
	`ş›ÁHasP’dšgR•l›s
(
c
)) {

960 
c
->
£ÁËn
 = 0;

961 ià(
hªdËr_š¡®Ëd
è
	`«D–‘eFeEv’t
(
£rv”
.
–
,
c
->
fd
,
AE_WRITABLE
);

964 ià(
c
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
) {

965 
	`ä“Cl›Á
(
c
);

966  
C_ERR
;

969  
C_OK
;

970 
	}
}

973 
	$£ndR•lyToCl›Á
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

974 
	`UNUSED
(
–
);

975 
	`UNUSED
(
mask
);

976 
	`wr™eToCl›Á
(
fd
,
´ivd©a
,1);

977 
	}
}

983 
	$hªdËCl›ÁsW™hP’dšgWr™es
() {

984 
li¡I‹r
 
li
;

985 
li¡Node
 *
Ê
;

986 
´oûs£d
 = 
	`li¡L’gth
(
£rv”
.
ş›Ás_³ndšg_wr™e
);

988 
	`li¡Rewšd
(
£rv”
.
ş›Ás_³ndšg_wr™e
,&
li
);

989 (
Ê
 = 
	`li¡Next
(&
li
))) {

990 
ş›Á
 *
c
 = 
	`li¡NodeV®ue
(
Ê
);

991 
c
->
æags
 &ğ~
CLIENT_PENDING_WRITE
;

992 
	`li¡D–Node
(
£rv”
.
ş›Ás_³ndšg_wr™e
,
Ê
);

995 ià(
	`wr™eToCl›Á
(
c
->
fd
,c,0è=ğ
C_ERR
) ;

999 ià(
	`ş›ÁHasP’dšgR•l›s
(
c
) &&

1000 
	`«C»©eFeEv’t
(
£rv”
.
–
, 
c
->
fd
, 
AE_WRITABLE
,

1001 
£ndR•lyToCl›Á
, 
c
è=ğ
AE_ERR
)

1003 
	`ä“Cl›ÁAsync
(
c
);

1006  
´oûs£d
;

1007 
	}
}

1010 
	$»£tCl›Á
(
ş›Á
 *
c
) {

1011 
»disCommªdProc
 *
´evcmd
 = 
c
->
cmd
 ? c->cmd->
´oc
 : 
NULL
;

1013 
	`ä“Cl›ÁArgv
(
c
);

1014 
c
->
»qty³
 = 0;

1015 
c
->
muÉibulkËn
 = 0;

1016 
c
->
bulkËn
 = -1;

1020 ià(!(
c
->
æags
 & 
CLIENT_MULTI
è&& 
´evcmd
 !ğ
askšgCommªd
)

1021 
c
->
æags
 &ğ~
CLIENT_ASKING
;

1026 
c
->
æags
 &ğ~
CLIENT_REPLY_SKIP
;

1027 ià(
c
->
æags
 & 
CLIENT_REPLY_SKIP_NEXT
) {

1028 
c
->
æags
 |ğ
CLIENT_REPLY_SKIP
;

1029 
c
->
æags
 &ğ~
CLIENT_REPLY_SKIP_NEXT
;

1031 
	}
}

1033 
	$´oûssIÆšeBufãr
(
ş›Á
 *
c
) {

1034 *
Ãwlše
;

1035 
¬gc
, 
j
;

1036 
sds
 *
¬gv
, 
aux
;

1037 
size_t
 
qu”yËn
;

1040 
Ãwlše
 = 
	`¡rchr
(
c
->
qu”ybuf
,'\n');

1043 ià(
Ãwlše
 =ğ
NULL
) {

1044 ià(
	`sd¦’
(
c
->
qu”ybuf
è> 
PROTO_INLINE_MAX_SIZE
) {

1045 
	`addR•lyE¼Ü
(
c
,"Protocolƒrror:oo big inline„equest");

1046 
	`£tPrÙocŞE¼Ü
(
c
,0);

1048  
C_ERR
;

1052 ià(
Ãwlše
 &&‚ewlš!ğ
c
->
qu”ybuf
 && *(newline-1) == '\r')

1053 
Ãwlše
--;

1056 
qu”yËn
 = 
Ãwlše
-(
c
->
qu”ybuf
);

1057 
aux
 = 
	`sd¢ewËn
(
c
->
qu”ybuf
,
qu”yËn
);

1058 
¬gv
 = 
	`sds¥l™¬gs
(
aux
,&
¬gc
);

1059 
	`sdsä“
(
aux
);

1060 ià(
¬gv
 =ğ
NULL
) {

1061 
	`addR•lyE¼Ü
(
c
,"Protocolƒrror: unbalanced quotes in„equest");

1062 
	`£tPrÙocŞE¼Ü
(
c
,0);

1063  
C_ERR
;

1069 ià(
qu”yËn
 =ğ0 && 
c
->
æags
 & 
CLIENT_SLAVE
)

1070 
c
->
»¶_ack_time
 = 
£rv”
.
unixtime
;

1073 
	`sd¤ªge
(
c
->
qu”ybuf
,
qu”yËn
+2,-1);

1076 ià(
¬gc
) {

1077 ià(
c
->
¬gv
è
	`zä“
(c->argv);

1078 
c
->
¬gv
 = 
	`zm®loc
((
robj
*)*
¬gc
);

1082 
c
->
¬gc
 = 0, 
j
 = 0; j <‡rgc; j++) {

1083 ià(
	`sd¦’
(
¬gv
[
j
])) {

1084 
c
->
¬gv
[c->
¬gc
] = 
	`ü—‹Objeù
(
OBJ_STRING
,¬gv[
j
]);

1085 
c
->
¬gc
++;

1087 
	`sdsä“
(
¬gv
[
j
]);

1090 
	`zä“
(
¬gv
);

1091  
C_OK
;

1092 
	}
}

1096 
	$£tPrÙocŞE¼Ü
(
ş›Á
 *
c
, 
pos
) {

1097 ià(
£rv”
.
v”bos™y
 <ğ
LL_VERBOSE
) {

1098 
sds
 
ş›Á
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
c
);

1099 
	`£rv”Log
(
LL_VERBOSE
,

1100 "PrÙocŞƒ¼Ü from cl›Á: %s", 
ş›Á
);

1101 
	`sdsä“
(
ş›Á
);

1103 
c
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

1104 
	`sd¤ªge
(
c
->
qu”ybuf
,
pos
,-1);

1105 
	}
}

1107 
	$´oûssMuÉibulkBufãr
(
ş›Á
 *
c
) {

1108 *
Ãwlše
 = 
NULL
;

1109 
pos
 = 0, 
ok
;

1110 
Î
;

1112 ià(
c
->
muÉibulkËn
 == 0) {

1114 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
¬gc
 == 0);

1117 
Ãwlše
 = 
	`¡rchr
(
c
->
qu”ybuf
,'\r');

1118 ià(
Ãwlše
 =ğ
NULL
) {

1119 ià(
	`sd¦’
(
c
->
qu”ybuf
è> 
PROTO_INLINE_MAX_SIZE
) {

1120 
	`addR•lyE¼Ü
(
c
,"Protocolƒrror:oo big mbulk count string");

1121 
	`£tPrÙocŞE¼Ü
(
c
,0);

1123  
C_ERR
;

1127 ià(
Ãwlše
-(
c
->
qu”ybuf
è> ((sigÃd)
	`sd¦’
(c->querybuf)-2))

1128  
C_ERR
;

1132 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
qu”ybuf
[0] == '*');

1133 
ok
 = 
	`¡ršg2Î
(
c
->
qu”ybuf
+1,
Ãwlše
-(c->qu”ybuf+1),&
Î
);

1134 ià(!
ok
 || 
Î
 > 1024*1024) {

1135 
	`addR•lyE¼Ü
(
c
,"Protocolƒrror: invalid multibulk†ength");

1136 
	`£tPrÙocŞE¼Ü
(
c
,
pos
);

1137  
C_ERR
;

1140 
pos
 = (
Ãwlše
-
c
->
qu”ybuf
)+2;

1141 ià(
Î
 <= 0) {

1142 
	`sd¤ªge
(
c
->
qu”ybuf
,
pos
,-1);

1143  
C_OK
;

1146 
c
->
muÉibulkËn
 = 
Î
;

1149 ià(
c
->
¬gv
è
	`zä“
(c->argv);

1150 
c
->
¬gv
 = 
	`zm®loc
((
robj
*)*c->
muÉibulkËn
);

1153 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
muÉibulkËn
 > 0);

1154 
c
->
muÉibulkËn
) {

1156 ià(
c
->
bulkËn
 == -1) {

1157 
Ãwlše
 = 
	`¡rchr
(
c
->
qu”ybuf
+
pos
,'\r');

1158 ià(
Ãwlše
 =ğ
NULL
) {

1159 ià(
	`sd¦’
(
c
->
qu”ybuf
è> 
PROTO_INLINE_MAX_SIZE
) {

1160 
	`addR•lyE¼Ü
(
c
,

1162 
	`£tPrÙocŞE¼Ü
(
c
,0);

1163  
C_ERR
;

1169 ià(
Ãwlše
-(
c
->
qu”ybuf
è> ((sigÃd)
	`sd¦’
(c->querybuf)-2))

1172 ià(
c
->
qu”ybuf
[
pos
] != '$') {

1173 
	`addR•lyE¼ÜFÜm©
(
c
,

1175 
c
->
qu”ybuf
[
pos
]);

1176 
	`£tPrÙocŞE¼Ü
(
c
,
pos
);

1177  
C_ERR
;

1180 
ok
 = 
	`¡ršg2Î
(
c
->
qu”ybuf
+
pos
+1,
Ãwlše
-(c->qu”ybuf+pos+1),&
Î
);

1181 ià(!
ok
 || 
Î
 < 0 ||†l > 512*1024*1024) {

1182 
	`addR•lyE¼Ü
(
c
,"Protocolƒrror: invalid bulk†ength");

1183 
	`£tPrÙocŞE¼Ü
(
c
,
pos
);

1184  
C_ERR
;

1187 
pos
 +ğ
Ãwlše
-(
c
->
qu”ybuf
+pos)+2;

1188 ià(
Î
 >ğ
PROTO_MBULK_BIG_ARG
) {

1189 
size_t
 
qbËn
;

1195 
	`sd¤ªge
(
c
->
qu”ybuf
,
pos
,-1);

1196 
pos
 = 0;

1197 
qbËn
 = 
	`sd¦’
(
c
->
qu”ybuf
);

1200 ià(
qbËn
 < (
size_t
)
Î
+2)

1201 
c
->
qu”ybuf
 = 
	`sdsMakeRoomFÜ
(c->qu”ybuf,
Î
+2-
qbËn
);

1203 
c
->
bulkËn
 = 
Î
;

1207 ià(
	`sd¦’
(
c
->
qu”ybuf
)-
pos
 < ()(c->
bulkËn
+2)) {

1214 ià(
pos
 == 0 &&

1215 
c
->
bulkËn
 >ğ
PROTO_MBULK_BIG_ARG
 &&

1216 (sigÃdè
	`sd¦’
(
c
->
qu”ybuf
è=ğc->
bulkËn
+2)

1218 
c
->
¬gv
[c->
¬gc
++] = 
	`ü—‹Objeù
(
OBJ_STRING
,c->
qu”ybuf
);

1219 
	`sdsInüL’
(
c
->
qu”ybuf
,-2);

1222 
c
->
qu”ybuf
 = 
	`sd¢ewËn
(
NULL
,c->
bulkËn
+2);

1223 
	`sdsş—r
(
c
->
qu”ybuf
);

1224 
pos
 = 0;

1226 
c
->
¬gv
[c->
¬gc
++] =

1227 
	`ü—‹SŒšgObjeù
(
c
->
qu”ybuf
+
pos
,c->
bulkËn
);

1228 
pos
 +ğ
c
->
bulkËn
+2;

1230 
c
->
bulkËn
 = -1;

1231 
c
->
muÉibulkËn
--;

1236 ià(
pos
è
	`sd¤ªge
(
c
->
qu”ybuf
,pos,-1);

1239 ià(
c
->
muÉibulkËn
 =ğ0è 
C_OK
;

1242  
C_ERR
;

1243 
	}
}

1245 
	$´oûssIÅutBufãr
(
ş›Á
 *
c
) {

1246 
£rv”
.
cu¼’t_ş›Á
 = 
c
;

1248 
	`sd¦’
(
c
->
qu”ybuf
)) {

1250 ià(!(
c
->
æags
 & 
CLIENT_SLAVE
è&& 
	`ş›ÁsA»Pau£d
()) ;

1253 ià(
c
->
æags
 & 
CLIENT_BLOCKED
) ;

1260 ià(
c
->
æags
 & (
CLIENT_CLOSE_AFTER_REPLY
|
CLIENT_CLOSE_ASAP
)) ;

1263 ià(!
c
->
»qty³
) {

1264 ià(
c
->
qu”ybuf
[0] == '*') {

1265 
c
->
»qty³
 = 
PROTO_REQ_MULTIBULK
;

1267 
c
->
»qty³
 = 
PROTO_REQ_INLINE
;

1271 ià(
c
->
»qty³
 =ğ
PROTO_REQ_INLINE
) {

1272 ià(
	`´oûssIÆšeBufãr
(
c
è!ğ
C_OK
) ;

1273 } ià(
c
->
»qty³
 =ğ
PROTO_REQ_MULTIBULK
) {

1274 ià(
	`´oûssMuÉibulkBufãr
(
c
è!ğ
C_OK
) ;

1276 
	`£rv”Pªic
("Unknown„equestype");

1280 ià(
c
->
¬gc
 == 0) {

1281 
	`»£tCl›Á
(
c
);

1284 ià(
	`´oûssCommªd
(
c
è=ğ
C_OK
)

1285 
	`»£tCl›Á
(
c
);

1288 ià(
£rv”
.
cu¼’t_ş›Á
 =ğ
NULL
) ;

1291 
£rv”
.
cu¼’t_ş›Á
 = 
NULL
;

1292 
	}
}

1294 
	$»adQu”yFromCl›Á
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

1295 
ş›Á
 *
c
 = (ş›Á*è
´ivd©a
;

1296 
Ä—d
, 
»adËn
;

1297 
size_t
 
qbËn
;

1298 
	`UNUSED
(
–
);

1299 
	`UNUSED
(
mask
);

1301 
»adËn
 = 
PROTO_IOBUF_LEN
;

1308 ià(
c
->
»qty³
 =ğ
PROTO_REQ_MULTIBULK
 && c->
muÉibulkËn
 && c->
bulkËn
 != -1

1309 && 
c
->
bulkËn
 >ğ
PROTO_MBULK_BIG_ARG
)

1311 
»maššg
 = ()(
c
->
bulkËn
+2)-
	`sd¦’
(c->
qu”ybuf
);

1313 ià(
»maššg
 < 
»adËn
)„eadlen =„emaining;

1316 
qbËn
 = 
	`sd¦’
(
c
->
qu”ybuf
);

1317 ià(
c
->
qu”ybuf_³ak
 < 
qbËn
) c->querybuf_peak = qblen;

1318 
c
->
qu”ybuf
 = 
	`sdsMakeRoomFÜ
(c->qu”ybuf, 
»adËn
);

1319 
Ä—d
 = 
	`»ad
(
fd
, 
c
->
qu”ybuf
+
qbËn
, 
»adËn
);

1320 ià(
Ä—d
 == -1) {

1321 ià(
”ºo
 =ğ
EAGAIN
) {

1324 
	`£rv”Log
(
LL_VERBOSE
, "R—dšg from cl›Á: %s",
	`¡»¼Ü
(
”ºo
));

1325 
	`ä“Cl›Á
(
c
);

1328 } ià(
Ä—d
 == 0) {

1329 
	`£rv”Log
(
LL_VERBOSE
, "Client closed connection");

1330 
	`ä“Cl›Á
(
c
);

1334 
	`sdsInüL’
(
c
->
qu”ybuf
,
Ä—d
);

1335 
c
->
Ï¡š‹¿ùiÚ
 = 
£rv”
.
unixtime
;

1336 ià(
c
->
æags
 & 
CLIENT_MASTER
èc->
»¶off
 +ğ
Ä—d
;

1337 
£rv”
.
¡©_Ãt_šput_by‹s
 +ğ
Ä—d
;

1338 ià(
	`sd¦’
(
c
->
qu”ybuf
è> 
£rv”
.
ş›Á_max_qu”ybuf_Ën
) {

1339 
sds
 
ci
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
c
), 
by‹s
 = sdsempty();

1341 
by‹s
 = 
	`sdsÿŒ•r
(by‹s,
c
->
qu”ybuf
,64);

1342 
	`£rv”Log
(
LL_WARNING
,"Closšg cl›Áh©„—ched max qu”y bufã¸Ëngth: % (qbuàš™ŸÈby‹s: %s)", 
ci
, 
by‹s
);

1343 
	`sdsä“
(
ci
);

1344 
	`sdsä“
(
by‹s
);

1345 
	`ä“Cl›Á
(
c
);

1348 
	`´oûssIÅutBufãr
(
c
);

1349 
	}
}

1351 
	$g‘Cl›ÁsMaxBufãrs
(*
lÚge¡_ouut_li¡
,

1352 *
bigge¡_šput_bufãr
) {

1353 
ş›Á
 *
c
;

1354 
li¡Node
 *
Ê
;

1355 
li¡I‹r
 
li
;

1356 
lŞ
 = 0, 
bib
 = 0;

1358 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

1359 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

1360 
c
 = 
	`li¡NodeV®ue
(
Ê
);

1362 ià(
	`li¡L’gth
(
c
->
»¶y
è> 
lŞ
)†ol =†istLength(c->reply);

1363 ià(
	`sd¦’
(
c
->
qu”ybuf
è> 
bib
) bib = sdslen(c->querybuf);

1365 *
lÚge¡_ouut_li¡
 = 
lŞ
;

1366 *
bigge¡_šput_bufãr
 = 
bib
;

1367 
	}
}

1380 
	$g’Cl›ÁP“rId
(
ş›Á
 *ş›Á, *
³”id
,

1381 
size_t
 
³”id_Ën
) {

1382 ià(
ş›Á
->
æags
 & 
CLIENT_UNIX_SOCKET
) {

1384 
	`¢´štf
(
³”id
,
³”id_Ën
,"%s:0",
£rv”
.
unixsock‘
);

1387 
	`ª‘FÜm©P“r
(
ş›Á
->
fd
,
³”id
,
³”id_Ën
);

1389 
	}
}

1395 *
	$g‘Cl›ÁP“rId
(
ş›Á
 *
c
) {

1396 
³”id
[
NET_PEER_ID_LEN
];

1398 ià(
c
->
³”id
 =ğ
NULL
) {

1399 
	`g’Cl›ÁP“rId
(
c
,
³”id
,(peerid));

1400 
c
->
³”id
 = 
	`sd¢ew
(peerid);

1402  
c
->
³”id
;

1403 
	}
}

1407 
sds
 
	$ÿtCl›ÁInfoSŒšg
(
sds
 
s
, 
ş›Á
 *client) {

1408 
æags
[16], 
ev’ts
[3], *
p
;

1409 
emask
;

1411 
p
 = 
æags
;

1412 ià(
ş›Á
->
æags
 & 
CLIENT_SLAVE
) {

1413 ià(
ş›Á
->
æags
 & 
CLIENT_MONITOR
)

1414 *
p
++ = 'O';

1416 *
p
++ = 'S';

1418 ià(
ş›Á
->
æags
 & 
CLIENT_MASTER
è*
p
++ = 'M';

1419 ià(
ş›Á
->
æags
 & 
CLIENT_MULTI
è*
p
++ = 'x';

1420 ià(
ş›Á
->
æags
 & 
CLIENT_BLOCKED
è*
p
++ = 'b';

1421 ià(
ş›Á
->
æags
 & 
CLIENT_DIRTY_CAS
è*
p
++ = 'd';

1422 ià(
ş›Á
->
æags
 & 
CLIENT_CLOSE_AFTER_REPLY
è*
p
++ = 'c';

1423 ià(
ş›Á
->
æags
 & 
CLIENT_UNBLOCKED
è*
p
++ = 'u';

1424 ià(
ş›Á
->
æags
 & 
CLIENT_CLOSE_ASAP
è*
p
++ = 'A';

1425 ià(
ş›Á
->
æags
 & 
CLIENT_UNIX_SOCKET
è*
p
++ = 'U';

1426 ià(
ş›Á
->
æags
 & 
CLIENT_READONLY
è*
p
++ = 'r';

1427 ià(
p
 =ğ
æags
) *p++ = 'N';

1428 *
p
++ = '\0';

1430 
emask
 = 
ş›Á
->
fd
 =ğ-1 ? 0 : 
	`«G‘FeEv’ts
(
£rv”
.
–
,client->fd);

1431 
p
 = 
ev’ts
;

1432 ià(
emask
 & 
AE_READABLE
è*
p
++ = 'r';

1433 ià(
emask
 & 
AE_WRITABLE
è*
p
++ = 'w';

1434 *
p
 = '\0';

1435  
	`sdsÿtfmt
(
s
,

1437 (è
ş›Á
->
id
,

1438 
	`g‘Cl›ÁP“rId
(
ş›Á
),

1439 
ş›Á
->
fd
,

1440 
ş›Á
->
Çme
 ? (*)ş›Á->Çme->
±r
 : "",

1441 ()(
£rv”
.
unixtime
 - 
ş›Á
->
ùime
),

1442 ()(
£rv”
.
unixtime
 - 
ş›Á
->
Ï¡š‹¿ùiÚ
),

1443 
æags
,

1444 
ş›Á
->
db
->
id
,

1445 (è
	`diùSize
(
ş›Á
->
pubsub_chªÃls
),

1446 (è
	`li¡L’gth
(
ş›Á
->
pubsub_·‰”ns
),

1447 (
ş›Á
->
æags
 & 
CLIENT_MULTI
è? cl›Á->
m¡©e
.
couÁ
 : -1,

1448 (è
	`sd¦’
(
ş›Á
->
qu”ybuf
),

1449 (è
	`sd§va
(
ş›Á
->
qu”ybuf
),

1450 (è
ş›Á
->
buåos
,

1451 (è
	`li¡L’gth
(
ş›Á
->
»¶y
),

1452 (è
	`g‘Cl›ÁOuutBufãrMemÜyU§ge
(
ş›Á
),

1453 
ev’ts
,

1454 
ş›Á
->
Ï¡cmd
 ? cl›Á->Ï¡cmd->
Çme
 : "NULL");

1455 
	}
}

1457 
sds
 
	$g‘AÎCl›ÁsInfoSŒšg
() {

1458 
li¡Node
 *
Ê
;

1459 
li¡I‹r
 
li
;

1460 
ş›Á
 *client;

1461 
sds
 
o
 = 
	`sd¢ewËn
(
NULL
,200*
	`li¡L’gth
(
£rv”
.
ş›Ás
));

1462 
	`sdsş—r
(
o
);

1463 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

1464 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

1465 
ş›Á
 = 
	`li¡NodeV®ue
(
Ê
);

1466 
o
 = 
	`ÿtCl›ÁInfoSŒšg
(o,
ş›Á
);

1467 
o
 = 
	`sdsÿ’
(o,"\n",1);

1469  
o
;

1470 
	}
}

1472 
	$ş›ÁCommªd
(
ş›Á
 *
c
) {

1473 
li¡Node
 *
Ê
;

1474 
li¡I‹r
 
li
;

1475 
ş›Á
 *client;

1477 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"li¡"è&& c->
¬gc
 == 2) {

1479 
sds
 
o
 = 
	`g‘AÎCl›ÁsInfoSŒšg
();

1480 
	`addR•lyBulkCBufãr
(
c
,
o
,
	`sd¦’
(o));

1481 
	`sdsä“
(
o
);

1482 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"»¶y"è&& c->
¬gc
 == 3) {

1484 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"on")) {

1485 
c
->
æags
 &ğ~(
CLIENT_REPLY_SKIP
|
CLIENT_REPLY_OFF
);

1486 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1487 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"off")) {

1488 
c
->
æags
 |ğ
CLIENT_REPLY_OFF
;

1489 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"skip")) {

1490 ià(!(
c
->
æags
 & 
CLIENT_REPLY_OFF
))

1491 
c
->
æags
 |ğ
CLIENT_REPLY_SKIP_NEXT
;

1493 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1496 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"kill")) {

1499 *
addr
 = 
NULL
;

1500 
ty³
 = -1;

1501 
ušt64_t
 
id
 = 0;

1502 
skme
 = 1;

1503 
kËd
 = 0, 
şo£_this_ş›Á
 = 0;

1505 ià(
c
->
¬gc
 == 3) {

1507 
addr
 = 
c
->
¬gv
[2]->
±r
;

1508 
skme
 = 0;

1509 } ià(
c
->
¬gc
 > 3) {

1510 
i
 = 2;

1513 
i
 < 
c
->
¬gc
) {

1514 
mÜ—rgs
 = 
c
->
¬gc
 > 
i
+1;

1516 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
,"id"è&& 
mÜ—rgs
) {

1517 
tmp
;

1519 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[
i
+1],&
tmp
,
NULL
)

1520 !ğ
C_OK
) ;

1521 
id
 = 
tmp
;

1522 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
,"ty³"è&& 
mÜ—rgs
) {

1523 
ty³
 = 
	`g‘Cl›ÁTy³ByName
(
c
->
¬gv
[
i
+1]->
±r
);

1524 ià(
ty³
 == -1) {

1525 
	`addR•lyE¼ÜFÜm©
(
c
,"Unknown clientype '%s'",

1526 (*è
c
->
¬gv
[
i
+1]->
±r
);

1529 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
,"addr"è&& 
mÜ—rgs
) {

1530 
addr
 = 
c
->
¬gv
[
i
+1]->
±r
;

1531 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
]->
±r
,"skme"è&& 
mÜ—rgs
) {

1532 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
+1]->
±r
,"yes")) {

1533 
skme
 = 1;

1534 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
i
+1]->
±r
,"no")) {

1535 
skme
 = 0;

1537 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1541 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1544 
i
 += 2;

1547 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1552 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

1553 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

1554 
ş›Á
 = 
	`li¡NodeV®ue
(
Ê
);

1555 ià(
addr
 && 
	`¡rcmp
(
	`g‘Cl›ÁP“rId
(
ş›Á
),addr) != 0) ;

1556 ià(
ty³
 !ğ-1 && 
	`g‘Cl›ÁTy³
(
ş›Á
) !=ype) ;

1557 ià(
id
 !ğ0 && 
ş›Á
->id != id) ;

1558 ià(
c
 =ğ
ş›Á
 && 
skme
) ;

1561 ià(
c
 =ğ
ş›Á
) {

1562 
şo£_this_ş›Á
 = 1;

1564 
	`ä“Cl›Á
(
ş›Á
);

1566 
kËd
++;

1570 ià(
c
->
¬gc
 == 3) {

1571 ià(
kËd
 == 0)

1572 
	`addR•lyE¼Ü
(
c
,"No such client");

1574 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1576 
	`addR•lyLÚgLÚg
(
c
,
kËd
);

1581 ià(
şo£_this_ş›Á
è
c
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

1582 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"£Šame"è&& c->
¬gc
 == 3) {

1583 
j
, 
Ën
 = 
	`sd¦’
(
c
->
¬gv
[2]->
±r
);

1584 *
p
 = 
c
->
¬gv
[2]->
±r
;

1588 ià(
Ën
 == 0) {

1589 ià(
c
->
Çme
è
	`deüRefCouÁ
(c->name);

1590 
c
->
Çme
 = 
NULL
;

1591 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1598 
j
 = 0; j < 
Ën
; j++) {

1599 ià(
p
[
j
] < '!' ||…[j] > '~') {

1600 
	`addR•lyE¼Ü
(
c
,

1606 ià(
c
->
Çme
è
	`deüRefCouÁ
(c->name);

1607 
c
->
Çme
 = c->
¬gv
[2];

1608 
	`šüRefCouÁ
(
c
->
Çme
);

1609 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1610 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"g‘Çme"è&& c->
¬gc
 == 2) {

1611 ià(
c
->
Çme
)

1612 
	`addR•lyBulk
(
c
,c->
Çme
);

1614 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

1615 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"·u£"è&& c->
¬gc
 == 3) {

1616 
du¿tiÚ
;

1618 ià(
	`g‘TimeoutFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
du¿tiÚ
,
UNIT_MILLISECONDS
)

1619 !ğ
C_OK
) ;

1620 
	`·u£Cl›Ás
(
du¿tiÚ
);

1621 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1623 
	`addR•lyE¼Ü
(
c
, "Syntaxƒrror,ry CLIENT (LIST | KILL | GETNAME | SETNAME | PAUSE | REPLY)");

1625 
	}
}

1636 
	$£cur™yW¬nšgCommªd
(
ş›Á
 *
c
) {

1637 
time_t
 
logged_time
;

1638 
time_t
 
now
 = 
	`time
(
NULL
);

1640 ià(
	`Ïbs
(
now
-
logged_time
) > 60) {

1641 
	`£rv”Log
(
LL_WARNING
,"Possible SECURITY ATTACK detected. It†ooks†ike somebody is sending POST or Host: commandso Redis. This is†ikely dueo‡n‡ttacker‡ttemptingo use Cross Protocol Scriptingo compromise your Redis instance. Connection‡borted.");

1642 
logged_time
 = 
now
;

1644 
	`ä“Cl›ÁAsync
(
c
);

1645 
	}
}

1650 
	$»wr™eCl›ÁCommªdVeùÜ
(
ş›Á
 *
c
, 
¬gc
, ...) {

1651 
va_li¡
 
­
;

1652 
j
;

1653 
robj
 **
¬gv
;

1655 
¬gv
 = 
	`zm®loc
((
robj
*)*
¬gc
);

1656 
	`va_¡¬t
(
­
,
¬gc
);

1657 
j
 = 0; j < 
¬gc
; j++) {

1658 
robj
 *
a
;

1660 
a
 = 
	`va_¬g
(
­
, 
robj
*);

1661 
¬gv
[
j
] = 
a
;

1662 
	`šüRefCouÁ
(
a
);

1667 
j
 = 0; j < 
c
->
¬gc
; j++è
	`deüRefCouÁ
(c->
¬gv
[j]);

1668 
	`zä“
(
c
->
¬gv
);

1670 
c
->
¬gv
 =‡rgv;

1671 
c
->
¬gc
 =‡rgc;

1672 
c
->
cmd
 = 
	`lookupCommªdOrOrigš®
(c->
¬gv
[0]->
±r
);

1673 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
cmd
 != NULL);

1674 
	`va_’d
(
­
);

1675 
	}
}

1678 
	$»¶aûCl›ÁCommªdVeùÜ
(
ş›Á
 *
c
, 
¬gc
, 
robj
 **
¬gv
) {

1679 
	`ä“Cl›ÁArgv
(
c
);

1680 
	`zä“
(
c
->
¬gv
);

1681 
c
->
¬gv
 =‡rgv;

1682 
c
->
¬gc
 =‡rgc;

1683 
c
->
cmd
 = 
	`lookupCommªdOrOrigš®
(c->
¬gv
[0]->
±r
);

1684 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
cmd
 != NULL);

1685 
	}
}

1698 
	$»wr™eCl›ÁCommªdArgum’t
(
ş›Á
 *
c
, 
i
, 
robj
 *
Ãwv®
) {

1699 
robj
 *
Şdv®
;

1701 ià(
i
 >ğ
c
->
¬gc
) {

1702 
c
->
¬gv
 = 
	`z»®loc
(c->¬gv,(
robj
*)*(
i
+1));

1703 
c
->
¬gc
 = 
i
+1;

1704 
c
->
¬gv
[
i
] = 
NULL
;

1706 
Şdv®
 = 
c
->
¬gv
[
i
];

1707 
c
->
¬gv
[
i
] = 
Ãwv®
;

1708 
	`šüRefCouÁ
(
Ãwv®
);

1709 ià(
Şdv®
è
	`deüRefCouÁ
(oldval);

1712 ià(
i
 == 0) {

1713 
c
->
cmd
 = 
	`lookupCommªdOrOrigš®
(c->
¬gv
[0]->
±r
);

1714 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,c->
cmd
 != NULL);

1716 
	}
}

1731 
	$g‘Cl›ÁOuutBufãrMemÜyU§ge
(
ş›Á
 *
c
) {

1732 
li¡_™em_size
 = (
li¡Node
)+5;

1736  
c
->
»¶y_by‹s
 + (
li¡_™em_size
*
	`li¡L’gth
(c->
»¶y
));

1737 
	}
}

1748 
	$g‘Cl›ÁTy³
(
ş›Á
 *
c
) {

1749 ià(
c
->
æags
 & 
CLIENT_MASTER
è 
CLIENT_TYPE_MASTER
;

1750 ià((
c
->
æags
 & 
CLIENT_SLAVE
è&& !(c->æag & 
CLIENT_MONITOR
))

1751  
CLIENT_TYPE_SLAVE
;

1752 ià(
c
->
æags
 & 
CLIENT_PUBSUB
è 
CLIENT_TYPE_PUBSUB
;

1753  
CLIENT_TYPE_NORMAL
;

1754 
	}
}

1756 
	$g‘Cl›ÁTy³ByName
(*
Çme
) {

1757 ià(!
	`¡rÿ£cmp
(
Çme
,"nÜm®")è 
CLIENT_TYPE_NORMAL
;

1758 ià(!
	`¡rÿ£cmp
(
Çme
,"¦ave")è 
CLIENT_TYPE_SLAVE
;

1759 ià(!
	`¡rÿ£cmp
(
Çme
,"pubsub")è 
CLIENT_TYPE_PUBSUB
;

1760 ià(!
	`¡rÿ£cmp
(
Çme
,"ma¡”")è 
CLIENT_TYPE_MASTER
;

1762 
	}
}

1764 *
	$g‘Cl›ÁTy³Name
(
şass
) {

1765 
şass
) {

1766 
CLIENT_TYPE_NORMAL
:  "normal";

1767 
CLIENT_TYPE_SLAVE
:  "slave";

1768 
CLIENT_TYPE_PUBSUB
:  "pubsub";

1769 
CLIENT_TYPE_MASTER
:  "master";

1770 :  
NULL
;

1772 
	}
}

1780 
	$checkCl›ÁOuutBufãrLim™s
(
ş›Á
 *
c
) {

1781 
soá
 = 0, 
h¬d
 = 0, 
şass
;

1782 
u£d_mem
 = 
	`g‘Cl›ÁOuutBufãrMemÜyU§ge
(
c
);

1784 
şass
 = 
	`g‘Cl›ÁTy³
(
c
);

1787 ià(
şass
 =ğ
CLIENT_TYPE_MASTER
èşas ğ
CLIENT_TYPE_NORMAL
;

1789 ià(
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
h¬d_lim™_by‹s
 &&

1790 
u£d_mem
 >ğ
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
h¬d_lim™_by‹s
)

1791 
h¬d
 = 1;

1792 ià(
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_by‹s
 &&

1793 
u£d_mem
 >ğ
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_by‹s
)

1794 
soá
 = 1;

1798 ià(
soá
) {

1799 ià(
c
->
obuf_soá_lim™_»ached_time
 == 0) {

1800 
c
->
obuf_soá_lim™_»ached_time
 = 
£rv”
.
unixtime
;

1801 
soá
 = 0;

1803 
time_t
 
–­£d
 = 
£rv”
.
unixtime
 - 
c
->
obuf_soá_lim™_»ached_time
;

1805 ià(
–­£d
 <=

1806 
£rv”
.
ş›Á_obuf_lim™s
[
şass
].
soá_lim™_£cÚds
) {

1807 
soá
 = 0;

1813 
c
->
obuf_soá_lim™_»ached_time
 = 0;

1815  
soá
 || 
h¬d
;

1816 
	}
}

1825 
	$asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
ş›Á
 *
c
) {

1826 
	`£rv”As£¹
(
c
->
»¶y_by‹s
 < 
SIZE_MAX
-(1024*64));

1827 ià(
c
->
»¶y_by‹s
 =ğ0 || c->
æags
 & 
CLIENT_CLOSE_ASAP
) ;

1828 ià(
	`checkCl›ÁOuutBufãrLim™s
(
c
)) {

1829 
sds
 
ş›Á
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
c
);

1831 
	`ä“Cl›ÁAsync
(
c
);

1832 
	`£rv”Log
(
LL_WARNING
,"Cl›Á % scheduËdØbşo£d ASAP fÜ ov”comšg oàouuˆbufã¸lim™s.", 
ş›Á
);

1833 
	`sdsä“
(
ş›Á
);

1835 
	}
}

1841 
	$æushSÏvesOuutBufãrs
() {

1842 
li¡I‹r
 
li
;

1843 
li¡Node
 *
Ê
;

1845 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1846 (
Ê
 = 
	`li¡Next
(&
li
))) {

1847 
ş›Á
 *
¦ave
 = 
	`li¡NodeV®ue
(
Ê
);

1848 
ev’ts
;

1856 
ev’ts
 = 
	`«G‘FeEv’ts
(
£rv”
.
–
,
¦ave
->
fd
);

1857 ià(
ev’ts
 & 
AE_WRITABLE
 &&

1858 
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_ONLINE
 &&

1859 
	`ş›ÁHasP’dšgR•l›s
(
¦ave
))

1861 
	`wr™eToCl›Á
(
¦ave
->
fd
,slave,0);

1864 
	}
}

1883 
	$·u£Cl›Ás
(
m¡ime_t
 
’d
) {

1884 ià(!
£rv”
.
ş›Ás_·u£d
 || 
’d
 > s”v”.
ş›Ás_·u£_’d_time
)

1885 
£rv”
.
ş›Ás_·u£_’d_time
 = 
’d
;

1886 
£rv”
.
ş›Ás_·u£d
 = 1;

1887 
	}
}

1891 
	$ş›ÁsA»Pau£d
() {

1892 ià(
£rv”
.
ş›Ás_·u£d
 &&

1893 
£rv”
.
ş›Ás_·u£_’d_time
 < s”v”.
m¡ime
)

1895 
li¡Node
 *
Ê
;

1896 
li¡I‹r
 
li
;

1897 
ş›Á
 *
c
;

1899 
£rv”
.
ş›Ás_·u£d
 = 0;

1903 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

1904 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

1905 
c
 = 
	`li¡NodeV®ue
(
Ê
);

1909 ià(
c
->
æags
 & (
CLIENT_SLAVE
|
CLIENT_BLOCKED
)) ;

1910 
c
->
æags
 |ğ
CLIENT_UNBLOCKED
;

1911 
	`li¡AddNodeTa
(
£rv”
.
unblocked_ş›Ás
,
c
);

1914  
£rv”
.
ş›Ás_·u£d
;

1915 
	}
}

1929 
	$´oûssEv’tsWheBlocked
() {

1930 
™”©iÚs
 = 4;

1931 
couÁ
 = 0;

1932 
™”©iÚs
--) {

1933 
ev’ts
 = 0;

1934 
ev’ts
 +ğ
	`«ProûssEv’ts
(
£rv”
.
–
, 
AE_FILE_EVENTS
|
AE_DONT_WAIT
);

1935 
ev’ts
 +ğ
	`hªdËCl›ÁsW™hP’dšgWr™es
();

1936 ià(!
ev’ts
) ;

1937 
couÁ
 +ğ
ev’ts
;

1939  
couÁ
;

1940 
	}
}

	@notify.c

30 
	~"£rv”.h
"

40 
	$key¥aûEv’tsSŒšgToFÏgs
(*
şas£s
) {

41 *
p
 = 
şas£s
;

42 
c
, 
æags
 = 0;

44 (
c
 = *
p
++) != '\0') {

45 
c
) {

46 'A': 
æags
 |ğ
NOTIFY_ALL
; ;

47 'g': 
æags
 |ğ
NOTIFY_GENERIC
; ;

48 '$': 
æags
 |ğ
NOTIFY_STRING
; ;

49 'l': 
æags
 |ğ
NOTIFY_LIST
; ;

50 's': 
æags
 |ğ
NOTIFY_SET
; ;

51 'h': 
æags
 |ğ
NOTIFY_HASH
; ;

52 'z': 
æags
 |ğ
NOTIFY_ZSET
; ;

53 'x': 
æags
 |ğ
NOTIFY_EXPIRED
; ;

54 'e': 
æags
 |ğ
NOTIFY_EVICTED
; ;

55 'K': 
æags
 |ğ
NOTIFY_KEYSPACE
; ;

56 'E': 
æags
 |ğ
NOTIFY_KEYEVENT
; ;

60  
æags
;

61 
	}
}

67 
sds
 
	$key¥aûEv’tsFÏgsToSŒšg
(
æags
) {

68 
sds
 
»s
;

70 
»s
 = 
	`sd£m±y
();

71 ià((
æags
 & 
NOTIFY_ALL
) == NOTIFY_ALL) {

72 
»s
 = 
	`sdsÿ’
(res,"A",1);

74 ià(
æags
 & 
NOTIFY_GENERIC
è
»s
 = 
	`sdsÿ’
(res,"g",1);

75 ià(
æags
 & 
NOTIFY_STRING
è
»s
 = 
	`sdsÿ’
(res,"$",1);

76 ià(
æags
 & 
NOTIFY_LIST
è
»s
 = 
	`sdsÿ’
(res,"l",1);

77 ià(
æags
 & 
NOTIFY_SET
è
»s
 = 
	`sdsÿ’
(res,"s",1);

78 ià(
æags
 & 
NOTIFY_HASH
è
»s
 = 
	`sdsÿ’
(res,"h",1);

79 ià(
æags
 & 
NOTIFY_ZSET
è
»s
 = 
	`sdsÿ’
(res,"z",1);

80 ià(
æags
 & 
NOTIFY_EXPIRED
è
»s
 = 
	`sdsÿ’
(res,"x",1);

81 ià(
æags
 & 
NOTIFY_EVICTED
è
»s
 = 
	`sdsÿ’
(res,"e",1);

83 ià(
æags
 & 
NOTIFY_KEYSPACE
è
»s
 = 
	`sdsÿ’
(res,"K",1);

84 ià(
æags
 & 
NOTIFY_KEYEVENT
è
»s
 = 
	`sdsÿ’
(res,"E",1);

85  
»s
;

86 
	}
}

95 
	$nÙifyKey¥aûEv’t
(
ty³
, *
ev’t
, 
robj
 *
key
, 
dbid
) {

96 
sds
 
chª
;

97 
robj
 *
chªobj
, *
ev’tobj
;

98 
Ën
 = -1;

99 
buf
[24];

102 ià(!(
£rv”
.
nÙify_key¥aû_ev’ts
 & 
ty³
)) ;

104 
ev’tobj
 = 
	`ü—‹SŒšgObjeù
(
ev’t
,
	`¡¾’
(event));

107 ià(
£rv”
.
nÙify_key¥aû_ev’ts
 & 
NOTIFY_KEYSPACE
) {

108 
chª
 = 
	`sd¢ewËn
("__keyspace@",11);

109 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),
dbid
);

110 
chª
 = 
	`sdsÿ’
(chª, 
buf
, 
Ën
);

111 
chª
 = 
	`sdsÿ’
(chan, "__:", 3);

112 
chª
 = 
	`sdsÿtsds
(chª, 
key
->
±r
);

113 
chªobj
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
chª
);

114 
	`pubsubPublishMes§ge
(
chªobj
, 
ev’tobj
);

115 
	`deüRefCouÁ
(
chªobj
);

119 ià(
£rv”
.
nÙify_key¥aû_ev’ts
 & 
NOTIFY_KEYEVENT
) {

120 
chª
 = 
	`sd¢ewËn
("__keyevent@",11);

121 ià(
Ën
 =ğ-1èËÀğ
	`Î2¡ršg
(
buf
,(buf),
dbid
);

122 
chª
 = 
	`sdsÿ’
(chª, 
buf
, 
Ën
);

123 
chª
 = 
	`sdsÿ’
(chan, "__:", 3);

124 
chª
 = 
	`sdsÿtsds
(chª, 
ev’tobj
->
±r
);

125 
chªobj
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
chª
);

126 
	`pubsubPublishMes§ge
(
chªobj
, 
key
);

127 
	`deüRefCouÁ
(
chªobj
);

129 
	`deüRefCouÁ
(
ev’tobj
);

130 
	}
}

	@object.c

31 
	~"£rv”.h
"

32 
	~<m©h.h
>

33 
	~<ùy³.h
>

35 
¥¬£InU£
;

37 #ifdeà
__CYGWIN__


38 
	#¡¹Şd
(
a
,
b
è(()
	`¡¹od
(×),(b)))

	)

43 
robj
 *
	$ü—‹Objeù
(
ty³
, *
±r
) {

44 
robj
 *
o
 = 
	`zm®loc
((*o));

45 
o
->
ty³
 =ype;

46 
o
->
’codšg
 = 
OBJ_ENCODING_RAW
;

47 
o
->
±r
 =…tr;

48 
o
->
»fcouÁ
 = 1;

52 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

53 
o
->
Ìu
 = (
	`LFUG‘TimeInMšu‹s
()<<8è| 
LFU_INIT_VAL
;

55 
o
->
Ìu
 = 
	`LRU_CLOCK
();

57  
o
;

58 
	}
}

71 
robj
 *
	$makeObjeùSh¬ed
(
robj
 *
o
) {

72 
	`£rv”As£¹
(
o
->
»fcouÁ
 == 1);

73 
o
->
»fcouÁ
 = 
OBJ_SHARED_REFCOUNT
;

74  
o
;

75 
	}
}

79 
robj
 *
	$ü—‹RawSŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
) {

80  
	`ü—‹Objeù
(
OBJ_STRING
, 
	`sd¢ewËn
(
±r
,
Ën
));

81 
	}
}

86 
robj
 *
	$ü—‹EmbeddedSŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
) {

87 
robj
 *
o
 = 
	`zm®loc
(Ôobj)+(
sdshdr8
)+
Ën
+1);

88 
sdshdr8
 *
sh
 = (*)(
o
+1);

90 
o
->
ty³
 = 
OBJ_STRING
;

91 
o
->
’codšg
 = 
OBJ_ENCODING_EMBSTR
;

92 
o
->
±r
 = 
sh
+1;

93 
o
->
»fcouÁ
 = 1;

94 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

95 
o
->
Ìu
 = (
	`LFUG‘TimeInMšu‹s
()<<8è| 
LFU_INIT_VAL
;

97 
o
->
Ìu
 = 
	`LRU_CLOCK
();

100 
sh
->
Ën
 =†en;

101 
sh
->
®loc
 = 
Ën
;

102 
sh
->
æags
 = 
SDS_TYPE_8
;

103 ià(
±r
) {

104 
	`memıy
(
sh
->
buf
,
±r
,
Ën
);

105 
sh
->
buf
[
Ën
] = '\0';

107 
	`mem£t
(
sh
->
buf
,0,
Ën
+1);

109  
o
;

110 
	}
}

118 
	#OBJ_ENCODING_EMBSTR_SIZE_LIMIT
 44

	)

119 
robj
 *
	$ü—‹SŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
) {

120 ià(
Ën
 <ğ
OBJ_ENCODING_EMBSTR_SIZE_LIMIT
)

121  
	`ü—‹EmbeddedSŒšgObjeù
(
±r
,
Ën
);

123  
	`ü—‹RawSŒšgObjeù
(
±r
,
Ën
);

124 
	}
}

126 
robj
 *
	$ü—‹SŒšgObjeùFromLÚgLÚg
(
v®ue
) {

127 
robj
 *
o
;

128 ià(
v®ue
 >ğ0 && v®u< 
OBJ_SHARED_INTEGERS
) {

129 
	`šüRefCouÁ
(
sh¬ed
.
š‹g”s
[
v®ue
]);

130 
o
 = 
sh¬ed
.
š‹g”s
[
v®ue
];

132 ià(
v®ue
 >ğ
LONG_MIN
 && v®u<ğ
LONG_MAX
) {

133 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
NULL
);

134 
o
->
’codšg
 = 
OBJ_ENCODING_INT
;

135 
o
->
±r
 = (*)(()
v®ue
);

137 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sdsäomlÚglÚg
(
v®ue
));

140  
o
;

141 
	}
}

149 
robj
 *
	$ü—‹SŒšgObjeùFromLÚgDoubË
(
v®ue
, 
humªä›ndly
) {

150 
buf
[256];

151 
Ën
 = 
	`ld2¡ršg
(
buf
,(buf),
v®ue
,
humªä›ndly
);

152  
	`ü—‹SŒšgObjeù
(
buf
,
Ën
);

153 
	}
}

163 
robj
 *
	$dupSŒšgObjeù
(cÚ¡ 
robj
 *
o
) {

164 
robj
 *
d
;

166 
	`£rv”As£¹
(
o
->
ty³
 =ğ
OBJ_STRING
);

168 
o
->
’codšg
) {

169 
OBJ_ENCODING_RAW
:

170  
	`ü—‹RawSŒšgObjeù
(
o
->
±r
,
	`sd¦’
(o->ptr));

171 
OBJ_ENCODING_EMBSTR
:

172  
	`ü—‹EmbeddedSŒšgObjeù
(
o
->
±r
,
	`sd¦’
(o->ptr));

173 
OBJ_ENCODING_INT
:

174 
d
 = 
	`ü—‹Objeù
(
OBJ_STRING
, 
NULL
);

175 
d
->
’codšg
 = 
OBJ_ENCODING_INT
;

176 
d
->
±r
 = 
o
->ptr;

177  
d
;

179 
	`£rv”Pªic
("Wrongƒncoding.");

182 
	}
}

184 
robj
 *
	$ü—‹Quickli¡Objeù
() {

185 
quickli¡
 *
l
 = 
	`quickli¡C»©e
();

186 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_LIST
,
l
);

187 
o
->
’codšg
 = 
OBJ_ENCODING_QUICKLIST
;

188  
o
;

189 
	}
}

191 
robj
 *
	$ü—‹Zli¡Objeù
() {

192 *
zl
 = 
	`zli¡New
();

193 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_LIST
,
zl
);

194 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

195  
o
;

196 
	}
}

198 
robj
 *
	$ü—‹S‘Objeù
() {

199 
diù
 *
d
 = 
	`diùC»©e
(&
£tDiùTy³
,
NULL
);

200 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_SET
,
d
);

201 
o
->
’codšg
 = 
OBJ_ENCODING_HT
;

202  
o
;

203 
	}
}

205 
robj
 *
	$ü—‹IÁ£tObjeù
() {

206 
št£t
 *
is
 = 
	`št£tNew
();

207 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_SET
,
is
);

208 
o
->
’codšg
 = 
OBJ_ENCODING_INTSET
;

209  
o
;

210 
	}
}

212 
robj
 *
	$ü—‹HashObjeù
() {

214 
robj
 *
o
;

215 if(!
¥¬£InU£
) {

216 *
zl
 = 
	`zli¡New
();

217 
o
 = 
	`ü—‹Objeù
(
OBJ_HASH
, 
zl
);

218 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

220 
diù
 *
d
 = 
	`diùC»©e
(&
£tDiùTy³
, 
NULL
);

221 
o
 = 
	`ü—‹Objeù
(
OBJ_HASH
, 
d
);

222 
o
->
’codšg
 = 
OBJ_ENCODING_SPM
;

224  
o
;

225 
	}
}

227 
robj
 *
	$ü—‹Z£tObjeù
() {

228 
z£t
 *
zs
 = 
	`zm®loc
((*zs));

229 
robj
 *
o
;

231 
zs
->
diù
 = 
	`diùC»©e
(&
z£tDiùTy³
,
NULL
);

232 
zs
->
z¦
 = 
	`z¦C»©e
();

233 
o
 = 
	`ü—‹Objeù
(
OBJ_ZSET
,
zs
);

234 
o
->
’codšg
 = 
OBJ_ENCODING_SKIPLIST
;

235  
o
;

236 
	}
}

238 
robj
 *
	$ü—‹Z£tZli¡Objeù
() {

239 *
zl
 = 
	`zli¡New
();

240 
robj
 *
o
 = 
	`ü—‹Objeù
(
OBJ_ZSET
,
zl
);

241 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

242  
o
;

243 
	}
}

245 
robj
 *
	$ü—‹ModuËObjeù
(
moduËTy³
 *
mt
, *
v®ue
) {

246 
moduËV®ue
 *
mv
 = 
	`zm®loc
((*mv));

247 
mv
->
ty³
 = 
mt
;

248 
mv
->
v®ue
 = value;

249  
	`ü—‹Objeù
(
OBJ_MODULE
,
mv
);

250 
	}
}

252 
	$ä“SŒšgObjeù
(
robj
 *
o
) {

253 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_RAW
) {

254 
	`sdsä“
(
o
->
±r
);

256 
	}
}

258 
	$ä“Li¡Objeù
(
robj
 *
o
) {

259 
o
->
’codšg
) {

260 
OBJ_ENCODING_QUICKLIST
:

261 
	`quickli¡R–—£
(
o
->
±r
);

264 
	`£rv”Pªic
("Unknown†istƒncodingype");

266 
	}
}

268 
	$ä“S‘Objeù
(
robj
 *
o
) {

269 
o
->
’codšg
) {

270 
OBJ_ENCODING_HT
:

271 
	`diùR–—£
((
diù
*è
o
->
±r
);

273 
OBJ_ENCODING_INTSET
:

274 
	`zä“
(
o
->
±r
);

277 
	`£rv”Pªic
("Unknown setƒncodingype");

279 
	}
}

281 
	$ä“Z£tObjeù
(
robj
 *
o
) {

282 
z£t
 *
zs
;

283 
o
->
’codšg
) {

284 
OBJ_ENCODING_SKIPLIST
:

285 
zs
 = 
o
->
±r
;

286 
	`diùR–—£
(
zs
->
diù
);

287 
	`z¦F»e
(
zs
->
z¦
);

288 
	`zä“
(
zs
);

290 
OBJ_ENCODING_ZIPLIST
:

291 
	`zä“
(
o
->
±r
);

294 
	`£rv”Pªic
("Unknown sorted setƒncoding");

296 
	}
}

298 
	$ä“HashObjeù
(
robj
 *
o
) {

299 
o
->
’codšg
) {

300 
OBJ_ENCODING_HT
:

301 
	`diùR–—£
((
diù
*è
o
->
±r
);

303 
OBJ_ENCODING_ZIPLIST
:

304 
	`zä“
(
o
->
±r
);

306 
OBJ_ENCODING_SPM
:

307 
	`diùR–—£
((
diù
*è
o
->
±r
);

310 
	`£rv”Pªic
("Unknown hashƒncodingype");

313 
	}
}

315 
	$ä“ModuËObjeù
(
robj
 *
o
) {

316 
moduËV®ue
 *
mv
 = 
o
->
±r
;

317 
mv
->
ty³
->
	`ä“
(mv->
v®ue
);

318 
	`zä“
(
mv
);

319 
	}
}

321 
	$šüRefCouÁ
(
robj
 *
o
) {

322 ià(
o
->
»fcouÁ
 !ğ
OBJ_SHARED_REFCOUNT
) o->refcount++;

323 
	}
}

325 
	$deüRefCouÁ
(
robj
 *
o
) {

326 ià(
o
->
»fcouÁ
 == 1) {

327 
o
->
ty³
) {

328 
OBJ_STRING
: 
	`ä“SŒšgObjeù
(
o
); ;

329 
OBJ_LIST
: 
	`ä“Li¡Objeù
(
o
); ;

330 
OBJ_SET
: 
	`ä“S‘Objeù
(
o
); ;

331 
OBJ_ZSET
: 
	`ä“Z£tObjeù
(
o
); ;

332 
OBJ_HASH
: 
	`ä“HashObjeù
(
o
); ;

333 
OBJ_MODULE
: 
	`ä“ModuËObjeù
(
o
); ;

334 : 
	`£rv”Pªic
("Unknown objectype"); ;

336 
	`zä“
(
o
);

338 ià(
o
->
»fcouÁ
 <ğ0è
	`£rv”Pªic
("decrRefCount‡gainst„efcount <= 0");

339 ià(
o
->
»fcouÁ
 !ğ
OBJ_SHARED_REFCOUNT
) o->refcount--;

341 
	}
}

346 
	$deüRefCouÁVoid
(*
o
) {

347 
	`deüRefCouÁ
(
o
);

348 
	}
}

362 
robj
 *
	$»£tRefCouÁ
(
robj
 *
obj
) {

363 
obj
->
»fcouÁ
 = 0;

364  
obj
;

365 
	}
}

367 
	$checkTy³
(
ş›Á
 *
c
, 
robj
 *
o
, 
ty³
) {

368 ià(
o
->
ty³
 !=ype) {

369 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

373 
	}
}

375 
	$isSdsR•»£ÁabËAsLÚgLÚg
(
sds
 
s
, *
Îv®
) {

376  
	`¡ršg2Î
(
s
,
	`sd¦’
(s),
Îv®
è? 
C_OK
 : 
C_ERR
;

377 
	}
}

379 
	$isObjeùR•»£ÁabËAsLÚgLÚg
(
robj
 *
o
, *
Îv®
) {

380 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

381 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

382 ià(
Îv®
è*Îv® = (è
o
->
±r
;

383  
C_OK
;

385  
	`isSdsR•»£ÁabËAsLÚgLÚg
(
o
->
±r
,
Îv®
);

387 
	}
}

390 
robj
 *
	$ŒyObjeùEncodšg
(
robj
 *
o
) {

391 
v®ue
;

392 
sds
 
s
 = 
o
->
±r
;

393 
size_t
 
Ën
;

399 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

404 ià(!
	`sdsEncodedObjeù
(
o
))  o;

409 ià(
o
->
»fcouÁ
 > 1)  o;

414 
Ën
 = 
	`sd¦’
(
s
);

415 ià(
Ën
 <ğ20 && 
	`¡ršg2l
(
s
,Ën,&
v®ue
)) {

420 ià((
£rv”
.
maxmemÜy
 == 0 ||

421 !(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_NO_SHARED_INTEGERS
)) &&

422 
v®ue
 >= 0 &&

423 
v®ue
 < 
OBJ_SHARED_INTEGERS
)

425 
	`deüRefCouÁ
(
o
);

426 
	`šüRefCouÁ
(
sh¬ed
.
š‹g”s
[
v®ue
]);

427  
sh¬ed
.
š‹g”s
[
v®ue
];

429 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_RAW
è
	`sdsä“
(o->
±r
);

430 
o
->
’codšg
 = 
OBJ_ENCODING_INT
;

431 
o
->
±r
 = (*è
v®ue
;

432  
o
;

440 ià(
Ën
 <ğ
OBJ_ENCODING_EMBSTR_SIZE_LIMIT
) {

441 
robj
 *
emb
;

443 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_EMBSTR
)  o;

444 
emb
 = 
	`ü—‹EmbeddedSŒšgObjeù
(
s
,
	`sd¦’
(s));

445 
	`deüRefCouÁ
(
o
);

446  
emb
;

458 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_RAW
 &&

459 
	`sd§va
(
s
è> 
Ën
/10)

461 
o
->
±r
 = 
	`sdsRemoveF»eS·û
(o->ptr);

465  
o
;

466 
	}
}

470 
robj
 *
	$g‘DecodedObjeù
(
robj
 *
o
) {

471 
robj
 *
dec
;

473 ià(
	`sdsEncodedObjeù
(
o
)) {

474 
	`šüRefCouÁ
(
o
);

475  
o
;

477 ià(
o
->
ty³
 =ğ
OBJ_STRING
 && o->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

478 
buf
[32];

480 
	`Î2¡ršg
(
buf
,32,()
o
->
±r
);

481 
dec
 = 
	`ü—‹SŒšgObjeù
(
buf
,
	`¡¾’
(buf));

482  
dec
;

484 
	`£rv”Pªic
("Unknownƒncodingype");

486 
	}
}

496 
	#REDIS_COMPARE_BINARY
 (1<<0)

	)

497 
	#REDIS_COMPARE_COLL
 (1<<1)

	)

499 
	$com·»SŒšgObjeùsW™hFÏgs
(
robj
 *
a
,„obj *
b
, 
æags
) {

500 
	`£rv”As£¹W™hInfo
(
NULL
,
a
,a->
ty³
 =ğ
OBJ_STRING
 && 
b
->type == OBJ_STRING);

501 
buç
[128], 
bufb
[128], *
a¡r
, *
b¡r
;

502 
size_t
 
®’
, 
bËn
, 
mšËn
;

504 ià(
a
 =ğ
b
)  0;

505 ià(
	`sdsEncodedObjeù
(
a
)) {

506 
a¡r
 = 
a
->
±r
;

507 
®’
 = 
	`sd¦’
(
a¡r
);

509 
®’
 = 
	`Î2¡ršg
(
buç
,(buç),(è
a
->
±r
);

510 
a¡r
 = 
buç
;

512 ià(
	`sdsEncodedObjeù
(
b
)) {

513 
b¡r
 = 
b
->
±r
;

514 
bËn
 = 
	`sd¦’
(
b¡r
);

516 
bËn
 = 
	`Î2¡ršg
(
bufb
,(bufb),(è
b
->
±r
);

517 
b¡r
 = 
bufb
;

519 ià(
æags
 & 
REDIS_COMPARE_COLL
) {

520  
	`¡rcŞl
(
a¡r
,
b¡r
);

522 
cmp
;

524 
mšËn
 = (
®’
 < 
bËn
) ?‡len : blen;

525 
cmp
 = 
	`memcmp
(
a¡r
,
b¡r
,
mšËn
);

526 ià(
cmp
 =ğ0è 
®’
-
bËn
;

527  
cmp
;

529 
	}
}

532 
	$com·»SŒšgObjeùs
(
robj
 *
a
,„obj *
b
) {

533  
	`com·»SŒšgObjeùsW™hFÏgs
(
a
,
b
,
REDIS_COMPARE_BINARY
);

534 
	}
}

537 
	$cŞÏ‹SŒšgObjeùs
(
robj
 *
a
,„obj *
b
) {

538  
	`com·»SŒšgObjeùsW™hFÏgs
(
a
,
b
,
REDIS_COMPARE_COLL
);

539 
	}
}

545 
	$equ®SŒšgObjeùs
(
robj
 *
a
,„obj *
b
) {

546 ià(
a
->
’codšg
 =ğ
OBJ_ENCODING_INT
 &&

547 
b
->
’codšg
 =ğ
OBJ_ENCODING_INT
){

550  
a
->
±r
 =ğ
b
->ptr;

552  
	`com·»SŒšgObjeùs
(
a
,
b
) == 0;

554 
	}
}

556 
size_t
 
	$¡ršgObjeùL’
(
robj
 *
o
) {

557 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

558 ià(
	`sdsEncodedObjeù
(
o
)) {

559  
	`sd¦’
(
o
->
±r
);

561  
	`sdig™s10
(()
o
->
±r
);

563 
	}
}

565 
	$g‘DoubËFromObjeù
(cÚ¡ 
robj
 *
o
, *
rg‘
) {

566 
v®ue
;

567 *
•Œ
;

569 ià(
o
 =ğ
NULL
) {

570 
v®ue
 = 0;

572 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

573 ià(
	`sdsEncodedObjeù
(
o
)) {

574 
”ºo
 = 0;

575 
v®ue
 = 
	`¡¹od
(
o
->
±r
, &
•Œ
);

576 ià(
	`is¥aû
(((cÚ¡ *)
o
->
±r
)[0]) ||

577 
•Œ
[0] != '\0' ||

578 (
”ºo
 =ğ
ERANGE
 &&

579 (
v®ue
 =ğ
HUGE_VAL
 || value == -HUGE_VAL || value == 0)) ||

580 
”ºo
 =ğ
EINVAL
 ||

581 
	`i¢ª
(
v®ue
))

582  
C_ERR
;

583 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

584 
v®ue
 = ()
o
->
±r
;

586 
	`£rv”Pªic
("Unknown stringƒncoding");

589 *
rg‘
 = 
v®ue
;

590  
C_OK
;

591 
	}
}

593 
	$g‘DoubËFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
) {

594 
v®ue
;

595 ià(
	`g‘DoubËFromObjeù
(
o
, &
v®ue
è!ğ
C_OK
) {

596 ià(
msg
 !ğ
NULL
) {

597 
	`addR•lyE¼Ü
(
c
,(*)
msg
);

599 
	`addR•lyE¼Ü
(
c
,"value is‚ot‡ valid float");

601  
C_ERR
;

603 *
rg‘
 = 
v®ue
;

604  
C_OK
;

605 
	}
}

607 
	$g‘LÚgDoubËFromObjeù
(
robj
 *
o
, *
rg‘
) {

608 
v®ue
;

609 *
•Œ
;

611 ià(
o
 =ğ
NULL
) {

612 
v®ue
 = 0;

614 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

615 ià(
	`sdsEncodedObjeù
(
o
)) {

616 
”ºo
 = 0;

617 
v®ue
 = 
	`¡¹Şd
(
o
->
±r
, &
•Œ
);

618 ià(
	`is¥aû
(((*)
o
->
±r
)[0]è|| 
•Œ
[0] != '\0' ||

619 
”ºo
 =ğ
ERANGE
 || 
	`i¢ª
(
v®ue
))

620  
C_ERR
;

621 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

622 
v®ue
 = ()
o
->
±r
;

624 
	`£rv”Pªic
("Unknown stringƒncoding");

627 *
rg‘
 = 
v®ue
;

628  
C_OK
;

629 
	}
}

631 
	$g‘LÚgDoubËFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
) {

632 
v®ue
;

633 ià(
	`g‘LÚgDoubËFromObjeù
(
o
, &
v®ue
è!ğ
C_OK
) {

634 ià(
msg
 !ğ
NULL
) {

635 
	`addR•lyE¼Ü
(
c
,(*)
msg
);

637 
	`addR•lyE¼Ü
(
c
,"value is‚ot‡ valid float");

639  
C_ERR
;

641 *
rg‘
 = 
v®ue
;

642  
C_OK
;

643 
	}
}

645 
	$g‘LÚgLÚgFromObjeù
(
robj
 *
o
, *
rg‘
) {

646 
v®ue
;

648 ià(
o
 =ğ
NULL
) {

649 
v®ue
 = 0;

651 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,o->
ty³
 =ğ
OBJ_STRING
);

652 ià(
	`sdsEncodedObjeù
(
o
)) {

653 ià(
	`¡ršg2Î
(
o
->
±r
,
	`sd¦’
(o->±r),&
v®ue
è=ğ0è 
C_ERR
;

654 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

655 
v®ue
 = ()
o
->
±r
;

657 
	`£rv”Pªic
("Unknown stringƒncoding");

660 ià(
rg‘
è*rg‘ = 
v®ue
;

661  
C_OK
;

662 
	}
}

664 
	$g‘LÚgLÚgFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
) {

665 
v®ue
;

666 ià(
	`g‘LÚgLÚgFromObjeù
(
o
, &
v®ue
è!ğ
C_OK
) {

667 ià(
msg
 !ğ
NULL
) {

668 
	`addR•lyE¼Ü
(
c
,(*)
msg
);

670 
	`addR•lyE¼Ü
(
c
,"value is‚ot‡n integer or out of„ange");

672  
C_ERR
;

674 *
rg‘
 = 
v®ue
;

675  
C_OK
;

676 
	}
}

678 
	$g‘LÚgFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
) {

679 
v®ue
;

681 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, 
o
, &
v®ue
, 
msg
è!ğ
C_OK
è 
C_ERR
;

682 ià(
v®ue
 < 
LONG_MIN
 || v®u> 
LONG_MAX
) {

683 ià(
msg
 !ğ
NULL
) {

684 
	`addR•lyE¼Ü
(
c
,(*)
msg
);

686 
	`addR•lyE¼Ü
(
c
,"value is out of„ange");

688  
C_ERR
;

690 *
rg‘
 = 
v®ue
;

691  
C_OK
;

692 
	}
}

694 *
	$¡rEncodšg
(
’codšg
) {

695 
’codšg
) {

696 
OBJ_ENCODING_RAW
:  "raw";

697 
OBJ_ENCODING_INT
:  "int";

698 
OBJ_ENCODING_HT
:  "hashtable";

699 
OBJ_ENCODING_QUICKLIST
:  "quicklist";

700 
OBJ_ENCODING_ZIPLIST
:  "ziplist";

701 
OBJ_ENCODING_INTSET
:  "intset";

702 
OBJ_ENCODING_SKIPLIST
:  "skiplist";

703 
OBJ_ENCODING_EMBSTR
:  "embstr";

706 
	}
}

714 
	#OBJ_COMPUTE_SIZE_DEF_SAMPLES
 5

	)

715 
size_t
 
	$objeùCompu‹Size
(
robj
 *
o
, 
size_t
 
§m¶e_size
) {

716 
sds
 
–e
, 
–e2
;

717 
diù
 *
d
;

718 
diùI‹¿tÜ
 *
di
;

719 
diùEÁry
 *
de
;

720 
size_t
 
asize
 = 0, 
–esize
 = 0, 
§m¶es
 = 0;

722 ià(
o
->
ty³
 =ğ
OBJ_STRING
) {

723 if(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

724 
asize
 = (*
o
);

725 } if(
o
->
’codšg
 =ğ
OBJ_ENCODING_RAW
) {

726 
asize
 = 
	`sdsAÎocSize
(
o
->
±r
)+(*o);

727 } if(
o
->
’codšg
 =ğ
OBJ_ENCODING_EMBSTR
) {

728 
asize
 = 
	`sd¦’
(
o
->
±r
)+2+(*o);

730 
	`£rv”Pªic
("Unknown stringƒncoding");

732 } ià(
o
->
ty³
 =ğ
OBJ_LIST
) {

733 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

734 
quickli¡
 *
ql
 = 
o
->
±r
;

735 
quickli¡Node
 *
node
 = 
ql
->
h—d
;

736 
asize
 = (*
o
)+(
quickli¡
);

738 
–esize
 +ğ(
quickli¡Node
)+
	`zli¡BlobL’
(
node
->
zl
);

739 
§m¶es
++;

740 } (
node
 =‚ode->
Ãxt
è&& 
§m¶es
 < 
§m¶e_size
);

741 
asize
 +ğ()
–esize
/
§m¶es
*
	`li¡Ty³L’gth
(
o
);

742 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

743 
asize
 = (*
o
)+
	`zli¡BlobL’
(o->
±r
);

745 
	`£rv”Pªic
("Unknown†istƒncoding");

747 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

748 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

749 
d
 = 
o
->
±r
;

750 
di
 = 
	`diùG‘I‹¿tÜ
(
d
);

751 
asize
 = (*
o
)+(
diù
)+((
diùEÁry
*)*
	`diùSlÙs
(
d
));

752 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
 && 
§m¶es
 < 
§m¶e_size
) {

753 
–e
 = 
	`diùG‘Key
(
de
);

754 
–esize
 +ğ(
diùEÁry
è+ 
	`sdsAÎocSize
(
–e
);

755 
§m¶es
++;

757 
	`diùR–—£I‹¿tÜ
(
di
);

758 ià(
§m¶es
è
asize
 +ğ()
–esize
/§m¶es*
	`diùSize
(
d
);

759 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

760 
št£t
 *
is
 = 
o
->
±r
;

761 
asize
 = (*
o
)+(*
is
)+is->
’codšg
*is->
Ëngth
;

763 
	`£rv”Pªic
("Unknown setƒncoding");

765 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

766 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

767 
asize
 = (*
o
)+(
	`zli¡BlobL’
(o->
±r
));

768 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

769 
d
 = ((
z£t
*)
o
->
±r
)->
diù
;

770 
zskli¡
 *
z¦
 = ((
z£t
*)
o
->
±r
)->zsl;

771 
zskli¡Node
 *
znode
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

772 
asize
 = (*
o
)+(
z£t
)+((
diùEÁry
*)*
	`diùSlÙs
(
d
));

773 
znode
 !ğ
NULL
 && 
§m¶es
 < 
§m¶e_size
) {

774 
–esize
 +ğ
	`sdsAÎocSize
(
znode
->
–e
);

775 
–esize
 +ğ(
diùEÁry
è+ 
	`zm®loc_size
(
znode
);

776 
§m¶es
++;

777 
znode
 = znode->
Ëv–
[0].
fÜw¬d
;

779 ià(
§m¶es
è
asize
 +ğ()
–esize
/§m¶es*
	`diùSize
(
d
);

781 
	`£rv”Pªic
("Unknown sorted setƒncoding");

783 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

784 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

785 
asize
 = (*
o
)+(
	`zli¡BlobL’
(o->
±r
));

786 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

787 
d
 = 
o
->
±r
;

788 
di
 = 
	`diùG‘I‹¿tÜ
(
d
);

789 
asize
 = (*
o
)+(
diù
)+((
diùEÁry
*)*
	`diùSlÙs
(
d
));

790 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
 && 
§m¶es
 < 
§m¶e_size
) {

791 
–e
 = 
	`diùG‘Key
(
de
);

792 
–e2
 = 
	`diùG‘V®
(
de
);

793 
–esize
 +ğ
	`sdsAÎocSize
(
–e
è+ sdsAÎocSize(
–e2
);

794 
–esize
 +ğ(
diùEÁry
);

795 
§m¶es
++;

797 
	`diùR–—£I‹¿tÜ
(
di
);

798 ià(
§m¶es
è
asize
 +ğ()
–esize
/§m¶es*
	`diùSize
(
d
);

800 
	`£rv”Pªic
("Unknown hashƒncoding");

803 
	`£rv”Pªic
("Unknown objectype");

805  
asize
;

806 
	}
}

809 
	$ä“MemÜyOv”h—dD©a
(
»disMemOv”h—d
 *
mh
) {

810 
	`zä“
(
mh
->
db
);

811 
	`zä“
(
mh
);

812 
	}
}

817 
»disMemOv”h—d
 *
	$g‘MemÜyOv”h—dD©a
() {

818 
j
;

819 
size_t
 
mem_tÙ®
 = 0;

820 
size_t
 
mem
 = 0;

821 
size_t
 
zm®loc_u£d
 = 
	`zm®loc_u£d_memÜy
();

822 
»disMemOv”h—d
 *
mh
 = 
	`zÿÎoc
((*mh));

824 
mh
->
tÙ®_®loÿ‹d
 = 
zm®loc_u£d
;

825 
mh
->
¡¬tup_®loÿ‹d
 = 
£rv”
.
š™Ÿl_memÜy_u§ge
;

826 
mh
->
³ak_®loÿ‹d
 = 
£rv”
.
¡©_³ak_memÜy
;

827 
mh
->
äagm’tiÚ
 =

828 
	`zm®loc_g‘_äagm’tiÚ_¿tio
(
£rv”
.
»sid’t_£t_size
);

829 
mem_tÙ®
 +ğ
£rv”
.
š™Ÿl_memÜy_u§ge
;

831 
mem
 = 0;

832 ià(
£rv”
.
»¶_backlog
)

833 
mem
 +ğ
	`zm®loc_size
(
£rv”
.
»¶_backlog
);

834 
mh
->
»¶_backlog
 = 
mem
;

835 
mem_tÙ®
 +ğ
mem
;

837 
mem
 = 0;

838 ià(
	`li¡L’gth
(
£rv”
.
¦aves
)) {

839 
li¡I‹r
 
li
;

840 
li¡Node
 *
Ê
;

842 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

843 (
Ê
 = 
	`li¡Next
(&
li
))) {

844 
ş›Á
 *ş›Á = 
	`li¡NodeV®ue
(
Ê
);

845 
mem
 +ğ
	`g‘Cl›ÁOuutBufãrMemÜyU§ge
(
ş›Á
);

846 
mem
 +ğ
	`sdsAÎocSize
(
ş›Á
->
qu”ybuf
);

847 
mem
 +ğ(
ş›Á
);

850 
mh
->
ş›Ás_¦aves
 = 
mem
;

851 
mem_tÙ®
+=
mem
;

853 
mem
 = 0;

854 ià(
	`li¡L’gth
(
£rv”
.
ş›Ás
)) {

855 
li¡I‹r
 
li
;

856 
li¡Node
 *
Ê
;

858 
	`li¡Rewšd
(
£rv”
.
ş›Ás
,&
li
);

859 (
Ê
 = 
	`li¡Next
(&
li
))) {

860 
ş›Á
 *ş›Á = 
	`li¡NodeV®ue
(
Ê
);

861 ià(
ş›Á
->
æags
 & 
CLIENT_SLAVE
)

863 
mem
 +ğ
	`g‘Cl›ÁOuutBufãrMemÜyU§ge
(
ş›Á
);

864 
mem
 +ğ
	`sdsAÎocSize
(
ş›Á
->
qu”ybuf
);

865 
mem
 +ğ(
ş›Á
);

868 
mh
->
ş›Ás_nÜm®
 = 
mem
;

869 
mem_tÙ®
+=
mem
;

871 
mem
 = 0;

872 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

873 
mem
 +ğ
	`sd¦’
(
£rv”
.
aof_buf
);

874 
mem
 +ğ
	`aofRewr™eBufãrSize
();

876 
mh
->
aof_bufãr
 = 
mem
;

877 
mem_tÙ®
+=
mem
;

879 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

880 
»disDb
 *
db
 = 
£rv”
.db+
j
;

881 
keyscouÁ
 = 
	`diùSize
(
db
->
diù
);

882 ià(
keyscouÁ
==0) ;

884 
mh
->
tÙ®_keys
 +ğ
keyscouÁ
;

885 
mh
->
db
 = 
	`z»®loc
(mh->db,(mh->db[0])*(mh->
num_dbs
+1));

886 
mh
->
db
[mh->
num_dbs
].
dbid
 = 
j
;

888 
mem
 = 
	`diùSize
(
db
->
diù
è* (
diùEÁry
) +

889 
	`diùSlÙs
(
db
->
diù
è* (
diùEÁry
*) +

890 
	`diùSize
(
db
->
diù
è* (
robj
);

891 
mh
->
db
[mh->
num_dbs
].
ov”h—d_ht_maš
 = 
mem
;

892 
mem_tÙ®
+=
mem
;

894 
mem
 = 
	`diùSize
(
db
->
expœes
è* (
diùEÁry
) +

895 
	`diùSlÙs
(
db
->
expœes
è* (
diùEÁry
*);

896 
mh
->
db
[mh->
num_dbs
].
ov”h—d_ht_expœes
 = 
mem
;

897 
mem_tÙ®
+=
mem
;

899 
mh
->
num_dbs
++;

902 
mh
->
ov”h—d_tÙ®
 = 
mem_tÙ®
;

903 
mh
->
d©a£t
 = 
zm®loc_u£d
 - 
mem_tÙ®
;

904 
mh
->
³ak_³rc
 = ()
zm®loc_u£d
*100/mh->
³ak_®loÿ‹d
;

908 
size_t
 
Ãt_u§ge
 = 1;

909 ià(
zm®loc_u£d
 > 
mh
->
¡¬tup_®loÿ‹d
)

910 
Ãt_u§ge
 = 
zm®loc_u£d
 - 
mh
->
¡¬tup_®loÿ‹d
;

911 
mh
->
d©a£t_³rc
 = ()mh->
d©a£t
*100/
Ãt_u§ge
;

912 
mh
->
by‹s_³r_key
 = mh->
tÙ®_keys
 ? (
Ãt_u§ge
 / mh->total_keys) : 0;

914  
mh
;

915 
	}
}

919 
	$šputC©Sds
(*
»suÉ
, cÚ¡ *
¡r
) {

921 
sds
 *
šfo
 = (sd *)
»suÉ
;

922 *
šfo
 = 
	`sdsÿt
(*šfo, 
¡r
);

923 
	}
}

927 
sds
 
	$g‘MemÜyDoùÜR•Üt
() {

928 
em±y
 = 0;

929 
big_³ak
 = 0;

930 
high_äag
 = 0;

931 
big_¦ave_buf
 = 0;

932 
big_ş›Á_buf
 = 0;

933 
num_»pÜts
 = 0;

934 
»disMemOv”h—d
 *
mh
 = 
	`g‘MemÜyOv”h—dD©a
();

936 ià(
mh
->
tÙ®_®loÿ‹d
 < (1024*1024*5)) {

937 
em±y
 = 1;

938 
num_»pÜts
++;

941 ià((()
mh
->
³ak_®loÿ‹d
 / mh->
tÙ®_®loÿ‹d
) > 1.5) {

942 
big_³ak
 = 1;

943 
num_»pÜts
++;

947 ià(
mh
->
äagm’tiÚ
 > 1.4) {

948 
high_äag
 = 1;

949 
num_»pÜts
++;

953 
num¦aves
 = 
	`li¡L’gth
(
£rv”
.
¦aves
);

954 
numş›Ás
 = 
	`li¡L’gth
(
£rv”
.
ş›Ás
)-
num¦aves
;

955 ià(
mh
->
ş›Ás_nÜm®
 / 
numş›Ás
 > (1024*200)) {

956 
big_ş›Á_buf
 = 1;

957 
num_»pÜts
++;

961 ià(
mh
->
ş›Ás_¦aves
 / 
num¦aves
 > (1024*1024*10)) {

962 
big_¦ave_buf
 = 1;

963 
num_»pÜts
++;

967 
sds
 
s
;

968 ià(
num_»pÜts
 == 0) {

969 
s
 = 
	`sd¢ew
(

972 } ià(
em±y
 == 1) {

973 
s
 = 
	`sd¢ew
(

980 
s
 = 
	`sd¢ew
("Sam, I detected‡ few issues inhis Redis instance memory implants:\n\n");

981 ià(
big_³ak
) {

982 
s
 = 
	`sdsÿt
(s," * Peak memory: Inhe…asthis instance used morehan 150%he memoryhat is currently using. The‡llocator is‚ormally‚ot‡bleo„elease memory‡fter‡…eak, so you canƒxpecto see‡ big fragmentation„atio, howeverhis is‡ctually harmless‡nd is only dueohe memory…eak,‡nd ifhe Redis instance Resident Set Size (RSS) is currently biggerhanƒxpected,he memory will be used‡s soon‡s you fillhe Redis instance with more data. Ifhe memory…eak was only occasional‡nd you wantoryo„eclaim memory,…leaseryhe MEMORY PURGE command, otherwisehe only other option iso shutdown‡nd„estarthe instance.\n\n");

984 ià(
high_äag
) {

985 
s
 = 
	`sdsÿrštf
(s," * High f¿gm’tiÚ: Thi š¡ªû ha ¨memÜy f¿gm’tiÚ g»©”hª 1.4 (thi m—n th©hResid’ˆS‘ SizoàthRedi ´oûs i much†¬g”hªhsum oàthlogiÿÈ®loÿtiÚ Redi ³rfÜmed). Thi ´obËm i usu®ly due™h”Ø¨Ïrg³ak memÜy (check iàth”i ¨³ak memÜyƒÁry‡bovšh»pÜtèÜ may„esuÉ from‡ wÜklßdh© cau£ th®loÿtÜØäagm’ˆmemÜy‡†Ù. Iàth´obËm i ¨Ïrg³ak memÜy,h’h”i nØissue. Oth”wi£, maksu» you‡» usšghJem®loø®loÿtÜ‡nd‚ÙhdeçuÉ†ibøm®loc. NÙe: Thcu¼’y u£d‡ÎoÿtÜ i \"%s\".\n\n", 
ZMALLOC_LIB
);

987 ià(
big_¦ave_buf
) {

988 
s
 = 
	`sdsÿt
(s," * Big slave buffers: The slave output buffers inhis instance‡re greaterhan 10MB forƒach slave (on‡verage). This†ikely meanshathere is some slave instancehat is struggling„eceiving data,ƒither because it isoo slow or because of‚etworking issues. As‡„esult, data…iles onhe master output buffers. Pleaseryo identify what slave is‚ot„eceiving data correctly‡nd why. You can usehe INFO output in ordero checkhe slaves delays‡ndhe CLIENT LIST commando checkhe output buffers ofƒach slave.\n\n");

990 ià(
big_ş›Á_buf
) {

991 
s
 = 
	`sdsÿt
(s," * Big client buffers: The clients output buffers inhis instance‡re greaterhan 200K…er client (on‡verage). This may„esult from different causes,†ike Pub/Sub clients subscribedo channels bot‚ot„eceiving data fastƒnough, sohat data…iles onhe Redis instance output buffer, or clients sending commands with†arge„eplies or very†arge sequences of commands inhe same…ipeline. Please usehe CLIENT LIST command in ordero investigatehe issue if it causes…roblems in your instance, oro understand better why certain clients‡re using‡ big‡mount of memory.\n\n");

993 
s
 = 
	`sdsÿt
(s,"I'm hereo keep you safe, Sam. I wanto help you.\n");

995 
	`ä“MemÜyOv”h—dD©a
(
mh
);

996  
s
;

997 
	}
}

1003 
robj
 *
	$objeùCommªdLookup
(
ş›Á
 *
c
, 
robj
 *
key
) {

1004 
diùEÁry
 *
de
;

1006 ià((
de
 = 
	`diùFšd
(
c
->
db
->
diù
,
key
->
±r
)è=ğ
NULL
)  NULL;

1007  (
robj
*è
	`diùG‘V®
(
de
);

1008 
	}
}

1010 
robj
 *
	$objeùCommªdLookupOrR•ly
(
ş›Á
 *
c
, 
robj
 *
key
,„obj *
»¶y
) {

1011 
robj
 *
o
 = 
	`objeùCommªdLookup
(
c
,
key
);

1013 ià(!
o
è
	`addR•ly
(
c
, 
»¶y
);

1014  
o
;

1015 
	}
}

1019 
	$objeùCommªd
(
ş›Á
 *
c
) {

1020 
robj
 *
o
;

1022 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"»fcouÁ"è&& c->
¬gc
 == 3) {

1023 ià((
o
 = 
	`objeùCommªdLookupOrR•ly
(
c
,c->
¬gv
[2],
sh¬ed
.
nuÎbulk
))

1024 =ğ
NULL
) ;

1025 
	`addR•lyLÚgLÚg
(
c
,
o
->
»fcouÁ
);

1026 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"’codšg"è&& c->
¬gc
 == 3) {

1027 ià((
o
 = 
	`objeùCommªdLookupOrR•ly
(
c
,c->
¬gv
[2],
sh¬ed
.
nuÎbulk
))

1028 =ğ
NULL
) ;

1029 
	`addR•lyBulkCSŒšg
(
c
,
	`¡rEncodšg
(
o
->
’codšg
));

1030 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"idËtime"è&& c->
¬gc
 == 3) {

1031 ià((
o
 = 
	`objeùCommªdLookupOrR•ly
(
c
,c->
¬gv
[2],
sh¬ed
.
nuÎbulk
))

1032 =ğ
NULL
) ;

1033 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LFU
) {

1034 
	`addR•lyE¼Ü
(
c
,"An LFU maxmemory…olicy is selected, idleime‚otracked. Please‚otehat when switching between…olicies‡t„untime LRU‡nd LFU data willake someimeo‡djust.");

1037 
	`addR•lyLÚgLÚg
(
c
,
	`e¡im©eObjeùIdËTime
(
o
)/1000);

1038 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"äeq"è&& c->
¬gc
 == 3) {

1039 ià((
o
 = 
	`objeùCommªdLookupOrR•ly
(
c
,c->
¬gv
[2],
sh¬ed
.
nuÎbulk
))

1040 =ğ
NULL
) ;

1041 ià(
£rv”
.
maxmemÜy_pŞicy
 & 
MAXMEMORY_FLAG_LRU
) {

1042 
	`addR•lyE¼Ü
(
c
,"An LRU maxmemory…olicy is selected,‡ccess frequency‚otracked. Please‚otehat when switching between…olicies‡t„untime LRU‡nd LFU data willake someimeo‡djust.");

1045 
	`addR•lyLÚgLÚg
(
c
,
o
->
Ìu
&255);

1047 
	`addR•lyE¼Ü
(
c
,"Syntaxƒrror. Try OBJECT (refcount|encoding|idletime|freq)");

1049 
	}
}

1055 
	$memÜyCommªd
(
ş›Á
 *
c
) {

1056 
robj
 *
o
;

1058 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"u§ge"è&& c->
¬gc
 >= 3) {

1059 
§m¶es
 = 
OBJ_COMPUTE_SIZE_DEF_SAMPLES
;

1060 
j
 = 3; j < 
c
->
¬gc
; j++) {

1061 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"samples") &&

1062 
j
+1 < 
c
->
¬gc
)

1064 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[
j
+1],&
§m¶es
,
NULL
)

1065 =ğ
C_ERR
) ;

1066 ià(
§m¶es
 < 0) {

1067 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1070 ià(
§m¶es
 =ğ0è§m¶e ğ
LLONG_MAX
;;

1071 
j
++;

1073 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1077 ià((
o
 = 
	`objeùCommªdLookupOrR•ly
(
c
,c->
¬gv
[2],
sh¬ed
.
nuÎbulk
))

1078 =ğ
NULL
) ;

1079 
size_t
 
u§ge
 = 
	`objeùCompu‹Size
(
o
,
§m¶es
);

1080 
u§ge
 +ğ
	`sdsAÎocSize
(
c
->
¬gv
[1]->
±r
);

1081 
u§ge
 +ğ(
diùEÁry
);

1082 
	`addR•lyLÚgLÚg
(
c
,
u§ge
);

1083 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"¡©s"è&& c->
¬gc
 == 2) {

1084 
»disMemOv”h—d
 *
mh
 = 
	`g‘MemÜyOv”h—dD©a
();

1086 
	`addR•lyMuÉiBulkL’
(
c
,(14+
mh
->
num_dbs
)*2);

1088 
	`addR•lyBulkCSŒšg
(
c
,"peak.allocated");

1089 
	`addR•lyLÚgLÚg
(
c
,
mh
->
³ak_®loÿ‹d
);

1091 
	`addR•lyBulkCSŒšg
(
c
,"total.allocated");

1092 
	`addR•lyLÚgLÚg
(
c
,
mh
->
tÙ®_®loÿ‹d
);

1094 
	`addR•lyBulkCSŒšg
(
c
,"startup.allocated");

1095 
	`addR•lyLÚgLÚg
(
c
,
mh
->
¡¬tup_®loÿ‹d
);

1097 
	`addR•lyBulkCSŒšg
(
c
,"replication.backlog");

1098 
	`addR•lyLÚgLÚg
(
c
,
mh
->
»¶_backlog
);

1100 
	`addR•lyBulkCSŒšg
(
c
,"clients.slaves");

1101 
	`addR•lyLÚgLÚg
(
c
,
mh
->
ş›Ás_¦aves
);

1103 
	`addR•lyBulkCSŒšg
(
c
,"clients.normal");

1104 
	`addR•lyLÚgLÚg
(
c
,
mh
->
ş›Ás_nÜm®
);

1106 
	`addR•lyBulkCSŒšg
(
c
,"aof.buffer");

1107 
	`addR•lyLÚgLÚg
(
c
,
mh
->
aof_bufãr
);

1109 
size_t
 
j
 = 0; j < 
mh
->
num_dbs
; j++) {

1110 
dbÇme
[32];

1111 
	`¢´štf
(
dbÇme
,(dbÇme),"db.%zd",
mh
->
db
[
j
].
dbid
);

1112 
	`addR•lyBulkCSŒšg
(
c
,
dbÇme
);

1113 
	`addR•lyMuÉiBulkL’
(
c
,4);

1115 
	`addR•lyBulkCSŒšg
(
c
,"overhead.hashtable.main");

1116 
	`addR•lyLÚgLÚg
(
c
,
mh
->
db
[
j
].
ov”h—d_ht_maš
);

1118 
	`addR•lyBulkCSŒšg
(
c
,"overhead.hashtable.expires");

1119 
	`addR•lyLÚgLÚg
(
c
,
mh
->
db
[
j
].
ov”h—d_ht_expœes
);

1122 
	`addR•lyBulkCSŒšg
(
c
,"overhead.total");

1123 
	`addR•lyLÚgLÚg
(
c
,
mh
->
ov”h—d_tÙ®
);

1125 
	`addR•lyBulkCSŒšg
(
c
,"keys.count");

1126 
	`addR•lyLÚgLÚg
(
c
,
mh
->
tÙ®_keys
);

1128 
	`addR•lyBulkCSŒšg
(
c
,"keys.bytes-per-key");

1129 
	`addR•lyLÚgLÚg
(
c
,
mh
->
by‹s_³r_key
);

1131 
	`addR•lyBulkCSŒšg
(
c
,"dataset.bytes");

1132 
	`addR•lyLÚgLÚg
(
c
,
mh
->
d©a£t
);

1134 
	`addR•lyBulkCSŒšg
(
c
,"dataset.percentage");

1135 
	`addR•lyDoubË
(
c
,
mh
->
d©a£t_³rc
);

1137 
	`addR•lyBulkCSŒšg
(
c
,"peak.percentage");

1138 
	`addR•lyDoubË
(
c
,
mh
->
³ak_³rc
);

1140 
	`addR•lyBulkCSŒšg
(
c
,"fragmentation");

1141 
	`addR•lyDoubË
(
c
,
mh
->
äagm’tiÚ
);

1143 
	`ä“MemÜyOv”h—dD©a
(
mh
);

1144 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"m®loc-¡©s"è&& c->
¬gc
 == 2) {

1145 #ià
	`defšed
(
USE_JEMALLOC
)

1146 
sds
 
šfo
 = 
	`sd£m±y
();

1147 
	`je_m®loc_¡©s_´št
(
šputC©Sds
, &
šfo
, 
NULL
);

1148 
	`addR•lyBulkSds
(
c
, 
šfo
);

1150 
	`addR•lyBulkCSŒšg
(
c
,"Stats‚ot supported forhe current‡llocator");

1152 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"doùÜ"è&& c->
¬gc
 == 2) {

1153 
sds
 
»pÜt
 = 
	`g‘MemÜyDoùÜR•Üt
();

1154 
	`addR•lyBulkSds
(
c
,
»pÜt
);

1155 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"purge"è&& c->
¬gc
 == 2) {

1156 #ià
	`defšed
(
USE_JEMALLOC
)

1157 
tmp
[32];

1158 
Ç»Çs
 = 0;

1159 
size_t
 
sz
 = ();

1160 ià(!
	`je_m®lùl
("¬’as.Ç»Çs", &
Ç»Çs
, &
sz
, 
NULL
, 0)) {

1161 
	`¥rštf
(
tmp
, "¬’a.%d.purge", 
Ç»Çs
);

1162 ià(!
	`je_m®lùl
(
tmp
, 
NULL
, 0, NULL, 0)) {

1163 
	`addR•ly
(
c
, 
sh¬ed
.
ok
);

1167 
	`addR•lyE¼Ü
(
c
, "Error…urging dirty…ages");

1169 
	`addR•ly
(
c
, 
sh¬ed
.
ok
);

1172 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"h–p"è&& c->
¬gc
 == 2) {

1173 
	`addR•lyMuÉiBulkL’
(
c
,4);

1174 
	`addR•lyBulkCSŒšg
(
c
,

1176 
	`addR•lyBulkCSŒšg
(
c
,

1178 
	`addR•lyBulkCSŒšg
(
c
,

1180 
	`addR•lyBulkCSŒšg
(
c
,

1183 
	`addR•lyE¼Ü
(
c
,"Syntaxƒrror. Try MEMORY HELP");

1185 
	}
}

	@pqsort.c

40 
	~<sys/ty³s.h
>

42 
	~<”ºo.h
>

43 
	~<¡dlib.h
>

45 
šlše
 *
med3
 (*, *, *,

47 
šlše
 
	`sw­func
 (*, *, 
size_t
, );

49 
	#mš
(
a
, 
b
è×è< (bè?‡ : 
	)
b

54 
	#sw­code
(
TYPE
, 
·rmi
, 
·rmj
, 
n
) { \

55 
size_t
 
i
 = (
n
è/  (
TYPE
); \

56 
TYPE
 *
pi
 = (TYPE *)(*)(
·rmi
); \

57 
TYPE
 *
pj
 = (TYPE *)(*)(
·rmj
); \

59 
TYPE
 
t
 = *
pi
; \

60 *
pi
++ = *
pj
; \

61 *
pj
++ = 
t
; \

62 } --
i
 > 0); \

63 
	}

	)
}

65 
	#SWAPINIT
(
a
, 
es
è
sw­ty³
 = ((*)a - (*)0) % () || \

66 
es
 % (è? 2 :ƒ =ğ()? 0 : 1;

	)

68 
šlše
 

69 
	$sw­func
(*
a
, *
b
, 
size_t
 
n
, 
sw­ty³
)

72 ià(
sw­ty³
 <= 1)

73 
	`sw­code
(, 
a
, 
b
, 
n
)

75 
	`sw­code
(, 
a
, 
b
, 
n
)

76 
	}
}

78 
	#sw­
(
a
, 
b
) \

79 ià(
sw­ty³
 == 0) { \

80 
t
 = *(*)(*)(
a
); \

81 *(*)(*)(
a
èğ*(*)(*)(
b
); \

82 *(*)(*)(
b
èğ
t
; \

84 
	`sw­func
(
a
, 
b
, 
es
, 
sw­ty³
)

	)

86 
	#vecsw­
(
a
, 
b
, 
n
èià(Òè> 0è
	`sw­func
(×), (b), (
size_t
)Ò), 
sw­ty³
)

	)

88 
šlše
 *

89 
med3
(*
a
, *
b
, *
c
,

90 (*
cmp
) (const *, const *))

93  
	`cmp
(
a
, 
b
) < 0 ?

94 (
	`cmp
(
b
, 
c
è< 0 ? b : (cmp(
a
, c) < 0 ? c :‡ ))

95 :(
	`cmp
(
b
, 
c
è> 0 ? b : (cmp(
a
, c) < 0 ?‡ : c ));

96 
	}
}

99 
_pqsÜt
(*
a
, 
size_t
 
n
, size_ˆ
es
,

100 (*
cmp
è(cÚ¡ *, cÚ¡ *), *
Ìªge
, *
¼ªge
)

102 *
·
, *
pb
, *
pc
, *
pd
, *
¶
, *
pm
, *
²
;

103 
size_t
 
d
, 
r
;

104 
sw­ty³
, 
cmp_»suÉ
;

106 
loİ
: 
	`SWAPINIT
(
a
, 
es
);

107 ià(
n
 < 7) {

108 
pm
 = (*è
a
 + 
es
;…m < (*è¨+ 
n
 *ƒs;…m +=ƒs)

109 
¶
 = 
pm
;…È> (*è
a
 && 
	`cmp
ÕÈ- 
es
,…l) > 0;

110 
¶
 -ğ
es
)

111 
	`sw­
(
¶
,…È- 
es
);

114 
pm
 = (*è
a
 + (
n
 / 2è* 
es
;

115 ià(
n
 > 7) {

116 
¶
 = (*è
a
;

117 
²
 = (*è
a
 + (
n
 - 1è* 
es
;

118 ià(
n
 > 40) {

119 
d
 = (
n
 / 8è* 
es
;

120 
¶
 = 
	`med3
Õl,…È+ 
d
,…È+ 2 * d, 
cmp
);

121 
pm
 = 
	`med3
Õm - 
d
,…m,…m + d, 
cmp
);

122 
²
 = 
	`med3
ÕÀ- 2 * 
d
,…À- d,…n, 
cmp
);

124 
pm
 = 
	`med3
(
¶
,…m, 
²
, 
cmp
);

126 
	`sw­
(
a
, 
pm
);

127 
·
 = 
pb
 = (*è
a
 + 
es
;

129 
pc
 = 
pd
 = (*è
a
 + (
n
 - 1è* 
es
;

131 
pb
 <ğ
pc
 && (
cmp_»suÉ
 = 
	`cmp
Õb, 
a
)) <= 0) {

132 ià(
cmp_»suÉ
 == 0) {

133 
	`sw­
(
·
, 
pb
);

134 
·
 +ğ
es
;

136 
pb
 +ğ
es
;

138 
pb
 <ğ
pc
 && (
cmp_»suÉ
 = 
	`cmp
Õc, 
a
)) >= 0) {

139 ià(
cmp_»suÉ
 == 0) {

140 
	`sw­
(
pc
, 
pd
);

141 
pd
 -ğ
es
;

143 
pc
 -ğ
es
;

145 ià(
pb
 > 
pc
)

147 
	`sw­
(
pb
, 
pc
);

148 
pb
 +ğ
es
;

149 
pc
 -ğ
es
;

152 
²
 = (*è
a
 + 
n
 * 
es
;

153 
r
 = 
	`mš
(
·
 - (*è
a
, 
pb
 -…a);

154 
	`vecsw­
(
a
, 
pb
 - 
r
,„);

155 
r
 = 
	`mš
((
size_t
)(
pd
 - 
pc
), 
²
 -…d - 
es
);

156 
	`vecsw­
(
pb
, 
²
 - 
r
,„);

157 ià((
r
 = 
pb
 - 
·
è> 
es
) {

158 *
_l
 = 
a
, *
_r
 = ((*ï)+
r
-1;

159 ià(!((
Ìªge
 < 
_l
 && 
¼ªge
 < _l) ||

160 (
Ìªge
 > 
_r
 && 
¼ªge
 > _r)))

161 
	`_pqsÜt
(
a
, 
r
 / 
es
,ƒs, 
cmp
, 
Ìªge
, 
¼ªge
);

163 ià((
r
 = 
pd
 - 
pc
è> 
es
) {

164 *
_l
, *
_r
;

167 
a
 = 
²
 - 
r
;

168 
n
 = 
r
 / 
es
;

170 
_l
 = 
a
;

171 
_r
 = ((*)
a
)+
r
-1;

172 ià(!((
Ìªge
 < 
_l
 && 
¼ªge
 < _l) ||

173 (
Ìªge
 > 
_r
 && 
¼ªge
 > _r)))

174 
loİ
;

177 
	}
}

180 
pqsÜt
(*
a
, 
size_t
 
n
, size_ˆ
es
,

181 (*
cmp
è(cÚ¡ *, cÚ¡ *), 
size_t
 
Ìªge
, size_ˆ
¼ªge
)

183 
	`_pqsÜt
(
a
,
n
,
es
,
cmp
,((*ï)+(
Ìªge
*es),

184 ((*)
a
)+((
¼ªge
+1)*
es
)-1);

185 
	}
}

	@pqsort.h

33 #iâdeà
__PQSORT_H


34 
	#__PQSORT_H


	)

37 
pqsÜt
(*
a
, 
size_t
 
n
, size_ˆ
es
,

38 (*
cmp
è(cÚ¡ *, cÚ¡ *), 
size_t
 
Ìªge
, size_ˆ
¼ªge
);

	@pubsub.c

30 
	~"£rv”.h
"

36 
	$ä“PubsubP©‹º
(*
p
) {

37 
pubsubP©‹º
 *
·t
 = 
p
;

39 
	`deüRefCouÁ
(
·t
->
·‰”n
);

40 
	`zä“
(
·t
);

41 
	}
}

43 
	$li¡M©chPubsubP©‹º
(*
a
, *
b
) {

44 
pubsubP©‹º
 *
·
 = 
a
, *
pb
 = 
b
;

46  (
·
->
ş›Á
 =ğ
pb
->client) &&

47 (
	`equ®SŒšgObjeùs
(
·
->
·‰”n
,
pb
->pattern));

48 
	}
}

51 
	$ş›ÁSubsütiÚsCouÁ
(
ş›Á
 *
c
) {

52  
	`diùSize
(
c
->
pubsub_chªÃls
)+

53 
	`li¡L’gth
(
c
->
pubsub_·‰”ns
);

54 
	}
}

58 
	$pubsubSubsüibeChªÃl
(
ş›Á
 *
c
, 
robj
 *
chªÃl
) {

59 
diùEÁry
 *
de
;

60 
li¡
 *
ş›Ás
 = 
NULL
;

61 
»tv®
 = 0;

64 ià(
	`diùAdd
(
c
->
pubsub_chªÃls
,
chªÃl
,
NULL
è=ğ
DICT_OK
) {

65 
»tv®
 = 1;

66 
	`šüRefCouÁ
(
chªÃl
);

68 
de
 = 
	`diùFšd
(
£rv”
.
pubsub_chªÃls
,
chªÃl
);

69 ià(
de
 =ğ
NULL
) {

70 
ş›Ás
 = 
	`li¡C»©e
();

71 
	`diùAdd
(
£rv”
.
pubsub_chªÃls
,
chªÃl
,
ş›Ás
);

72 
	`šüRefCouÁ
(
chªÃl
);

74 
ş›Ás
 = 
	`diùG‘V®
(
de
);

76 
	`li¡AddNodeTa
(
ş›Ás
,
c
);

79 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

80 
	`addR•ly
(
c
,
sh¬ed
.
subsüibebulk
);

81 
	`addR•lyBulk
(
c
,
chªÃl
);

82 
	`addR•lyLÚgLÚg
(
c
,
	`ş›ÁSubsütiÚsCouÁ
(c));

83  
»tv®
;

84 
	}
}

88 
	$pubsubUnsubsüibeChªÃl
(
ş›Á
 *
c
, 
robj
 *
chªÃl
, 
nÙify
) {

89 
diùEÁry
 *
de
;

90 
li¡
 *
ş›Ás
;

91 
li¡Node
 *
Ê
;

92 
»tv®
 = 0;

95 
	`šüRefCouÁ
(
chªÃl
);

97 ià(
	`diùD–‘e
(
c
->
pubsub_chªÃls
,
chªÃl
è=ğ
DICT_OK
) {

98 
»tv®
 = 1;

100 
de
 = 
	`diùFšd
(
£rv”
.
pubsub_chªÃls
,
chªÃl
);

101 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
de
 != NULL);

102 
ş›Ás
 = 
	`diùG‘V®
(
de
);

103 
Ê
 = 
	`li¡S—rchKey
(
ş›Ás
,
c
);

104 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
Ê
 != NULL);

105 
	`li¡D–Node
(
ş›Ás
,
Ê
);

106 ià(
	`li¡L’gth
(
ş›Ás
) == 0) {

110 
	`diùD–‘e
(
£rv”
.
pubsub_chªÃls
,
chªÃl
);

114 ià(
nÙify
) {

115 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

116 
	`addR•ly
(
c
,
sh¬ed
.
unsubsüibebulk
);

117 
	`addR•lyBulk
(
c
,
chªÃl
);

118 
	`addR•lyLÚgLÚg
(
c
,
	`diùSize
(c->
pubsub_chªÃls
)+

119 
	`li¡L’gth
(
c
->
pubsub_·‰”ns
));

122 
	`deüRefCouÁ
(
chªÃl
);

123  
»tv®
;

124 
	}
}

127 
	$pubsubSubsüibeP©‹º
(
ş›Á
 *
c
, 
robj
 *
·‰”n
) {

128 
»tv®
 = 0;

130 ià(
	`li¡S—rchKey
(
c
->
pubsub_·‰”ns
,
·‰”n
è=ğ
NULL
) {

131 
»tv®
 = 1;

132 
pubsubP©‹º
 *
·t
;

133 
	`li¡AddNodeTa
(
c
->
pubsub_·‰”ns
,
·‰”n
);

134 
	`šüRefCouÁ
(
·‰”n
);

135 
·t
 = 
	`zm®loc
((*pat));

136 
·t
->
·‰”n
 = 
	`g‘DecodedObjeù
(pattern);

137 
·t
->
ş›Á
 = 
c
;

138 
	`li¡AddNodeTa
(
£rv”
.
pubsub_·‰”ns
,
·t
);

141 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

142 
	`addR•ly
(
c
,
sh¬ed
.
psubsüibebulk
);

143 
	`addR•lyBulk
(
c
,
·‰”n
);

144 
	`addR•lyLÚgLÚg
(
c
,
	`ş›ÁSubsütiÚsCouÁ
(c));

145  
»tv®
;

146 
	}
}

150 
	$pubsubUnsubsüibeP©‹º
(
ş›Á
 *
c
, 
robj
 *
·‰”n
, 
nÙify
) {

151 
li¡Node
 *
Ê
;

152 
pubsubP©‹º
 
·t
;

153 
»tv®
 = 0;

155 
	`šüRefCouÁ
(
·‰”n
);

156 ià((
Ê
 = 
	`li¡S—rchKey
(
c
->
pubsub_·‰”ns
,
·‰”n
)è!ğ
NULL
) {

157 
»tv®
 = 1;

158 
	`li¡D–Node
(
c
->
pubsub_·‰”ns
,
Ê
);

159 
·t
.
ş›Á
 = 
c
;

160 
·t
.
·‰”n
 =…attern;

161 
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
pubsub_·‰”ns
,&
·t
);

162 
	`li¡D–Node
(
£rv”
.
pubsub_·‰”ns
,
Ê
);

165 ià(
nÙify
) {

166 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

167 
	`addR•ly
(
c
,
sh¬ed
.
punsubsüibebulk
);

168 
	`addR•lyBulk
(
c
,
·‰”n
);

169 
	`addR•lyLÚgLÚg
(
c
,
	`diùSize
(c->
pubsub_chªÃls
)+

170 
	`li¡L’gth
(
c
->
pubsub_·‰”ns
));

172 
	`deüRefCouÁ
(
·‰”n
);

173  
»tv®
;

174 
	}
}

178 
	$pubsubUnsubsüibeAÎChªÃls
(
ş›Á
 *
c
, 
nÙify
) {

179 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘SaãI‹¿tÜ
(
c
->
pubsub_chªÃls
);

180 
diùEÁry
 *
de
;

181 
couÁ
 = 0;

183 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

184 
robj
 *
chªÃl
 = 
	`diùG‘Key
(
de
);

186 
couÁ
 +ğ
	`pubsubUnsubsüibeChªÃl
(
c
,
chªÃl
,
nÙify
);

189 ià(
nÙify
 && 
couÁ
 == 0) {

190 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

191 
	`addR•ly
(
c
,
sh¬ed
.
unsubsüibebulk
);

192 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

193 
	`addR•lyLÚgLÚg
(
c
,
	`diùSize
(c->
pubsub_chªÃls
)+

194 
	`li¡L’gth
(
c
->
pubsub_·‰”ns
));

196 
	`diùR–—£I‹¿tÜ
(
di
);

197  
couÁ
;

198 
	}
}

202 
	$pubsubUnsubsüibeAÎP©‹ºs
(
ş›Á
 *
c
, 
nÙify
) {

203 
li¡Node
 *
Ê
;

204 
li¡I‹r
 
li
;

205 
couÁ
 = 0;

207 
	`li¡Rewšd
(
c
->
pubsub_·‰”ns
,&
li
);

208 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

209 
robj
 *
·‰”n
 = 
Ê
->
v®ue
;

211 
couÁ
 +ğ
	`pubsubUnsubsüibeP©‹º
(
c
,
·‰”n
,
nÙify
);

213 ià(
nÙify
 && 
couÁ
 == 0) {

215 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

216 
	`addR•ly
(
c
,
sh¬ed
.
punsubsüibebulk
);

217 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

218 
	`addR•lyLÚgLÚg
(
c
,
	`diùSize
(c->
pubsub_chªÃls
)+

219 
	`li¡L’gth
(
c
->
pubsub_·‰”ns
));

221  
couÁ
;

222 
	}
}

225 
	$pubsubPublishMes§ge
(
robj
 *
chªÃl
,„obj *
mes§ge
) {

226 
»ûiv”s
 = 0;

227 
diùEÁry
 *
de
;

228 
li¡Node
 *
Ê
;

229 
li¡I‹r
 
li
;

232 
de
 = 
	`diùFšd
(
£rv”
.
pubsub_chªÃls
,
chªÃl
);

233 ià(
de
) {

234 
li¡
 *li¡ = 
	`diùG‘V®
(
de
);

235 
li¡Node
 *
Ê
;

236 
li¡I‹r
 
li
;

238 
	`li¡Rewšd
(
li¡
,&
li
);

239 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

240 
ş›Á
 *
c
 = 
Ê
->
v®ue
;

242 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[3]);

243 
	`addR•ly
(
c
,
sh¬ed
.
mes§gebulk
);

244 
	`addR•lyBulk
(
c
,
chªÃl
);

245 
	`addR•lyBulk
(
c
,
mes§ge
);

246 
»ûiv”s
++;

250 ià(
	`li¡L’gth
(
£rv”
.
pubsub_·‰”ns
)) {

251 
	`li¡Rewšd
(
£rv”
.
pubsub_·‰”ns
,&
li
);

252 
chªÃl
 = 
	`g‘DecodedObjeù
(channel);

253 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

254 
pubsubP©‹º
 *
·t
 = 
Ê
->
v®ue
;

256 ià(
	`¡ršgm©chËn
((*)
·t
->
·‰”n
->
±r
,

257 
	`sd¦’
(
·t
->
·‰”n
->
±r
),

258 (*)
chªÃl
->
±r
,

259 
	`sd¦’
(
chªÃl
->
±r
),0)) {

260 
	`addR•ly
(
·t
->
ş›Á
,
sh¬ed
.
mbulkhdr
[4]);

261 
	`addR•ly
(
·t
->
ş›Á
,
sh¬ed
.
pmes§gebulk
);

262 
	`addR•lyBulk
(
·t
->
ş›Á
,·t->
·‰”n
);

263 
	`addR•lyBulk
(
·t
->
ş›Á
,
chªÃl
);

264 
	`addR•lyBulk
(
·t
->
ş›Á
,
mes§ge
);

265 
»ûiv”s
++;

268 
	`deüRefCouÁ
(
chªÃl
);

270  
»ûiv”s
;

271 
	}
}

277 
	$subsüibeCommªd
(
ş›Á
 *
c
) {

278 
j
;

280 
j
 = 1; j < 
c
->
¬gc
; j++)

281 
	`pubsubSubsüibeChªÃl
(
c
,c->
¬gv
[
j
]);

282 
c
->
æags
 |ğ
CLIENT_PUBSUB
;

283 
	}
}

285 
	$unsubsüibeCommªd
(
ş›Á
 *
c
) {

286 ià(
c
->
¬gc
 == 1) {

287 
	`pubsubUnsubsüibeAÎChªÃls
(
c
,1);

289 
j
;

291 
j
 = 1; j < 
c
->
¬gc
; j++)

292 
	`pubsubUnsubsüibeChªÃl
(
c
,c->
¬gv
[
j
],1);

294 ià(
	`ş›ÁSubsütiÚsCouÁ
(
c
è=ğ0èc->
æags
 &ğ~
CLIENT_PUBSUB
;

295 
	}
}

297 
	$psubsüibeCommªd
(
ş›Á
 *
c
) {

298 
j
;

300 
j
 = 1; j < 
c
->
¬gc
; j++)

301 
	`pubsubSubsüibeP©‹º
(
c
,c->
¬gv
[
j
]);

302 
c
->
æags
 |ğ
CLIENT_PUBSUB
;

303 
	}
}

305 
	$punsubsüibeCommªd
(
ş›Á
 *
c
) {

306 ià(
c
->
¬gc
 == 1) {

307 
	`pubsubUnsubsüibeAÎP©‹ºs
(
c
,1);

309 
j
;

311 
j
 = 1; j < 
c
->
¬gc
; j++)

312 
	`pubsubUnsubsüibeP©‹º
(
c
,c->
¬gv
[
j
],1);

314 ià(
	`ş›ÁSubsütiÚsCouÁ
(
c
è=ğ0èc->
æags
 &ğ~
CLIENT_PUBSUB
;

315 
	}
}

317 
	$publishCommªd
(
ş›Á
 *
c
) {

318 
»ûiv”s
 = 
	`pubsubPublishMes§ge
(
c
->
¬gv
[1],c->argv[2]);

319 ià(
£rv”
.
şu¡”_’abËd
)

320 
	`şu¡”Prİag©ePublish
(
c
->
¬gv
[1],c->argv[2]);

322 
	`fÜûCommªdPrİag©iÚ
(
c
,
PROPAGATE_REPL
);

323 
	`addR•lyLÚgLÚg
(
c
,
»ûiv”s
);

324 
	}
}

327 
	$pubsubCommªd
(
ş›Á
 *
c
) {

328 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"channels") &&

329 (
c
->
¬gc
 == 2 || c->argc ==3))

332 
sds
 
·t
 = (
c
->
¬gc
 =ğ2è? 
NULL
 : c->
¬gv
[2]->
±r
;

333 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
£rv”
.
pubsub_chªÃls
);

334 
diùEÁry
 *
de
;

335 
mbËn
 = 0;

336 *
»¶yËn
;

338 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

339 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

340 
robj
 *
cobj
 = 
	`diùG‘Key
(
de
);

341 
sds
 
chªÃl
 = 
cobj
->
±r
;

343 ià(!
·t
 || 
	`¡ršgm©chËn
Õ©, 
	`sd¦’
(pat),

344 
chªÃl
, 
	`sd¦’
(channel),0))

346 
	`addR•lyBulk
(
c
,
cobj
);

347 
mbËn
++;

350 
	`diùR–—£I‹¿tÜ
(
di
);

351 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
mbËn
);

352 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"numsub"è&& c->
¬gc
 >= 2) {

354 
j
;

356 
	`addR•lyMuÉiBulkL’
(
c
,(c->
¬gc
-2)*2);

357 
j
 = 2; j < 
c
->
¬gc
; j++) {

358 
li¡
 *
l
 = 
	`diùF‘chV®ue
(
£rv”
.
pubsub_chªÃls
,
c
->
¬gv
[
j
]);

360 
	`addR•lyBulk
(
c
,c->
¬gv
[
j
]);

361 
	`addR•lyLÚgLÚg
(
c
,
l
 ? 
	`li¡L’gth
(l) : 0);

363 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"num·t"è&& c->
¬gc
 == 2) {

365 
	`addR•lyLÚgLÚg
(
c
,
	`li¡L’gth
(
£rv”
.
pubsub_·‰”ns
));

367 
	`addR•lyE¼ÜFÜm©
(
c
,

369 (*)
c
->
¬gv
[1]->
±r
);

371 
	}
}

	@quicklist.c

31 
	~<¡ršg.h
>

32 
	~"quickli¡.h
"

33 
	~"zm®loc.h
"

34 
	~"zli¡.h
"

35 
	~"ut.h
"

36 
	~"lzf.h
"

38 #ià
defšed
(
REDIS_TEST
è|| defšed(
REDIS_TEST_VERBOSE
)

39 
	~<¡dio.h
>

42 #iâdeà
REDIS_STATIC


43 
	#REDIS_STATIC
 

	)

47 cÚ¡ 
size_t
 
	gİtimiz©iÚ_Ëv–
[] = {4096, 8192, 16384, 32768, 65536};

51 
	#SIZE_SAFETY_LIMIT
 8192

	)

54 
	#MIN_COMPRESS_BYTES
 48

	)

59 
	#MIN_COMPRESS_IMPROVE
 8

	)

62 #iâdeà
REDIS_TEST_VERBOSE


63 
	#D
(...)

	)

65 
	#D
(...) \

67 
	`´štf
("%s:%s:%d:\t", 
__FILE__
, 
__FUNCTION__
, 
__LINE__
); \

68 
	`´štf
(
__VA_ARGS__
); \

69 
	`´štf
("\n"); \

70 } 0);

	)

74 
	#š™EÁry
(
e
) \

76 (
e
)->
zi
 = (e)->
v®ue
 = 
NULL
; \

77 (
e
)->
lÚgv®
 = -123456789; \

78 (
e
)->
quickli¡
 = 
NULL
; \

79 (
e
)->
node
 = 
NULL
; \

80 (
e
)->
off£t
 = 123456789; \

81 (
e
)->
sz
 = 0; \

82 } 0)

	)

84 #ià
__GNUC__
 >= 3

85 
	#lik–y
(
x
è
	`__butš_ex³ù
(!!(x), 1)

	)

86 
	#uÆik–y
(
x
è
	`__butš_ex³ù
(!!(x), 0)

	)

88 
	#lik–y
(
x
è(x)

	)

89 
	#uÆik–y
(
x
è(x)

	)

94 
quickli¡
 *
	$quickli¡C»©e
() {

95 
quickli¡
 *quicklist;

97 
quickli¡
 = 
	`zm®loc
((*quicklist));

98 
quickli¡
->
h—d
 = quickli¡->

 = 
NULL
;

99 
quickli¡
->
Ën
 = 0;

100 
quickli¡
->
couÁ
 = 0;

101 
quickli¡
->
com´ess
 = 0;

102 
quickli¡
->
fl
 = -2;

103  
quickli¡
;

104 
	}
}

106 
	#COMPRESS_MAX
 (1 << 16)

	)

107 
	$quickli¡S‘Com´essD•th
(
quickli¡
 *quickli¡, 
com´ess
) {

108 ià(
com´ess
 > 
COMPRESS_MAX
) {

109 
com´ess
 = 
COMPRESS_MAX
;

110 } ià(
com´ess
 < 0) {

111 
com´ess
 = 0;

113 
quickli¡
->
com´ess
 = compress;

114 
	}
}

116 
	#FILL_MAX
 (1 << 15)

	)

117 
	$quickli¡S‘Fl
(
quickli¡
 *quickli¡, 
fl
) {

118 ià(
fl
 > 
FILL_MAX
) {

119 
fl
 = 
FILL_MAX
;

120 } ià(
fl
 < -5) {

121 
fl
 = -5;

123 
quickli¡
->
fl
 = fill;

124 
	}
}

126 
	$quickli¡S‘O±iÚs
(
quickli¡
 *quickli¡, 
fl
, 
d•th
) {

127 
	`quickli¡S‘Fl
(
quickli¡
, 
fl
);

128 
	`quickli¡S‘Com´essD•th
(
quickli¡
, 
d•th
);

129 
	}
}

132 
quickli¡
 *
	$quickli¡New
(
fl
, 
com´ess
) {

133 
quickli¡
 *quickli¡ = 
	`quickli¡C»©e
();

134 
	`quickli¡S‘O±iÚs
(
quickli¡
, 
fl
, 
com´ess
);

135  
quickli¡
;

136 
	}
}

138 
REDIS_STATIC
 
quickli¡Node
 *
	$quickli¡C»©eNode
() {

139 
quickli¡Node
 *
node
;

140 
node
 = 
	`zm®loc
((*node));

141 
node
->
zl
 = 
NULL
;

142 
node
->
couÁ
 = 0;

143 
node
->
sz
 = 0;

144 
node
->
Ãxt
 =‚ode->
´ev
 = 
NULL
;

145 
node
->
’codšg
 = 
QUICKLIST_NODE_ENCODING_RAW
;

146 
node
->
cÚš”
 = 
QUICKLIST_NODE_CONTAINER_ZIPLIST
;

147 
node
->
»com´ess
 = 0;

148  
node
;

149 
	}
}

152 
	$quickli¡CouÁ
(cÚ¡ 
quickli¡
 *
ql
è{  ql->
couÁ
; 
	}
}

155 
	$quickli¡R–—£
(
quickli¡
 *quicklist) {

156 
Ën
;

157 
quickli¡Node
 *
cu¼’t
, *
Ãxt
;

159 
cu¼’t
 = 
quickli¡
->
h—d
;

160 
Ën
 = 
quickli¡
->len;

161 
Ën
--) {

162 
Ãxt
 = 
cu¼’t
->next;

164 
	`zä“
(
cu¼’t
->
zl
);

165 
quickli¡
->
couÁ
 -ğ
cu¼’t
->count;

167 
	`zä“
(
cu¼’t
);

169 
quickli¡
->
Ën
--;

170 
cu¼’t
 = 
Ãxt
;

172 
	`zä“
(
quickli¡
);

173 
	}
}

178 
REDIS_STATIC
 
	$__quickli¡Com´essNode
(
quickli¡Node
 *
node
) {

179 #ifdeà
REDIS_TEST


180 
node
->
©‹m±ed_com´ess
 = 1;

184 ià(
node
->
sz
 < 
MIN_COMPRESS_BYTES
)

187 
quickli¡LZF
 *
lzf
 = 
	`zm®loc
((*lzfè+ 
node
->
sz
);

190 ià(((
lzf
->
sz
 = 
	`lzf_com´ess
(
node
->
zl
,‚ode->sz,†zf->
com´es£d
,

191 
node
->
sz
)) == 0) ||

192 
lzf
->
sz
 + 
MIN_COMPRESS_IMPROVE
 >ğ
node
->sz) {

194 
	`zä“
(
lzf
);

197 
lzf
 = 
	`z»®loc
Özf, (*lzfè+†zf->
sz
);

198 
	`zä“
(
node
->
zl
);

199 
node
->
zl
 = (*)
lzf
;

200 
node
->
’codšg
 = 
QUICKLIST_NODE_ENCODING_LZF
;

201 
node
->
»com´ess
 = 0;

203 
	}
}

206 
	#quickli¡Com´essNode
(
_node
) \

208 ià((
_node
è&& (_node)->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_RAW
) { \

209 
	`__quickli¡Com´essNode
((
_node
)); \

211 } 0)

	)

215 
REDIS_STATIC
 
	$__quickli¡Decom´essNode
(
quickli¡Node
 *
node
) {

216 #ifdeà
REDIS_TEST


217 
node
->
©‹m±ed_com´ess
 = 0;

220 *
decom´es£d
 = 
	`zm®loc
(
node
->
sz
);

221 
quickli¡LZF
 *
lzf
 = (quickli¡LZF *)
node
->
zl
;

222 ià(
	`lzf_decom´ess
(
lzf
->
com´es£d
,†zf->
sz
, 
decom´es£d
, 
node
->sz) == 0) {

224 
	`zä“
(
decom´es£d
);

227 
	`zä“
(
lzf
);

228 
node
->
zl
 = 
decom´es£d
;

229 
node
->
’codšg
 = 
QUICKLIST_NODE_ENCODING_RAW
;

231 
	}
}

234 
	#quickli¡Decom´essNode
(
_node
) \

236 ià((
_node
è&& (_node)->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_LZF
) { \

237 
	`__quickli¡Decom´essNode
((
_node
)); \

239 } 0)

	)

242 
	#quickli¡Decom´essNodeFÜU£
(
_node
) \

244 ià((
_node
è&& (_node)->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_LZF
) { \

245 
	`__quickli¡Decom´essNode
((
_node
)); \

246 (
_node
)->
»com´ess
 = 1; \

248 } 0)

	)

253 
size_t
 
	$quickli¡G‘Lzf
(cÚ¡ 
quickli¡Node
 *
node
, **
d©a
) {

254 
quickli¡LZF
 *
lzf
 = (quickli¡LZF *)
node
->
zl
;

255 *
d©a
 = 
lzf
->
com´es£d
;

256  
lzf
->
sz
;

257 
	}
}

259 
	#quickli¡AÎowsCom´essiÚ
(
_ql
è((_ql)->
com´ess
 !ğ0)

	)

265 
REDIS_STATIC
 
	$__quickli¡Com´ess
(cÚ¡ 
quickli¡
 *quicklist,

266 
quickli¡Node
 *
node
) {

269 ià(!
	`quickli¡AÎowsCom´essiÚ
(
quickli¡
) ||

270 
quickli¡
->
Ën
 < ()(quickli¡->
com´ess
 * 2))

275 ià(
quickli¡
->
com´ess
 == 1) {

276 
quickli¡Node
 *
h
 = 
quickli¡
->
h—d
, *
t
 = quickli¡->

;

277 
	`quickli¡Decom´essNode
(
h
);

278 
	`quickli¡Decom´essNode
(
t
);

279 ià(
h
 !ğ
node
 && 
t
 !=‚ode)

280 
	`quickli¡Com´essNode
(
node
);

282 } ià(
quickli¡
->
com´ess
 == 2) {

283 
quickli¡Node
 *
h
 = 
quickli¡
->
h—d
, *
hn
 = h->
Ãxt
, *
hÂ
 = hn->next;

284 
quickli¡Node
 *
t
 = 
quickli¡
->

, *

 =->
´ev
, *
p
 =p->prev;

285 
	`quickli¡Decom´essNode
(
h
);

286 
	`quickli¡Decom´essNode
(
hn
);

287 
	`quickli¡Decom´essNode
(
t
);

288 
	`quickli¡Decom´essNode
(

);

289 ià(
h
 !ğ
node
 && 
hn
 !ğnod&& 
t
 !ğnod&& 

 !=‚ode) {

290 
	`quickli¡Com´essNode
(
node
);

292 ià(
hÂ
 !ğ
t
) {

293 
	`quickli¡Com´essNode
(
hÂ
);

295 ià(
p
 !ğ
h
) {

296 
	`quickli¡Com´essNode
(
p
);

305 
quickli¡Node
 *
fÜw¬d
 = 
quickli¡
->
h—d
;

306 
quickli¡Node
 *
»v”£
 = 
quickli¡
->

;

307 
d•th
 = 0;

308 
š_d•th
 = 0;

309 
d•th
++ < 
quickli¡
->
com´ess
) {

310 
	`quickli¡Decom´essNode
(
fÜw¬d
);

311 
	`quickli¡Decom´essNode
(
»v”£
);

313 ià(
fÜw¬d
 =ğ
node
 || 
»v”£
 ==‚ode)

314 
š_d•th
 = 1;

316 ià(
fÜw¬d
 =ğ
»v”£
)

319 
fÜw¬d
 = fÜw¬d->
Ãxt
;

320 
»v”£
 =„ev”£->
´ev
;

323 ià(!
š_d•th
)

324 
	`quickli¡Com´essNode
(
node
);

326 ià(
d•th
 > 2) {

328 
	`quickli¡Com´essNode
(
fÜw¬d
);

329 
	`quickli¡Com´essNode
(
»v”£
);

331 
	}
}

333 
	#quickli¡Com´ess
(
_ql
, 
_node
) \

335 ià((
_node
)->
»com´ess
) \

336 
	`quickli¡Com´essNode
((
_node
)); \

338 
	`__quickli¡Com´ess
((
_ql
), (
_node
)); \

339 } 0)

	)

342 
	#quickli¡Recom´essOÆy
(
_ql
, 
_node
) \

344 ià((
_node
)->
»com´ess
) \

345 
	`quickli¡Com´essNode
((
_node
)); \

346 } 0)

	)

352 
REDIS_STATIC
 
	$__quickli¡In£¹Node
(
quickli¡
 *quicklist,

353 
quickli¡Node
 *
Şd_node
,

354 
quickli¡Node
 *
Ãw_node
, 
aá”
) {

355 ià(
aá”
) {

356 
Ãw_node
->
´ev
 = 
Şd_node
;

357 ià(
Şd_node
) {

358 
Ãw_node
->
Ãxt
 = 
Şd_node
->next;

359 ià(
Şd_node
->
Ãxt
)

360 
Şd_node
->
Ãxt
->
´ev
 = 
Ãw_node
;

361 
Şd_node
->
Ãxt
 = 
Ãw_node
;

363 ià(
quickli¡
->

 =ğ
Şd_node
)

364 
quickli¡
->

 = 
Ãw_node
;

366 
Ãw_node
->
Ãxt
 = 
Şd_node
;

367 ià(
Şd_node
) {

368 
Ãw_node
->
´ev
 = 
Şd_node
->prev;

369 ià(
Şd_node
->
´ev
)

370 
Şd_node
->
´ev
->
Ãxt
 = 
Ãw_node
;

371 
Şd_node
->
´ev
 = 
Ãw_node
;

373 ià(
quickli¡
->
h—d
 =ğ
Şd_node
)

374 
quickli¡
->
h—d
 = 
Ãw_node
;

377 ià(
quickli¡
->
Ën
 == 0) {

378 
quickli¡
->
h—d
 = quickli¡->

 = 
Ãw_node
;

381 ià(
Şd_node
)

382 
	`quickli¡Com´ess
(
quickli¡
, 
Şd_node
);

384 
quickli¡
->
Ën
++;

385 
	}
}

388 
REDIS_STATIC
 
	$_quickli¡In£¹NodeBefÜe
(
quickli¡
 *quicklist,

389 
quickli¡Node
 *
Şd_node
,

390 
quickli¡Node
 *
Ãw_node
) {

391 
	`__quickli¡In£¹Node
(
quickli¡
, 
Şd_node
, 
Ãw_node
, 0);

392 
	}
}

394 
REDIS_STATIC
 
	$_quickli¡In£¹NodeAá”
(
quickli¡
 *quicklist,

395 
quickli¡Node
 *
Şd_node
,

396 
quickli¡Node
 *
Ãw_node
) {

397 
	`__quickli¡In£¹Node
(
quickli¡
, 
Şd_node
, 
Ãw_node
, 1);

398 
	}
}

400 
REDIS_STATIC
 

401 
	$_quickli¡NodeSizeM“tsO±imiz©iÚRequœem’t
(cÚ¡ 
size_t
 
sz
,

402 cÚ¡ 
fl
) {

403 ià(
fl
 >= 0)

406 
size_t
 
off£t
 = (-
fl
) - 1;

407 ià(
off£t
 < ((
İtimiz©iÚ_Ëv–
) / (*optimization_level))) {

408 ià(
sz
 <ğ
İtimiz©iÚ_Ëv–
[
off£t
]) {

416 
	}
}

418 
	#sizeM“tsSaãtyLim™
(
sz
è((szè<ğ
SIZE_SAFETY_LIMIT
)

	)

420 
REDIS_STATIC
 
	$_quickli¡NodeAÎowIn£¹
(cÚ¡ 
quickli¡Node
 *
node
,

421 cÚ¡ 
fl
, cÚ¡ 
size_t
 
sz
) {

422 ià(
	`uÆik–y
(!
node
))

425 
zli¡_ov”h—d
;

427 ià(
sz
 < 254)

428 
zli¡_ov”h—d
 = 1;

430 
zli¡_ov”h—d
 = 5;

433 ià(
sz
 < 64)

434 
zli¡_ov”h—d
 += 1;

435 ià(
	`lik–y
(
sz
 < 16384))

436 
zli¡_ov”h—d
 += 2;

438 
zli¡_ov”h—d
 += 5;

441 
Ãw_sz
 = 
node
->
sz
 + sz + 
zli¡_ov”h—d
;

442 ià(
	`lik–y
(
	`_quickli¡NodeSizeM“tsO±imiz©iÚRequœem’t
(
Ãw_sz
, 
fl
)))

444 ià(!
	`sizeM“tsSaãtyLim™
(
Ãw_sz
))

446 ià(()
node
->
couÁ
 < 
fl
)

450 
	}
}

452 
REDIS_STATIC
 
	$_quickli¡NodeAÎowM”ge
(cÚ¡ 
quickli¡Node
 *
a
,

453 cÚ¡ 
quickli¡Node
 *
b
,

454 cÚ¡ 
fl
) {

455 ià(!
a
 || !
b
)

460 
m”ge_sz
 = 
a
->
sz
 + 
b
->sz - 11;

461 ià(
	`lik–y
(
	`_quickli¡NodeSizeM“tsO±imiz©iÚRequœem’t
(
m”ge_sz
, 
fl
)))

463 ià(!
	`sizeM“tsSaãtyLim™
(
m”ge_sz
))

465 ià(()(
a
->
couÁ
 + 
b
->couÁè<ğ
fl
)

469 
	}
}

471 
	#quickli¡NodeUpd©eSz
(
node
) \

473 (
node
)->
sz
 = 
	`zli¡BlobL’
(Òode)->
zl
); \

474 } 0)

	)

480 
	$quickli¡PushH—d
(
quickli¡
 *quickli¡, *
v®ue
, 
size_t
 
sz
) {

481 
quickli¡Node
 *
Üig_h—d
 = 
quickli¡
->
h—d
;

482 ià(
	`lik–y
(

483 
	`_quickli¡NodeAÎowIn£¹
(
quickli¡
->
h—d
, quickli¡->
fl
, 
sz
))) {

484 
quickli¡
->
h—d
->
zl
 =

485 
	`zli¡Push
(
quickli¡
->
h—d
->
zl
, 
v®ue
, 
sz
, 
ZIPLIST_HEAD
);

486 
	`quickli¡NodeUpd©eSz
(
quickli¡
->
h—d
);

488 
quickli¡Node
 *
node
 = 
	`quickli¡C»©eNode
();

489 
node
->
zl
 = 
	`zli¡Push
(
	`zli¡New
(), 
v®ue
, 
sz
, 
ZIPLIST_HEAD
);

491 
	`quickli¡NodeUpd©eSz
(
node
);

492 
	`_quickli¡In£¹NodeBefÜe
(
quickli¡
, quickli¡->
h—d
, 
node
);

494 
quickli¡
->
couÁ
++;

495 
quickli¡
->
h—d
->
couÁ
++;

496  (
Üig_h—d
 !ğ
quickli¡
->
h—d
);

497 
	}
}

503 
	$quickli¡PushTa
(
quickli¡
 *quickli¡, *
v®ue
, 
size_t
 
sz
) {

504 
quickli¡Node
 *
Üig_
 = 
quickli¡
->

;

505 ià(
	`lik–y
(

506 
	`_quickli¡NodeAÎowIn£¹
(
quickli¡
->

, quickli¡->
fl
, 
sz
))) {

507 
quickli¡
->

->
zl
 =

508 
	`zli¡Push
(
quickli¡
->

->
zl
, 
v®ue
, 
sz
, 
ZIPLIST_TAIL
);

509 
	`quickli¡NodeUpd©eSz
(
quickli¡
->

);

511 
quickli¡Node
 *
node
 = 
	`quickli¡C»©eNode
();

512 
node
->
zl
 = 
	`zli¡Push
(
	`zli¡New
(), 
v®ue
, 
sz
, 
ZIPLIST_TAIL
);

514 
	`quickli¡NodeUpd©eSz
(
node
);

515 
	`_quickli¡In£¹NodeAá”
(
quickli¡
, quickli¡->

, 
node
);

517 
quickli¡
->
couÁ
++;

518 
quickli¡
->

->
couÁ
++;

519  (
Üig_
 !ğ
quickli¡
->

);

520 
	}
}

525 
	$quickli¡Aµ’dZli¡
(
quickli¡
 *quickli¡, *
zl
) {

526 
quickli¡Node
 *
node
 = 
	`quickli¡C»©eNode
();

528 
node
->
zl
 = zl;

529 
node
->
couÁ
 = 
	`zli¡L’
Òode->
zl
);

530 
node
->
sz
 = 
	`zli¡BlobL’
(
zl
);

532 
	`_quickli¡In£¹NodeAá”
(
quickli¡
, quickli¡->

, 
node
);

533 
quickli¡
->
couÁ
 +ğ
node
->count;

534 
	}
}

542 
quickli¡
 *
	$quickli¡Aµ’dV®uesFromZli¡
(
quickli¡
 *quicklist,

543 *
zl
) {

544 *
v®ue
;

545 
sz
;

546 
lÚgv®
;

547 
lÚg¡r
[32] = {0};

549 *
p
 = 
	`zli¡Index
(
zl
, 0);

550 
	`zli¡G‘
(
p
, &
v®ue
, &
sz
, &
lÚgv®
)) {

551 ià(!
v®ue
) {

553 
sz
 = 
	`Î2¡ršg
(
lÚg¡r
, ÖÚg¡r), 
lÚgv®
);

554 
v®ue
 = (*)
lÚg¡r
;

556 
	`quickli¡PushTa
(
quickli¡
, 
v®ue
, 
sz
);

557 
p
 = 
	`zli¡Next
(
zl
,…);

559 
	`zä“
(
zl
);

560  
quickli¡
;

561 
	}
}

566 
quickli¡
 *
	$quickli¡C»©eFromZli¡
(
fl
, 
com´ess
,

567 *
zl
) {

568  
	`quickli¡Aµ’dV®uesFromZli¡
(
	`quickli¡New
(
fl
, 
com´ess
), 
zl
);

569 
	}
}

571 
	#quickli¡D–‘eIfEm±y
(
ql
, 
n
) \

573 ià((
n
)->
couÁ
 == 0) { \

574 
	`__quickli¡D–Node
((
ql
), (
n
)); \

575 (
n
èğ
NULL
; \

577 } 0)

	)

579 
REDIS_STATIC
 
	$__quickli¡D–Node
(
quickli¡
 *quicklist,

580 
quickli¡Node
 *
node
) {

581 ià(
node
->
Ãxt
)

582 
node
->
Ãxt
->
´ev
 =‚ode->prev;

583 ià(
node
->
´ev
)

584 
node
->
´ev
->
Ãxt
 =‚ode->next;

586 ià(
node
 =ğ
quickli¡
->

) {

587 
quickli¡
->

 = 
node
->
´ev
;

590 ià(
node
 =ğ
quickli¡
->
h—d
) {

591 
quickli¡
->
h—d
 = 
node
->
Ãxt
;

596 
	`__quickli¡Com´ess
(
quickli¡
, 
NULL
);

598 
quickli¡
->
couÁ
 -ğ
node
->count;

600 
	`zä“
(
node
->
zl
);

601 
	`zä“
(
node
);

602 
quickli¡
->
Ën
--;

603 
	}
}

613 
REDIS_STATIC
 
	$quickli¡D–Index
(
quickli¡
 *quickli¡, 
quickli¡Node
 *
node
,

614 **
p
) {

615 
gÚe
 = 0;

617 
node
->
zl
 = 
	`zli¡D–‘e
Òode->zl, 
p
);

618 
node
->
couÁ
--;

619 ià(
node
->
couÁ
 == 0) {

620 
gÚe
 = 1;

621 
	`__quickli¡D–Node
(
quickli¡
, 
node
);

623 
	`quickli¡NodeUpd©eSz
(
node
);

625 
quickli¡
->
couÁ
--;

627  
gÚe
 ? 1 : 0;

628 
	}
}

634 
	$quickli¡D–EÁry
(
quickli¡I‹r
 *
™”
, 
quickli¡EÁry
 *
’Œy
) {

635 
quickli¡Node
 *
´ev
 = 
’Œy
->
node
->prev;

636 
quickli¡Node
 *
Ãxt
 = 
’Œy
->
node
->next;

637 
d–‘ed_node
 = 
	`quickli¡D–Index
((
quickli¡
 *)
’Œy
->quicklist,

638 
’Œy
->
node
, &’Œy->
zi
);

641 
™”
->
zi
 = 
NULL
;

644 ià(
d–‘ed_node
) {

645 ià(
™”
->
dœeùiÚ
 =ğ
AL_START_HEAD
) {

646 
™”
->
cu¼’t
 = 
Ãxt
;

647 
™”
->
off£t
 = 0;

648 } ià(
™”
->
dœeùiÚ
 =ğ
AL_START_TAIL
) {

649 
™”
->
cu¼’t
 = 
´ev
;

650 
™”
->
off£t
 = -1;

661 
	}
}

667 
	$quickli¡R•ÏûAtIndex
(
quickli¡
 *quickli¡, 
šdex
, *
d©a
,

668 
sz
) {

669 
quickli¡EÁry
 
’Œy
;

670 ià(
	`lik–y
(
	`quickli¡Index
(
quickli¡
, 
šdex
, &
’Œy
))) {

672 
’Œy
.
node
->
zl
 = 
	`zli¡D–‘e
ÓÁry.node->zl, &’Œy.
zi
);

673 
’Œy
.
node
->
zl
 = 
	`zli¡In£¹
ÓÁry.node->zl,ƒÁry.
zi
, 
d©a
, 
sz
);

674 
	`quickli¡NodeUpd©eSz
(
’Œy
.
node
);

675 
	`quickli¡Com´ess
(
quickli¡
, 
’Œy
.
node
);

680 
	}
}

695 
REDIS_STATIC
 
quickli¡Node
 *
	$_quickli¡Zli¡M”ge
(
quickli¡
 *quicklist,

696 
quickli¡Node
 *
a
,

697 
quickli¡Node
 *
b
) {

698 
	`D
("Reque¡ed m”g×,bè(%u, %u)", 
a
->
couÁ
, 
b
->count);

700 
	`quickli¡Decom´essNode
(
a
);

701 
	`quickli¡Decom´essNode
(
b
);

702 ià((
	`zli¡M”ge
(&
a
->
zl
, &
b
->zl))) {

704 
quickli¡Node
 *
k“p
 = 
NULL
, *
nok“p
 = NULL;

705 ià(!
a
->
zl
) {

706 
nok“p
 = 
a
;

707 
k“p
 = 
b
;

708 } ià(!
b
->
zl
) {

709 
nok“p
 = 
b
;

710 
k“p
 = 
a
;

712 
k“p
->
couÁ
 = 
	`zli¡L’
(k“p->
zl
);

713 
	`quickli¡NodeUpd©eSz
(
k“p
);

715 
nok“p
->
couÁ
 = 0;

716 
	`__quickli¡D–Node
(
quickli¡
, 
nok“p
);

717 
	`quickli¡Com´ess
(
quickli¡
, 
k“p
);

718  
k“p
;

721  
NULL
;

723 
	}
}

733 
REDIS_STATIC
 
	$_quickli¡M”geNodes
(
quickli¡
 *quicklist,

734 
quickli¡Node
 *
ûÁ”
) {

735 
fl
 = 
quickli¡
->fill;

736 
quickli¡Node
 *
´ev
, *
´ev_´ev
, *
Ãxt
, *
Ãxt_Ãxt
, *
rg‘
;

737 
´ev
 = 
´ev_´ev
 = 
Ãxt
 = 
Ãxt_Ãxt
 = 
rg‘
 = 
NULL
;

739 ià(
ûÁ”
->
´ev
) {

740 
´ev
 = 
ûÁ”
->prev;

741 ià(
ûÁ”
->
´ev
->prev)

742 
´ev_´ev
 = 
ûÁ”
->
´ev
->prev;

745 ià(
ûÁ”
->
Ãxt
) {

746 
Ãxt
 = 
ûÁ”
->next;

747 ià(
ûÁ”
->
Ãxt
->next)

748 
Ãxt_Ãxt
 = 
ûÁ”
->
Ãxt
->next;

752 ià(
	`_quickli¡NodeAÎowM”ge
(
´ev
, 
´ev_´ev
, 
fl
)) {

753 
	`_quickli¡Zli¡M”ge
(
quickli¡
, 
´ev_´ev
, 
´ev
);

754 
´ev_´ev
 = 
´ev
 = 
NULL
;

758 ià(
	`_quickli¡NodeAÎowM”ge
(
Ãxt
, 
Ãxt_Ãxt
, 
fl
)) {

759 
	`_quickli¡Zli¡M”ge
(
quickli¡
, 
Ãxt
, 
Ãxt_Ãxt
);

760 
Ãxt
 = 
Ãxt_Ãxt
 = 
NULL
;

764 ià(
	`_quickli¡NodeAÎowM”ge
(
ûÁ”
, c’‹r->
´ev
, 
fl
)) {

765 
rg‘
 = 
	`_quickli¡Zli¡M”ge
(
quickli¡
, 
ûÁ”
->
´ev
, center);

766 
ûÁ”
 = 
NULL
;

769 
rg‘
 = 
ûÁ”
;

773 ià(
	`_quickli¡NodeAÎowM”ge
(
rg‘
,¬g‘->
Ãxt
, 
fl
)) {

774 
	`_quickli¡Zli¡M”ge
(
quickli¡
, 
rg‘
,¬g‘->
Ãxt
);

776 
	}
}

797 
REDIS_STATIC
 
quickli¡Node
 *
	$_quickli¡S¶™Node
(
quickli¡Node
 *
node
, 
off£t
,

798 
aá”
) {

799 
size_t
 
zl_sz
 = 
node
->
sz
;

801 
quickli¡Node
 *
Ãw_node
 = 
	`quickli¡C»©eNode
();

802 
Ãw_node
->
zl
 = 
	`zm®loc
(
zl_sz
);

805 
	`memıy
(
Ãw_node
->
zl
, 
node
->zl, 
zl_sz
);

808 
Üig_¡¬t
 = 
aá”
 ? 
off£t
 + 1 : 0;

809 
Üig_ex‹Á
 = 
aá”
 ? -1 : 
off£t
;

810 
Ãw_¡¬t
 = 
aá”
 ? 0 : 
off£t
;

811 
Ãw_ex‹Á
 = 
aá”
 ? 
off£t
 + 1 : -1;

813 
	`D
("Aá” %d (%d);„ªges: [%d, %d], [%d, %d]", 
aá”
, 
off£t
, 
Üig_¡¬t
,

814 
Üig_ex‹Á
, 
Ãw_¡¬t
, 
Ãw_ex‹Á
);

816 
node
->
zl
 = 
	`zli¡D–‘eRªge
Òode->zl, 
Üig_¡¬t
, 
Üig_ex‹Á
);

817 
node
->
couÁ
 = 
	`zli¡L’
Òode->
zl
);

818 
	`quickli¡NodeUpd©eSz
(
node
);

820 
Ãw_node
->
zl
 = 
	`zli¡D–‘eRªge
Òew_node->zl, 
Ãw_¡¬t
, 
Ãw_ex‹Á
);

821 
Ãw_node
->
couÁ
 = 
	`zli¡L’
Òew_node->
zl
);

822 
	`quickli¡NodeUpd©eSz
(
Ãw_node
);

824 
	`D
("Aá” s¶™†’gths: orig (%d),‚ew (%d)", 
node
->
couÁ
, 
Ãw_node
->count);

825  
Ãw_node
;

826 
	}
}

832 
REDIS_STATIC
 
	$_quickli¡In£¹
(
quickli¡
 *quickli¡, 
quickli¡EÁry
 *
’Œy
,

833 *
v®ue
, cÚ¡ 
size_t
 
sz
, 
aá”
) {

834 
fuÎ
 = 0, 
©_
 = 0, 
©_h—d
 = 0, 
fuÎ_Ãxt
 = 0, 
fuÎ_´ev
 = 0;

835 
fl
 = 
quickli¡
->fill;

836 
quickli¡Node
 *
node
 = 
’Œy
->node;

837 
quickli¡Node
 *
Ãw_node
 = 
NULL
;

839 ià(!
node
) {

841 
	`D
("No‚ode given!");

842 
Ãw_node
 = 
	`quickli¡C»©eNode
();

843 
Ãw_node
->
zl
 = 
	`zli¡Push
(
	`zli¡New
(), 
v®ue
, 
sz
, 
ZIPLIST_HEAD
);

844 
	`__quickli¡In£¹Node
(
quickli¡
, 
NULL
, 
Ãw_node
, 
aá”
);

845 
Ãw_node
->
couÁ
++;

846 
quickli¡
->
couÁ
++;

851 ià(!
	`_quickli¡NodeAÎowIn£¹
(
node
, 
fl
, 
sz
)) {

852 
	`D
("Current‚ode is full with count %d with„equested fill %lu",

853 
node
->
couÁ
, 
fl
);

854 
fuÎ
 = 1;

857 ià(
aá”
 && (
’Œy
->
off£t
 =ğ
node
->
couÁ
)) {

858 
	`D
("At Tail of current ziplist");

859 
©_
 = 1;

860 ià(!
	`_quickli¡NodeAÎowIn£¹
(
node
->
Ãxt
, 
fl
, 
sz
)) {

861 
	`D
("Next‚ode is fulloo.");

862 
fuÎ_Ãxt
 = 1;

866 ià(!
aá”
 && (
’Œy
->
off£t
 == 0)) {

867 
	`D
("At Head");

868 
©_h—d
 = 1;

869 ià(!
	`_quickli¡NodeAÎowIn£¹
(
node
->
´ev
, 
fl
, 
sz
)) {

870 
	`D
("Prev‚ode is fulloo.");

871 
fuÎ_´ev
 = 1;

876 ià(!
fuÎ
 && 
aá”
) {

877 
	`D
("Not full, inserting‡fter current…osition.");

878 
	`quickli¡Decom´essNodeFÜU£
(
node
);

879 *
Ãxt
 = 
	`zli¡Next
(
node
->
zl
, 
’Œy
->
zi
);

880 ià(
Ãxt
 =ğ
NULL
) {

881 
node
->
zl
 = 
	`zli¡Push
Òode->zl, 
v®ue
, 
sz
, 
ZIPLIST_TAIL
);

883 
node
->
zl
 = 
	`zli¡In£¹
Òode->zl, 
Ãxt
, 
v®ue
, 
sz
);

885 
node
->
couÁ
++;

886 
	`quickli¡NodeUpd©eSz
(
node
);

887 
	`quickli¡Recom´essOÆy
(
quickli¡
, 
node
);

888 } ià(!
fuÎ
 && !
aá”
) {

889 
	`D
("Not full, inserting before current…osition.");

890 
	`quickli¡Decom´essNodeFÜU£
(
node
);

891 
node
->
zl
 = 
	`zli¡In£¹
Òode->zl, 
’Œy
->
zi
, 
v®ue
, 
sz
);

892 
node
->
couÁ
++;

893 
	`quickli¡NodeUpd©eSz
(
node
);

894 
	`quickli¡Recom´essOÆy
(
quickli¡
, 
node
);

895 } ià(
fuÎ
 && 
©_
 && 
node
->
Ãxt
 && !
fuÎ_Ãxt
 && 
aá”
) {

898 
	`D
("Full‡ndail, but‚ext isn't full; inserting‚ext‚ode head");

899 
Ãw_node
 = 
node
->
Ãxt
;

900 
	`quickli¡Decom´essNodeFÜU£
(
Ãw_node
);

901 
Ãw_node
->
zl
 = 
	`zli¡Push
Òew_node->zl, 
v®ue
, 
sz
, 
ZIPLIST_HEAD
);

902 
Ãw_node
->
couÁ
++;

903 
	`quickli¡NodeUpd©eSz
(
Ãw_node
);

904 
	`quickli¡Recom´essOÆy
(
quickli¡
, 
Ãw_node
);

905 } ià(
fuÎ
 && 
©_h—d
 && 
node
->
´ev
 && !
fuÎ_´ev
 && !
aá”
) {

908 
	`D
("Full‡nd head, but…rev isn't full, inserting…rev‚odeail");

909 
Ãw_node
 = 
node
->
´ev
;

910 
	`quickli¡Decom´essNodeFÜU£
(
Ãw_node
);

911 
Ãw_node
->
zl
 = 
	`zli¡Push
Òew_node->zl, 
v®ue
, 
sz
, 
ZIPLIST_TAIL
);

912 
Ãw_node
->
couÁ
++;

913 
	`quickli¡NodeUpd©eSz
(
Ãw_node
);

914 
	`quickli¡Recom´essOÆy
(
quickli¡
, 
Ãw_node
);

915 } ià(
fuÎ
 && ((
©_
 && 
node
->
Ãxt
 && 
fuÎ_Ãxt
 && 
aá”
) ||

916 (
©_h—d
 && 
node
->
´ev
 && 
fuÎ_´ev
 && !
aá”
))) {

919 
	`D
("\tprovisioning‚ew‚ode...");

920 
Ãw_node
 = 
	`quickli¡C»©eNode
();

921 
Ãw_node
->
zl
 = 
	`zli¡Push
(
	`zli¡New
(), 
v®ue
, 
sz
, 
ZIPLIST_HEAD
);

922 
Ãw_node
->
couÁ
++;

923 
	`quickli¡NodeUpd©eSz
(
Ãw_node
);

924 
	`__quickli¡In£¹Node
(
quickli¡
, 
node
, 
Ãw_node
, 
aá”
);

925 } ià(
fuÎ
) {

928 
	`D
("\tsplitting‚ode...");

929 
	`quickli¡Decom´essNodeFÜU£
(
node
);

930 
Ãw_node
 = 
	`_quickli¡S¶™Node
(
node
, 
’Œy
->
off£t
, 
aá”
);

931 
Ãw_node
->
zl
 = 
	`zli¡Push
Òew_node->zl, 
v®ue
, 
sz
,

932 
aá”
 ? 
ZIPLIST_HEAD
 : 
ZIPLIST_TAIL
);

933 
Ãw_node
->
couÁ
++;

934 
	`quickli¡NodeUpd©eSz
(
Ãw_node
);

935 
	`__quickli¡In£¹Node
(
quickli¡
, 
node
, 
Ãw_node
, 
aá”
);

936 
	`_quickli¡M”geNodes
(
quickli¡
, 
node
);

939 
quickli¡
->
couÁ
++;

940 
	}
}

942 
	$quickli¡In£¹BefÜe
(
quickli¡
 *quickli¡, 
quickli¡EÁry
 *
’Œy
,

943 *
v®ue
, cÚ¡ 
size_t
 
sz
) {

944 
	`_quickli¡In£¹
(
quickli¡
, 
’Œy
, 
v®ue
, 
sz
, 0);

945 
	}
}

947 
	$quickli¡In£¹Aá”
(
quickli¡
 *quickli¡, 
quickli¡EÁry
 *
’Œy
,

948 *
v®ue
, cÚ¡ 
size_t
 
sz
) {

949 
	`_quickli¡In£¹
(
quickli¡
, 
’Œy
, 
v®ue
, 
sz
, 1);

950 
	}
}

958 
	$quickli¡D–Rªge
(
quickli¡
 *quickli¡, cÚ¡ 
¡¬t
,

959 cÚ¡ 
couÁ
) {

960 ià(
couÁ
 <= 0)

963 
ex‹Á
 = 
couÁ
;

965 ià(
¡¬t
 >ğ0 && 
ex‹Á
 > (
quickli¡
->
couÁ
 - start)) {

967 
ex‹Á
 = 
quickli¡
->
couÁ
 - 
¡¬t
;

968 } ià(
¡¬t
 < 0 && 
ex‹Á
 > ()(-start)) {

970 
ex‹Á
 = -
¡¬t
;

973 
quickli¡EÁry
 
’Œy
;

974 ià(!
	`quickli¡Index
(
quickli¡
, 
¡¬t
, &
’Œy
))

977 
	`D
("Quickli¡ d–‘»que¡ fÜ s¹ %ld, couÁ %ld,ƒx‹Á: %ld", 
¡¬t
,

978 
couÁ
, 
ex‹Á
);

979 
quickli¡Node
 *
node
 = 
’Œy
.node;

982 
ex‹Á
) {

983 
quickli¡Node
 *
Ãxt
 = 
node
->next;

985 
d–
;

986 
d–‘e_’tœe_node
 = 0;

987 ià(
’Œy
.
off£t
 =ğ0 && 
ex‹Á
 >ğ
node
->
couÁ
) {

990 
d–‘e_’tœe_node
 = 1;

991 
d–
 = 
node
->
couÁ
;

992 } ià(
’Œy
.
off£t
 >ğ0 && 
ex‹Á
 >ğ
node
->
couÁ
) {

995 
d–
 = 
node
->
couÁ
 - 
’Œy
.
off£t
;

996 } ià(
’Œy
.
off£t
 < 0) {

1002 
d–
 = -
’Œy
.
off£t
;

1007 ià(
d–
 > 
ex‹Á
)

1008 
d–
 = 
ex‹Á
;

1012 
d–
 = 
ex‹Á
;

1015 
	`D
("[%ld]:‡skingo del: %ld because offset: %d; (ENTIRE NODE: %d), "

1017 
ex‹Á
, 
d–
, 
’Œy
.
off£t
, 
d–‘e_’tœe_node
, 
node
->
couÁ
);

1019 ià(
d–‘e_’tœe_node
) {

1020 
	`__quickli¡D–Node
(
quickli¡
, 
node
);

1022 
	`quickli¡Decom´essNodeFÜU£
(
node
);

1023 
node
->
zl
 = 
	`zli¡D–‘eRªge
Òode->zl, 
’Œy
.
off£t
, 
d–
);

1024 
	`quickli¡NodeUpd©eSz
(
node
);

1025 
node
->
couÁ
 -ğ
d–
;

1026 
quickli¡
->
couÁ
 -ğ
d–
;

1027 
	`quickli¡D–‘eIfEm±y
(
quickli¡
, 
node
);

1028 ià(
node
)

1029 
	`quickli¡Recom´essOÆy
(
quickli¡
, 
node
);

1032 
ex‹Á
 -ğ
d–
;

1034 
node
 = 
Ãxt
;

1036 
’Œy
.
off£t
 = 0;

1039 
	}
}

1042 
	$quickli¡Com·»
(*
p1
, *
p2
, 
p2_Ën
) {

1043  
	`zli¡Com·»
(
p1
, 
p2
, 
p2_Ën
);

1044 
	}
}

1048 
quickli¡I‹r
 *
	$quickli¡G‘I‹¿tÜ
(cÚ¡ 
quickli¡
 *quickli¡, 
dœeùiÚ
) {

1049 
quickli¡I‹r
 *
™”
;

1051 
™”
 = 
	`zm®loc
((*iter));

1053 ià(
dœeùiÚ
 =ğ
AL_START_HEAD
) {

1054 
™”
->
cu¼’t
 = 
quickli¡
->
h—d
;

1055 
™”
->
off£t
 = 0;

1056 } ià(
dœeùiÚ
 =ğ
AL_START_TAIL
) {

1057 
™”
->
cu¼’t
 = 
quickli¡
->

;

1058 
™”
->
off£t
 = -1;

1061 
™”
->
dœeùiÚ
 = direction;

1062 
™”
->
quickli¡
 = quicklist;

1064 
™”
->
zi
 = 
NULL
;

1066  
™”
;

1067 
	}
}

1071 
quickli¡I‹r
 *
	$quickli¡G‘I‹¿tÜAtIdx
(cÚ¡ 
quickli¡
 *quicklist,

1072 cÚ¡ 
dœeùiÚ
,

1073 cÚ¡ 
idx
) {

1074 
quickli¡EÁry
 
’Œy
;

1076 ià(
	`quickli¡Index
(
quickli¡
, 
idx
, &
’Œy
)) {

1077 
quickli¡I‹r
 *
ba£
 = 
	`quickli¡G‘I‹¿tÜ
(
quickli¡
, 
dœeùiÚ
);

1078 
ba£
->
zi
 = 
NULL
;

1079 
ba£
->
cu¼’t
 = 
’Œy
.
node
;

1080 
ba£
->
off£t
 = 
’Œy
.offset;

1081  
ba£
;

1083  
NULL
;

1085 
	}
}

1089 
	$quickli¡R–—£I‹¿tÜ
(
quickli¡I‹r
 *
™”
) {

1090 ià(
™”
->
cu¼’t
)

1091 
	`quickli¡Com´ess
(
™”
->
quickli¡
, i‹r->
cu¼’t
);

1093 
	`zä“
(
™”
);

1094 
	}
}

1117 
	$quickli¡Next
(
quickli¡I‹r
 *
™”
, 
quickli¡EÁry
 *
’Œy
) {

1118 
	`š™EÁry
(
’Œy
);

1120 ià(!
™”
) {

1121 
	`D
("Returning because‚o iter!");

1125 
’Œy
->
quickli¡
 = 
™”
->quicklist;

1126 
’Œy
->
node
 = 
™”
->
cu¼’t
;

1128 ià(!
™”
->
cu¼’t
) {

1129 
	`D
("Returning because current‚ode is NULL")

1133 *(*
ÃxtFn
)(*, *èğ
NULL
;

1134 
off£t_upd©e
 = 0;

1136 ià(!
™”
->
zi
) {

1138 
	`quickli¡Decom´essNodeFÜU£
(
™”
->
cu¼’t
);

1139 
™”
->
zi
 = 
	`zli¡Index
(™”->
cu¼’t
->
zl
, i‹r->
off£t
);

1142 ià(
™”
->
dœeùiÚ
 =ğ
AL_START_HEAD
) {

1143 
ÃxtFn
 = 
zli¡Next
;

1144 
off£t_upd©e
 = 1;

1145 } ià(
™”
->
dœeùiÚ
 =ğ
AL_START_TAIL
) {

1146 
ÃxtFn
 = 
zli¡P»v
;

1147 
off£t_upd©e
 = -1;

1149 
™”
->
zi
 = 
	`ÃxtFn
(™”->
cu¼’t
->
zl
, iter->zi);

1150 
™”
->
off£t
 +ğ
off£t_upd©e
;

1153 
’Œy
->
zi
 = 
™”
->zi;

1154 
’Œy
->
off£t
 = 
™”
->offset;

1156 ià(
™”
->
zi
) {

1158 
	`zli¡G‘
(
’Œy
->
zi
, &’Œy->
v®ue
, &’Œy->
sz
, &’Œy->
lÚgv®
);

1163 
	`quickli¡Com´ess
(
™”
->
quickli¡
, i‹r->
cu¼’t
);

1164 ià(
™”
->
dœeùiÚ
 =ğ
AL_START_HEAD
) {

1166 
	`D
("Jumpingo start of‚ext‚ode");

1167 
™”
->
cu¼’t
 = i‹r->cu¼’t->
Ãxt
;

1168 
™”
->
off£t
 = 0;

1169 } ià(
™”
->
dœeùiÚ
 =ğ
AL_START_TAIL
) {

1171 
	`D
("Jumpingoƒnd of…revious‚ode");

1172 
™”
->
cu¼’t
 = i‹r->cu¼’t->
´ev
;

1173 
™”
->
off£t
 = -1;

1175 
™”
->
zi
 = 
NULL
;

1176  
	`quickli¡Next
(
™”
, 
’Œy
);

1178 
	}
}

1186 
quickli¡
 *
	$quickli¡Dup
(
quickli¡
 *
Üig
) {

1187 
quickli¡
 *
cİy
;

1189 
cİy
 = 
	`quickli¡New
(
Üig
->
fl
, orig->
com´ess
);

1191 
quickli¡Node
 *
cu¼’t
 = 
Üig
->
h—d
; current;

1192 
cu¼’t
 = cu¼’t->
Ãxt
) {

1193 
quickli¡Node
 *
node
 = 
	`quickli¡C»©eNode
();

1195 ià(
node
->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_LZF
) {

1196 
quickli¡LZF
 *
lzf
 = (quickli¡LZF *)
node
->
zl
;

1197 
size_t
 
lzf_sz
 = (*
lzf
è+†zf->
sz
;

1198 
node
->
zl
 = 
	`zm®loc
(
lzf_sz
);

1199 
	`memıy
(
node
->
zl
, 
cu¼’t
->zl, 
lzf_sz
);

1200 } ià(
node
->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_RAW
) {

1201 
node
->
zl
 = 
	`zm®loc
(
cu¼’t
->
sz
);

1202 
	`memıy
(
node
->
zl
, 
cu¼’t
->zl, cu¼’t->
sz
);

1205 
node
->
couÁ
 = 
cu¼’t
->count;

1206 
cİy
->
couÁ
 +ğ
node
->count;

1207 
node
->
sz
 = 
cu¼’t
->sz;

1208 
node
->
’codšg
 = 
cu¼’t
->encoding;

1210 
	`_quickli¡In£¹NodeAá”
(
cİy
, cİy->

, 
node
);

1214  
cİy
;

1215 
	}
}

1225 
	$quickli¡Index
(cÚ¡ 
quickli¡
 *quickli¡, cÚ¡ 
idx
,

1226 
quickli¡EÁry
 *
’Œy
) {

1227 
quickli¡Node
 *
n
;

1228 
accum
 = 0;

1229 
šdex
;

1230 
fÜw¬d
 = 
idx
 < 0 ? 0 : 1;

1232 
	`š™EÁry
(
’Œy
);

1233 
’Œy
->
quickli¡
 = quicklist;

1235 ià(!
fÜw¬d
) {

1236 
šdex
 = (-
idx
) - 1;

1237 
n
 = 
quickli¡
->

;

1239 
šdex
 = 
idx
;

1240 
n
 = 
quickli¡
->
h—d
;

1243 ià(
šdex
 >ğ
quickli¡
->
couÁ
)

1246 
	`lik–y
(
n
)) {

1247 ià((
accum
 + 
n
->
couÁ
è> 
šdex
) {

1250 
	`D
("Skpšg ov” (%pè%u‡ˆaccum %Îd", (*)
n
,‚->
couÁ
,

1251 
accum
);

1252 
accum
 +ğ
n
->
couÁ
;

1253 
n
 = 
fÜw¬d
 ?‚->
Ãxt
 :‚->
´ev
;

1257 ià(!
n
)

1260 
	`D
("Found‚ode: %°©‡ccum %Îu, idx %Îu, sub+ %Îu, sub- %Îu", (*)
n
,

1261 
accum
, 
šdex
, index -‡ccum, (-index) - 1 +‡ccum);

1263 
’Œy
->
node
 = 
n
;

1264 ià(
fÜw¬d
) {

1266 
’Œy
->
off£t
 = 
šdex
 - 
accum
;

1270 
’Œy
->
off£t
 = (-
šdex
è- 1 + 
accum
;

1273 
	`quickli¡Decom´essNodeFÜU£
(
’Œy
->
node
);

1274 
’Œy
->
zi
 = 
	`zli¡Index
ÓÁry->
node
->
zl
,ƒÁry->
off£t
);

1275 
	`zli¡G‘
(
’Œy
->
zi
, &’Œy->
v®ue
, &’Œy->
sz
, &’Œy->
lÚgv®
);

1279 
	}
}

1282 
	$quickli¡RÙ©e
(
quickli¡
 *quicklist) {

1283 ià(
quickli¡
->
couÁ
 <= 1)

1287 *
p
 = 
	`zli¡Index
(
quickli¡
->

->
zl
, -1);

1288 *
v®ue
;

1289 
lÚgv®
;

1290 
sz
;

1291 
lÚg¡r
[32] = {0};

1292 
	`zli¡G‘
(
p
, &
v®ue
, &
sz
, &
lÚgv®
);

1295 ià(!
v®ue
) {

1297 
sz
 = 
	`Î2¡ršg
(
lÚg¡r
, ÖÚg¡r), 
lÚgv®
);

1298 
v®ue
 = (*)
lÚg¡r
;

1302 
	`quickli¡PushH—d
(
quickli¡
, 
v®ue
, 
sz
);

1307 ià(
quickli¡
->
Ën
 == 1) {

1308 
p
 = 
	`zli¡Index
(
quickli¡
->

->
zl
, -1);

1312 
	`quickli¡D–Index
(
quickli¡
, quickli¡->

, &
p
);

1313 
	}
}

1324 
quickli¡PİCu¡om
(
quickli¡
 *quickli¡, 
wh”e
, **
d©a
,

1325 *
sz
, *
sv®
,

1326 *(*
§v”
)(*
d©a
, 
sz
)) {

1327 *
	gp
;

1328 *
	gv¡r
;

1329 
	gvËn
;

1330 
	gvlÚg
;

1331 
	gpos
 = (
wh”e
 =ğ
QUICKLIST_HEAD
) ? 0 : -1;

1333 ià(
	gquickli¡
->
	gcouÁ
 == 0)

1336 ià(
	gd©a
)

1337 *
	gd©a
 = 
NULL
;

1338 ià(
	gsz
)

1339 *
	gsz
 = 0;

1340 ià(
	gsv®
)

1341 *
	gsv®
 = -123456789;

1343 
quickli¡Node
 *
	gnode
;

1344 ià(
	gwh”e
 =ğ
QUICKLIST_HEAD
 && 
quickli¡
->
h—d
) {

1345 
node
 = 
quickli¡
->
h—d
;

1346 } ià(
	gwh”e
 =ğ
QUICKLIST_TAIL
 && 
quickli¡
->

) {

1347 
node
 = 
quickli¡
->

;

1352 
	gp
 = 
zli¡Index
(
node
->
zl
, 
pos
);

1353 ià(
zli¡G‘
(
p
, &
v¡r
, &
vËn
, &
vlÚg
)) {

1354 ià(
	gv¡r
) {

1355 ià(
	gd©a
)

1356 *
	gd©a
 = 
§v”
(
v¡r
, 
vËn
);

1357 ià(
	gsz
)

1358 *
	gsz
 = 
vËn
;

1360 ià(
	gd©a
)

1361 *
	gd©a
 = 
NULL
;

1362 ià(
	gsv®
)

1363 *
	gsv®
 = 
vlÚg
;

1365 
quickli¡D–Index
(
quickli¡
, 
node
, &
p
);

1372 
REDIS_STATIC
 *
	$_quickli¡Sav”
(*
d©a
, 
sz
) {

1373 *
v¡r
;

1374 ià(
d©a
) {

1375 
v¡r
 = 
	`zm®loc
(
sz
);

1376 
	`memıy
(
v¡r
, 
d©a
, 
sz
);

1377  
v¡r
;

1379  
NULL
;

1380 
	}
}

1385 
	$quickli¡Pİ
(
quickli¡
 *quickli¡, 
wh”e
, **
d©a
,

1386 *
sz
, *
¦Úg
) {

1387 *
v¡r
;

1388 
vËn
;

1389 
vlÚg
;

1390 ià(
quickli¡
->
couÁ
 == 0)

1392 
»t
 = 
	`quickli¡PİCu¡om
(
quickli¡
, 
wh”e
, &
v¡r
, &
vËn
, &
vlÚg
,

1393 
_quickli¡Sav”
);

1394 ià(
d©a
)

1395 *
d©a
 = 
v¡r
;

1396 ià(
¦Úg
)

1397 *
¦Úg
 = 
vlÚg
;

1398 ià(
sz
)

1399 *
sz
 = 
vËn
;

1400  
»t
;

1401 
	}
}

1404 
	$quickli¡Push
(
quickli¡
 *quickli¡, *
v®ue
, cÚ¡ 
size_t
 
sz
,

1405 
wh”e
) {

1406 ià(
wh”e
 =ğ
QUICKLIST_HEAD
) {

1407 
	`quickli¡PushH—d
(
quickli¡
, 
v®ue
, 
sz
);

1408 } ià(
wh”e
 =ğ
QUICKLIST_TAIL
) {

1409 
	`quickli¡PushTa
(
quickli¡
, 
v®ue
, 
sz
);

1411 
	}
}

1414 #ifdeà
REDIS_TEST


1415 
	~<¡dšt.h
>

1416 
	~<sys/time.h
>

1418 
	#as£¹
(
_e
) \

1420 ià(!(
_e
)) { \

1421 
	`´štf
("\n\n=== ASSERTION FAILED ===\n"); \

1422 
	`´štf
("==> %s:%d '%s' i nÙrue\n", 
__FILE__
, 
__LINE__
, #_e); \

1423 
”r
++; \

1425 } 0)

	)

1427 
	#y–l
(
¡r
, ...è
	`´štf
("ERROR! " sŒ "\n\n", 
__VA_ARGS__
)

	)

1429 
	#OK
 
	`´štf
("\tOK\n")

	)

1431 
	#ERROR
 \

1433 
	`´štf
("\tERROR!\n"); \

1434 
”r
++; \

1435 } 0)

	)

1437 
	#ERR
(
x
, ...) \

1439 
	`´štf
("%s:%s:%d:\t", 
__FILE__
, 
__FUNCTION__
, 
__LINE__
); \

1440 
	`´štf
("ERROR! " 
x
 "\n", 
__VA_ARGS__
); \

1441 
”r
++; \

1442 } 0)

	)

1444 
	#TEST
(
Çme
è
	`´štf
("‹¡ â€” %s\n",‚ame);

	)

1445 
	#TEST_DESC
(
Çme
, ...è
	`´štf
("‹¡ â€” "‚am"\n", 
__VA_ARGS__
);

	)

1447 
	#QL_TEST_VERBOSE
 0

	)

1449 
	#UNUSED
(
x
è()(x)

	)

1450 
	$ql_šfo
(
quickli¡
 *
ql
) {

1451 #ià
QL_TEST_VERBOSE


1452 
	`´štf
("CÚš”†’gth: %lu\n", 
ql
->
Ën
);

1453 
	`´štf
("CÚš” size: %lu\n", 
ql
->
couÁ
);

1454 ià(
ql
->
h—d
)

1455 
	`´štf
("\t(zsizh—d: %d)\n", 
	`zli¡L’
(
ql
->
h—d
->
zl
));

1456 ià(
ql
->

)

1457 
	`´štf
("\t(zsiz: %d)\n", 
	`zli¡L’
(
ql
->

->
zl
));

1458 
	`´štf
("\n");

1460 
	`UNUSED
(
ql
);

1462 
	}
}

1465 
	$u¡ime
() {

1466 
timev®
 
tv
;

1467 
u¡
;

1469 
	`g‘timeofday
(&
tv
, 
NULL
);

1470 
u¡
 = (()
tv
.
tv_£c
) * 1000000;

1471 
u¡
 +ğ
tv
.
tv_u£c
;

1472  
u¡
;

1473 
	}
}

1476 
	$m¡ime
(è{  
	`u¡ime
(è/ 1000; 
	}
}

1482 
	$_™½ršŒ
(
quickli¡
 *
ql
, 
´št
, 
fÜw¬d
) {

1483 
quickli¡I‹r
 *
™”
 =

1484 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
fÜw¬d
 ? 
AL_START_HEAD
 : 
AL_START_TAIL
);

1485 
quickli¡EÁry
 
’Œy
;

1486 
i
 = 0;

1487 
p
 = 0;

1488 
quickli¡Node
 *
´ev
 = 
NULL
;

1489 
	`quickli¡Next
(
™”
, &
’Œy
)) {

1490 ià(
’Œy
.
node
 !ğ
´ev
) {

1492 
p
++;

1493 
´ev
 = 
’Œy
.
node
;

1495 ià(
´št
) {

1496 
	`´štf
("[%3d (%2d)]: [%.*s] (%Îd)\n", 
i
, 
p
, 
’Œy
.
sz
,

1497 (*)
’Œy
.
v®ue
,ƒÁry.
lÚgv®
);

1499 
i
++;

1501 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

1502  
i
;

1503 
	}
}

1504 
	$™½ršŒ
(
quickli¡
 *
ql
, 
´št
) {

1505  
	`_™½ršŒ
(
ql
, 
´št
, 1);

1506 
	}
}

1508 
	$™½ršŒ_»v
(
quickli¡
 *
ql
, 
´št
) {

1509  
	`_™½ršŒ
(
ql
, 
´št
, 0);

1510 
	}
}

1512 
	#ql_v”ify
(
a
, 
b
, 
c
, 
d
, 
e
) \

1514 
”r
 +ğ
	`_ql_v”ify
((
a
), (
b
), (
c
), (
d
), (
e
)); \

1515 } 0)

	)

1518 
	$_ql_v”ify
(
quickli¡
 *
ql
, 
ušt32_t
 
Ën
, ušt32_ˆ
couÁ
,

1519 
ušt32_t
 
h—d_couÁ
, ušt32_ˆ
_couÁ
) {

1520 
”rÜs
 = 0;

1522 
	`ql_šfo
(
ql
);

1523 ià(
Ën
 !ğ
ql
->len) {

1524 
	`y–l
("quickli¡†’gth wrÚg:ƒx³ùed %d, gÙ %u", 
Ën
, 
ql
->len);

1525 
”rÜs
++;

1528 ià(
couÁ
 !ğ
ql
->count) {

1529 
	`y–l
("quickli¡ couÁ wrÚg:ƒx³ùed %d, gÙ %lu", 
couÁ
, 
ql
->count);

1530 
”rÜs
++;

1533 
loİr
 = 
	`™½ršŒ
(
ql
, 0);

1534 ià(
loİr
 !ğ()
ql
->
couÁ
) {

1535 
	`y–l
("quicklist cached count‚ot match‡ctual count:ƒxpected %lu, got "

1537 
ql
->
couÁ
, 
loİr
);

1538 
”rÜs
++;

1541 
¾oİr
 = 
	`™½ršŒ_»v
(
ql
, 0);

1542 ià(
loİr
 !ğ
¾oİr
) {

1543 
	`y–l
("quicklist has different forward counthan„everse count! "

1545 
loİr
, 
¾oİr
);

1546 
”rÜs
++;

1549 ià(
ql
->
Ën
 =ğ0 && !
”rÜs
) {

1550 
OK
;

1551  
”rÜs
;

1554 ià(
ql
->
h—d
 && 
h—d_couÁ
 !ğql->h—d->
couÁ
 &&

1555 
h—d_couÁ
 !ğ
	`zli¡L’
(
ql
->
h—d
->
zl
)) {

1556 
	`y–l
("quicklist head count wrong:ƒxpected %d, "

1558 
h—d_couÁ
, 
ql
->
h—d
->
couÁ
, 
	`zli¡L’
(ql->h—d->
zl
));

1559 
”rÜs
++;

1562 ià(
ql
->

 && 
_couÁ
 !ğql->->
couÁ
 &&

1563 
_couÁ
 !ğ
	`zli¡L’
(
ql
->

->
zl
)) {

1564 
	`y–l
("quicklistail count wrong:ƒxpected %d, "

1566 
_couÁ
, 
ql
->

->
couÁ
, 
	`zli¡L’
(ql->->
zl
));

1567 
”rÜs
++;

1570 ià(
	`quickli¡AÎowsCom´essiÚ
(
ql
)) {

1571 
quickli¡Node
 *
node
 = 
ql
->
h—d
;

1572 
low_¿w
 = 
ql
->
com´ess
;

1573 
high_¿w
 = 
ql
->
Ën
 - ql->
com´ess
;

1575 
©
 = 0;‡ˆ< 
ql
->
Ën
;‡t++, 
node
 =‚ode->
Ãxt
) {

1576 ià(
node
 && (
©
 < 
low_¿w
 ||‡ˆ>ğ
high_¿w
)) {

1577 ià(
node
->
’codšg
 !ğ
QUICKLIST_NODE_ENCODING_RAW
) {

1578 
	`y–l
("Incorrect compression:‚ode %d is "

1581 
©
, 
ql
->
com´ess
, 
low_¿w
, 
high_¿w
, ql->
Ën
, 
node
->
sz
,

1582 
node
->
»com´ess
);

1583 
”rÜs
++;

1586 ià(
node
->
’codšg
 !ğ
QUICKLIST_NODE_ENCODING_LZF
 &&

1587 !
node
->
©‹m±ed_com´ess
) {

1588 
	`y–l
("Incorrect‚on-compression:‚ode %d is NOT "

1591 
©
, 
ql
->
com´ess
, 
low_¿w
, 
high_¿w
, ql->
Ën
, 
node
->
sz
,

1592 
node
->
»com´ess
,‚ode->
©‹m±ed_com´ess
);

1593 
”rÜs
++;

1599 ià(!
”rÜs
)

1600 
OK
;

1601  
”rÜs
;

1602 
	}
}

1605 *
	$g’¡r
(*
´efix
, 
i
) {

1606 
»suÉ
[64] = {0};

1607 
	`¢´štf
(
»suÉ
, ÔesuÉ), "%s%d", 
´efix
, 
i
);

1608  
»suÉ
;

1609 
	}
}

1612 
	$quickli¡Te¡
(
¬gc
, *
¬gv
[]) {

1613 
	`UNUSED
(
¬gc
);

1614 
	`UNUSED
(
¬gv
);

1616 
”r
 = 0;

1617 
İtimize_¡¬t
 =

1618 -()((
İtimiz©iÚ_Ëv–
) / (*optimization_level));

1620 
	`´štf
("S¹šg o±imiz©iÚ off£ˆ©: %d\n", 
İtimize_¡¬t
);

1622 
İtiÚs
[] = {0, 1, 2, 3, 4, 5, 6, 10};

1623 
size_t
 
İtiÚ_couÁ
 = (
İtiÚs
) / (*options);

1624 
ruÁime
[
İtiÚ_couÁ
];

1626 
_i
 = 0; _˜< ()
İtiÚ_couÁ
; _i++) {

1627 
	`´štf
("Te¡šg O±iÚ %d\n", 
İtiÚs
[
_i
]);

1628 
¡¬t
 = 
	`m¡ime
();

1630 
	`TEST
("create†ist") {

1631 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1632 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1633 
	`quickli¡R–—£
(
ql
);

1636 
	`TEST
("addoail ofƒmpty†ist") {

1637 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1638 
	`quickli¡PushTa
(
ql
, "hello", 6);

1640 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

1641 
	`quickli¡R–—£
(
ql
);

1644 
	`TEST
("addo head ofƒmpty†ist") {

1645 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1646 
	`quickli¡PushH—d
(
ql
, "hello", 6);

1648 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

1649 
	`quickli¡R–—£
(
ql
);

1652 
f
 = 
İtimize_¡¬t
; f < 32; f++) {

1653 
	`TEST_DESC
("addØ 5x‡ˆfÈ%d‡ˆcom´es %d", 
f
,

1654 
İtiÚs
[
_i
]) {

1655 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1656 
i
 = 0; i < 5; i++)

1657 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1658 ià(
ql
->
couÁ
 != 5)

1659 
ERROR
;

1660 ià(
f
 == 32)

1661 
	`ql_v”ify
(
ql
, 1, 5, 5, 5);

1662 
	`quickli¡R–—£
(
ql
);

1666 
f
 = 
İtimize_¡¬t
; f < 32; f++) {

1667 
	`TEST_DESC
("addØh—d 5x‡ˆfÈ%d‡ˆcom´es %d", 
f
,

1668 
İtiÚs
[
_i
]) {

1669 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1670 
i
 = 0; i < 5; i++)

1671 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1672 ià(
ql
->
couÁ
 != 5)

1673 
ERROR
;

1674 ià(
f
 == 32)

1675 
	`ql_v”ify
(
ql
, 1, 5, 5, 5);

1676 
	`quickli¡R–—£
(
ql
);

1680 
f
 = 
İtimize_¡¬t
; f < 512; f++) {

1681 
	`TEST_DESC
("addØ 500x‡ˆfÈ%d‡ˆcom´es %d", 
f
,

1682 
İtiÚs
[
_i
]) {

1683 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1684 
i
 = 0; i < 500; i++)

1685 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
), 64);

1686 ià(
ql
->
couÁ
 != 500)

1687 
ERROR
;

1688 ià(
f
 == 32)

1689 
	`ql_v”ify
(
ql
, 16, 500, 32, 20);

1690 
	`quickli¡R–—£
(
ql
);

1694 
f
 = 
İtimize_¡¬t
; f < 512; f++) {

1695 
	`TEST_DESC
("addØh—d 500x‡ˆfÈ%d‡ˆcom´es %d", 
f
,

1696 
İtiÚs
[
_i
]) {

1697 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1698 
i
 = 0; i < 500; i++)

1699 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1700 ià(
ql
->
couÁ
 != 500)

1701 
ERROR
;

1702 ià(
f
 == 32)

1703 
	`ql_v”ify
(
ql
, 16, 500, 20, 32);

1704 
	`quickli¡R–—£
(
ql
);

1708 
	`TEST
("rotateƒmpty") {

1709 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1710 
	`quickli¡RÙ©e
(
ql
);

1711 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1712 
	`quickli¡R–—£
(
ql
);

1715 
f
 = 
İtimize_¡¬t
; f < 32; f++) {

1716 
	`TEST
("rotate one val once") {

1717 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1718 
	`quickli¡PushH—d
(
ql
, "hello", 6);

1719 
	`quickli¡RÙ©e
(
ql
);

1722 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

1723 
	`quickli¡R–—£
(
ql
);

1727 
f
 = 
İtimize_¡¬t
; f < 3; f++) {

1728 
	`TEST_DESC
("rÙ©500 v® 5000ime © fÈ%d‡ˆcom´es %d", 
f
,

1729 
İtiÚs
[
_i
]) {

1730 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1731 
	`quickli¡PushH—d
(
ql
, "900", 3);

1732 
	`quickli¡PushH—d
(
ql
, "7000", 4);

1733 
	`quickli¡PushH—d
(
ql
, "-1200", 5);

1734 
	`quickli¡PushH—d
(
ql
, "42", 2);

1735 
i
 = 0; i < 500; i++)

1736 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 64);

1737 
	`ql_šfo
(
ql
);

1738 
i
 = 0; i < 5000; i++) {

1739 
	`ql_šfo
(
ql
);

1740 
	`quickli¡RÙ©e
(
ql
);

1742 ià(
f
 == 1)

1743 
	`ql_v”ify
(
ql
, 504, 504, 1, 1);

1744 ià(
f
 == 2)

1745 
	`ql_v”ify
(
ql
, 252, 504, 2, 2);

1746 ià(
f
 == 32)

1747 
	`ql_v”ify
(
ql
, 16, 504, 32, 24);

1748 
	`quickli¡R–—£
(
ql
);

1752 
	`TEST
("popƒmpty") {

1753 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1754 
	`quickli¡Pİ
(
ql
, 
QUICKLIST_HEAD
, 
NULL
, NULL, NULL);

1755 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1756 
	`quickli¡R–—£
(
ql
);

1759 
	`TEST
("pop 1 string from 1") {

1760 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1761 *
pİuÏ‹
 = 
	`g’¡r
("hello", 331);

1762 
	`quickli¡PushH—d
(
ql
, 
pİuÏ‹
, 32);

1763 *
d©a
;

1764 
sz
;

1765 
lv
;

1766 
	`ql_šfo
(
ql
);

1767 
	`quickli¡Pİ
(
ql
, 
QUICKLIST_HEAD
, &
d©a
, &
sz
, &
lv
);

1768 
	`as£¹
(
d©a
 !ğ
NULL
);

1769 
	`as£¹
(
sz
 == 32);

1770 ià(
	`¡rcmp
(
pİuÏ‹
, (*)
d©a
))

1771 
	`ERR
("Pİ'd v®u(%.*sèdidn'ˆequ® origš® v®u(%s)", 
sz
,

1772 
d©a
, 
pİuÏ‹
);

1773 
	`zä“
(
d©a
);

1774 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1775 
	`quickli¡R–—£
(
ql
);

1778 
	`TEST
("pop head 1‚umber from 1") {

1779 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1780 
	`quickli¡PushH—d
(
ql
, "55513", 5);

1781 *
d©a
;

1782 
sz
;

1783 
lv
;

1784 
	`ql_šfo
(
ql
);

1785 
	`quickli¡Pİ
(
ql
, 
QUICKLIST_HEAD
, &
d©a
, &
sz
, &
lv
);

1786 
	`as£¹
(
d©a
 =ğ
NULL
);

1787 
	`as£¹
(
lv
 == 55513);

1788 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1789 
	`quickli¡R–—£
(
ql
);

1792 
	`TEST
("pop head 500 from 500") {

1793 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1794 
i
 = 0; i < 500; i++)

1795 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1796 
	`ql_šfo
(
ql
);

1797 
i
 = 0; i < 500; i++) {

1798 *
d©a
;

1799 
sz
;

1800 
lv
;

1801 
»t
 = 
	`quickli¡Pİ
(
ql
, 
QUICKLIST_HEAD
, &
d©a
, &
sz
, &
lv
);

1802 
	`as£¹
(
»t
 == 1);

1803 
	`as£¹
(
d©a
 !ğ
NULL
);

1804 
	`as£¹
(
sz
 == 32);

1805 ià(
	`¡rcmp
(
	`g’¡r
("h–lo", 499 - 
i
), (*)
d©a
))

1806 
	`ERR
("Pop'd value (%.*s) didn'tƒqual original value (%s)",

1807 
sz
, 
d©a
, 
	`g’¡r
("h–lo", 499 - 
i
));

1808 
	`zä“
(
d©a
);

1810 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1811 
	`quickli¡R–—£
(
ql
);

1814 
	`TEST
("pop head 5000 from 500") {

1815 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1816 
i
 = 0; i < 500; i++)

1817 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1818 
i
 = 0; i < 5000; i++) {

1819 *
d©a
;

1820 
sz
;

1821 
lv
;

1822 
»t
 = 
	`quickli¡Pİ
(
ql
, 
QUICKLIST_HEAD
, &
d©a
, &
sz
, &
lv
);

1823 ià(
i
 < 500) {

1824 
	`as£¹
(
»t
 == 1);

1825 
	`as£¹
(
d©a
 !ğ
NULL
);

1826 
	`as£¹
(
sz
 == 32);

1827 ià(
	`¡rcmp
(
	`g’¡r
("h–lo", 499 - 
i
), (*)
d©a
))

1828 
	`ERR
("Pop'd value (%.*s) didn'tƒqual original value "

1830 
sz
, 
d©a
, 
	`g’¡r
("h–lo", 499 - 
i
));

1831 
	`zä“
(
d©a
);

1833 
	`as£¹
(
»t
 == 0);

1836 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

1837 
	`quickli¡R–—£
(
ql
);

1840 
	`TEST
("iterate forward over 500†ist") {

1841 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1842 
	`quickli¡S‘Fl
(
ql
, 32);

1843 
i
 = 0; i < 500; i++)

1844 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1845 
quickli¡I‹r
 *
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_HEAD
);

1846 
quickli¡EÁry
 
’Œy
;

1847 
i
 = 499, 
couÁ
 = 0;

1848 
	`quickli¡Next
(
™”
, &
’Œy
)) {

1849 *
h
 = 
	`g’¡r
("h–lo", 
i
);

1850 ià(
	`¡rcmp
((*)
’Œy
.
v®ue
, 
h
))

1851 
	`ERR
("value [%s] didn't match [%s]‡t…osition %d",

1852 
’Œy
.
v®ue
, 
h
, 
i
);

1853 
i
--;

1854 
couÁ
++;

1856 ià(
couÁ
 != 500)

1857 
	`ERR
("Didn'ˆ™”©ov”ƒxaùly 500ƒËm’t (%d)", 
i
);

1858 
	`ql_v”ify
(
ql
, 16, 500, 20, 32);

1859 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

1860 
	`quickli¡R–—£
(
ql
);

1863 
	`TEST
("iterate„everse over 500†ist") {

1864 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1865 
	`quickli¡S‘Fl
(
ql
, 32);

1866 
i
 = 0; i < 500; i++)

1867 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1868 
quickli¡I‹r
 *
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_TAIL
);

1869 
quickli¡EÁry
 
’Œy
;

1870 
i
 = 0;

1871 
	`quickli¡Next
(
™”
, &
’Œy
)) {

1872 *
h
 = 
	`g’¡r
("h–lo", 
i
);

1873 ià(
	`¡rcmp
((*)
’Œy
.
v®ue
, 
h
))

1874 
	`ERR
("value [%s] didn't match [%s]‡t…osition %d",

1875 
’Œy
.
v®ue
, 
h
, 
i
);

1876 
i
++;

1878 ià(
i
 != 500)

1879 
	`ERR
("Didn'ˆ™”©ov”ƒxaùly 500ƒËm’t (%d)", 
i
);

1880 
	`ql_v”ify
(
ql
, 16, 500, 20, 32);

1881 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

1882 
	`quickli¡R–—£
(
ql
);

1885 
	`TEST
("insert before with 0ƒlements") {

1886 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1887 
quickli¡EÁry
 
’Œy
;

1888 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

1889 
	`quickli¡In£¹BefÜe
(
ql
, &
’Œy
, "abc", 4);

1890 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

1891 
	`quickli¡R–—£
(
ql
);

1894 
	`TEST
("insert‡fter with 0ƒlements") {

1895 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1896 
quickli¡EÁry
 
’Œy
;

1897 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

1898 
	`quickli¡In£¹Aá”
(
ql
, &
’Œy
, "abc", 4);

1899 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

1900 
	`quickli¡R–—£
(
ql
);

1903 
	`TEST
("insert‡fter 1ƒlement") {

1904 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1905 
	`quickli¡PushH—d
(
ql
, "hello", 6);

1906 
quickli¡EÁry
 
’Œy
;

1907 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

1908 
	`quickli¡In£¹Aá”
(
ql
, &
’Œy
, "abc", 4);

1909 
	`ql_v”ify
(
ql
, 1, 2, 2, 2);

1910 
	`quickli¡R–—£
(
ql
);

1913 
	`TEST
("insert before 1ƒlement") {

1914 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

1915 
	`quickli¡PushH—d
(
ql
, "hello", 6);

1916 
quickli¡EÁry
 
’Œy
;

1917 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

1918 
	`quickli¡In£¹Aá”
(
ql
, &
’Œy
, "abc", 4);

1919 
	`ql_v”ify
(
ql
, 1, 2, 2, 2);

1920 
	`quickli¡R–—£
(
ql
);

1923 
f
 = 
İtimize_¡¬t
; f < 12; f++) {

1924 
	`TEST_DESC
("insert once inƒlements while iterating‡t fill %d‡t "

1926 
f
, 
İtiÚs
[
_i
]) {

1927 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1928 
	`quickli¡PushTa
(
ql
, "abc", 3);

1929 
	`quickli¡S‘Fl
(
ql
, 1);

1930 
	`quickli¡PushTa
(
ql
, "def", 3);

1931 
	`quickli¡S‘Fl
(
ql
, 
f
);

1932 
	`quickli¡PushTa
(
ql
, "bob", 3);

1933 
	`quickli¡PushTa
(
ql
, "foo", 3);

1934 
	`quickli¡PushTa
(
ql
, "zoo", 3);

1936 
	`™½ršŒ
(
ql
, 0);

1938 
quickli¡I‹r
 *
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_HEAD
);

1939 
quickli¡EÁry
 
’Œy
;

1940 
	`quickli¡Next
(
™”
, &
’Œy
)) {

1941 ià(!
	`¡ºcmp
((*)
’Œy
.
v®ue
, "bob", 3)) {

1943 
	`quickli¡In£¹BefÜe
(
ql
, &
’Œy
, "bar", 3);

1947 
	`™½ršŒ
(
ql
, 0);

1950 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

1951 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "abc", 3))

1952 
	`ERR
("V®u0 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1953 
’Œy
.
v®ue
);

1954 
	`quickli¡Index
(
ql
, 1, &
’Œy
);

1955 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "def", 3))

1956 
	`ERR
("V®u1 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1957 
’Œy
.
v®ue
);

1958 
	`quickli¡Index
(
ql
, 2, &
’Œy
);

1959 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "bar", 3))

1960 
	`ERR
("V®u2 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1961 
’Œy
.
v®ue
);

1962 
	`quickli¡Index
(
ql
, 3, &
’Œy
);

1963 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "bob", 3))

1964 
	`ERR
("V®u3 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1965 
’Œy
.
v®ue
);

1966 
	`quickli¡Index
(
ql
, 4, &
’Œy
);

1967 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "foo", 3))

1968 
	`ERR
("V®u4 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1969 
’Œy
.
v®ue
);

1970 
	`quickli¡Index
(
ql
, 5, &
’Œy
);

1971 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "zoo", 3))

1972 
	`ERR
("V®u5 didn'ˆm©ch, in¡—d gÙ: %.*s", 
’Œy
.
sz
,

1973 
’Œy
.
v®ue
);

1974 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

1975 
	`quickli¡R–—£
(
ql
);

1979 
f
 = 
İtimize_¡¬t
; f < 1024; f++) {

1980 
	`TEST_DESC
(

1983 
f
, 
İtiÚs
[
_i
]) {

1984 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

1985 
i
 = 0; i < 500; i++)

1986 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

1987 
i
 = 0; i < 250; i++) {

1988 
quickli¡EÁry
 
’Œy
;

1989 
	`quickli¡Index
(
ql
, 250, &
’Œy
);

1990 
	`quickli¡In£¹BefÜe
(
ql
, &
’Œy
, 
	`g’¡r
("abc", 
i
), 32);

1992 ià(
f
 == 32)

1993 
	`ql_v”ify
(
ql
, 25, 750, 32, 20);

1994 
	`quickli¡R–—£
(
ql
);

1998 
f
 = 
İtimize_¡¬t
; f < 1024; f++) {

1999 
	`TEST_DESC
("insert [after] 250‚ew in middle of 500ƒlements‡t "

2001 
f
, 
İtiÚs
[
_i
]) {

2002 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2003 
i
 = 0; i < 500; i++)

2004 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

2005 
i
 = 0; i < 250; i++) {

2006 
quickli¡EÁry
 
’Œy
;

2007 
	`quickli¡Index
(
ql
, 250, &
’Œy
);

2008 
	`quickli¡In£¹Aá”
(
ql
, &
’Œy
, 
	`g’¡r
("abc", 
i
), 32);

2011 ià(
ql
->
couÁ
 != 750)

2012 
	`ERR
("Li¡ siznÙ 750, buˆ¿th” %ld", 
ql
->
couÁ
);

2014 ià(
f
 == 32)

2015 
	`ql_v”ify
(
ql
, 26, 750, 20, 32);

2016 
	`quickli¡R–—£
(
ql
);

2020 
	`TEST
("duplicateƒmpty†ist") {

2021 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2022 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

2023 
quickli¡
 *
cİy
 = 
	`quickli¡Dup
(
ql
);

2024 
	`ql_v”ify
(
cİy
, 0, 0, 0, 0);

2025 
	`quickli¡R–—£
(
ql
);

2026 
	`quickli¡R–—£
(
cİy
);

2029 
	`TEST
("duplicate†ist of 1ƒlement") {

2030 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2031 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("hello", 3), 32);

2032 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

2033 
quickli¡
 *
cİy
 = 
	`quickli¡Dup
(
ql
);

2034 
	`ql_v”ify
(
cİy
, 1, 1, 1, 1);

2035 
	`quickli¡R–—£
(
ql
);

2036 
	`quickli¡R–—£
(
cİy
);

2039 
	`TEST
("duplicate†ist of 500") {

2040 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2041 
	`quickli¡S‘Fl
(
ql
, 32);

2042 
i
 = 0; i < 500; i++)

2043 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

2044 
	`ql_v”ify
(
ql
, 16, 500, 20, 32);

2046 
quickli¡
 *
cİy
 = 
	`quickli¡Dup
(
ql
);

2047 
	`ql_v”ify
(
cİy
, 16, 500, 20, 32);

2048 
	`quickli¡R–—£
(
ql
);

2049 
	`quickli¡R–—£
(
cİy
);

2052 
f
 = 
İtimize_¡¬t
; f < 512; f++) {

2053 
	`TEST_DESC
("šdex 1,200 from 500†i¡‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2054 
İtiÚs
[
_i
]) {

2055 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2056 
i
 = 0; i < 500; i++)

2057 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2058 
quickli¡EÁry
 
’Œy
;

2059 
	`quickli¡Index
(
ql
, 1, &
’Œy
);

2060 ià(!
	`¡rcmp
((*)
’Œy
.
v®ue
, "hello2"))

2061 
OK
;

2063 
	`ERR
("V®ue: %s", 
’Œy
.
v®ue
);

2064 
	`quickli¡Index
(
ql
, 200, &
’Œy
);

2065 ià(!
	`¡rcmp
((*)
’Œy
.
v®ue
, "hello201"))

2066 
OK
;

2068 
	`ERR
("V®ue: %s", 
’Œy
.
v®ue
);

2069 
	`quickli¡R–—£
(
ql
);

2072 
	`TEST_DESC
("šdex -1,-2 from 500†i¡‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2073 
İtiÚs
[
_i
]) {

2074 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2075 
i
 = 0; i < 500; i++)

2076 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2077 
quickli¡EÁry
 
’Œy
;

2078 
	`quickli¡Index
(
ql
, -1, &
’Œy
);

2079 ià(!
	`¡rcmp
((*)
’Œy
.
v®ue
, "hello500"))

2080 
OK
;

2082 
	`ERR
("V®ue: %s", 
’Œy
.
v®ue
);

2083 
	`quickli¡Index
(
ql
, -2, &
’Œy
);

2084 ià(!
	`¡rcmp
((*)
’Œy
.
v®ue
, "hello499"))

2085 
OK
;

2087 
	`ERR
("V®ue: %s", 
’Œy
.
v®ue
);

2088 
	`quickli¡R–—£
(
ql
);

2091 
	`TEST_DESC
("šdex -100 from 500†i¡‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2092 
İtiÚs
[
_i
]) {

2093 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2094 
i
 = 0; i < 500; i++)

2095 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2096 
quickli¡EÁry
 
’Œy
;

2097 
	`quickli¡Index
(
ql
, -100, &
’Œy
);

2098 ià(!
	`¡rcmp
((*)
’Œy
.
v®ue
, "hello401"))

2099 
OK
;

2101 
	`ERR
("V®ue: %s", 
’Œy
.
v®ue
);

2102 
	`quickli¡R–—£
(
ql
);

2105 
	`TEST_DESC
("indexoo big +1 from 50†ist‡t fill %d‡t compress %d",

2106 
f
, 
İtiÚs
[
_i
]) {

2107 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2108 
i
 = 0; i < 50; i++)

2109 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2110 
quickli¡EÁry
 
’Œy
;

2111 ià(
	`quickli¡Index
(
ql
, 50, &
’Œy
))

2112 
	`ERR
("Index found‡ˆ50 w™h 50†i¡: %.*s", 
’Œy
.
sz
,

2113 
’Œy
.
v®ue
);

2115 
OK
;

2116 
	`quickli¡R–—£
(
ql
);

2120 
	`TEST
("delete„angeƒmpty†ist") {

2121 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2122 
	`quickli¡D–Rªge
(
ql
, 5, 20);

2123 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

2124 
	`quickli¡R–—£
(
ql
);

2127 
	`TEST
("delete„ange ofƒntire‚ode in†ist of one‚ode") {

2128 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2129 
i
 = 0; i < 32; i++)

2130 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

2131 
	`ql_v”ify
(
ql
, 1, 32, 32, 32);

2132 
	`quickli¡D–Rªge
(
ql
, 0, 32);

2133 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

2134 
	`quickli¡R–—£
(
ql
);

2137 
	`TEST
("delete„ange ofƒntire‚ode with overflow counts") {

2138 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2139 
i
 = 0; i < 32; i++)

2140 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lo", 
i
), 32);

2141 
	`ql_v”ify
(
ql
, 1, 32, 32, 32);

2142 
	`quickli¡D–Rªge
(
ql
, 0, 128);

2143 
	`ql_v”ify
(
ql
, 0, 0, 0, 0);

2144 
	`quickli¡R–—£
(
ql
);

2147 
	`TEST
("delete middle 100 of 500†ist") {

2148 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2149 
	`quickli¡S‘Fl
(
ql
, 32);

2150 
i
 = 0; i < 500; i++)

2151 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2152 
	`ql_v”ify
(
ql
, 16, 500, 32, 20);

2153 
	`quickli¡D–Rªge
(
ql
, 200, 100);

2154 
	`ql_v”ify
(
ql
, 14, 400, 32, 20);

2155 
	`quickli¡R–—£
(
ql
);

2158 
	`TEST
("delete‚egative 1 from 500†ist") {

2159 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2160 
	`quickli¡S‘Fl
(
ql
, 32);

2161 
i
 = 0; i < 500; i++)

2162 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2163 
	`ql_v”ify
(
ql
, 16, 500, 32, 20);

2164 
	`quickli¡D–Rªge
(
ql
, -1, 1);

2165 
	`ql_v”ify
(
ql
, 16, 499, 32, 19);

2166 
	`quickli¡R–—£
(
ql
);

2169 
	`TEST
("delete‚egative 1 from 500†ist with overflow counts") {

2170 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2171 
	`quickli¡S‘Fl
(
ql
, 32);

2172 
i
 = 0; i < 500; i++)

2173 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2174 
	`ql_v”ify
(
ql
, 16, 500, 32, 20);

2175 
	`quickli¡D–Rªge
(
ql
, -1, 128);

2176 
	`ql_v”ify
(
ql
, 16, 499, 32, 19);

2177 
	`quickli¡R–—£
(
ql
);

2180 
	`TEST
("delete‚egative 100 from 500†ist") {

2181 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2182 
	`quickli¡S‘Fl
(
ql
, 32);

2183 
i
 = 0; i < 500; i++)

2184 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2185 
	`quickli¡D–Rªge
(
ql
, -100, 100);

2186 
	`ql_v”ify
(
ql
, 13, 400, 32, 16);

2187 
	`quickli¡R–—£
(
ql
);

2190 
	`TEST
("delete -10 count 5 from 50†ist") {

2191 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2192 
	`quickli¡S‘Fl
(
ql
, 32);

2193 
i
 = 0; i < 50; i++)

2194 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lo", 
i
 + 1), 32);

2195 
	`ql_v”ify
(
ql
, 2, 50, 32, 18);

2196 
	`quickli¡D–Rªge
(
ql
, -10, 5);

2197 
	`ql_v”ify
(
ql
, 2, 45, 32, 13);

2198 
	`quickli¡R–—£
(
ql
);

2201 
	`TEST
("numbers only†ist„ead") {

2202 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2203 
	`quickli¡PushTa
(
ql
, "1111", 4);

2204 
	`quickli¡PushTa
(
ql
, "2222", 4);

2205 
	`quickli¡PushTa
(
ql
, "3333", 4);

2206 
	`quickli¡PushTa
(
ql
, "4444", 4);

2207 
	`ql_v”ify
(
ql
, 1, 4, 4, 4);

2208 
quickli¡EÁry
 
’Œy
;

2209 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

2210 ià(
’Œy
.
lÚgv®
 != 1111)

2211 
	`ERR
("NÙ 1111, %Îd", 
’Œy
.
lÚgv®
);

2212 
	`quickli¡Index
(
ql
, 1, &
’Œy
);

2213 ià(
’Œy
.
lÚgv®
 != 2222)

2214 
	`ERR
("NÙ 2222, %Îd", 
’Œy
.
lÚgv®
);

2215 
	`quickli¡Index
(
ql
, 2, &
’Œy
);

2216 ià(
’Œy
.
lÚgv®
 != 3333)

2217 
	`ERR
("NÙ 3333, %Îd", 
’Œy
.
lÚgv®
);

2218 
	`quickli¡Index
(
ql
, 3, &
’Œy
);

2219 ià(
’Œy
.
lÚgv®
 != 4444)

2220 
	`ERR
("NÙ 4444, %Îd", 
’Œy
.
lÚgv®
);

2221 ià(
	`quickli¡Index
(
ql
, 4, &
’Œy
))

2222 
	`ERR
("Index…a¡ƒËm’ts: %Îd", 
’Œy
.
lÚgv®
);

2223 
	`quickli¡Index
(
ql
, -1, &
’Œy
);

2224 ià(
’Œy
.
lÚgv®
 != 4444)

2225 
	`ERR
("NÙ 4444 (»v”£), %Îd", 
’Œy
.
lÚgv®
);

2226 
	`quickli¡Index
(
ql
, -2, &
’Œy
);

2227 ià(
’Œy
.
lÚgv®
 != 3333)

2228 
	`ERR
("NÙ 3333 (»v”£), %Îd", 
’Œy
.
lÚgv®
);

2229 
	`quickli¡Index
(
ql
, -3, &
’Œy
);

2230 ià(
’Œy
.
lÚgv®
 != 2222)

2231 
	`ERR
("NÙ 2222 (»v”£), %Îd", 
’Œy
.
lÚgv®
);

2232 
	`quickli¡Index
(
ql
, -4, &
’Œy
);

2233 ià(
’Œy
.
lÚgv®
 != 1111)

2234 
	`ERR
("NÙ 1111 (»v”£), %Îd", 
’Œy
.
lÚgv®
);

2235 ià(
	`quickli¡Index
(
ql
, -5, &
’Œy
))

2236 
	`ERR
("Index…a¡ƒËm’t Ôev”£), %Îd", 
’Œy
.
lÚgv®
);

2237 
	`quickli¡R–—£
(
ql
);

2240 
	`TEST
("numbers†arger†ist„ead") {

2241 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2242 
	`quickli¡S‘Fl
(
ql
, 32);

2243 
num
[32];

2244 
nums
[5000];

2245 
i
 = 0; i < 5000; i++) {

2246 
nums
[
i
] = -5157318210846258176 + i;

2247 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2248 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2250 
	`quickli¡PushTa
(
ql
, "xxxxxxxxxxxxxxxxxxxx", 20);

2251 
quickli¡EÁry
 
’Œy
;

2252 
i
 = 0; i < 5000; i++) {

2253 
	`quickli¡Index
(
ql
, 
i
, &
’Œy
);

2254 ià(
’Œy
.
lÚgv®
 !ğ
nums
[
i
])

2255 
	`ERR
("[%d] NÙ†Úgv® %Îd buˆ¿th” %Îd", 
i
, 
nums
[i],

2256 
’Œy
.
lÚgv®
);

2257 
’Œy
.
lÚgv®
 = 0xdeadbeef;

2259 
	`quickli¡Index
(
ql
, 5000, &
’Œy
);

2260 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "xxxxxxxxxxxxxxxxxxxx", 20))

2261 
	`ERR
("SŒšg v®‚Ù m©ch: %s", 
’Œy
.
v®ue
);

2262 
	`ql_v”ify
(
ql
, 157, 5001, 32, 9);

2263 
	`quickli¡R–—£
(
ql
);

2266 
	`TEST
("numbers†arger†ist„ead B") {

2267 
quickli¡
 *
ql
 = 
	`quickli¡New
(-2, 
İtiÚs
[
_i
]);

2268 
	`quickli¡PushTa
(
ql
, "99", 2);

2269 
	`quickli¡PushTa
(
ql
, "98", 2);

2270 
	`quickli¡PushTa
(
ql
, "xxxxxxxxxxxxxxxxxxxx", 20);

2271 
	`quickli¡PushTa
(
ql
, "96", 2);

2272 
	`quickli¡PushTa
(
ql
, "95", 2);

2273 
	`quickli¡R•ÏûAtIndex
(
ql
, 1, "foo", 3);

2274 
	`quickli¡R•ÏûAtIndex
(
ql
, -1, "bar", 3);

2275 
	`quickli¡R–—£
(
ql
);

2276 
OK
;

2279 
f
 = 
İtimize_¡¬t
; f < 16; f++) {

2280 
	`TEST_DESC
("Ìeme¡‡ˆfÈ%d‡ˆcom´es %d", 
f
, 
İtiÚs
[
_i
]) {

2281 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2282 *
wÜds
[] = {"abc", "foo", "bar", "foobar", "foobared",

2284 *
»suÉ
[] = {"abc", "foo", "foobar", "foobared",

2286 *
»suÉB
[] = {"abc", "foo", "foobar",

2288 
i
 = 0; i < 9; i++)

2289 
	`quickli¡PushTa
(
ql
, 
wÜds
[
i
], 
	`¡¾’
(words[i]));

2292 
quickli¡I‹r
 *
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_HEAD
);

2293 
quickli¡EÁry
 
’Œy
;

2294 
i
 = 0;

2295 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2296 ià(
	`quickli¡Com·»
(
’Œy
.
zi
, (*)"bar", 3)) {

2297 
	`quickli¡D–EÁry
(
™”
, &
’Œy
);

2299 
i
++;

2301 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2304 
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_HEAD
);

2305 
i
 = 0;

2306 
ok
 = 1;

2307 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2310 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, 
»suÉ
[
i
],ƒÁry.
sz
)) {

2311 
	`ERR
("No match‡t…osition %d, got %.*s instead of %s",

2312 
i
, 
’Œy
.
sz
,ƒÁry.
v®ue
, 
»suÉ
[i]);

2313 
ok
 = 0;

2315 
i
++;

2317 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2319 
	`quickli¡PushTa
(
ql
, "foo", 3);

2322 
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_TAIL
);

2323 
i
 = 0;

2324 
d–
 = 2;

2325 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2326 ià(
	`quickli¡Com·»
(
’Œy
.
zi
, (*)"foo", 3)) {

2327 
	`quickli¡D–EÁry
(
™”
, &
’Œy
);

2328 
d–
--;

2330 ià(!
d–
)

2332 
i
++;

2334 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2340 
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_TAIL
);

2341 
i
 = 0;

2342 
size_t
 
»sB
 = (
»suÉB
) / (*resultB);

2343 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2346 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, 
»suÉB
[
»sB
 - 1 - 
i
],

2347 
’Œy
.
sz
)) {

2348 
	`ERR
("No match‡t…osition %d, got %.*s instead of %s",

2349 
i
, 
’Œy
.
sz
,ƒÁry.
v®ue
, 
»suÉB
[
»sB
 - 1 - i]);

2350 
ok
 = 0;

2352 
i
++;

2355 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2357 ià(
ok
)

2358 
OK
;

2359 
	`quickli¡R–—£
(
ql
);

2363 
f
 = 
İtimize_¡¬t
; f < 16; f++) {

2364 
	`TEST_DESC
("™”©»v”£ + d–‘© fÈ%d‡ˆcom´es %d", 
f
,

2365 
İtiÚs
[
_i
]) {

2366 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2367 
	`quickli¡PushTa
(
ql
, "abc", 3);

2368 
	`quickli¡PushTa
(
ql
, "def", 3);

2369 
	`quickli¡PushTa
(
ql
, "hij", 3);

2370 
	`quickli¡PushTa
(
ql
, "jkl", 3);

2371 
	`quickli¡PushTa
(
ql
, "oop", 3);

2373 
quickli¡EÁry
 
’Œy
;

2374 
quickli¡I‹r
 *
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_TAIL
);

2375 
i
 = 0;

2376 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2377 ià(
	`quickli¡Com·»
(
’Œy
.
zi
, (*)"hij", 3)) {

2378 
	`quickli¡D–EÁry
(
™”
, &
’Œy
);

2380 
i
++;

2382 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2384 ià(
i
 != 5)

2385 
	`ERR
("Didn'ˆ™”©5imes, i‹¿‹d %dimes.", 
i
);

2388 
™”
 = 
	`quickli¡G‘I‹¿tÜ
(
ql
, 
AL_START_HEAD
);

2389 
i
 = 0;

2390 *
v®s
[] = {"abc", "def", "jkl", "oop"};

2391 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2392 ià(!
	`quickli¡Com·»
(
’Œy
.
zi
, (*)
v®s
[
i
],

2394 
	`ERR
("V®u© %d didn'ˆm©ch %s\n", 
i
, 
v®s
[i]);

2396 
i
++;

2398 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2399 
	`quickli¡R–—£
(
ql
);

2403 
f
 = 
İtimize_¡¬t
; f < 800; f++) {

2404 
	`TEST_DESC
("™”©Ü‡ˆšdexe¡‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2405 
İtiÚs
[
_i
]) {

2406 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2407 
num
[32];

2408 
nums
[5000];

2409 
i
 = 0; i < 760; i++) {

2410 
nums
[
i
] = -5157318210846258176 + i;

2411 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2412 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2415 
quickli¡EÁry
 
’Œy
;

2416 
quickli¡I‹r
 *
™”
 =

2417 
	`quickli¡G‘I‹¿tÜAtIdx
(
ql
, 
AL_START_HEAD
, 437);

2418 
i
 = 437;

2419 
	`quickli¡Next
(
™”
, &
’Œy
)) {

2420 ià(
’Œy
.
lÚgv®
 !ğ
nums
[
i
])

2421 
	`ERR
("Ex³ùed %Îd, buˆgÙ %Îd", 
’Œy
.
lÚgv®
,

2422 
nums
[
i
]);

2423 
i
++;

2425 
	`quickli¡R–—£I‹¿tÜ
(
™”
);

2426 
	`quickli¡R–—£
(
ql
);

2430 
f
 = 
İtimize_¡¬t
; f < 40; f++) {

2431 
	`TEST_DESC
("Érime¡ A‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2432 
İtiÚs
[
_i
]) {

2433 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2434 
num
[32];

2435 
nums
[5000];

2436 
i
 = 0; i < 32; i++) {

2437 
nums
[
i
] = -5157318210846258176 + i;

2438 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2439 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2441 ià(
f
 == 32)

2442 
	`ql_v”ify
(
ql
, 1, 32, 32, 32);

2444 
	`quickli¡D–Rªge
(
ql
, 0, 25);

2445 
	`quickli¡D–Rªge
(
ql
, 0, 0);

2446 
quickli¡EÁry
 
’Œy
;

2447 
i
 = 0; i < 7; i++) {

2448 
	`quickli¡Index
(
ql
, 
i
, &
’Œy
);

2449 ià(
’Œy
.
lÚgv®
 !ğ
nums
[25 + 
i
])

2450 
	`ERR
("Deleted invalid„ange! Expected %lld but got "

2452 
’Œy
.
lÚgv®
, 
nums
[25 + 
i
]);

2454 ià(
f
 == 32)

2455 
	`ql_v”ify
(
ql
, 1, 7, 7, 7);

2456 
	`quickli¡R–—£
(
ql
);

2460 
f
 = 
İtimize_¡¬t
; f < 40; f++) {

2461 
	`TEST_DESC
("Érime¡ B‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2462 
İtiÚs
[
_i
]) {

2465 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
QUICKLIST_NOCOMPRESS
);

2466 
num
[32];

2467 
nums
[5000];

2468 
i
 = 0; i < 33; i++) {

2469 
nums
[
i
] = i;

2470 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2471 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2473 ià(
f
 == 32)

2474 
	`ql_v”ify
(
ql
, 2, 33, 32, 1);

2476 
	`quickli¡D–Rªge
(
ql
, 0, 5);

2477 
	`quickli¡D–Rªge
(
ql
, -16, 16);

2478 ià(
f
 == 32)

2479 
	`ql_v”ify
(
ql
, 1, 12, 12, 12);

2480 
quickli¡EÁry
 
’Œy
;

2481 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

2482 ià(
’Œy
.
lÚgv®
 != 5)

2483 
	`ERR
("A:†Úgv®‚Ù 5, buˆ%Îd", 
’Œy
.
lÚgv®
);

2485 
OK
;

2486 
	`quickli¡Index
(
ql
, -1, &
’Œy
);

2487 ià(
’Œy
.
lÚgv®
 != 16)

2488 
	`ERR
("B! gÙ in¡—d: %Îd", 
’Œy
.
lÚgv®
);

2490 
OK
;

2491 
	`quickli¡PushTa
(
ql
, "bobobob", 7);

2492 
	`quickli¡Index
(
ql
, -1, &
’Œy
);

2493 ià(
	`¡ºcmp
((*)
’Œy
.
v®ue
, "bobobob", 7))

2494 
	`ERR
("Tail doesn't match bobobob, it's %.*s instead",

2495 
’Œy
.
sz
,ƒÁry.
v®ue
);

2496 
i
 = 0; i < 12; i++) {

2497 
	`quickli¡Index
(
ql
, 
i
, &
’Œy
);

2498 ià(
’Œy
.
lÚgv®
 !ğ
nums
[5 + 
i
])

2499 
	`ERR
("Deleted invalid„ange! Expected %lld but got "

2501 
’Œy
.
lÚgv®
, 
nums
[5 + 
i
]);

2503 
	`quickli¡R–—£
(
ql
);

2507 
f
 = 
İtimize_¡¬t
; f < 40; f++) {

2508 
	`TEST_DESC
("Érime¡ C‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2509 
İtiÚs
[
_i
]) {

2510 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2511 
num
[32];

2512 
nums
[5000];

2513 
i
 = 0; i < 33; i++) {

2514 
nums
[
i
] = -5157318210846258176 + i;

2515 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2516 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2518 ià(
f
 == 32)

2519 
	`ql_v”ify
(
ql
, 2, 33, 32, 1);

2521 
	`quickli¡D–Rªge
(
ql
, 0, 3);

2522 
	`quickli¡D–Rªge
(
ql
, -29,

2524 ià(
f
 == 32)

2525 
	`ql_v”ify
(
ql
, 1, 1, 1, 1);

2526 
quickli¡EÁry
 
’Œy
;

2527 
	`quickli¡Index
(
ql
, 0, &
’Œy
);

2528 ià(
’Œy
.
lÚgv®
 != -5157318210846258173)

2529 
ERROR
;

2531 
OK
;

2532 
	`quickli¡R–—£
(
ql
);

2536 
f
 = 
İtimize_¡¬t
; f < 40; f++) {

2537 
	`TEST_DESC
("Érime¡ D‡ˆfÈ%d‡ˆcom´es %d", 
f
,

2538 
İtiÚs
[
_i
]) {

2539 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
İtiÚs
[
_i
]);

2540 
num
[32];

2541 
nums
[5000];

2542 
i
 = 0; i < 33; i++) {

2543 
nums
[
i
] = -5157318210846258176 + i;

2544 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2545 
	`quickli¡PushTa
(
ql
, 
num
, 
sz
);

2547 ià(
f
 == 32)

2548 
	`ql_v”ify
(
ql
, 2, 33, 32, 1);

2549 
	`quickli¡D–Rªge
(
ql
, -12, 3);

2550 ià(
ql
->
couÁ
 != 30)

2551 
	`ERR
("Didn't deleteƒxactlyhreeƒlements! Count is: %lu",

2552 
ql
->
couÁ
);

2553 
	`quickli¡R–—£
(
ql
);

2557 
f
 = 
İtimize_¡¬t
; f < 72; f++) {

2558 
	`TEST_DESC
("create quicklist from ziplist‡t fill %d‡t compress %d",

2559 
f
, 
İtiÚs
[
_i
]) {

2560 *
zl
 = 
	`zli¡New
();

2561 
nums
[64];

2562 
num
[64];

2563 
i
 = 0; i < 33; i++) {

2564 
nums
[
i
] = -5157318210846258176 + i;

2565 
sz
 = 
	`Î2¡ršg
(
num
, Òum), 
nums
[
i
]);

2566 
zl
 =

2567 
	`zli¡Push
(
zl
, (*)
num
, 
sz
, 
ZIPLIST_TAIL
);

2569 
i
 = 0; i < 33; i++) {

2570 
zl
 = 
	`zli¡Push
(zl, (*)
	`g’¡r
("h–lo", 
i
),

2571 32, 
ZIPLIST_TAIL
);

2573 
quickli¡
 *
ql
 = 
	`quickli¡C»©eFromZli¡
(
f
, 
İtiÚs
[
_i
], 
zl
);

2574 ià(
f
 == 1)

2575 
	`ql_v”ify
(
ql
, 66, 66, 1, 1);

2576 ià(
f
 == 32)

2577 
	`ql_v”ify
(
ql
, 3, 66, 32, 2);

2578 ià(
f
 == 66)

2579 
	`ql_v”ify
(
ql
, 1, 66, 66, 66);

2580 
	`quickli¡R–—£
(
ql
);

2584 
¡İ
 = 
	`m¡ime
();

2585 
ruÁime
[
_i
] = 
¡İ
 - 
¡¬t
;

2589 
li¡_sizes
[] = {250, 251, 500, 999, 1000};

2590 
¡¬t
 = 
	`m¡ime
();

2591 
li¡
 = 0;†i¡ < ()((
li¡_sizes
) / (*list_sizes));

2592 
li¡
++) {

2593 
f
 = 
İtimize_¡¬t
; f < 128; f++) {

2594 
d•th
 = 1; depth < 40; depth++) {

2596 
	`TEST_DESC
("verify specific compression of interior‚odes with "

2599 
li¡_sizes
[
li¡
], 
f
, 
d•th
) {

2600 
quickli¡
 *
ql
 = 
	`quickli¡New
(
f
, 
d•th
);

2601 
i
 = 0; i < 
li¡_sizes
[
li¡
]; i++) {

2602 
	`quickli¡PushTa
(
ql
, 
	`g’¡r
("h–lØTAIL", 
i
 + 1), 64);

2603 
	`quickli¡PushH—d
(
ql
, 
	`g’¡r
("h–lØHEAD", 
i
 + 1), 64);

2606 
quickli¡Node
 *
node
 = 
ql
->
h—d
;

2607 
low_¿w
 = 
ql
->
com´ess
;

2608 
high_¿w
 = 
ql
->
Ën
 - ql->
com´ess
;

2610 
©
 = 0;‡ˆ< 
ql
->
Ën
;

2611 
©
++, 
node
 =‚ode->
Ãxt
) {

2612 ià(
©
 < 
low_¿w
 ||‡ˆ>ğ
high_¿w
) {

2613 ià(
node
->
’codšg
 !ğ
QUICKLIST_NODE_ENCODING_RAW
) {

2614 
	`ERR
("Incorrect compression:‚ode %d is "

2617 
©
, 
d•th
, 
low_¿w
, 
high_¿w
, 
ql
->
Ën
,

2618 
node
->
sz
);

2621 ià(
node
->
’codšg
 !ğ
QUICKLIST_NODE_ENCODING_LZF
) {

2622 
	`ERR
("Incorrect‚on-compression:‚ode %d is NOT "

2625 
©
, 
d•th
, 
low_¿w
, 
high_¿w
, 
ql
->
Ën
,

2626 
node
->
sz
,‚ode->
©‹m±ed_com´ess
);

2630 
	`quickli¡R–—£
(
ql
);

2635 
¡İ
 = 
	`m¡ime
();

2637 
	`´štf
("\n");

2638 
size_t
 
i
 = 0; i < 
İtiÚ_couÁ
; i++)

2639 
	`´štf
("Te¡ Loİ %02d: %0.2à£cÚds.\n", 
İtiÚs
[
i
],

2640 ()
ruÁime
[
i
] / 1000);

2641 
	`´štf
("Com´essiÚs: %0.2à£cÚds.\n", ()(
¡İ
 - 
¡¬t
) / 1000);

2642 
	`´štf
("\n");

2644 ià(!
”r
)

2645 
	`´štf
("ALL TESTS PASSED!\n");

2647 
	`ERR
("SÜry,‚Ù‡Îe¡ ·s£d! IÀçù, %de¡ çed.", 
”r
);

2649  
”r
;

2650 
	}
}

	@quicklist.h

31 #iâdeà
__QUICKLIST_H__


32 
	#__QUICKLIST_H__


	)

44 
	squickli¡Node
 {

45 
quickli¡Node
 *
	m´ev
;

46 
quickli¡Node
 *
	mÃxt
;

47 *
	mzl
;

48 
	msz
;

49 
	mcouÁ
 : 16;

50 
	m’codšg
 : 2;

51 
	mcÚš”
 : 2;

52 
	m»com´ess
 : 1;

53 
	m©‹m±ed_com´ess
 : 1;

54 
	mexŒa
 : 10;

55 } 
	tquickli¡Node
;

62 
	squickli¡LZF
 {

63 
	msz
;

64 
	mcom´es£d
[];

65 } 
	tquickli¡LZF
;

73 
	squickli¡
 {

74 
quickli¡Node
 *
	mh—d
;

75 
quickli¡Node
 *
	m
;

76 
	mcouÁ
;

77 
	mËn
;

78 
	mfl
 : 16;

79 
	mcom´ess
 : 16;

80 } 
	tquickli¡
;

82 
	squickli¡I‹r
 {

83 cÚ¡ 
quickli¡
 *
	mquickli¡
;

84 
quickli¡Node
 *
	mcu¼’t
;

85 *
	mzi
;

86 
	moff£t
;

87 
	mdœeùiÚ
;

88 } 
	tquickli¡I‹r
;

90 
	squickli¡EÁry
 {

91 cÚ¡ 
quickli¡
 *
	mquickli¡
;

92 
quickli¡Node
 *
	mnode
;

93 *
	mzi
;

94 *
	mv®ue
;

95 
	mlÚgv®
;

96 
	msz
;

97 
	moff£t
;

98 } 
	tquickli¡EÁry
;

100 
	#QUICKLIST_HEAD
 0

	)

101 
	#QUICKLIST_TAIL
 -1

	)

104 
	#QUICKLIST_NODE_ENCODING_RAW
 1

	)

105 
	#QUICKLIST_NODE_ENCODING_LZF
 2

	)

108 
	#QUICKLIST_NOCOMPRESS
 0

	)

111 
	#QUICKLIST_NODE_CONTAINER_NONE
 1

	)

112 
	#QUICKLIST_NODE_CONTAINER_ZIPLIST
 2

	)

114 
	#quickli¡NodeIsCom´es£d
(
node
) \

115 ((
node
)->
’codšg
 =ğ
QUICKLIST_NODE_ENCODING_LZF
)

	)

118 
quickli¡
 *
quickli¡C»©e
();

119 
quickli¡
 *
quickli¡New
(
fl
, 
com´ess
);

120 
quickli¡S‘Com´essD•th
(
quickli¡
 *quickli¡, 
d•th
);

121 
quickli¡S‘Fl
(
quickli¡
 *quickli¡, 
fl
);

122 
quickli¡S‘O±iÚs
(
quickli¡
 *quickli¡, 
fl
, 
d•th
);

123 
quickli¡R–—£
(
quickli¡
 *quicklist);

124 
quickli¡PushH—d
(
quickli¡
 *quickli¡, *
v®ue
, cÚ¡ 
size_t
 
sz
);

125 
quickli¡PushTa
(
quickli¡
 *quickli¡, *
v®ue
, cÚ¡ 
size_t
 
sz
);

126 
quickli¡Push
(
quickli¡
 *quickli¡, *
v®ue
, cÚ¡ 
size_t
 
sz
,

127 
wh”e
);

128 
quickli¡Aµ’dZli¡
(
quickli¡
 *quickli¡, *
zl
);

129 
quickli¡
 *
quickli¡Aµ’dV®uesFromZli¡
(quicklist *quicklist,

130 *
zl
);

131 
quickli¡
 *
quickli¡C»©eFromZli¡
(
fl
, 
com´ess
,

132 *
zl
);

133 
quickli¡In£¹Aá”
(
quickli¡
 *quickli¡, 
quickli¡EÁry
 *
node
,

134 *
v®ue
, cÚ¡ 
size_t
 
sz
);

135 
quickli¡In£¹BefÜe
(
quickli¡
 *quickli¡, 
quickli¡EÁry
 *
node
,

136 *
v®ue
, cÚ¡ 
size_t
 
sz
);

137 
quickli¡D–EÁry
(
quickli¡I‹r
 *
™”
, 
quickli¡EÁry
 *
’Œy
);

138 
quickli¡R•ÏûAtIndex
(
quickli¡
 *quickli¡, 
šdex
, *
d©a
,

139 
sz
);

140 
quickli¡D–Rªge
(
quickli¡
 *quickli¡, cÚ¡ 
¡¬t
, cÚ¡ 
¡İ
);

141 
quickli¡I‹r
 *
quickli¡G‘I‹¿tÜ
(cÚ¡ 
quickli¡
 *quickli¡, 
dœeùiÚ
);

142 
quickli¡I‹r
 *
quickli¡G‘I‹¿tÜAtIdx
(cÚ¡ 
quickli¡
 *quicklist,

143 
dœeùiÚ
, cÚ¡ 
idx
);

144 
quickli¡Next
(
quickli¡I‹r
 *
™”
, 
quickli¡EÁry
 *
node
);

145 
quickli¡R–—£I‹¿tÜ
(
quickli¡I‹r
 *
™”
);

146 
quickli¡
 *
quickli¡Dup
(quickli¡ *
Üig
);

147 
quickli¡Index
(cÚ¡ 
quickli¡
 *quickli¡, cÚ¡ 
šdex
,

148 
quickli¡EÁry
 *
’Œy
);

149 
quickli¡Rewšd
(
quickli¡
 *quickli¡, 
quickli¡I‹r
 *
li
);

150 
quickli¡RewšdTa
(
quickli¡
 *quickli¡, 
quickli¡I‹r
 *
li
);

151 
quickli¡RÙ©e
(
quickli¡
 *quicklist);

152 
quickli¡PİCu¡om
(
quickli¡
 *quickli¡, 
wh”e
, **
d©a
,

153 *
sz
, *
sv®
,

154 *(*
§v”
)(*
d©a
, 
sz
));

155 
quickli¡Pİ
(
quickli¡
 *quickli¡, 
wh”e
, **
d©a
,

156 *
sz
, *
¦Úg
);

157 
quickli¡CouÁ
(cÚ¡ 
quickli¡
 *
ql
);

158 
quickli¡Com·»
(*
p1
, *
p2
, 
p2_Ën
);

159 
size_t
 
quickli¡G‘Lzf
(cÚ¡ 
quickli¡Node
 *
node
, **
d©a
);

161 #ifdeà
REDIS_TEST


162 
quickli¡Te¡
(
¬gc
, *
¬gv
[]);

166 
	#AL_START_HEAD
 0

	)

167 
	#AL_START_TAIL
 1

	)

	@rand.c

44 
	~<¡dšt.h
>

46 
	#N
 16

	)

47 
	#MASK
 ((1 << (
N
 - 1)è+ (1 << (N - 1)è- 1)

	)

48 
	#LOW
(
x
è(()(xè& 
MASK
)

	)

49 
	#HIGH
(
x
è
	`LOW
((xè>> 
N
)

	)

50 
	#MUL
(
x
, 
y
, 
z
è{ 
št32_t
 
l
 = ()(x) * ()(y); \

51 (
z
)[0] = 
	`LOW
(
l
); (z)[1] = 
	`HIGH
Ö); }

	)

52 
	#CARRY
(
x
, 
y
è((
št32_t
)(xè+ ()(yè> 
MASK
)

	)

53 
	#ADDEQU
(
x
, 
y
, 
z
è(z = 
	`CARRY
(x, (y)), x = 
	`LOW
(x + (y)))

	)

54 
	#X0
 0x330E

	)

55 
	#X1
 0xABCD

	)

56 
	#X2
 0x1234

	)

57 
	#A0
 0xE66D

	)

58 
	#A1
 0xDEEC

	)

59 
	#A2
 0x5

	)

60 
	#C
 0xB

	)

61 
	#SET3
(
x
, 
x0
, 
x1
, 
x2
è((x)[0] = (x0), (x)[1] = (x1), (x)[2] = (x2))

	)

62 
	#SETLOW
(
x
, 
y
, 
n
è
	`SET3
(x, 
	`LOW
((y)[n]), LOW((y)[Ò)+1]), LOW((y)[Ò)+2]))

	)

63 
	#SEED
(
x0
, 
x1
, 
x2
è(
	`SET3
(
x
, x0, x1, x2), SET3(
a
, 
A0
, 
A1
, 
A2
), 
c
 = 
C
)

	)

64 
	#REST
(
v
è
i
 = 0; i < 3; i++è{ 
xsubi
[i] = 
x
[i]; x[i] = 
‹mp
[i]; } \

65  (
v
);

	)

66 
	#HI_BIT
 (1L << (2 * 
N
 - 1))

	)

68 
ušt32_t
 
	gx
[3] = { 
X0
, 
X1
, 
X2
 }, 
	ga
[3] = { 
A0
, 
A1
, 
A2
 }, 
	gc
 = 
C
;

69 
Ãxt
();

71 
št32_t
 
	$»disL¿nd48
() {

72 
	`Ãxt
();

73  (((
št32_t
)
x
[2] << (
N
 - 1)) + (x[1] >> 1));

74 
	}
}

76 
	$»disS¿nd48
(
št32_t
 
£edv®
) {

77 
	`SEED
(
X0
, 
	`LOW
(
£edv®
), 
	`HIGH
(seedval));

78 
	}
}

80 
	$Ãxt
() {

81 
ušt32_t
 
p
[2], 
q
[2], 
r
[2], 
ÿ¼y0
, 
ÿ¼y1
;

83 
	`MUL
(
a
[0], 
x
[0], 
p
);

84 
	`ADDEQU
(
p
[0], 
c
, 
ÿ¼y0
);

85 
	`ADDEQU
(
p
[1], 
ÿ¼y0
, 
ÿ¼y1
);

86 
	`MUL
(
a
[0], 
x
[1], 
q
);

87 
	`ADDEQU
(
p
[1], 
q
[0], 
ÿ¼y0
);

88 
	`MUL
(
a
[1], 
x
[0], 
r
);

89 
x
[2] = 
	`LOW
(
ÿ¼y0
 + 
ÿ¼y1
 + 
	`CARRY
(
p
[1], 
r
[0]è+ 
q
[1] +„[1] +

90 
a
[0] * 
x
[2] +‡[1] * x[1] +‡[2] * x[0]);

91 
x
[1] = 
	`LOW
(
p
[1] + 
r
[0]);

92 
x
[0] = 
	`LOW
(
p
[0]);

93 
	}
}

	@rand.h

30 #iâdeà
REDIS_RANDOM_H


31 
	#REDIS_RANDOM_H


	)

33 
št32_t
 
»disL¿nd48
();

34 
»disS¿nd48
(
št32_t
 
£edv®
);

36 
	#REDIS_LRAND48_MAX
 
INT32_MAX


	)

	@rdb.c

30 
	~"£rv”.h
"

31 
	~"lzf.h
"

32 
	~"zm­.h
"

33 
	~"’dŸncÚv.h
"

35 
	~<m©h.h
>

36 
	~<sys/ty³s.h
>

37 
	~<sys/time.h
>

38 
	~<sys/»sourû.h
>

39 
	~<sys/wa™.h
>

40 
	~<¬·/š‘.h
>

41 
	~<sys/¡©.h
>

42 
	~<sys/·¿m.h
>

44 
¥¬£InU£
;

46 
	#rdbEx™R•ÜtCÜru±RDB
(...è
	`rdbCheckTh’Ex™
(
__LINE__
,
__VA_ARGS__
)

	)

48 
rdbCheckMode
;

49 
rdbCheckE¼Ü
(cÚ¡ *
fmt
, ...);

50 
rdbCheckS‘E¼Ü
(cÚ¡ *
fmt
, ...);

52 
	$rdbCheckTh’Ex™
(
lš’um
, *
»asÚ
, ...) {

53 
va_li¡
 
­
;

54 
msg
[1024];

55 
Ën
;

57 
Ën
 = 
	`¢´štf
(
msg
,(msg),

58 "IÁ”ÇÈ”rÜ iÀRDB„—dšg funùiÚ‡ˆrdb.c:%d -> ", 
lš’um
);

59 
	`va_¡¬t
(
­
,
»asÚ
);

60 
	`v¢´štf
(
msg
+
Ën
,(msg)-Ën,
»asÚ
,
­
);

61 
	`va_’d
(
­
);

63 ià(!
rdbCheckMode
) {

64 
	`£rv”Log
(
LL_WARNING
, "%s", 
msg
);

65 *
¬gv
[2] = {"",
£rv”
.
rdb_f’ame
};

66 
	`»dis_check_rdb_maš
(2,
¬gv
);

68 
	`rdbCheckE¼Ü
("%s",
msg
);

70 
	`ex™
(1);

71 
	}
}

73 
	$rdbWr™eRaw
(
rio
 *
rdb
, *
p
, 
size_t
 
Ën
) {

74 ià(
rdb
 && 
	`rioWr™e
Ôdb,
p
,
Ën
) == 0)

76  
Ën
;

77 
	}
}

79 
	$rdbSaveTy³
(
rio
 *
rdb
, 
ty³
) {

80  
	`rdbWr™eRaw
(
rdb
,&
ty³
,1);

81 
	}
}

86 
	$rdbLßdTy³
(
rio
 *
rdb
) {

87 
ty³
;

88 ià(
	`rioR—d
(
rdb
,&
ty³
,1) == 0)  -1;

89  
ty³
;

90 
	}
}

92 
time_t
 
	$rdbLßdTime
(
rio
 *
rdb
) {

93 
št32_t
 
t32
;

94 ià(
	`rioR—d
(
rdb
,&
t32
,4) == 0)  -1;

95  (
time_t
)
t32
;

96 
	}
}

98 
	$rdbSaveMli£cÚdTime
(
rio
 *
rdb
, 
t
) {

99 
št64_t
 
t64
 = (št64_tè
t
;

100  
	`rdbWr™eRaw
(
rdb
,&
t64
,8);

101 
	}
}

103 
	$rdbLßdMli£cÚdTime
(
rio
 *
rdb
) {

104 
št64_t
 
t64
;

105 ià(
	`rioR—d
(
rdb
,&
t64
,8) == 0)  -1;

106  ()
t64
;

107 
	}
}

112 
	$rdbSaveL’
(
rio
 *
rdb
, 
ušt64_t
 
Ën
) {

113 
buf
[2];

114 
size_t
 
nwr™‹n
;

116 ià(
Ën
 < (1<<6)) {

118 
buf
[0] = (
Ën
&0xFF)|(
RDB_6BITLEN
<<6);

119 ià(
	`rdbWr™eRaw
(
rdb
,
buf
,1) == -1)  -1;

120 
nwr™‹n
 = 1;

121 } ià(
Ën
 < (1<<14)) {

123 
buf
[0] = ((
Ën
>>8)&0xFF)|(
RDB_14BITLEN
<<6);

124 
buf
[1] = 
Ën
&0xFF;

125 ià(
	`rdbWr™eRaw
(
rdb
,
buf
,2) == -1)  -1;

126 
nwr™‹n
 = 2;

127 } ià(
Ën
 <ğ
UINT32_MAX
) {

129 
buf
[0] = 
RDB_32BITLEN
;

130 ià(
	`rdbWr™eRaw
(
rdb
,
buf
,1) == -1)  -1;

131 
ušt32_t
 
Ën32
 = 
	`htÚl
(
Ën
);

132 ià(
	`rdbWr™eRaw
(
rdb
,&
Ën32
,4) == -1)  -1;

133 
nwr™‹n
 = 1+4;

136 
buf
[0] = 
RDB_64BITLEN
;

137 ià(
	`rdbWr™eRaw
(
rdb
,
buf
,1) == -1)  -1;

138 
Ën
 = 
	`htÚu64
(len);

139 ià(
	`rdbWr™eRaw
(
rdb
,&
Ën
,8) == -1)  -1;

140 
nwr™‹n
 = 1+8;

142  
nwr™‹n
;

143 
	}
}

155 
	$rdbLßdL’ByRef
(
rio
 *
rdb
, *
i£ncoded
, 
ušt64_t
 *
ËÅŒ
) {

156 
buf
[2];

157 
ty³
;

159 ià(
i£ncoded
) *isencoded = 0;

160 ià(
	`rioR—d
(
rdb
,
buf
,1) == 0)  -1;

161 
ty³
 = (
buf
[0]&0xC0)>>6;

162 ià(
ty³
 =ğ
RDB_ENCVAL
) {

164 ià(
i£ncoded
) *isencoded = 1;

165 *
ËÅŒ
 = 
buf
[0]&0x3F;

166 } ià(
ty³
 =ğ
RDB_6BITLEN
) {

168 *
ËÅŒ
 = 
buf
[0]&0x3F;

169 } ià(
ty³
 =ğ
RDB_14BITLEN
) {

171 ià(
	`rioR—d
(
rdb
,
buf
+1,1) == 0)  -1;

172 *
ËÅŒ
 = ((
buf
[0]&0x3F)<<8)|buf[1];

173 } ià(
buf
[0] =ğ
RDB_32BITLEN
) {

175 
ušt32_t
 
Ën
;

176 ià(
	`rioR—d
(
rdb
,&
Ën
,4) == 0)  -1;

177 *
ËÅŒ
 = 
	`Áohl
(
Ën
);

178 } ià(
buf
[0] =ğ
RDB_64BITLEN
) {

180 
ušt64_t
 
Ën
;

181 ià(
	`rioR—d
(
rdb
,&
Ën
,8) == 0)  -1;

182 *
ËÅŒ
 = 
	`Áohu64
(
Ën
);

184 
	`rdbEx™R•ÜtCÜru±RDB
(

185 "UnknowÀËngthƒncodšg %d iÀrdbLßdL’()",
ty³
);

189 
	}
}

195 
ušt64_t
 
	$rdbLßdL’
(
rio
 *
rdb
, *
i£ncoded
) {

196 
ušt64_t
 
Ën
;

198 ià(
	`rdbLßdL’ByRef
(
rdb
,
i£ncoded
,&
Ën
è=ğ-1è 
RDB_LENERR
;

199  
Ën
;

200 
	}
}

206 
	$rdbEncodeIÁeg”
(
v®ue
, *
’c
) {

207 ià(
v®ue
 >= -(1<<7) && value <= (1<<7)-1) {

208 
’c
[0] = (
RDB_ENCVAL
<<6)|
RDB_ENC_INT8
;

209 
’c
[1] = 
v®ue
&0xFF;

211 } ià(
v®ue
 >= -(1<<15) && value <= (1<<15)-1) {

212 
’c
[0] = (
RDB_ENCVAL
<<6)|
RDB_ENC_INT16
;

213 
’c
[1] = 
v®ue
&0xFF;

214 
’c
[2] = (
v®ue
>>8)&0xFF;

216 } ià(
v®ue
 >= -(()1<<31) && value <= (()1<<31)-1) {

217 
’c
[0] = (
RDB_ENCVAL
<<6)|
RDB_ENC_INT32
;

218 
’c
[1] = 
v®ue
&0xFF;

219 
’c
[2] = (
v®ue
>>8)&0xFF;

220 
’c
[3] = (
v®ue
>>16)&0xFF;

221 
’c
[4] = (
v®ue
>>24)&0xFF;

226 
	}
}

231 *
	$rdbLßdIÁeg”Objeù
(
rio
 *
rdb
, 
’ùy³
, 
æags
, 
size_t
 *
ËÅŒ
) {

232 
¶aš
 = 
æags
 & 
RDB_LOAD_PLAIN
;

233 
sds
 = 
æags
 & 
RDB_LOAD_SDS
;

234 
’code
 = 
æags
 & 
RDB_LOAD_ENC
;

235 
’c
[4];

236 
v®
;

238 ià(
’ùy³
 =ğ
RDB_ENC_INT8
) {

239 ià(
	`rioR—d
(
rdb
,
’c
,1è=ğ0è 
NULL
;

240 
v®
 = (sigÃd )
’c
[0];

241 } ià(
’ùy³
 =ğ
RDB_ENC_INT16
) {

242 
ušt16_t
 
v
;

243 ià(
	`rioR—d
(
rdb
,
’c
,2è=ğ0è 
NULL
;

244 
v
 = 
’c
[0]|(enc[1]<<8);

245 
v®
 = (
št16_t
)
v
;

246 } ià(
’ùy³
 =ğ
RDB_ENC_INT32
) {

247 
ušt32_t
 
v
;

248 ià(
	`rioR—d
(
rdb
,
’c
,4è=ğ0è 
NULL
;

249 
v
 = 
’c
[0]|(enc[1]<<8)|(enc[2]<<16)|(enc[3]<<24);

250 
v®
 = (
št32_t
)
v
;

252 
v®
 = 0;

253 
	`rdbEx™R•ÜtCÜru±RDB
("UnknowÀRDB iÁeg”ƒncodšgy³ %d",
’ùy³
);

255 ià(
¶aš
 || 
sds
) {

256 
buf
[
LONG_STR_SIZE
], *
p
;

257 
Ën
 = 
	`Î2¡ršg
(
buf
,(buf),
v®
);

258 ià(
ËÅŒ
è*ËÅŒ = 
Ën
;

259 
p
 = 
¶aš
 ? 
	`zm®loc
(
Ën
è: 
	`sd¢ewËn
(
NULL
,len);

260 
	`memıy
(
p
,
buf
,
Ën
);

261  
p
;

262 } ià(
’code
) {

263  
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
v®
);

265  
	`ü—‹Objeù
(
OBJ_STRING
,
	`sdsäomlÚglÚg
(
v®
));

267 
	}
}

272 
	$rdbTryIÁeg”Encodšg
(*
s
, 
size_t
 
Ën
, *
’c
) {

273 
v®ue
;

274 *
’d±r
, 
buf
[32];

277 
v®ue
 = 
	`¡¹Şl
(
s
, &
’d±r
, 10);

278 ià(
’d±r
[0] != '\0')  0;

279 
	`Î2¡ršg
(
buf
,32,
v®ue
);

283 ià(
	`¡¾’
(
buf
è!ğ
Ën
 || 
	`memcmp
(buf,
s
,len))  0;

285  
	`rdbEncodeIÁeg”
(
v®ue
,
’c
);

286 
	}
}

288 
ssize_t
 
	$rdbSaveLzfBlob
(
rio
 *
rdb
, *
d©a
, 
size_t
 
com´ess_Ën
,

289 
size_t
 
Üigš®_Ën
) {

290 
by‹
;

291 
ssize_t
 
n
, 
nwr™‹n
 = 0;

294 
by‹
 = (
RDB_ENCVAL
<<6)|
RDB_ENC_LZF
;

295 ià((
n
 = 
	`rdbWr™eRaw
(
rdb
,&
by‹
,1)è=ğ-1è
wr™“¼
;

296 
nwr™‹n
 +ğ
n
;

298 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
com´ess_Ën
)è=ğ-1è
wr™“¼
;

299 
nwr™‹n
 +ğ
n
;

301 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
Üigš®_Ën
)è=ğ-1è
wr™“¼
;

302 
nwr™‹n
 +ğ
n
;

304 ià((
n
 = 
	`rdbWr™eRaw
(
rdb
,
d©a
,
com´ess_Ën
)è=ğ-1è
wr™“¼
;

305 
nwr™‹n
 +ğ
n
;

307  
nwr™‹n
;

309 
wr™“¼
:

311 
	}
}

313 
ssize_t
 
	$rdbSaveLzfSŒšgObjeù
(
rio
 *
rdb
, *
s
, 
size_t
 
Ën
) {

314 
size_t
 
com´Ën
, 
ou’
;

315 *
out
;

318 ià(
Ën
 <= 4)  0;

319 
ou’
 = 
Ën
-4;

320 ià((
out
 = 
	`zm®loc
(
ou’
+1)è=ğ
NULL
)  0;

321 
com´Ën
 = 
	`lzf_com´ess
(
s
, 
Ën
, 
out
, 
ou’
);

322 ià(
com´Ën
 == 0) {

323 
	`zä“
(
out
);

326 
ssize_t
 
nwr™‹n
 = 
	`rdbSaveLzfBlob
(
rdb
, 
out
, 
com´Ën
, 
Ën
);

327 
	`zä“
(
out
);

328  
nwr™‹n
;

329 
	}
}

334 *
	$rdbLßdLzfSŒšgObjeù
(
rio
 *
rdb
, 
æags
, 
size_t
 *
ËÅŒ
) {

335 
¶aš
 = 
æags
 & 
RDB_LOAD_PLAIN
;

336 
sds
 = 
æags
 & 
RDB_LOAD_SDS
;

337 
ušt64_t
 
Ën
, 
ş’
;

338 *
c
 = 
NULL
;

339 *
v®
 = 
NULL
;

341 ià((
ş’
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

342 ià((
Ën
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

343 ià((
c
 = 
	`zm®loc
(
ş’
)è=ğ
NULL
è
”r
;

346 ià(
¶aš
) {

347 
v®
 = 
	`zm®loc
(
Ën
);

348 ià(
ËÅŒ
è*ËÅŒ = 
Ën
;

350 
v®
 = 
	`sd¢ewËn
(
NULL
,
Ën
);

354 ià(
	`rioR—d
(
rdb
,
c
,
ş’
è=ğ0è
”r
;

355 ià(
	`lzf_decom´ess
(
c
,
ş’
,
v®
,
Ën
) == 0) {

356 ià(
rdbCheckMode
è
	`rdbCheckS‘E¼Ü
("Invalid LZF compressed string");

357 
”r
;

359 
	`zä“
(
c
);

361 ià(
¶aš
 || 
sds
) {

362  
v®
;

364  
	`ü—‹Objeù
(
OBJ_STRING
,
v®
);

366 
”r
:

367 
	`zä“
(
c
);

368 ià(
¶aš
)

369 
	`zä“
(
v®
);

371 
	`sdsä“
(
v®
);

372  
NULL
;

373 
	}
}

377 
ssize_t
 
	$rdbSaveRawSŒšg
(
rio
 *
rdb
, *
s
, 
size_t
 
Ën
) {

378 
’ş’
;

379 
ssize_t
 
n
, 
nwr™‹n
 = 0;

382 ià(
Ën
 <= 11) {

383 
buf
[5];

384 ià((
’ş’
 = 
	`rdbTryIÁeg”Encodšg
((*)
s
,
Ën
,
buf
)) > 0) {

385 ià(
	`rdbWr™eRaw
(
rdb
,
buf
,
’ş’
) == -1)  -1;

386  
’ş’
;

392 ià(
£rv”
.
rdb_com´essiÚ
 && 
Ën
 > 20) {

393 
n
 = 
	`rdbSaveLzfSŒšgObjeù
(
rdb
,
s
,
Ën
);

394 ià(
n
 == -1)  -1;

395 ià(
n
 > 0) ‚;

400 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
Ën
)) == -1)  -1;

401 
nwr™‹n
 +ğ
n
;

402 ià(
Ën
 > 0) {

403 ià(
	`rdbWr™eRaw
(
rdb
,
s
,
Ën
) == -1)  -1;

404 
nwr™‹n
 +ğ
Ën
;

406  
nwr™‹n
;

407 
	}
}

410 
ssize_t
 
	$rdbSaveLÚgLÚgAsSŒšgObjeù
(
rio
 *
rdb
, 
v®ue
) {

411 
buf
[32];

412 
ssize_t
 
n
, 
nwr™‹n
 = 0;

413 
’ş’
 = 
	`rdbEncodeIÁeg”
(
v®ue
,
buf
);

414 ià(
’ş’
 > 0) {

415  
	`rdbWr™eRaw
(
rdb
,
buf
,
’ş’
);

418 
’ş’
 = 
	`Î2¡ršg
((*)
buf
,32,
v®ue
);

419 
	`£rv”As£¹
(
’ş’
 < 32);

420 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
’ş’
)) == -1)  -1;

421 
nwr™‹n
 +ğ
n
;

422 ià((
n
 = 
	`rdbWr™eRaw
(
rdb
,
buf
,
’ş’
)) == -1)  -1;

423 
nwr™‹n
 +ğ
n
;

425  
nwr™‹n
;

426 
	}
}

429 
	$rdbSaveSŒšgObjeù
(
rio
 *
rdb
, 
robj
 *
obj
) {

432 ià(
obj
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

433  
	`rdbSaveLÚgLÚgAsSŒšgObjeù
(
rdb
,()
obj
->
±r
);

435 
	`£rv”As£¹W™hInfo
(
NULL
,
obj
,
	`sdsEncodedObjeù
(obj));

436  
	`rdbSaveRawSŒšg
(
rdb
,
obj
->
±r
,
	`sd¦’
(obj->ptr));

438 
	}
}

453 *
	$rdbG’”icLßdSŒšgObjeù
(
rio
 *
rdb
, 
æags
, 
size_t
 *
ËÅŒ
) {

454 
’code
 = 
æags
 & 
RDB_LOAD_ENC
;

455 
¶aš
 = 
æags
 & 
RDB_LOAD_PLAIN
;

456 
sds
 = 
æags
 & 
RDB_LOAD_SDS
;

457 
i£ncoded
;

458 
ušt64_t
 
Ën
;

460 
Ën
 = 
	`rdbLßdL’
(
rdb
,&
i£ncoded
);

461 ià(
i£ncoded
) {

462 
Ën
) {

463 
RDB_ENC_INT8
:

464 
RDB_ENC_INT16
:

465 
RDB_ENC_INT32
:

466  
	`rdbLßdIÁeg”Objeù
(
rdb
,
Ën
,
æags
,
ËÅŒ
);

467 
RDB_ENC_LZF
:

468  
	`rdbLßdLzfSŒšgObjeù
(
rdb
,
æags
,
ËÅŒ
);

470 
	`rdbEx™R•ÜtCÜru±RDB
("UnknowÀRDB sŒšgƒncodšgy³ %d",
Ën
);

474 ià(
Ën
 =ğ
RDB_LENERR
è 
NULL
;

475 ià(
¶aš
 || 
sds
) {

476 *
buf
 = 
¶aš
 ? 
	`zm®loc
(
Ën
è: 
	`sd¢ewËn
(
NULL
,len);

477 ià(
ËÅŒ
è*ËÅŒ = 
Ën
;

478 ià(
Ën
 && 
	`rioR—d
(
rdb
,
buf
,len) == 0) {

479 ià(
¶aš
)

480 
	`zä“
(
buf
);

482 
	`sdsä“
(
buf
);

483  
NULL
;

485  
buf
;

487 
robj
 *
o
 = 
’code
 ? 
	`ü—‹SŒšgObjeù
(
NULL
,
Ën
) :

488 
	`ü—‹RawSŒšgObjeù
(
NULL
,
Ën
);

489 ià(
Ën
 && 
	`rioR—d
(
rdb
,
o
->
±r
,len) == 0) {

490 
	`deüRefCouÁ
(
o
);

491  
NULL
;

493  
o
;

495 
	}
}

497 
robj
 *
	$rdbLßdSŒšgObjeù
(
rio
 *
rdb
) {

498  
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_NONE
,
NULL
);

499 
	}
}

501 
robj
 *
	$rdbLßdEncodedSŒšgObjeù
(
rio
 *
rdb
) {

502  
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_ENC
,
NULL
);

503 
	}
}

513 
	$rdbSaveDoubËV®ue
(
rio
 *
rdb
, 
v®
) {

514 
buf
[128];

515 
Ën
;

517 ià(
	`i¢ª
(
v®
)) {

518 
buf
[0] = 253;

519 
Ën
 = 1;

520 } ià(!
	`isfš™e
(
v®
)) {

521 
Ën
 = 1;

522 
buf
[0] = (
v®
 < 0) ? 255 : 254;

524 #ià(
DBL_MANT_DIG
 >ğ52è&& (
LLONG_MAX
 == 0x7fffffffffffffffLL)

534 
mš
 = -4503599627370495;

535 
max
 = 4503599627370496;

536 ià(
v®
 > 
mš
 && v® < 
max
 && val == (()(()val)))

537 
	`Î2¡ršg
((*)
buf
+1,(buf)-1,()
v®
);

540 
	`¢´štf
((*)
buf
+1,(buf)-1,"%.17g",
v®
);

541 
buf
[0] = 
	`¡¾’
((*)buf+1);

542 
Ën
 = 
buf
[0]+1;

544  
	`rdbWr™eRaw
(
rdb
,
buf
,
Ën
);

545 
	}
}

548 
	$rdbLßdDoubËV®ue
(
rio
 *
rdb
, *
v®
) {

549 
buf
[256];

550 
Ën
;

552 ià(
	`rioR—d
(
rdb
,&
Ën
,1) == 0)  -1;

553 
Ën
) {

554 255: *
v®
 = 
R_NegInf
;  0;

555 254: *
v®
 = 
R_PosInf
;  0;

556 253: *
v®
 = 
R_Nª
;  0;

558 ià(
	`rioR—d
(
rdb
,
buf
,
Ën
) == 0)  -1;

559 
buf
[
Ën
] = '\0';

560 
	`ssÿnf
(
buf
, "%lg", 
v®
);

563 
	}
}

570 
	$rdbSaveBš¬yDoubËV®ue
(
rio
 *
rdb
, 
v®
) {

571 
	`mem»v64ifbe
(&
v®
);

572  
	`rdbWr™eRaw
(
rdb
,&
v®
,(val));

573 
	}
}

577 
	$rdbLßdBš¬yDoubËV®ue
(
rio
 *
rdb
, *
v®
) {

578 ià(
	`rioR—d
(
rdb
,
v®
,(*val)) == 0)  -1;

579 
	`mem»v64ifbe
(
v®
);

581 
	}
}

584 
	$rdbSaveBš¬yFlßtV®ue
(
rio
 *
rdb
, 
v®
) {

585 
	`mem»v32ifbe
(&
v®
);

586  
	`rdbWr™eRaw
(
rdb
,&
v®
,(val));

587 
	}
}

590 
	$rdbLßdBš¬yFlßtV®ue
(
rio
 *
rdb
, *
v®
) {

591 ià(
	`rioR—d
(
rdb
,
v®
,(*val)) == 0)  -1;

592 
	`mem»v32ifbe
(
v®
);

594 
	}
}

597 
	$rdbSaveObjeùTy³
(
rio
 *
rdb
, 
robj
 *
o
) {

598 
o
->
ty³
) {

599 
OBJ_STRING
:

600  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_STRING
);

601 
OBJ_LIST
:

602 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
)

603  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_LIST_QUICKLIST
);

605 
	`£rv”Pªic
("Unknown†istƒncoding");

606 
OBJ_SET
:

607 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
)

608  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_SET_INTSET
);

609 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
)

610  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_SET
);

612 
	`£rv”Pªic
("Unknown setƒncoding");

613 
OBJ_ZSET
:

614 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
)

615  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_ZSET_ZIPLIST
);

616 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
)

617  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_ZSET_2
);

619 
	`£rv”Pªic
("Unknown sorted setƒncoding");

620 
OBJ_HASH
:

621 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
)

622  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_HASH_ZIPLIST
);

623 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
)

624  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_HASH
);

625 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SPM
) {

626 
	`ä“HashObjeù
(
o
);

630 
	`£rv”Pªic
("Unknown hashƒncoding");

631 
OBJ_MODULE
:

632  
	`rdbSaveTy³
(
rdb
,
RDB_TYPE_MODULE
);

634 
	`£rv”Pªic
("Unknown objectype");

637 
	}
}

641 
	$rdbLßdObjeùTy³
(
rio
 *
rdb
) {

642 
ty³
;

643 ià((
ty³
 = 
	`rdbLßdTy³
(
rdb
)) == -1)  -1;

644 ià(!
	`rdbIsObjeùTy³
(
ty³
))  -1;

645  
ty³
;

646 
	}
}

649 
ssize_t
 
	$rdbSaveObjeù
(
rio
 *
rdb
, 
robj
 *
o
) {

650 
ssize_t
 
n
 = 0, 
nwr™‹n
 = 0;

652 ià(
o
->
ty³
 =ğ
OBJ_STRING
) {

654 ià((
n
 = 
	`rdbSaveSŒšgObjeù
(
rdb
,
o
)) == -1)  -1;

655 
nwr™‹n
 +ğ
n
;

656 } ià(
o
->
ty³
 =ğ
OBJ_LIST
) {

658 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

659 
quickli¡
 *
ql
 = 
o
->
±r
;

660 
quickli¡Node
 *
node
 = 
ql
->
h—d
;

662 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
ql
->
Ën
)) == -1)  -1;

663 
nwr™‹n
 +ğ
n
;

666 ià(
	`quickli¡NodeIsCom´es£d
(
node
)) {

667 *
d©a
;

668 
size_t
 
com´ess_Ën
 = 
	`quickli¡G‘Lzf
(
node
, &
d©a
);

669 ià((
n
 = 
	`rdbSaveLzfBlob
(
rdb
,
d©a
,
com´ess_Ën
,
node
->
sz
)) == -1)  -1;

670 
nwr™‹n
 +ğ
n
;

672 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,
node
->
zl
,node->
sz
)) == -1)  -1;

673 
nwr™‹n
 +ğ
n
;

675 } (
node
 =‚ode->
Ãxt
));

677 
	`£rv”Pªic
("Unknown†istƒncoding");

679 } ià(
o
->
ty³
 =ğ
OBJ_SET
) {

681 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

682 
diù
 *
£t
 = 
o
->
±r
;

683 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
£t
);

684 
diùEÁry
 *
de
;

686 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
	`diùSize
(
£t
))) == -1)  -1;

687 
nwr™‹n
 +ğ
n
;

689 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

690 
sds
 
–e
 = 
	`diùG‘Key
(
de
);

691 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,(*)
–e
,
	`sd¦’
(ele)))

693 
nwr™‹n
 +ğ
n
;

695 
	`diùR–—£I‹¿tÜ
(
di
);

696 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

697 
size_t
 
l
 = 
	`št£tBlobL’
((
št£t
*)
o
->
±r
);

699 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,
o
->
±r
,
l
)) == -1)  -1;

700 
nwr™‹n
 +ğ
n
;

702 
	`£rv”Pªic
("Unknown setƒncoding");

704 } ià(
o
->
ty³
 =ğ
OBJ_ZSET
) {

706 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

707 
size_t
 
l
 = 
	`zli¡BlobL’
((*)
o
->
±r
);

709 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,
o
->
±r
,
l
)) == -1)  -1;

710 
nwr™‹n
 +ğ
n
;

711 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

712 
z£t
 *
zs
 = 
o
->
±r
;

713 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
zs
->
diù
);

714 
diùEÁry
 *
de
;

716 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
	`diùSize
(
zs
->
diù
))) == -1)  -1;

717 
nwr™‹n
 +ğ
n
;

719 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

720 
sds
 
–e
 = 
	`diùG‘Key
(
de
);

721 *
scÜe
 = 
	`diùG‘V®
(
de
);

723 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,(*)
–e
,
	`sd¦’
(ele)))

725 
nwr™‹n
 +ğ
n
;

726 ià((
n
 = 
	`rdbSaveBš¬yDoubËV®ue
(
rdb
,*
scÜe
)) == -1)  -1;

727 
nwr™‹n
 +ğ
n
;

729 
	`diùR–—£I‹¿tÜ
(
di
);

731 
	`£rv”Pªic
("Unknown sorted setƒncoding");

733 } ià(
o
->
ty³
 =ğ
OBJ_HASH
) {

735 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

736 
size_t
 
l
 = 
	`zli¡BlobL’
((*)
o
->
±r
);

738 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,
o
->
±r
,
l
)) == -1)  -1;

739 
nwr™‹n
 +ğ
n
;

741 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

742 
diùI‹¿tÜ
 *
di
 = 
	`diùG‘I‹¿tÜ
(
o
->
±r
);

743 
diùEÁry
 *
de
;

745 ià((
n
 = 
	`rdbSaveL’
(
rdb
,
	`diùSize
((
diù
*)
o
->
±r
))) == -1)  -1;

746 
nwr™‹n
 +ğ
n
;

748 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

749 
sds
 
f›ld
 = 
	`diùG‘Key
(
de
);

750 
sds
 
v®ue
 = 
	`diùG‘V®
(
de
);

752 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,(*)
f›ld
,

753 
	`sd¦’
(
f›ld
))) == -1)  -1;

754 
nwr™‹n
 +ğ
n
;

755 ià((
n
 = 
	`rdbSaveRawSŒšg
(
rdb
,(*)
v®ue
,

756 
	`sd¦’
(
v®ue
))) == -1)  -1;

757 
nwr™‹n
 +ğ
n
;

759 
	`diùR–—£I‹¿tÜ
(
di
);

761 
	`£rv”Pªic
("Unknown hashƒncoding");

764 } ià(
o
->
ty³
 =ğ
OBJ_MODULE
) {

766 
RedisModuËIO
 
io
;

767 
moduËV®ue
 *
mv
 = 
o
->
±r
;

768 
moduËTy³
 *
mt
 = 
mv
->
ty³
;

769 
	`moduËIn™IOCÚ‹xt
(
io
,
mt
,
rdb
);

773 
»tv®
 = 
	`rdbSaveL’
(
rdb
,
mt
->
id
);

774 ià(
»tv®
 == -1)  -1;

775 
io
.
by‹s
 +ğ
»tv®
;

778 
mt
->
	`rdb_§ve
(&
io
,
mv
->
v®ue
);

779 ià(
io
.
ùx
) {

780 
	`moduËF»eCÚ‹xt
(
io
.
ùx
);

781 
	`zä“
(
io
.
ùx
);

783  
io
.
”rÜ
 ? -1 : (
ssize_t
)io.
by‹s
;

785 
	`£rv”Pªic
("Unknown objectype");

787  
nwr™‹n
;

788 
	}
}

794 
size_t
 
	$rdbSavedObjeùL’
(
robj
 *
o
) {

795 
ssize_t
 
Ën
 = 
	`rdbSaveObjeù
(
NULL
,
o
);

796 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,
Ën
 != -1);

797  
Ën
;

798 
	}
}

804 
	$rdbSaveKeyV®uePaœ
(
rio
 *
rdb
, 
robj
 *
key
,„obj *
v®
,

805 
expœ‘ime
, 
now
)

807 if(
¥¬£InU£
) {

808 
	`ä“HashObjeù
(
v®
);

812 ià(
expœ‘ime
 != -1) {

814 ià(
expœ‘ime
 < 
now
)  0;

815 ià(
	`rdbSaveTy³
(
rdb
,
RDB_OPCODE_EXPIRETIME_MS
) == -1)  -1;

816 ià(
	`rdbSaveMli£cÚdTime
(
rdb
,
expœ‘ime
) == -1)  -1;

820 ià(
	`rdbSaveObjeùTy³
(
rdb
,
v®
) == -1)  -1;

821 ià(
	`rdbSaveSŒšgObjeù
(
rdb
,
key
) == -1)  -1;

822 ià(
	`rdbSaveObjeù
(
rdb
,
v®
) == -1)  -1;

824 
	}
}

827 
	$rdbSaveAuxF›ld
(
rio
 *
rdb
, *
key
, 
size_t
 
keyËn
, *
v®
, size_ˆ
v®Ën
) {

828 ià(
	`rdbSaveTy³
(
rdb
,
RDB_OPCODE_AUX
) == -1)  -1;

829 ià(
	`rdbSaveRawSŒšg
(
rdb
,
key
,
keyËn
) == -1)  -1;

830 ià(
	`rdbSaveRawSŒšg
(
rdb
,
v®
,
v®Ën
) == -1)  -1;

832 
	}
}

836 
	$rdbSaveAuxF›ldSŒSŒ
(
rio
 *
rdb
, *
key
, *
v®
) {

837  
	`rdbSaveAuxF›ld
(
rdb
,
key
,
	`¡¾’
(key),
v®
,strlen(val));

838 
	}
}

841 
	$rdbSaveAuxF›ldSŒIÁ
(
rio
 *
rdb
, *
key
, 
v®
) {

842 
buf
[
LONG_STR_SIZE
];

843 
vËn
 = 
	`Î2¡ršg
(
buf
,(buf),
v®
);

844  
	`rdbSaveAuxF›ld
(
rdb
,
key
,
	`¡¾’
(key),
buf
,
vËn
);

845 
	}
}

848 
	$rdbSaveInfoAuxF›lds
(
rio
 *
rdb
, 
æags
) {

849 
»dis_b™s
 = ((*) == 8) ? 64 : 32;

850 
aof_´—mbË
 = (
æags
 & 
RDB_SAVE_AOF_PREAMBLE
) != 0;

853 ià(
	`rdbSaveAuxF›ldSŒSŒ
(
rdb
,"»dis-v”",
REDIS_VERSION
) == -1)  -1;

854 ià(
	`rdbSaveAuxF›ldSŒIÁ
(
rdb
,"»dis-b™s",
»dis_b™s
) == -1)  -1;

855 ià(
	`rdbSaveAuxF›ldSŒIÁ
(
rdb
,"ùime",
	`time
(
NULL
)) == -1)  -1;

856 ià(
	`rdbSaveAuxF›ldSŒIÁ
(
rdb
,"u£d-mem",
	`zm®loc_u£d_memÜy
()) == -1)  -1;

857 ià(
	`rdbSaveAuxF›ldSŒIÁ
(
rdb
,"aof-´—mbË",
aof_´—mbË
) == -1)  -1;

859 
	}
}

869 
	$rdbSaveRio
(
rio
 *
rdb
, *
”rÜ
, 
æags
) {

870 
diùI‹¿tÜ
 *
di
 = 
NULL
;

871 
diùEÁry
 *
de
;

872 
magic
[10];

873 
j
;

874 
now
 = 
	`m¡ime
();

875 
ušt64_t
 
cksum
;

876 
size_t
 
´oûs£d
 = 0;

878 ià(
£rv”
.
rdb_checksum
)

879 
rdb
->
upd©e_cksum
 = 
rioG’”icUpd©eChecksum
;

880 
	`¢´štf
(
magic
,(magic),"REDIS%04d",
RDB_VERSION
);

881 ià(
	`rdbWr™eRaw
(
rdb
,
magic
,9è=ğ-1è
w”r
;

882 ià(
	`rdbSaveInfoAuxF›lds
(
rdb
,
æags
è=ğ-1è
w”r
;

884 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

885 
»disDb
 *
db
 = 
£rv”
.db+
j
;

886 
diù
 *
d
 = 
db
->dict;

887 ià(
	`diùSize
(
d
) == 0) ;

888 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
d
);

889 ià(!
di
è 
C_ERR
;

892 ià(
	`rdbSaveTy³
(
rdb
,
RDB_OPCODE_SELECTDB
è=ğ-1è
w”r
;

893 ià(
	`rdbSaveL’
(
rdb
,
j
è=ğ-1è
w”r
;

899 
ušt32_t
 
db_size
, 
expœes_size
;

900 
db_size
 = (
	`diùSize
(
db
->
diù
è<ğ
UINT32_MAX
) ?

901 
	`diùSize
(
db
->
diù
) :

902 
UINT32_MAX
;

903 
expœes_size
 = (
	`diùSize
(
db
->
expœes
è<ğ
UINT32_MAX
) ?

904 
	`diùSize
(
db
->
expœes
) :

905 
UINT32_MAX
;

906 ià(
	`rdbSaveTy³
(
rdb
,
RDB_OPCODE_RESIZEDB
è=ğ-1è
w”r
;

907 ià(
	`rdbSaveL’
(
rdb
,
db_size
è=ğ-1è
w”r
;

908 ià(
	`rdbSaveL’
(
rdb
,
expœes_size
è=ğ-1è
w”r
;

911 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

912 
sds
 
key¡r
 = 
	`diùG‘Key
(
de
);

913 
robj
 
key
, *
o
 = 
	`diùG‘V®
(
de
);

914 
expœe
;

916 
	`š™SticSŒšgObjeù
(
key
,
key¡r
);

917 
expœe
 = 
	`g‘Expœe
(
db
,&
key
);

918 ià(
	`rdbSaveKeyV®uePaœ
(
rdb
,&
key
,
o
,
expœe
,
now
è=ğ-1è
w”r
;

923 ià(
æags
 & 
RDB_SAVE_AOF_PREAMBLE
 &&

924 
rdb
->
´oûs£d_by‹s
 > 
´oûs£d
+
AOF_READ_DIFF_INTERVAL_BYTES
)

926 
´oûs£d
 = 
rdb
->
´oûs£d_by‹s
;

927 
	`aofR—dDiffFromP¬’t
();

930 
	`diùR–—£I‹¿tÜ
(
di
);

932 
di
 = 
NULL
;

935 ià(
	`rdbSaveTy³
(
rdb
,
RDB_OPCODE_EOF
è=ğ-1è
w”r
;

939 
cksum
 = 
rdb
->cksum;

940 
	`mem»v64ifbe
(&
cksum
);

941 ià(
	`rioWr™e
(
rdb
,&
cksum
,8è=ğ0è
w”r
;

942  
C_OK
;

944 
w”r
:

945 ià(
”rÜ
è*”rÜ = 
”ºo
;

946 ià(
di
è
	`diùR–—£I‹¿tÜ
(di);

947  
C_ERR
;

948 
	}
}

958 
	$rdbSaveRioW™hEOFM¬k
(
rio
 *
rdb
, *
”rÜ
) {

959 
eofm¬k
[
RDB_EOF_MARK_SIZE
];

961 
	`g‘RªdomHexCh¬s
(
eofm¬k
,
RDB_EOF_MARK_SIZE
);

962 ià(
”rÜ
) *error = 0;

963 ià(
	`rioWr™e
(
rdb
,"$EOF:",5è=ğ0è
w”r
;

964 ià(
	`rioWr™e
(
rdb
,
eofm¬k
,
RDB_EOF_MARK_SIZE
è=ğ0è
w”r
;

965 ià(
	`rioWr™e
(
rdb
,"\r\n",2è=ğ0è
w”r
;

966 ià(
	`rdbSaveRio
(
rdb
,
”rÜ
,
RDB_SAVE_NONE
è=ğ
C_ERR
è
w”r
;

967 ià(
	`rioWr™e
(
rdb
,
eofm¬k
,
RDB_EOF_MARK_SIZE
è=ğ0è
w”r
;

968  
C_OK
;

970 
w”r
:

972 ià(
”rÜ
 && *”rÜ =ğ0è*”rÜ = 
”ºo
;

973  
C_ERR
;

974 
	}
}

977 
	$rdbSave
(*
f’ame
) {

978 
tmpfe
[256];

979 
cwd
[
MAXPATHLEN
];

980 
FILE
 *
å
;

981 
rio
 
rdb
;

982 
”rÜ
 = 0;

984 
	`¢´štf
(
tmpfe
,256,"‹mp-%d.rdb", (è
	`g‘pid
());

985 
å
 = 
	`fİ’
(
tmpfe
,"w");

986 ià(!
å
) {

987 *
cwdp
 = 
	`g‘cwd
(
cwd
,
MAXPATHLEN
);

988 
	`£rv”Log
(
LL_WARNING
,

991 
f’ame
,

992 
cwdp
 ? cwdp : "unknown",

993 
	`¡»¼Ü
(
”ºo
));

994  
C_ERR
;

997 
	`rioIn™W™hFe
(&
rdb
,
å
);

998 ià(
	`rdbSaveRio
(&
rdb
,&
”rÜ
,
RDB_SAVE_NONE
è=ğ
C_ERR
) {

999 
”ºo
 = 
”rÜ
;

1000 
w”r
;

1004 ià(
	`fæush
(
å
è=ğ
EOF
) {

1005 
w”r
;

1007 ià(
	`fsync
(
	`f’o
(
å
)) == -1) {

1008 
w”r
;

1010 ià(
	`fşo£
(
å
è=ğ
EOF
) {

1011 
w”r
;

1016 ià(
	`»Çme
(
tmpfe
,
f’ame
) == -1) {

1017 *
cwdp
 = 
	`g‘cwd
(
cwd
,
MAXPATHLEN
);

1018 
	`£rv”Log
(
LL_WARNING
,

1021 
tmpfe
,

1022 
f’ame
,

1023 
cwdp
 ? cwdp : "unknown",

1024 
	`¡»¼Ü
(
”ºo
));

1025 
	`uÆšk
(
tmpfe
);

1026  
C_ERR
;

1029 if(
¥¬£InU£
)

1030 
	`£rv”Log
(
LL_NOTICE
,"DB has been flushed");

1032 
	`£rv”Log
(
LL_NOTICE
,"DB saved on disk");

1033 
£rv”
.
dœty
 = 0;

1034 
£rv”
.
Ï¡§ve
 = 
	`time
(
NULL
);

1035 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_OK
;

1036  
C_OK
;

1038 
w”r
:

1039 
	`£rv”Log
(
LL_WARNING
,"Wr™”rÜ savšg DB oÀdisk: %s", 
	`¡»¼Ü
(
”ºo
));

1040 
	`fşo£
(
å
);

1041 
	`uÆšk
(
tmpfe
);

1042  
C_ERR
;

1043 
	}
}

1045 
	$rdbSaveBackground
(*
f’ame
) {

1046 
pid_t
 
chdpid
;

1047 
¡¬t
;

1049 ià(
£rv”
.
aof_chd_pid
 !ğ-1 || s”v”.
rdb_chd_pid
 !ğ-1è 
C_ERR
;

1051 
£rv”
.
dœty_befÜe_bg§ve
 = s”v”.
dœty
;

1052 
£rv”
.
Ï¡bg§ve_Œy
 = 
	`time
(
NULL
);

1053 
	`İ’ChdInfoPe
();

1055 
¡¬t
 = 
	`u¡ime
();

1056 ià((
chdpid
 = 
	`fÜk
()) == 0) {

1057 
»tv®
;

1060 
	`şo£Li¡’šgSock‘s
(0);

1061 
	`»disS‘ProcT™Ë
("redis-rdb-bgsave");

1062 
»tv®
 = 
	`rdbSave
(
f’ame
);

1063 ià(
»tv®
 =ğ
C_OK
) {

1064 
size_t
 
´iv©e_dœty
 = 
	`zm®loc_g‘_´iv©e_dœty
(-1);

1066 ià(
´iv©e_dœty
) {

1067 
	`£rv”Log
(
LL_NOTICE
,

1069 
´iv©e_dœty
/(1024*1024));

1072 
£rv”
.
chd_šfo_d©a
.
cow_size
 = 
´iv©e_dœty
;

1073 
	`£ndChdInfo
(
CHILD_INFO_TYPE_RDB
);

1075 
	`ex™FromChd
((
»tv®
 =ğ
C_OK
) ? 0 : 1);

1078 
£rv”
.
¡©_fÜk_time
 = 
	`u¡ime
()-
¡¬t
;

1079 
£rv”
.
¡©_fÜk_¿‹
 = (è
	`zm®loc_u£d_memÜy
(è* 1000000 / s”v”.
¡©_fÜk_time
 / (1024*1024*1024);

1080 
	`Ï‹ncyAddSam¶eIfN“ded
("fÜk",
£rv”
.
¡©_fÜk_time
/1000);

1081 ià(
chdpid
 == -1) {

1082 
	`şo£ChdInfoPe
();

1083 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_ERR
;

1084 
	`£rv”Log
(
LL_WARNING
,"Can't save in background: fork: %s",

1085 
	`¡»¼Ü
(
”ºo
));

1086  
C_ERR
;

1088 
	`£rv”Log
(
LL_NOTICE
,"Background savšg s¹ed by…id %d",
chdpid
);

1089 
£rv”
.
rdb_§ve_time_¡¬t
 = 
	`time
(
NULL
);

1090 
£rv”
.
rdb_chd_pid
 = 
chdpid
;

1091 
£rv”
.
rdb_chd_ty³
 = 
RDB_CHILD_TYPE_DISK
;

1092 
	`upd©eDiùResizePŞicy
();

1093  
C_OK
;

1095  
C_OK
;

1096 
	}
}

1098 
	$rdbRemoveTempFe
(
pid_t
 
chdpid
) {

1099 
tmpfe
[256];

1101 
	`¢´štf
(
tmpfe
,Ñmpfe),"‹mp-%d.rdb", (è
chdpid
);

1102 
	`uÆšk
(
tmpfe
);

1103 
	}
}

1107 
robj
 *
	$rdbLßdObjeù
(
rdbty³
, 
rio
 *
rdb
) {

1108 
robj
 *
o
 = 
NULL
, *
–e
, *
dec
;

1109 
ušt64_t
 
Ën
;

1110 
i
;

1112 ià(
rdbty³
 =ğ
RDB_TYPE_STRING
) {

1114 ià((
o
 = 
	`rdbLßdEncodedSŒšgObjeù
(
rdb
)è=ğ
NULL
)  NULL;

1115 
o
 = 
	`ŒyObjeùEncodšg
(o);

1116 } ià(
rdbty³
 =ğ
RDB_TYPE_LIST
) {

1118 ià((
Ën
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

1120 
o
 = 
	`ü—‹Quickli¡Objeù
();

1121 
	`quickli¡S‘O±iÚs
(
o
->
±r
, 
£rv”
.
li¡_max_zli¡_size
,

1122 
£rv”
.
li¡_com´ess_d•th
);

1125 
Ën
--) {

1126 ià((
–e
 = 
	`rdbLßdEncodedSŒšgObjeù
(
rdb
)è=ğ
NULL
)  NULL;

1127 
dec
 = 
	`g‘DecodedObjeù
(
–e
);

1128 
size_t
 
Ën
 = 
	`sd¦’
(
dec
->
±r
);

1129 
	`quickli¡PushTa
(
o
->
±r
, 
dec
->±r, 
Ën
);

1130 
	`deüRefCouÁ
(
dec
);

1131 
	`deüRefCouÁ
(
–e
);

1133 } ià(
rdbty³
 =ğ
RDB_TYPE_SET
) {

1135 ià((
Ën
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

1138 ià(
Ën
 > 
£rv”
.
£t_max_št£t_’Œ›s
) {

1139 
o
 = 
	`ü—‹S‘Objeù
();

1142 ià(
Ën
 > 
DICT_HT_INITIAL_SIZE
)

1143 
	`diùEx·nd
(
o
->
±r
,
Ën
);

1145 
o
 = 
	`ü—‹IÁ£tObjeù
();

1149 
i
 = 0; i < 
Ën
; i++) {

1150 
Îv®
;

1151 
sds
 
sd£Ë
;

1153 ià((
sd£Ë
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1154 =ğ
NULL
)  NULL;

1156 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

1158 ià(
	`isSdsR•»£ÁabËAsLÚgLÚg
(
sd£Ë
,&
Îv®
è=ğ
C_OK
) {

1159 
o
->
±r
 = 
	`št£tAdd
(o->±r,
Îv®
,
NULL
);

1161 
	`£tTy³CÚv”t
(
o
,
OBJ_ENCODING_HT
);

1162 
	`diùEx·nd
(
o
->
±r
,
Ën
);

1168 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

1169 
	`diùAdd
((
diù
*)
o
->
±r
,
sd£Ë
,
NULL
);

1171 
	`sdsä“
(
sd£Ë
);

1174 } ià(
rdbty³
 =ğ
RDB_TYPE_ZSET_2
 ||„dbty³ =ğ
RDB_TYPE_ZSET
) {

1176 
ušt64_t
 
z£’
;

1177 
size_t
 
max––’
 = 0;

1178 
z£t
 *
zs
;

1180 ià((
z£’
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

1181 
o
 = 
	`ü—‹Z£tObjeù
();

1182 
zs
 = 
o
->
±r
;

1185 
z£’
--) {

1186 
sds
 
sd£Ë
;

1187 
scÜe
;

1188 
zskli¡Node
 *
znode
;

1190 ià((
sd£Ë
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1191 =ğ
NULL
)  NULL;

1193 ià(
rdbty³
 =ğ
RDB_TYPE_ZSET_2
) {

1194 ià(
	`rdbLßdBš¬yDoubËV®ue
(
rdb
,&
scÜe
è=ğ-1è 
NULL
;

1196 ià(
	`rdbLßdDoubËV®ue
(
rdb
,&
scÜe
è=ğ-1è 
NULL
;

1200 ià(
	`sd¦’
(
sd£Ë
è> 
max––’
) maxelelen = sdslen(sdsele);

1202 
znode
 = 
	`z¦In£¹
(
zs
->
z¦
,
scÜe
,
sd£Ë
);

1203 
	`diùAdd
(
zs
->
diù
,
sd£Ë
,&
znode
->
scÜe
);

1207 ià(
	`z£tL’gth
(
o
è<ğ
£rv”
.
z£t_max_zli¡_’Œ›s
 &&

1208 
max––’
 <ğ
£rv”
.
z£t_max_zli¡_v®ue
)

1209 
	`z£tCÚv”t
(
o
,
OBJ_ENCODING_ZIPLIST
);

1210 } ià(
rdbty³
 =ğ
RDB_TYPE_HASH
) {

1211 
ušt64_t
 
Ën
;

1212 
»t
;

1213 
sds
 
f›ld
, 
v®ue
;

1215 
Ën
 = 
	`rdbLßdL’
(
rdb
, 
NULL
);

1216 ià(
Ën
 =ğ
RDB_LENERR
è 
NULL
;

1218 
o
 = 
	`ü—‹HashObjeù
();

1221 ià(
Ën
 > 
£rv”
.
hash_max_zli¡_’Œ›s
)

1222 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

1225 
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
 && 
Ën
 > 0) {

1226 
Ën
--;

1228 ià((
f›ld
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1229 =ğ
NULL
)  NULL;

1230 ià((
v®ue
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1231 =ğ
NULL
)  NULL;

1234 
o
->
±r
 = 
	`zli¡Push
(o->±r, (*)
f›ld
,

1235 
	`sd¦’
(
f›ld
), 
ZIPLIST_TAIL
);

1236 
o
->
±r
 = 
	`zli¡Push
(o->±r, (*)
v®ue
,

1237 
	`sd¦’
(
v®ue
), 
ZIPLIST_TAIL
);

1240 ià(
	`sd¦’
(
f›ld
è> 
£rv”
.
hash_max_zli¡_v®ue
 ||

1241 
	`sd¦’
(
v®ue
è> 
£rv”
.
hash_max_zli¡_v®ue
)

1243 
	`sdsä“
(
f›ld
);

1244 
	`sdsä“
(
v®ue
);

1245 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

1248 
	`sdsä“
(
f›ld
);

1249 
	`sdsä“
(
v®ue
);

1253 
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
 && 
Ën
 > 0) {

1254 
Ën
--;

1256 ià((
f›ld
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1257 =ğ
NULL
)  NULL;

1258 ià((
v®ue
 = 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_SDS
,
NULL
))

1259 =ğ
NULL
)  NULL;

1262 
»t
 = 
	`diùAdd
((
diù
*)
o
->
±r
, 
f›ld
, 
v®ue
);

1263 ià(
»t
 =ğ
DICT_ERR
) {

1264 
	`rdbEx™R•ÜtCÜru±RDB
("Duplicate keys detected");

1269 
	`£rv”As£¹
(
Ën
 == 0);

1270 } ià(
rdbty³
 =ğ
RDB_TYPE_LIST_QUICKLIST
) {

1271 ià((
Ën
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)  NULL;

1272 
o
 = 
	`ü—‹Quickli¡Objeù
();

1273 
	`quickli¡S‘O±iÚs
(
o
->
±r
, 
£rv”
.
li¡_max_zli¡_size
,

1274 
£rv”
.
li¡_com´ess_d•th
);

1276 
Ën
--) {

1277 *
zl
 =

1278 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_PLAIN
,
NULL
);

1279 ià(
zl
 =ğ
NULL
)  NULL;

1280 
	`quickli¡Aµ’dZli¡
(
o
->
±r
, 
zl
);

1282 } ià(
rdbty³
 =ğ
RDB_TYPE_HASH_ZIPMAP
 ||

1283 
rdbty³
 =ğ
RDB_TYPE_LIST_ZIPLIST
 ||

1284 
rdbty³
 =ğ
RDB_TYPE_SET_INTSET
 ||

1285 
rdbty³
 =ğ
RDB_TYPE_ZSET_ZIPLIST
 ||

1286 
rdbty³
 =ğ
RDB_TYPE_HASH_ZIPLIST
)

1288 *
’coded
 =

1289 
	`rdbG’”icLßdSŒšgObjeù
(
rdb
,
RDB_LOAD_PLAIN
,
NULL
);

1290 ià(
’coded
 =ğ
NULL
)  NULL;

1291 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
’coded
);

1299 
rdbty³
) {

1300 
RDB_TYPE_HASH_ZIPMAP
:

1304 *
zl
 = 
	`zli¡New
();

1305 *
zi
 = 
	`zm­Rewšd
(
o
->
±r
);

1306 *
f¡r
, *
v¡r
;

1307 
æ’
, 
vËn
;

1308 
maxËn
 = 0;

1310 (
zi
 = 
	`zm­Next
(zi, &
f¡r
, &
æ’
, &
v¡r
, &
vËn
)è!ğ
NULL
) {

1311 ià(
æ’
 > 
maxËn
) maxlen = flen;

1312 ià(
vËn
 > 
maxËn
) maxlen = vlen;

1313 
zl
 = 
	`zli¡Push
(zl, 
f¡r
, 
æ’
, 
ZIPLIST_TAIL
);

1314 
zl
 = 
	`zli¡Push
(zl, 
v¡r
, 
vËn
, 
ZIPLIST_TAIL
);

1317 
	`zä“
(
o
->
±r
);

1318 
o
->
±r
 = 
zl
;

1319 
o
->
ty³
 = 
OBJ_HASH
;

1320 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

1322 ià(
	`hashTy³L’gth
(
o
è> 
£rv”
.
hash_max_zli¡_’Œ›s
 ||

1323 
maxËn
 > 
£rv”
.
hash_max_zli¡_v®ue
)

1325 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

1329 
RDB_TYPE_LIST_ZIPLIST
:

1330 
o
->
ty³
 = 
OBJ_LIST
;

1331 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

1332 
	`li¡Ty³CÚv”t
(
o
,
OBJ_ENCODING_QUICKLIST
);

1334 
RDB_TYPE_SET_INTSET
:

1335 
o
->
ty³
 = 
OBJ_SET
;

1336 
o
->
’codšg
 = 
OBJ_ENCODING_INTSET
;

1337 ià(
	`št£tL’
(
o
->
±r
è> 
£rv”
.
£t_max_št£t_’Œ›s
)

1338 
	`£tTy³CÚv”t
(
o
,
OBJ_ENCODING_HT
);

1340 
RDB_TYPE_ZSET_ZIPLIST
:

1341 
o
->
ty³
 = 
OBJ_ZSET
;

1342 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

1343 ià(
	`z£tL’gth
(
o
è> 
£rv”
.
z£t_max_zli¡_’Œ›s
)

1344 
	`z£tCÚv”t
(
o
,
OBJ_ENCODING_SKIPLIST
);

1346 
RDB_TYPE_HASH_ZIPLIST
:

1347 
o
->
ty³
 = 
OBJ_HASH
;

1348 
o
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

1349 ià(
	`hashTy³L’gth
(
o
è> 
£rv”
.
hash_max_zli¡_’Œ›s
)

1350 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

1353 
	`rdbEx™R•ÜtCÜru±RDB
("UnknowÀRDBƒncodšgy³ %d",
rdbty³
);

1356 } ià(
rdbty³
 =ğ
RDB_TYPE_MODULE
) {

1357 
ušt64_t
 
moduËid
 = 
	`rdbLßdL’
(
rdb
,
NULL
);

1358 
moduËTy³
 *
mt
 = 
	`moduËTy³LookupModuËByID
(
moduËid
);

1359 
Çme
[10];

1361 ià(
mt
 =ğ
NULL
) {

1362 
	`moduËTy³NameByID
(
Çme
,
moduËid
);

1363 
	`£rv”Log
(
LL_WARNING
,"ThRDB fcÚš moduË d©¨I cª'ˆlßd:‚Øm©chšg moduË '%s'", 
Çme
);

1364 
	`ex™
(1);

1366 
RedisModuËIO
 
io
;

1367 
	`moduËIn™IOCÚ‹xt
(
io
,
mt
,
rdb
);

1370 *
±r
 = 
mt
->
	`rdb_lßd
(&
io
,
moduËid
&1023);

1371 ià(
±r
 =ğ
NULL
) {

1372 
	`moduËTy³NameByID
(
Çme
,
moduËid
);

1373 
	`£rv”Log
(
LL_WARNING
,"ThRDB fcÚš moduË d©¨fÜhmoduËy³ '%s',h©h»¥ÚsibË moduË i nÙ‡bËØlßd. Check fÜ moduË log‡bovfÜ‡dd™iÚ® clues.", 
Çme
);

1374 
	`ex™
(1);

1376 
o
 = 
	`ü—‹ModuËObjeù
(
mt
,
±r
);

1378 
	`rdbEx™R•ÜtCÜru±RDB
("UnknowÀRDBƒncodšgy³ %d",
rdbty³
);

1380  
o
;

1381 
	}
}

1385 
	$¡¬tLßdšg
(
FILE
 *
å
) {

1386 
¡©
 
sb
;

1389 
£rv”
.
lßdšg
 = 1;

1390 
£rv”
.
lßdšg_¡¬t_time
 = 
	`time
(
NULL
);

1391 
£rv”
.
lßdšg_lßded_by‹s
 = 0;

1392 ià(
	`f¡©
(
	`f’o
(
å
), &
sb
) == -1) {

1393 
£rv”
.
lßdšg_tÙ®_by‹s
 = 0;

1395 
£rv”
.
lßdšg_tÙ®_by‹s
 = 
sb
.
¡_size
;

1397 
	}
}

1400 
	$lßdšgProg»ss
(
off_t
 
pos
) {

1401 
£rv”
.
lßdšg_lßded_by‹s
 = 
pos
;

1402 ià(
£rv”
.
¡©_³ak_memÜy
 < 
	`zm®loc_u£d_memÜy
())

1403 
£rv”
.
¡©_³ak_memÜy
 = 
	`zm®loc_u£d_memÜy
();

1404 
	}
}

1407 
	$¡İLßdšg
() {

1408 
£rv”
.
lßdšg
 = 0;

1409 
	}
}

1413 
	$rdbLßdProg»ssC®lback
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

1414 ià(
£rv”
.
rdb_checksum
)

1415 
	`rioG’”icUpd©eChecksum
(
r
, 
buf
, 
Ën
);

1416 ià(
£rv”
.
lßdšg_´oûss_ev’ts_š‹rv®_by‹s
 &&

1417 (
r
->
´oûs£d_by‹s
 + 
Ën
)/
£rv”
.
lßdšg_´oûss_ev’ts_š‹rv®_by‹s
 >„->processed_bytes/server.loading_process_events_interval_bytes)

1422 
	`upd©eCachedTime
();

1423 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
)

1424 
	`»¶iÿtiÚS’dNewlšeToMa¡”
();

1425 
	`lßdšgProg»ss
(
r
->
´oûs£d_by‹s
);

1426 
	`´oûssEv’tsWheBlocked
();

1428 
	}
}

1432 
	$rdbLßdRio
(
rio
 *
rdb
) {

1433 
ušt64_t
 
dbid
;

1434 
ty³
, 
rdbv”
;

1435 
»disDb
 *
db
 = 
£rv”
.db+0;

1436 
buf
[1024];

1437 
expœ‘ime
, 
now
 = 
	`m¡ime
();

1439 
rdb
->
upd©e_cksum
 = 
rdbLßdProg»ssC®lback
;

1440 
rdb
->
max_´oûssšg_chunk
 = 
£rv”
.
lßdšg_´oûss_ev’ts_š‹rv®_by‹s
;

1441 ià(
	`rioR—d
(
rdb
,
buf
,9è=ğ0è
eoã¼
;

1442 
buf
[9] = '\0';

1443 ià(
	`memcmp
(
buf
,"REDIS",5) != 0) {

1444 
	`£rv”Log
(
LL_WARNING
,"Wrong signatureryingo†oad DB from file");

1445 
”ºo
 = 
EINVAL
;

1446  
C_ERR
;

1448 
rdbv”
 = 
	`©oi
(
buf
+5);

1449 ià(
rdbv”
 < 1 ||„dbv” > 
RDB_VERSION
) {

1450 
	`£rv”Log
(
LL_WARNING
,"Cª'ˆhªdË RDB fÜm© v”siÚ %d",
rdbv”
);

1451 
”ºo
 = 
EINVAL
;

1452  
C_ERR
;

1456 
robj
 *
key
, *
v®
;

1457 
expœ‘ime
 = -1;

1460 ià((
ty³
 = 
	`rdbLßdTy³
(
rdb
)è=ğ-1è
eoã¼
;

1463 ià(
ty³
 =ğ
RDB_OPCODE_EXPIRETIME
) {

1467 ià((
expœ‘ime
 = 
	`rdbLßdTime
(
rdb
)è=ğ-1è
eoã¼
;

1469 ià((
ty³
 = 
	`rdbLßdTy³
(
rdb
)è=ğ-1è
eoã¼
;

1472 
expœ‘ime
 *= 1000;

1473 } ià(
ty³
 =ğ
RDB_OPCODE_EXPIRETIME_MS
) {

1476 ià((
expœ‘ime
 = 
	`rdbLßdMli£cÚdTime
(
rdb
)è=ğ-1è
eoã¼
;

1478 ià((
ty³
 = 
	`rdbLßdTy³
(
rdb
)è=ğ-1è
eoã¼
;

1479 } ià(
ty³
 =ğ
RDB_OPCODE_EOF
) {

1482 } ià(
ty³
 =ğ
RDB_OPCODE_SELECTDB
) {

1484 ià((
dbid
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)

1485 
eoã¼
;

1486 ià(
dbid
 >ğ()
£rv”
.
dbnum
) {

1487 
	`£rv”Log
(
LL_WARNING
,

1490 "d©aba£s. Ex™šg\n", 
£rv”
.
dbnum
);

1491 
	`ex™
(1);

1493 
db
 = 
£rv”
.db+
dbid
;

1495 } ià(
ty³
 =ğ
RDB_OPCODE_RESIZEDB
) {

1498 
ušt64_t
 
db_size
, 
expœes_size
;

1499 ià((
db_size
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)

1500 
eoã¼
;

1501 ià((
expœes_size
 = 
	`rdbLßdL’
(
rdb
,
NULL
)è=ğ
RDB_LENERR
)

1502 
eoã¼
;

1503 
	`diùEx·nd
(
db
->
diù
,
db_size
);

1504 
	`diùEx·nd
(
db
->
expœes
,
expœes_size
);

1506 } ià(
ty³
 =ğ
RDB_OPCODE_AUX
) {

1512 
robj
 *
auxkey
, *
auxv®
;

1513 ià((
auxkey
 = 
	`rdbLßdSŒšgObjeù
(
rdb
)è=ğ
NULL
è
eoã¼
;

1514 ià((
auxv®
 = 
	`rdbLßdSŒšgObjeù
(
rdb
)è=ğ
NULL
è
eoã¼
;

1516 ià(((*)
auxkey
->
±r
)[0] == '%') {

1520 
	`£rv”Log
(
LL_NOTICE
,"RDB '%s': %s",

1521 (*)
auxkey
->
±r
,

1522 (*)
auxv®
->
±r
);

1526 
	`£rv”Log
(
LL_DEBUG
,"Unrecognized RDB AUX field: '%s'",

1527 (*)
auxkey
->
±r
);

1530 
	`deüRefCouÁ
(
auxkey
);

1531 
	`deüRefCouÁ
(
auxv®
);

1536 ià((
key
 = 
	`rdbLßdSŒšgObjeù
(
rdb
)è=ğ
NULL
è
eoã¼
;

1538 ià((
v®
 = 
	`rdbLßdObjeù
(
ty³
,
rdb
)è=ğ
NULL
è
eoã¼
;

1544 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
 && 
expœ‘ime
 !ğ-1 &&ƒxpœ‘im< 
now
) {

1545 
	`deüRefCouÁ
(
key
);

1546 
	`deüRefCouÁ
(
v®
);

1550 
	`dbAdd
(
db
,
key
,
v®
);

1553 ià(
expœ‘ime
 !ğ-1è
	`£tExpœe
(
db
,
key
,expiretime);

1555 
	`deüRefCouÁ
(
key
);

1558 ià(
rdbv”
 >ğ5 && 
£rv”
.
rdb_checksum
) {

1559 
ušt64_t
 
cksum
, 
ex³ùed
 = 
rdb
->cksum;

1561 ià(
	`rioR—d
(
rdb
,&
cksum
,8è=ğ0è
eoã¼
;

1562 
	`mem»v64ifbe
(&
cksum
);

1563 ià(
cksum
 == 0) {

1564 
	`£rv”Log
(
LL_WARNING
,"RDB file was saved with checksum disabled:‚o check…erformed.");

1565 } ià(
cksum
 !ğ
ex³ùed
) {

1566 
	`£rv”Log
(
LL_WARNING
,"Wrong RDB checksum. Aborting‚ow.");

1567 
	`rdbEx™R•ÜtCÜru±RDB
("RDB CRCƒrror");

1570  
C_OK
;

1572 
eoã¼
:

1573 
	`£rv”Log
(
LL_WARNING
,"Short„ead or OOM†oading DB. Unrecoverableƒrror,‡borting‚ow.");

1574 
	`rdbEx™R•ÜtCÜru±RDB
("Unexpected EOF„eading RDB file");

1575  
C_ERR
;

1576 
	}
}

1582 
	$rdbLßd
(*
f’ame
) {

1583 
FILE
 *
å
;

1584 
rio
 
rdb
;

1585 
»tv®
;

1587 ià((
å
 = 
	`fİ’
(
f’ame
,"r")è=ğ
NULL
è 
C_ERR
;

1588 
	`¡¬tLßdšg
(
å
);

1589 
	`rioIn™W™hFe
(&
rdb
,
å
);

1590 
»tv®
 = 
	`rdbLßdRio
(&
rdb
);

1591 
	`fşo£
(
å
);

1592 
	`¡İLßdšg
();

1593  
»tv®
;

1594 
	}
}

1598 
	$backgroundSaveDÚeHªdËrDisk
(
ex™code
, 
bysigÇl
) {

1599 ià(!
bysigÇl
 && 
ex™code
 == 0) {

1600 
	`£rv”Log
(
LL_NOTICE
,

1602 
£rv”
.
dœty
 = s”v”.dœty - s”v”.
dœty_befÜe_bg§ve
;

1603 
£rv”
.
Ï¡§ve
 = 
	`time
(
NULL
);

1604 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_OK
;

1605 } ià(!
bysigÇl
 && 
ex™code
 != 0) {

1606 
	`£rv”Log
(
LL_WARNING
, "Background savingƒrror");

1607 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_ERR
;

1609 
m¡ime_t
 
Ï‹ncy
;

1611 
	`£rv”Log
(
LL_WARNING
,

1612 "Background savšg”mš©ed by sigÇÈ%d", 
bysigÇl
);

1613 
	`Ï‹ncyS¹MÚ™Ü
(
Ï‹ncy
);

1614 
	`rdbRemoveTempFe
(
£rv”
.
rdb_chd_pid
);

1615 
	`Ï‹ncyEndMÚ™Ü
(
Ï‹ncy
);

1616 
	`Ï‹ncyAddSam¶eIfN“ded
("rdb-uÆšk-‹mp-fe",
Ï‹ncy
);

1619 ià(
bysigÇl
 !ğ
SIGUSR1
)

1620 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_ERR
;

1622 
£rv”
.
rdb_chd_pid
 = -1;

1623 
£rv”
.
rdb_chd_ty³
 = 
RDB_CHILD_TYPE_NONE
;

1624 
£rv”
.
rdb_§ve_time_Ï¡
 = 
	`time
(
NULL
)-£rv”.
rdb_§ve_time_¡¬t
;

1625 
£rv”
.
rdb_§ve_time_¡¬t
 = -1;

1628 
	`upd©eSÏvesWa™šgBg§ve
((!
bysigÇl
 && 
ex™code
 =ğ0è? 
C_OK
 : 
C_ERR
, 
RDB_CHILD_TYPE_DISK
);

1629 
	}
}

1634 
	$backgroundSaveDÚeHªdËrSock‘
(
ex™code
, 
bysigÇl
) {

1635 
ušt64_t
 *
ok_¦aves
;

1637 ià(!
bysigÇl
 && 
ex™code
 == 0) {

1638 
	`£rv”Log
(
LL_NOTICE
,

1640 } ià(!
bysigÇl
 && 
ex™code
 != 0) {

1641 
	`£rv”Log
(
LL_WARNING
, "Backgroundransferƒrror");

1643 
	`£rv”Log
(
LL_WARNING
,

1644 "Background¿nsã¸‹rmš©ed by sigÇÈ%d", 
bysigÇl
);

1646 
£rv”
.
rdb_chd_pid
 = -1;

1647 
£rv”
.
rdb_chd_ty³
 = 
RDB_CHILD_TYPE_NONE
;

1648 
£rv”
.
rdb_§ve_time_¡¬t
 = -1;

1657 
ok_¦aves
 = 
	`zm®loc
((
ušt64_t
));

1658 
ok_¦aves
[0] = 0;

1659 ià(!
bysigÇl
 && 
ex™code
 == 0) {

1660 
»adËn
 = (
ušt64_t
);

1662 ià(
	`»ad
(
£rv”
.
rdb_pe_»ad_»suÉ_äom_chd
, 
ok_¦aves
, 
»adËn
) ==

1663 
»adËn
)

1665 
»adËn
 = 
ok_¦aves
[0]*(
ušt64_t
)*2;

1669 
ok_¦aves
 = 
	`z»®loc
(ok_¦aves,(
ušt64_t
)+
»adËn
);

1670 ià(
»adËn
 &&

1671 
	`»ad
(
£rv”
.
rdb_pe_»ad_»suÉ_äom_chd
, 
ok_¦aves
+1,

1672 
»adËn
) !=„eadlen)

1674 
ok_¦aves
[0] = 0;

1679 
	`şo£
(
£rv”
.
rdb_pe_»ad_»suÉ_äom_chd
);

1680 
	`şo£
(
£rv”
.
rdb_pe_wr™e_»suÉ_to_·»Á
);

1684 
li¡Node
 *
Ê
;

1685 
li¡I‹r
 
li
;

1687 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1688 (
Ê
 = 
	`li¡Next
(&
li
))) {

1689 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

1691 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_END
) {

1692 
ušt64_t
 
j
;

1693 
”rÜcode
 = 0;

1698 
j
 = 0; j < 
ok_¦aves
[0]; j++) {

1699 ià(
¦ave
->
id
 =ğ
ok_¦aves
[2*
j
+1]) {

1700 
”rÜcode
 = 
ok_¦aves
[2*
j
+2];

1704 ià(
j
 =ğ
ok_¦aves
[0] || 
”rÜcode
 != 0) {

1705 
	`£rv”Log
(
LL_WARNING
,

1707 
	`»¶iÿtiÚG‘SÏveName
(
¦ave
),

1708 (
”rÜcode
 == 0) ? "RDBransfer child‡borted"

1709 : 
	`¡»¼Ü
(
”rÜcode
));

1710 
	`ä“Cl›Á
(
¦ave
);

1712 
	`£rv”Log
(
LL_WARNING
,

1714 
	`»¶iÿtiÚG‘SÏveName
(
¦ave
));

1716 
	`ª‘NÚBlock
(
NULL
,
¦ave
->
fd
);

1717 
	`ª‘S’dTimeout
(
NULL
,
¦ave
->
fd
,0);

1721 
	`zä“
(
ok_¦aves
);

1723 
	`upd©eSÏvesWa™šgBg§ve
((!
bysigÇl
 && 
ex™code
 =ğ0è? 
C_OK
 : 
C_ERR
, 
RDB_CHILD_TYPE_SOCKET
);

1724 
	}
}

1727 
	$backgroundSaveDÚeHªdËr
(
ex™code
, 
bysigÇl
) {

1728 
£rv”
.
rdb_chd_ty³
) {

1729 
RDB_CHILD_TYPE_DISK
:

1730 
	`backgroundSaveDÚeHªdËrDisk
(
ex™code
,
bysigÇl
);

1732 
RDB_CHILD_TYPE_SOCKET
:

1733 
	`backgroundSaveDÚeHªdËrSock‘
(
ex™code
,
bysigÇl
);

1736 
	`£rv”Pªic
("Unknown RDB childype.");

1739 
	}
}

1743 
	$rdbSaveToSÏvesSock‘s
() {

1744 *
fds
;

1745 
ušt64_t
 *
ş›Áids
;

1746 
numfds
;

1747 
li¡Node
 *
Ê
;

1748 
li¡I‹r
 
li
;

1749 
pid_t
 
chdpid
;

1750 
¡¬t
;

1751 
pefds
[2];

1753 ià(
£rv”
.
aof_chd_pid
 !ğ-1 || s”v”.
rdb_chd_pid
 !ğ-1è 
C_ERR
;

1758 ià(
	`pe
(
pefds
è=ğ-1è 
C_ERR
;

1759 
£rv”
.
rdb_pe_»ad_»suÉ_äom_chd
 = 
pefds
[0];

1760 
£rv”
.
rdb_pe_wr™e_»suÉ_to_·»Á
 = 
pefds
[1];

1764 
fds
 = 
	`zm®loc
(()*
	`li¡L’gth
(
£rv”
.
¦aves
));

1768 
ş›Áids
 = 
	`zm®loc
((
ušt64_t
)*
	`li¡L’gth
(
£rv”
.
¦aves
));

1769 
numfds
 = 0;

1771 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1772 (
Ê
 = 
	`li¡Next
(&
li
))) {

1773 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

1775 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) {

1776 
ş›Áids
[
numfds
] = 
¦ave
->
id
;

1777 
fds
[
numfds
++] = 
¦ave
->
fd
;

1778 
	`»¶iÿtiÚS‘upSÏveFÜFuÎResync
(
¦ave
,
	`g‘PsyncIn™ŸlOff£t
());

1782 
	`ª‘Block
(
NULL
,
¦ave
->
fd
);

1783 
	`ª‘S’dTimeout
(
NULL
,
¦ave
->
fd
,
£rv”
.
»¶_timeout
*1000);

1788 
	`İ’ChdInfoPe
();

1789 
¡¬t
 = 
	`u¡ime
();

1790 ià((
chdpid
 = 
	`fÜk
()) == 0) {

1792 
»tv®
;

1793 
rio
 
¦ave_sock‘s
;

1795 
	`rioIn™W™hFd£t
(&
¦ave_sock‘s
,
fds
,
numfds
);

1796 
	`zä“
(
fds
);

1798 
	`şo£Li¡’šgSock‘s
(0);

1799 
	`»disS‘ProcT™Ë
("redis-rdb-to-slaves");

1801 
»tv®
 = 
	`rdbSaveRioW™hEOFM¬k
(&
¦ave_sock‘s
,
NULL
);

1802 ià(
»tv®
 =ğ
C_OK
 && 
	`rioFlush
(&
¦ave_sock‘s
) == 0)

1803 
»tv®
 = 
C_ERR
;

1805 ià(
»tv®
 =ğ
C_OK
) {

1806 
size_t
 
´iv©e_dœty
 = 
	`zm®loc_g‘_´iv©e_dœty
(-1);

1808 ià(
´iv©e_dœty
) {

1809 
	`£rv”Log
(
LL_NOTICE
,

1811 
´iv©e_dœty
/(1024*1024));

1814 
£rv”
.
chd_šfo_d©a
.
cow_size
 = 
´iv©e_dœty
;

1815 
	`£ndChdInfo
(
CHILD_INFO_TYPE_RDB
);

1832 *
msg
 = 
	`zm®loc
((
ušt64_t
)*(1+2*
numfds
));

1833 
ušt64_t
 *
Ën
 = 
msg
;

1834 
ušt64_t
 *
ids
 = 
Ën
+1;

1835 
j
, 
msgËn
;

1837 *
Ën
 = 
numfds
;

1838 
j
 = 0; j < 
numfds
; j++) {

1839 *
ids
++ = 
ş›Áids
[
j
];

1840 *
ids
++ = 
¦ave_sock‘s
.
io
.
fd£t
.
¡©e
[
j
];

1847 
msgËn
 = (
ušt64_t
)*(1+2*
numfds
);

1848 ià(*
Ën
 == 0 ||

1849 
	`wr™e
(
£rv”
.
rdb_pe_wr™e_»suÉ_to_·»Á
,
msg
,
msgËn
)

1850 !ğ
msgËn
)

1852 
»tv®
 = 
C_ERR
;

1854 
	`zä“
(
msg
);

1856 
	`zä“
(
ş›Áids
);

1857 
	`rioF»eFd£t
(&
¦ave_sock‘s
);

1858 
	`ex™FromChd
((
»tv®
 =ğ
C_OK
) ? 0 : 1);

1861 
£rv”
.
¡©_fÜk_time
 = 
	`u¡ime
()-
¡¬t
;

1862 
£rv”
.
¡©_fÜk_¿‹
 = (è
	`zm®loc_u£d_memÜy
(è* 1000000 / s”v”.
¡©_fÜk_time
 / (1024*1024*1024);

1863 
	`Ï‹ncyAddSam¶eIfN“ded
("fÜk",
£rv”
.
¡©_fÜk_time
/1000);

1864 ià(
chdpid
 == -1) {

1865 
	`£rv”Log
(
LL_WARNING
,"Can't save in background: fork: %s",

1866 
	`¡»¼Ü
(
”ºo
));

1871 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1872 (
Ê
 = 
	`li¡Next
(&
li
))) {

1873 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

1874 
j
;

1876 
j
 = 0; j < 
numfds
; j++) {

1877 ià(
¦ave
->
id
 =ğ
ş›Áids
[
j
]) {

1878 
¦ave
->
»¶¡©e
 = 
SLAVE_STATE_WAIT_BGSAVE_START
;

1883 
	`şo£
(
pefds
[0]);

1884 
	`şo£
(
pefds
[1]);

1885 
	`şo£ChdInfoPe
();

1887 
	`£rv”Log
(
LL_NOTICE
,"Background RDBransfer started by…id %d",

1888 
chdpid
);

1889 
£rv”
.
rdb_§ve_time_¡¬t
 = 
	`time
(
NULL
);

1890 
£rv”
.
rdb_chd_pid
 = 
chdpid
;

1891 
£rv”
.
rdb_chd_ty³
 = 
RDB_CHILD_TYPE_SOCKET
;

1892 
	`upd©eDiùResizePŞicy
();

1894 
	`zä“
(
ş›Áids
);

1895 
	`zä“
(
fds
);

1896  (
chdpid
 =ğ-1è? 
C_ERR
 : 
C_OK
;

1898  
C_OK
;

1899 
	}
}

1901 
	$§veCommªd
(
ş›Á
 *
c
) {

1902 ià(
£rv”
.
rdb_chd_pid
 != -1) {

1903 
	`addR•lyE¼Ü
(
c
,"Background save‡lready in…rogress");

1906 ià(
	`rdbSave
(
£rv”
.
rdb_f’ame
è=ğ
C_OK
) {

1907 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1909 
	`addR•ly
(
c
,
sh¬ed
.
”r
);

1911 
	}
}

1914 
	$bg§veCommªd
(
ş›Á
 *
c
) {

1915 
scheduË
 = 0;

1919 ià(
c
->
¬gc
 > 1) {

1920 ià(
c
->
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"schedule")) {

1921 
scheduË
 = 1;

1923 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1928 ià(
£rv”
.
rdb_chd_pid
 != -1) {

1929 
	`addR•lyE¼Ü
(
c
,"Background save‡lready in…rogress");

1930 } ià(
£rv”
.
aof_chd_pid
 != -1) {

1931 ià(
scheduË
) {

1932 
£rv”
.
rdb_bg§ve_scheduËd
 = 1;

1933 
	`addR•lyStus
(
c
,"Background saving scheduled");

1935 
	`addR•lyE¼Ü
(
c
,

1940 } ià(
	`rdbSaveBackground
(
£rv”
.
rdb_f’ame
è=ğ
C_OK
) {

1941 
	`addR•lyStus
(
c
,"Background saving started");

1943 
	`addR•ly
(
c
,
sh¬ed
.
”r
);

1945 
	}
}

	@rdb.h

30 #iâdeà
__RDB_H


31 
	#__RDB_H


	)

33 
	~<¡dio.h
>

34 
	~"rio.h
"

37 
	~"£rv”.h
"

41 
	#RDB_VERSION
 8

	)

57 
	#RDB_6BITLEN
 0

	)

58 
	#RDB_14BITLEN
 1

	)

59 
	#RDB_32BITLEN
 0x80

	)

60 
	#RDB_64BITLEN
 0x81

	)

61 
	#RDB_ENCVAL
 3

	)

62 
	#RDB_LENERR
 
UINT64_MAX


	)

67 
	#RDB_ENC_INT8
 0

	)

68 
	#RDB_ENC_INT16
 1

	)

69 
	#RDB_ENC_INT32
 2

	)

70 
	#RDB_ENC_LZF
 3

	)

74 
	#RDB_TYPE_STRING
 0

	)

75 
	#RDB_TYPE_LIST
 1

	)

76 
	#RDB_TYPE_SET
 2

	)

77 
	#RDB_TYPE_ZSET
 3

	)

78 
	#RDB_TYPE_HASH
 4

	)

79 
	#RDB_TYPE_ZSET_2
 5

	)

80 
	#RDB_TYPE_MODULE
 6

	)

84 
	#RDB_TYPE_HASH_ZIPMAP
 9

	)

85 
	#RDB_TYPE_LIST_ZIPLIST
 10

	)

86 
	#RDB_TYPE_SET_INTSET
 11

	)

87 
	#RDB_TYPE_ZSET_ZIPLIST
 12

	)

88 
	#RDB_TYPE_HASH_ZIPLIST
 13

	)

89 
	#RDB_TYPE_LIST_QUICKLIST
 14

	)

93 
	#rdbIsObjeùTy³
(
t
è(Ñ >ğ0 && <ğ6è|| (ˆ>ğ9 && <ğ14))

	)

96 
	#RDB_OPCODE_AUX
 250

	)

97 
	#RDB_OPCODE_RESIZEDB
 251

	)

98 
	#RDB_OPCODE_EXPIRETIME_MS
 252

	)

99 
	#RDB_OPCODE_EXPIRETIME
 253

	)

100 
	#RDB_OPCODE_SELECTDB
 254

	)

101 
	#RDB_OPCODE_EOF
 255

	)

104 
	#RDB_LOAD_NONE
 0

	)

105 
	#RDB_LOAD_ENC
 (1<<0)

	)

106 
	#RDB_LOAD_PLAIN
 (1<<1)

	)

107 
	#RDB_LOAD_SDS
 (1<<2)

	)

109 
	#RDB_SAVE_NONE
 0

	)

110 
	#RDB_SAVE_AOF_PREAMBLE
 (1<<0)

	)

112 
rdbSaveTy³
(
rio
 *
rdb
, 
ty³
);

113 
rdbLßdTy³
(
rio
 *
rdb
);

114 
rdbSaveTime
(
rio
 *
rdb
, 
time_t
 
t
);

115 
time_t
 
rdbLßdTime
(
rio
 *
rdb
);

116 
rdbSaveL’
(
rio
 *
rdb
, 
ušt64_t
 
Ën
);

117 
ušt64_t
 
rdbLßdL’
(
rio
 *
rdb
, *
i£ncoded
);

118 
rdbLßdL’ByRef
(
rio
 *
rdb
, *
i£ncoded
, 
ušt64_t
 *
ËÅŒ
);

119 
rdbSaveObjeùTy³
(
rio
 *
rdb
, 
robj
 *
o
);

120 
rdbLßdObjeùTy³
(
rio
 *
rdb
);

121 
rdbLßd
(*
f’ame
);

122 
rdbSaveBackground
(*
f’ame
);

123 
rdbSaveToSÏvesSock‘s
();

124 
rdbRemoveTempFe
(
pid_t
 
chdpid
);

125 
rdbSave
(*
f’ame
);

126 
ssize_t
 
rdbSaveObjeù
(
rio
 *
rdb
, 
robj
 *
o
);

127 
size_t
 
rdbSavedObjeùL’
(
robj
 *
o
);

128 
robj
 *
rdbLßdObjeù
(
ty³
, 
rio
 *
rdb
);

129 
backgroundSaveDÚeHªdËr
(
ex™code
, 
bysigÇl
);

130 
rdbSaveKeyV®uePaœ
(
rio
 *
rdb
, 
robj
 *
key
,„obj *
v®
, 
expœ‘ime
, 
now
);

131 
robj
 *
rdbLßdSŒšgObjeù
(
rio
 *
rdb
);

132 
rdbSaveSŒšgObjeù
(
rio
 *
rdb
, 
robj
 *
obj
);

133 
ssize_t
 
rdbSaveRawSŒšg
(
rio
 *
rdb
, *
s
, 
size_t
 
Ën
);

134 *
rdbG’”icLßdSŒšgObjeù
(
rio
 *
rdb
, 
æags
, 
size_t
 *
ËÅŒ
);

135 
rdbSaveBš¬yDoubËV®ue
(
rio
 *
rdb
, 
v®
);

136 
rdbLßdBš¬yDoubËV®ue
(
rio
 *
rdb
, *
v®
);

137 
rdbSaveBš¬yFlßtV®ue
(
rio
 *
rdb
, 
v®
);

138 
rdbLßdBš¬yFlßtV®ue
(
rio
 *
rdb
, *
v®
);

139 
rdbLßdRio
(
rio
 *
rdb
);

	@redis-benchmark.c

31 
	~"fmaüos.h
"

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

35 
	~<¡dlib.h
>

36 
	~<uni¡d.h
>

37 
	~<”ºo.h
>

38 
	~<time.h
>

39 
	~<sys/time.h
>

40 
	~<sigÇl.h
>

41 
	~<as£¹.h
>

43 
	~<sds.h
>

44 
	~"«.h
"

45 
	~"hœedis.h
"

46 
	~"adli¡.h
"

47 
	~"zm®loc.h
"

49 
	#UNUSED
(
V
è((èV)

	)

50 
	#RANDPTR_INITIAL_SIZE
 8

	)

52 
	scÚfig
 {

53 
«Ev’tLoİ
 *
	m–
;

54 cÚ¡ *
	mho¡
;

55 
	mho¡pÜt
;

56 cÚ¡ *
	mho¡sock‘
;

57 
	mnumş›Ás
;

58 
	mliveş›Ás
;

59 
	m»que¡s
;

60 
	m»que¡s_issued
;

61 
	m»que¡s_fšished
;

62 
	mkeysize
;

63 
	md©asize
;

64 
	m¿ndomkeys
;

65 
	m¿ndomkeys_key¥aûËn
;

66 
	mk“·live
;

67 
	mp–še
;

68 
	mshow”rÜs
;

69 
	m¡¬t
;

70 
	mtÙÏ‹ncy
;

71 *
	mÏ‹ncy
;

72 cÚ¡ *
	mt™Ë
;

73 
li¡
 *
	mş›Ás
;

74 
	mqu›t
;

75 
	mcsv
;

76 
	mloİ
;

77 
	midËmode
;

78 
	mdbnum
;

79 
sds
 
	mdbnum¡r
;

80 *
	m‹¡s
;

81 *
	mauth
;

82 } 
	gcÚfig
;

84 
	s_ş›Á
 {

85 
»disCÚ‹xt
 *
	mcÚ‹xt
;

86 
sds
 
	mobuf
;

87 **
	m¿nd±r
;

88 
size_t
 
	m¿ndËn
;

89 
size_t
 
	m¿ndä“
;

90 
size_t
 
	mwr™‹n
;

91 
	m¡¬t
;

92 
	mÏ‹ncy
;

93 
	m³ndšg
;

94 
	m´efix_³ndšg
;

97 
	m´efixËn
;

98 } *
	tş›Á
;

101 
wr™eHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

102 
ü—‹MissšgCl›Ás
(
ş›Á
 
c
);

105 
	$u¡ime
() {

106 
timev®
 
tv
;

107 
u¡
;

109 
	`g‘timeofday
(&
tv
, 
NULL
);

110 
u¡
 = (()
tv
.
tv_£c
)*1000000;

111 
u¡
 +ğ
tv
.
tv_u£c
;

112  
u¡
;

113 
	}
}

115 
	$m¡ime
() {

116 
timev®
 
tv
;

117 
m¡
;

119 
	`g‘timeofday
(&
tv
, 
NULL
);

120 
m¡
 = (()
tv
.
tv_£c
)*1000;

121 
m¡
 +ğ
tv
.
tv_u£c
/1000;

122  
m¡
;

123 
	}
}

125 
	$ä“Cl›Á
(
ş›Á
 
c
) {

126 
li¡Node
 *
Ê
;

127 
	`«D–‘eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_WRITABLE
);

128 
	`«D–‘eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_READABLE
);

129 
	`»disF»e
(
c
->
cÚ‹xt
);

130 
	`sdsä“
(
c
->
obuf
);

131 
	`zä“
(
c
->
¿nd±r
);

132 
	`zä“
(
c
);

133 
cÚfig
.
liveş›Ás
--;

134 
Ê
 = 
	`li¡S—rchKey
(
cÚfig
.
ş›Ás
,
c
);

135 
	`as£¹
(
Ê
 !ğ
NULL
);

136 
	`li¡D–Node
(
cÚfig
.
ş›Ás
,
Ê
);

137 
	}
}

139 
	$ä“AÎCl›Ás
() {

140 
li¡Node
 *
Ê
 = 
cÚfig
.
ş›Ás
->
h—d
, *
Ãxt
;

142 
Ê
) {

143 
Ãxt
 = 
Ê
->next;

144 
	`ä“Cl›Á
(
Ê
->
v®ue
);

145 
Ê
 = 
Ãxt
;

147 
	}
}

149 
	$»£tCl›Á
(
ş›Á
 
c
) {

150 
	`«D–‘eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_WRITABLE
);

151 
	`«D–‘eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_READABLE
);

152 
	`«C»©eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_WRITABLE
,
wr™eHªdËr
,c);

153 
c
->
wr™‹n
 = 0;

154 
c
->
³ndšg
 = 
cÚfig
.
p–še
;

155 
	}
}

157 
	$¿ndomizeCl›ÁKey
(
ş›Á
 
c
) {

158 
size_t
 
i
;

160 
i
 = 0; i < 
c
->
¿ndËn
; i++) {

161 *
p
 = 
c
->
¿nd±r
[
i
]+11;

162 
size_t
 
r
 = 
	`¿ndom
(è% 
cÚfig
.
¿ndomkeys_key¥aûËn
;

163 
size_t
 
j
;

165 
j
 = 0; j < 12; j++) {

166 *
p
 = '0'+
r
%10;

167 
r
/=10;

168 
p
--;

171 
	}
}

173 
	$ş›ÁDÚe
(
ş›Á
 
c
) {

174 ià(
cÚfig
.
»que¡s_fšished
 =ğcÚfig.
»que¡s
) {

175 
	`ä“Cl›Á
(
c
);

176 
	`«Stİ
(
cÚfig
.
–
);

179 ià(
cÚfig
.
k“·live
) {

180 
	`»£tCl›Á
(
c
);

182 
cÚfig
.
liveş›Ás
--;

183 
	`ü—‹MissšgCl›Ás
(
c
);

184 
cÚfig
.
liveş›Ás
++;

185 
	`ä“Cl›Á
(
c
);

187 
	}
}

189 
	$»adHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

190 
ş›Á
 
c
 = 
´ivd©a
;

191 *
»¶y
 = 
NULL
;

192 
	`UNUSED
(
–
);

193 
	`UNUSED
(
fd
);

194 
	`UNUSED
(
mask
);

199 ià(
c
->
Ï‹ncy
 < 0èc->Ï‹ncy = 
	`u¡ime
()-(c->
¡¬t
);

201 ià(
	`»disBufãrR—d
(
c
->
cÚ‹xt
è!ğ
REDIS_OK
) {

202 
	`årštf
(
¡d”r
,"E¼Ü: %s\n",
c
->
cÚ‹xt
->
”r¡r
);

203 
	`ex™
(1);

205 
c
->
³ndšg
) {

206 ià(
	`»disG‘R•ly
(
c
->
cÚ‹xt
,&
»¶y
è!ğ
REDIS_OK
) {

207 
	`årštf
(
¡d”r
,"E¼Ü: %s\n",
c
->
cÚ‹xt
->
”r¡r
);

208 
	`ex™
(1);

210 ià(
»¶y
 !ğ
NULL
) {

211 ià(
»¶y
 =ğ(*)
REDIS_REPLY_ERROR
) {

212 
	`årštf
(
¡d”r
,"Unexpectedƒrror„eply,ƒxiting...\n");

213 
	`ex™
(1);

216 ià(
cÚfig
.
show”rÜs
) {

217 
time_t
 
Ï¡”r_time
 = 0;

218 
time_t
 
now
 = 
	`time
(
NULL
);

219 
»disR•ly
 *
r
 = 
»¶y
;

220 ià(
r
->
ty³
 =ğ
REDIS_REPLY_ERROR
 && 
Ï¡”r_time
 !ğ
now
) {

221 
Ï¡”r_time
 = 
now
;

222 
	`´štf
("E¼Ü from s”v”: %s\n", 
r
->
¡r
);

226 
	`ä“R•lyObjeù
(
»¶y
);

228 ià(
c
->
´efix_³ndšg
 > 0) {

229 
c
->
´efix_³ndšg
--;

230 
c
->
³ndšg
--;

232 ià(
c
->
´efixËn
 > 0) {

233 
size_t
 
j
;

234 
	`sd¤ªge
(
c
->
obuf
, c->
´efixËn
, -1);

237 
j
 = 0; j < 
c
->
¿ndËn
; j++)

238 
c
->
¿nd±r
[
j
] -ğc->
´efixËn
;

239 
c
->
´efixËn
 = 0;

244 ià(
cÚfig
.
»que¡s_fšished
 < cÚfig.
»que¡s
)

245 
cÚfig
.
Ï‹ncy
[cÚfig.
»que¡s_fšished
++] = 
c
->latency;

246 
c
->
³ndšg
--;

247 ià(
c
->
³ndšg
 == 0) {

248 
	`ş›ÁDÚe
(
c
);

256 
	}
}

258 
	$wr™eHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

259 
ş›Á
 
c
 = 
´ivd©a
;

260 
	`UNUSED
(
–
);

261 
	`UNUSED
(
fd
);

262 
	`UNUSED
(
mask
);

265 ià(
c
->
wr™‹n
 == 0) {

267 ià(
cÚfig
.
»que¡s_issued
++ >ğcÚfig.
»que¡s
) {

268 
	`ä“Cl›Á
(
c
);

273 ià(
cÚfig
.
¿ndomkeys
è
	`¿ndomizeCl›ÁKey
(
c
);

274 
c
->
¡¬t
 = 
	`u¡ime
();

275 
c
->
Ï‹ncy
 = -1;

278 ià(
	`sd¦’
(
c
->
obuf
è> c->
wr™‹n
) {

279 *
±r
 = 
c
->
obuf
+c->
wr™‹n
;

280 
ssize_t
 
nwr™‹n
 = 
	`wr™e
(
c
->
cÚ‹xt
->
fd
,
±r
,
	`sd¦’
(c->
obuf
)-c->
wr™‹n
);

281 ià(
nwr™‹n
 == -1) {

282 ià(
”ºo
 !ğ
EPIPE
)

283 
	`årštf
(
¡d”r
, "Wr™šgØsock‘: %s\n", 
	`¡»¼Ü
(
”ºo
));

284 
	`ä“Cl›Á
(
c
);

287 
c
->
wr™‹n
 +ğ
nwr™‹n
;

288 ià(
	`sd¦’
(
c
->
obuf
è=ğc->
wr™‹n
) {

289 
	`«D–‘eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_WRITABLE
);

290 
	`«C»©eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_READABLE
,
»adHªdËr
,c);

293 
	}
}

316 
ş›Á
 
	$ü—‹Cl›Á
(*
cmd
, 
size_t
 
Ën
, 
ş›Á
 
äom
) {

317 
j
;

318 
ş›Á
 
c
 = 
	`zm®loc
((
_ş›Á
));

320 ià(
cÚfig
.
ho¡sock‘
 =ğ
NULL
) {

321 
c
->
cÚ‹xt
 = 
	`»disCÚÃùNÚBlock
(
cÚfig
.
ho¡
,cÚfig.
ho¡pÜt
);

323 
c
->
cÚ‹xt
 = 
	`»disCÚÃùUnixNÚBlock
(
cÚfig
.
ho¡sock‘
);

325 ià(
c
->
cÚ‹xt
->
”r
) {

326 
	`årštf
(
¡d”r
,"Could‚ot connecto Redis‡t ");

327 ià(
cÚfig
.
ho¡sock‘
 =ğ
NULL
)

328 
	`årštf
(
¡d”r
,"%s:%d: %s\n",
cÚfig
.
ho¡
,cÚfig.
ho¡pÜt
,
c
->
cÚ‹xt
->
”r¡r
);

330 
	`årštf
(
¡d”r
,"%s: %s\n",
cÚfig
.
ho¡sock‘
,
c
->
cÚ‹xt
->
”r¡r
);

331 
	`ex™
(1);

334 
c
->
cÚ‹xt
->
»ad”
->
maxbuf
 = 0;

339 
c
->
obuf
 = 
	`sd£m±y
();

343 
c
->
´efix_³ndšg
 = 0;

344 ià(
cÚfig
.
auth
) {

345 *
buf
 = 
NULL
;

346 
Ën
 = 
	`»disFÜm©Commªd
(&
buf
, "AUTH %s", 
cÚfig
.
auth
);

347 
c
->
obuf
 = 
	`sdsÿ’
(c->obuf, 
buf
, 
Ën
);

348 
	`ä“
(
buf
);

349 
c
->
´efix_³ndšg
++;

356 ià(
cÚfig
.
dbnum
 != 0) {

357 
c
->
obuf
 = 
	`sdsÿrštf
(c->obuf,"*2\r\n$6\r\nSELECT\r\n$%d\r\n%s\r\n",

358 ()
	`sd¦’
(
cÚfig
.
dbnum¡r
),config.dbnumstr);

359 
c
->
´efix_³ndšg
++;

361 
c
->
´efixËn
 = 
	`sd¦’
(c->
obuf
);

363 ià(
äom
) {

364 
c
->
obuf
 = 
	`sdsÿ’
(c->obuf,

365 
äom
->
obuf
+äom->
´efixËn
,

366 
	`sd¦’
(
äom
->
obuf
)-äom->
´efixËn
);

368 
j
 = 0; j < 
cÚfig
.
p–še
; j++)

369 
c
->
obuf
 = 
	`sdsÿ’
(c->obuf,
cmd
,
Ën
);

372 
c
->
wr™‹n
 = 0;

373 
c
->
³ndšg
 = 
cÚfig
.
p–še
+c->
´efix_³ndšg
;

374 
c
->
¿nd±r
 = 
NULL
;

375 
c
->
¿ndËn
 = 0;

378 ià(
cÚfig
.
¿ndomkeys
) {

379 ià(
äom
) {

380 
c
->
¿ndËn
 = 
äom
->randlen;

381 
c
->
¿ndä“
 = 0;

382 
c
->
¿nd±r
 = 
	`zm®loc
((*)*c->
¿ndËn
);

384 
j
 = 0; j < ()
c
->
¿ndËn
; j++) {

385 
c
->
¿nd±r
[
j
] = c->
obuf
 + (
äom
->randptr[j]-from->obuf);

387 
c
->
¿nd±r
[
j
] +ğc->
´efixËn
 - 
äom
->prefixlen;

390 *
p
 = 
c
->
obuf
;

392 
c
->
¿ndËn
 = 0;

393 
c
->
¿ndä“
 = 
RANDPTR_INITIAL_SIZE
;

394 
c
->
¿nd±r
 = 
	`zm®loc
((*)*c->
¿ndä“
);

395 (
p
 = 
	`¡r¡r
Õ,"__¿nd_št__")è!ğ
NULL
) {

396 ià(
c
->
¿ndä“
 == 0) {

397 
c
->
¿nd±r
 = 
	`z»®loc
(c->¿nd±r,(*)*c->
¿ndËn
*2);

398 
c
->
¿ndä“
 +ğc->
¿ndËn
;

400 
c
->
¿nd±r
[c->
¿ndËn
++] = 
p
;

401 
c
->
¿ndä“
--;

402 
p
 += 12;

406 ià(
cÚfig
.
idËmode
 == 0)

407 
	`«C»©eFeEv’t
(
cÚfig
.
–
,
c
->
cÚ‹xt
->
fd
,
AE_WRITABLE
,
wr™eHªdËr
,c);

408 
	`li¡AddNodeTa
(
cÚfig
.
ş›Ás
,
c
);

409 
cÚfig
.
liveş›Ás
++;

410  
c
;

411 
	}
}

413 
	$ü—‹MissšgCl›Ás
(
ş›Á
 
c
) {

414 
n
 = 0;

416 
cÚfig
.
liveş›Ás
 < cÚfig.
numş›Ás
) {

417 
	`ü—‹Cl›Á
(
NULL
,0,
c
);

420 ià(++
n
 > 64) {

421 
	`u¦“p
(50000);

422 
n
 = 0;

425 
	}
}

427 
	$com·»L©’cy
(cÚ¡ *
a
, cÚ¡ *
b
) {

428  (*(*)
a
)-(*(*)
b
);

429 
	}
}

431 
	$showL©’cyR•Üt
() {

432 
i
, 
cu¾©
 = 0;

433 
³rc
, 
»q³r£c
;

435 
»q³r£c
 = ()
cÚfig
.
»que¡s_fšished
/(()cÚfig.
tÙÏ‹ncy
/1000);

436 ià(!
cÚfig
.
qu›t
 && !cÚfig.
csv
) {

437 
	`´štf
("=====ğ% ======\n", 
cÚfig
.
t™Ë
);

438 
	`´štf
(" %d„eque¡ com¶‘ed iÀ%.2à£cÚds\n", 
cÚfig
.
»que¡s_fšished
,

439 ()
cÚfig
.
tÙÏ‹ncy
/1000);

440 
	`´štf
(" %d…¬®ËÈş›Ás\n", 
cÚfig
.
numş›Ás
);

441 
	`´štf
(" %d by‹ ·ylßd\n", 
cÚfig
.
d©asize
);

442 
	`´štf
(" k“°®ive: %d\n", 
cÚfig
.
k“·live
);

443 
	`´štf
("\n");

445 
	`qsÜt
(
cÚfig
.
Ï‹ncy
,cÚfig.
»que¡s
,(),
com·»L©’cy
);

446 
i
 = 0; i < 
cÚfig
.
»que¡s
; i++) {

447 ià(
cÚfig
.
Ï‹ncy
[
i
]/1000 !ğ
cu¾©
 || i =ğ(cÚfig.
»que¡s
-1)) {

448 
cu¾©
 = 
cÚfig
.
Ï‹ncy
[
i
]/1000;

449 
³rc
 = (()(
i
+1)*100)/
cÚfig
.
»que¡s
;

450 
	`´štf
("%.2f%% <ğ%d mli£cÚds\n", 
³rc
, 
cu¾©
);

453 
	`´štf
("%.2à»que¡ ³¸£cÚd\n\n", 
»q³r£c
);

454 } ià(
cÚfig
.
csv
) {

455 
	`´štf
("\"%s\",\"%.2f\"\n", 
cÚfig
.
t™Ë
, 
»q³r£c
);

457 
	`´štf
("%s: %.2à»que¡ ³¸£cÚd\n", 
cÚfig
.
t™Ë
, 
»q³r£c
);

459 
	}
}

461 
	$b’chm¬k
(*
t™Ë
, *
cmd
, 
Ën
) {

462 
ş›Á
 
c
;

464 
cÚfig
.
t™Ë
 =itle;

465 
cÚfig
.
»que¡s_issued
 = 0;

466 
cÚfig
.
»que¡s_fšished
 = 0;

468 
c
 = 
	`ü—‹Cl›Á
(
cmd
,
Ën
,
NULL
);

469 
	`ü—‹MissšgCl›Ás
(
c
);

471 
cÚfig
.
¡¬t
 = 
	`m¡ime
();

472 
	`«Maš
(
cÚfig
.
–
);

473 
cÚfig
.
tÙÏ‹ncy
 = 
	`m¡ime
()-cÚfig.
¡¬t
;

475 
	`showL©’cyR•Üt
();

476 
	`ä“AÎCl›Ás
();

477 
	}
}

480 
	$·r£O±iÚs
(
¬gc
, cÚ¡ **
¬gv
) {

481 
i
;

482 
Ï¡¬g
;

483 
ex™_¡©us
 = 1;

485 
i
 = 1; i < 
¬gc
; i++) {

486 
Ï¡¬g
 = (
i
 =ğ(
¬gc
-1));

488 ià(!
	`¡rcmp
(
¬gv
[
i
],"-c")) {

489 ià(
Ï¡¬g
è
šv®id
;

490 
cÚfig
.
numş›Ás
 = 
	`©oi
(
¬gv
[++
i
]);

491 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-n")) {

492 ià(
Ï¡¬g
è
šv®id
;

493 
cÚfig
.
»que¡s
 = 
	`©oi
(
¬gv
[++
i
]);

494 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-k")) {

495 ià(
Ï¡¬g
è
šv®id
;

496 
cÚfig
.
k“·live
 = 
	`©oi
(
¬gv
[++
i
]);

497 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-h")) {

498 ià(
Ï¡¬g
è
šv®id
;

499 
cÚfig
.
ho¡
 = 
	`¡rdup
(
¬gv
[++
i
]);

500 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-p")) {

501 ià(
Ï¡¬g
è
šv®id
;

502 
cÚfig
.
ho¡pÜt
 = 
	`©oi
(
¬gv
[++
i
]);

503 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-s")) {

504 ià(
Ï¡¬g
è
šv®id
;

505 
cÚfig
.
ho¡sock‘
 = 
	`¡rdup
(
¬gv
[++
i
]);

506 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-a") ) {

507 ià(
Ï¡¬g
è
šv®id
;

508 
cÚfig
.
auth
 = 
	`¡rdup
(
¬gv
[++
i
]);

509 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-d")) {

510 ià(
Ï¡¬g
è
šv®id
;

511 
cÚfig
.
d©asize
 = 
	`©oi
(
¬gv
[++
i
]);

512 ià(
cÚfig
.
d©asize
 < 1) config.datasize=1;

513 ià(
cÚfig
.
d©asize
 > 1024*1024*1024) config.datasize = 1024*1024*1024;

514 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-P")) {

515 ià(
Ï¡¬g
è
šv®id
;

516 
cÚfig
.
p–še
 = 
	`©oi
(
¬gv
[++
i
]);

517 ià(
cÚfig
.
p–še
 <= 0) config.pipeline=1;

518 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-r")) {

519 ià(
Ï¡¬g
è
šv®id
;

520 
cÚfig
.
¿ndomkeys
 = 1;

521 
cÚfig
.
¿ndomkeys_key¥aûËn
 = 
	`©oi
(
¬gv
[++
i
]);

522 ià(
cÚfig
.
¿ndomkeys_key¥aûËn
 < 0)

523 
cÚfig
.
¿ndomkeys_key¥aûËn
 = 0;

524 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-q")) {

525 
cÚfig
.
qu›t
 = 1;

526 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--csv")) {

527 
cÚfig
.
csv
 = 1;

528 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-l")) {

529 
cÚfig
.
loİ
 = 1;

530 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-I")) {

531 
cÚfig
.
idËmode
 = 1;

532 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-e")) {

533 
cÚfig
.
show”rÜs
 = 1;

534 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-t")) {

535 ià(
Ï¡¬g
è
šv®id
;

541 
cÚfig
.
‹¡s
 = 
	`sd¢ew
(",");

542 
cÚfig
.
‹¡s
 = 
	`sdsÿt
(cÚfig.‹¡s,(*)
¬gv
[++
i
]);

543 
cÚfig
.
‹¡s
 = 
	`sdsÿt
(config.tests,",");

544 
	`sd¡Şow”
(
cÚfig
.
‹¡s
);

545 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--dbnum")) {

546 ià(
Ï¡¬g
è
šv®id
;

547 
cÚfig
.
dbnum
 = 
	`©oi
(
¬gv
[++
i
]);

548 
cÚfig
.
dbnum¡r
 = 
	`sdsäomlÚglÚg
(cÚfig.
dbnum
);

549 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--help")) {

550 
ex™_¡©us
 = 0;

551 
u§ge
;

556 ià(
¬gv
[
i
][0] =ğ'-'è
šv®id
;

557  
i
;

561  
i
;

563 
šv®id
:

564 
	`´štf
("Inv®id o±iÚ \"%s\" o¸İtiÚ‡rgum’ˆmissšg\n\n",
¬gv
[
i
]);

566 
u§ge
:

567 
	`´štf
(

609 
	`ex™
(
ex™_¡©us
);

610 
	}
}

612 
	$showThroughput
(
«Ev’tLoİ
 *
ev’tLoİ
, 
id
, *
ş›ÁD©a
) {

613 
	`UNUSED
(
ev’tLoİ
);

614 
	`UNUSED
(
id
);

615 
	`UNUSED
(
ş›ÁD©a
);

617 ià(
cÚfig
.
liveş›Ás
 == 0) {

618 
	`årštf
(
¡d”r
,"All clients disconnected...‡borting.\n");

619 
	`ex™
(1);

621 ià(
cÚfig
.
csv
)  250;

622 ià(
cÚfig
.
idËmode
 == 1) {

623 
	`´štf
("ş›Ás: %d\r", 
cÚfig
.
liveş›Ás
);

624 
	`fæush
(
¡dout
);

627 
dt
 = ()(
	`m¡ime
()-
cÚfig
.
¡¬t
)/1000.0;

628 
½s
 = ()
cÚfig
.
»que¡s_fšished
/
dt
;

629 
	`´štf
("%s: %.2f\r", 
cÚfig
.
t™Ë
, 
½s
);

630 
	`fæush
(
¡dout
);

632 
	}
}

636 
	$‹¡_is_£Ëùed
(*
Çme
) {

637 
buf
[256];

638 
l
 = 
	`¡¾’
(
Çme
);

640 ià(
cÚfig
.
‹¡s
 =ğ
NULL
)  1;

641 
buf
[0] = ',';

642 
	`memıy
(
buf
+1,
Çme
,
l
);

643 
buf
[
l
+1] = ',';

644 
buf
[
l
+2] = '\0';

645  
	`¡r¡r
(
cÚfig
.
‹¡s
,
buf
è!ğ
NULL
;

646 
	}
}

648 
	$maš
(
¬gc
, cÚ¡ **
¬gv
) {

649 
i
;

650 *
d©a
, *
cmd
;

651 
Ën
;

653 
ş›Á
 
c
;

655 
	`¤ªdom
(
	`time
(
NULL
));

656 
	`sigÇl
(
SIGHUP
, 
SIG_IGN
);

657 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

659 
cÚfig
.
numş›Ás
 = 50;

660 
cÚfig
.
»que¡s
 = 100000;

661 
cÚfig
.
liveş›Ás
 = 0;

662 
cÚfig
.
–
 = 
	`«C»©eEv’tLoİ
(1024*10);

663 
	`«C»©eTimeEv’t
(
cÚfig
.
–
,1,
showThroughput
,
NULL
,NULL);

664 
cÚfig
.
k“·live
 = 1;

665 
cÚfig
.
d©asize
 = 3;

666 
cÚfig
.
p–še
 = 1;

667 
cÚfig
.
show”rÜs
 = 0;

668 
cÚfig
.
¿ndomkeys
 = 0;

669 
cÚfig
.
¿ndomkeys_key¥aûËn
 = 0;

670 
cÚfig
.
qu›t
 = 0;

671 
cÚfig
.
csv
 = 0;

672 
cÚfig
.
loİ
 = 0;

673 
cÚfig
.
idËmode
 = 0;

674 
cÚfig
.
Ï‹ncy
 = 
NULL
;

675 
cÚfig
.
ş›Ás
 = 
	`li¡C»©e
();

676 
cÚfig
.
ho¡
 = "127.0.0.1";

677 
cÚfig
.
ho¡pÜt
 = 6379;

678 
cÚfig
.
ho¡sock‘
 = 
NULL
;

679 
cÚfig
.
‹¡s
 = 
NULL
;

680 
cÚfig
.
dbnum
 = 0;

681 
cÚfig
.
auth
 = 
NULL
;

683 
i
 = 
	`·r£O±iÚs
(
¬gc
,
¬gv
);

684 
¬gc
 -ğ
i
;

685 
¬gv
 +ğ
i
;

687 
cÚfig
.
Ï‹ncy
 = 
	`zm®loc
(()*cÚfig.
»que¡s
);

689 ià(
cÚfig
.
k“·live
 == 0) {

690 
	`´štf
("WARNING: keepalive disabled, you…robably‚eed 'echo 1 > /proc/sys/net/ipv4/tcp_tw_reuse' for Linux‡nd 'sudo sysctl -w‚et.inet.tcp.msl=1000' for Mac OS X in ordero use‡†ot of clients/requests\n");

693 ià(
cÚfig
.
idËmode
) {

694 
	`´štf
("C»©šg %d idË cÚÃùiÚ ªd wa™šg fÜev” (CŒl+C wh’ dÚe)\n", 
cÚfig
.
numş›Ás
);

695 
c
 = 
	`ü—‹Cl›Á
("",0,
NULL
);

696 
	`ü—‹MissšgCl›Ás
(
c
);

697 
	`«Maš
(
cÚfig
.
–
);

702 ià(
¬gc
) {

703 
sds
 
t™Ë
 = 
	`sd¢ew
(
¬gv
[0]);

704 
i
 = 1; i < 
¬gc
; i++) {

705 
t™Ë
 = 
	`sdsÿ’
(title, " ", 1);

706 
t™Ë
 = 
	`sdsÿ’
Ñ™Ë, (*)
¬gv
[
i
], 
	`¡¾’
(argv[i]));

710 
Ën
 = 
	`»disFÜm©CommªdArgv
(&
cmd
,
¬gc
,
¬gv
,
NULL
);

711 
	`b’chm¬k
(
t™Ë
,
cmd
,
Ën
);

712 
	`ä“
(
cmd
);

713 } 
cÚfig
.
loİ
);

719 
d©a
 = 
	`zm®loc
(
cÚfig
.
d©asize
+1);

721 
	`mem£t
(
d©a
,'x',
cÚfig
.
d©asize
);

722 
d©a
[
cÚfig
.
d©asize
] = '\0';

724 ià(
	`‹¡_is_£Ëùed
("ping_inline") ||est_is_selected("ping"))

725 
	`b’chm¬k
("PING_INLINE","PING\r\n",6);

727 ià(
	`‹¡_is_£Ëùed
("ping_mbulk") ||est_is_selected("ping")) {

728 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"PING");

729 
	`b’chm¬k
("PING_BULK",
cmd
,
Ën
);

730 
	`ä“
(
cmd
);

732 ià(
	`‹¡_is_£Ëùed
("set")) {

733 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"SET key:__¿nd_št__ %s",
d©a
);

734 
	`b’chm¬k
("SET",
cmd
,
Ën
);

735 
	`ä“
(
cmd
);

739 ià(
	`‹¡_is_£Ëùed
("get")) {

740 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"GET key:__rand_int__");

741 
	`b’chm¬k
("GET",
cmd
,
Ën
);

742 
	`ä“
(
cmd
);

745 ià(
	`‹¡_is_£Ëùed
("incr")) {

746 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"INCR counter:__rand_int__");

747 
	`b’chm¬k
("INCR",
cmd
,
Ën
);

748 
	`ä“
(
cmd
);

751 ià(
	`‹¡_is_£Ëùed
("lpush")) {

752 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LPUSH myli¡ %s",
d©a
);

753 
	`b’chm¬k
("LPUSH",
cmd
,
Ën
);

754 
	`ä“
(
cmd
);

757 ià(
	`‹¡_is_£Ëùed
("rpush")) {

758 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"RPUSH myli¡ %s",
d©a
);

759 
	`b’chm¬k
("RPUSH",
cmd
,
Ën
);

760 
	`ä“
(
cmd
);

763 ià(
	`‹¡_is_£Ëùed
("lpop")) {

764 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LPOP mylist");

765 
	`b’chm¬k
("LPOP",
cmd
,
Ën
);

766 
	`ä“
(
cmd
);

769 ià(
	`‹¡_is_£Ëùed
("rpop")) {

770 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"RPOP mylist");

771 
	`b’chm¬k
("RPOP",
cmd
,
Ën
);

772 
	`ä“
(
cmd
);

774 ià(
	`‹¡_is_£Ëùed
("sadd")) {

775 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,

777 
	`b’chm¬k
("SADD",
cmd
,
Ën
);

780 ià(
	`‹¡_is_£Ëùed
("spop")) {

781 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"SPOP myset");

782 
	`b’chm¬k
("SPOP",
cmd
,
Ën
);

783 
	`ä“
(
cmd
);

786 ià(
	`‹¡_is_£Ëùed
("lrange") ||

787 
	`‹¡_is_£Ëùed
("lrange_100") ||

788 
	`‹¡_is_£Ëùed
("lrange_300") ||

789 
	`‹¡_is_£Ëùed
("lrange_500") ||

790 
	`‹¡_is_£Ëùed
("lrange_600"))

792 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LPUSH myli¡ %s",
d©a
);

793 
	`b’chm¬k
("LPUSH (ÃededØb’chm¬k LRANGE)",
cmd
,
Ën
);

794 
	`ä“
(
cmd
);

797 ià(
	`‹¡_is_£Ëùed
("lrange") ||est_is_selected("lrange_100")) {

798 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LRANGE mylist 0 99");

799 
	`b’chm¬k
("LRANGE_100 (fœ¡ 100ƒËm’ts)",
cmd
,
Ën
);

800 
	`ä“
(
cmd
);

803 ià(
	`‹¡_is_£Ëùed
("lrange") ||est_is_selected("lrange_300")) {

804 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LRANGE mylist 0 299");

805 
	`b’chm¬k
("LRANGE_300 (fœ¡ 300ƒËm’ts)",
cmd
,
Ën
);

806 
	`ä“
(
cmd
);

809 ià(
	`‹¡_is_£Ëùed
("lrange") ||est_is_selected("lrange_500")) {

810 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LRANGE mylist 0 449");

811 
	`b’chm¬k
("LRANGE_500 (fœ¡ 450ƒËm’ts)",
cmd
,
Ën
);

812 
	`ä“
(
cmd
);

815 ià(
	`‹¡_is_£Ëùed
("lrange") ||est_is_selected("lrange_600")) {

816 
Ën
 = 
	`»disFÜm©Commªd
(&
cmd
,"LRANGE mylist 0 599");

817 
	`b’chm¬k
("LRANGE_600 (fœ¡ 600ƒËm’ts)",
cmd
,
Ën
);

818 
	`ä“
(
cmd
);

821 ià(
	`‹¡_is_£Ëùed
("mset")) {

822 cÚ¡ *
¬gv
[21];

823 
¬gv
[0] = "MSET";

824 
i
 = 1; i < 21; i += 2) {

825 
¬gv
[
i
] = "key:__rand_int__";

826 
¬gv
[
i
+1] = 
d©a
;

828 
Ën
 = 
	`»disFÜm©CommªdArgv
(&
cmd
,21,
¬gv
,
NULL
);

829 
	`b’chm¬k
("MSET (10 keys)",
cmd
,
Ën
);

830 
	`ä“
(
cmd
);

833 ià(!
cÚfig
.
csv
è
	`´štf
("\n");

834 } 
cÚfig
.
loİ
);

837 
	}
}

	@redis-check-aof.c

31 
	~"fmaüos.h
"

32 
	~<¡dlib.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

35 
	~<uni¡d.h
>

36 
	~<sys/¡©.h
>

37 
	~"cÚfig.h
"

39 
	#ERROR
(...) { \

40 
__buf
[1024]; \

41 
	`¥rštf
(
__buf
, 
__VA_ARGS__
); \

42 
	`¥rštf
(
”rÜ
, "0x%16Îx: %s", ()
•os
, 
__buf
); \

43 }

	)

45 
	g”rÜ
[1024];

46 
off_t
 
	g•os
;

48 
	$cÚsumeNewlše
(*
buf
) {

49 ià(
	`¡ºcmp
(
buf
,"\r\n",2) != 0) {

50 
	`ERROR
("Ex³ùed \\r\\n, gÙ: %02x%02x",
buf
[0],buf[1]);

54 
	}
}

56 
	$»adLÚg
(
FILE
 *
å
, 
´efix
, *
rg‘
) {

57 
buf
[128], *
•Œ
;

58 
•os
 = 
	`á–lo
(
å
);

59 ià(
	`fg‘s
(
buf
,(buf),
å
è=ğ
NULL
) {

62 ià(
buf
[0] !ğ
´efix
) {

63 
	`ERROR
("Ex³ùed…»fix '%c', gÙ: '%c'",
buf
[0],
´efix
);

66 *
rg‘
 = 
	`¡¹Ş
(
buf
+1,&
•Œ
,10);

67  
	`cÚsumeNewlše
(
•Œ
);

68 
	}
}

70 
	$»adBy‹s
(
FILE
 *
å
, *
rg‘
, 
Ëngth
) {

71 
»®
;

72 
•os
 = 
	`á–lo
(
å
);

73 
»®
 = 
	`ä—d
(
rg‘
,1,
Ëngth
,
å
);

74 ià(
»®
 !ğ
Ëngth
) {

75 
	`ERROR
("Ex³ùedØ»ad %ld by‹s, gÙ %ld by‹s",
Ëngth
,
»®
);

79 
	}
}

81 
	$»adSŒšg
(
FILE
 *
å
, ** 
rg‘
) {

82 
Ën
;

83 *
rg‘
 = 
NULL
;

84 ià(!
	`»adLÚg
(
å
,'$',&
Ën
)) {

89 
Ën
 += 2;

90 *
rg‘
 = (*)
	`m®loc
(
Ën
);

91 ià(!
	`»adBy‹s
(
å
,*
rg‘
,
Ën
)) {

94 ià(!
	`cÚsumeNewlše
(*
rg‘
+
Ën
-2)) {

97 (*
rg‘
)[
Ën
-2] = '\0';

99 
	}
}

101 
	$»adArgc
(
FILE
 *
å
, *
rg‘
) {

102  
	`»adLÚg
(
å
,'*',
rg‘
);

103 
	}
}

105 
off_t
 
	$´oûss
(
FILE
 *
å
) {

106 
¬gc
;

107 
off_t
 
pos
 = 0;

108 
i
, 
muÉi
 = 0;

109 *
¡r
;

112 ià(!
muÉi
è
pos
 = 
	`á–lo
(
å
);

113 ià(!
	`»adArgc
(
å
, &
¬gc
)) ;

115 
i
 = 0; i < 
¬gc
; i++) {

116 ià(!
	`»adSŒšg
(
å
,&
¡r
)) ;

117 ià(
i
 == 0) {

118 ià(
	`¡rÿ£cmp
(
¡r
, "multi") == 0) {

119 ià(
muÉi
++) {

120 
	`ERROR
("Unexpected MULTI");

123 } ià(
	`¡rÿ£cmp
(
¡r
, "exec") == 0) {

124 ià(--
muÉi
) {

125 
	`ERROR
("Unexpected EXEC");

130 
	`ä“
(
¡r
);

134 ià(
i
 < 
¬gc
) {

135 ià(
¡r
è
	`ä“
(str);

140 ià(
	`ãof
(
å
è&& 
muÉi
 && 
	`¡¾’
(
”rÜ
) == 0) {

141 
	`ERROR
("Reached EOF before„eading EXEC for MULTI");

143 ià(
	`¡¾’
(
”rÜ
) > 0) {

144 
	`´štf
("%s\n", 
”rÜ
);

146  
pos
;

147 
	}
}

149 
	$maš
(
¬gc
, **
¬gv
) {

150 *
f’ame
;

151 
fix
 = 0;

153 ià(
¬gc
 < 2) {

154 
	`´štf
("U§ge: % [--fix] <fe.aof>\n", 
¬gv
[0]);

155 
	`ex™
(1);

156 } ià(
¬gc
 == 2) {

157 
f’ame
 = 
¬gv
[1];

158 } ià(
¬gc
 == 3) {

159 ià(
	`¡rcmp
(
¬gv
[1],"--fix") != 0) {

160 
	`´štf
("Inv®id‡rgum’t: %s\n", 
¬gv
[1]);

161 
	`ex™
(1);

163 
f’ame
 = 
¬gv
[2];

164 
fix
 = 1;

166 
	`´štf
("Invalid‡rguments\n");

167 
	`ex™
(1);

170 
FILE
 *
å
 = 
	`fİ’
(
f’ame
,"r+");

171 ià(
å
 =ğ
NULL
) {

172 
	`´štf
("CªnÙ o³Àfe: %s\n", 
f’ame
);

173 
	`ex™
(1);

176 
»dis_¡©
 
sb
;

177 ià(
	`»dis_f¡©
(
	`f’o
(
å
),&
sb
) == -1) {

178 
	`´štf
("CªnÙ sˆfe: %s\n", 
f’ame
);

179 
	`ex™
(1);

182 
off_t
 
size
 = 
sb
.
¡_size
;

183 ià(
size
 == 0) {

184 
	`´štf
("Em±y fe: %s\n", 
f’ame
);

185 
	`ex™
(1);

188 
off_t
 
pos
 = 
	`´oûss
(
å
);

189 
off_t
 
diff
 = 
size
-
pos
;

190 
	`´štf
("AOF‡nalyzed: size=%lld, ok_up_to=%lld, diff=%lld\n",

191 (è
size
, (è
pos
, (è
diff
);

192 ià(
diff
 > 0) {

193 ià(
fix
) {

194 
buf
[2];

195 
	`´štf
("Thi wÈshrškhAOF from %Îd by‹s, w™h %Îd by‹s,Ø%Îd by‹s\n",()
size
,()
diff
,()
pos
);

196 
	`´štf
("Continue? [y/N]: ");

197 ià(
	`fg‘s
(
buf
,(buf),
¡dš
è=ğ
NULL
 ||

198 
	`¡ºÿ£cmp
(
buf
,"y",1) != 0) {

199 
	`´štf
("Aborting...\n");

200 
	`ex™
(1);

202 ià(
	`árunÿ‹
(
	`f’o
(
å
), 
pos
) == -1) {

203 
	`´štf
("Failedoruncate AOF\n");

204 
	`ex™
(1);

206 
	`´štf
("Successfullyruncated AOF\n");

209 
	`´štf
("AOF is‚ot valid\n");

210 
	`ex™
(1);

213 
	`´štf
("AOF is valid\n");

216 
	`fşo£
(
å
);

218 
	}
}

	@redis-check-rdb.c

30 
	~"£rv”.h
"

31 
	~"rdb.h
"

33 
	~<¡d¬g.h
>

35 
ü—‹Sh¬edObjeùs
();

36 
rdbLßdProg»ssC®lback
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
);

37 
rdbLßdMli£cÚdTime
(
rio
 *
rdb
);

38 
	grdbCheckMode
 = 0;

41 
rio
 *
	mrio
;

42 
robj
 *
	mkey
;

43 
	mkey_ty³
;

44 
	mkeys
;

45 
	mexpœes
;

46 
	m®»ady_expœed
;

47 
	mdošg
;

48 
	m”rÜ_£t
;

49 
	m”rÜ
[1024];

50 } 
	grdb¡©e
;

54 
	#RDB_CHECK_DOING_START
 0

	)

55 
	#RDB_CHECK_DOING_READ_TYPE
 1

	)

56 
	#RDB_CHECK_DOING_READ_EXPIRE
 2

	)

57 
	#RDB_CHECK_DOING_READ_KEY
 3

	)

58 
	#RDB_CHECK_DOING_READ_OBJECT_VALUE
 4

	)

59 
	#RDB_CHECK_DOING_CHECK_SUM
 5

	)

60 
	#RDB_CHECK_DOING_READ_LEN
 6

	)

61 
	#RDB_CHECK_DOING_READ_AUX
 7

	)

63 *
	grdb_check_došg_¡ršg
[] = {

74 *
	grdb_ty³_¡ršg
[] = {

92 
	$rdbShowG’”icInfo
() {

93 
	`´štf
("[šfo] %lu key »ad\n", 
rdb¡©e
.
keys
);

94 
	`´štf
("[šfo] %luƒxpœes\n", 
rdb¡©e
.
expœes
);

95 
	`´štf
("[šfo] %lu‡Ì—dyƒxpœed\n", 
rdb¡©e
.
®»ady_expœed
);

96 
	}
}

100 
	$rdbCheckE¼Ü
(cÚ¡ *
fmt
, ...) {

101 
msg
[1024];

102 
va_li¡
 
­
;

104 
	`va_¡¬t
(
­
, 
fmt
);

105 
	`v¢´štf
(
msg
, (msg), 
fmt
, 
­
);

106 
	`va_’d
(
­
);

108 
	`´štf
("--- RDB ERROR DETECTED ---\n");

109 
	`´štf
("[offset %llu] %s\n",

110 (è(
rdb¡©e
.
rio
 ?

111 
rdb¡©e
.
rio
->
´oûs£d_by‹s
 : 0), 
msg
);

112 
	`´štf
("[additional info] While doing: %s\n",

113 
rdb_check_došg_¡ršg
[
rdb¡©e
.
došg
]);

114 ià(
rdb¡©e
.
key
)

115 
	`´štf
("[additional info] Reading key '%s'\n",

116 (*)
rdb¡©e
.
key
->
±r
);

117 ià(
rdb¡©e
.
key_ty³
 != -1)

118 
	`´štf
("[additional info] Readingype %d (%s)\n",

119 
rdb¡©e
.
key_ty³
,

120 (()
rdb¡©e
.
key_ty³
 <

121 (
rdb_ty³_¡ršg
)/(*)) ?

122 
rdb_ty³_¡ršg
[
rdb¡©e
.
key_ty³
] : "unknown");

123 
	`rdbShowG’”icInfo
();

124 
	}
}

127 
	$rdbCheckInfo
(cÚ¡ *
fmt
, ...) {

128 
msg
[1024];

129 
va_li¡
 
­
;

131 
	`va_¡¬t
(
­
, 
fmt
);

132 
	`v¢´štf
(
msg
, (msg), 
fmt
, 
­
);

133 
	`va_’d
(
­
);

135 
	`´štf
("[offset %llu] %s\n",

136 (è(
rdb¡©e
.
rio
 ?

137 
rdb¡©e
.
rio
->
´oûs£d_by‹s
 : 0), 
msg
);

138 
	}
}

142 
	$rdbCheckS‘E¼Ü
(cÚ¡ *
fmt
, ...) {

143 
va_li¡
 
­
;

145 
	`va_¡¬t
(
­
, 
fmt
);

146 
	`v¢´štf
(
rdb¡©e
.
”rÜ
, Ôdb¡©e.”rÜ), 
fmt
, 
­
);

147 
	`va_’d
(
­
);

148 
rdb¡©e
.
”rÜ_£t
 = 1;

149 
	}
}

154 
	$rdbCheckHªdËC¿sh
(
sig
, 
sigšfo_t
 *
šfo
, *
£ü‘
) {

155 
	`UNUSED
(
sig
);

156 
	`UNUSED
(
šfo
);

157 
	`UNUSED
(
£ü‘
);

159 
	`rdbCheckE¼Ü
("Server crash checkinghe specified RDB file!");

160 
	`ex™
(1);

161 
	}
}

163 
	$rdbCheckS‘upSigÇls
() {

164 
sigaùiÚ
 
aù
;

166 
	`sigem±y£t
(&
aù
.
§_mask
);

167 
aù
.
§_æags
 = 
SA_NODEFER
 | 
SA_RESETHAND
 | 
SA_SIGINFO
;

168 
aù
.
§_sigaùiÚ
 = 
rdbCheckHªdËC¿sh
;

169 
	`sigaùiÚ
(
SIGSEGV
, &
aù
, 
NULL
);

170 
	`sigaùiÚ
(
SIGBUS
, &
aù
, 
NULL
);

171 
	`sigaùiÚ
(
SIGFPE
, &
aù
, 
NULL
);

172 
	`sigaùiÚ
(
SIGILL
, &
aù
, 
NULL
);

173 
	}
}

177 
	$»dis_check_rdb
(*
rdbf’ame
) {

178 
ušt64_t
 
dbid
;

179 
ty³
, 
rdbv”
;

180 
buf
[1024];

181 
expœ‘ime
, 
now
 = 
	`m¡ime
();

182 
FILE
 *
å
;

183 
rio
 
rdb
;

185 ià((
å
 = 
	`fİ’
(
rdbf’ame
,"r")è=ğ
NULL
)  1;

187 
	`rioIn™W™hFe
(&
rdb
,
å
);

188 
rdb¡©e
.
rio
 = &
rdb
;

189 
rdb
.
upd©e_cksum
 = 
rdbLßdProg»ssC®lback
;

190 ià(
	`rioR—d
(&
rdb
,
buf
,9è=ğ0è
eoã¼
;

191 
buf
[9] = '\0';

192 ià(
	`memcmp
(
buf
,"REDIS",5) != 0) {

193 
	`rdbCheckE¼Ü
("Wrong signatureryingo†oad DB from file");

196 
rdbv”
 = 
	`©oi
(
buf
+5);

197 ià(
rdbv”
 < 1 ||„dbv” > 
RDB_VERSION
) {

198 
	`rdbCheckE¼Ü
("Cª'ˆhªdË RDB fÜm© v”siÚ %d",
rdbv”
);

202 
	`¡¬tLßdšg
(
å
);

204 
robj
 *
key
, *
v®
;

205 
expœ‘ime
 = -1;

208 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_TYPE
;

209 ià((
ty³
 = 
	`rdbLßdTy³
(&
rdb
)è=ğ-1è
eoã¼
;

212 ià(
ty³
 =ğ
RDB_OPCODE_EXPIRETIME
) {

213 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_EXPIRE
;

217 ià((
expœ‘ime
 = 
	`rdbLßdTime
(&
rdb
)è=ğ-1è
eoã¼
;

219 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_TYPE
;

220 ià((
ty³
 = 
	`rdbLßdTy³
(&
rdb
)è=ğ-1è
eoã¼
;

223 
expœ‘ime
 *= 1000;

224 } ià(
ty³
 =ğ
RDB_OPCODE_EXPIRETIME_MS
) {

227 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_EXPIRE
;

228 ià((
expœ‘ime
 = 
	`rdbLßdMli£cÚdTime
(&
rdb
)è=ğ-1è
eoã¼
;

230 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_TYPE
;

231 ià((
ty³
 = 
	`rdbLßdTy³
(&
rdb
)è=ğ-1è
eoã¼
;

232 } ià(
ty³
 =ğ
RDB_OPCODE_EOF
) {

235 } ià(
ty³
 =ğ
RDB_OPCODE_SELECTDB
) {

237 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_LEN
;

238 ià((
dbid
 = 
	`rdbLßdL’
(&
rdb
,
NULL
)è=ğ
RDB_LENERR
)

239 
eoã¼
;

240 
	`rdbCheckInfo
("S–eùšg DB ID %d", 
dbid
);

242 } ià(
ty³
 =ğ
RDB_OPCODE_RESIZEDB
) {

245 
ušt64_t
 
db_size
, 
expœes_size
;

246 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_LEN
;

247 ià((
db_size
 = 
	`rdbLßdL’
(&
rdb
,
NULL
)è=ğ
RDB_LENERR
)

248 
eoã¼
;

249 ià((
expœes_size
 = 
	`rdbLßdL’
(&
rdb
,
NULL
)è=ğ
RDB_LENERR
)

250 
eoã¼
;

252 } ià(
ty³
 =ğ
RDB_OPCODE_AUX
) {

258 
robj
 *
auxkey
, *
auxv®
;

259 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_AUX
;

260 ià((
auxkey
 = 
	`rdbLßdSŒšgObjeù
(&
rdb
)è=ğ
NULL
è
eoã¼
;

261 ià((
auxv®
 = 
	`rdbLßdSŒšgObjeù
(&
rdb
)è=ğ
NULL
è
eoã¼
;

263 
	`rdbCheckInfo
("AUX FIELD %s = '%s'",

264 (*)
auxkey
->
±r
, (*)
auxv®
->ptr);

265 
	`deüRefCouÁ
(
auxkey
);

266 
	`deüRefCouÁ
(
auxv®
);

269 ià(!
	`rdbIsObjeùTy³
(
ty³
)) {

270 
	`rdbCheckE¼Ü
("Inv®id objeùy³: %d", 
ty³
);

273 
rdb¡©e
.
key_ty³
 = 
ty³
;

277 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_KEY
;

278 ià((
key
 = 
	`rdbLßdSŒšgObjeù
(&
rdb
)è=ğ
NULL
è
eoã¼
;

279 
rdb¡©e
.
key
 = key;

280 
rdb¡©e
.
keys
++;

282 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_READ_OBJECT_VALUE
;

283 ià((
v®
 = 
	`rdbLßdObjeù
(
ty³
,&
rdb
)è=ğ
NULL
è
eoã¼
;

289 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
 && 
expœ‘ime
 !ğ-1 &&ƒxpœ‘im< 
now
)

290 
rdb¡©e
.
®»ady_expœed
++;

291 ià(
expœ‘ime
 !ğ-1è
rdb¡©e
.
expœes
++;

292 
rdb¡©e
.
key
 = 
NULL
;

293 
	`deüRefCouÁ
(
key
);

294 
	`deüRefCouÁ
(
v®
);

295 
rdb¡©e
.
key_ty³
 = -1;

298 ià(
rdbv”
 >ğ5 && 
£rv”
.
rdb_checksum
) {

299 
ušt64_t
 
cksum
, 
ex³ùed
 = 
rdb
.cksum;

301 
rdb¡©e
.
došg
 = 
RDB_CHECK_DOING_CHECK_SUM
;

302 ià(
	`rioR—d
(&
rdb
,&
cksum
,8è=ğ0è
eoã¼
;

303 
	`mem»v64ifbe
(&
cksum
);

304 ià(
cksum
 == 0) {

305 
	`rdbCheckInfo
("RDB file was saved with checksum disabled:‚o check…erformed.");

306 } ià(
cksum
 !ğ
ex³ùed
) {

307 
	`rdbCheckE¼Ü
("RDB CRCƒrror");

309 
	`rdbCheckInfo
("Checksum OK");

313 
	`fşo£
(
å
);

316 
eoã¼
:

317 ià(
rdb¡©e
.
”rÜ_£t
) {

318 
	`rdbCheckE¼Ü
(
rdb¡©e
.
”rÜ
);

320 
	`rdbCheckE¼Ü
("Unexpected EOF„eading RDB file");

323 
	}
}

330 
	$»dis_check_rdb_maš
(
¬gc
, **
¬gv
) {

331 ià(
¬gc
 != 2) {

332 
	`årštf
(
¡d”r
, "U§ge: % <rdb-fe-Çme>\n", 
¬gv
[0]);

333 
	`ex™
(1);

338 ià(
sh¬ed
.
š‹g”s
[0] =ğ
NULL
)

339 
	`ü—‹Sh¬edObjeùs
();

340 
£rv”
.
lßdšg_´oûss_ev’ts_š‹rv®_by‹s
 = 0;

341 
rdbCheckMode
 = 1;

342 
	`rdbCheckInfo
("Checkšg RDB f%s", 
¬gv
[1]);

343 
	`rdbCheckS‘upSigÇls
();

344 
»tv®
 = 
	`»dis_check_rdb
(
¬gv
[1]);

345 ià(
»tv®
 == 0) {

346 
	`rdbCheckInfo
("\\o/ RDB†ooks OK! \\o/");

347 
	`rdbShowG’”icInfo
();

349 
	`ex™
(
»tv®
);

350 
	}
}

	@redis-cli.c

31 
	~"fmaüos.h
"

32 
	~"v”siÚ.h
"

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

36 
	~<¡dlib.h
>

37 
	~<sigÇl.h
>

38 
	~<uni¡d.h
>

39 
	~<time.h
>

40 
	~<ùy³.h
>

41 
	~<”ºo.h
>

42 
	~<sys/¡©.h
>

43 
	~<sys/time.h
>

44 
	~<as£¹.h
>

45 
	~<fú.h
>

46 
	~<lim™s.h
>

47 
	~<m©h.h
>

49 
	~<hœedis.h
>

50 
	~<sds.h
>

51 
	~"zm®loc.h
"

52 
	~"lš’oi£.h
"

53 
	~"h–p.h
"

54 
	~"ª‘.h
"

55 
	~"«.h
"

57 
	#UNUSED
(
V
è((èV)

	)

59 
	#OUTPUT_STANDARD
 0

	)

60 
	#OUTPUT_RAW
 1

	)

61 
	#OUTPUT_CSV
 2

	)

62 
	#REDIS_CLI_KEEPALIVE_INTERVAL
 15

	)

63 
	#REDIS_CLI_DEFAULT_PIPE_TIMEOUT
 30

	)

64 
	#REDIS_CLI_HISTFILE_ENV
 "REDISCLI_HISTFILE"

	)

65 
	#REDIS_CLI_HISTFILE_DEFAULT
 ".»disşi_hi¡Üy"

	)

66 
	#REDIS_CLI_RCFILE_ENV
 "REDISCLI_RCFILE"

	)

67 
	#REDIS_CLI_RCFILE_DEFAULT
 ".»disşœc"

	)

70 
	g¥eùrum_·Ë‰e_cŞÜ_size
 = 19;

71 
	g¥eùrum_·Ë‰e_cŞÜ
[] = {0,233,234,235,237,239,241,243,245,247,144,143,142,184,226,214,208,202,196};

73 
	g¥eùrum_·Ë‰e_mÚo_size
 = 13;

74 
	g¥eùrum_·Ë‰e_mÚo
[] = {0,233,234,235,237,239,241,243,245,247,249,251,253};

77 *
	g¥eùrum_·Ë‰e
;

78 
	g¥eùrum_·Ë‰e_size
;

80 
»disCÚ‹xt
 *
	gcÚ‹xt
;

81 
	scÚfig
 {

82 *
	mho¡
;

83 
	mho¡pÜt
;

84 *
	mho¡sock‘
;

85 
	m»³©
;

86 
	mš‹rv®
;

87 
	mdbnum
;

88 
	mš‹¿ùive
;

89 
	mshutdown
;

90 
	mmÚ™Ü_mode
;

91 
	mpubsub_mode
;

92 
	mÏ‹ncy_mode
;

93 
	mÏ‹ncy_di¡_mode
;

94 
	mÏ‹ncy_hi¡Üy
;

95 
	mÌu_‹¡_mode
;

96 
	mÌu_‹¡_§m¶e_size
;

97 
	mşu¡”_mode
;

98 
	mşu¡”_»issue_commªd
;

99 
	m¦ave_mode
;

100 
	mpe_mode
;

101 
	mpe_timeout
;

102 
	mg‘rdb_mode
;

103 
	m¡©_mode
;

104 
	msÿn_mode
;

105 
	mšŒšsic_Ï‹ncy_mode
;

106 
	mšŒšsic_Ï‹ncy_du¿tiÚ
;

107 *
	m·‰”n
;

108 *
	mrdb_f’ame
;

109 
	mbigkeys
;

110 
	m¡dš¬g
;

111 *
	mauth
;

112 
	mouut
;

113 
sds
 
	mmb_d–im
;

114 
	m´om±
[128];

115 *
	mev®
;

116 
	mev®_ldb
;

117 
	mev®_ldb_sync
;

118 
	mev®_ldb_’d
;

119 
	m’abË_ldb_Ú_ev®
;

120 
	mÏ¡_cmd_ty³
;

121 } 
	gcÚfig
;

124 
	s´ef
 {

125 
	mhšts
;

126 } 
	g´ef
;

128 vŞ©
sig_©omic_t
 
	gfÜû_ÿnûl_loİ
 = 0;

129 
u§ge
();

130 
¦aveMode
();

131 *
»disG™SHA1
();

132 *
»disG™Dœty
();

133 
şiCÚÃù
(
fÜû
);

139 
	$u¡ime
() {

140 
timev®
 
tv
;

141 
u¡
;

143 
	`g‘timeofday
(&
tv
, 
NULL
);

144 
u¡
 = (()
tv
.
tv_£c
)*1000000;

145 
u¡
 +ğ
tv
.
tv_u£c
;

146  
u¡
;

147 
	}
}

149 
	$m¡ime
() {

150  
	`u¡ime
()/1000;

151 
	}
}

153 
	$şiReäeshProm±
() {

154 
Ën
;

156 ià(
cÚfig
.
ev®_ldb
) ;

157 ià(
cÚfig
.
ho¡sock‘
 !ğ
NULL
)

158 
Ën
 = 
	`¢´štf
(
cÚfig
.
´om±
,(config.prompt),"redis %s",

159 
cÚfig
.
ho¡sock‘
);

161 
Ën
 = 
	`ª‘FÜm©Addr
(
cÚfig
.
´om±
, (config.prompt),

162 
cÚfig
.
ho¡
, cÚfig.
ho¡pÜt
);

164 ià(
cÚfig
.
dbnum
 != 0)

165 
Ën
 +ğ
	`¢´štf
(
cÚfig
.
´om±
+len,(config.prompt)-len,"[%d]",

166 
cÚfig
.
dbnum
);

167 
	`¢´štf
(
cÚfig
.
´om±
+
Ën
,(config.prompt)-len,"> ");

168 
	}
}

178 
sds
 
	$g‘DÙfeP©h
(*
’vov”ride
, *
dÙf’ame
) {

179 *
·th
 = 
NULL
;

180 
sds
 
dÙP©h
 = 
NULL
;

183 
·th
 = 
	`g‘’v
(
’vov”ride
);

184 ià(
·th
 !ğ
NULL
 && *path != '\0') {

185 ià(!
	`¡rcmp
("/dev/nuÎ", 
·th
)) {

186  
NULL
;

190 
dÙP©h
 = 
	`sd¢ew
(
·th
);

192 *
home
 = 
	`g‘’v
("HOME");

193 ià(
home
 !ğ
NULL
 && *home != '\0') {

195 
dÙP©h
 = 
	`sdsÿrštf
(
	`sd£m±y
(), "%s/%s", 
home
, 
dÙf’ame
);

198  
dÙP©h
;

199 
	}
}

205 
	#CLI_HELP_COMMAND
 1

	)

206 
	#CLI_HELP_GROUP
 2

	)

209 
	mty³
;

210 
	m¬gc
;

211 
sds
 *
	m¬gv
;

212 
sds
 
	mfuÎ
;

215 
commªdH–p
 *
	mÜg
;

216 } 
	th–pEÁry
;

218 
h–pEÁry
 *
	gh–pEÁr›s
;

219 
	gh–pEÁr›sL’
;

221 
sds
 
	$şiV”siÚ
() {

222 
sds
 
v”siÚ
;

223 
v”siÚ
 = 
	`sdsÿrštf
(
	`sd£m±y
(), "%s", 
REDIS_VERSION
);

226 ià(
	`¡¹Şl
(
	`»disG™SHA1
(),
NULL
,16)) {

227 
v”siÚ
 = 
	`sdsÿrštf
(v”siÚ, " (g™:%s", 
	`»disG™SHA1
());

228 ià(
	`¡¹Şl
(
	`»disG™Dœty
(),
NULL
,10))

229 
v”siÚ
 = 
	`sdsÿrštf
(version, "-dirty");

230 
v”siÚ
 = 
	`sdsÿt
(version, ")");

232  
v”siÚ
;

233 
	}
}

235 
	$şiIn™H–p
() {

236 
commªd¦’
 = (
commªdH–p
)/(commandHelp);

237 
group¦’
 = (
commªdGroups
)/(*);

238 
i
, 
Ën
, 
pos
 = 0;

239 
h–pEÁry
 
tmp
;

241 
h–pEÁr›sL’
 = 
Ën
 = 
commªd¦’
+
group¦’
;

242 
h–pEÁr›s
 = 
	`zm®loc
((
h–pEÁry
)*
Ën
);

244 
i
 = 0; i < 
group¦’
; i++) {

245 
tmp
.
¬gc
 = 1;

246 
tmp
.
¬gv
 = 
	`zm®loc
((
sds
));

247 
tmp
.
¬gv
[0] = 
	`sdsÿrštf
(
	`sd£m±y
(),"@%s",
commªdGroups
[
i
]);

248 
tmp
.
fuÎ
 =mp.
¬gv
[0];

249 
tmp
.
ty³
 = 
CLI_HELP_GROUP
;

250 
tmp
.
Üg
 = 
NULL
;

251 
h–pEÁr›s
[
pos
++] = 
tmp
;

254 
i
 = 0; i < 
commªd¦’
; i++) {

255 
tmp
.
¬gv
 = 
	`sds¥l™¬gs
(
commªdH–p
[
i
].
Çme
,&tmp.
¬gc
);

256 
tmp
.
fuÎ
 = 
	`sd¢ew
(
commªdH–p
[
i
].
Çme
);

257 
tmp
.
ty³
 = 
CLI_HELP_COMMAND
;

258 
tmp
.
Üg
 = &
commªdH–p
[
i
];

259 
h–pEÁr›s
[
pos
++] = 
tmp
;

261 
	}
}

268 
	$şiIÁeg¿‹H–p
() {

269 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
) ;

271 
»disR•ly
 *
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
, "COMMAND");

272 if(
»¶y
 =ğ
NULL
 ||„•ly->
ty³
 !ğ
REDIS_REPLY_ARRAY
) ;

276 
size_t
 
j
 = 0; j < 
»¶y
->
–em’ts
; j++) {

277 
»disR•ly
 *
’Œy
 = 
»¶y
->
–em’t
[
j
];

278 *
cmdÇme
 = 
’Œy
->
–em’t
[0]->
¡r
;

279 
i
;

281 
i
 = 0; i < 
h–pEÁr›sL’
; i++) {

282 
h–pEÁry
 *
he
 = 
h–pEÁr›s
+
i
;

283 ià(!
	`¡rÿ£cmp
(
he
->
¬gv
[0],
cmdÇme
))

286 ià(
i
 !ğ
h–pEÁr›sL’
) ;

288 
h–pEÁr›sL’
++;

289 
h–pEÁr›s
 = 
	`z»®loc
(h–pEÁr›s,(
h–pEÁry
)*
h–pEÁr›sL’
);

290 
h–pEÁry
 *
Ãw
 = 
h–pEÁr›s
+(
h–pEÁr›sL’
-1);

292 
Ãw
->
¬gc
 = 1;

293 
Ãw
->
¬gv
 = 
	`zm®loc
((
sds
));

294 
Ãw
->
¬gv
[0] = 
	`sd¢ew
(
cmdÇme
);

295 
Ãw
->
fuÎ
 =‚ew->
¬gv
[0];

296 
Ãw
->
ty³
 = 
CLI_HELP_COMMAND
;

297 
	`sd¡ouµ”
(
Ãw
->
¬gv
[0]);

299 
commªdH–p
 *
ch
 = 
	`zm®loc
((*ch));

300 
ch
->
Çme
 = 
Ãw
->
¬gv
[0];

301 
ch
->
·¿ms
 = 
	`sd£m±y
();

302 
¬gs
 = 
	`Îabs
(
’Œy
->
–em’t
[1]->
š‹g”
);

303 ià(
’Œy
->
–em’t
[3]->
š‹g”
 == 1) {

304 
ch
->
·¿ms
 = 
	`sdsÿt
(ch->params,"key ");

305 
¬gs
--;

307 
¬gs
--è
ch
->
·¿ms
 = 
	`sdsÿt
(ch->params,"arg ");

308 ià(
’Œy
->
–em’t
[1]->
š‹g”
 < 0)

309 
ch
->
·¿ms
 = 
	`sdsÿt
(ch->params,"...options...");

310 
ch
->
summ¬y
 = "Help‚ot‡vailable";

311 
ch
->
group
 = 0;

312 
ch
->
sšû
 = "not known";

313 
Ãw
->
Üg
 = 
ch
;

315 
	`ä“R•lyObjeù
(
»¶y
);

316 
	}
}

319 
	$şiOuutCommªdH–p
(
commªdH–p
 *
h–p
, 
group
) {

320 
	`´štf
("\r\À \x1b[1m%s\x1b[0m \x1b[90m%s\x1b[0m\r\n", 
h–p
->
Çme
, h–p->
·¿ms
);

321 
	`´štf
(" \x1b[33msumm¬y:\x1b[0m %s\r\n", 
h–p
->
summ¬y
);

322 
	`´štf
(" \x1b[33msšû:\x1b[0m %s\r\n", 
h–p
->
sšû
);

323 ià(
group
) {

324 
	`´štf
(" \x1b[33mgroup:\x1b[0m %s\r\n", 
commªdGroups
[
h–p
->
group
]);

326 
	}
}

329 
	$şiOuutG’”icH–p
() {

330 
sds
 
v”siÚ
 = 
	`şiV”siÚ
();

331 
	`´štf
(

343 
v”siÚ


345 
	`sdsä“
(
v”siÚ
);

346 
	}
}

349 
	$şiOuutH–p
(
¬gc
, **
¬gv
) {

350 
i
, 
j
, 
Ën
;

351 
group
 = -1;

352 
h–pEÁry
 *
’Œy
;

353 
commªdH–p
 *
h–p
;

355 ià(
¬gc
 == 0) {

356 
	`şiOuutG’”icH–p
();

358 } ià(
¬gc
 > 0 && 
¬gv
[0][0] == '@') {

359 
Ën
 = (
commªdGroups
)/(*);

360 
i
 = 0; i < 
Ën
; i++) {

361 ià(
	`¡rÿ£cmp
(
¬gv
[0]+1,
commªdGroups
[
i
]) == 0) {

362 
group
 = 
i
;

368 
	`as£¹
(
¬gc
 > 0);

369 
i
 = 0; i < 
h–pEÁr›sL’
; i++) {

370 
’Œy
 = &
h–pEÁr›s
[
i
];

371 ià(
’Œy
->
ty³
 !ğ
CLI_HELP_COMMAND
) ;

373 
h–p
 = 
’Œy
->
Üg
;

374 ià(
group
 == -1) {

376 ià(
¬gc
 =ğ
’Œy
->argc) {

377 
j
 = 0; j < 
¬gc
; j++) {

378 ià(
	`¡rÿ£cmp
(
¬gv
[
j
],
’Œy
->argv[j]) != 0) ;

380 ià(
j
 =ğ
¬gc
) {

381 
	`şiOuutCommªdH–p
(
h–p
,1);

385 ià(
group
 =ğ
h–p
->group) {

386 
	`şiOuutCommªdH–p
(
h–p
,0);

390 
	`´štf
("\r\n");

391 
	}
}

394 
	$com¶‘iÚC®lback
(cÚ¡ *
buf
, 
lš’oi£Com¶‘iÚs
 *
lc
) {

395 
size_t
 
¡¬os
 = 0;

396 
mask
;

397 
i
;

398 
size_t
 
m©chËn
;

399 
sds
 
tmp
;

401 ià(
	`¡ºÿ£cmp
(
buf
,"help ",5) == 0) {

402 
¡¬os
 = 5;

403 
	`is¥aû
(
buf
[
¡¬os
])) startpos++;

404 
mask
 = 
CLI_HELP_COMMAND
 | 
CLI_HELP_GROUP
;

406 
mask
 = 
CLI_HELP_COMMAND
;

409 
i
 = 0; i < 
h–pEÁr›sL’
; i++) {

410 ià(!(
h–pEÁr›s
[
i
].
ty³
 & 
mask
)) ;

412 
m©chËn
 = 
	`¡¾’
(
buf
+
¡¬os
);

413 ià(
	`¡ºÿ£cmp
(
buf
+
¡¬os
,
h–pEÁr›s
[
i
].
fuÎ
,
m©chËn
) == 0) {

414 
tmp
 = 
	`sd¢ewËn
(
buf
,
¡¬os
);

415 
tmp
 = 
	`sdsÿt
Ñmp,
h–pEÁr›s
[
i
].
fuÎ
);

416 
	`lš’oi£AddCom¶‘iÚ
(
lc
,
tmp
);

417 
	`sdsä“
(
tmp
);

420 
	}
}

423 *
	$hštsC®lback
(cÚ¡ *
buf
, *
cŞÜ
, *
bŞd
) {

424 ià(!
´ef
.
hšts
è 
NULL
;

426 
i
, 
¬gc
, 
buæ’
 = 
	`¡¾’
(
buf
);

427 
sds
 *
¬gv
 = 
	`sds¥l™¬gs
(
buf
,&
¬gc
);

428 
’d¥aû
 = 
buæ’
 && 
	`is¥aû
(
buf
[buflen-1]);

431 ià(
¬gc
 == 0) {

432 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

433  
NULL
;

436 
i
 = 0; i < 
h–pEÁr›sL’
; i++) {

437 ià(!(
h–pEÁr›s
[
i
].
ty³
 & 
CLI_HELP_COMMAND
)) ;

439 ià(
	`¡rÿ£cmp
(
¬gv
[0],
h–pEÁr›s
[
i
].
fuÎ
) == 0)

441 *
cŞÜ
 = 90;

442 *
bŞd
 = 0;

443 
sds
 
hšt
 = 
	`sd¢ew
(
h–pEÁr›s
[
i
].
Üg
->
·¿ms
);

447 
tÜemove
 = 
¬gc
-1;

448 
tÜemove
 > 0 && 
	`sd¦’
(
hšt
)) {

449 ià(
hšt
[0] == '[') ;

450 ià(
hšt
[0] =ğ' 'è
tÜemove
--;

451 
	`sd¤ªge
(
hšt
,1,-1);

455 ià(!
’d¥aû
) {

456 
sds
 
Ãwhšt
 = 
	`sd¢ewËn
(" ",1);

457 
Ãwhšt
 = 
	`sdsÿtsds
Òewhšt,
hšt
);

458 
	`sdsä“
(
hšt
);

459 
hšt
 = 
Ãwhšt
;

462 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

463  
hšt
;

466 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

467  
NULL
;

468 
	}
}

470 
	$ä“HštsC®lback
(*
±r
) {

471 
	`sdsä“
(
±r
);

472 
	}
}

479 
	$şiAuth
() {

480 
»disR•ly
 *
»¶y
;

481 ià(
cÚfig
.
auth
 =ğ
NULL
è 
REDIS_OK
;

483 
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
,"AUTH %s",
cÚfig
.
auth
);

484 ià(
»¶y
 !ğ
NULL
) {

485 
	`ä“R•lyObjeù
(
»¶y
);

486  
REDIS_OK
;

488  
REDIS_ERR
;

489 
	}
}

492 
	$şiS–eù
() {

493 
»disR•ly
 *
»¶y
;

494 ià(
cÚfig
.
dbnum
 =ğ0è 
REDIS_OK
;

496 
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
,"SELECT %d",
cÚfig
.
dbnum
);

497 ià(
»¶y
 !ğ
NULL
) {

498 
»suÉ
 = 
REDIS_OK
;

499 ià(
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
è
»suÉ
 = 
REDIS_ERR
;

500 
	`ä“R•lyObjeù
(
»¶y
);

501  
»suÉ
;

503  
REDIS_ERR
;

504 
	}
}

508 
	$şiCÚÃù
(
fÜû
) {

509 ià(
cÚ‹xt
 =ğ
NULL
 || 
fÜû
) {

510 ià(
cÚ‹xt
 !ğ
NULL
) {

511 
	`»disF»e
(
cÚ‹xt
);

514 ià(
cÚfig
.
ho¡sock‘
 =ğ
NULL
) {

515 
cÚ‹xt
 = 
	`»disCÚÃù
(
cÚfig
.
ho¡
,cÚfig.
ho¡pÜt
);

517 
cÚ‹xt
 = 
	`»disCÚÃùUnix
(
cÚfig
.
ho¡sock‘
);

520 ià(
cÚ‹xt
->
”r
) {

521 
	`årštf
(
¡d”r
,"Could‚ot connecto Redis‡t ");

522 ià(
cÚfig
.
ho¡sock‘
 =ğ
NULL
)

523 
	`årštf
(
¡d”r
,"%s:%d: %s\n",
cÚfig
.
ho¡
,cÚfig.
ho¡pÜt
,
cÚ‹xt
->
”r¡r
);

525 
	`årštf
(
¡d”r
,"%s: %s\n",
cÚfig
.
ho¡sock‘
,
cÚ‹xt
->
”r¡r
);

526 
	`»disF»e
(
cÚ‹xt
);

527 
cÚ‹xt
 = 
NULL
;

528  
REDIS_ERR
;

535 
	`ª‘K“pAlive
(
NULL
, 
cÚ‹xt
->
fd
, 
REDIS_CLI_KEEPALIVE_INTERVAL
);

538 ià(
	`şiAuth
(è!ğ
REDIS_OK
)

539  
REDIS_ERR
;

540 ià(
	`şiS–eù
(è!ğ
REDIS_OK
)

541  
REDIS_ERR
;

543  
REDIS_OK
;

544 
	}
}

546 
	$şiPrštCÚ‹xtE¼Ü
() {

547 ià(
cÚ‹xt
 =ğ
NULL
) ;

548 
	`årštf
(
¡d”r
,"E¼Ü: %s\n",
cÚ‹xt
->
”r¡r
);

549 
	}
}

551 
sds
 
	$şiFÜm©R•lyTTY
(
»disR•ly
 *
r
, *
´efix
) {

552 
sds
 
out
 = 
	`sd£m±y
();

553 
r
->
ty³
) {

554 
REDIS_REPLY_ERROR
:

555 
out
 = 
	`sdsÿrštf
(out,"Ó¼Üè%s\n", 
r
->
¡r
);

557 
REDIS_REPLY_STATUS
:

558 
out
 = 
	`sdsÿt
(out,
r
->
¡r
);

559 
out
 = 
	`sdsÿt
(out,"\n");

561 
REDIS_REPLY_INTEGER
:

562 
out
 = 
	`sdsÿrštf
(out,"(š‹g”è%Îd\n",
r
->
š‹g”
);

564 
REDIS_REPLY_STRING
:

567 
out
 = 
	`sdsÿŒ•r
(out,
r
->
¡r
,r->
Ën
);

568 
out
 = 
	`sdsÿt
(out,"\n");

570 
REDIS_REPLY_NIL
:

571 
out
 = 
	`sdsÿt
(out,"(nil)\n");

573 
REDIS_REPLY_ARRAY
:

574 ià(
r
->
–em’ts
 == 0) {

575 
out
 = 
	`sdsÿt
(out,"(empty†ist or set)\n");

577 
i
, 
idxËn
 = 0;

578 
_´efixËn
[16];

579 
_´efixfmt
[16];

580 
sds
 
_´efix
;

581 
sds
 
tmp
;

584 
i
 = 
r
->
–em’ts
;

586 
idxËn
++;

587 
i
 /= 10;

588 } 
i
);

591 
	`mem£t
(
_´efixËn
,' ',
idxËn
+2);

592 
_´efixËn
[
idxËn
+2] = '\0';

593 
_´efix
 = 
	`sdsÿt
(
	`sd¢ew
(
´efix
),
_´efixËn
);

596 
	`¢´štf
(
_´efixfmt
,(_´efixfmt),"%%s%%%udè",
idxËn
);

598 
i
 = 0; i < 
r
->
–em’ts
; i++) {

601 
out
 = 
	`sdsÿrštf
(out,
_´efixfmt
,
i
 =ğ0 ? "" : 
´efix
,i+1);

604 
tmp
 = 
	`şiFÜm©R•lyTTY
(
r
->
–em’t
[
i
],
_´efix
);

605 
out
 = 
	`sdsÿ’
(out,
tmp
,
	`sd¦’
(tmp));

606 
	`sdsä“
(
tmp
);

608 
	`sdsä“
(
_´efix
);

612 
	`årštf
(
¡d”r
,"UnknowÀ»¶yy³: %d\n", 
r
->
ty³
);

613 
	`ex™
(1);

615  
out
;

616 
	}
}

618 
	$isCŞÜT”m
() {

619 *
t
 = 
	`g‘’v
("TERM");

620  
t
 !ğ
NULL
 && 
	`¡r¡r
(t,"xterm") != NULL;

621 
	}
}

625 
sds
 
	$sdsÿtcŞÜ
(
sds
 
o
, *
s
, 
size_t
 
Ën
, *
cŞÜ
) {

626 ià(!
	`isCŞÜT”m
()è 
	`sdsÿ’
(
o
,
s
,
Ën
);

628 
bŞd
 = 
	`¡r¡r
(
cŞÜ
,"bŞd"è!ğ
NULL
;

629 
ccode
 = 37;

630 ià(
	`¡r¡r
(
cŞÜ
,"»d")è
ccode
 = 31;

631 ià(
	`¡r¡r
(
cŞÜ
,"»d")è
ccode
 = 31;

632 ià(
	`¡r¡r
(
cŞÜ
,"g»’")è
ccode
 = 32;

633 ià(
	`¡r¡r
(
cŞÜ
,"y–low")è
ccode
 = 33;

634 ià(
	`¡r¡r
(
cŞÜ
,"blue")è
ccode
 = 34;

635 ià(
	`¡r¡r
(
cŞÜ
,"mag’")è
ccode
 = 35;

636 ià(
	`¡r¡r
(
cŞÜ
,"cyª")è
ccode
 = 36;

637 ià(
	`¡r¡r
(
cŞÜ
,"wh™e")è
ccode
 = 37;

639 
o
 = 
	`sdsÿtfmt
(o,"\033[%i;%i;49m",
bŞd
,
ccode
);

640 
o
 = 
	`sdsÿ’
(o,
s
,
Ën
);

641 
o
 = 
	`sdsÿt
(o,"\033[0m");

642  
o
;

643 
	}
}

647 
sds
 
	$sdsC©CŞÜizedLdbR•ly
(
sds
 
o
, *
s
, 
size_t
 
Ën
) {

648 *
cŞÜ
 = "white";

650 ià(
	`¡r¡r
(
s
,"<debug>")è
cŞÜ
 = "bold";

651 ià(
	`¡r¡r
(
s
,"<»dis>")è
cŞÜ
 = "green";

652 ià(
	`¡r¡r
(
s
,"<»¶y>")è
cŞÜ
 = "cyan";

653 ià(
	`¡r¡r
(
s
,"<”rÜ>")è
cŞÜ
 = "red";

654 ià(
	`¡r¡r
(
s
,"<hšt>")è
cŞÜ
 = "bold";

655 ià(
	`¡r¡r
(
s
,"<v®ue>"è|| sŒ¡r(s,"<»tv®>")è
cŞÜ
 = "magenta";

656 ià(
Ën
 > 4 && 
	`isdig™
(
s
[3])) {

657 ià(
s
[1] =ğ'>'è
cŞÜ
 = "yellow";

658 ià(
s
[2] =ğ'#'è
cŞÜ
 = "bold";

660  
	`sdsÿtcŞÜ
(
o
,
s
,
Ën
,
cŞÜ
);

661 
	}
}

663 
sds
 
	$şiFÜm©R•lyRaw
(
»disR•ly
 *
r
) {

664 
sds
 
out
 = 
	`sd£m±y
(), 
tmp
;

665 
size_t
 
i
;

667 
r
->
ty³
) {

668 
REDIS_REPLY_NIL
:

671 
REDIS_REPLY_ERROR
:

672 
out
 = 
	`sdsÿ’
(out,
r
->
¡r
,r->
Ën
);

673 
out
 = 
	`sdsÿ’
(out,"\n",1);

675 
REDIS_REPLY_STATUS
:

676 
REDIS_REPLY_STRING
:

677 ià(
r
->
ty³
 =ğ
REDIS_REPLY_STATUS
 && 
cÚfig
.
ev®_ldb
) {

683 ià(
	`¡r¡r
(
r
->
¡r
,"<endsession>") ==„->str) {

684 
cÚfig
.
’abË_ldb_Ú_ev®
 = 0;

685 
cÚfig
.
ev®_ldb
 = 0;

686 
cÚfig
.
ev®_ldb_’d
 = 1;

687 
cÚfig
.
ouut
 = 
OUTPUT_STANDARD
;

688 
	`şiReäeshProm±
();

690 
out
 = 
	`sdsC©CŞÜizedLdbR•ly
(out,
r
->
¡r
,r->
Ën
);

693 
out
 = 
	`sdsÿ’
(out,
r
->
¡r
,r->
Ën
);

696 
REDIS_REPLY_INTEGER
:

697 
out
 = 
	`sdsÿrštf
(out,"%Îd",
r
->
š‹g”
);

699 
REDIS_REPLY_ARRAY
:

700 
i
 = 0; i < 
r
->
–em’ts
; i++) {

701 ià(
i
 > 0è
out
 = 
	`sdsÿt
(out,
cÚfig
.
mb_d–im
);

702 
tmp
 = 
	`şiFÜm©R•lyRaw
(
r
->
–em’t
[
i
]);

703 
out
 = 
	`sdsÿ’
(out,
tmp
,
	`sd¦’
(tmp));

704 
	`sdsä“
(
tmp
);

708 
	`årštf
(
¡d”r
,"UnknowÀ»¶yy³: %d\n", 
r
->
ty³
);

709 
	`ex™
(1);

711  
out
;

712 
	}
}

714 
sds
 
	$şiFÜm©R•lyCSV
(
»disR•ly
 *
r
) {

715 
i
;

717 
sds
 
out
 = 
	`sd£m±y
();

718 
r
->
ty³
) {

719 
REDIS_REPLY_ERROR
:

720 
out
 = 
	`sdsÿt
(out,"ERROR,");

721 
out
 = 
	`sdsÿŒ•r
(out,
r
->
¡r
,
	`¡¾’
(r->str));

723 
REDIS_REPLY_STATUS
:

724 
out
 = 
	`sdsÿŒ•r
(out,
r
->
¡r
,r->
Ën
);

726 
REDIS_REPLY_INTEGER
:

727 
out
 = 
	`sdsÿrštf
(out,"%Îd",
r
->
š‹g”
);

729 
REDIS_REPLY_STRING
:

730 
out
 = 
	`sdsÿŒ•r
(out,
r
->
¡r
,r->
Ën
);

732 
REDIS_REPLY_NIL
:

733 
out
 = 
	`sdsÿt
(out,"NIL");

735 
REDIS_REPLY_ARRAY
:

736 
i
 = 0; i < 
r
->
–em’ts
; i++) {

737 
sds
 
tmp
 = 
	`şiFÜm©R•lyCSV
(
r
->
–em’t
[
i
]);

738 
out
 = 
	`sdsÿ’
(out,
tmp
,
	`sd¦’
(tmp));

739 ià(
i
 !ğ
r
->
–em’ts
-1è
out
 = 
	`sdsÿt
(out,",");

740 
	`sdsä“
(
tmp
);

744 
	`årštf
(
¡d”r
,"UnknowÀ»¶yy³: %d\n", 
r
->
ty³
);

745 
	`ex™
(1);

747  
out
;

748 
	}
}

750 
	$şiR—dR•ly
(
ouut_¿w_¡ršgs
) {

751 *
_»¶y
;

752 
»disR•ly
 *
»¶y
;

753 
sds
 
out
 = 
NULL
;

754 
ouut
 = 1;

756 ià(
	`»disG‘R•ly
(
cÚ‹xt
,&
_»¶y
è!ğ
REDIS_OK
) {

757 ià(
cÚfig
.
shutdown
) {

758 
	`»disF»e
(
cÚ‹xt
);

759 
cÚ‹xt
 = 
NULL
;

760  
REDIS_OK
;

762 ià(
cÚfig
.
š‹¿ùive
) {

764 ià(
cÚ‹xt
->
”r
 =ğ
REDIS_ERR_IO
 &&

765 (
”ºo
 =ğ
ECONNRESET
 ||ƒ¼nØ=ğ
EPIPE
))

766  
REDIS_ERR
;

767 ià(
cÚ‹xt
->
”r
 =ğ
REDIS_ERR_EOF
)

768  
REDIS_ERR
;

770 
	`şiPrštCÚ‹xtE¼Ü
();

771 
	`ex™
(1);

772  
REDIS_ERR
;

775 
»¶y
 = (
»disR•ly
*)
_»¶y
;

777 
cÚfig
.
Ï¡_cmd_ty³
 = 
»¶y
->
ty³
;

781 ià(
cÚfig
.
şu¡”_mode
 && 
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
 &&

782 (!
	`¡ºcmp
(
»¶y
->
¡r
,"MOVED",5è|| !
	`¡rcmp
(reply->str,"ASK")))

784 *
p
 = 
»¶y
->
¡r
, *
s
;

785 
¦Ù
;

787 
ouut
 = 0;

793 
s
 = 
	`¡rchr
(
p
,' ');

794 
p
 = 
	`¡rchr
(
s
+1,' ');

795 *
p
 = '\0';

796 
¦Ù
 = 
	`©oi
(
s
+1);

797 
s
 = 
	`¡¼chr
(
p
+1,':');

798 *
s
 = '\0';

799 
	`sdsä“
(
cÚfig
.
ho¡
);

800 
cÚfig
.
ho¡
 = 
	`sd¢ew
(
p
+1);

801 
cÚfig
.
ho¡pÜt
 = 
	`©oi
(
s
+1);

802 ià(
cÚfig
.
š‹¿ùive
)

803 
	`´štf
("-> Redirectedo slot [%d]†ocated‡t %s:%d\n",

804 
¦Ù
, 
cÚfig
.
ho¡
, cÚfig.
ho¡pÜt
);

805 
cÚfig
.
şu¡”_»issue_commªd
 = 1;

806 
	`şiReäeshProm±
();

809 ià(
ouut
) {

810 ià(
ouut_¿w_¡ršgs
) {

811 
out
 = 
	`şiFÜm©R•lyRaw
(
»¶y
);

813 ià(
cÚfig
.
ouut
 =ğ
OUTPUT_RAW
) {

814 
out
 = 
	`şiFÜm©R•lyRaw
(
»¶y
);

815 
out
 = 
	`sdsÿt
(out,"\n");

816 } ià(
cÚfig
.
ouut
 =ğ
OUTPUT_STANDARD
) {

817 
out
 = 
	`şiFÜm©R•lyTTY
(
»¶y
,"");

818 } ià(
cÚfig
.
ouut
 =ğ
OUTPUT_CSV
) {

819 
out
 = 
	`şiFÜm©R•lyCSV
(
»¶y
);

820 
out
 = 
	`sdsÿt
(out,"\n");

823 
	`fwr™e
(
out
,
	`sd¦’
(out),1,
¡dout
);

824 
	`sdsä“
(
out
);

826 
	`ä“R•lyObjeù
(
»¶y
);

827  
REDIS_OK
;

828 
	}
}

830 
	$şiS’dCommªd
(
¬gc
, **
¬gv
, 
»³©
) {

831 *
commªd
 = 
¬gv
[0];

832 
size_t
 *
¬gvËn
;

833 
j
, 
ouut_¿w
;

835 ià(!
cÚfig
.
ev®_ldb
 &&

836 (!
	`¡rÿ£cmp
(
commªd
,"help") || !strcasecmp(command,"?"))) {

837 
	`şiOuutH–p
(--
¬gc
, ++
¬gv
);

838  
REDIS_OK
;

841 ià(
cÚ‹xt
 =ğ
NULL
è 
REDIS_ERR
;

843 
ouut_¿w
 = 0;

844 ià(!
	`¡rÿ£cmp
(
commªd
,"info") ||

845 (
¬gc
 >ğ2 && !
	`¡rÿ£cmp
(
commªd
,"debug") &&

846 !
	`¡rÿ£cmp
(
¬gv
[1],"htstats")) ||

847 (
¬gc
 >ğ2 && !
	`¡rÿ£cmp
(
commªd
,"memory") &&

848 (!
	`¡rÿ£cmp
(
¬gv
[1],"malloc-stats") ||

849 !
	`¡rÿ£cmp
(
¬gv
[1],"doctor"))) ||

850 (
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(
commªd
,"cluster") &&

851 (!
	`¡rÿ£cmp
(
¬gv
[1],"nodes") ||

852 !
	`¡rÿ£cmp
(
¬gv
[1],"info"))) ||

853 (
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(
commªd
,"client") &&

854 !
	`¡rÿ£cmp
(
¬gv
[1],"list")) ||

855 (
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(
commªd
,"latency") &&

856 !
	`¡rÿ£cmp
(
¬gv
[1],"graph")) ||

857 (
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(
commªd
,"latency") &&

858 !
	`¡rÿ£cmp
(
¬gv
[1],"doctor")))

860 
ouut_¿w
 = 1;

863 ià(!
	`¡rÿ£cmp
(
commªd
,"shutdown")è
cÚfig
.
shutdown
 = 1;

864 ià(!
	`¡rÿ£cmp
(
commªd
,"mÚ™Ü")è
cÚfig
.
mÚ™Ü_mode
 = 1;

865 ià(!
	`¡rÿ£cmp
(
commªd
,"subscribe") ||

866 !
	`¡rÿ£cmp
(
commªd
,"psubsüibe")è
cÚfig
.
pubsub_mode
 = 1;

867 ià(!
	`¡rÿ£cmp
(
commªd
,"sync") ||

868 !
	`¡rÿ£cmp
(
commªd
,"psync")è
cÚfig
.
¦ave_mode
 = 1;

872 ià(
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(
¬gv
[0],"script") &&

873 !
	`¡rÿ£cmp
(
¬gv
[1],"debug"))

875 ià(!
	`¡rÿ£cmp
(
¬gv
[2],"yes") || !strcasecmp(argv[2],"sync")) {

876 
cÚfig
.
’abË_ldb_Ú_ev®
 = 1;

878 
cÚfig
.
’abË_ldb_Ú_ev®
 = 0;

883 ià(!
	`¡rÿ£cmp
(
commªd
,"ev®"è&& 
cÚfig
.
’abË_ldb_Ú_ev®
) {

884 
cÚfig
.
ev®_ldb
 = 1;

885 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

889 
¬gvËn
 = 
	`zm®loc
(
¬gc
*(
size_t
));

890 
j
 = 0; j < 
¬gc
; j++)

891 
¬gvËn
[
j
] = 
	`sd¦’
(
¬gv
[j]);

893 
»³©
--) {

894 
	`»disAµ’dCommªdArgv
(
cÚ‹xt
,
¬gc
,(cÚ¡ **)
¬gv
,
¬gvËn
);

895 
cÚfig
.
mÚ™Ü_mode
) {

896 ià(
	`şiR—dR•ly
(
ouut_¿w
è!ğ
REDIS_OK
è
	`ex™
(1);

897 
	`fæush
(
¡dout
);

900 ià(
cÚfig
.
pubsub_mode
) {

901 ià(
cÚfig
.
ouut
 !ğ
OUTPUT_RAW
)

902 
	`´štf
("Reading messages... (press Ctrl-Co quit)\n");

904 ià(
	`şiR—dR•ly
(
ouut_¿w
è!ğ
REDIS_OK
è
	`ex™
(1);

908 ià(
cÚfig
.
¦ave_mode
) {

909 
	`´štf
("Entering slave output mode... (press Ctrl-Co quit)\n");

910 
	`¦aveMode
();

911 
cÚfig
.
¦ave_mode
 = 0;

912 
	`zä“
(
¬gvËn
);

913  
REDIS_ERR
;

916 ià(
	`şiR—dR•ly
(
ouut_¿w
è!ğ
REDIS_OK
) {

917 
	`zä“
(
¬gvËn
);

918  
REDIS_ERR
;

921 ià(!
	`¡rÿ£cmp
(
commªd
,"£Ëù"è&& 
¬gc
 =ğ2 && 
cÚfig
.
Ï¡_cmd_ty³
 !ğ
REDIS_REPLY_ERROR
) {

922 
cÚfig
.
dbnum
 = 
	`©oi
(
¬gv
[1]);

923 
	`şiReäeshProm±
();

924 } ià(!
	`¡rÿ£cmp
(
commªd
,"auth"è&& 
¬gc
 == 2) {

925 
	`şiS–eù
();

928 ià(
cÚfig
.
š‹rv®
è
	`u¦“p
(config.interval);

929 
	`fæush
(
¡dout
);

932 
	`zä“
(
¬gvËn
);

933  
REDIS_OK
;

934 
	}
}

937 
»disR•ly
 *
	$»cÚÃùšgRedisCommªd
(
»disCÚ‹xt
 *
c
, cÚ¡ *
fmt
, ...) {

938 
»disR•ly
 *
»¶y
 = 
NULL
;

939 
Œ›s
 = 0;

940 
va_li¡
 
­
;

942 
	`as£¹
(!
c
->
”r
);

943 
»¶y
 =ğ
NULL
) {

944 
c
->
”r
 & (
REDIS_ERR_IO
 | 
REDIS_ERR_EOF
)) {

945 
	`´štf
("\r\x1b[0K");

946 
	`´štf
("RecÚÃùšg... %d\r", ++
Œ›s
);

947 
	`fæush
(
¡dout
);

949 
	`»disF»e
(
c
);

950 
c
 = 
	`»disCÚÃù
(
cÚfig
.
ho¡
,cÚfig.
ho¡pÜt
);

951 
	`u¦“p
(1000000);

954 
	`va_¡¬t
(
­
,
fmt
);

955 
»¶y
 = 
	`»disvCommªd
(
c
,
fmt
,
­
);

956 
	`va_’d
(
­
);

958 ià(
c
->
”r
 && !(c->”¸& (
REDIS_ERR_IO
 | 
REDIS_ERR_EOF
))) {

959 
	`årštf
(
¡d”r
, "E¼Ü: %s\n", 
c
->
”r¡r
);

960 
	`ex™
(1);

961 } ià(
Œ›s
 > 0) {

962 
	`´štf
("\r\x1b[0K");

966 
cÚ‹xt
 = 
c
;

967  
»¶y
;

968 
	}
}

974 
	$·r£O±iÚs
(
¬gc
, **
¬gv
) {

975 
i
;

977 
i
 = 1; i < 
¬gc
; i++) {

978 
Ï¡¬g
 = 
i
==
¬gc
-1;

980 ià(!
	`¡rcmp
(
¬gv
[
i
],"-h"è&& !
Ï¡¬g
) {

981 
	`sdsä“
(
cÚfig
.
ho¡
);

982 
cÚfig
.
ho¡
 = 
	`sd¢ew
(
¬gv
[++
i
]);

983 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-h"è&& 
Ï¡¬g
) {

984 
	`u§ge
();

985 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--help")) {

986 
	`u§ge
();

987 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-x")) {

988 
cÚfig
.
¡dš¬g
 = 1;

989 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-p"è&& !
Ï¡¬g
) {

990 
cÚfig
.
ho¡pÜt
 = 
	`©oi
(
¬gv
[++
i
]);

991 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-s"è&& !
Ï¡¬g
) {

992 
cÚfig
.
ho¡sock‘
 = 
¬gv
[++
i
];

993 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-r"è&& !
Ï¡¬g
) {

994 
cÚfig
.
»³©
 = 
	`¡¹Şl
(
¬gv
[++
i
],
NULL
,10);

995 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-i"è&& !
Ï¡¬g
) {

996 
£cÚds
 = 
	`©of
(
¬gv
[++
i
]);

997 
cÚfig
.
š‹rv®
 = 
£cÚds
*1000000;

998 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-n"è&& !
Ï¡¬g
) {

999 
cÚfig
.
dbnum
 = 
	`©oi
(
¬gv
[++
i
]);

1000 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-a"è&& !
Ï¡¬g
) {

1001 
cÚfig
.
auth
 = 
¬gv
[++
i
];

1002 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--raw")) {

1003 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

1004 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--no-raw")) {

1005 
cÚfig
.
ouut
 = 
OUTPUT_STANDARD
;

1006 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--csv")) {

1007 
cÚfig
.
ouut
 = 
OUTPUT_CSV
;

1008 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--latency")) {

1009 
cÚfig
.
Ï‹ncy_mode
 = 1;

1010 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--latency-dist")) {

1011 
cÚfig
.
Ï‹ncy_di¡_mode
 = 1;

1012 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--mono")) {

1013 
¥eùrum_·Ë‰e
 = 
¥eùrum_·Ë‰e_mÚo
;

1014 
¥eùrum_·Ë‰e_size
 = 
¥eùrum_·Ë‰e_mÚo_size
;

1015 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--latency-history")) {

1016 
cÚfig
.
Ï‹ncy_mode
 = 1;

1017 
cÚfig
.
Ï‹ncy_hi¡Üy
 = 1;

1018 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--Ìu-‹¡"è&& !
Ï¡¬g
) {

1019 
cÚfig
.
Ìu_‹¡_mode
 = 1;

1020 
cÚfig
.
Ìu_‹¡_§m¶e_size
 = 
	`¡¹Şl
(
¬gv
[++
i
],
NULL
,10);

1021 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--slave")) {

1022 
cÚfig
.
¦ave_mode
 = 1;

1023 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--stat")) {

1024 
cÚfig
.
¡©_mode
 = 1;

1025 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--scan")) {

1026 
cÚfig
.
sÿn_mode
 = 1;

1027 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--·‰”n"è&& !
Ï¡¬g
) {

1028 
cÚfig
.
·‰”n
 = 
¬gv
[++
i
];

1029 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--šŒšsic-Ï‹ncy"è&& !
Ï¡¬g
) {

1030 
cÚfig
.
šŒšsic_Ï‹ncy_mode
 = 1;

1031 
cÚfig
.
šŒšsic_Ï‹ncy_du¿tiÚ
 = 
	`©oi
(
¬gv
[++
i
]);

1032 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--rdb"è&& !
Ï¡¬g
) {

1033 
cÚfig
.
g‘rdb_mode
 = 1;

1034 
cÚfig
.
rdb_f’ame
 = 
¬gv
[++
i
];

1035 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--pipe")) {

1036 
cÚfig
.
pe_mode
 = 1;

1037 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--pe-timeout"è&& !
Ï¡¬g
) {

1038 
cÚfig
.
pe_timeout
 = 
	`©oi
(
¬gv
[++
i
]);

1039 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--bigkeys")) {

1040 
cÚfig
.
bigkeys
 = 1;

1041 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--ev®"è&& !
Ï¡¬g
) {

1042 
cÚfig
.
ev®
 = 
¬gv
[++
i
];

1043 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--ldb")) {

1044 
cÚfig
.
ev®_ldb
 = 1;

1045 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

1046 } ià(!
	`¡rcmp
(
¬gv
[
i
],"--ldb-sync-mode")) {

1047 
cÚfig
.
ev®_ldb
 = 1;

1048 
cÚfig
.
ev®_ldb_sync
 = 1;

1049 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

1050 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-c")) {

1051 
cÚfig
.
şu¡”_mode
 = 1;

1052 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-d"è&& !
Ï¡¬g
) {

1053 
	`sdsä“
(
cÚfig
.
mb_d–im
);

1054 
cÚfig
.
mb_d–im
 = 
	`sd¢ew
(
¬gv
[++
i
]);

1055 } ià(!
	`¡rcmp
(
¬gv
[
i
],"-v") || !strcmp(argv[i], "--version")) {

1056 
sds
 
v”siÚ
 = 
	`şiV”siÚ
();

1057 
	`´štf
("»dis-ş˜%s\n", 
v”siÚ
);

1058 
	`sdsä“
(
v”siÚ
);

1059 
	`ex™
(0);

1061 ià(
¬gv
[
i
][0] == '-') {

1062 
	`årštf
(
¡d”r
,

1064 
¬gv
[
i
]);

1065 
	`ex™
(1);

1074 ià(
cÚfig
.
ev®_ldb
 && cÚfig.
ev®
 =ğ
NULL
) {

1075 
	`årštf
(
¡d”r
,"Options --ldb‡nd --ldb-sync-mode„equire --eval.\n");

1076 
	`årštf
(
¡d”r
,"Try % --h–°fÜ mÜšfÜm©iÚ.\n", 
¬gv
[0]);

1077 
	`ex™
(1);

1079  
i
;

1080 
	}
}

1082 
sds
 
	$»adArgFromStdš
() {

1083 
buf
[1024];

1084 
sds
 
¬g
 = 
	`sd£m±y
();

1087 
Ä—d
 = 
	`»ad
(
	`f’o
(
¡dš
),
buf
,1024);

1089 ià(
Ä—d
 == 0) ;

1090 ià(
Ä—d
 == -1) {

1091 
	`³¼Ü
("Reading from standard input");

1092 
	`ex™
(1);

1094 
¬g
 = 
	`sdsÿ’
×rg,
buf
,
Ä—d
);

1096  
¬g
;

1097 
	}
}

1099 
	$u§ge
() {

1100 
sds
 
v”siÚ
 = 
	`şiV”siÚ
();

1101 
	`årštf
(
¡d”r
,

1160 
v”siÚ
, 
REDIS_CLI_DEFAULT_PIPE_TIMEOUT
);

1161 
	`sdsä“
(
v”siÚ
);

1162 
	`ex™
(1);

1163 
	}
}

1166 **
	$cÚv”tToSds
(
couÁ
, ** 
¬gs
) {

1167 
j
;

1168 **
sds
 = 
	`zm®loc
((*)*
couÁ
);

1170 
j
 = 0; j < 
couÁ
; j++)

1171 
sds
[
j
] = 
	`sd¢ew
(
¬gs
[j]);

1173  
sds
;

1174 
	}
}

1176 
	$issueCommªdR•—t
(
¬gc
, **
¬gv
, 
»³©
) {

1178 
cÚfig
.
şu¡”_»issue_commªd
 = 0;

1179 ià(
	`şiS’dCommªd
(
¬gc
,
¬gv
,
»³©
è!ğ
REDIS_OK
) {

1180 
	`şiCÚÃù
(1);

1184 ià(
	`şiS’dCommªd
(
¬gc
,
¬gv
,
»³©
è!ğ
REDIS_OK
) {

1185 
	`şiPrštCÚ‹xtE¼Ü
();

1186  
REDIS_ERR
;

1190 ià(
cÚfig
.
şu¡”_mode
 && cÚfig.
şu¡”_»issue_commªd
) {

1191 
	`şiCÚÃù
(1);

1196  
REDIS_OK
;

1197 
	}
}

1199 
	$issueCommªd
(
¬gc
, **
¬gv
) {

1200  
	`issueCommªdR•—t
(
¬gc
, 
¬gv
, 
cÚfig
.
»³©
);

1201 
	}
}

1209 
sds
 *
	$şiS¶™Args
(*
lše
, *
¬gc
) {

1210 ià(
cÚfig
.
ev®_ldb
 && (
	`¡r¡r
(
lše
,"eval ") ==†ine ||

1211 
	`¡r¡r
(
lše
,"e ") ==†ine))

1213 
sds
 *
¬gv
 = 
	`sds_m®loc
((sds)*2);

1214 *
¬gc
 = 2;

1215 
Ën
 = 
	`¡¾’
(
lše
);

1216 
–’
 = 
lše
[1] == ' ' ? 2 : 5;

1217 
¬gv
[0] = 
	`sd¢ewËn
(
lše
,
–’
-1);

1218 
¬gv
[1] = 
	`sd¢ewËn
(
lše
+
–’
,
Ën
-elen);

1219  
¬gv
;

1221  
	`sds¥l™¬gs
(
lše
,
¬gc
);

1223 
	}
}

1228 
	$şiS‘P»ã»nûs
(**
¬gv
, 
¬gc
, 
š‹¿ùive
) {

1229 ià(!
	`¡rÿ£cmp
(
¬gv
[0],":£t"è&& 
¬gc
 >= 2) {

1230 ià(!
	`¡rÿ£cmp
(
¬gv
[1],"hšts")è
´ef
.
hšts
 = 1;

1231 ià(!
	`¡rÿ£cmp
(
¬gv
[1],"nohšts")è
´ef
.
hšts
 = 0;

1233 
	`´štf
("%sunknown„edis-cli…reference '%s'\n",

1234 
š‹¿ùive
 ? "" : ".redisclirc: ",

1235 
¬gv
[1]);

1238 
	`´štf
("%sunknown„edis-cli internal command '%s'\n",

1239 
š‹¿ùive
 ? "" : ".redisclirc: ",

1240 
¬gv
[0]);

1242 
	}
}

1245 
	$şiLßdP»ã»nûs
() {

1246 
sds
 
rcfe
 = 
	`g‘DÙfeP©h
(
REDIS_CLI_RCFILE_ENV
,
REDIS_CLI_RCFILE_DEFAULT
);

1247 ià(
rcfe
 =ğ
NULL
) ;

1248 
FILE
 *
å
 = 
	`fİ’
(
rcfe
,"r");

1249 
buf
[1024];

1251 ià(
å
) {

1252 
	`fg‘s
(
buf
,(buf),
å
è!ğ
NULL
) {

1253 
sds
 *
¬gv
;

1254 
¬gc
;

1256 
¬gv
 = 
	`sds¥l™¬gs
(
buf
,&
¬gc
);

1257 ià(
¬gc
 > 0è
	`şiS‘P»ã»nûs
(
¬gv
,argc,0);

1258 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

1261 
	`sdsä“
(
rcfe
);

1262 
	}
}

1264 
	$»¶
() {

1265 
sds
 
hi¡Üyfe
 = 
NULL
;

1266 
hi¡Üy
 = 0;

1267 *
lše
;

1268 
¬gc
;

1269 
sds
 *
¬gv
;

1271 
cÚfig
.
š‹¿ùive
 = 1;

1272 
	`lš’oi£S‘MuÉiLše
(1);

1273 
	`lš’oi£S‘Com¶‘iÚC®lback
(
com¶‘iÚC®lback
);

1274 
	`lš’oi£S‘HštsC®lback
(
hštsC®lback
);

1275 
	`lš’oi£S‘F»eHštsC®lback
(
ä“HštsC®lback
);

1278 ià(
	`i§‰y
(
	`f’o
(
¡dš
))) {

1279 
hi¡Üyfe
 = 
	`g‘DÙfeP©h
(
REDIS_CLI_HISTFILE_ENV
,
REDIS_CLI_HISTFILE_DEFAULT
);

1280 ià(
hi¡Üyfe
 !ğ
NULL
) {

1281 
hi¡Üy
 = 1;

1282 
	`lš’oi£Hi¡ÜyLßd
(
hi¡Üyfe
);

1284 
	`şiLßdP»ã»nûs
();

1287 
	`şiReäeshProm±
();

1288 (
lše
 = 
	`lš’oi£
(
cÚ‹xt
 ? 
cÚfig
.
´om±
 : "nÙ cÚÃùed> ")è!ğ
NULL
) {

1289 ià(
lše
[0] != '\0') {

1290 
¬gv
 = 
	`şiS¶™Args
(
lše
,&
¬gc
);

1291 ià(
hi¡Üy
è
	`lš’oi£Hi¡ÜyAdd
(
lše
);

1292 ià(
hi¡Üyfe
è
	`lš’oi£Hi¡ÜySave
(historyfile);

1294 ià(
¬gv
 =ğ
NULL
) {

1295 
	`´štf
("Invalid‡rgument(s)\n");

1296 
	`lš’oi£F»e
(
lše
);

1298 } ià(
¬gc
 > 0) {

1299 ià(
	`¡rÿ£cmp
(
¬gv
[0],"quit") == 0 ||

1300 
	`¡rÿ£cmp
(
¬gv
[0],"exit") == 0)

1302 
	`ex™
(0);

1303 } ià(
¬gv
[0][0] == ':') {

1304 
	`şiS‘P»ã»nûs
(
¬gv
,
¬gc
,1);

1306 } ià(
	`¡rÿ£cmp
(
¬gv
[0],"restart") == 0) {

1307 ià(
cÚfig
.
ev®
) {

1308 
cÚfig
.
ev®_ldb
 = 1;

1309 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

1312 
	`´štf
("Use 'restart' only in Lua debugging mode.");

1314 } ià(
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(
¬gv
[0],"connect")) {

1315 
	`sdsä“
(
cÚfig
.
ho¡
);

1316 
cÚfig
.
ho¡
 = 
	`sd¢ew
(
¬gv
[1]);

1317 
cÚfig
.
ho¡pÜt
 = 
	`©oi
(
¬gv
[2]);

1318 
	`şiReäeshProm±
();

1319 
	`şiCÚÃù
(1);

1320 } ià(
¬gc
 =ğ1 && !
	`¡rÿ£cmp
(
¬gv
[0],"clear")) {

1321 
	`lš’oi£CË¬Sü“n
();

1323 
¡¬t_time
 = 
	`m¡ime
(), 
–­£d
;

1324 
»³©
, 
sk¬gs
 = 0;

1326 
»³©
 = 
	`©oi
(
¬gv
[0]);

1327 ià(
¬gc
 > 1 && 
»³©
) {

1328 
sk¬gs
 = 1;

1330 
»³©
 = 1;

1333 
	`issueCommªdR•—t
(
¬gc
-
sk¬gs
, 
¬gv
+sk¬gs, 
»³©
);

1337 ià(
cÚfig
.
ev®_ldb_’d
) {

1338 
cÚfig
.
ev®_ldb_’d
 = 0;

1339 
	`şiR—dR•ly
(0);

1340 
	`´štf
("\n(Lua debugging sessionƒnded%s)\n\n",

1341 
cÚfig
.
ev®_ldb_sync
 ? "" :

1345 
–­£d
 = 
	`m¡ime
()-
¡¬t_time
;

1346 ià(
–­£d
 >= 500) {

1347 
	`´štf
("(%.2fs)\n",()
–­£d
/1000);

1352 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

1355 
	`lš’oi£F»e
(
lše
);

1357 
	`ex™
(0);

1358 
	}
}

1360 
	$nÚš‹¿ùive
(
¬gc
, **
¬gv
) {

1361 
»tv®
 = 0;

1362 ià(
cÚfig
.
¡dš¬g
) {

1363 
¬gv
 = 
	`z»®loc
×rgv, (
¬gc
+1)*(*));

1364 
¬gv
[
¬gc
] = 
	`»adArgFromStdš
();

1365 
»tv®
 = 
	`issueCommªd
(
¬gc
+1, 
¬gv
);

1367 
»tv®
 = 
	`issueCommªd
(
¬gc
, 
¬gv
);

1369  
»tv®
;

1370 
	}
}

1376 
	$ev®Mode
(
¬gc
, **
¬gv
) {

1377 
sds
 
süt
 = 
NULL
;

1378 
FILE
 *
å
;

1379 
buf
[1024];

1380 
size_t
 
Ä—d
;

1381 **
¬gv2
;

1382 
j
, 
gÙ_comma
, 
keys
;

1383 
»tv®
 = 
REDIS_OK
;

1386 ià(
cÚfig
.
ev®_ldb
) {

1387 
	`´štf
(

1395 
	`sdsä“
(
süt
);

1396 
süt
 = 
	`sd£m±y
();

1397 
gÙ_comma
 = 0;

1398 
keys
 = 0;

1401 
å
 = 
	`fİ’
(
cÚfig
.
ev®
,"r");

1402 ià(!
å
) {

1403 
	`årštf
(
¡d”r
,

1404 "Cª'ˆİ’ f'%s': %s\n", 
cÚfig
.
ev®
, 
	`¡»¼Ü
(
”ºo
));

1405 
	`ex™
(1);

1407 (
Ä—d
 = 
	`ä—d
(
buf
,1,(buf),
å
)) != 0) {

1408 
süt
 = 
	`sdsÿ’
(süt,
buf
,
Ä—d
);

1410 
	`fşo£
(
å
);

1413 ià(
cÚfig
.
ev®_ldb
) {

1414 
»disR•ly
 *
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
,

1415 
cÚfig
.
ev®_ldb_sync
 ?

1417 ià(
»¶y
è
	`ä“R•lyObjeù
(reply);

1421 
¬gv2
 = 
	`zm®loc
((
sds
)*(
¬gc
+3));

1422 
¬gv2
[0] = 
	`sd¢ew
("EVAL");

1423 
¬gv2
[1] = 
süt
;

1424 
j
 = 0; j < 
¬gc
; j++) {

1425 ià(!
gÙ_comma
 && 
¬gv
[
j
][0] == ',' &&‡rgv[j][1] == 0) {

1426 
gÙ_comma
 = 1;

1429 
¬gv2
[
j
+3-
gÙ_comma
] = 
	`sd¢ew
(
¬gv
[j]);

1430 ià(!
gÙ_comma
è
keys
++;

1432 
¬gv2
[2] = 
	`sdsÿrštf
(
	`sd£m±y
(),"%d",
keys
);

1435 
ev®_ldb
 = 
cÚfig
.eval_ldb;

1436 
»tv®
 = 
	`issueCommªd
(
¬gc
+3-
gÙ_comma
, 
¬gv2
);

1437 ià(
ev®_ldb
) {

1438 ià(!
cÚfig
.
ev®_ldb
) {

1442 
	`´štf
("Eval debugging session can't start:\n");

1443 
	`şiR—dR•ly
(0);

1446 
	`¡ºıy
(
cÚfig
.
´om±
,"lua debugger> ",(config.prompt));

1447 
	`»¶
();

1449 
	`şiCÚÃù
(1);

1450 
	`´štf
("\n");

1456  
»tv®
;

1457 
	}
}

1463 
	#LATENCY_SAMPLE_RATE
 10

	)

1464 
	#LATENCY_HISTORY_DEFAULT_INTERVAL
 15000

	)

1465 
	$Ï‹ncyMode
() {

1466 
»disR•ly
 *
»¶y
;

1467 
¡¬t
, 
Ï‹ncy
, 
mš
 = 0, 
max
 = 0, 
tÙ
 = 0, 
couÁ
 = 0;

1468 
hi¡Üy_š‹rv®
 =

1469 
cÚfig
.
š‹rv®
 ? config.interval/1000 :

1470 
LATENCY_HISTORY_DEFAULT_INTERVAL
;

1471 
avg
;

1472 
hi¡Üy_¡¬t
 = 
	`m¡ime
();

1474 ià(!
cÚ‹xt
è
	`ex™
(1);

1476 
¡¬t
 = 
	`m¡ime
();

1477 
»¶y
 = 
	`»cÚÃùšgRedisCommªd
(
cÚ‹xt
,"PING");

1478 ià(
»¶y
 =ğ
NULL
) {

1479 
	`årštf
(
¡d”r
,"\nI/Oƒrror\n");

1480 
	`ex™
(1);

1482 
Ï‹ncy
 = 
	`m¡ime
()-
¡¬t
;

1483 
	`ä“R•lyObjeù
(
»¶y
);

1484 
couÁ
++;

1485 ià(
couÁ
 == 1) {

1486 
mš
 = 
max
 = 
tÙ
 = 
Ï‹ncy
;

1487 
avg
 = (è
Ï‹ncy
;

1489 ià(
Ï‹ncy
 < 
mš
) min =†atency;

1490 ià(
Ï‹ncy
 > 
max
) max =†atency;

1491 
tÙ
 +ğ
Ï‹ncy
;

1492 
avg
 = (è
tÙ
/
couÁ
;

1494 
	`´štf
("\x1b[0G\x1b[2Kmin: %lld, max: %lld,‡vg: %.2f (%lld samples)",

1495 
mš
, 
max
, 
avg
, 
couÁ
);

1496 
	`fæush
(
¡dout
);

1497 ià(
cÚfig
.
Ï‹ncy_hi¡Üy
 && 
	`m¡ime
()-
hi¡Üy_¡¬t
 > 
hi¡Üy_š‹rv®
)

1499 
	`´štf
(" -- %.2à£cÚd ¿nge\n", ()(
	`m¡ime
()-
hi¡Üy_¡¬t
)/1000);

1500 
hi¡Üy_¡¬t
 = 
	`m¡ime
();

1501 
mš
 = 
max
 = 
tÙ
 = 
couÁ
 = 0;

1503 
	`u¦“p
(
LATENCY_SAMPLE_RATE
 * 1000);

1505 
	}
}

1511 
	#LATENCY_DIST_DEFAULT_INTERVAL
 1000

	)

1514 
	sdi¡§m¶es
 {

1515 
	mmax
;

1516 
	mcouÁ
;

1517 
	mch¬aù”
;

1531 
	$showL©’cyDi¡Sam¶es
(
di¡§m¶es
 *
§m¶es
, 
tÙ
) {

1532 
j
;

1539 
	`´štf
("\033[38;5;0m");

1540 
j
 = 0; ; j++) {

1541 
cŞÜidx
 =

1542 
	`û
((è
§m¶es
[
j
].
couÁ
 / 
tÙ
 * (
¥eùrum_·Ë‰e_size
-1));

1543 
cŞÜ
 = 
¥eùrum_·Ë‰e
[
cŞÜidx
];

1544 
	`´štf
("\033[48;5;%dm%c", ()
cŞÜ
, 
§m¶es
[
j
].
ch¬aù”
);

1545 
§m¶es
[
j
].
couÁ
 = 0;

1546 ià(
§m¶es
[
j
].
max
 == 0) ;

1548 
	`´štf
("\033[0m\n");

1549 
	`fæush
(
¡dout
);

1550 
	}
}

1554 
	$showL©’cyDi¡Leg’d
() {

1555 
j
;

1557 
	`´štf
("---------------------------------------------\n");

1558 
	`´štf
(". - * # .01 .125 .25 .5 milliseconds\n");

1559 
	`´štf
("1,2,3,...,9 from 1o 9 milliseconds\n");

1560 
	`´štf
("A,B,C,D,E 10,20,30,40,50 milliseconds\n");

1561 
	`´štf
("F,G,H,I,J .1,.2,.3,.4,.5 seconds\n");

1562 
	`´štf
("K,L,M,N,O,P,Q,? 1,2,4,8,16,30,60,>60 seconds\n");

1563 
	`´štf
("From 0o 100%%: ");

1564 
j
 = 0; j < 
¥eùrum_·Ë‰e_size
; j++) {

1565 
	`´štf
("\033[48;5;%dm ", 
¥eùrum_·Ë‰e
[
j
]);

1567 
	`´štf
("\033[0m\n");

1568 
	`´štf
("---------------------------------------------\n");

1569 
	}
}

1571 
	$Ï‹ncyDi¡Mode
() {

1572 
»disR•ly
 *
»¶y
;

1573 
¡¬t
, 
Ï‹ncy
, 
couÁ
 = 0;

1574 
hi¡Üy_š‹rv®
 =

1575 
cÚfig
.
š‹rv®
 ? config.interval/1000 :

1576 
LATENCY_DIST_DEFAULT_INTERVAL
;

1577 
hi¡Üy_¡¬t
 = 
	`u¡ime
();

1578 
j
, 
ouuts
 = 0;

1580 
di¡§m¶es
 
§m¶es
[] = {

1617 ià(!
cÚ‹xt
è
	`ex™
(1);

1619 
¡¬t
 = 
	`u¡ime
();

1620 
»¶y
 = 
	`»cÚÃùšgRedisCommªd
(
cÚ‹xt
,"PING");

1621 ià(
»¶y
 =ğ
NULL
) {

1622 
	`årštf
(
¡d”r
,"\nI/Oƒrror\n");

1623 
	`ex™
(1);

1625 
Ï‹ncy
 = 
	`u¡ime
()-
¡¬t
;

1626 
	`ä“R•lyObjeù
(
»¶y
);

1627 
couÁ
++;

1630 
j
 = 0; ; j++) {

1631 ià(
§m¶es
[
j
].
max
 =ğ0 || 
Ï‹ncy
 <= samples[j].max) {

1632 
§m¶es
[
j
].
couÁ
++;

1638 ià(
couÁ
 && (
	`u¡ime
()-
hi¡Üy_¡¬t
)/1000 > 
hi¡Üy_š‹rv®
) {

1639 ià((
ouuts
++ % 20) == 0)

1640 
	`showL©’cyDi¡Leg’d
();

1641 
	`showL©’cyDi¡Sam¶es
(
§m¶es
,
couÁ
);

1642 
hi¡Üy_¡¬t
 = 
	`u¡ime
();

1643 
couÁ
 = 0;

1645 
	`u¦“p
(
LATENCY_SAMPLE_RATE
 * 1000);

1647 
	}
}

1655 
	$£ndSync
(
fd
) {

1660 
buf
[4096], *
p
;

1661 
ssize_t
 
Ä—d
;

1664 ià(
	`wr™e
(
fd
,"SYNC\r\n",6) != 6) {

1665 
	`årštf
(
¡d”r
,"Error writingo master\n");

1666 
	`ex™
(1);

1670 
p
 = 
buf
;

1672 
Ä—d
 = 
	`»ad
(
fd
,
p
,1);

1673 ià(
Ä—d
 <= 0) {

1674 
	`årštf
(
¡d”r
,"Error„eading bulk†ength while SYNCing\n");

1675 
	`ex™
(1);

1677 ià(*
p
 =ğ'\n' &&… !ğ
buf
) ;

1678 ià(*
p
 != '\n')…++;

1680 *
p
 = '\0';

1681 ià(
buf
[0] == '-') {

1682 
	`´štf
("SYNC w™h ma¡” faed: %s\n", 
buf
);

1683 
	`ex™
(1);

1685  
	`¡¹ouÎ
(
buf
+1,
NULL
,10);

1686 
	}
}

1688 
	$¦aveMode
() {

1689 
fd
 = 
cÚ‹xt
->fd;

1690 
·ylßd
 = 
	`£ndSync
(
fd
);

1691 
buf
[1024];

1692 
Üigš®_ouut
 = 
cÚfig
.
ouut
;

1694 
	`årštf
(
¡d”r
,"SYNC with master, discarding %llu "

1695 "by‹ oàbulk¿nsãr...\n", 
·ylßd
);

1698 
·ylßd
) {

1699 
ssize_t
 
Ä—d
;

1701 
Ä—d
 = 
	`»ad
(
fd
,
buf
,(
·ylßd
 > (buf)) ? (buf) :…ayload);

1702 ià(
Ä—d
 <= 0) {

1703 
	`årštf
(
¡d”r
,"Error„eading RDB…ayload while SYNCing\n");

1704 
	`ex™
(1);

1706 
·ylßd
 -ğ
Ä—d
;

1708 
	`årštf
(
¡d”r
,"SYNC done. Logging commands from master.\n");

1711 
cÚfig
.
ouut
 = 
OUTPUT_CSV
;

1712 
	`şiR—dR•ly
(0è=ğ
REDIS_OK
);

1713 
cÚfig
.
ouut
 = 
Üigš®_ouut
;

1714 
	}
}

1722 
	$g‘RDB
() {

1723 
s
 = 
cÚ‹xt
->
fd
;

1724 
fd
;

1725 
·ylßd
 = 
	`£ndSync
(
s
);

1726 
buf
[4096];

1728 
	`årštf
(
¡d”r
,"SYNC sento master, writing %llu byteso '%s'\n",

1729 
·ylßd
, 
cÚfig
.
rdb_f’ame
);

1732 ià(!
	`¡rcmp
(
cÚfig
.
rdb_f’ame
,"-")) {

1733 
fd
 = 
STDOUT_FILENO
;

1735 
fd
 = 
	`İ’
(
cÚfig
.
rdb_f’ame
, 
O_CREAT
|
O_WRONLY
, 0644);

1736 ià(
fd
 == -1) {

1737 
	`årštf
(
¡d”r
, "E¼Ü o³nšg '%s': %s\n", 
cÚfig
.
rdb_f’ame
,

1738 
	`¡»¼Ü
(
”ºo
));

1739 
	`ex™
(1);

1743 
·ylßd
) {

1744 
ssize_t
 
Ä—d
, 
nwr™‹n
;

1746 
Ä—d
 = 
	`»ad
(
s
,
buf
,(
·ylßd
 > (buf)) ? (buf) :…ayload);

1747 ià(
Ä—d
 <= 0) {

1748 
	`årštf
(
¡d”r
,"I/O Error„eading RDB…ayload from socket\n");

1749 
	`ex™
(1);

1751 
nwr™‹n
 = 
	`wr™e
(
fd
, 
buf
, 
Ä—d
);

1752 ià(
nwr™‹n
 !ğ
Ä—d
) {

1753 
	`årštf
(
¡d”r
,"Error writing datao file: %s\n",

1754 
	`¡»¼Ü
(
”ºo
));

1755 
	`ex™
(1);

1757 
·ylßd
 -ğ
Ä—d
;

1759 
	`şo£
(
s
);

1760 
	`fsync
(
fd
);

1761 
	`årštf
(
¡d”r
,"Transfer finished with success.\n");

1762 
	`ex™
(0);

1763 
	}
}

1769 
	#PIPEMODE_WRITE_LOOP_MAX_BYTES
 (128*1024)

	)

1770 
	$peMode
() {

1771 
fd
 = 
cÚ‹xt
->fd;

1772 
”rÜs
 = 0, 
»¶›s
 = 0, 
obuf_Ën
 = 0, 
obuf_pos
 = 0;

1773 
ibuf
[1024*16], 
obuf
[1024*16];

1774 
ª‘”r
[
ANET_ERR_LEN
];

1775 
»disR—d”
 *
»ad”
 = 
	`»disR—d”C»©e
();

1776 
»disR•ly
 *
»¶y
;

1777 
eof
 = 0;

1778 
dÚe
 = 0;

1779 
magic
[20];

1780 
time_t
 
Ï¡_»ad_time
 = 
	`time
(
NULL
);

1782 
	`¤ªd
(
	`time
(
NULL
));

1785 ià(
	`ª‘NÚBlock
(
ª‘”r
,
fd
è=ğ
ANET_ERR
) {

1786 
	`årštf
(
¡d”r
, "Can't sethe socket in‚on blocking mode: %s\n",

1787 
ª‘”r
);

1788 
	`ex™
(1);

1793 !
dÚe
) {

1794 
mask
 = 
AE_READABLE
;

1796 ià(!
eof
 || 
obuf_Ën
 !ğ0è
mask
 |ğ
AE_WRITABLE
;

1797 
mask
 = 
	`«Wa™
(
fd
,mask,1000);

1800 ià(
mask
 & 
AE_READABLE
) {

1801 
ssize_t
 
Ä—d
;

1805 
Ä—d
 = 
	`»ad
(
fd
,
ibuf
,(ibuf));

1806 ià(
Ä—d
 =ğ-1 && 
”ºo
 !ğ
EAGAIN
 &&ƒ¼nØ!ğ
EINTR
) {

1807 
	`årštf
(
¡d”r
, "Error„eading fromhe server: %s\n",

1808 
	`¡»¼Ü
(
”ºo
));

1809 
	`ex™
(1);

1811 ià(
Ä—d
 > 0) {

1812 
	`»disR—d”F“d
(
»ad”
,
ibuf
,
Ä—d
);

1813 
Ï¡_»ad_time
 = 
	`time
(
NULL
);

1815 } 
Ä—d
 > 0);

1819 ià(
	`»disR—d”G‘R•ly
(
»ad”
,(**)&
»¶y
è=ğ
REDIS_ERR
) {

1820 
	`årštf
(
¡d”r
, "Error„eading„eplies from server\n");

1821 
	`ex™
(1);

1823 ià(
»¶y
) {

1824 ià(
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
) {

1825 
	`årštf
(
¡d”r
,"%s\n", 
»¶y
->
¡r
);

1826 
”rÜs
++;

1827 } ià(
eof
 && 
»¶y
->
ty³
 =ğ
REDIS_REPLY_STRING
 &&

1828 
»¶y
->
Ën
 == 20) {

1832 ià(
	`memcmp
(
»¶y
->
¡r
,
magic
,20) == 0) {

1833 
	`´štf
("Last„eply„eceived from server.\n");

1834 
dÚe
 = 1;

1835 
»¶›s
--;

1838 
»¶›s
++;

1839 
	`ä“R•lyObjeù
(
»¶y
);

1841 } 
»¶y
);

1845 ià(
mask
 & 
AE_WRITABLE
) {

1846 
ssize_t
 
loİ_nwr™‹n
 = 0;

1850 ià(
obuf_Ën
 != 0) {

1851 
ssize_t
 
nwr™‹n
 = 
	`wr™e
(
fd
,
obuf
+
obuf_pos
,
obuf_Ën
);

1853 ià(
nwr™‹n
 == -1) {

1854 ià(
”ºo
 !ğ
EAGAIN
 &&ƒ¼nØ!ğ
EINTR
) {

1855 
	`årštf
(
¡d”r
, "Error writingohe server: %s\n",

1856 
	`¡»¼Ü
(
”ºo
));

1857 
	`ex™
(1);

1859 
nwr™‹n
 = 0;

1862 
obuf_Ën
 -ğ
nwr™‹n
;

1863 
obuf_pos
 +ğ
nwr™‹n
;

1864 
loİ_nwr™‹n
 +ğ
nwr™‹n
;

1865 ià(
obuf_Ën
 != 0) ;

1868 ià(
obuf_Ën
 =ğ0 && !
eof
) {

1869 
ssize_t
 
Ä—d
 = 
	`»ad
(
STDIN_FILENO
,
obuf
,(obuf));

1871 ià(
Ä—d
 == 0) {

1876 
echo
[] =

1878 
j
;

1880 
eof
 = 1;

1884 
j
 = 0; j < 20; j++)

1885 
magic
[
j
] = 
	`¿nd
() & 0xff;

1886 
	`memıy
(
echo
+21,
magic
,20);

1887 
	`memıy
(
obuf
,
echo
,(echo)-1);

1888 
obuf_Ën
 = (
echo
)-1;

1889 
obuf_pos
 = 0;

1890 
	`´štf
("All dataransferred. Waiting forhe†ast„eply...\n");

1891 } ià(
Ä—d
 == -1) {

1892 
	`årštf
(
¡d”r
, "Error„eading from stdin: %s\n",

1893 
	`¡»¼Ü
(
”ºo
));

1894 
	`ex™
(1);

1896 
obuf_Ën
 = 
Ä—d
;

1897 
obuf_pos
 = 0;

1900 ià((
obuf_Ën
 =ğ0 && 
eof
) ||

1901 
loİ_nwr™‹n
 > 
PIPEMODE_WRITE_LOOP_MAX_BYTES
) ;

1908 ià(
eof
 && 
cÚfig
.
pe_timeout
 > 0 &&

1909 
	`time
(
NULL
)-
Ï¡_»ad_time
 > 
cÚfig
.
pe_timeout
)

1911 
	`årštf
(
¡d”r
,"No„eplies for %d seconds:ƒxiting.\n",

1912 
cÚfig
.
pe_timeout
);

1913 
”rÜs
++;

1917 
	`»disR—d”F»e
(
»ad”
);

1918 
	`´štf
("”rÜs: %Îd,„•l›s: %Îd\n", 
”rÜs
, 
»¶›s
);

1919 ià(
”rÜs
)

1920 
	`ex™
(1);

1922 
	`ex™
(0);

1923 
	}
}

1929 
	#TYPE_STRING
 0

	)

1930 
	#TYPE_LIST
 1

	)

1931 
	#TYPE_SET
 2

	)

1932 
	#TYPE_HASH
 3

	)

1933 
	#TYPE_ZSET
 4

	)

1934 
	#TYPE_NONE
 5

	)

1936 
»disR•ly
 *
	$£ndSÿn
(*
™
) {

1937 
»disR•ly
 *
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
, "SCAN %Îu", *
™
);

1940 if(
»¶y
 =ğ
NULL
) {

1941 
	`årštf
(
¡d”r
, "\nI/Oƒrror\n");

1942 
	`ex™
(1);

1943 } if(
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
) {

1944 
	`årštf
(
¡d”r
, "SCANƒ¼Ü: %s\n", 
»¶y
->
¡r
);

1945 
	`ex™
(1);

1946 } if(
»¶y
->
ty³
 !ğ
REDIS_REPLY_ARRAY
) {

1947 
	`årštf
(
¡d”r
, "Non ARRAY„esponse from SCAN!\n");

1948 
	`ex™
(1);

1949 } if(
»¶y
->
–em’ts
 != 2) {

1950 
	`årštf
(
¡d”r
, "Invalidƒlement count from SCAN!\n");

1951 
	`ex™
(1);

1955 
	`as£¹
(
»¶y
->
–em’t
[0]->
ty³
 =ğ
REDIS_REPLY_STRING
);

1956 
	`as£¹
(
»¶y
->
–em’t
[1]->
ty³
 =ğ
REDIS_REPLY_ARRAY
);

1959 *
™
 = 
	`¡¹ouÎ
(
»¶y
->
–em’t
[0]->
¡r
, 
NULL
, 10);

1961  
»¶y
;

1962 
	}
}

1964 
	$g‘DbSize
() {

1965 
»disR•ly
 *
»¶y
;

1966 
size
;

1968 
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
, "DBSIZE");

1970 if(
»¶y
 =ğ
NULL
 ||„•ly->
ty³
 !ğ
REDIS_REPLY_INTEGER
) {

1971 
	`årštf
(
¡d”r
, "Couldn't determine DBSIZE!\n");

1972 
	`ex™
(1);

1976 
size
 = 
»¶y
->
š‹g”
;

1977 
	`ä“R•lyObjeù
(
»¶y
);

1979  
size
;

1980 
	}
}

1982 
	$toIÁTy³
(*
key
, *
ty³
) {

1983 if(!
	`¡rcmp
(
ty³
, "string")) {

1984  
TYPE_STRING
;

1985 } if(!
	`¡rcmp
(
ty³
, "list")) {

1986  
TYPE_LIST
;

1987 } if(!
	`¡rcmp
(
ty³
, "set")) {

1988  
TYPE_SET
;

1989 } if(!
	`¡rcmp
(
ty³
, "hash")) {

1990  
TYPE_HASH
;

1991 } if(!
	`¡rcmp
(
ty³
, "zset")) {

1992  
TYPE_ZSET
;

1993 } if(!
	`¡rcmp
(
ty³
, "none")) {

1994  
TYPE_NONE
;

1996 
	`årštf
(
¡d”r
, "UnknowÀty³ '%s' fÜ key '%s'\n", 
ty³
, 
key
);

1997 
	`ex™
(1);

1999 
	}
}

2001 
	$g‘KeyTy³s
(
»disR•ly
 *
keys
, *
ty³s
) {

2002 
»disR•ly
 *
»¶y
;

2003 
i
;

2006 
i
=0;i<
keys
->
–em’ts
;i++) {

2007 
	`»disAµ’dCommªd
(
cÚ‹xt
, "TYPE %s", 
keys
->
–em’t
[
i
]->
¡r
);

2011 
i
=0;i<
keys
->
–em’ts
;i++) {

2012 if(
	`»disG‘R•ly
(
cÚ‹xt
, (**)&
»¶y
)!=
REDIS_OK
) {

2013 
	`årštf
(
¡d”r
, "Error gettingype for key '%s' (%d: %s)\n",

2014 
keys
->
–em’t
[
i
]->
¡r
, 
cÚ‹xt
->
”r
, cÚ‹xt->
”r¡r
);

2015 
	`ex™
(1);

2016 } if(
»¶y
->
ty³
 !ğ
REDIS_REPLY_STATUS
) {

2017 
	`årštf
(
¡d”r
, "Invalid„eplyype (%d) for TYPE on key '%s'!\n",

2018 
»¶y
->
ty³
, 
keys
->
–em’t
[
i
]->
¡r
);

2019 
	`ex™
(1);

2022 
ty³s
[
i
] = 
	`toIÁTy³
(
keys
->
–em’t
[i]->
¡r
, 
»¶y
->str);

2023 
	`ä“R•lyObjeù
(
»¶y
);

2025 
	}
}

2027 
	$g‘KeySizes
(
»disR•ly
 *
keys
, *
ty³s
,

2028 *
sizes
)

2030 
»disR•ly
 *
»¶y
;

2031 *
sizecmds
[] = {"STRLEN","LLEN","SCARD","HLEN","ZCARD"};

2032 
i
;

2035 
i
=0;i<
keys
->
–em’ts
;i++) {

2037 if(
ty³s
[
i
]==
TYPE_NONE
)

2040 
	`»disAµ’dCommªd
(
cÚ‹xt
, "% %s", 
sizecmds
[
ty³s
[
i
]],

2041 
keys
->
–em’t
[
i
]->
¡r
);

2045 
i
=0;i<
keys
->
–em’ts
;i++) {

2047 if(
ty³s
[
i
] =ğ
TYPE_NONE
) {

2048 
sizes
[
i
] = 0;

2053 if(
	`»disG‘R•ly
(
cÚ‹xt
, (**)&
»¶y
)!=
REDIS_OK
) {

2054 
	`årštf
(
¡d”r
, "Error getting size for key '%s' (%d: %s)\n",

2055 
keys
->
–em’t
[
i
]->
¡r
, 
cÚ‹xt
->
”r
, cÚ‹xt->
”r¡r
);

2056 
	`ex™
(1);

2057 } if(
»¶y
->
ty³
 !ğ
REDIS_REPLY_INTEGER
) {

2060 
	`årštf
(
¡d”r
,

2062 
sizecmds
[
ty³s
[
i
]], 
keys
->
–em’t
[i]->
¡r
);

2063 
sizes
[
i
] = 0;

2065 
sizes
[
i
] = 
»¶y
->
š‹g”
;

2068 
	`ä“R•lyObjeù
(
»¶y
);

2070 
	}
}

2072 
	$fšdBigKeys
() {

2073 
bigge¡
[5] = {0}, 
couÁs
[5] = {0}, 
tÙ®size
[5] = {0};

2074 
§m¶ed
 = 0, 
tÙ®_keys
, 
tÙËn
=0, *
sizes
=
NULL
, 
™
=0;

2075 
sds
 
maxkeys
[5] = {0};

2076 *
ty³Çme
[] = {"string","list","set","hash","zset"};

2077 *
ty³un™
[] = {"bytes","items","members","fields","members"};

2078 
»disR•ly
 *
»¶y
, *
keys
;

2079 
¬rsize
=0, 
i
;

2080 
ty³
, *
ty³s
=
NULL
;

2081 
pù
;

2084 
tÙ®_keys
 = 
	`g‘DbSize
();

2087 
	`´štf
("\n# Scanningheƒntire keyspaceo find biggest keys‡s well‡s\n");

2088 
	`´štf
("#‡verage sizes…er keyype. You can use -i 0.1o sleep 0.1 sec\n");

2089 
	`´štf
("#…er 100 SCAN commands (not usually‚eeded).\n\n");

2092 
i
=0;i<
TYPE_NONE
; i++) {

2093 
maxkeys
[
i
] = 
	`sd£m±y
();

2094 if(!
maxkeys
[
i
]) {

2095 
	`årštf
(
¡d”r
, "Failedo‡llocate memory for†argest key‚ames!\n");

2096 
	`ex™
(1);

2103 
pù
 = 100 * ()
§m¶ed
/
tÙ®_keys
;

2106 
»¶y
 = 
	`£ndSÿn
(&
™
);

2107 
keys
 = 
»¶y
->
–em’t
[1];

2110 if(
keys
->
–em’ts
 > 
¬rsize
) {

2111 
ty³s
 = 
	`z»®loc
Ñy³s, ()*
keys
->
–em’ts
);

2112 
sizes
 = 
	`z»®loc
(sizes, ()*
keys
->
–em’ts
);

2114 if(!
ty³s
 || !
sizes
) {

2115 
	`årštf
(
¡d”r
, "Failedo‡llocate storage for keys!\n");

2116 
	`ex™
(1);

2119 
¬rsize
 = 
keys
->
–em’ts
;

2123 
	`g‘KeyTy³s
(
keys
, 
ty³s
);

2124 
	`g‘KeySizes
(
keys
, 
ty³s
, 
sizes
);

2127 
i
=0;i<
keys
->
–em’ts
;i++) {

2128 if((
ty³
 = 
ty³s
[
i
]è=ğ
TYPE_NONE
)

2131 
tÙ®size
[
ty³
] +ğ
sizes
[
i
];

2132 
couÁs
[
ty³
]++;

2133 
tÙËn
 +ğ
keys
->
–em’t
[
i
]->
Ën
;

2134 
§m¶ed
++;

2136 if(
bigge¡
[
ty³
]<
sizes
[
i
]) {

2137 
	`´štf
(

2139 
pù
, 
ty³Çme
[
ty³
], 
keys
->
–em’t
[
i
]->
¡r
, 
sizes
[i],

2140 
ty³un™
[
ty³
]);

2143 
maxkeys
[
ty³
] = 
	`sdsıy
(maxkeys[ty³], 
keys
->
–em’t
[
i
]->
¡r
);

2144 if(!
maxkeys
[
ty³
]) {

2145 
	`årštf
(
¡d”r
, "Failedo‡llocate memory for key!\n");

2146 
	`ex™
(1);

2150 
bigge¡
[
ty³
] = 
sizes
[
i
];

2154 if(
§m¶ed
 % 1000000 == 0) {

2155 
	`´štf
("[%05.2f%%] Sam¶ed %Îu key sØçr\n", 
pù
, 
§m¶ed
);

2160 if(
§m¶ed
 && (§m¶ed %100è=ğ0 && 
cÚfig
.
š‹rv®
) {

2161 
	`u¦“p
(
cÚfig
.
š‹rv®
);

2164 
	`ä“R•lyObjeù
(
»¶y
);

2165 } 
™
 != 0);

2167 if(
ty³s
è
	`zä“
(types);

2168 if(
sizes
è
	`zä“
(sizes);

2171 
	`´štf
("\n-------- summary -------\n\n");

2173 
	`´štf
("Sam¶ed %Îu key šhkey¥aû!\n", 
§m¶ed
);

2174 
	`´štf
("Total key†ength in bytes is %llu (avg†en %.2f)\n\n",

2175 
tÙËn
,ÙËÀ? (éÙËn/
§m¶ed
 : 0);

2178 
i
=0;i<
TYPE_NONE
;i++) {

2179 if(
	`sd¦’
(
maxkeys
[
i
])>0) {

2180 
	`´štf
("Bigge¡ %6 found '%s' ha %Îu %s\n", 
ty³Çme
[
i
], 
maxkeys
[i],

2181 
bigge¡
[
i
], 
ty³un™
[i]);

2185 
	`´štf
("\n");

2187 
i
=0;i<
TYPE_NONE
;i++) {

2188 
	`´štf
("%llu %ss with %llu %s (%05.2f%% of keys,‡vg size %.2f)\n",

2189 
couÁs
[
i
], 
ty³Çme
[i], 
tÙ®size
[i], 
ty³un™
[i],

2190 
§m¶ed
 ? 100 * ()
couÁs
[
i
]/sampled : 0,

2191 
couÁs
[
i
] ? ()
tÙ®size
[i]/counts[i] : 0);

2195 
i
=0;i<
TYPE_NONE
;i++) {

2196 
	`sdsä“
(
maxkeys
[
i
]);

2200 
	`ex™
(0);

2201 
	}
}

2210 *
	$g‘InfoF›ld
(*
šfo
, *
f›ld
) {

2211 *
p
 = 
	`¡r¡r
(
šfo
,
f›ld
);

2212 *
n1
, *
n2
;

2213 *
»suÉ
;

2215 ià(!
p
è 
NULL
;

2216 
p
 +ğ
	`¡¾’
(
f›ld
)+1;

2217 
n1
 = 
	`¡rchr
(
p
,'\r');

2218 
n2
 = 
	`¡rchr
(
p
,',');

2219 ià(
n2
 &&‚2 < 
n1
)‚1 =‚2;

2220 
»suÉ
 = 
	`zm®loc
(()*(
n1
-
p
)+1);

2221 
	`memıy
(
»suÉ
,
p
,(
n1
-p));

2222 
»suÉ
[
n1
-
p
] = '\0';

2223  
»suÉ
;

2224 
	}
}

2228 
	$g‘LÚgInfoF›ld
(*
šfo
, *
f›ld
) {

2229 *
v®ue
 = 
	`g‘InfoF›ld
(
šfo
,
f›ld
);

2230 
l
;

2232 ià(!
v®ue
è 
LONG_MIN
;

2233 
l
 = 
	`¡¹Ş
(
v®ue
,
NULL
,10);

2234 
	`zä“
(
v®ue
);

2235  
l
;

2236 
	}
}

2240 
	$by‹sToHumª
(*
s
, 
n
) {

2241 
d
;

2243 ià(
n
 < 0) {

2244 *
s
 = '-';

2245 
s
++;

2246 
n
 = -n;

2248 ià(
n
 < 1024) {

2250 
	`¥rštf
(
s
,"%ÎdB",
n
);

2252 } ià(
n
 < (1024*1024)) {

2253 
d
 = ()
n
/(1024);

2254 
	`¥rštf
(
s
,"%.2fK",
d
);

2255 } ià(
n
 < (1024LL*1024*1024)) {

2256 
d
 = ()
n
/(1024*1024);

2257 
	`¥rštf
(
s
,"%.2fM",
d
);

2258 } ià(
n
 < (1024LL*1024*1024*1024)) {

2259 
d
 = ()
n
/(1024LL*1024*1024);

2260 
	`¥rštf
(
s
,"%.2fG",
d
);

2262 
	}
}

2264 
	$¡©Mode
() {

2265 
»disR•ly
 *
»¶y
;

2266 
aux
, 
»que¡s
 = 0;

2267 
i
 = 0;

2270 
buf
[64];

2271 
j
;

2273 
»¶y
 = 
	`»cÚÃùšgRedisCommªd
(
cÚ‹xt
,"INFO");

2274 ià(
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
) {

2275 
	`´štf
("ERROR: %s\n", 
»¶y
->
¡r
);

2276 
	`ex™
(1);

2279 ià((
i
++ % 20) == 0) {

2280 
	`´štf
(

2286 
aux
 = 0;

2287 
j
 = 0; j < 20; j++) {

2288 
k
;

2290 
	`¥rštf
(
buf
,"db%d:keys",
j
);

2291 
k
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,
buf
);

2292 ià(
k
 =ğ
LONG_MIN
) ;

2293 
aux
 +ğ
k
;

2295 
	`¥rštf
(
buf
,"%ld",
aux
);

2296 
	`´štf
("%-11s",
buf
);

2299 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"used_memory");

2300 
	`by‹sToHumª
(
buf
,
aux
);

2301 
	`´štf
("%-8s",
buf
);

2304 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"connected_clients");

2305 
	`¥rštf
(
buf
,"%ld",
aux
);

2306 
	`´štf
(" %-8s",
buf
);

2309 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"blocked_clients");

2310 
	`¥rštf
(
buf
,"%ld",
aux
);

2311 
	`´štf
("%-8s",
buf
);

2314 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"total_commands_processed");

2315 
	`¥rštf
(
buf
,"%ld (+%ld)",
aux
,
»que¡s
 == 0 ? 0 :‡ux-requests);

2316 
	`´štf
("%-19s",
buf
);

2317 
»que¡s
 = 
aux
;

2320 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"total_connections_received");

2321 
	`¥rštf
(
buf
,"%ld",
aux
);

2322 
	`´štf
(" %-12s",
buf
);

2325 
aux
 = 
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"bgsave_in_progress");

2326 
aux
 |ğ
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"aof_rewrite_in_progress") << 1;

2327 
aux
 |ğ
	`g‘LÚgInfoF›ld
(
»¶y
->
¡r
,"loading") << 2;

2328 
aux
) {

2331 
	`´štf
("SAVE");

2334 
	`´štf
("AOF");

2337 
	`´štf
("SAVE+AOF");

2340 
	`´štf
("LOAD");

2344 
	`´štf
("\n");

2345 
	`ä“R•lyObjeù
(
»¶y
);

2346 
	`u¦“p
(
cÚfig
.
š‹rv®
);

2348 
	}
}

2354 
	$sÿnMode
() {

2355 
»disR•ly
 *
»¶y
;

2356 
cur
 = 0;

2359 ià(
cÚfig
.
·‰”n
)

2360 
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
,"SCAN %llu MATCH %s",

2361 
cur
,
cÚfig
.
·‰”n
);

2363 
»¶y
 = 
	`»disCommªd
(
cÚ‹xt
,"SCAN %Îu",
cur
);

2364 ià(
»¶y
 =ğ
NULL
) {

2365 
	`´štf
("I/Oƒrror\n");

2366 
	`ex™
(1);

2367 } ià(
»¶y
->
ty³
 =ğ
REDIS_REPLY_ERROR
) {

2368 
	`´štf
("ERROR: %s\n", 
»¶y
->
¡r
);

2369 
	`ex™
(1);

2371 
j
;

2373 
cur
 = 
	`¡¹ouÎ
(
»¶y
->
–em’t
[0]->
¡r
,
NULL
,10);

2374 
j
 = 0; j < 
»¶y
->
–em’t
[1]->
–em’ts
; j++)

2375 
	`´štf
("%s\n", 
»¶y
->
–em’t
[1]->–em’t[
j
]->
¡r
);

2377 
	`ä“R•lyObjeù
(
»¶y
);

2378 } 
cur
 != 0);

2380 
	`ex™
(0);

2381 
	}
}

2393 
	$pow”LawRªd
(
mš
, 
max
, 
®pha
) {

2394 
¶
, 
r
;

2396 
max
 += 1;

2397 
r
 = (()
	`¿nd
()è/ 
RAND_MAX
;

2398 
¶
 = 
	`pow
(

2399 ((
	`pow
(
max
,
®pha
+1è-…ow(
mš
,®pha+1))*
r
 +…ow(min,alpha+1)),

2400 (1.0/(
®pha
+1)));

2401  (
max
-1-()
¶
)+
mš
;

2402 
	}
}

2406 
	$LRUTe¡G’Key
(*
buf
, 
size_t
 
buæ’
) {

2407 
	`¢´štf
(
buf
, 
buæ’
, "lru:%lld",

2408 
	`pow”LawRªd
(1, 
cÚfig
.
Ìu_‹¡_§m¶e_size
, 6.2));

2409 
	}
}

2411 
	#LRU_CYCLE_PERIOD
 1000

	)

2412 
	#LRU_CYCLE_PIPELINE_SIZE
 250

	)

2413 
	$LRUTe¡Mode
() {

2414 
»disR•ly
 *
»¶y
;

2415 
key
[128];

2416 
¡¬t_cyşe
;

2417 
j
;

2419 
	`¤ªd
(
	`time
(
NULL
)^
	`g‘pid
());

2424 
¡¬t_cyşe
 = 
	`m¡ime
();

2425 
h™s
 = 0, 
mis£s
 = 0;

2426 
	`m¡ime
(è- 
¡¬t_cyşe
 < 1000) {

2428 
j
 = 0; j < 
LRU_CYCLE_PIPELINE_SIZE
; j++) {

2429 
v®
[6];

2430 
v®
[5] = '\0';

2431 
i
 = 0; i < 5; i++è
v®
[i] = 'A'+
	`¿nd
()%('z'-'A');

2432 
	`LRUTe¡G’Key
(
key
,(key));

2433 
	`»disAµ’dCommªd
(
cÚ‹xt
, "SET % %s",
key
,
v®
);

2435 
j
 = 0; j < 
LRU_CYCLE_PIPELINE_SIZE
; j++)

2436 
	`»disG‘R•ly
(
cÚ‹xt
, (**)&
»¶y
);

2439 
j
 = 0; j < 
LRU_CYCLE_PIPELINE_SIZE
; j++) {

2440 
	`LRUTe¡G’Key
(
key
,(key));

2441 
	`»disAµ’dCommªd
(
cÚ‹xt
, "GET %s",
key
);

2443 
j
 = 0; j < 
LRU_CYCLE_PIPELINE_SIZE
; j++) {

2444 ià(
	`»disG‘R•ly
(
cÚ‹xt
, (**)&
»¶y
è=ğ
REDIS_OK
) {

2445 
»¶y
->
ty³
) {

2446 
REDIS_REPLY_ERROR
:

2447 
	`´štf
("%s\n", 
»¶y
->
¡r
);

2449 
REDIS_REPLY_NIL
:

2450 
mis£s
++;

2453 
h™s
++;

2459 ià(
cÚ‹xt
->
”r
) {

2460 
	`årštf
(
¡d”r
,"I/Oƒrror during LRUest\n");

2461 
	`ex™
(1);

2465 
	`´štf
(

2467 
h™s
+
mis£s
,

2468 
h™s
, ()h™s/(h™s+
mis£s
)*100,

2469 
mis£s
, ()mis£s/(
h™s
+misses)*100);

2471 
	`ex™
(0);

2472 
	}
}

2485 
	$compu‹_som‘hšg_ç¡
() {

2486 
s
[256], 
i
, 
j
, 
t
;

2487 
couÁ
 = 1000, 
k
;

2488 
ouut
 = 0;

2490 
k
 = 0; k < 256; k++è
s
[k] = k;

2492 
i
 = 0;

2493 
j
 = 0;

2494 
couÁ
--) {

2495 
i
++;

2496 
j
 = j + 
s
[
i
];

2497 
t
 = 
s
[
i
];

2498 
s
[
i
] = s[
j
];

2499 
s
[
j
] = 
t
;

2500 
ouut
 +ğ
s
[(s[
i
]+s[
j
])&255];

2502  
ouut
;

2503 
	}
}

2505 
	$šŒšsicL©’cyModeStİ
(
s
) {

2506 
	`UNUSED
(
s
);

2507 
fÜû_ÿnûl_loİ
 = 1;

2508 
	}
}

2510 
	$šŒšsicL©’cyMode
() {

2511 
‹¡_’d
, 
run_time
, 
max_Ï‹ncy
 = 0, 
runs
 = 0;

2513 
run_time
 = 
cÚfig
.
šŒšsic_Ï‹ncy_du¿tiÚ
*1000000;

2514 
‹¡_’d
 = 
	`u¡ime
(è+ 
run_time
;

2515 
	`sigÇl
(
SIGINT
, 
šŒšsicL©’cyModeStİ
);

2518 
¡¬t
, 
’d
, 
Ï‹ncy
;

2520 
¡¬t
 = 
	`u¡ime
();

2521 
	`compu‹_som‘hšg_ç¡
();

2522 
’d
 = 
	`u¡ime
();

2523 
Ï‹ncy
 = 
’d
-
¡¬t
;

2524 
runs
++;

2525 ià(
Ï‹ncy
 <= 0) ;

2528 ià(
Ï‹ncy
 > 
max_Ï‹ncy
) {

2529 
max_Ï‹ncy
 = 
Ï‹ncy
;

2530 
	`´štf
("Max†©’cy sØçr: %Îd miüo£cÚds.\n", 
max_Ï‹ncy
);

2533 
avg_us
 = ()
run_time
/
runs
;

2534 
avg_ns
 = 
avg_us
 * 1e3;

2535 ià(
fÜû_ÿnûl_loİ
 || 
’d
 > 
‹¡_’d
) {

2536 
	`´štf
("\n%lldotal„uns "

2539 
runs
, 
avg_us
, 
avg_ns
);

2540 
	`´štf
("Worst„unook %.0fx†ongerhanhe‡verage†atency.\n",

2541 
max_Ï‹ncy
 / 
avg_us
);

2542 
	`ex™
(0);

2545 
	}
}

2551 
	$maš
(
¬gc
, **
¬gv
) {

2552 
fœ¡¬g
;

2554 
cÚfig
.
ho¡
 = 
	`sd¢ew
("127.0.0.1");

2555 
cÚfig
.
ho¡pÜt
 = 6379;

2556 
cÚfig
.
ho¡sock‘
 = 
NULL
;

2557 
cÚfig
.
»³©
 = 1;

2558 
cÚfig
.
š‹rv®
 = 0;

2559 
cÚfig
.
dbnum
 = 0;

2560 
cÚfig
.
š‹¿ùive
 = 0;

2561 
cÚfig
.
shutdown
 = 0;

2562 
cÚfig
.
mÚ™Ü_mode
 = 0;

2563 
cÚfig
.
pubsub_mode
 = 0;

2564 
cÚfig
.
Ï‹ncy_mode
 = 0;

2565 
cÚfig
.
Ï‹ncy_di¡_mode
 = 0;

2566 
cÚfig
.
Ï‹ncy_hi¡Üy
 = 0;

2567 
cÚfig
.
Ìu_‹¡_mode
 = 0;

2568 
cÚfig
.
Ìu_‹¡_§m¶e_size
 = 0;

2569 
cÚfig
.
şu¡”_mode
 = 0;

2570 
cÚfig
.
¦ave_mode
 = 0;

2571 
cÚfig
.
g‘rdb_mode
 = 0;

2572 
cÚfig
.
¡©_mode
 = 0;

2573 
cÚfig
.
sÿn_mode
 = 0;

2574 
cÚfig
.
šŒšsic_Ï‹ncy_mode
 = 0;

2575 
cÚfig
.
·‰”n
 = 
NULL
;

2576 
cÚfig
.
rdb_f’ame
 = 
NULL
;

2577 
cÚfig
.
pe_mode
 = 0;

2578 
cÚfig
.
pe_timeout
 = 
REDIS_CLI_DEFAULT_PIPE_TIMEOUT
;

2579 
cÚfig
.
bigkeys
 = 0;

2580 
cÚfig
.
¡dš¬g
 = 0;

2581 
cÚfig
.
auth
 = 
NULL
;

2582 
cÚfig
.
ev®
 = 
NULL
;

2583 
cÚfig
.
ev®_ldb
 = 0;

2584 
cÚfig
.
ev®_ldb_’d
 = 0;

2585 
cÚfig
.
ev®_ldb_sync
 = 0;

2586 
cÚfig
.
’abË_ldb_Ú_ev®
 = 0;

2587 
cÚfig
.
Ï¡_cmd_ty³
 = -1;

2589 
´ef
.
hšts
 = 1;

2591 
¥eùrum_·Ë‰e
 = 
¥eùrum_·Ë‰e_cŞÜ
;

2592 
¥eùrum_·Ë‰e_size
 = 
¥eùrum_·Ë‰e_cŞÜ_size
;

2594 ià(!
	`i§‰y
(
	`f’o
(
¡dout
)è&& (
	`g‘’v
("FAKETTY"è=ğ
NULL
))

2595 
cÚfig
.
ouut
 = 
OUTPUT_RAW
;

2597 
cÚfig
.
ouut
 = 
OUTPUT_STANDARD
;

2598 
cÚfig
.
mb_d–im
 = 
	`sd¢ew
("\n");

2600 
fœ¡¬g
 = 
	`·r£O±iÚs
(
¬gc
,
¬gv
);

2601 
¬gc
 -ğ
fœ¡¬g
;

2602 
¬gv
 +ğ
fœ¡¬g
;

2606 
	`şiIn™H–p
();

2607 
	`şiIÁeg¿‹H–p
();

2610 ià(
cÚfig
.
Ï‹ncy_mode
) {

2611 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2612 
	`Ï‹ncyMode
();

2616 ià(
cÚfig
.
Ï‹ncy_di¡_mode
) {

2617 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2618 
	`Ï‹ncyDi¡Mode
();

2622 ià(
cÚfig
.
¦ave_mode
) {

2623 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2624 
	`¦aveMode
();

2628 ià(
cÚfig
.
g‘rdb_mode
) {

2629 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2630 
	`g‘RDB
();

2634 ià(
cÚfig
.
pe_mode
) {

2635 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2636 
	`peMode
();

2640 ià(
cÚfig
.
bigkeys
) {

2641 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2642 
	`fšdBigKeys
();

2646 ià(
cÚfig
.
¡©_mode
) {

2647 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2648 ià(
cÚfig
.
š‹rv®
 == 0) config.interval = 1000000;

2649 
	`¡©Mode
();

2653 ià(
cÚfig
.
sÿn_mode
) {

2654 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2655 
	`sÿnMode
();

2659 ià(
cÚfig
.
Ìu_‹¡_mode
) {

2660 ià(
	`şiCÚÃù
(0è=ğ
REDIS_ERR
è
	`ex™
(1);

2661 
	`LRUTe¡Mode
();

2665 ià(
cÚfig
.
šŒšsic_Ï‹ncy_mode
è
	`šŒšsicL©’cyMode
();

2668 ià(
¬gc
 =ğ0 && !
cÚfig
.
ev®
) {

2670 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

2674 
	`şiCÚÃù
(0);

2675 
	`»¶
();

2679 ià(
	`şiCÚÃù
(0è!ğ
REDIS_OK
è
	`ex™
(1);

2680 ià(
cÚfig
.
ev®
) {

2681  
	`ev®Mode
(
¬gc
,
¬gv
);

2683  
	`nÚš‹¿ùive
(
¬gc
,
	`cÚv”tToSds
×rgc,
¬gv
));

2685 
	}
}

	@redisassert.h

38 #iâdeà
__REDIS_ASSERT_H__


39 
	#__REDIS_ASSERT_H__


	)

41 
	~<uni¡d.h
>

43 
	#as£¹
(
_e
è((_e)?()0 : (
	`_£rv”As£¹
(#_e,
__FILE__
,
__LINE__
),
	`_ex™
(1)))

	)

45 
_£rv”As£¹
(*
e¡r
, *
fe
, 
lše
);

	@redismodule.h

1 #iâdeà
REDISMODULE_H


2 
	#REDISMODULE_H


	)

4 
	~<sys/ty³s.h
>

5 
	~<¡dšt.h
>

6 
	~<¡dio.h
>

11 
	#REDISMODULE_OK
 0

	)

12 
	#REDISMODULE_ERR
 1

	)

15 
	#REDISMODULE_APIVER_1
 1

	)

18 
	#REDISMODULE_READ
 (1<<0)

	)

19 
	#REDISMODULE_WRITE
 (1<<1)

	)

21 
	#REDISMODULE_LIST_HEAD
 0

	)

22 
	#REDISMODULE_LIST_TAIL
 1

	)

25 
	#REDISMODULE_KEYTYPE_EMPTY
 0

	)

26 
	#REDISMODULE_KEYTYPE_STRING
 1

	)

27 
	#REDISMODULE_KEYTYPE_LIST
 2

	)

28 
	#REDISMODULE_KEYTYPE_HASH
 3

	)

29 
	#REDISMODULE_KEYTYPE_SET
 4

	)

30 
	#REDISMODULE_KEYTYPE_ZSET
 5

	)

31 
	#REDISMODULE_KEYTYPE_MODULE
 6

	)

34 
	#REDISMODULE_REPLY_UNKNOWN
 -1

	)

35 
	#REDISMODULE_REPLY_STRING
 0

	)

36 
	#REDISMODULE_REPLY_ERROR
 1

	)

37 
	#REDISMODULE_REPLY_INTEGER
 2

	)

38 
	#REDISMODULE_REPLY_ARRAY
 3

	)

39 
	#REDISMODULE_REPLY_NULL
 4

	)

42 
	#REDISMODULE_POSTPONED_ARRAY_LEN
 -1

	)

45 
	#REDISMODULE_NO_EXPIRE
 -1

	)

48 
	#REDISMODULE_ZADD_XX
 (1<<0)

	)

49 
	#REDISMODULE_ZADD_NX
 (1<<1)

	)

50 
	#REDISMODULE_ZADD_ADDED
 (1<<2)

	)

51 
	#REDISMODULE_ZADD_UPDATED
 (1<<3)

	)

52 
	#REDISMODULE_ZADD_NOP
 (1<<4)

	)

55 
	#REDISMODULE_HASH_NONE
 0

	)

56 
	#REDISMODULE_HASH_NX
 (1<<0)

	)

57 
	#REDISMODULE_HASH_XX
 (1<<1)

	)

58 
	#REDISMODULE_HASH_CFIELDS
 (1<<2)

	)

59 
	#REDISMODULE_HASH_EXISTS
 (1<<3)

	)

63 
	#REDISMODULE_HASH_DELETE
 ((
RedisModuËSŒšg
*)()1)

	)

66 
	#REDISMODULE_ERRORMSG_WRONGTYPE
 "WRONGTYPE O³¿tiÚ‡gaš¡‡ key hŞdšghwrÚg kšd oàv®ue"

	)

68 
	#REDISMODULE_POSITIVE_INFINITE
 (1.0/0.0)

	)

69 
	#REDISMODULE_NEGATIVE_INFINITE
 (-1.0/0.0)

	)

73 #iâdeà
REDISMODULE_CORE


75 
	tm¡ime_t
;

78 
RedisModuËCtx
 
	tRedisModuËCtx
;

79 
RedisModuËKey
 
	tRedisModuËKey
;

80 
RedisModuËSŒšg
 
	tRedisModuËSŒšg
;

81 
RedisModuËC®lR•ly
 
	tRedisModuËC®lR•ly
;

82 
RedisModuËIO
 
	tRedisModuËIO
;

83 
RedisModuËTy³
 
	tRedisModuËTy³
;

84 
RedisModuËDige¡
 
	tRedisModuËDige¡
;

86 (*
	tRedisModuËCmdFunc
è(
	tRedisModuËCtx
 *
	tùx
, 
	tRedisModuËSŒšg
 **
	t¬gv
, 
	t¬gc
);

88 *(*
	tRedisModuËTy³LßdFunc
)(
	tRedisModuËIO
 *
	trdb
, 
	t’cv”
);

89 (*
	tRedisModuËTy³SaveFunc
)(
	tRedisModuËIO
 *
	trdb
, *
	tv®ue
);

90 (*
	tRedisModuËTy³Rewr™eFunc
)(
	tRedisModuËIO
 *
	taof
, 
	tRedisModuËSŒšg
 *
	tkey
, *
	tv®ue
);

91 (*
	tRedisModuËTy³Dige¡Func
)(
	tRedisModuËDige¡
 *
	tdige¡
, *
	tv®ue
);

92 (*
	tRedisModuËTy³F»eFunc
)(*
	tv®ue
);

94 
	#REDISMODULE_GET_API
(
Çme
) \

95 
	`RedisModuË_G‘Api
("RedisModuË_" #Çme, ((**)&
RedisModuË_
 ## 
Çme
))

	)

97 
	#REDISMODULE_API_FUNC
(
x
è(*x)

	)

100 *
	$REDISMODULE_API_FUNC
(
RedisModuË_AÎoc
)(
size_t
 
by‹s
);

101 *
	$REDISMODULE_API_FUNC
(
RedisModuË_R—Îoc
)(*
±r
, 
size_t
 
by‹s
);

102 
	$REDISMODULE_API_FUNC
(
RedisModuË_F»e
)(*
±r
);

103 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C®loc
)(
size_t
 
nmemb
, size_ˆ
size
);

104 *
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒdup
)(cÚ¡ *
¡r
);

105 
	$REDISMODULE_API_FUNC
(
RedisModuË_G‘Api
)(const *, *);

106 
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eCommªd
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
RedisModuËCmdFunc
 
cmdfunc
, cÚ¡ *
¡ræags
, 
fœ¡key
, 
Ï¡key
, 
key¡•
);

107 
	$REDISMODULE_API_FUNC
(
RedisModuË_S‘ModuËA‰ribs
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
v”
, 
­iv”
);

108 
	$REDISMODULE_API_FUNC
(
RedisModuË_WrÚgAr™y
)(
RedisModuËCtx
 *
ùx
);

109 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hLÚgLÚg
)(
RedisModuËCtx
 *
ùx
, 
Î
);

110 
	$REDISMODULE_API_FUNC
(
RedisModuË_G‘S–eùedDb
)(
RedisModuËCtx
 *
ùx
);

111 
	$REDISMODULE_API_FUNC
(
RedisModuË_S–eùDb
)(
RedisModuËCtx
 *
ùx
, 
Ãwid
);

112 *
	$REDISMODULE_API_FUNC
(
RedisModuË_O³nKey
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
keyÇme
, 
mode
);

113 
	$REDISMODULE_API_FUNC
(
RedisModuË_Clo£Key
)(
RedisModuËKey
 *
kp
);

114 
	$REDISMODULE_API_FUNC
(
RedisModuË_KeyTy³
)(
RedisModuËKey
 *
kp
);

115 
size_t
 
	$REDISMODULE_API_FUNC
(
RedisModuË_V®ueL’gth
)(
RedisModuËKey
 *
kp
);

116 
	$REDISMODULE_API_FUNC
(
RedisModuË_Li¡Push
)(
RedisModuËKey
 *
kp
, 
wh”e
, 
RedisModuËSŒšg
 *
–e
);

117 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_Li¡Pİ
)(
RedisModuËKey
 *
key
, 
wh”e
);

118 
RedisModuËC®lR•ly
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C®l
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...);

119 cÚ¡ *
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lyPrÙo
)(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 *
Ën
);

120 
	$REDISMODULE_API_FUNC
(
RedisModuË_F»eC®lR•ly
)(
RedisModuËC®lR•ly
 *
»¶y
);

121 
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lyTy³
)(
RedisModuËC®lR•ly
 *
»¶y
);

122 
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lyIÁeg”
)(
RedisModuËC®lR•ly
 *
»¶y
);

123 
size_t
 
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lyL’gth
)(
RedisModuËC®lR•ly
 *
»¶y
);

124 
RedisModuËC®lR•ly
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lyA¼ayEËm’t
)(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 
idx
);

125 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eSŒšg
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
±r
, 
size_t
 
Ën
);

126 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eSŒšgFromLÚgLÚg
)(
RedisModuËCtx
 *
ùx
, 
Î
);

127 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eSŒšgFromSŒšg
)(
RedisModuËCtx
 *
ùx
, cÚ¡ 
RedisModuËSŒšg
 *
¡r
);

128 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eSŒšgPrštf
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
fmt
, ...);

129 
	$REDISMODULE_API_FUNC
(
RedisModuË_F»eSŒšg
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
);

130 cÚ¡ *
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgPŒL’
)(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, 
size_t
 *
Ën
);

131 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hE¼Ü
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
”r
);

132 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hSim¶eSŒšg
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
msg
);

133 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hA¼ay
)(
RedisModuËCtx
 *
ùx
, 
Ën
);

134 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyS‘A¼ayL’gth
)(
RedisModuËCtx
 *
ùx
, 
Ën
);

135 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hSŒšgBufãr
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
buf
, 
size_t
 
Ën
);

136 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hSŒšg
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
);

137 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hNuÎ
)(
RedisModuËCtx
 *
ùx
);

138 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hDoubË
)(
RedisModuËCtx
 *
ùx
, 
d
);

139 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•lyW™hC®lR•ly
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËC®lR•ly
 *
»¶y
);

140 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgToLÚgLÚg
)(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, *
Î
);

141 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgToDoubË
)(cÚ¡ 
RedisModuËSŒšg
 *
¡r
, *
d
);

142 
	$REDISMODULE_API_FUNC
(
RedisModuË_AutoMemÜy
)(
RedisModuËCtx
 *
ùx
);

143 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•liÿ‹
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...);

144 
	$REDISMODULE_API_FUNC
(
RedisModuË_R•liÿ‹V”b©im
)(
RedisModuËCtx
 *
ùx
);

145 cÚ¡ *
	$REDISMODULE_API_FUNC
(
RedisModuË_C®lR•lySŒšgPŒ
)(
RedisModuËC®lR•ly
 *
»¶y
, 
size_t
 *
Ën
);

146 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eSŒšgFromC®lR•ly
)(
RedisModuËC®lR•ly
 *
»¶y
);

147 
	$REDISMODULE_API_FUNC
(
RedisModuË_D–‘eKey
)(
RedisModuËKey
 *
key
);

148 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgS‘
)(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
¡r
);

149 *
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgDMA
)(
RedisModuËKey
 *
key
, 
size_t
 *
Ën
, 
mode
);

150 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgTrunÿ‹
)(
RedisModuËKey
 *
key
, 
size_t
 
ÃwËn
);

151 
m¡ime_t
 
	$REDISMODULE_API_FUNC
(
RedisModuË_G‘Expœe
)(
RedisModuËKey
 *
key
);

152 
	$REDISMODULE_API_FUNC
(
RedisModuË_S‘Expœe
)(
RedisModuËKey
 *
key
, 
m¡ime_t
 
expœe
);

153 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tAdd
)(
RedisModuËKey
 *
key
, 
scÜe
, 
RedisModuËSŒšg
 *
–e
, *
æag¥Œ
);

154 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tInüby
)(
RedisModuËKey
 *
key
, 
scÜe
, 
RedisModuËSŒšg
 *
–e
, *
æag¥Œ
, *
ÃwscÜe
);

155 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tScÜe
)(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
–e
, *
scÜe
);

156 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRem
)(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
–e
, *
d–‘ed
);

157 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRªgeStİ
)(
RedisModuËKey
 *
key
);

158 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tFœ¡InScÜeRªge
)(
RedisModuËKey
 *
key
, 
mš
, 
max
, 
mšex
, 
maxex
);

159 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tLa¡InScÜeRªge
)(
RedisModuËKey
 *
key
, 
mš
, 
max
, 
mšex
, 
maxex
);

160 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tFœ¡InLexRªge
)(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
mš
, RedisModuËSŒšg *
max
);

161 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tLa¡InLexRªge
)(
RedisModuËKey
 *
key
, 
RedisModuËSŒšg
 *
mš
, RedisModuËSŒšg *
max
);

162 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRªgeCu¼’tEËm’t
)(
RedisModuËKey
 *
key
, *
scÜe
);

163 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRªgeNext
)(
RedisModuËKey
 *
key
);

164 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRªgeP»v
)(
RedisModuËKey
 *
key
);

165 
	$REDISMODULE_API_FUNC
(
RedisModuË_Z£tRªgeEndR—ched
)(
RedisModuËKey
 *
key
);

166 
	$REDISMODULE_API_FUNC
(
RedisModuË_HashS‘
)(
RedisModuËKey
 *
key
, 
æags
, ...);

167 
	$REDISMODULE_API_FUNC
(
RedisModuË_HashG‘
)(
RedisModuËKey
 *
key
, 
æags
, ...);

168 
	$REDISMODULE_API_FUNC
(
RedisModuË_IsKeysPos™iÚReque¡
)(
RedisModuËCtx
 *
ùx
);

169 
	$REDISMODULE_API_FUNC
(
RedisModuË_KeyAtPos
)(
RedisModuËCtx
 *
ùx
, 
pos
);

170 
	$REDISMODULE_API_FUNC
(
RedisModuË_G‘Cl›ÁId
)(
RedisModuËCtx
 *
ùx
);

171 *
	$REDISMODULE_API_FUNC
(
RedisModuË_PoŞAÎoc
)(
RedisModuËCtx
 *
ùx
, 
size_t
 
by‹s
);

172 
RedisModuËTy³
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_C»©eD©aTy³
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
’cv”
, 
RedisModuËTy³LßdFunc
 
rdb_lßd
, 
RedisModuËTy³SaveFunc
 
rdb_§ve
, 
RedisModuËTy³Rewr™eFunc
 
aof_»wr™e
, 
RedisModuËTy³Dige¡Func
 
dige¡
, 
RedisModuËTy³F»eFunc
 
ä“
);

173 
	$REDISMODULE_API_FUNC
(
RedisModuË_ModuËTy³S‘V®ue
)(
RedisModuËKey
 *
key
, 
RedisModuËTy³
 *
mt
, *
v®ue
);

174 
RedisModuËTy³
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_ModuËTy³G‘Ty³
)(
RedisModuËKey
 *
key
);

175 *
	$REDISMODULE_API_FUNC
(
RedisModuË_ModuËTy³G‘V®ue
)(
RedisModuËKey
 *
key
);

176 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveUnsigÃd
)(
RedisModuËIO
 *
io
, 
ušt64_t
 
v®ue
);

177 
ušt64_t
 
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdUnsigÃd
)(
RedisModuËIO
 *
io
);

178 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveSigÃd
)(
RedisModuËIO
 *
io
, 
št64_t
 
v®ue
);

179 
št64_t
 
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdSigÃd
)(
RedisModuËIO
 *
io
);

180 
	$REDISMODULE_API_FUNC
(
RedisModuË_Em™AOF
)(
RedisModuËIO
 *
io
, cÚ¡ *
cmdÇme
, cÚ¡ *
fmt
, ...);

181 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveSŒšg
)(
RedisModuËIO
 *
io
, 
RedisModuËSŒšg
 *
s
);

182 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveSŒšgBufãr
)(
RedisModuËIO
 *
io
, cÚ¡ *
¡r
, 
size_t
 
Ën
);

183 
RedisModuËSŒšg
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdSŒšg
)(
RedisModuËIO
 *
io
);

184 *
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdSŒšgBufãr
)(
RedisModuËIO
 *
io
, 
size_t
 *
ËÅŒ
);

185 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveDoubË
)(
RedisModuËIO
 *
io
, 
v®ue
);

186 
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdDoubË
)(
RedisModuËIO
 *
io
);

187 
	$REDISMODULE_API_FUNC
(
RedisModuË_SaveFlßt
)(
RedisModuËIO
 *
io
, 
v®ue
);

188 
	$REDISMODULE_API_FUNC
(
RedisModuË_LßdFlßt
)(
RedisModuËIO
 *
io
);

189 
	$REDISMODULE_API_FUNC
(
RedisModuË_Log
)(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Ëv–
, cÚ¡ *
fmt
, ...);

190 
	$REDISMODULE_API_FUNC
(
RedisModuË_LogIOE¼Ü
)(
RedisModuËIO
 *
io
, cÚ¡ *
Ëv–¡r
, cÚ¡ *
fmt
, ...);

191 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgAµ’dBufãr
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
, cÚ¡ *
buf
, 
size_t
 
Ën
);

192 
	$REDISMODULE_API_FUNC
(
RedisModuË_R‘ašSŒšg
)(
RedisModuËCtx
 *
ùx
, 
RedisModuËSŒšg
 *
¡r
);

193 
	$REDISMODULE_API_FUNC
(
RedisModuË_SŒšgCom·»
)(
RedisModuËSŒšg
 *
a
, RedisModuËSŒšg *
b
);

194 
RedisModuËCtx
 *
	$REDISMODULE_API_FUNC
(
RedisModuË_G‘CÚ‹xtFromIO
)(
RedisModuËIO
 *
io
);

197 
	$RedisModuË_In™
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
v”
, 
­iv”
è
	`__©Œibu‹__
((
unu£d
));

198 
	$RedisModuË_In™
(
RedisModuËCtx
 *
ùx
, cÚ¡ *
Çme
, 
v”
, 
­iv”
) {

199 *
g‘­ifunıŒ
 = ((**)
ùx
)[0];

200 
RedisModuË_G‘Api
 = ((*)(cÚ¡ *, *)è()
g‘­ifunıŒ
;

201 
	`REDISMODULE_GET_API
(
AÎoc
);

202 
	`REDISMODULE_GET_API
(
C®loc
);

203 
	`REDISMODULE_GET_API
(
F»e
);

204 
	`REDISMODULE_GET_API
(
R—Îoc
);

205 
	`REDISMODULE_GET_API
(
SŒdup
);

206 
	`REDISMODULE_GET_API
(
C»©eCommªd
);

207 
	`REDISMODULE_GET_API
(
S‘ModuËA‰ribs
);

208 
	`REDISMODULE_GET_API
(
WrÚgAr™y
);

209 
	`REDISMODULE_GET_API
(
R•lyW™hLÚgLÚg
);

210 
	`REDISMODULE_GET_API
(
R•lyW™hE¼Ü
);

211 
	`REDISMODULE_GET_API
(
R•lyW™hSim¶eSŒšg
);

212 
	`REDISMODULE_GET_API
(
R•lyW™hA¼ay
);

213 
	`REDISMODULE_GET_API
(
R•lyS‘A¼ayL’gth
);

214 
	`REDISMODULE_GET_API
(
R•lyW™hSŒšgBufãr
);

215 
	`REDISMODULE_GET_API
(
R•lyW™hSŒšg
);

216 
	`REDISMODULE_GET_API
(
R•lyW™hNuÎ
);

217 
	`REDISMODULE_GET_API
(
R•lyW™hC®lR•ly
);

218 
	`REDISMODULE_GET_API
(
R•lyW™hDoubË
);

219 
	`REDISMODULE_GET_API
(
R•lyS‘A¼ayL’gth
);

220 
	`REDISMODULE_GET_API
(
G‘S–eùedDb
);

221 
	`REDISMODULE_GET_API
(
S–eùDb
);

222 
	`REDISMODULE_GET_API
(
O³nKey
);

223 
	`REDISMODULE_GET_API
(
Clo£Key
);

224 
	`REDISMODULE_GET_API
(
KeyTy³
);

225 
	`REDISMODULE_GET_API
(
V®ueL’gth
);

226 
	`REDISMODULE_GET_API
(
Li¡Push
);

227 
	`REDISMODULE_GET_API
(
Li¡Pİ
);

228 
	`REDISMODULE_GET_API
(
SŒšgToLÚgLÚg
);

229 
	`REDISMODULE_GET_API
(
SŒšgToDoubË
);

230 
	`REDISMODULE_GET_API
(
C®l
);

231 
	`REDISMODULE_GET_API
(
C®lR•lyPrÙo
);

232 
	`REDISMODULE_GET_API
(
F»eC®lR•ly
);

233 
	`REDISMODULE_GET_API
(
C®lR•lyIÁeg”
);

234 
	`REDISMODULE_GET_API
(
C®lR•lyTy³
);

235 
	`REDISMODULE_GET_API
(
C®lR•lyL’gth
);

236 
	`REDISMODULE_GET_API
(
C®lR•lyA¼ayEËm’t
);

237 
	`REDISMODULE_GET_API
(
C®lR•lySŒšgPŒ
);

238 
	`REDISMODULE_GET_API
(
C»©eSŒšgFromC®lR•ly
);

239 
	`REDISMODULE_GET_API
(
C»©eSŒšg
);

240 
	`REDISMODULE_GET_API
(
C»©eSŒšgFromLÚgLÚg
);

241 
	`REDISMODULE_GET_API
(
C»©eSŒšgFromSŒšg
);

242 
	`REDISMODULE_GET_API
(
C»©eSŒšgPrštf
);

243 
	`REDISMODULE_GET_API
(
F»eSŒšg
);

244 
	`REDISMODULE_GET_API
(
SŒšgPŒL’
);

245 
	`REDISMODULE_GET_API
(
AutoMemÜy
);

246 
	`REDISMODULE_GET_API
(
R•liÿ‹
);

247 
	`REDISMODULE_GET_API
(
R•liÿ‹V”b©im
);

248 
	`REDISMODULE_GET_API
(
D–‘eKey
);

249 
	`REDISMODULE_GET_API
(
SŒšgS‘
);

250 
	`REDISMODULE_GET_API
(
SŒšgDMA
);

251 
	`REDISMODULE_GET_API
(
SŒšgTrunÿ‹
);

252 
	`REDISMODULE_GET_API
(
G‘Expœe
);

253 
	`REDISMODULE_GET_API
(
S‘Expœe
);

254 
	`REDISMODULE_GET_API
(
Z£tAdd
);

255 
	`REDISMODULE_GET_API
(
Z£tInüby
);

256 
	`REDISMODULE_GET_API
(
Z£tScÜe
);

257 
	`REDISMODULE_GET_API
(
Z£tRem
);

258 
	`REDISMODULE_GET_API
(
Z£tRªgeStİ
);

259 
	`REDISMODULE_GET_API
(
Z£tFœ¡InScÜeRªge
);

260 
	`REDISMODULE_GET_API
(
Z£tLa¡InScÜeRªge
);

261 
	`REDISMODULE_GET_API
(
Z£tFœ¡InLexRªge
);

262 
	`REDISMODULE_GET_API
(
Z£tLa¡InLexRªge
);

263 
	`REDISMODULE_GET_API
(
Z£tRªgeCu¼’tEËm’t
);

264 
	`REDISMODULE_GET_API
(
Z£tRªgeNext
);

265 
	`REDISMODULE_GET_API
(
Z£tRªgeP»v
);

266 
	`REDISMODULE_GET_API
(
Z£tRªgeEndR—ched
);

267 
	`REDISMODULE_GET_API
(
HashS‘
);

268 
	`REDISMODULE_GET_API
(
HashG‘
);

269 
	`REDISMODULE_GET_API
(
IsKeysPos™iÚReque¡
);

270 
	`REDISMODULE_GET_API
(
KeyAtPos
);

271 
	`REDISMODULE_GET_API
(
G‘Cl›ÁId
);

272 
	`REDISMODULE_GET_API
(
PoŞAÎoc
);

273 
	`REDISMODULE_GET_API
(
C»©eD©aTy³
);

274 
	`REDISMODULE_GET_API
(
ModuËTy³S‘V®ue
);

275 
	`REDISMODULE_GET_API
(
ModuËTy³G‘Ty³
);

276 
	`REDISMODULE_GET_API
(
ModuËTy³G‘V®ue
);

277 
	`REDISMODULE_GET_API
(
SaveUnsigÃd
);

278 
	`REDISMODULE_GET_API
(
LßdUnsigÃd
);

279 
	`REDISMODULE_GET_API
(
SaveSigÃd
);

280 
	`REDISMODULE_GET_API
(
LßdSigÃd
);

281 
	`REDISMODULE_GET_API
(
SaveSŒšg
);

282 
	`REDISMODULE_GET_API
(
SaveSŒšgBufãr
);

283 
	`REDISMODULE_GET_API
(
LßdSŒšg
);

284 
	`REDISMODULE_GET_API
(
LßdSŒšgBufãr
);

285 
	`REDISMODULE_GET_API
(
SaveDoubË
);

286 
	`REDISMODULE_GET_API
(
LßdDoubË
);

287 
	`REDISMODULE_GET_API
(
SaveFlßt
);

288 
	`REDISMODULE_GET_API
(
LßdFlßt
);

289 
	`REDISMODULE_GET_API
(
Em™AOF
);

290 
	`REDISMODULE_GET_API
(
Log
);

291 
	`REDISMODULE_GET_API
(
LogIOE¼Ü
);

292 
	`REDISMODULE_GET_API
(
SŒšgAµ’dBufãr
);

293 
	`REDISMODULE_GET_API
(
R‘ašSŒšg
);

294 
	`REDISMODULE_GET_API
(
SŒšgCom·»
);

295 
	`REDISMODULE_GET_API
(
G‘CÚ‹xtFromIO
);

297 
	`RedisModuË_S‘ModuËA‰ribs
(
ùx
,
Çme
,
v”
,
­iv”
);

298  
REDISMODULE_OK
;

299 
	}
}

305 
	#RedisModuËSŒšg
 
robj


	)

	@release.c

34 
	~<¡ršg.h
>

36 
	~"»Ëa£.h
"

37 
	~"v”siÚ.h
"

38 
	~"üc64.h
"

40 *
	$»disG™SHA1
() {

41  
REDIS_GIT_SHA1
;

42 
	}
}

44 *
	$»disG™Dœty
() {

45  
REDIS_GIT_DIRTY
;

46 
	}
}

48 
ušt64_t
 
	$»disBudId
() {

49 *
budid
 = 
REDIS_VERSION
 
REDIS_BUILD_ID
 
REDIS_GIT_DIRTY
 
REDIS_GIT_SHA1
;

51  
	`üc64
(0,(*)
budid
,
	`¡¾’
(buildid));

52 
	}
}

	@release.h

1 
	#REDIS_GIT_SHA1
 "f94dc639"

	)

2 
	#REDIS_GIT_DIRTY
 "371"

	)

3 
	#REDIS_BUILD_ID
 "loÿlho¡.loÿldomaš-1480880896"

	)

	@replication.c

32 
	~"£rv”.h
"

34 
	~<sys/time.h
>

35 
	~<uni¡d.h
>

36 
	~<fú.h
>

37 
	~<sys/sock‘.h
>

38 
	~<sys/¡©.h
>

40 
»¶iÿtiÚDisÿrdCachedMa¡”
();

41 
»¶iÿtiÚResu¼eùCachedMa¡”
(
Ãwfd
);

42 
»¶iÿtiÚS’dAck
();

43 
putSÏveOÆše
(
ş›Á
 *
¦ave
);

44 
ÿnûlR•liÿtiÚHªdshake
();

52 *
	$»¶iÿtiÚG‘SÏveName
(
ş›Á
 *
c
) {

53 
buf
[
NET_PEER_ID_LEN
];

54 

[
NET_IP_STR_LEN
];

56 

[0] = '\0';

57 
buf
[0] = '\0';

58 ià(
c
->
¦ave_
[0] != '\0' ||

59 
	`ª‘P“rToSŒšg
(
c
->
fd
,

,(),
NULL
) != -1)

62 ià(
c
->
¦ave_
[0] !ğ'\0'è
	`memıy
(

,c->slave_ip,(c->slave_ip));

64 ià(
c
->
¦ave_li¡’šg_pÜt
)

65 
	`ª‘FÜm©Addr
(
buf
,(buf),

,
c
->
¦ave_li¡’šg_pÜt
);

67 
	`¢´štf
(
buf
,(buf),"%s:<unknown-¦ave-pÜt>",

);

69 
	`¢´štf
(
buf
,(buf),"client id #%llu",

70 (è
c
->
id
);

72  
buf
;

73 
	}
}

77 
	$ü—‹R•liÿtiÚBacklog
() {

78 
	`£rv”As£¹
(
£rv”
.
»¶_backlog
 =ğ
NULL
);

79 
£rv”
.
»¶_backlog
 = 
	`zm®loc
(£rv”.
»¶_backlog_size
);

80 
£rv”
.
»¶_backlog_hi¡Ën
 = 0;

81 
£rv”
.
»¶_backlog_idx
 = 0;

86 
£rv”
.
ma¡”_»¶_off£t
++;

91 
£rv”
.
»¶_backlog_off
 = s”v”.
ma¡”_»¶_off£t
+1;

92 
	}
}

100 
	$»sizeR•liÿtiÚBacklog
(
Ãwsize
) {

101 ià(
Ãwsize
 < 
CONFIG_REPL_BACKLOG_MIN_SIZE
)

102 
Ãwsize
 = 
CONFIG_REPL_BACKLOG_MIN_SIZE
;

103 ià(
£rv”
.
»¶_backlog_size
 =ğ
Ãwsize
) ;

105 
£rv”
.
»¶_backlog_size
 = 
Ãwsize
;

106 ià(
£rv”
.
»¶_backlog
 !ğ
NULL
) {

112 
	`zä“
(
£rv”
.
»¶_backlog
);

113 
£rv”
.
»¶_backlog
 = 
	`zm®loc
(£rv”.
»¶_backlog_size
);

114 
£rv”
.
»¶_backlog_hi¡Ën
 = 0;

115 
£rv”
.
»¶_backlog_idx
 = 0;

117 
£rv”
.
»¶_backlog_off
 = s”v”.
ma¡”_»¶_off£t
+1;

119 
	}
}

121 
	$ä“R•liÿtiÚBacklog
() {

122 
	`£rv”As£¹
(
	`li¡L’gth
(
£rv”
.
¦aves
) == 0);

123 
	`zä“
(
£rv”
.
»¶_backlog
);

124 
£rv”
.
»¶_backlog
 = 
NULL
;

125 
	}
}

131 
	$ãedR•liÿtiÚBacklog
(*
±r
, 
size_t
 
Ën
) {

132 *
p
 = 
±r
;

134 
£rv”
.
ma¡”_»¶_off£t
 +ğ
Ën
;

138 
Ën
) {

139 
size_t
 
thi¦’
 = 
£rv”
.
»¶_backlog_size
 - s”v”.
»¶_backlog_idx
;

140 ià(
thi¦’
 > 
Ën
)hislen =†en;

141 
	`memıy
(
£rv”
.
»¶_backlog
+£rv”.
»¶_backlog_idx
,
p
,
thi¦’
);

142 
£rv”
.
»¶_backlog_idx
 +ğ
thi¦’
;

143 ià(
£rv”
.
»¶_backlog_idx
 =ğ£rv”.
»¶_backlog_size
)

144 
£rv”
.
»¶_backlog_idx
 = 0;

145 
Ën
 -ğ
thi¦’
;

146 
p
 +ğ
thi¦’
;

147 
£rv”
.
»¶_backlog_hi¡Ën
 +ğ
thi¦’
;

149 ià(
£rv”
.
»¶_backlog_hi¡Ën
 > s”v”.
»¶_backlog_size
)

150 
£rv”
.
»¶_backlog_hi¡Ën
 = s”v”.
»¶_backlog_size
;

152 
£rv”
.
»¶_backlog_off
 = s”v”.
ma¡”_»¶_off£t
 -

153 
£rv”
.
»¶_backlog_hi¡Ën
 + 1;

154 
	}
}

158 
	$ãedR•liÿtiÚBacklogW™hObjeù
(
robj
 *
o
) {

159 
Î¡r
[
LONG_STR_SIZE
];

160 *
p
;

161 
size_t
 
Ën
;

163 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

164 
Ën
 = 
	`Î2¡ršg
(
Î¡r
,Öl¡r),()
o
->
±r
);

165 
p
 = 
Î¡r
;

167 
Ën
 = 
	`sd¦’
(
o
->
±r
);

168 
p
 = 
o
->
±r
;

170 
	`ãedR•liÿtiÚBacklog
(
p
,
Ën
);

171 
	}
}

173 
	$»¶iÿtiÚF“dSÏves
(
li¡
 *
¦aves
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
) {

174 
li¡Node
 *
Ê
;

175 
li¡I‹r
 
li
;

176 
j
, 
Ën
;

177 
Î¡r
[
LONG_STR_SIZE
];

181 ià(
£rv”
.
»¶_backlog
 =ğ
NULL
 && 
	`li¡L’gth
(
¦aves
) == 0) ;

184 
	`£rv”As£¹
(!(
	`li¡L’gth
(
¦aves
è!ğ0 && 
£rv”
.
»¶_backlog
 =ğ
NULL
));

187 ià(
£rv”
.
¦ave£ldb
 !ğ
diùid
) {

188 
robj
 *
£Ëùcmd
;

191 ià(
diùid
 >ğ0 && diùid < 
PROTO_SHARED_SELECT_CMDS
) {

192 
£Ëùcmd
 = 
sh¬ed
.
£Ëù
[
diùid
];

194 
diùid_Ën
;

196 
diùid_Ën
 = 
	`Î2¡ršg
(
Î¡r
,Öl¡r),
diùid
);

197 
£Ëùcmd
 = 
	`ü—‹Objeù
(
OBJ_STRING
,

198 
	`sdsÿrštf
(
	`sd£m±y
(),

200 
diùid_Ën
, 
Î¡r
));

204 ià(
£rv”
.
»¶_backlog
è
	`ãedR•liÿtiÚBacklogW™hObjeù
(
£Ëùcmd
);

207 
	`li¡Rewšd
(
¦aves
,&
li
);

208 (
Ê
 = 
	`li¡Next
(&
li
))) {

209 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

210 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) ;

211 
	`addR•ly
(
¦ave
,
£Ëùcmd
);

214 ià(
diùid
 < 0 || diùid >ğ
PROTO_SHARED_SELECT_CMDS
)

215 
	`deüRefCouÁ
(
£Ëùcmd
);

217 
£rv”
.
¦ave£ldb
 = 
diùid
;

220 ià(
£rv”
.
»¶_backlog
) {

221 
aux
[
LONG_STR_SIZE
+3];

224 
aux
[0] = '*';

225 
Ën
 = 
	`Î2¡ršg
(
aux
+1,×ux)-1,
¬gc
);

226 
aux
[
Ën
+1] = '\r';

227 
aux
[
Ën
+2] = '\n';

228 
	`ãedR•liÿtiÚBacklog
(
aux
,
Ën
+3);

230 
j
 = 0; j < 
¬gc
; j++) {

231 
objËn
 = 
	`¡ršgObjeùL’
(
¬gv
[
j
]);

236 
aux
[0] = '$';

237 
Ën
 = 
	`Î2¡ršg
(
aux
+1,×ux)-1,
objËn
);

238 
aux
[
Ën
+1] = '\r';

239 
aux
[
Ën
+2] = '\n';

240 
	`ãedR•liÿtiÚBacklog
(
aux
,
Ën
+3);

241 
	`ãedR•liÿtiÚBacklogW™hObjeù
(
¬gv
[
j
]);

242 
	`ãedR•liÿtiÚBacklog
(
aux
+
Ën
+1,2);

247 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

248 (
Ê
 = 
	`li¡Next
(&
li
))) {

249 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

252 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) ;

259 
	`addR•lyMuÉiBulkL’
(
¦ave
,
¬gc
);

263 
j
 = 0; j < 
¬gc
; j++)

264 
	`addR•lyBulk
(
¦ave
,
¬gv
[
j
]);

266 
	}
}

268 
	$»¶iÿtiÚF“dMÚ™Üs
(
ş›Á
 *
c
, 
li¡
 *
mÚ™Üs
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
) {

269 
li¡Node
 *
Ê
;

270 
li¡I‹r
 
li
;

271 
j
;

272 
sds
 
cmd»´
 = 
	`sd¢ew
("+");

273 
robj
 *
cmdobj
;

274 
timev®
 
tv
;

276 
	`g‘timeofday
(&
tv
,
NULL
);

277 
cmd»´
 = 
	`sdsÿrštf
(cmd»´,"%ld.%06ld ",()
tv
.
tv_£c
,(év.
tv_u£c
);

278 ià(
c
->
æags
 & 
CLIENT_LUA
) {

279 
cmd»´
 = 
	`sdsÿrštf
(cmd»´,"[%d†ua] ",
diùid
);

280 } ià(
c
->
æags
 & 
CLIENT_UNIX_SOCKET
) {

281 
cmd»´
 = 
	`sdsÿrštf
(cmd»´,"[%d unix:%s] ",
diùid
,
£rv”
.
unixsock‘
);

283 
cmd»´
 = 
	`sdsÿrštf
(cmd»´,"[%d %s] ",
diùid
,
	`g‘Cl›ÁP“rId
(
c
));

286 
j
 = 0; j < 
¬gc
; j++) {

287 ià(
¬gv
[
j
]->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

288 
cmd»´
 = 
	`sdsÿrštf
(cmd»´, "\"%ld\"", ()
¬gv
[
j
]->
±r
);

290 
cmd»´
 = 
	`sdsÿŒ•r
(cmd»´,(*)
¬gv
[
j
]->
±r
,

291 
	`sd¦’
(
¬gv
[
j
]->
±r
));

293 ià(
j
 !ğ
¬gc
-1)

294 
cmd»´
 = 
	`sdsÿ’
(cmdrepr," ",1);

296 
cmd»´
 = 
	`sdsÿ’
(cmdrepr,"\r\n",2);

297 
cmdobj
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
cmd»´
);

299 
	`li¡Rewšd
(
mÚ™Üs
,&
li
);

300 (
Ê
 = 
	`li¡Next
(&
li
))) {

301 
ş›Á
 *
mÚ™Ü
 = 
Ê
->
v®ue
;

302 
	`addR•ly
(
mÚ™Ü
,
cmdobj
);

304 
	`deüRefCouÁ
(
cmdobj
);

305 
	}
}

309 
	$addR•lyR•liÿtiÚBacklog
(
ş›Á
 *
c
, 
off£t
) {

310 
j
, 
sk
, 
Ën
;

312 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] SÏv»que¡ off£t: %Îd", 
off£t
);

314 ià(
£rv”
.
»¶_backlog_hi¡Ën
 == 0) {

315 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] Backlog history†en is zero");

319 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] Backlog size: %lld",

320 
£rv”
.
»¶_backlog_size
);

321 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] First byte: %lld",

322 
£rv”
.
»¶_backlog_off
);

323 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] History†en: %lld",

324 
£rv”
.
»¶_backlog_hi¡Ën
);

325 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] Current index: %lld",

326 
£rv”
.
»¶_backlog_idx
);

329 
sk
 = 
off£t
 - 
£rv”
.
»¶_backlog_off
;

330 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] Skpšg: %Îd", 
sk
);

334 
j
 = (
£rv”
.
»¶_backlog_idx
 +

335 (
£rv”
.
»¶_backlog_size
-£rv”.
»¶_backlog_hi¡Ën
)) %

336 
£rv”
.
»¶_backlog_size
;

337 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] Index oàfœ¡ by‹: %Îd", 
j
);

340 
j
 = (j + 
sk
è% 
£rv”
.
»¶_backlog_size
;

344 
Ën
 = 
£rv”
.
»¶_backlog_hi¡Ën
 - 
sk
;

345 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC] R•lyÙ®†’gth: %Îd", 
Ën
);

346 
Ën
) {

347 
thi¦’
 =

348 ((
£rv”
.
»¶_backlog_size
 - 
j
è< 
Ën
) ?

349 (
£rv”
.
»¶_backlog_size
 - 
j
è: 
Ën
;

351 
	`£rv”Log
(
LL_DEBUG
, "[PSYNC]‡ddR•ly(èËngth: %Îd", 
thi¦’
);

352 
	`addR•lySds
(
c
,
	`sd¢ewËn
(
£rv”
.
»¶_backlog
 + 
j
, 
thi¦’
));

353 
Ën
 -ğ
thi¦’
;

354 
j
 = 0;

356  
£rv”
.
»¶_backlog_hi¡Ën
 - 
sk
;

357 
	}
}

363 
	$g‘PsyncIn™ŸlOff£t
() {

364 
psync_off£t
 = 
£rv”
.
ma¡”_»¶_off£t
;

367 ià(
£rv”
.
»¶_backlog
 =ğ
NULL
è
psync_off£t
++;

368  
psync_off£t
;

369 
	}
}

387 
	$»¶iÿtiÚS‘upSÏveFÜFuÎResync
(
ş›Á
 *
¦ave
, 
off£t
) {

388 
buf
[128];

389 
buæ’
;

391 
¦ave
->
psync_š™Ÿl_off£t
 = 
off£t
;

392 
¦ave
->
»¶¡©e
 = 
SLAVE_STATE_WAIT_BGSAVE_END
;

396 
£rv”
.
¦ave£ldb
 = -1;

400 ià(!(
¦ave
->
æags
 & 
CLIENT_PRE_PSYNC
)) {

401 
buæ’
 = 
	`¢´štf
(
buf
,(buf),"+FULLRESYNC %s %lld\r\n",

402 
£rv”
.
runid
,
off£t
);

403 ià(
	`wr™e
(
¦ave
->
fd
,
buf
,
buæ’
) != buflen) {

404 
	`ä“Cl›ÁAsync
(
¦ave
);

405  
C_ERR
;

408  
C_OK
;

409 
	}
}

416 
	$ma¡”TryP¬tŸlResynchrÚiz©iÚ
(
ş›Á
 *
c
) {

417 
psync_off£t
, 
psync_Ën
;

418 *
ma¡”_runid
 = 
c
->
¬gv
[1]->
±r
;

419 
buf
[128];

420 
buæ’
;

425 ià(
	`¡rÿ£cmp
(
ma¡”_runid
, 
£rv”
.
runid
)) {

427 ià(
ma¡”_runid
[0] != '?') {

428 
	`£rv”Log
(
LL_NOTICE
,"Partial„esynchronization‚ot‡ccepted: "

430 
ma¡”_runid
, 
£rv”
.
runid
);

432 
	`£rv”Log
(
LL_NOTICE
,"Full„esync„equested by slave %s",

433 
	`»¶iÿtiÚG‘SÏveName
(
c
));

435 
Ãed_fuÎ_»sync
;

439 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
psync_off£t
,
NULL
) !=

440 
C_OK
è
Ãed_fuÎ_»sync
;

441 ià(!
£rv”
.
»¶_backlog
 ||

442 
psync_off£t
 < 
£rv”
.
»¶_backlog_off
 ||

443 
psync_off£t
 > (
£rv”
.
»¶_backlog_off
 + s”v”.
»¶_backlog_hi¡Ën
))

445 
	`£rv”Log
(
LL_NOTICE
,

446 "UÇbËØ·¹ŸÈ»synøw™h sÏv% fÜ†ack oàbacklog (SÏv»que¡ was: %Îd).", 
	`»¶iÿtiÚG‘SÏveName
(
c
), 
psync_off£t
);

447 ià(
psync_off£t
 > 
£rv”
.
ma¡”_»¶_off£t
) {

448 
	`£rv”Log
(
LL_WARNING
,

449 "W¬nšg: sÏv% Œ›dØPSYNC w™h‡Àoff£ˆth© i g»©”hªhma¡”„•liÿtiÚ off£t.", 
	`»¶iÿtiÚG‘SÏveName
(
c
));

451 
Ãed_fuÎ_»sync
;

458 
c
->
æags
 |ğ
CLIENT_SLAVE
;

459 
c
->
»¶¡©e
 = 
SLAVE_STATE_ONLINE
;

460 
c
->
»¶_ack_time
 = 
£rv”
.
unixtime
;

461 
c
->
»¶_put_Úlše_Ú_ack
 = 0;

462 
	`li¡AddNodeTa
(
£rv”
.
¦aves
,
c
);

466 
buæ’
 = 
	`¢´štf
(
buf
,(buf),"+CONTINUE\r\n");

467 ià(
	`wr™e
(
c
->
fd
,
buf
,
buæ’
) != buflen) {

468 
	`ä“Cl›ÁAsync
(
c
);

469  
C_OK
;

471 
psync_Ën
 = 
	`addR•lyR•liÿtiÚBacklog
(
c
,
psync_off£t
);

472 
	`£rv”Log
(
LL_NOTICE
,

474 
	`»¶iÿtiÚG‘SÏveName
(
c
),

475 
psync_Ën
, 
psync_off£t
);

480 
	`»äeshGoodSÏvesCouÁ
();

481  
C_OK
;

483 
Ãed_fuÎ_»sync
:

488  
C_ERR
;

489 
	}
}

509 
	$¡¬tBg§veFÜR•liÿtiÚ
(
mšÿ·
) {

510 
»tv®
;

511 
sock‘_rg‘
 = 
£rv”
.
»¶_diskËss_sync
 && (
mšÿ·
 & 
SLAVE_CAPA_EOF
);

512 
li¡I‹r
 
li
;

513 
li¡Node
 *
Ê
;

515 
	`£rv”Log
(
LL_NOTICE
,"Starting BGSAVE for SYNC witharget: %s",

516 
sock‘_rg‘
 ? "slaves sockets" : "disk");

518 ià(
sock‘_rg‘
)

519 
»tv®
 = 
	`rdbSaveToSÏvesSock‘s
();

521 
»tv®
 = 
	`rdbSaveBackground
(
£rv”
.
rdb_f’ame
);

526 ià(
»tv®
 =ğ
C_ERR
) {

527 
	`£rv”Log
(
LL_WARNING
,"BGSAVE for„eplication failed");

528 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

529 (
Ê
 = 
	`li¡Next
(&
li
))) {

530 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

532 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) {

533 
¦ave
->
æags
 &ğ~
CLIENT_SLAVE
;

534 
	`li¡D–Node
(
£rv”
.
¦aves
,
Ê
);

535 
	`addR•lyE¼Ü
(
¦ave
,

537 
¦ave
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

540  
»tv®
;

545 ià(!
sock‘_rg‘
) {

546 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

547 (
Ê
 = 
	`li¡Next
(&
li
))) {

548 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

550 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) {

551 
	`»¶iÿtiÚS‘upSÏveFÜFuÎResync
(
¦ave
,

552 
	`g‘PsyncIn™ŸlOff£t
());

559 ià(
»tv®
 =ğ
C_OK
è
	`»¶iÿtiÚSütCacheFlush
();

560  
»tv®
;

561 
	}
}

564 
	$syncCommªd
(
ş›Á
 *
c
) {

566 ià(
c
->
æags
 & 
CLIENT_SLAVE
) ;

570 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¡©e
 !ğ
REPL_STATE_CONNECTED
) {

571 
	`addR•lyE¼Ü
(
c
,"Can't SYNC while‚ot connected with my master");

579 ià(
	`ş›ÁHasP’dšgR•l›s
(
c
)) {

580 
	`addR•lyE¼Ü
(
c
,"SYNC‡nd PSYNC‡re invalid with…ending output");

584 
	`£rv”Log
(
LL_NOTICE
,"Slave %s‡sks for synchronization",

585 
	`»¶iÿtiÚG‘SÏveName
(
c
));

596 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[0]->
±r
,"psync")) {

597 ià(
	`ma¡”TryP¬tŸlResynchrÚiz©iÚ
(
c
è=ğ
C_OK
) {

598 
£rv”
.
¡©_sync_·¹Ÿl_ok
++;

601 *
ma¡”_runid
 = 
c
->
¬gv
[1]->
±r
;

607 ià(
ma¡”_runid
[0] !ğ'?'è
£rv”
.
¡©_sync_·¹Ÿl_”r
++;

613 
c
->
æags
 |ğ
CLIENT_PRE_PSYNC
;

617 
£rv”
.
¡©_sync_fuÎ
++;

621 
c
->
»¶¡©e
 = 
SLAVE_STATE_WAIT_BGSAVE_START
;

622 ià(
£rv”
.
»¶_di§bË_tı_nod–ay
)

623 
	`ª‘Di§bËTıNoD–ay
(
NULL
, 
c
->
fd
);

624 
c
->
»¶dbfd
 = -1;

625 
c
->
æags
 |ğ
CLIENT_SLAVE
;

626 
	`li¡AddNodeTa
(
£rv”
.
¦aves
,
c
);

629 ià(
£rv”
.
rdb_chd_pid
 != -1 &&

630 
£rv”
.
rdb_chd_ty³
 =ğ
RDB_CHILD_TYPE_DISK
)

635 
ş›Á
 *
¦ave
;

636 
li¡Node
 *
Ê
;

637 
li¡I‹r
 
li
;

639 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

640 (
Ê
 = 
	`li¡Next
(&
li
))) {

641 
¦ave
 = 
Ê
->
v®ue
;

642 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_END
) ;

646 ià(
Ê
 && ((
c
->
¦ave_ÿ·
 & 
¦ave
->slave_capa) == slave->slave_capa)) {

649 
	`cİyCl›ÁOuutBufãr
(
c
,
¦ave
);

650 
	`»¶iÿtiÚS‘upSÏveFÜFuÎResync
(
c
,
¦ave
->
psync_š™Ÿl_off£t
);

651 
	`£rv”Log
(
LL_NOTICE
,"Waiting forƒnd of BGSAVE for SYNC");

655 
	`£rv”Log
(
LL_NOTICE
,"Can't‡ttachhe slaveohe current BGSAVE. Waiting for‚ext BGSAVE for SYNC");

659 } ià(
£rv”
.
rdb_chd_pid
 != -1 &&

660 
£rv”
.
rdb_chd_ty³
 =ğ
RDB_CHILD_TYPE_SOCKET
)

665 
	`£rv”Log
(
LL_NOTICE
,"Current BGSAVE has socketarget. Waiting for‚ext BGSAVE for SYNC");

669 ià(
£rv”
.
»¶_diskËss_sync
 && (
c
->
¦ave_ÿ·
 & 
SLAVE_CAPA_EOF
)) {

673 ià(
£rv”
.
»¶_diskËss_sync_d–ay
)

674 
	`£rv”Log
(
LL_NOTICE
,"Delay‚ext BGSAVE for diskless SYNC");

679 ià(
£rv”
.
aof_chd_pid
 == -1) {

680 
	`¡¬tBg§veFÜR•liÿtiÚ
(
c
->
¦ave_ÿ·
);

682 
	`£rv”Log
(
LL_NOTICE
,

689 ià(
	`li¡L’gth
(
£rv”
.
¦aves
è=ğ1 && s”v”.
»¶_backlog
 =ğ
NULL
)

690 
	`ü—‹R•liÿtiÚBacklog
();

692 
	}
}

706 
	$»¶cÚfCommªd
(
ş›Á
 *
c
) {

707 
j
;

709 ià((
c
->
¬gc
 % 2) == 0) {

712 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

717 
j
 = 1; j < 
c
->
¬gc
; j+=2) {

718 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"listening-port")) {

719 
pÜt
;

721 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[
j
+1],

722 &
pÜt
,
NULL
è!ğ
C_OK
))

724 
c
->
¦ave_li¡’šg_pÜt
 = 
pÜt
;

725 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"ip-address")) {

726 
sds
 

 = 
c
->
¬gv
[
j
+1]->
±r
;

727 ià(
	`sd¦’
(

è< (
c
->
¦ave_
)) {

728 
	`memıy
(
c
->
¦ave_
,

,
	`sd¦’
(ip)+1);

730 
	`addR•lyE¼ÜFÜm©
(
c
,"REPLCONF ip-address…rovided by "

731 "¦avš¡ªû i toØlÚg: %zd by‹s", 
	`sd¦’
(

));

734 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"capa")) {

736 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
+1]->
±r
,"eof"))

737 
c
->
¦ave_ÿ·
 |ğ
SLAVE_CAPA_EOF
;

738 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"ack")) {

742 
off£t
;

744 ià(!(
c
->
æags
 & 
CLIENT_SLAVE
)) ;

745 ià((
	`g‘LÚgLÚgFromObjeù
(
c
->
¬gv
[
j
+1], &
off£t
è!ğ
C_OK
))

747 ià(
off£t
 > 
c
->
»¶_ack_off
)

748 
c
->
»¶_ack_off
 = 
off£t
;

749 
c
->
»¶_ack_time
 = 
£rv”
.
unixtime
;

753 ià(
c
->
»¶_put_Úlše_Ú_ack
 && c->
»¶¡©e
 =ğ
SLAVE_STATE_ONLINE
)

754 
	`putSÏveOÆše
(
c
);

757 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"getack")) {

760 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
ma¡”
è
	`»¶iÿtiÚS’dAck
();

763 
	`addR•lyE¼ÜFÜm©
(
c
,"Unrecognized REPLCONF option: %s",

764 (*)
c
->
¬gv
[
j
]->
±r
);

768 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

769 
	}
}

783 
	$putSÏveOÆše
(
ş›Á
 *
¦ave
) {

784 
¦ave
->
»¶¡©e
 = 
SLAVE_STATE_ONLINE
;

785 
¦ave
->
»¶_put_Úlše_Ú_ack
 = 0;

786 
¦ave
->
»¶_ack_time
 = 
£rv”
.
unixtime
;

787 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, 
¦ave
->
fd
, 
AE_WRITABLE
,

788 
£ndR•lyToCl›Á
, 
¦ave
è=ğ
AE_ERR
) {

789 
	`£rv”Log
(
LL_WARNING
,"UÇbËØ»gi¡” wr™abËƒv’ˆfÜ sÏvbulk¿nsãr: %s", 
	`¡»¼Ü
(
”ºo
));

790 
	`ä“Cl›Á
(
¦ave
);

793 
	`»äeshGoodSÏvesCouÁ
();

794 
	`£rv”Log
(
LL_NOTICE
,"Synchronization with slave %s succeeded",

795 
	`»¶iÿtiÚG‘SÏveName
(
¦ave
));

796 
	}
}

798 
	$£ndBulkToSÏve
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

799 
ş›Á
 *
¦ave
 = 
´ivd©a
;

800 
	`UNUSED
(
–
);

801 
	`UNUSED
(
mask
);

802 
buf
[
PROTO_IOBUF_LEN
];

803 
ssize_t
 
nwr™‹n
, 
buæ’
;

808 ià(
¦ave
->
»¶´—mbË
) {

809 
nwr™‹n
 = 
	`wr™e
(
fd
,
¦ave
->
»¶´—mbË
,
	`sd¦’
(slave->replpreamble));

810 ià(
nwr™‹n
 == -1) {

811 
	`£rv”Log
(
LL_VERBOSE
,"Writeƒrror sending RDB…reambleo slave: %s",

812 
	`¡»¼Ü
(
”ºo
));

813 
	`ä“Cl›Á
(
¦ave
);

816 
£rv”
.
¡©_Ãt_ouut_by‹s
 +ğ
nwr™‹n
;

817 
	`sd¤ªge
(
¦ave
->
»¶´—mbË
,
nwr™‹n
,-1);

818 ià(
	`sd¦’
(
¦ave
->
»¶´—mbË
) == 0) {

819 
	`sdsä“
(
¦ave
->
»¶´—mbË
);

820 
¦ave
->
»¶´—mbË
 = 
NULL
;

828 
	`l£ek
(
¦ave
->
»¶dbfd
,¦ave->
»¶dboff
,
SEEK_SET
);

829 
buæ’
 = 
	`»ad
(
¦ave
->
»¶dbfd
,
buf
,
PROTO_IOBUF_LEN
);

830 ià(
buæ’
 <= 0) {

831 
	`£rv”Log
(
LL_WARNING
,"Readƒrror sending DBo slave: %s",

832 (
buæ’
 =ğ0è? "´em©u» EOF" : 
	`¡»¼Ü
(
”ºo
));

833 
	`ä“Cl›Á
(
¦ave
);

836 ià((
nwr™‹n
 = 
	`wr™e
(
fd
,
buf
,
buæ’
)) == -1) {

837 ià(
”ºo
 !ğ
EAGAIN
) {

838 
	`£rv”Log
(
LL_WARNING
,"Writeƒrror sending DBo slave: %s",

839 
	`¡»¼Ü
(
”ºo
));

840 
	`ä“Cl›Á
(
¦ave
);

844 
¦ave
->
»¶dboff
 +ğ
nwr™‹n
;

845 
£rv”
.
¡©_Ãt_ouut_by‹s
 +ğ
nwr™‹n
;

846 ià(
¦ave
->
»¶dboff
 =ğ¦ave->
»¶dbsize
) {

847 
	`şo£
(
¦ave
->
»¶dbfd
);

848 
¦ave
->
»¶dbfd
 = -1;

849 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
¦ave
->
fd
,
AE_WRITABLE
);

850 
	`putSÏveOÆše
(
¦ave
);

852 
	}
}

868 
	$upd©eSÏvesWa™šgBg§ve
(
bg§v“¼
, 
ty³
) {

869 
li¡Node
 *
Ê
;

870 
¡¬tbg§ve
 = 0;

871 
mšÿ·
 = -1;

872 
li¡I‹r
 
li
;

874 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

875 (
Ê
 = 
	`li¡Next
(&
li
))) {

876 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

878 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) {

879 
¡¬tbg§ve
 = 1;

880 
mšÿ·
 = (mšÿ· =ğ-1è? 
¦ave
->
¦ave_ÿ·
 :

881 (
mšÿ·
 & 
¦ave
->
¦ave_ÿ·
);

882 } ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_END
) {

883 
»dis_¡©
 
buf
;

890 ià(
ty³
 =ğ
RDB_CHILD_TYPE_SOCKET
) {

891 
	`£rv”Log
(
LL_NOTICE
,

893 
	`»¶iÿtiÚG‘SÏveName
(
¦ave
));

899 
¦ave
->
»¶¡©e
 = 
SLAVE_STATE_ONLINE
;

900 
¦ave
->
»¶_put_Úlše_Ú_ack
 = 1;

901 
¦ave
->
»¶_ack_time
 = 
£rv”
.
unixtime
;

903 ià(
bg§v“¼
 !ğ
C_OK
) {

904 
	`ä“Cl›Á
(
¦ave
);

905 
	`£rv”Log
(
LL_WARNING
,"SYNC failed. BGSAVE child„eturned‡nƒrror");

908 ià((
¦ave
->
»¶dbfd
 = 
	`İ’
(
£rv”
.
rdb_f’ame
,
O_RDONLY
)) == -1 ||

909 
	`»dis_f¡©
(
¦ave
->
»¶dbfd
,&
buf
) == -1) {

910 
	`ä“Cl›Á
(
¦ave
);

911 
	`£rv”Log
(
LL_WARNING
,"SYNC faed. Cª'ˆİ’/¡© DB‡á” BGSAVE: %s", 
	`¡»¼Ü
(
”ºo
));

914 
¦ave
->
»¶dboff
 = 0;

915 
¦ave
->
»¶dbsize
 = 
buf
.
¡_size
;

916 
¦ave
->
»¶¡©e
 = 
SLAVE_STATE_SEND_BULK
;

917 
¦ave
->
»¶´—mbË
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"$%lld\r\n",

918 (è
¦ave
->
»¶dbsize
);

920 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
¦ave
->
fd
,
AE_WRITABLE
);

921 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, 
¦ave
->
fd
, 
AE_WRITABLE
, 
£ndBulkToSÏve
, sÏveè=ğ
AE_ERR
) {

922 
	`ä“Cl›Á
(
¦ave
);

928 ià(
¡¬tbg§ve
è
	`¡¬tBg§veFÜR•liÿtiÚ
(
mšÿ·
);

929 
	}
}

935 
	$¦aveIsInHªdshakeS‹
() {

936  
£rv”
.
»¶_¡©e
 >ğ
REPL_STATE_RECEIVE_PONG
 &&

937 
£rv”
.
»¶_¡©e
 <ğ
REPL_STATE_RECEIVE_PSYNC
;

938 
	}
}

948 
	$»¶iÿtiÚS’dNewlšeToMa¡”
() {

949 
time_t
 
Ãwlše_£Á
;

950 ià(
	`time
(
NULL
è!ğ
Ãwlše_£Á
) {

951 
Ãwlše_£Á
 = 
	`time
(
NULL
);

952 ià(
	`wr™e
(
£rv”
.
»¶_Œªsãr_s
,"\n",1) == -1) {

956 
	}
}

960 
	$»¶iÿtiÚEm±yDbC®lback
(*
´ivd©a
) {

961 
	`UNUSED
(
´ivd©a
);

962 
	`»¶iÿtiÚS’dNewlšeToMa¡”
();

963 
	}
}

968 
	$»¶iÿtiÚC»©eMa¡”Cl›Á
(
fd
) {

969 
£rv”
.
ma¡”
 = 
	`ü—‹Cl›Á
(
fd
);

970 
£rv”
.
ma¡”
->
æags
 |ğ
CLIENT_MASTER
;

971 
£rv”
.
ma¡”
->
auth’tiÿ‹d
 = 1;

972 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECTED
;

973 
£rv”
.
ma¡”
->
»¶off
 = s”v”.
»¶_ma¡”_š™Ÿl_off£t
;

974 
	`memıy
(
£rv”
.
ma¡”
->
»¶runid
, s”v”.
»¶_ma¡”_runid
,

975 (
£rv”
.
»¶_ma¡”_runid
));

978 ià(
£rv”
.
ma¡”
->
»¶off
 == -1)

979 
£rv”
.
ma¡”
->
æags
 |ğ
CLIENT_PRE_PSYNC
;

980 
	}
}

983 
	#REPL_MAX_WRITTEN_BEFORE_FSYNC
 (1024*1024*8è

	)

984 
	$»adSyncBulkPaylßd
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

985 
buf
[4096];

986 
ssize_t
 
Ä—d
, 
»adËn
;

987 
off_t
 
Ëá
;

988 
	`UNUSED
(
–
);

989 
	`UNUSED
(
´ivd©a
);

990 
	`UNUSED
(
mask
);

994 
eofm¬k
[
CONFIG_RUN_ID_SIZE
];

995 
Ï¡by‹s
[
CONFIG_RUN_ID_SIZE
];

996 
u£m¬k
 = 0;

1000 ià(
£rv”
.
»¶_Œªsãr_size
 == -1) {

1001 ià(
	`syncR—dLše
(
fd
,
buf
,1024,
£rv”
.
»¶_syncio_timeout
*1000) == -1) {

1002 
	`£rv”Log
(
LL_WARNING
,

1004 
	`¡»¼Ü
(
”ºo
));

1005 
”rÜ
;

1008 ià(
buf
[0] == '-') {

1009 
	`£rv”Log
(
LL_WARNING
,

1011 
buf
+1);

1012 
”rÜ
;

1013 } ià(
buf
[0] == '\0') {

1017 
£rv”
.
»¶_Œªsãr_Ï¡io
 = s”v”.
unixtime
;

1019 } ià(
buf
[0] != '$') {

1020 
	`£rv”Log
(
LL_WARNING
,"Bad…rÙocŞ from MASTER,hfœ¡ by‹ i nÙ '$' (w»ûived '%s'),‡» you su»hho¡‡nd…Üˆ¬right?", 
buf
);

1021 
”rÜ
;

1034 ià(
	`¡ºcmp
(
buf
+1,"EOF:",4è=ğ0 && 
	`¡¾’
(buf+5è>ğ
CONFIG_RUN_ID_SIZE
) {

1035 
u£m¬k
 = 1;

1036 
	`memıy
(
eofm¬k
,
buf
+5,
CONFIG_RUN_ID_SIZE
);

1037 
	`mem£t
(
Ï¡by‹s
,0,
CONFIG_RUN_ID_SIZE
);

1040 
£rv”
.
»¶_Œªsãr_size
 = 0;

1041 
	`£rv”Log
(
LL_NOTICE
,

1044 
u£m¬k
 = 0;

1045 
£rv”
.
»¶_Œªsãr_size
 = 
	`¡¹Ş
(
buf
+1,
NULL
,10);

1046 
	`£rv”Log
(
LL_NOTICE
,

1048 (è
£rv”
.
»¶_Œªsãr_size
);

1054 ià(
u£m¬k
) {

1055 
»adËn
 = (
buf
);

1057 
Ëá
 = 
£rv”
.
»¶_Œªsãr_size
 - s”v”.
»¶_Œªsãr_»ad
;

1058 
»adËn
 = (
Ëá
 < (sigÃd)(
buf
)) ?†eft : (signed)(buf);

1061 
Ä—d
 = 
	`»ad
(
fd
,
buf
,
»adËn
);

1062 ià(
Ä—d
 <= 0) {

1063 
	`£rv”Log
(
LL_WARNING
,"I/Oƒrrorryingo sync with MASTER: %s",

1064 (
Ä—d
 =ğ-1è? 
	`¡»¼Ü
(
”ºo
) : "connection†ost");

1065 
	`ÿnûlR•liÿtiÚHªdshake
();

1068 
£rv”
.
¡©_Ãt_šput_by‹s
 +ğ
Ä—d
;

1072 
eof_»ached
 = 0;

1074 ià(
u£m¬k
) {

1076 ià(
Ä—d
 >ğ
CONFIG_RUN_ID_SIZE
) {

1077 
	`memıy
(
Ï¡by‹s
,
buf
+
Ä—d
-
CONFIG_RUN_ID_SIZE
,CONFIG_RUN_ID_SIZE);

1079 
»m
 = 
CONFIG_RUN_ID_SIZE
-
Ä—d
;

1080 
	`memmove
(
Ï¡by‹s
,Ï¡by‹s+
Ä—d
,
»m
);

1081 
	`memıy
(
Ï¡by‹s
+
»m
,
buf
,
Ä—d
);

1083 ià(
	`memcmp
(
Ï¡by‹s
,
eofm¬k
,
CONFIG_RUN_ID_SIZE
è=ğ0è
eof_»ached
 = 1;

1086 
£rv”
.
»¶_Œªsãr_Ï¡io
 = s”v”.
unixtime
;

1087 ià(
	`wr™e
(
£rv”
.
»¶_Œªsãr_fd
,
buf
,
Ä—d
) !=‚read) {

1088 
	`£rv”Log
(
LL_WARNING
,"Wr™”rÜ o¸shÜˆwr™wr™šgØthDB dum°fÃeded fÜ MASTER <-> SLAVE synchrÚiz©iÚ: %s", 
	`¡»¼Ü
(
”ºo
));

1089 
”rÜ
;

1091 
£rv”
.
»¶_Œªsãr_»ad
 +ğ
Ä—d
;

1094 ià(
u£m¬k
 && 
eof_»ached
) {

1095 ià(
	`árunÿ‹
(
£rv”
.
»¶_Œªsãr_fd
,

1096 
£rv”
.
»¶_Œªsãr_»ad
 - 
CONFIG_RUN_ID_SIZE
) == -1)

1098 
	`£rv”Log
(
LL_WARNING
,"E¼ÜrunÿtšghRDB f»ûived fromhma¡” fÜ SYNC: %s", 
	`¡»¼Ü
(
”ºo
));

1099 
”rÜ
;

1106 ià(
£rv”
.
»¶_Œªsãr_»ad
 >=

1107 
£rv”
.
»¶_Œªsãr_Ï¡_fsync_off
 + 
REPL_MAX_WRITTEN_BEFORE_FSYNC
)

1109 
off_t
 
sync_size
 = 
£rv”
.
»¶_Œªsãr_»ad
 -

1110 
£rv”
.
»¶_Œªsãr_Ï¡_fsync_off
;

1111 
	`rdb_fsync_¿nge
(
£rv”
.
»¶_Œªsãr_fd
,

1112 
£rv”
.
»¶_Œªsãr_Ï¡_fsync_off
, 
sync_size
);

1113 
£rv”
.
»¶_Œªsãr_Ï¡_fsync_off
 +ğ
sync_size
;

1117 ià(!
u£m¬k
) {

1118 ià(
£rv”
.
»¶_Œªsãr_»ad
 =ğ£rv”.
»¶_Œªsãr_size
)

1119 
eof_»ached
 = 1;

1122 ià(
eof_»ached
) {

1123 ià(
	`»Çme
(
£rv”
.
»¶_Œªsãr_tmpfe
,£rv”.
rdb_f’ame
) == -1) {

1124 
	`£rv”Log
(
LL_WARNING
,"FaedryšgØ»Çmth‹m°DB iÁØdump.rdb iÀMASTER <-> SLAVE synchrÚiz©iÚ: %s", 
	`¡»¼Ü
(
”ºo
));

1125 
	`ÿnûlR•liÿtiÚHªdshake
();

1128 
	`£rv”Log
(
LL_NOTICE
, "MASTER <-> SLAVE sync: Flushing old data");

1129 
	`sigÇlFlushedDb
(-1);

1130 
	`em±yDb
(

1132 
£rv”
.
»¶_¦ave_Ïzy_æush
 ? 
EMPTYDB_ASYNC
 : 
EMPTYDB_NO_FLAGS
,

1133 
»¶iÿtiÚEm±yDbC®lback
);

1138 
	`«D–‘eFeEv’t
(
£rv”
.
–
,£rv”.
»¶_Œªsãr_s
,
AE_READABLE
);

1139 
	`£rv”Log
(
LL_NOTICE
, "MASTER <-> SLAVE sync: Loading DB in memory");

1140 ià(
	`rdbLßd
(
£rv”
.
rdb_f’ame
è!ğ
C_OK
) {

1141 
	`£rv”Log
(
LL_WARNING
,"Failedryingo†oadhe MASTER synchronization DB from disk");

1142 
	`ÿnûlR•liÿtiÚHªdshake
();

1146 
	`zä“
(
£rv”
.
»¶_Œªsãr_tmpfe
);

1147 
	`şo£
(
£rv”
.
»¶_Œªsãr_fd
);

1148 
	`»¶iÿtiÚC»©eMa¡”Cl›Á
(
£rv”
.
»¶_Œªsãr_s
);

1149 
	`£rv”Log
(
LL_NOTICE
, "MASTER <-> SLAVE sync: Finished with success");

1153 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

1154 
»Œy
 = 10;

1156 
	`¡İAµ’dOÆy
();

1157 
»Œy
-- && 
	`¡¬tAµ’dOÆy
(è=ğ
C_ERR
) {

1158 
	`£rv”Log
(
LL_WARNING
,"Failedƒnablinghe AOF‡fter successful master synchronization! Trying it‡gain in one second.");

1159 
	`¦“p
(1);

1161 ià(!
»Œy
) {

1162 
	`£rv”Log
(
LL_WARNING
,"FATAL:his slave instance finishedhe synchronization with its master, buthe AOF can't beurned on. Exiting‚ow.");

1163 
	`ex™
(1);

1170 
”rÜ
:

1171 
	`ÿnûlR•liÿtiÚHªdshake
();

1173 
	}
}

1181 
	#SYNC_CMD_READ
 (1<<0)

	)

1182 
	#SYNC_CMD_WRITE
 (1<<1)

	)

1183 
	#SYNC_CMD_FULL
 (
SYNC_CMD_READ
|
SYNC_CMD_WRITE
)

	)

1184 *
	$£ndSynchrÚousCommªd
(
æags
, 
fd
, ...) {

1188 ià(
æags
 & 
SYNC_CMD_WRITE
) {

1189 *
¬g
;

1190 
va_li¡
 
­
;

1191 
sds
 
cmd
 = 
	`sd£m±y
();

1192 
	`va_¡¬t
(
­
,
fd
);

1195 
¬g
 = 
	`va_¬g
(
­
, *);

1196 ià(
¬g
 =ğ
NULL
) ;

1198 ià(
	`sd¦’
(
cmd
è!ğ0ècmd = 
	`sdsÿ’
(cmd," ",1);

1199 
cmd
 = 
	`sdsÿt
(cmd,
¬g
);

1201 
cmd
 = 
	`sdsÿ’
(cmd,"\r\n",2);

1204 ià(
	`syncWr™e
(
fd
,
cmd
,
	`sd¦’
(cmd),
£rv”
.
»¶_syncio_timeout
*1000)

1207 
	`sdsä“
(
cmd
);

1208  
	`sdsÿrštf
(
	`sd£m±y
(),"-Writingo master: %s",

1209 
	`¡»¼Ü
(
”ºo
));

1211 
	`sdsä“
(
cmd
);

1212 
	`va_’d
(
­
);

1216 ià(
æags
 & 
SYNC_CMD_READ
) {

1217 
buf
[256];

1219 ià(
	`syncR—dLše
(
fd
,
buf
,(buf),
£rv”
.
»¶_syncio_timeout
*1000)

1222  
	`sdsÿrštf
(
	`sd£m±y
(),"-Reading from master: %s",

1223 
	`¡»¼Ü
(
”ºo
));

1225 
£rv”
.
»¶_Œªsãr_Ï¡io
 = s”v”.
unixtime
;

1226  
	`sd¢ew
(
buf
);

1228  
NULL
;

1229 
	}
}

1278 
	#PSYNC_WRITE_ERROR
 0

	)

1279 
	#PSYNC_WAIT_REPLY
 1

	)

1280 
	#PSYNC_CONTINUE
 2

	)

1281 
	#PSYNC_FULLRESYNC
 3

	)

1282 
	#PSYNC_NOT_SUPPORTED
 4

	)

1283 
	$¦aveTryP¬tŸlResynchrÚiz©iÚ
(
fd
, 
»ad_»¶y
) {

1284 *
psync_runid
;

1285 
psync_off£t
[32];

1286 
sds
 
»¶y
;

1289 ià(!
»ad_»¶y
) {

1295 
£rv”
.
»¶_ma¡”_š™Ÿl_off£t
 = -1;

1297 ià(
£rv”
.
ÿched_ma¡”
) {

1298 
psync_runid
 = 
£rv”
.
ÿched_ma¡”
->
»¶runid
;

1299 
	`¢´štf
(
psync_off£t
,Õsync_off£t),"%Îd", 
£rv”
.
ÿched_ma¡”
->
»¶off
+1);

1300 
	`£rv”Log
(
LL_NOTICE
,"Tryšg‡…¬tŸÈ»synchrÚiz©iÚ (»que¡ %s:%s).", 
psync_runid
, 
psync_off£t
);

1302 
	`£rv”Log
(
LL_NOTICE
,"Partial„esynchronization‚ot…ossible (no cached master)");

1303 
psync_runid
 = "?";

1304 
	`memıy
(
psync_off£t
,"-1",3);

1308 
»¶y
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"PSYNC",
psync_runid
,
psync_off£t
,
NULL
);

1309 ià(
»¶y
 !ğ
NULL
) {

1310 
	`£rv”Log
(
LL_WARNING
,"UÇbËØ£nd PSYNCØma¡”: %s",
»¶y
);

1311 
	`sdsä“
(
»¶y
);

1312 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
);

1313  
PSYNC_WRITE_ERROR
;

1315  
PSYNC_WAIT_REPLY
;

1319 
»¶y
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1320 ià(
	`sd¦’
(
»¶y
) == 0) {

1323 
	`sdsä“
(
»¶y
);

1324  
PSYNC_WAIT_REPLY
;

1327 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
);

1329 ià(!
	`¡ºcmp
(
»¶y
,"+FULLRESYNC",11)) {

1330 *
runid
 = 
NULL
, *
off£t
 = NULL;

1334 
runid
 = 
	`¡rchr
(
»¶y
,' ');

1335 ià(
runid
) {

1336 
runid
++;

1337 
off£t
 = 
	`¡rchr
(
runid
,' ');

1338 ià(
off£t
) offset++;

1340 ià(!
runid
 || !
off£t
 || (off£t-runid-1è!ğ
CONFIG_RUN_ID_SIZE
) {

1341 
	`£rv”Log
(
LL_WARNING
,

1347 
	`mem£t
(
£rv”
.
»¶_ma¡”_runid
,0,
CONFIG_RUN_ID_SIZE
+1);

1349 
	`memıy
(
£rv”
.
»¶_ma¡”_runid
, 
runid
, 
off£t
-runid-1);

1350 
£rv”
.
»¶_ma¡”_runid
[
CONFIG_RUN_ID_SIZE
] = '\0';

1351 
£rv”
.
»¶_ma¡”_š™Ÿl_off£t
 = 
	`¡¹Şl
(
off£t
,
NULL
,10);

1352 
	`£rv”Log
(
LL_NOTICE
,"Full„esync from master: %s:%lld",

1353 
£rv”
.
»¶_ma¡”_runid
,

1354 
£rv”
.
»¶_ma¡”_š™Ÿl_off£t
);

1357 
	`»¶iÿtiÚDisÿrdCachedMa¡”
();

1358 
	`sdsä“
(
»¶y
);

1359  
PSYNC_FULLRESYNC
;

1362 ià(!
	`¡ºcmp
(
»¶y
,"+CONTINUE",9)) {

1364 
	`£rv”Log
(
LL_NOTICE
,

1366 
	`sdsä“
(
»¶y
);

1367 
	`»¶iÿtiÚResu¼eùCachedMa¡”
(
fd
);

1368  
PSYNC_CONTINUE
;

1375 ià(
	`¡ºcmp
(
»¶y
,"-ERR",4)) {

1377 
	`£rv”Log
(
LL_WARNING
,

1378 "UÃx³ùed„•lyØPSYNC from ma¡”: %s", 
»¶y
);

1380 
	`£rv”Log
(
LL_NOTICE
,

1382 "”rÜ s‹ (»¶y: %s)", 
»¶y
);

1384 
	`sdsä“
(
»¶y
);

1385 
	`»¶iÿtiÚDisÿrdCachedMa¡”
();

1386  
PSYNC_NOT_SUPPORTED
;

1387 
	}
}

1389 
	$syncW™hMa¡”
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

1390 
tmpfe
[256], *
”r
 = 
NULL
;

1391 
dfd
, 
maxŒ›s
 = 5;

1392 
sock”r
 = 0, 
psync_»suÉ
;

1393 
sockËn_t
 
”¾’
 = (
sock”r
);

1394 
	`UNUSED
(
–
);

1395 
	`UNUSED
(
´ivd©a
);

1396 
	`UNUSED
(
mask
);

1400 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_NONE
) {

1401 
	`şo£
(
fd
);

1406 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_ERROR
, &
sock”r
, &
”¾’
) == -1)

1407 
sock”r
 = 
”ºo
;

1408 ià(
sock”r
) {

1409 
	`£rv”Log
(
LL_WARNING
,"Error condition on socket for SYNC: %s",

1410 
	`¡»¼Ü
(
sock”r
));

1411 
”rÜ
;

1415 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTING
) {

1416 
	`£rv”Log
(
LL_NOTICE
,"Non blocking connect for SYNC firedheƒvent.");

1419 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
fd
,
AE_WRITABLE
);

1420 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_PONG
;

1423 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"PING",
NULL
);

1424 ià(
”r
è
wr™e_”rÜ
;

1429 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_RECEIVE_PONG
) {

1430 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1437 ià(
”r
[0] != '+' &&

1438 
	`¡ºcmp
(
”r
,"-NOAUTH",7) != 0 &&

1439 
	`¡ºcmp
(
”r
,"-ERR operation‚ot…ermitted",28) != 0)

1441 
	`£rv”Log
(
LL_WARNING
,"E¼Ü„•lyØPING from ma¡”: '%s'",
”r
);

1442 
	`sdsä“
(
”r
);

1443 
”rÜ
;

1445 
	`£rv”Log
(
LL_NOTICE
,

1448 
	`sdsä“
(
”r
);

1449 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_AUTH
;

1453 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_AUTH
) {

1454 ià(
£rv”
.
ma¡”auth
) {

1455 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"AUTH",
£rv”
.
ma¡”auth
,
NULL
);

1456 ià(
”r
è
wr™e_”rÜ
;

1457 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_AUTH
;

1460 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_PORT
;

1465 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_RECEIVE_AUTH
) {

1466 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1467 ià(
”r
[0] == '-') {

1468 
	`£rv”Log
(
LL_WARNING
,"UÇbËØAUTHØMASTER: %s",
”r
);

1469 
	`sdsä“
(
”r
);

1470 
”rÜ
;

1472 
	`sdsä“
(
”r
);

1473 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_PORT
;

1478 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_PORT
) {

1479 
sds
 
pÜt
 = 
	`sdsäomlÚglÚg
(
£rv”
.
¦ave_ªnounû_pÜt
 ?

1480 
£rv”
.
¦ave_ªnounû_pÜt
 : s”v”.
pÜt
);

1481 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"REPLCONF",

1482 "li¡’šg-pÜt",
pÜt
, 
NULL
);

1483 
	`sdsä“
(
pÜt
);

1484 ià(
”r
è
wr™e_”rÜ
;

1485 
	`sdsä“
(
”r
);

1486 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_PORT
;

1491 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_RECEIVE_PORT
) {

1492 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1495 ià(
”r
[0] == '-') {

1496 
	`£rv”Log
(
LL_NOTICE
,"(Non critical) Master does‚ot understand "

1497 "REPLCONF†i¡’šg-pÜt: %s", 
”r
);

1499 
	`sdsä“
(
”r
);

1500 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_IP
;

1504 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_IP
 &&

1505 
£rv”
.
¦ave_ªnounû_
 =ğ
NULL
)

1507 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_CAPA
;

1512 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_IP
) {

1513 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"REPLCONF",

1514 "-add»ss",
£rv”
.
¦ave_ªnounû_
, 
NULL
);

1515 ià(
”r
è
wr™e_”rÜ
;

1516 
	`sdsä“
(
”r
);

1517 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_IP
;

1522 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_RECEIVE_IP
) {

1523 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1526 ià(
”r
[0] == '-') {

1527 
	`£rv”Log
(
LL_NOTICE
,"(Non critical) Master does‚ot understand "

1528 "REPLCONF ip-add»ss: %s", 
”r
);

1530 
	`sdsä“
(
”r
);

1531 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_CAPA
;

1538 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_CAPA
) {

1539 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_WRITE
,
fd
,"REPLCONF",

1540 "ÿ·","eof",
NULL
);

1541 ià(
”r
è
wr™e_”rÜ
;

1542 
	`sdsä“
(
”r
);

1543 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_CAPA
;

1548 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_RECEIVE_CAPA
) {

1549 
”r
 = 
	`£ndSynchrÚousCommªd
(
SYNC_CMD_READ
,
fd
,
NULL
);

1552 ià(
”r
[0] == '-') {

1553 
	`£rv”Log
(
LL_NOTICE
,"(Non critical) Master does‚ot understand "

1554 "REPLCONF c­a: %s", 
”r
);

1556 
	`sdsä“
(
”r
);

1557 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_SEND_PSYNC
;

1565 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_SEND_PSYNC
) {

1566 ià(
	`¦aveTryP¬tŸlResynchrÚiz©iÚ
(
fd
,0è=ğ
PSYNC_WRITE_ERROR
) {

1567 
”r
 = 
	`sd¢ew
("Writeƒrror sendinghe PSYNC command.");

1568 
wr™e_”rÜ
;

1570 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_RECEIVE_PSYNC
;

1575 ià(
£rv”
.
»¶_¡©e
 !ğ
REPL_STATE_RECEIVE_PSYNC
) {

1576 
	`£rv”Log
(
LL_WARNING
,"syncWithMaster(): state machineƒrror, "

1578 
£rv”
.
»¶_¡©e
);

1579 
”rÜ
;

1582 
psync_»suÉ
 = 
	`¦aveTryP¬tŸlResynchrÚiz©iÚ
(
fd
,1);

1583 ià(
psync_»suÉ
 =ğ
PSYNC_WAIT_REPLY
) ;

1588 ià(
psync_»suÉ
 =ğ
PSYNC_CONTINUE
) {

1589 
	`£rv”Log
(
LL_NOTICE
, "MASTER <-> SLAVE sync: Master‡ccepted‡ Partial Resynchronization.");

1597 
	`discÚÃùSÏves
();

1598 
	`ä“R•liÿtiÚBacklog
();

1603 ià(
psync_»suÉ
 =ğ
PSYNC_NOT_SUPPORTED
) {

1604 
	`£rv”Log
(
LL_NOTICE
,"Retrying with SYNC...");

1605 ià(
	`syncWr™e
(
fd
,"SYNC\r\n",6,
£rv”
.
»¶_syncio_timeout
*1000) == -1) {

1606 
	`£rv”Log
(
LL_WARNING
,"I/Oƒrror writingo MASTER: %s",

1607 
	`¡»¼Ü
(
”ºo
));

1608 
”rÜ
;

1613 
maxŒ›s
--) {

1614 
	`¢´štf
(
tmpfe
,256,

1615 "‹mp-%d.%ld.rdb",()
£rv”
.
unixtime
,()
	`g‘pid
());

1616 
dfd
 = 
	`İ’
(
tmpfe
,
O_CREAT
|
O_WRONLY
|
O_EXCL
,0644);

1617 ià(
dfd
 != -1) ;

1618 
	`¦“p
(1);

1620 ià(
dfd
 == -1) {

1621 
	`£rv”Log
(
LL_WARNING
,"O³nšgh‹m°fÃeded fÜ MASTER <-> SLAVE synchrÚiz©iÚ: %s",
	`¡»¼Ü
(
”ºo
));

1622 
”rÜ
;

1626 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
,
fd
, 
AE_READABLE
,
»adSyncBulkPaylßd
,
NULL
)

1627 =ğ
AE_ERR
)

1629 
	`£rv”Log
(
LL_WARNING
,

1631 
	`¡»¼Ü
(
”ºo
),
fd
);

1632 
”rÜ
;

1635 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_TRANSFER
;

1636 
£rv”
.
»¶_Œªsãr_size
 = -1;

1637 
£rv”
.
»¶_Œªsãr_»ad
 = 0;

1638 
£rv”
.
»¶_Œªsãr_Ï¡_fsync_off
 = 0;

1639 
£rv”
.
»¶_Œªsãr_fd
 = 
dfd
;

1640 
£rv”
.
»¶_Œªsãr_Ï¡io
 = s”v”.
unixtime
;

1641 
£rv”
.
»¶_Œªsãr_tmpfe
 = 
	`z¡rdup
(
tmpfe
);

1644 
”rÜ
:

1645 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
|
AE_WRITABLE
);

1646 
	`şo£
(
fd
);

1647 
£rv”
.
»¶_Œªsãr_s
 = -1;

1648 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

1651 
wr™e_”rÜ
:

1652 
	`£rv”Log
(
LL_WARNING
,"S’dšg commªdØma¡” iÀ»¶iÿtiÚ hªdshake: %s", 
”r
);

1653 
	`sdsä“
(
”r
);

1654 
”rÜ
;

1655 
	}
}

1657 
	$cÚÃùW™hMa¡”
() {

1658 
fd
;

1660 
fd
 = 
	`ª‘TıNÚBlockBe¡EffÜtBšdCÚÃù
(
NULL
,

1661 
£rv”
.
ma¡”ho¡
,£rv”.
ma¡”pÜt
,
NET_FIRST_BIND_ADDR
);

1662 ià(
fd
 == -1) {

1663 
	`£rv”Log
(
LL_WARNING
,"Unableo connecto MASTER: %s",

1664 
	`¡»¼Ü
(
”ºo
));

1665  
C_ERR
;

1668 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
|
AE_WRITABLE
,
syncW™hMa¡”
,
NULL
) ==

1669 
AE_ERR
)

1671 
	`şo£
(
fd
);

1672 
	`£rv”Log
(
LL_WARNING
,"Can't create„eadableƒvent for SYNC");

1673  
C_ERR
;

1676 
£rv”
.
»¶_Œªsãr_Ï¡io
 = s”v”.
unixtime
;

1677 
£rv”
.
»¶_Œªsãr_s
 = 
fd
;

1678 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECTING
;

1679  
C_OK
;

1680 
	}
}

1686 
	$undoCÚÃùW™hMa¡”
() {

1687 
fd
 = 
£rv”
.
»¶_Œªsãr_s
;

1689 
	`«D–‘eFeEv’t
(
£rv”
.
–
,
fd
,
AE_READABLE
|
AE_WRITABLE
);

1690 
	`şo£
(
fd
);

1691 
£rv”
.
»¶_Œªsãr_s
 = -1;

1692 
	}
}

1697 
	$»¶iÿtiÚAbÜtSyncT¿nsãr
() {

1698 
	`£rv”As£¹
(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
);

1699 
	`undoCÚÃùW™hMa¡”
();

1700 
	`şo£
(
£rv”
.
»¶_Œªsãr_fd
);

1701 
	`uÆšk
(
£rv”
.
»¶_Œªsãr_tmpfe
);

1702 
	`zä“
(
£rv”
.
»¶_Œªsãr_tmpfe
);

1703 
	}
}

1713 
	$ÿnûlR•liÿtiÚHªdshake
() {

1714 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
) {

1715 
	`»¶iÿtiÚAbÜtSyncT¿nsãr
();

1716 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

1717 } ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTING
 ||

1718 
	`¦aveIsInHªdshakeS‹
())

1720 
	`undoCÚÃùW™hMa¡”
();

1721 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

1726 
	}
}

1729 
	$»¶iÿtiÚS‘Ma¡”
(*

, 
pÜt
) {

1730 
	`sdsä“
(
£rv”
.
ma¡”ho¡
);

1731 
£rv”
.
ma¡”ho¡
 = 
	`sd¢ew
(

);

1732 
£rv”
.
ma¡”pÜt
 = 
pÜt
;

1733 ià(
£rv”
.
ma¡”
è
	`ä“Cl›Á
(server.master);

1734 
	`discÚÃùAÎBlockedCl›Ás
();

1735 
	`discÚÃùSÏves
();

1736 
	`»¶iÿtiÚDisÿrdCachedMa¡”
();

1737 
	`ä“R•liÿtiÚBacklog
();

1738 
	`ÿnûlR•liÿtiÚHªdshake
();

1739 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

1740 
£rv”
.
ma¡”_»¶_off£t
 = 0;

1741 
£rv”
.
»¶_down_sšû
 = 0;

1742 
	}
}

1745 
	$»¶iÿtiÚUn£tMa¡”
() {

1746 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
) ;

1747 
	`sdsä“
(
£rv”
.
ma¡”ho¡
);

1748 
£rv”
.
ma¡”ho¡
 = 
NULL
;

1749 ià(
£rv”
.
ma¡”
) {

1750 ià(
	`li¡L’gth
(
£rv”
.
¦aves
) == 0) {

1755 
£rv”
.
ma¡”_»¶_off£t
 = s”v”.
ma¡”
->
»¶off
;

1756 
	`ä“R•liÿtiÚBacklog
();

1758 
	`ä“Cl›Á
(
£rv”
.
ma¡”
);

1760 
	`»¶iÿtiÚDisÿrdCachedMa¡”
();

1761 
	`ÿnûlR•liÿtiÚHªdshake
();

1762 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_NONE
;

1763 
	}
}

1767 
	$»¶iÿtiÚHªdËMa¡”DiscÚÃùiÚ
() {

1768 
£rv”
.
ma¡”
 = 
NULL
;

1769 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECT
;

1770 
£rv”
.
»¶_down_sšû
 = s”v”.
unixtime
;

1774 
	}
}

1776 
	$¦aveofCommªd
(
ş›Á
 *
c
) {

1779 ià(
£rv”
.
şu¡”_’abËd
) {

1780 
	`addR•lyE¼Ü
(
c
,"SLAVEOF‚ot‡llowed in cluster mode.");

1786 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"no") &&

1787 !
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"one")) {

1788 ià(
£rv”
.
ma¡”ho¡
) {

1789 
	`»¶iÿtiÚUn£tMa¡”
();

1790 
sds
 
ş›Á
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
c
);

1791 
	`£rv”Log
(
LL_NOTICE
,"MASTER MODEƒnabled (user„equest from '%s')",

1792 
ş›Á
);

1793 
	`sdsä“
(
ş›Á
);

1796 
pÜt
;

1798 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
pÜt
, 
NULL
è!ğ
C_OK
))

1802 ià(
£rv”
.
ma¡”ho¡
 && !
	`¡rÿ£cmp
(£rv”.ma¡”ho¡,
c
->
¬gv
[1]->
±r
)

1803 && 
£rv”
.
ma¡”pÜt
 =ğ
pÜt
) {

1804 
	`£rv”Log
(
LL_NOTICE
,"SLAVE OF would„esult into synchronization withhe master we‡re‡lready connected with. No operation…erformed.");

1805 
	`addR•lySds
(
c
,
	`sd¢ew
("+OK Already connectedo specified master\r\n"));

1810 
	`»¶iÿtiÚS‘Ma¡”
(
c
->
¬gv
[1]->
±r
, 
pÜt
);

1811 
sds
 
ş›Á
 = 
	`ÿtCl›ÁInfoSŒšg
(
	`sd£m±y
(),
c
);

1812 
	`£rv”Log
(
LL_NOTICE
,"SLAVE OF %s:%dƒnabled (user„equest from '%s')",

1813 
£rv”
.
ma¡”ho¡
, s”v”.
ma¡”pÜt
, 
ş›Á
);

1814 
	`sdsä“
(
ş›Á
);

1816 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1817 
	}
}

1822 
	$rŞeCommªd
(
ş›Á
 *
c
) {

1823 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
) {

1824 
li¡I‹r
 
li
;

1825 
li¡Node
 *
Ê
;

1826 *
mbcouÁ
;

1827 
¦aves
 = 0;

1829 
	`addR•lyMuÉiBulkL’
(
c
,3);

1830 
	`addR•lyBulkCBufãr
(
c
,"master",6);

1831 
	`addR•lyLÚgLÚg
(
c
,
£rv”
.
ma¡”_»¶_off£t
);

1832 
mbcouÁ
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

1833 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1834 (
Ê
 = 
	`li¡Next
(&
li
))) {

1835 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

1836 

[
NET_IP_STR_LEN
], *
¦ave
 = 
¦ave
->
¦ave_
;

1838 ià(
¦ave
[0] == '\0') {

1839 ià(
	`ª‘P“rToSŒšg
(
¦ave
->
fd
,

,(),
NULL
) == -1)

1841 
¦ave
 = 

;

1843 ià(
¦ave
->
»¶¡©e
 !ğ
SLAVE_STATE_ONLINE
) ;

1844 
	`addR•lyMuÉiBulkL’
(
c
,3);

1845 
	`addR•lyBulkCSŒšg
(
c
,
¦ave
);

1846 
	`addR•lyBulkLÚgLÚg
(
c
,
¦ave
->
¦ave_li¡’šg_pÜt
);

1847 
	`addR•lyBulkLÚgLÚg
(
c
,
¦ave
->
»¶_ack_off
);

1848 
¦aves
++;

1850 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
mbcouÁ
,
¦aves
);

1852 *
¦ave¡©e
 = 
NULL
;

1854 
	`addR•lyMuÉiBulkL’
(
c
,5);

1855 
	`addR•lyBulkCBufãr
(
c
,"slave",5);

1856 
	`addR•lyBulkCSŒšg
(
c
,
£rv”
.
ma¡”ho¡
);

1857 
	`addR•lyLÚgLÚg
(
c
,
£rv”
.
ma¡”pÜt
);

1858 ià(
	`¦aveIsInHªdshakeS‹
()) {

1859 
¦ave¡©e
 = "handshake";

1861 
£rv”
.
»¶_¡©e
) {

1862 
REPL_STATE_NONE
: 
¦ave¡©e
 = "none"; ;

1863 
REPL_STATE_CONNECT
: 
¦ave¡©e
 = "connect"; ;

1864 
REPL_STATE_CONNECTING
: 
¦ave¡©e
 = "connecting"; ;

1865 
REPL_STATE_TRANSFER
: 
¦ave¡©e
 = "sync"; ;

1866 
REPL_STATE_CONNECTED
: 
¦ave¡©e
 = "connected"; ;

1867 : 
¦ave¡©e
 = "unknown"; ;

1870 
	`addR•lyBulkCSŒšg
(
c
,
¦ave¡©e
);

1871 
	`addR•lyLÚgLÚg
(
c
,
£rv”
.
ma¡”
 ? s”v”.ma¡”->
»¶off
 : -1);

1873 
	}
}

1878 
	$»¶iÿtiÚS’dAck
() {

1879 
ş›Á
 *
c
 = 
£rv”
.
ma¡”
;

1881 ià(
c
 !ğ
NULL
) {

1882 
c
->
æags
 |ğ
CLIENT_MASTER_FORCE_REPLY
;

1883 
	`addR•lyMuÉiBulkL’
(
c
,3);

1884 
	`addR•lyBulkCSŒšg
(
c
,"REPLCONF");

1885 
	`addR•lyBulkCSŒšg
(
c
,"ACK");

1886 
	`addR•lyBulkLÚgLÚg
(
c
,c->
»¶off
);

1887 
c
->
æags
 &ğ~
CLIENT_MASTER_FORCE_REPLY
;

1889 
	}
}

1911 
	$»¶iÿtiÚCacheMa¡”
(
ş›Á
 *
c
) {

1912 
	`£rv”As£¹
(
£rv”
.
ma¡”
 !ğ
NULL
 && s”v”.
ÿched_ma¡”
 == NULL);

1913 
	`£rv”Log
(
LL_NOTICE
,"Cachinghe disconnected master state.");

1916 
	`uÆškCl›Á
(
c
);

1920 
£rv”
.
ÿched_ma¡”
 = s”v”.
ma¡”
;

1923 ià(
c
->
³”id
) {

1924 
	`sdsä“
(
c
->
³”id
);

1925 
c
->
³”id
 = 
NULL
;

1931 
	`»¶iÿtiÚHªdËMa¡”DiscÚÃùiÚ
();

1932 
	}
}

1936 
	$»¶iÿtiÚDisÿrdCachedMa¡”
() {

1937 ià(
£rv”
.
ÿched_ma¡”
 =ğ
NULL
) ;

1939 
	`£rv”Log
(
LL_NOTICE
,"Discarding…reviously cached master state.");

1940 
£rv”
.
ÿched_ma¡”
->
æags
 &ğ~
CLIENT_MASTER
;

1941 
	`ä“Cl›Á
(
£rv”
.
ÿched_ma¡”
);

1942 
£rv”
.
ÿched_ma¡”
 = 
NULL
;

1943 
	}
}

1951 
	$»¶iÿtiÚResu¼eùCachedMa¡”
(
Ãwfd
) {

1952 
£rv”
.
ma¡”
 = s”v”.
ÿched_ma¡”
;

1953 
£rv”
.
ÿched_ma¡”
 = 
NULL
;

1954 
£rv”
.
ma¡”
->
fd
 = 
Ãwfd
;

1955 
£rv”
.
ma¡”
->
æags
 &ğ~(
CLIENT_CLOSE_AFTER_REPLY
|
CLIENT_CLOSE_ASAP
);

1956 
£rv”
.
ma¡”
->
auth’tiÿ‹d
 = 1;

1957 
£rv”
.
ma¡”
->
Ï¡š‹¿ùiÚ
 = s”v”.
unixtime
;

1958 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_CONNECTED
;

1961 
	`li¡AddNodeTa
(
£rv”
.
ş›Ás
,£rv”.
ma¡”
);

1962 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, 
Ãwfd
, 
AE_READABLE
,

1963 
»adQu”yFromCl›Á
, 
£rv”
.
ma¡”
)) {

1964 
	`£rv”Log
(
LL_WARNING
,"E¼Ü„esu¼eùšghÿched ma¡”, impossibËØaddh»adabË hªdËr: %s", 
	`¡»¼Ü
(
”ºo
));

1965 
	`ä“Cl›ÁAsync
(
£rv”
.
ma¡”
);

1970 ià(
	`ş›ÁHasP’dšgR•l›s
(
£rv”
.
ma¡”
)) {

1971 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, 
Ãwfd
, 
AE_WRITABLE
,

1972 
£ndR•lyToCl›Á
, 
£rv”
.
ma¡”
)) {

1973 
	`£rv”Log
(
LL_WARNING
,"E¼Ü„esu¼eùšghÿched ma¡”, impossibËØaddhwr™abË hªdËr: %s", 
	`¡»¼Ü
(
”ºo
));

1974 
	`ä“Cl›ÁAsync
(
£rv”
.
ma¡”
);

1977 
	}
}

1984 
	$»äeshGoodSÏvesCouÁ
() {

1985 
li¡I‹r
 
li
;

1986 
li¡Node
 *
Ê
;

1987 
good
 = 0;

1989 ià(!
£rv”
.
»¶_mš_¦aves_to_wr™e
 ||

1990 !
£rv”
.
»¶_mš_¦aves_max_Ïg
) ;

1992 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

1993 (
Ê
 = 
	`li¡Next
(&
li
))) {

1994 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

1995 
time_t
 
Ïg
 = 
£rv”
.
unixtime
 - 
¦ave
->
»¶_ack_time
;

1997 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_ONLINE
 &&

1998 
Ïg
 <ğ
£rv”
.
»¶_mš_¦aves_max_Ïg
è
good
++;

2000 
£rv”
.
»¶_good_¦aves_couÁ
 = 
good
;

2001 
	}
}

2035 
	$»¶iÿtiÚSütCacheIn™
() {

2036 
£rv”
.
»¶_sütÿche_size
 = 10000;

2037 
£rv”
.
»¶_sütÿche_diù
 = 
	`diùC»©e
(&
»¶SütCacheDiùTy³
,
NULL
);

2038 
£rv”
.
»¶_sütÿche_fifo
 = 
	`li¡C»©e
();

2039 
	}
}

2052 
	$»¶iÿtiÚSütCacheFlush
() {

2053 
	`diùEm±y
(
£rv”
.
»¶_sütÿche_diù
,
NULL
);

2054 
	`li¡R–—£
(
£rv”
.
»¶_sütÿche_fifo
);

2055 
£rv”
.
»¶_sütÿche_fifo
 = 
	`li¡C»©e
();

2056 
	}
}

2060 
	$»¶iÿtiÚSütCacheAdd
(
sds
 
sha1
) {

2061 
»tv®
;

2062 
sds
 
key
 = 
	`sdsdup
(
sha1
);

2065 ià(
	`li¡L’gth
(
£rv”
.
»¶_sütÿche_fifo
è=ğ£rv”.
»¶_sütÿche_size
)

2067 
li¡Node
 *
Ê
 = 
	`li¡La¡
(
£rv”
.
»¶_sütÿche_fifo
);

2068 
sds
 
Şde¡
 = 
	`li¡NodeV®ue
(
Ê
);

2070 
»tv®
 = 
	`diùD–‘e
(
£rv”
.
»¶_sütÿche_diù
,
Şde¡
);

2071 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

2072 
	`li¡D–Node
(
£rv”
.
»¶_sütÿche_fifo
,
Ê
);

2076 
»tv®
 = 
	`diùAdd
(
£rv”
.
»¶_sütÿche_diù
,
key
,
NULL
);

2077 
	`li¡AddNodeH—d
(
£rv”
.
»¶_sütÿche_fifo
,
key
);

2078 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

2079 
	}
}

2083 
	$»¶iÿtiÚSütCacheExi¡s
(
sds
 
sha1
) {

2084  
	`diùFšd
(
£rv”
.
»¶_sütÿche_diù
,
sha1
è!ğ
NULL
;

2085 
	}
}

2117 
	$»¶iÿtiÚReque¡AckFromSÏves
() {

2118 
£rv”
.
g‘_ack_äom_¦aves
 = 1;

2119 
	}
}

2123 
	$»¶iÿtiÚCouÁAcksByOff£t
(
off£t
) {

2124 
li¡I‹r
 
li
;

2125 
li¡Node
 *
Ê
;

2126 
couÁ
 = 0;

2128 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

2129 (
Ê
 = 
	`li¡Next
(&
li
))) {

2130 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

2132 ià(
¦ave
->
»¶¡©e
 !ğ
SLAVE_STATE_ONLINE
) ;

2133 ià(
¦ave
->
»¶_ack_off
 >ğ
off£t
è
couÁ
++;

2135  
couÁ
;

2136 
	}
}

2140 
	$wa™Commªd
(
ş›Á
 *
c
) {

2141 
m¡ime_t
 
timeout
;

2142 
num»¶iÿs
, 
ack»¶iÿs
;

2143 
off£t
 = 
c
->
woff
;

2146 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[1],&
num»¶iÿs
,
NULL
è!ğ
C_OK
)

2148 ià(
	`g‘TimeoutFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
timeout
,
UNIT_MILLISECONDS
)

2149 !ğ
C_OK
) ;

2152 
ack»¶iÿs
 = 
	`»¶iÿtiÚCouÁAcksByOff£t
(
c
->
woff
);

2153 ià(
ack»¶iÿs
 >ğ
num»¶iÿs
 || 
c
->
æags
 & 
CLIENT_MULTI
) {

2154 
	`addR•lyLÚgLÚg
(
c
,
ack»¶iÿs
);

2160 
c
->
bpİ
.
timeout
 =imeout;

2161 
c
->
bpİ
.
»¶off£t
 = 
off£t
;

2162 
c
->
bpİ
.
num»¶iÿs
 =‚umreplicas;

2163 
	`li¡AddNodeTa
(
£rv”
.
ş›Ás_wa™šg_acks
,
c
);

2164 
	`blockCl›Á
(
c
,
BLOCKED_WAIT
);

2168 
	`»¶iÿtiÚReque¡AckFromSÏves
();

2169 
	}
}

2175 
	$unblockCl›ÁWa™šgR•liÿs
(
ş›Á
 *
c
) {

2176 
li¡Node
 *
Ê
 = 
	`li¡S—rchKey
(
£rv”
.
ş›Ás_wa™šg_acks
,
c
);

2177 
	`£rv”As£¹
(
Ê
 !ğ
NULL
);

2178 
	`li¡D–Node
(
£rv”
.
ş›Ás_wa™šg_acks
,
Ê
);

2179 
	}
}

2183 
	$´oûssCl›ÁsWa™šgR•liÿs
() {

2184 
Ï¡_off£t
 = 0;

2185 
Ï¡_num»¶iÿs
 = 0;

2187 
li¡I‹r
 
li
;

2188 
li¡Node
 *
Ê
;

2190 
	`li¡Rewšd
(
£rv”
.
ş›Ás_wa™šg_acks
,&
li
);

2191 (
Ê
 = 
	`li¡Next
(&
li
))) {

2192 
ş›Á
 *
c
 = 
Ê
->
v®ue
;

2198 ià(
Ï¡_off£t
 &&†a¡_off£ˆ> 
c
->
bpİ
.
»¶off£t
 &&

2199 
Ï¡_num»¶iÿs
 > 
c
->
bpİ
.
num»¶iÿs
)

2201 
	`unblockCl›Á
(
c
);

2202 
	`addR•lyLÚgLÚg
(
c
,
Ï¡_num»¶iÿs
);

2204 
num»¶iÿs
 = 
	`»¶iÿtiÚCouÁAcksByOff£t
(
c
->
bpİ
.
»¶off£t
);

2206 ià(
num»¶iÿs
 >ğ
c
->
bpİ
.numreplicas) {

2207 
Ï¡_off£t
 = 
c
->
bpİ
.
»¶off£t
;

2208 
Ï¡_num»¶iÿs
 = 
num»¶iÿs
;

2209 
	`unblockCl›Á
(
c
);

2210 
	`addR•lyLÚgLÚg
(
c
,
num»¶iÿs
);

2214 
	}
}

2218 
	$»¶iÿtiÚG‘SÏveOff£t
() {

2219 
off£t
 = 0;

2221 ià(
£rv”
.
ma¡”ho¡
 !ğ
NULL
) {

2222 ià(
£rv”
.
ma¡”
) {

2223 
off£t
 = 
£rv”
.
ma¡”
->
»¶off
;

2224 } ià(
£rv”
.
ÿched_ma¡”
) {

2225 
off£t
 = 
£rv”
.
ÿched_ma¡”
->
»¶off
;

2232 ià(
off£t
 < 0) offset = 0;

2233  
off£t
;

2234 
	}
}

2239 
	$»¶iÿtiÚCrÚ
() {

2240 
»¶iÿtiÚ_üÚ_loİs
 = 0;

2243 ià(
£rv”
.
ma¡”ho¡
 &&

2244 (
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTING
 ||

2245 
	`¦aveIsInHªdshakeS‹
()) &&

2246 (
	`time
(
NULL
)-
£rv”
.
»¶_Œªsãr_Ï¡io
è> s”v”.
»¶_timeout
)

2248 
	`£rv”Log
(
LL_WARNING
,"Timeout connectingohe MASTER...");

2249 
	`ÿnûlR•liÿtiÚHªdshake
();

2253 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
 &&

2254 (
	`time
(
NULL
)-
£rv”
.
»¶_Œªsãr_Ï¡io
è> s”v”.
»¶_timeout
)

2256 
	`£rv”Log
(
LL_WARNING
,"Timeout„eceiving bulk data from MASTER... Ifhe…roblem…ersistsryo sethe 'repl-timeout'…arameter in„edis.confo‡†arger value.");

2257 
	`ÿnûlR•liÿtiÚHªdshake
();

2261 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTED
 &&

2262 (
	`time
(
NULL
)-
£rv”
.
ma¡”
->
Ï¡š‹¿ùiÚ
è> s”v”.
»¶_timeout
)

2264 
	`£rv”Log
(
LL_WARNING
,"MASTERimeout:‚o data‚or PING„eceived...");

2265 
	`ä“Cl›Á
(
£rv”
.
ma¡”
);

2269 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECT
) {

2270 
	`£rv”Log
(
LL_NOTICE
,"Connectingo MASTER %s:%d",

2271 
£rv”
.
ma¡”ho¡
, s”v”.
ma¡”pÜt
);

2272 ià(
	`cÚÃùW™hMa¡”
(è=ğ
C_OK
) {

2273 
	`£rv”Log
(
LL_NOTICE
,"MASTER <-> SLAVE sync started");

2280 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
ma¡”
 &&

2281 !(
£rv”
.
ma¡”
->
æags
 & 
CLIENT_PRE_PSYNC
))

2282 
	`»¶iÿtiÚS’dAck
();

2288 
li¡I‹r
 
li
;

2289 
li¡Node
 *
Ê
;

2290 
robj
 *
pšg_¬gv
[1];

2293 ià((
»¶iÿtiÚ_üÚ_loİs
 % 
£rv”
.
»¶_pšg_¦ave_³riod
) == 0) {

2294 
pšg_¬gv
[0] = 
	`ü—‹SŒšgObjeù
("PING",4);

2295 
	`»¶iÿtiÚF“dSÏves
(
£rv”
.
¦aves
, s”v”.
¦ave£ldb
,

2296 
pšg_¬gv
, 1);

2297 
	`deüRefCouÁ
(
pšg_¬gv
[0]);

2306 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

2307 (
Ê
 = 
	`li¡Next
(&
li
))) {

2308 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

2310 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
 ||

2311 (
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_END
 &&

2312 
£rv”
.
rdb_chd_ty³
 !ğ
RDB_CHILD_TYPE_SOCKET
))

2314 ià(
	`wr™e
(
¦ave
->
fd
, "\n", 1) == -1) {

2321 ià(
	`li¡L’gth
(
£rv”
.
¦aves
)) {

2322 
li¡I‹r
 
li
;

2323 
li¡Node
 *
Ê
;

2325 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

2326 (
Ê
 = 
	`li¡Next
(&
li
))) {

2327 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

2329 ià(
¦ave
->
»¶¡©e
 !ğ
SLAVE_STATE_ONLINE
) ;

2330 ià(
¦ave
->
æags
 & 
CLIENT_PRE_PSYNC
) ;

2331 ià((
£rv”
.
unixtime
 - 
¦ave
->
»¶_ack_time
è> s”v”.
»¶_timeout
)

2333 
	`£rv”Log
(
LL_WARNING
, "Disconnectingimedout slave: %s",

2334 
	`»¶iÿtiÚG‘SÏveName
(
¦ave
));

2335 
	`ä“Cl›Á
(
¦ave
);

2342 ià(
	`li¡L’gth
(
£rv”
.
¦aves
è=ğ0 && s”v”.
»¶_backlog_time_lim™
 &&

2343 
£rv”
.
»¶_backlog
)

2345 
time_t
 
idË
 = 
£rv”
.
unixtime
 - s”v”.
»¶_no_¦aves_sšû
;

2347 ià(
idË
 > 
£rv”
.
»¶_backlog_time_lim™
) {

2348 
	`ä“R•liÿtiÚBacklog
();

2349 
	`£rv”Log
(
LL_NOTICE
,

2352 (è
£rv”
.
»¶_backlog_time_lim™
);

2359 ià(
	`li¡L’gth
(
£rv”
.
¦aves
) == 0 &&

2360 
£rv”
.
aof_¡©e
 =ğ
AOF_OFF
 &&

2361 
	`li¡L’gth
(
£rv”
.
»¶_sütÿche_fifo
) != 0)

2363 
	`»¶iÿtiÚSütCacheFlush
();

2372 ià(
£rv”
.
rdb_chd_pid
 =ğ-1 && s”v”.
aof_chd_pid
 == -1) {

2373 
time_t
 
idË
, 
max_idË
 = 0;

2374 
¦aves_wa™šg
 = 0;

2375 
mšÿ·
 = -1;

2376 
li¡Node
 *
Ê
;

2377 
li¡I‹r
 
li
;

2379 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

2380 (
Ê
 = 
	`li¡Next
(&
li
))) {

2381 
ş›Á
 *
¦ave
 = 
Ê
->
v®ue
;

2382 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_WAIT_BGSAVE_START
) {

2383 
idË
 = 
£rv”
.
unixtime
 - 
¦ave
->
Ï¡š‹¿ùiÚ
;

2384 ià(
idË
 > 
max_idË
) max_idle = idle;

2385 
¦aves_wa™šg
++;

2386 
mšÿ·
 = (mšÿ· =ğ-1è? 
¦ave
->
¦ave_ÿ·
 :

2387 (
mšÿ·
 & 
¦ave
->
¦ave_ÿ·
);

2391 ià(
¦aves_wa™šg
 &&

2392 (!
£rv”
.
»¶_diskËss_sync
 ||

2393 
max_idË
 > 
£rv”
.
»¶_diskËss_sync_d–ay
))

2398 
	`¡¬tBg§veFÜR•liÿtiÚ
(
mšÿ·
);

2403 
	`»äeshGoodSÏvesCouÁ
();

2404 
»¶iÿtiÚ_üÚ_loİs
++;

2405 
	}
}

	@rio.c

48 
	~"fmaüos.h
"

49 
	~<¡ršg.h
>

50 
	~<¡dio.h
>

51 
	~<uni¡d.h
>

52 
	~"rio.h
"

53 
	~"ut.h
"

54 
	~"üc64.h
"

55 
	~"cÚfig.h
"

56 
	~"£rv”.h
"

61 
size_t
 
	$rioBufãrWr™e
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

62 
r
->
io
.
bufãr
.
±r
 = 
	`sdsÿ’
Ô->io.bufãr.±r,(*)
buf
,
Ën
);

63 
r
->
io
.
bufãr
.
pos
 +ğ
Ën
;

65 
	}
}

68 
size_t
 
	$rioBufãrR—d
(
rio
 *
r
, *
buf
, 
size_t
 
Ën
) {

69 ià(
	`sd¦’
(
r
->
io
.
bufãr
.
±r
)-r->io.bufãr.
pos
 < 
Ën
)

71 
	`memıy
(
buf
,
r
->
io
.
bufãr
.
±r
+r->io.bufãr.
pos
,
Ën
);

72 
r
->
io
.
bufãr
.
pos
 +ğ
Ën
;

74 
	}
}

77 
off_t
 
	$rioBufãrT–l
(
rio
 *
r
) {

78  
r
->
io
.
bufãr
.
pos
;

79 
	}
}

83 
	$rioBufãrFlush
(
rio
 *
r
) {

84 
	`UNUSED
(
r
);

86 
	}
}

88 cÚ¡ 
rio
 
	grioBufãrIO
 = {

89 
rioBufãrR—d
,

90 
rioBufãrWr™e
,

91 
rioBufãrT–l
,

92 
rioBufãrFlush
,

93 
NULL
,

97 { { 
NULL
, 0 } }

100 
	$rioIn™W™hBufãr
(
rio
 *
r
, 
sds
 
s
) {

101 *
r
 = 
rioBufãrIO
;

102 
r
->
io
.
bufãr
.
±r
 = 
s
;

103 
r
->
io
.
bufãr
.
pos
 = 0;

104 
	}
}

109 
size_t
 
	$rioFeWr™e
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

110 
size_t
 
»tv®
;

112 
»tv®
 = 
	`fwr™e
(
buf
,
Ën
,1,
r
->
io
.
fe
.
å
);

113 
r
->
io
.
fe
.
bufã»d
 +ğ
Ën
;

115 ià(
r
->
io
.
fe
.
autosync
 &&

116 
r
->
io
.
fe
.
bufã»d
 >ğr->io.fe.
autosync
)

118 
	`fæush
(
r
->
io
.
fe
.
å
);

119 
	`aof_fsync
(
	`f’o
(
r
->
io
.
fe
.
å
));

120 
r
->
io
.
fe
.
bufã»d
 = 0;

122  
»tv®
;

123 
	}
}

126 
size_t
 
	$rioFeR—d
(
rio
 *
r
, *
buf
, 
size_t
 
Ën
) {

127  
	`ä—d
(
buf
,
Ën
,1,
r
->
io
.
fe
.
å
);

128 
	}
}

131 
off_t
 
	$rioFeT–l
(
rio
 *
r
) {

132  
	`á–lo
(
r
->
io
.
fe
.
å
);

133 
	}
}

137 
	$rioFeFlush
(
rio
 *
r
) {

138  (
	`fæush
(
r
->
io
.
fe
.
å
) == 0) ? 1 : 0;

139 
	}
}

141 cÚ¡ 
rio
 
	grioFeIO
 = {

142 
rioFeR—d
,

143 
rioFeWr™e
,

144 
rioFeT–l
,

145 
rioFeFlush
,

146 
NULL
,

150 { { 
NULL
, 0 } }

153 
	$rioIn™W™hFe
(
rio
 *
r
, 
FILE
 *
å
) {

154 *
r
 = 
rioFeIO
;

155 
r
->
io
.
fe
.
å
 = fp;

156 
r
->
io
.
fe
.
bufã»d
 = 0;

157 
r
->
io
.
fe
.
autosync
 = 0;

158 
	}
}

169 
size_t
 
	$rioFd£tWr™e
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

170 
ssize_t
 
»tv®
;

171 
j
;

172 *
p
 = (*è
buf
;

173 
doæush
 = (
buf
 =ğ
NULL
 && 
Ën
 == 0);

177 ià(
Ën
) {

178 
r
->
io
.
fd£t
.
buf
 = 
	`sdsÿ’
Ô->io.fd£t.buf,buf,
Ën
);

179 
Ën
 = 0;

180 ià(
	`sd¦’
(
r
->
io
.
fd£t
.
buf
è> 
PROTO_IOBUF_LEN
è
doæush
 = 1;

183 ià(
doæush
) {

184 
p
 = (*è
r
->
io
.
fd£t
.
buf
;

185 
Ën
 = 
	`sd¦’
(
r
->
io
.
fd£t
.
buf
);

191 
Ën
) {

192 
size_t
 
couÁ
 = 
Ën
 < 1024 ?†en : 1024;

193 
brok’
 = 0;

194 
j
 = 0; j < 
r
->
io
.
fd£t
.
numfds
; j++) {

195 ià(
r
->
io
.
fd£t
.
¡©e
[
j
] != 0) {

197 
brok’
++;

203 
size_t
 
nwr™‹n
 = 0;

204 
nwr™‹n
 !ğ
couÁ
) {

205 
»tv®
 = 
	`wr™e
(
r
->
io
.
fd£t
.
fds
[
j
],
p
+
nwr™‹n
,
couÁ
-nwritten);

206 ià(
»tv®
 <= 0) {

211 ià(
»tv®
 =ğ-1 && 
”ºo
 =ğ
EWOULDBLOCK
è”ºØğ
ETIMEDOUT
;

214 
nwr™‹n
 +ğ
»tv®
;

217 ià(
nwr™‹n
 !ğ
couÁ
) {

219 
r
->
io
.
fd£t
.
¡©e
[
j
] = 
”ºo
;

220 ià(
r
->
io
.
fd£t
.
¡©e
[
j
] =ğ0èr->io.fd£t.¡©e[j] = 
EIO
;

223 ià(
brok’
 =ğ
r
->
io
.
fd£t
.
numfds
)  0;

224 
p
 +ğ
couÁ
;

225 
Ën
 -ğ
couÁ
;

226 
r
->
io
.
fd£t
.
pos
 +ğ
couÁ
;

229 ià(
doæush
è
	`sdsş—r
(
r
->
io
.
fd£t
.
buf
);

231 
	}
}

234 
size_t
 
	$rioFd£tR—d
(
rio
 *
r
, *
buf
, 
size_t
 
Ën
) {

235 
	`UNUSED
(
r
);

236 
	`UNUSED
(
buf
);

237 
	`UNUSED
(
Ën
);

239 
	}
}

242 
off_t
 
	$rioFd£tT–l
(
rio
 *
r
) {

243  
r
->
io
.
fd£t
.
pos
;

244 
	}
}

248 
	$rioFd£tFlush
(
rio
 *
r
) {

251  
	`rioFd£tWr™e
(
r
,
NULL
,0);

252 
	}
}

254 cÚ¡ 
rio
 
	grioFd£tIO
 = {

255 
rioFd£tR—d
,

256 
rioFd£tWr™e
,

257 
rioFd£tT–l
,

258 
rioFd£tFlush
,

259 
NULL
,

263 { { 
NULL
, 0 } }

266 
	$rioIn™W™hFd£t
(
rio
 *
r
, *
fds
, 
numfds
) {

267 
j
;

269 *
r
 = 
rioFd£tIO
;

270 
r
->
io
.
fd£t
.
fds
 = 
	`zm®loc
(()*
numfds
);

271 
r
->
io
.
fd£t
.
¡©e
 = 
	`zm®loc
(()*
numfds
);

272 
	`memıy
(
r
->
io
.
fd£t
.
fds
,fds,()*
numfds
);

273 
j
 = 0; j < 
numfds
; j++è
r
->
io
.
fd£t
.
¡©e
[j] = 0;

274 
r
->
io
.
fd£t
.
numfds
 =‚umfds;

275 
r
->
io
.
fd£t
.
pos
 = 0;

276 
r
->
io
.
fd£t
.
buf
 = 
	`sd£m±y
();

277 
	}
}

280 
	$rioF»eFd£t
(
rio
 *
r
) {

281 
	`zä“
(
r
->
io
.
fd£t
.
fds
);

282 
	`zä“
(
r
->
io
.
fd£t
.
¡©e
);

283 
	`sdsä“
(
r
->
io
.
fd£t
.
buf
);

284 
	}
}

290 
	$rioG’”icUpd©eChecksum
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

291 
r
->
cksum
 = 
	`üc64
Ô->cksum,
buf
,
Ën
);

292 
	}
}

302 
	$rioS‘AutoSync
(
rio
 *
r
, 
off_t
 
by‹s
) {

303 
	`£rv”As£¹
(
r
->
»ad
 =ğ
rioFeIO
.read);

304 
r
->
io
.
fe
.
autosync
 = 
by‹s
;

305 
	}
}

313 
size_t
 
	$rioWr™eBulkCouÁ
(
rio
 *
r
, 
´efix
, 
couÁ
) {

314 
cbuf
[128];

315 
ş’
;

317 
cbuf
[0] = 
´efix
;

318 
ş’
 = 1+
	`Î2¡ršg
(
cbuf
+1,(cbuf)-1,
couÁ
);

319 
cbuf
[
ş’
++] = '\r';

320 
cbuf
[
ş’
++] = '\n';

321 ià(
	`rioWr™e
(
r
,
cbuf
,
ş’
) == 0)  0;

322  
ş’
;

323 
	}
}

326 
size_t
 
	$rioWr™eBulkSŒšg
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

327 
size_t
 
nwr™‹n
;

329 ià((
nwr™‹n
 = 
	`rioWr™eBulkCouÁ
(
r
,'$',
Ën
)) == 0)  0;

330 ià(
Ën
 > 0 && 
	`rioWr™e
(
r
,
buf
,len) == 0)  0;

331 ià(
	`rioWr™e
(
r
,"\r\n",2) == 0)  0;

332  
nwr™‹n
+
Ën
+2;

333 
	}
}

336 
size_t
 
	$rioWr™eBulkLÚgLÚg
(
rio
 *
r
, 
l
) {

337 
lbuf
[32];

338 
Î’
;

340 
Î’
 = 
	`Î2¡ršg
(
lbuf
,Öbuf),
l
);

341  
	`rioWr™eBulkSŒšg
(
r
,
lbuf
,
Î’
);

342 
	}
}

345 
size_t
 
	$rioWr™eBulkDoubË
(
rio
 *
r
, 
d
) {

346 
dbuf
[128];

347 
dËn
;

349 
dËn
 = 
	`¢´štf
(
dbuf
,(dbuf),"%.17g",
d
);

350  
	`rioWr™eBulkSŒšg
(
r
,
dbuf
,
dËn
);

351 
	}
}

	@rio.h

32 #iâdeà
__REDIS_RIO_H


33 
	#__REDIS_RIO_H


	)

35 
	~<¡dio.h
>

36 
	~<¡dšt.h
>

37 
	~"sds.h
"

39 
	s_rio
 {

43 
size_t
 (*
»ad
)(
	m_rio
 *, *
	mbuf
, size_ˆ
	mËn
);

44 
size_t
 (*
wr™e
)(
	m_rio
 *, cÚ¡ *
	mbuf
, size_ˆ
	mËn
);

45 
off_t
 (*
‹Î
)(
	m_rio
 *);

46 (*
	mæush
)(
	m_rio
 *);

52 (*
	mupd©e_cksum
)(
	m_rio
 *, cÚ¡ *
	mbuf
, 
size_t
 
	mËn
);

55 
ušt64_t
 
	mcksum
;

58 
size_t
 
	m´oûs£d_by‹s
;

61 
size_t
 
	mmax_´oûssšg_chunk
;

67 
sds
 
	m±r
;

68 
off_t
 
	mpos
;

69 } 
	mbufãr
;

72 
FILE
 *
	må
;

73 
off_t
 
	mbufã»d
;

74 
off_t
 
	mautosync
;

75 } 
	mfe
;

78 *
	mfds
;

79 *
	m¡©e
;

80 
	mnumfds
;

81 
off_t
 
	mpos
;

82 
sds
 
	mbuf
;

83 } 
	mfd£t
;

84 } 
	mio
;

87 
_rio
 
	trio
;

93 
šlše
 
size_t
 
	$rioWr™e
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
) {

94 
Ën
) {

95 
size_t
 
by‹s_to_wr™e
 = (
r
->
max_´oûssšg_chunk
 &&„->max_´oûssšg_chunk < 
Ën
) ?„->max_processing_chunk :†en;

96 ià(
r
->
upd©e_cksum
èr->
	`upd©e_cksum
Ô,
buf
,
by‹s_to_wr™e
);

97 ià(
r
->
	`wr™e
Ô,
buf
,
by‹s_to_wr™e
) == 0)

99 
buf
 = (*)buà+ 
by‹s_to_wr™e
;

100 
Ën
 -ğ
by‹s_to_wr™e
;

101 
r
->
´oûs£d_by‹s
 +ğ
by‹s_to_wr™e
;

104 
	}
}

106 
šlše
 
size_t
 
	$rioR—d
(
rio
 *
r
, *
buf
, 
size_t
 
Ën
) {

107 
Ën
) {

108 
size_t
 
by‹s_to_»ad
 = (
r
->
max_´oûssšg_chunk
 &&„->max_´oûssšg_chunk < 
Ën
) ?„->max_processing_chunk :†en;

109 ià(
r
->
	`»ad
Ô,
buf
,
by‹s_to_»ad
) == 0)

111 ià(
r
->
upd©e_cksum
èr->
	`upd©e_cksum
Ô,
buf
,
by‹s_to_»ad
);

112 
buf
 = (*)buà+ 
by‹s_to_»ad
;

113 
Ën
 -ğ
by‹s_to_»ad
;

114 
r
->
´oûs£d_by‹s
 +ğ
by‹s_to_»ad
;

117 
	}
}

119 
šlše
 
off_t
 
	$rioT–l
(
rio
 *
r
) {

120  
r
->
	`‹Î
(r);

121 
	}
}

123 
šlše
 
	$rioFlush
(
rio
 *
r
) {

124  
r
->
	`æush
(r);

125 
	}
}

127 
rioIn™W™hFe
(
rio
 *
r
, 
FILE
 *
å
);

128 
rioIn™W™hBufãr
(
rio
 *
r
, 
sds
 
s
);

129 
rioIn™W™hFd£t
(
rio
 *
r
, *
fds
, 
numfds
);

131 
rioF»eFd£t
(
rio
 *
r
);

133 
size_t
 
rioWr™eBulkCouÁ
(
rio
 *
r
, 
´efix
, 
couÁ
);

134 
size_t
 
rioWr™eBulkSŒšg
(
rio
 *
r
, cÚ¡ *
buf
, size_ˆ
Ën
);

135 
size_t
 
rioWr™eBulkLÚgLÚg
(
rio
 *
r
, 
l
);

136 
size_t
 
rioWr™eBulkDoubË
(
rio
 *
r
, 
d
);

138 
	g»disObjeù
;

139 
rioWr™eBulkObjeù
(
rio
 *
r
, 
»disObjeù
 *
obj
);

141 
rioG’”icUpd©eChecksum
(
rio
 *
r
, cÚ¡ *
buf
, 
size_t
 
Ën
);

142 
rioS‘AutoSync
(
rio
 *
r
, 
off_t
 
by‹s
);

	@scripting.c

30 
	~"£rv”.h
"

31 
	~"sha1.h
"

32 
	~"¿nd.h
"

33 
	~"şu¡”.h
"

35 
	~<lua.h
>

36 
	~<Ïuxlib.h
>

37 
	~<lu®ib.h
>

38 
	~<ùy³.h
>

39 
	~<m©h.h
>

41 *
»disPrÙocŞToLuaTy³_IÁ
(
lua_S‹
 *
lua
, *
»¶y
);

42 *
»disPrÙocŞToLuaTy³_Bulk
(
lua_S‹
 *
lua
, *
»¶y
);

43 *
»disPrÙocŞToLuaTy³_Stus
(
lua_S‹
 *
lua
, *
»¶y
);

44 *
»disPrÙocŞToLuaTy³_E¼Ü
(
lua_S‹
 *
lua
, *
»¶y
);

45 *
»disPrÙocŞToLuaTy³_MuÉiBulk
(
lua_S‹
 *
lua
, *
»¶y
);

46 
»dis_m©h_¿ndom
 (
lua_S‹
 *
L
);

47 
»dis_m©h_¿ndom£ed
 (
lua_S‹
 *
L
);

48 
ldbIn™
();

49 
ldbDi§bË
(
ş›Á
 *
c
);

50 
ldbEÇbË
(
ş›Á
 *
c
);

51 
ev®G’”icCommªdW™hDebuggšg
(
ş›Á
 *
c
, 
ev®sha
);

52 
luaLdbLšeHook
(
lua_S‹
 *
lua
, 
lua_Debug
 *
¬
);

53 
ldbLog
(
sds
 
’Œy
);

54 
ldbLogRedisR•ly
(*
»¶y
);

55 
sds
 
ldbC©SckV®ue
(sd 
s
, 
lua_S‹
 *
lua
, 
idx
);

58 
	#LDB_BREAKPOINTS_MAX
 64

	)

59 
	#LDB_MAX_LEN_DEFAULT
 256

	)

60 
	sldbS‹
 {

61 
	mfd
;

62 
	maùive
;

63 
	mfÜked
;

64 
li¡
 *
	mlogs
;

65 
li¡
 *
	mŒaûs
;

66 
li¡
 *
	mchd»n
;

67 
	mbp
[
LDB_BREAKPOINTS_MAX
];

68 
	mbpcouÁ
;

69 
	m¡•
;

70 
	mluabp
;

71 
sds
 *
	m¤c
;

72 
	mlšes
;

73 
	mcu¼’še
;

74 
sds
 
	mcbuf
;

75 
size_t
 
	mmaxËn
;

76 
	mmaxËn_hšt_£Á
;

77 } 
	gldb
;

89 
	$sha1hex
(*
dige¡
, *
süt
, 
size_t
 
Ën
) {

90 
SHA1_CTX
 
ùx
;

91 
hash
[20];

92 *
c£t
 = "0123456789abcdef";

93 
j
;

95 
	`SHA1In™
(&
ùx
);

96 
	`SHA1Upd©e
(&
ùx
,(*)
süt
,
Ën
);

97 
	`SHA1Fš®
(
hash
,&
ùx
);

99 
j
 = 0; j < 20; j++) {

100 
dige¡
[
j
*2] = 
c£t
[((
hash
[j]&0xF0)>>4)];

101 
dige¡
[
j
*2+1] = 
c£t
[(
hash
[j]&0xF)];

103 
dige¡
[40] = '\0';

104 
	}
}

127 *
	$»disPrÙocŞToLuaTy³
(
lua_S‹
 *
lua
, * 
»¶y
) {

128 *
p
 = 
»¶y
;

130 *
p
) {

131 ':': 
p
 = 
	`»disPrÙocŞToLuaTy³_IÁ
(
lua
,
»¶y
); ;

132 '$': 
p
 = 
	`»disPrÙocŞToLuaTy³_Bulk
(
lua
,
»¶y
); ;

133 '+': 
p
 = 
	`»disPrÙocŞToLuaTy³_Stus
(
lua
,
»¶y
); ;

134 '-': 
p
 = 
	`»disPrÙocŞToLuaTy³_E¼Ü
(
lua
,
»¶y
); ;

135 '*': 
p
 = 
	`»disPrÙocŞToLuaTy³_MuÉiBulk
(
lua
,
»¶y
); ;

137  
p
;

138 
	}
}

140 *
	$»disPrÙocŞToLuaTy³_IÁ
(
lua_S‹
 *
lua
, *
»¶y
) {

141 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

142 
v®ue
;

144 
	`¡ršg2Î
(
»¶y
+1,
p
-»¶y-1,&
v®ue
);

145 
	`lua_pushnumb”
(
lua
,(
lua_Numb”
)
v®ue
);

146  
p
+2;

147 
	}
}

149 *
	$»disPrÙocŞToLuaTy³_Bulk
(
lua_S‹
 *
lua
, *
»¶y
) {

150 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

151 
bulkËn
;

153 
	`¡ršg2Î
(
»¶y
+1,
p
-»¶y-1,&
bulkËn
);

154 ià(
bulkËn
 == -1) {

155 
	`lua_pushboŞ—n
(
lua
,0);

156  
p
+2;

158 
	`lua_pushl¡ršg
(
lua
,
p
+2,
bulkËn
);

159  
p
+2+
bulkËn
+2;

161 
	}
}

163 *
	$»disPrÙocŞToLuaTy³_Stus
(
lua_S‹
 *
lua
, *
»¶y
) {

164 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

166 
	`lua_ÃwbË
(
lua
);

167 
	`lua_push¡ršg
(
lua
,"ok");

168 
	`lua_pushl¡ršg
(
lua
,
»¶y
+1,
p
-reply-1);

169 
	`lua_£‰abË
(
lua
,-3);

170  
p
+2;

171 
	}
}

173 *
	$»disPrÙocŞToLuaTy³_E¼Ü
(
lua_S‹
 *
lua
, *
»¶y
) {

174 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

176 
	`lua_ÃwbË
(
lua
);

177 
	`lua_push¡ršg
(
lua
,"err");

178 
	`lua_pushl¡ršg
(
lua
,
»¶y
+1,
p
-reply-1);

179 
	`lua_£‰abË
(
lua
,-3);

180  
p
+2;

181 
	}
}

183 *
	$»disPrÙocŞToLuaTy³_MuÉiBulk
(
lua_S‹
 *
lua
, *
»¶y
) {

184 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

185 
mbulkËn
;

186 
j
 = 0;

188 
	`¡ršg2Î
(
»¶y
+1,
p
-»¶y-1,&
mbulkËn
);

189 
p
 += 2;

190 ià(
mbulkËn
 == -1) {

191 
	`lua_pushboŞ—n
(
lua
,0);

192  
p
;

194 
	`lua_ÃwbË
(
lua
);

195 
j
 = 0; j < 
mbulkËn
; j++) {

196 
	`lua_pushnumb”
(
lua
,
j
+1);

197 
p
 = 
	`»disPrÙocŞToLuaTy³
(
lua
,p);

198 
	`lua_£‰abË
(
lua
,-3);

200  
p
;

201 
	}
}

208 
	$luaPushE¼Ü
(
lua_S‹
 *
lua
, *
”rÜ
) {

209 
lua_Debug
 
dbg
;

213 ià(
ldb
.
aùive
 &&†db.
¡•
) {

214 
	`ldbLog
(
	`sdsÿrštf
(
	`sd£m±y
(),"<”rÜ> %s",
”rÜ
));

217 
	`lua_ÃwbË
(
lua
);

218 
	`lua_push¡ršg
(
lua
,"err");

221 if(
	`lua_g‘¡ack
(
lua
, 1, &
dbg
è&& 
	`lua_g‘šfo
(lua, "nSl", &dbg)) {

222 
sds
 
msg
 = 
	`sdsÿrštf
(
	`sd£m±y
(), "%s: %d: %s",

223 
dbg
.
sourû
, dbg.
cu¼’še
, 
”rÜ
);

224 
	`lua_push¡ršg
(
lua
, 
msg
);

225 
	`sdsä“
(
msg
);

227 
	`lua_push¡ršg
(
lua
, 
”rÜ
);

229 
	`lua_£‰abË
(
lua
,-3);

230 
	}
}

236 
	$luaRai£E¼Ü
(
lua_S‹
 *
lua
) {

237 
	`lua_push¡ršg
(
lua
,"err");

238 
	`lua_g‘bË
(
lua
,-2);

239  
	`lua_”rÜ
(
lua
);

240 
	}
}

248 
	$luaSÜtA¼ay
(
lua_S‹
 *
lua
) {

250 
	`lua_g‘glob®
(
lua
,"table");

251 
	`lua_push¡ršg
(
lua
,"sort");

252 
	`lua_g‘bË
(
lua
,-2);

253 
	`lua_pushv®ue
(
lua
,-3);

254 ià(
	`lua_pÿÎ
(
lua
,1,0,0)) {

261 
	`lua_pİ
(
lua
,1);

262 
	`lua_push¡ršg
(
lua
,"sort");

263 
	`lua_g‘bË
(
lua
,-2);

264 
	`lua_pushv®ue
(
lua
,-3);

265 
	`lua_g‘glob®
(
lua
,"__redis__compare_helper");

267 
	`lua_ÿÎ
(
lua
,2,0);

270 
	`lua_pİ
(
lua
,1);

271 
	}
}

277 
	$luaR•lyToRedisR•ly
(
ş›Á
 *
c
, 
lua_S‹
 *
lua
) {

278 
t
 = 
	`lua_ty³
(
lua
,-1);

280 
t
) {

281 
LUA_TSTRING
:

282 
	`addR•lyBulkCBufãr
(
c
,(*)
	`lua_to¡ršg
(
lua
,-1),
	`lua_¡¾’
(lua,-1));

284 
LUA_TBOOLEAN
:

285 
	`addR•ly
(
c
,
	`lua_toboŞ—n
(
lua
,-1è? 
sh¬ed
.
cÚe
 : sh¬ed.
nuÎbulk
);

287 
LUA_TNUMBER
:

288 
	`addR•lyLÚgLÚg
(
c
,()
	`lua_tÚumb”
(
lua
,-1));

290 
LUA_TTABLE
:

295 
	`lua_push¡ršg
(
lua
,"err");

296 
	`lua_g‘bË
(
lua
,-2);

297 
t
 = 
	`lua_ty³
(
lua
,-1);

298 ià(
t
 =ğ
LUA_TSTRING
) {

299 
sds
 
”r
 = 
	`sd¢ew
(
	`lua_to¡ršg
(
lua
,-1));

300 
	`sdsm­ch¬s
(
”r
,"\r\n"," ",2);

301 
	`addR•lySds
(
c
,
	`sdsÿrštf
(
	`sd£m±y
(),"-%s\r\n",
”r
));

302 
	`sdsä“
(
”r
);

303 
	`lua_pİ
(
lua
,2);

307 
	`lua_pİ
(
lua
,1);

308 
	`lua_push¡ršg
(
lua
,"ok");

309 
	`lua_g‘bË
(
lua
,-2);

310 
t
 = 
	`lua_ty³
(
lua
,-1);

311 ià(
t
 =ğ
LUA_TSTRING
) {

312 
sds
 
ok
 = 
	`sd¢ew
(
	`lua_to¡ršg
(
lua
,-1));

313 
	`sdsm­ch¬s
(
ok
,"\r\n"," ",2);

314 
	`addR•lySds
(
c
,
	`sdsÿrštf
(
	`sd£m±y
(),"+%s\r\n",
ok
));

315 
	`sdsä“
(
ok
);

316 
	`lua_pİ
(
lua
,1);

318 *
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

319 
j
 = 1, 
mbulkËn
 = 0;

321 
	`lua_pİ
(
lua
,1);

323 
	`lua_pushnumb”
(
lua
,
j
++);

324 
	`lua_g‘bË
(
lua
,-2);

325 
t
 = 
	`lua_ty³
(
lua
,-1);

326 ià(
t
 =ğ
LUA_TNIL
) {

327 
	`lua_pİ
(
lua
,1);

330 
	`luaR•lyToRedisR•ly
(
c
, 
lua
);

331 
mbulkËn
++;

333 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
mbulkËn
);

337 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

339 
	`lua_pİ
(
lua
,1);

340 
	}
}

346 
	#LUA_CMD_OBJCACHE_SIZE
 32

	)

347 
	#LUA_CMD_OBJCACHE_MAX_LEN
 64

	)

348 
	$luaRedisG’”icCommªd
(
lua_S‹
 *
lua
, 
¿i£_”rÜ
) {

349 
j
, 
¬gc
 = 
	`lua_g‘tİ
(
lua
);

350 
»disCommªd
 *
cmd
;

351 
ş›Á
 *
c
 = 
£rv”
.
lua_ş›Á
;

352 
sds
 
»¶y
;

355 
robj
 **
¬gv
 = 
NULL
;

356 
¬gv_size
 = 0;

357 
robj
 *
ÿched_objeùs
[
LUA_CMD_OBJCACHE_SIZE
];

358 
size_t
 
ÿched_objeùs_Ën
[
LUA_CMD_OBJCACHE_SIZE
];

359 
šu£
 = 0;

365 ià(
šu£
) {

366 *
»cursiÚ_w¬nšg
 =

369 
	`£rv”Log
(
LL_WARNING
,"%s",
»cursiÚ_w¬nšg
);

370 
	`luaPushE¼Ü
(
lua
,
»cursiÚ_w¬nšg
);

373 
šu£
++;

376 ià(
¬gc
 == 0) {

377 
	`luaPushE¼Ü
(
lua
,

379 
šu£
--;

380  
¿i£_”rÜ
 ? 
	`luaRai£E¼Ü
(
lua
) : 1;

384 ià(
¬gv_size
 < 
¬gc
) {

385 
¬gv
 = 
	`z»®loc
×rgv,(
robj
*)*
¬gc
);

386 
¬gv_size
 = 
¬gc
;

389 
j
 = 0; j < 
¬gc
; j++) {

390 *
obj_s
;

391 
size_t
 
obj_Ën
;

392 
dbuf
[64];

394 ià(
	`lua_ty³
(
lua
,
j
+1è=ğ
LUA_TNUMBER
) {

397 
lua_Numb”
 
num
 = 
	`lua_tÚumb”
(
lua
,
j
+1);

399 
obj_Ën
 = 
	`¢´štf
(
dbuf
,(dbuf),"%.17g",()
num
);

400 
obj_s
 = 
dbuf
;

402 
obj_s
 = (*)
	`lua_tŞ¡ršg
(
lua
,
j
+1,&
obj_Ën
);

403 ià(
obj_s
 =ğ
NULL
) ;

407 ià(
j
 < 
LUA_CMD_OBJCACHE_SIZE
 && 
ÿched_objeùs
[j] &&

408 
ÿched_objeùs_Ën
[
j
] >ğ
obj_Ën
)

410 
sds
 
s
 = 
ÿched_objeùs
[
j
]->
±r
;

411 
¬gv
[
j
] = 
ÿched_objeùs
[j];

412 
ÿched_objeùs
[
j
] = 
NULL
;

413 
	`memıy
(
s
,
obj_s
,
obj_Ën
+1);

414 
	`sds£’
(
s
, 
obj_Ën
);

416 
¬gv
[
j
] = 
	`ü—‹SŒšgObjeù
(
obj_s
, 
obj_Ën
);

423 ià(
j
 !ğ
¬gc
) {

424 
j
--;

425 
j
 >= 0) {

426 
	`deüRefCouÁ
(
¬gv
[
j
]);

427 
j
--;

429 
	`luaPushE¼Ü
(
lua
,

431 
šu£
--;

432  
¿i£_”rÜ
 ? 
	`luaRai£E¼Ü
(
lua
) : 1;

436 
c
->
¬gv
 =‡rgv;

437 
c
->
¬gc
 =‡rgc;

440 ià(
ldb
.
aùive
 &&†db.
¡•
) {

441 
sds
 
cmdlog
 = 
	`sd¢ew
("<redis>");

442 
j
 = 0; j < 
c
->
¬gc
; j++) {

443 ià(
j
 == 10) {

444 
cmdlog
 = 
	`sdsÿrštf
(cmdlog," ... (%d more)",

445 
c
->
¬gc
-
j
-1);

447 
cmdlog
 = 
	`sdsÿ’
(cmdlog," ",1);

448 
cmdlog
 = 
	`sdsÿtsds
(cmdlog,
c
->
¬gv
[
j
]->
±r
);

451 
	`ldbLog
(
cmdlog
);

455 
cmd
 = 
	`lookupCommªd
(
¬gv
[0]->
±r
);

456 ià(!
cmd
 || ((cmd->
¬™y
 > 0 && cmd->¬™y !ğ
¬gc
) ||

457 (
¬gc
 < -
cmd
->
¬™y
)))

459 ià(
cmd
)

460 
	`luaPushE¼Ü
(
lua
,

463 
	`luaPushE¼Ü
(
lua
,"Unknown Redis command called from Lua script");

464 
ş—nup
;

466 
c
->
cmd
 = c->
Ï¡cmd
 = cmd;

469 ià(
cmd
->
æags
 & 
CMD_NOSCRIPT
) {

470 
	`luaPushE¼Ü
(
lua
, "This Redis command is‚ot‡llowed from scripts");

471 
ş—nup
;

477 ià(
cmd
->
æags
 & 
CMD_WRITE
) {

478 ià(
£rv”
.
lua_¿ndom_dœty
 && !£rv”.
lua_»¶iÿ‹_commªds
) {

479 
	`luaPushE¼Ü
(
lua
,

481 
ş—nup
;

482 } ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¦ave_ro
 &&

483 !
£rv”
.
lßdšg
 &&

484 !(
£rv”
.
lua_ÿÎ”
->
æags
 & 
CLIENT_MASTER
))

486 
	`luaPushE¼Ü
(
lua
, 
sh¬ed
.
ro¦av“¼
->
±r
);

487 
ş—nup
;

488 } ià(
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
 &&

489 
£rv”
.
§v•¬am¦’
 > 0 &&

490 
£rv”
.
Ï¡bg§ve_¡©us
 =ğ
C_ERR
)

492 
	`luaPushE¼Ü
(
lua
, 
sh¬ed
.
bg§v“¼
->
±r
);

493 
ş—nup
;

501 ià(
£rv”
.
maxmemÜy
 && s”v”.
lua_wr™e_dœty
 == 0 &&

502 (
cmd
->
æags
 & 
CMD_DENYOOM
))

504 ià(
	`ä“MemÜyIfN“ded
(è=ğ
C_ERR
) {

505 
	`luaPushE¼Ü
(
lua
, 
sh¬ed
.
oom”r
->
±r
);

506 
ş—nup
;

510 ià(
cmd
->
æags
 & 
CMD_RANDOM
è
£rv”
.
lua_¿ndom_dœty
 = 1;

511 ià(
cmd
->
æags
 & 
CMD_WRITE
è
£rv”
.
lua_wr™e_dœty
 = 1;

516 ià(
£rv”
.
şu¡”_’abËd
 && !£rv”.
lßdšg
 &&

517 !(
£rv”
.
lua_ÿÎ”
->
æags
 & 
CLIENT_MASTER
))

520 
c
->
æags
 &ğ~(
CLIENT_READONLY
|
CLIENT_ASKING
);

521 
c
->
æags
 |ğ
£rv”
.
lua_ÿÎ”
->æag & (
CLIENT_READONLY
|
CLIENT_ASKING
);

522 ià(
	`g‘NodeByQu”y
(
c
,c->
cmd
,c->
¬gv
,c->
¬gc
,
NULL
,NULL) !=

523 
£rv”
.
şu¡”
->
my£lf
)

525 
	`luaPushE¼Ü
(
lua
,

528 
ş—nup
;

535 ià(
£rv”
.
lua_»¶iÿ‹_commªds
 &&

536 !
£rv”
.
lua_muÉi_em™‹d
 &&

537 
£rv”
.
lua_wr™e_dœty
 &&

538 
£rv”
.
lua_»¶
 !ğ
PROPAGATE_NONE
)

540 
	`execCommªdPrİag©eMuÉi
(
£rv”
.
lua_ÿÎ”
);

541 
£rv”
.
lua_muÉi_em™‹d
 = 1;

545 
ÿÎ_æags
 = 
CMD_CALL_SLOWLOG
 | 
CMD_CALL_STATS
;

546 ià(
£rv”
.
lua_»¶iÿ‹_commªds
) {

548 ià(
£rv”
.
lua_»¶
 & 
PROPAGATE_AOF
)

549 
ÿÎ_æags
 |ğ
CMD_CALL_PROPAGATE_AOF
;

550 ià(
£rv”
.
lua_»¶
 & 
PROPAGATE_REPL
)

551 
ÿÎ_æags
 |ğ
CMD_CALL_PROPAGATE_REPL
;

553 
	`ÿÎ
(
c
,
ÿÎ_æags
);

558 ià(
	`li¡L’gth
(
c
->
»¶y
è=ğ0 && c->
buåos
 < 
PROTO_REPLY_CHUNK_BYTES
) {

562 
c
->
buf
[c->
buåos
] = '\0';

563 
»¶y
 = 
c
->
buf
;

564 
c
->
buåos
 = 0;

566 
»¶y
 = 
	`sd¢ewËn
(
c
->
buf
,c->
buåos
);

567 
c
->
buåos
 = 0;

568 
	`li¡L’gth
(
c
->
»¶y
)) {

569 
sds
 
o
 = 
	`li¡NodeV®ue
(
	`li¡Fœ¡
(
c
->
»¶y
));

571 
»¶y
 = 
	`sdsÿtsds
Ô•ly,
o
);

572 
	`li¡D–Node
(
c
->
»¶y
,
	`li¡Fœ¡
(c->reply));

575 ià(
¿i£_”rÜ
 && 
»¶y
[0] != '-')„aise_error = 0;

576 
	`»disPrÙocŞToLuaTy³
(
lua
,
»¶y
);

579 ià(
ldb
.
aùive
 &&†db.
¡•
)

580 
	`ldbLogRedisR•ly
(
»¶y
);

584 ià((
cmd
->
æags
 & 
CMD_SORT_FOR_SCRIPT
) &&

585 (
£rv”
.
lua_»¶iÿ‹_commªds
 == 0) &&

586 (
»¶y
[0] == '*' &&„eply[1] != '-')) {

587 
	`luaSÜtA¼ay
(
lua
);

589 ià(
»¶y
 !ğ
c
->
buf
è
	`sdsä“
(reply);

590 
c
->
»¶y_by‹s
 = 0;

592 
ş—nup
:

595 
j
 = 0; j < 
c
->
¬gc
; j++) {

596 
robj
 *
o
 = 
c
->
¬gv
[
j
];

601 ià(
j
 < 
LUA_CMD_OBJCACHE_SIZE
 &&

602 
o
->
»fcouÁ
 == 1 &&

603 (
o
->
’codšg
 =ğ
OBJ_ENCODING_RAW
 ||

604 
o
->
’codšg
 =ğ
OBJ_ENCODING_EMBSTR
) &&

605 
	`sd¦’
(
o
->
±r
è<ğ
LUA_CMD_OBJCACHE_MAX_LEN
)

607 
sds
 
s
 = 
o
->
±r
;

608 ià(
ÿched_objeùs
[
j
]è
	`deüRefCouÁ
(cached_objects[j]);

609 
ÿched_objeùs
[
j
] = 
o
;

610 
ÿched_objeùs_Ën
[
j
] = 
	`sd§Îoc
(
s
);

612 
	`deüRefCouÁ
(
o
);

616 ià(
c
->
¬gv
 !=‡rgv) {

617 
	`zä“
(
c
->
¬gv
);

618 
¬gv
 = 
NULL
;

619 
¬gv_size
 = 0;

622 ià(
¿i£_”rÜ
) {

626 
šu£
--;

627  
	`luaRai£E¼Ü
(
lua
);

629 
šu£
--;

631 
	}
}

634 
	$luaRedisC®lCommªd
(
lua_S‹
 *
lua
) {

635  
	`luaRedisG’”icCommªd
(
lua
,1);

636 
	}
}

639 
	$luaRedisPC®lCommªd
(
lua_S‹
 *
lua
) {

640  
	`luaRedisG’”icCommªd
(
lua
,0);

641 
	}
}

645 
	$luaRedisSha1hexCommªd
(
lua_S‹
 *
lua
) {

646 
¬gc
 = 
	`lua_g‘tİ
(
lua
);

647 
dige¡
[41];

648 
size_t
 
Ën
;

649 *
s
;

651 ià(
¬gc
 != 1) {

652 
	`lua_push¡ršg
(
lua
, "wrong‚umber of‡rguments");

653  
	`lua_”rÜ
(
lua
);

656 
s
 = (*)
	`lua_tŞ¡ršg
(
lua
,1,&
Ën
);

657 
	`sha1hex
(
dige¡
,
s
,
Ën
);

658 
	`lua_push¡ršg
(
lua
,
dige¡
);

660 
	}
}

669 
	$luaRedisR‘uºSšgËF›ldTabË
(
lua_S‹
 *
lua
, *
f›ld
) {

670 ià(
	`lua_g‘tİ
(
lua
è!ğ1 || 
	`lua_ty³
Öua,-1è!ğ
LUA_TSTRING
) {

671 
	`luaPushE¼Ü
(
lua
, "wrong‚umber orype of‡rguments");

675 
	`lua_ÃwbË
(
lua
);

676 
	`lua_push¡ršg
(
lua
, 
f›ld
);

677 
	`lua_pushv®ue
(
lua
, -3);

678 
	`lua_£‰abË
(
lua
, -3);

680 
	}
}

683 
	$luaRedisE¼ÜR•lyCommªd
(
lua_S‹
 *
lua
) {

684  
	`luaRedisR‘uºSšgËF›ldTabË
(
lua
,"err");

685 
	}
}

688 
	$luaRedisStusR•lyCommªd
(
lua_S‹
 *
lua
) {

689  
	`luaRedisR‘uºSšgËF›ldTabË
(
lua
,"ok");

690 
	}
}

698 
	$luaRedisR•liÿ‹CommªdsCommªd
(
lua_S‹
 *
lua
) {

699 ià(
£rv”
.
lua_wr™e_dœty
) {

700 
	`lua_pushboŞ—n
(
lua
,0);

702 
£rv”
.
lua_»¶iÿ‹_commªds
 = 1;

706 
	`»disS¿nd48
(
	`¿nd
());

707 
	`lua_pushboŞ—n
(
lua
,1);

710 
	}
}

717 
	$luaRedisB»akpoštCommªd
(
lua_S‹
 *
lua
) {

718 ià(
ldb
.
aùive
) {

719 
ldb
.
luabp
 = 1;

720 
	`lua_pushboŞ—n
(
lua
,1);

722 
	`lua_pushboŞ—n
(
lua
,0);

725 
	}
}

732 
	$luaRedisDebugCommªd
(
lua_S‹
 *
lua
) {

733 ià(!
ldb
.
aùive
)  0;

734 
¬gc
 = 
	`lua_g‘tİ
(
lua
);

735 
sds
 
log
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"<debug>†š%d: ", 
ldb
.
cu¼’še
);

736 
¬gc
--) {

737 
log
 = 
	`ldbC©SckV®ue
Öog,
lua
,-1 - 
¬gc
);

738 ià(
¬gc
 !ğ0è
log
 = 
	`sdsÿ’
(log,", ",2);

740 
	`ldbLog
(
log
);

742 
	}
}

748 
	$luaRedisS‘R•lCommªd
(
lua_S‹
 *
lua
) {

749 
¬gc
 = 
	`lua_g‘tİ
(
lua
);

750 
æags
;

752 ià(
£rv”
.
lua_»¶iÿ‹_commªds
 == 0) {

753 
	`lua_push¡ršg
(
lua
, "You can sethe„eplication behavior only‡fterurning on single commands„eplication with„edis.replicate_commands().");

754  
	`lua_”rÜ
(
lua
);

755 } ià(
¬gc
 != 1) {

756 
	`lua_push¡ršg
(
lua
, "redis.set_repl()„equireswo‡rguments.");

757  
	`lua_”rÜ
(
lua
);

760 
æags
 = 
	`lua_tÚumb”
(
lua
,-1);

761 ià((
æags
 & ~(
PROPAGATE_AOF
|
PROPAGATE_REPL
)) != 0) {

762 
	`lua_push¡ršg
(
lua
, "Invalid„eplication flags. Use REPL_AOF, REPL_SLAVE, REPL_ALL or REPL_NONE.");

763  
	`lua_”rÜ
(
lua
);

765 
£rv”
.
lua_»¶
 = 
æags
;

767 
	}
}

770 
	$luaLogCommªd
(
lua_S‹
 *
lua
) {

771 
j
, 
¬gc
 = 
	`lua_g‘tİ
(
lua
);

772 
Ëv–
;

773 
sds
 
log
;

775 ià(
¬gc
 < 2) {

776 
	`lua_push¡ršg
(
lua
, "redis.log()„equireswo‡rguments or more.");

777  
	`lua_”rÜ
(
lua
);

778 } ià(!
	`lua_i¢umb”
(
lua
,-
¬gc
)) {

779 
	`lua_push¡ršg
(
lua
, "First‡rgument must be‡‚umber (log†evel).");

780  
	`lua_”rÜ
(
lua
);

782 
Ëv–
 = 
	`lua_tÚumb”
(
lua
,-
¬gc
);

783 ià(
Ëv–
 < 
LL_DEBUG
 ||†ev– > 
LL_WARNING
) {

784 
	`lua_push¡ršg
(
lua
, "Invalid debug†evel.");

785  
	`lua_”rÜ
(
lua
);

789 
log
 = 
	`sd£m±y
();

790 
j
 = 1; j < 
¬gc
; j++) {

791 
size_t
 
Ën
;

792 *
s
;

794 
s
 = (*)
	`lua_tŞ¡ršg
(
lua
,(-
¬gc
)+
j
,&
Ën
);

795 ià(
s
) {

796 ià(
j
 !ğ1è
log
 = 
	`sdsÿ’
(log," ",1);

797 
log
 = 
	`sdsÿ’
Öog,
s
,
Ën
);

800 
	`£rv”LogRaw
(
Ëv–
,
log
);

801 
	`sdsä“
(
log
);

803 
	}
}

809 
	$luaLßdLib
(
lua_S‹
 *
lua
, cÚ¡ *
libÇme
, 
lua_CFunùiÚ
 
luafunc
) {

810 
	`lua_pushcfunùiÚ
(
lua
, 
luafunc
);

811 
	`lua_push¡ršg
(
lua
, 
libÇme
);

812 
	`lua_ÿÎ
(
lua
, 1, 0);

813 
	}
}

815 
LUALIB_API
 (
luaİ’_cjsÚ
è(
lua_S‹
 *
L
);

816 
LUALIB_API
 (
luaİ’_¡ruù
è(
lua_S‹
 *
L
);

817 
LUALIB_API
 (
luaİ’_cmsg·ck
è(
lua_S‹
 *
L
);

818 
LUALIB_API
 (
luaİ’_b™
è(
lua_S‹
 *
L
);

820 
	$luaLßdLib¿r›s
(
lua_S‹
 *
lua
) {

821 
	`luaLßdLib
(
lua
, "", 
luaİ’_ba£
);

822 
	`luaLßdLib
(
lua
, 
LUA_TABLIBNAME
, 
luaİ’_bË
);

823 
	`luaLßdLib
(
lua
, 
LUA_STRLIBNAME
, 
luaİ’_¡ršg
);

824 
	`luaLßdLib
(
lua
, 
LUA_MATHLIBNAME
, 
luaİ’_m©h
);

825 
	`luaLßdLib
(
lua
, 
LUA_DBLIBNAME
, 
luaİ’_debug
);

826 
	`luaLßdLib
(
lua
, "cjsÚ", 
luaİ’_cjsÚ
);

827 
	`luaLßdLib
(
lua
, "¡ruù", 
luaİ’_¡ruù
);

828 
	`luaLßdLib
(
lua
, "cmsg·ck", 
luaİ’_cmsg·ck
);

829 
	`luaLßdLib
(
lua
, "b™", 
luaİ’_b™
);

832 
	`luaLßdLib
(
lua
, 
LUA_LOADLIBNAME
, 
luaİ’_·ckage
);

833 
	`luaLßdLib
(
lua
, 
LUA_OSLIBNAME
, 
luaİ’_os
);

835 
	}
}

839 
	$luaRemoveUnsuµÜ‹dFunùiÚs
(
lua_S‹
 *
lua
) {

840 
	`lua_pushn
(
lua
);

841 
	`lua_£tglob®
(
lua
,"loadfile");

842 
	`lua_pushn
(
lua
);

843 
	`lua_£tglob®
(
lua
,"dofile");

844 
	}
}

851 
	$sütšgEÇbËGlob®sPrÙeùiÚ
(
lua_S‹
 *
lua
) {

852 *
s
[32];

853 
sds
 
code
 = 
	`sd£m±y
();

854 
j
 = 0;

858 
s
[
j
++]="local dbg=debug\n";

859 
s
[
j
++]="local mt = {}\n";

860 
s
[
j
++]="setmetatable(_G, mt)\n";

861 
s
[
j
++]="mt.__newindex = function (t,‚, v)\n";

862 
s
[
j
++]=" if dbg.getinfo(2)hen\n";

863 
s
[
j
++]="†ocal w = dbg.getinfo(2, \"S\").what\n";

864 
s
[
j
++]=" if w ~= \"main\"‡nd w ~= \"C\"hen\n";

865 
s
[
j
++]="ƒrror(\"Script‡ttemptedo create global variable '\"..tostring(n)..\"'\", 2)\n";

866 
s
[
j
++]="ƒnd\n";

867 
s
[
j
++]="ƒnd\n";

868 
s
[
j
++]="„awset(t,‚, v)\n";

869 
s
[
j
++]="end\n";

870 
s
[
j
++]="mt.__index = function (t,‚)\n";

871 
s
[
j
++]=" if dbg.getinfo(2)‡nd dbg.getinfo(2, \"S\").what ~= \"C\"hen\n";

872 
s
[
j
++]="ƒrror(\"Script‡ttemptedo‡ccess‚onexistent global variable '\"..tostring(n)..\"'\", 2)\n";

873 
s
[
j
++]="ƒnd\n";

874 
s
[
j
++]="„eturn„awget(t,‚)\n";

875 
s
[
j
++]="end\n";

876 
s
[
j
++]="debug =‚il\n";

877 
s
[
j
++]=
NULL
;

879 
j
 = 0; 
s
[j] !ğ
NULL
; j++è
code
 = 
	`sdsÿ’
(code,s[j],
	`¡¾’
(s[j]));

880 
	`luaL_lßdbufãr
(
lua
,
code
,
	`sd¦’
(code),"@enable_strict_lua");

881 
	`lua_pÿÎ
(
lua
,0,0,0);

882 
	`sdsä“
(
code
);

883 
	}
}

895 
	$sütšgIn™
(
£tup
) {

896 
lua_S‹
 *
lua
 = 
	`lua_İ’
();

898 ià(
£tup
) {

899 
£rv”
.
lua_ş›Á
 = 
NULL
;

900 
£rv”
.
lua_ÿÎ”
 = 
NULL
;

901 
£rv”
.
lua_timedout
 = 0;

902 
£rv”
.
lua_®ways_»¶iÿ‹_commªds
 = 0;

903 
£rv”
.
lua_time_lim™
 = 
LUA_SCRIPT_TIME_LIMIT
;

904 
	`ldbIn™
();

907 
	`luaLßdLib¿r›s
(
lua
);

908 
	`luaRemoveUnsuµÜ‹dFunùiÚs
(
lua
);

913 
£rv”
.
lua_süts
 = 
	`diùC»©e
(&
shaSütObjeùDiùTy³
,
NULL
);

916 
	`lua_ÃwbË
(
lua
);

919 
	`lua_push¡ršg
(
lua
,"call");

920 
	`lua_pushcfunùiÚ
(
lua
,
luaRedisC®lCommªd
);

921 
	`lua_£‰abË
(
lua
,-3);

924 
	`lua_push¡ršg
(
lua
,"pcall");

925 
	`lua_pushcfunùiÚ
(
lua
,
luaRedisPC®lCommªd
);

926 
	`lua_£‰abË
(
lua
,-3);

929 
	`lua_push¡ršg
(
lua
,"log");

930 
	`lua_pushcfunùiÚ
(
lua
,
luaLogCommªd
);

931 
	`lua_£‰abË
(
lua
,-3);

933 
	`lua_push¡ršg
(
lua
,"LOG_DEBUG");

934 
	`lua_pushnumb”
(
lua
,
LL_DEBUG
);

935 
	`lua_£‰abË
(
lua
,-3);

937 
	`lua_push¡ršg
(
lua
,"LOG_VERBOSE");

938 
	`lua_pushnumb”
(
lua
,
LL_VERBOSE
);

939 
	`lua_£‰abË
(
lua
,-3);

941 
	`lua_push¡ršg
(
lua
,"LOG_NOTICE");

942 
	`lua_pushnumb”
(
lua
,
LL_NOTICE
);

943 
	`lua_£‰abË
(
lua
,-3);

945 
	`lua_push¡ršg
(
lua
,"LOG_WARNING");

946 
	`lua_pushnumb”
(
lua
,
LL_WARNING
);

947 
	`lua_£‰abË
(
lua
,-3);

950 
	`lua_push¡ršg
(
lua
, "sha1hex");

951 
	`lua_pushcfunùiÚ
(
lua
, 
luaRedisSha1hexCommªd
);

952 
	`lua_£‰abË
(
lua
, -3);

955 
	`lua_push¡ršg
(
lua
, "error_reply");

956 
	`lua_pushcfunùiÚ
(
lua
, 
luaRedisE¼ÜR•lyCommªd
);

957 
	`lua_£‰abË
(
lua
, -3);

958 
	`lua_push¡ršg
(
lua
, "status_reply");

959 
	`lua_pushcfunùiÚ
(
lua
, 
luaRedisStusR•lyCommªd
);

960 
	`lua_£‰abË
(
lua
, -3);

963 
	`lua_push¡ršg
(
lua
, "replicate_commands");

964 
	`lua_pushcfunùiÚ
(
lua
, 
luaRedisR•liÿ‹CommªdsCommªd
);

965 
	`lua_£‰abË
(
lua
, -3);

968 
	`lua_push¡ršg
(
lua
,"set_repl");

969 
	`lua_pushcfunùiÚ
(
lua
,
luaRedisS‘R•lCommªd
);

970 
	`lua_£‰abË
(
lua
,-3);

972 
	`lua_push¡ršg
(
lua
,"REPL_NONE");

973 
	`lua_pushnumb”
(
lua
,
PROPAGATE_NONE
);

974 
	`lua_£‰abË
(
lua
,-3);

976 
	`lua_push¡ršg
(
lua
,"REPL_AOF");

977 
	`lua_pushnumb”
(
lua
,
PROPAGATE_AOF
);

978 
	`lua_£‰abË
(
lua
,-3);

980 
	`lua_push¡ršg
(
lua
,"REPL_SLAVE");

981 
	`lua_pushnumb”
(
lua
,
PROPAGATE_REPL
);

982 
	`lua_£‰abË
(
lua
,-3);

984 
	`lua_push¡ršg
(
lua
,"REPL_ALL");

985 
	`lua_pushnumb”
(
lua
,
PROPAGATE_AOF
|
PROPAGATE_REPL
);

986 
	`lua_£‰abË
(
lua
,-3);

989 
	`lua_push¡ršg
(
lua
,"breakpoint");

990 
	`lua_pushcfunùiÚ
(
lua
,
luaRedisB»akpoštCommªd
);

991 
	`lua_£‰abË
(
lua
,-3);

994 
	`lua_push¡ršg
(
lua
,"debug");

995 
	`lua_pushcfunùiÚ
(
lua
,
luaRedisDebugCommªd
);

996 
	`lua_£‰abË
(
lua
,-3);

999 
	`lua_£tglob®
(
lua
,"redis");

1002 
	`lua_g‘glob®
(
lua
,"math");

1004 
	`lua_push¡ršg
(
lua
,"random");

1005 
	`lua_pushcfunùiÚ
(
lua
,
»dis_m©h_¿ndom
);

1006 
	`lua_£‰abË
(
lua
,-3);

1008 
	`lua_push¡ršg
(
lua
,"randomseed");

1009 
	`lua_pushcfunùiÚ
(
lua
,
»dis_m©h_¿ndom£ed
);

1010 
	`lua_£‰abË
(
lua
,-3);

1012 
	`lua_£tglob®
(
lua
,"math");

1017 *
com·»_func
 = "function __redis__compare_helper(a,b)\n"

1022 
	`luaL_lßdbufãr
(
lua
,
com·»_func
,
	`¡¾’
(compare_func),"@cmp_func_def");

1023 
	`lua_pÿÎ
(
lua
,0,0,0);

1031 *
”rh_func
 = "local dbg = debug\n"

1043 
	`luaL_lßdbufãr
(
lua
,
”rh_func
,
	`¡¾’
(errh_func),"@err_handler_def");

1044 
	`lua_pÿÎ
(
lua
,0,0,0);

1051 ià(
£rv”
.
lua_ş›Á
 =ğ
NULL
) {

1052 
£rv”
.
lua_ş›Á
 = 
	`ü—‹Cl›Á
(-1);

1053 
£rv”
.
lua_ş›Á
->
æags
 |ğ
CLIENT_LUA
;

1059 
	`sütšgEÇbËGlob®sPrÙeùiÚ
(
lua
);

1061 
£rv”
.
lua
 =†ua;

1062 
	}
}

1066 
	$sütšgR–—£
() {

1067 
	`diùR–—£
(
£rv”
.
lua_süts
);

1068 
	`lua_şo£
(
£rv”
.
lua
);

1069 
	}
}

1071 
	$sütšgRe£t
() {

1072 
	`sütšgR–—£
();

1073 
	`sütšgIn™
(0);

1074 
	}
}

1078 
	$luaS‘Glob®A¼ay
(
lua_S‹
 *
lua
, *
v¬
, 
robj
 **
–ev
, 
–ec
) {

1079 
j
;

1081 
	`lua_ÃwbË
(
lua
);

1082 
j
 = 0; j < 
–ec
; j++) {

1083 
	`lua_pushl¡ršg
(
lua
,(*)
–ev
[
j
]->
±r
,
	`sd¦’
(elev[j]->ptr));

1084 
	`lua_¿w£ti
(
lua
,-2,
j
+1);

1086 
	`lua_£tglob®
(
lua
,
v¬
);

1087 
	}
}

1099 
	$»dis_m©h_¿ndom
 (
lua_S‹
 *
L
) {

1102 
lua_Numb”
 
r
 = (lua_Numb”)(
	`»disL¿nd48
()%
REDIS_LRAND48_MAX
) /

1103 (
lua_Numb”
)
REDIS_LRAND48_MAX
;

1104 
	`lua_g‘tİ
(
L
)) {

1106 
	`lua_pushnumb”
(
L
, 
r
);

1110 
u
 = 
	`luaL_checkšt
(
L
, 1);

1111 
	`luaL_¬gcheck
(
L
, 1<=
u
, 1, "interval isƒmpty");

1112 
	`lua_pushnumb”
(
L
, 
	`æoÜ
(
r
*
u
)+1);

1116 
l
 = 
	`luaL_checkšt
(
L
, 1);

1117 
u
 = 
	`luaL_checkšt
(
L
, 2);

1118 
	`luaL_¬gcheck
(
L
, 
l
<=
u
, 2, "interval isƒmpty");

1119 
	`lua_pushnumb”
(
L
, 
	`æoÜ
(
r
*(
u
-
l
+1))+l);

1122 :  
	`luaL_”rÜ
(
L
, "wrong‚umber of‡rguments");

1125 
	}
}

1127 
	$»dis_m©h_¿ndom£ed
 (
lua_S‹
 *
L
) {

1128 
	`»disS¿nd48
(
	`luaL_checkšt
(
L
, 1));

1130 
	}
}

1145 
	$luaC»©eFunùiÚ
(
ş›Á
 *
c
, 
lua_S‹
 *
lua
, *
funúame
, 
robj
 *
body
) {

1146 
sds
 
funcdef
 = 
	`sd£m±y
();

1148 
funcdef
 = 
	`sdsÿt
(funcdef,"function ");

1149 
funcdef
 = 
	`sdsÿ’
(funcdef,
funúame
,42);

1150 
funcdef
 = 
	`sdsÿ’
(funcdef,"() ",3);

1151 
funcdef
 = 
	`sdsÿ’
(funcdef,
body
->
±r
,
	`sd¦’
(body->ptr));

1152 
funcdef
 = 
	`sdsÿ’
(funcdef,"\nend",4);

1154 ià(
	`luaL_lßdbufãr
(
lua
,
funcdef
,
	`sd¦’
(funcdef),"@user_script")) {

1155 
	`addR•lyE¼ÜFÜm©
(
c
,"Error compiling script (new function): %s\n",

1156 
	`lua_to¡ršg
(
lua
,-1));

1157 
	`lua_pİ
(
lua
,1);

1158 
	`sdsä“
(
funcdef
);

1159  
C_ERR
;

1161 
	`sdsä“
(
funcdef
);

1162 ià(
	`lua_pÿÎ
(
lua
,0,0,0)) {

1163 
	`addR•lyE¼ÜFÜm©
(
c
,"Error„unning script (new function): %s\n",

1164 
	`lua_to¡ršg
(
lua
,-1));

1165 
	`lua_pİ
(
lua
,1);

1166  
C_ERR
;

1173 
»tv®
 = 
	`diùAdd
(
£rv”
.
lua_süts
,

1174 
	`sd¢ewËn
(
funúame
+2,40),
body
);

1175 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
»tv®
 =ğ
DICT_OK
);

1176 
	`šüRefCouÁ
(
body
);

1178  
C_OK
;

1179 
	}
}

1182 
	$luaMaskCouÁHook
(
lua_S‹
 *
lua
, 
lua_Debug
 *
¬
) {

1183 
–­£d
;

1184 
	`UNUSED
(
¬
);

1185 
	`UNUSED
(
lua
);

1187 
–­£d
 = 
	`m¡ime
(è- 
£rv”
.
lua_time_¡¬t
;

1188 ià(
–­£d
 >ğ
£rv”
.
lua_time_lim™
 && s”v”.
lua_timedout
 == 0) {

1189 
	`£rv”Log
(
LL_WARNING
,"Lu¨¦ow süˆd‘eùed: stÈšƒxecutiÚ‡á” %Îd mli£cÚds. You cªry klšghsüˆusšghSCRIPT KILL commªd.",
–­£d
);

1190 
£rv”
.
lua_timedout
 = 1;

1196 
	`«D–‘eFeEv’t
(
£rv”
.
–
, s”v”.
lua_ÿÎ”
->
fd
, 
AE_READABLE
);

1198 ià(
£rv”
.
lua_timedout
è
	`´oûssEv’tsWheBlocked
();

1199 ià(
£rv”
.
lua_kl
) {

1200 
	`£rv”Log
(
LL_WARNING
,"Lua script killed by user with SCRIPT KILL.");

1201 
	`lua_push¡ršg
(
lua
,"Script killed by user with SCRIPT KILL...");

1202 
	`lua_”rÜ
(
lua
);

1204 
	}
}

1206 
	$ev®G’”icCommªd
(
ş›Á
 *
c
, 
ev®sha
) {

1207 
lua_S‹
 *
lua
 = 
£rv”
.lua;

1208 
funúame
[43];

1209 
numkeys
;

1210 
d–hook
 = 0, 
”r
;

1214 
	`»disS¿nd48
(0);

1224 
£rv”
.
lua_¿ndom_dœty
 = 0;

1225 
£rv”
.
lua_wr™e_dœty
 = 0;

1226 
£rv”
.
lua_»¶iÿ‹_commªds
 = s”v”.
lua_®ways_»¶iÿ‹_commªds
;

1227 
£rv”
.
lua_muÉi_em™‹d
 = 0;

1228 
£rv”
.
lua_»¶
 = 
PROPAGATE_AOF
|
PROPAGATE_REPL
;

1231 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
numkeys
,
NULL
è!ğ
C_OK
)

1233 ià(
numkeys
 > (
c
->
¬gc
 - 3)) {

1234 
	`addR•lyE¼Ü
(
c
,"Number of keys can't be greaterhan‚umber of‡rgs");

1236 } ià(
numkeys
 < 0) {

1237 
	`addR•lyE¼Ü
(
c
,"Number of keys can't be‚egative");

1243 
funúame
[0] = 'f';

1244 
funúame
[1] = '_';

1245 ià(!
ev®sha
) {

1247 
	`sha1hex
(
funúame
+2,
c
->
¬gv
[1]->
±r
,
	`sd¦’
(c->argv[1]->ptr));

1250 
j
;

1251 *
sha
 = 
c
->
¬gv
[1]->
±r
;

1256 
j
 = 0; j < 40; j++)

1257 
funúame
[
j
+2] = (
sha
[j] >= 'A' && sha[j] <= 'Z') ?

1258 
sha
[
j
]+('a'-'A') : sha[j];

1259 
funúame
[42] = '\0';

1263 
	`lua_g‘glob®
(
lua
, "__redis__err__handler");

1266 
	`lua_g‘glob®
(
lua
, 
funúame
);

1267 ià(
	`lua_i¢
(
lua
,-1)) {

1268 
	`lua_pİ
(
lua
,1);

1272 ià(
ev®sha
) {

1273 
	`lua_pİ
(
lua
,1);

1274 
	`addR•ly
(
c
, 
sh¬ed
.
nosü‹¼
);

1277 ià(
	`luaC»©eFunùiÚ
(
c
,
lua
,
funúame
,c->
¬gv
[1]è=ğ
C_ERR
) {

1278 
	`lua_pİ
(
lua
,1);

1284 
	`lua_g‘glob®
(
lua
, 
funúame
);

1285 
	`£rv”As£¹
(!
	`lua_i¢
(
lua
,-1));

1290 
	`luaS‘Glob®A¼ay
(
lua
,"KEYS",
c
->
¬gv
+3,
numkeys
);

1291 
	`luaS‘Glob®A¼ay
(
lua
,"ARGV",
c
->
¬gv
+3+
numkeys
,c->
¬gc
-3-numkeys);

1294 
	`£ËùDb
(
£rv”
.
lua_ş›Á
,
c
->
db
->
id
);

1303 
£rv”
.
lua_ÿÎ”
 = 
c
;

1304 
£rv”
.
lua_time_¡¬t
 = 
	`m¡ime
();

1305 
£rv”
.
lua_kl
 = 0;

1306 ià(
£rv”
.
lua_time_lim™
 > 0 && s”v”.
ma¡”ho¡
 =ğ
NULL
 &&

1307 
ldb
.
aùive
 == 0)

1309 
	`lua_£thook
(
lua
,
luaMaskCouÁHook
,
LUA_MASKCOUNT
,100000);

1310 
d–hook
 = 1;

1311 } ià(
ldb
.
aùive
) {

1312 
	`lua_£thook
(
£rv”
.
lua
,
luaLdbLšeHook
,
LUA_MASKLINE
|
LUA_MASKCOUNT
,100000);

1313 
d–hook
 = 1;

1319 
”r
 = 
	`lua_pÿÎ
(
lua
,0,1,-2);

1322 ià(
d–hook
è
	`lua_£thook
(
lua
,
NULL
,0,0);

1323 ià(
£rv”
.
lua_timedout
) {

1324 
£rv”
.
lua_timedout
 = 0;

1327 
	`«C»©eFeEv’t
(
£rv”
.
–
,
c
->
fd
,
AE_READABLE
,

1328 
»adQu”yFromCl›Á
,
c
);

1330 
£rv”
.
lua_ÿÎ”
 = 
NULL
;

1338 
	#LUA_GC_CYCLE_PERIOD
 50

	)

1340 
gc_couÁ
 = 0;

1342 
gc_couÁ
++;

1343 ià(
gc_couÁ
 =ğ
LUA_GC_CYCLE_PERIOD
) {

1344 
	`lua_gc
(
lua
,
LUA_GCSTEP
,
LUA_GC_CYCLE_PERIOD
);

1345 
gc_couÁ
 = 0;

1349 ià(
”r
) {

1350 
	`addR•lyE¼ÜFÜm©
(
c
,"Error„unning script (callo %s): %s\n",

1351 
funúame
, 
	`lua_to¡ršg
(
lua
,-1));

1352 
	`lua_pİ
(
lua
,2);

1356 
	`luaR•lyToRedisR•ly
(
c
,
lua
);

1357 
	`lua_pİ
(
lua
,1);

1362 ià(
£rv”
.
lua_»¶iÿ‹_commªds
) {

1363 
	`´ev’tCommªdPrİag©iÚ
(
c
);

1364 ià(
£rv”
.
lua_muÉi_em™‹d
) {

1365 
robj
 *
´İ¬gv
[1];

1366 
´İ¬gv
[0] = 
	`ü—‹SŒšgObjeù
("EXEC",4);

1367 
	`®soPrİag©e
(
£rv”
.
execCommªd
,
c
->
db
->
id
,
´İ¬gv
,1,

1368 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

1369 
	`deüRefCouÁ
(
´İ¬gv
[0]);

1383 ià(
ev®sha
 && !
£rv”
.
lua_»¶iÿ‹_commªds
) {

1384 ià(!
	`»¶iÿtiÚSütCacheExi¡s
(
c
->
¬gv
[1]->
±r
)) {

1388 
robj
 *
süt
 = 
	`diùF‘chV®ue
(
£rv”
.
lua_süts
,
c
->
¬gv
[1]->
±r
);

1390 
	`»¶iÿtiÚSütCacheAdd
(
c
->
¬gv
[1]->
±r
);

1391 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
süt
 != NULL);

1392 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,0,

1393 
	`»£tRefCouÁ
(
	`ü—‹SŒšgObjeù
("EVAL",4)));

1394 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,1,
süt
);

1395 
	`fÜûCommªdPrİag©iÚ
(
c
,
PROPAGATE_REPL
|
PROPAGATE_AOF
);

1398 
	}
}

1400 
	$ev®Commªd
(
ş›Á
 *
c
) {

1401 ià(!(
c
->
æags
 & 
CLIENT_LUA_DEBUG
))

1402 
	`ev®G’”icCommªd
(
c
,0);

1404 
	`ev®G’”icCommªdW™hDebuggšg
(
c
,0);

1405 
	}
}

1407 
	$ev®ShaCommªd
(
ş›Á
 *
c
) {

1408 ià(
	`sd¦’
(
c
->
¬gv
[1]->
±r
) != 40) {

1413 
	`addR•ly
(
c
, 
sh¬ed
.
nosü‹¼
);

1416 ià(!(
c
->
æags
 & 
CLIENT_LUA_DEBUG
))

1417 
	`ev®G’”icCommªd
(
c
,1);

1419 
	`addR•lyE¼Ü
(
c
,"Please use EVAL instead of EVALSHA for debugging");

1422 
	}
}

1424 
	$sütCommªd
(
ş›Á
 *
c
) {

1425 ià(
c
->
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"flush")) {

1426 
	`sütšgRe£t
();

1427 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1428 
	`»¶iÿtiÚSütCacheFlush
();

1429 
£rv”
.
dœty
++;

1430 } ià(
c
->
¬gc
 >ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"exists")) {

1431 
j
;

1433 
	`addR•lyMuÉiBulkL’
(
c
, c->
¬gc
-2);

1434 
j
 = 2; j < 
c
->
¬gc
; j++) {

1435 ià(
	`diùFšd
(
£rv”
.
lua_süts
,
c
->
¬gv
[
j
]->
±r
))

1436 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

1438 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

1440 } ià(
c
->
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"load")) {

1441 
funúame
[43];

1442 
sds
 
sha
;

1444 
funúame
[0] = 'f';

1445 
funúame
[1] = '_';

1446 
	`sha1hex
(
funúame
+2,
c
->
¬gv
[2]->
±r
,
	`sd¦’
(c->argv[2]->ptr));

1447 
sha
 = 
	`sd¢ewËn
(
funúame
+2,40);

1448 ià(
	`diùFšd
(
£rv”
.
lua_süts
,
sha
è=ğ
NULL
) {

1449 ià(
	`luaC»©eFunùiÚ
(
c
,
£rv”
.
lua
,
funúame
,c->
¬gv
[2])

1450 =ğ
C_ERR
) {

1451 
	`sdsä“
(
sha
);

1455 
	`addR•lyBulkCBufãr
(
c
,
funúame
+2,40);

1456 
	`sdsä“
(
sha
);

1457 
	`fÜûCommªdPrİag©iÚ
(
c
,
PROPAGATE_REPL
|
PROPAGATE_AOF
);

1458 } ià(
c
->
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"kill")) {

1459 ià(
£rv”
.
lua_ÿÎ”
 =ğ
NULL
) {

1460 
	`addR•lySds
(
c
,
	`sd¢ew
("-NOTBUSY No scripts inƒxecution„ight‚ow.\r\n"));

1461 } ià(
£rv”
.
lua_wr™e_dœty
) {

1462 
	`addR•lySds
(
c
,
	`sd¢ew
("-UNKILLABLE Sorryhe script‡lreadyƒxecuted write commands‡gainsthe dataset. You canƒither waithe scriptermination or killhe server in‡ hard way usinghe SHUTDOWN NOSAVE command.\r\n"));

1464 
£rv”
.
lua_kl
 = 1;

1465 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1467 } ià(
c
->
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"debug")) {

1468 ià(
	`ş›ÁHasP’dšgR•l›s
(
c
)) {

1469 
	`addR•lyE¼Ü
(
c
,"SCRIPT DEBUG must be called outside‡…ipeline");

1472 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"no")) {

1473 
	`ldbDi§bË
(
c
);

1474 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1475 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"yes")) {

1476 
	`ldbEÇbË
(
c
);

1477 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1478 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"sync")) {

1479 
	`ldbEÇbË
(
c
);

1480 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

1481 
c
->
æags
 |ğ
CLIENT_LUA_DEBUG_SYNC
;

1483 
	`addR•lyE¼Ü
(
c
,"Use SCRIPT DEBUG yes/sync/no");

1486 
	`addR•lyE¼Ü
(
c
, "Unknown SCRIPT subcommand or wrong # of‡rgs.");

1488 
	}
}

1495 
	$ldbIn™
() {

1496 
ldb
.
fd
 = -1;

1497 
ldb
.
aùive
 = 0;

1498 
ldb
.
logs
 = 
	`li¡C»©e
();

1499 
	`li¡S‘F»eM‘hod
(
ldb
.
logs
,((*)(*))
sdsä“
);

1500 
ldb
.
chd»n
 = 
	`li¡C»©e
();

1501 
ldb
.
¤c
 = 
NULL
;

1502 
ldb
.
lšes
 = 0;

1503 
ldb
.
cbuf
 = 
	`sd£m±y
();

1504 
	}
}

1507 
	$ldbFlushLog
(
li¡
 *
log
) {

1508 
li¡Node
 *
Ê
;

1510 (
Ê
 = 
	`li¡Fœ¡
(
log
)è!ğ
NULL
)

1511 
	`li¡D–Node
(
log
,
Ê
);

1512 
	}
}

1515 
	$ldbEÇbË
(
ş›Á
 *
c
) {

1516 
c
->
æags
 |ğ
CLIENT_LUA_DEBUG
;

1517 
	`ldbFlushLog
(
ldb
.
logs
);

1518 
ldb
.
fd
 = 
c
->fd;

1519 
ldb
.
¡•
 = 1;

1520 
ldb
.
bpcouÁ
 = 0;

1521 
ldb
.
luabp
 = 0;

1522 
	`sdsä“
(
ldb
.
cbuf
);

1523 
ldb
.
cbuf
 = 
	`sd£m±y
();

1524 
ldb
.
maxËn
 = 
LDB_MAX_LEN_DEFAULT
;

1525 
ldb
.
maxËn_hšt_£Á
 = 0;

1526 
	}
}

1531 
	$ldbDi§bË
(
ş›Á
 *
c
) {

1532 
c
->
æags
 &ğ~(
CLIENT_LUA_DEBUG
|
CLIENT_LUA_DEBUG_SYNC
);

1533 
	}
}

1536 
	$ldbLog
(
sds
 
’Œy
) {

1537 
	`li¡AddNodeTa
(
ldb
.
logs
,
’Œy
);

1538 
	}
}

1544 
	$ldbLogW™hMaxL’
(
sds
 
’Œy
) {

1545 
Œimmed
 = 0;

1546 ià(
ldb
.
maxËn
 && 
	`sd¦’
(
’Œy
) >†db.maxlen) {

1547 
	`sd¤ªge
(
’Œy
,0,
ldb
.
maxËn
-1);

1548 
’Œy
 = 
	`sdsÿ’
(entry," ...",4);

1549 
Œimmed
 = 1;

1551 
	`ldbLog
(
’Œy
);

1552 ià(
Œimmed
 && 
ldb
.
maxËn_hšt_£Á
 == 0) {

1553 
ldb
.
maxËn_hšt_£Á
 = 1;

1554 
	`ldbLog
(
	`sd¢ew
(

1557 
	}
}

1562 
	$ldbS’dLogs
() {

1563 
sds
 
´Ùo
 = 
	`sd£m±y
();

1564 
´Ùo
 = 
	`sdsÿtfmt
ÕrÙo,"*%i\r\n", ()
	`li¡L’gth
(
ldb
.
logs
));

1565 
	`li¡L’gth
(
ldb
.
logs
)) {

1566 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
ldb
.
logs
);

1567 
´Ùo
 = 
	`sdsÿ’
(proto,"+",1);

1568 
	`sdsm­ch¬s
(
Ê
->
v®ue
,"\r\n"," ",2);

1569 
´Ùo
 = 
	`sdsÿtsds
ÕrÙo,
Ê
->
v®ue
);

1570 
´Ùo
 = 
	`sdsÿ’
(proto,"\r\n",2);

1571 
	`li¡D–Node
(
ldb
.
logs
,
Ê
);

1573 ià(
	`wr™e
(
ldb
.
fd
,
´Ùo
,
	`sd¦’
(proto)) == -1) {

1578 
	`sdsä“
(
´Ùo
);

1579 
	}
}

1593 
	$ldbS¹SessiÚ
(
ş›Á
 *
c
) {

1594 
ldb
.
fÜked
 = (
c
->
æags
 & 
CLIENT_LUA_DEBUG_SYNC
) == 0;

1595 ià(
ldb
.
fÜked
) {

1596 
pid_t
 
ı
 = 
	`fÜk
();

1597 ià(
ı
 == -1) {

1598 
	`addR•lyE¼Ü
(
c
,"Fork() failed: can't„un EVAL in debugging mode.");

1600 } ià(
ı
 == 0) {

1602 
sigaùiÚ
 
aù
;

1603 
	`sigem±y£t
(&
aù
.
§_mask
);

1604 
aù
.
§_æags
 = 0;

1605 
aù
.
§_hªdËr
 = 
SIG_IGN
;

1606 
	`sigaùiÚ
(
SIGTERM
, &
aù
, 
NULL
);

1607 
	`sigaùiÚ
(
SIGINT
, &
aù
, 
NULL
);

1612 
	`£rv”Log
(
LL_WARNING
,"Redis forked for debuggingƒval");

1613 
	`şo£Li¡’šgSock‘s
(0);

1616 
	`li¡AddNodeTa
(
ldb
.
chd»n
,(*)()
ı
);

1617 
	`ä“Cl›ÁAsync
(
c
);

1621 
	`£rv”Log
(
LL_WARNING
,

1626 
	`ª‘Block
(
NULL
,
ldb
.
fd
);

1627 
	`ª‘S’dTimeout
(
NULL
,
ldb
.
fd
,5000);

1628 
ldb
.
aùive
 = 1;

1632 
sds
 
¤c¡ršg
 = 
	`sdsdup
(
c
->
¬gv
[1]->
±r
);

1633 
size_t
 
¤ş’
 = 
	`sd¦’
(
¤c¡ršg
);

1634 
¤ş’
 && (
¤c¡ršg
[srclen-1] == '\n' ||

1635 
¤c¡ršg
[
¤ş’
-1] == '\r'))

1637 
¤c¡ršg
[--
¤ş’
] = '\0';

1639 
	`sds£’
(
¤c¡ršg
,
¤ş’
);

1640 
ldb
.
¤c
 = 
	`sds¥l™Ën
(
¤c¡ršg
,
	`sd¦’
(¤c¡ršg),"\n",1,&ldb.
lšes
);

1641 
	`sdsä“
(
¤c¡ršg
);

1643 
	}
}

1647 
	$ldbEndSessiÚ
(
ş›Á
 *
c
) {

1649 
	`ldbLog
(
	`sd¢ew
("<endsession>"));

1650 
	`ldbS’dLogs
();

1653 ià(
ldb
.
fÜked
) {

1654 
	`wr™eToCl›Á
(
c
->
fd
, c, 0);

1655 
	`£rv”Log
(
LL_WARNING
,"Lua debugging session childƒxiting");

1656 
	`ex™FromChd
(0);

1658 
	`£rv”Log
(
LL_WARNING
,

1663 
	`ª‘NÚBlock
(
NULL
,
ldb
.
fd
);

1664 
	`ª‘S’dTimeout
(
NULL
,
ldb
.
fd
,0);

1668 
c
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

1671 
	`sdsä“¥l™»s
(
ldb
.
¤c
,ldb.
lšes
);

1672 
ldb
.
lšes
 = 0;

1673 
ldb
.
aùive
 = 0;

1674 
	}
}

1679 
	$ldbRemoveChd
(
pid_t
 
pid
) {

1680 
li¡Node
 *
Ê
 = 
	`li¡S—rchKey
(
ldb
.
chd»n
,(*)()
pid
);

1681 ià(
Ê
) {

1682 
	`li¡D–Node
(
ldb
.
chd»n
,
Ê
);

1686 
	}
}

1690 
	$ldbP’dšgChd»n
() {

1691  
	`li¡L’gth
(
ldb
.
chd»n
);

1692 
	}
}

1695 
	$ldbKlFÜkedSessiÚs
() {

1696 
li¡I‹r
 
li
;

1697 
li¡Node
 *
Ê
;

1699 
	`li¡Rewšd
(
ldb
.
chd»n
,&
li
);

1700 (
Ê
 = 
	`li¡Next
(&
li
))) {

1701 
pid_t
 
pid
 = (è
Ê
->
v®ue
;

1702 
	`£rv”Log
(
LL_WARNING
,"Klšg debuggšg sessiÚ %ld",()
pid
);

1703 
	`kl
(
pid
,
SIGKILL
);

1705 
	`li¡R–—£
(
ldb
.
chd»n
);

1706 
ldb
.
chd»n
 = 
	`li¡C»©e
();

1707 
	}
}

1711 
	$ev®G’”icCommªdW™hDebuggšg
(
ş›Á
 *
c
, 
ev®sha
) {

1712 ià(
	`ldbS¹SessiÚ
(
c
)) {

1713 
	`ev®G’”icCommªd
(
c
,
ev®sha
);

1714 
	`ldbEndSessiÚ
(
c
);

1716 
	`ldbDi§bË
(
c
);

1718 
	}
}

1722 *
	$ldbG‘SourûLše
(
lše
) {

1723 
idx
 = 
lše
-1;

1724 ià(
idx
 < 0 || idx >ğ
ldb
.
lšes
)  "<out of„ange source code†ine>";

1725  
ldb
.
¤c
[
idx
];

1726 
	}
}

1729 
	$ldbIsB»akpošt
(
lše
) {

1730 
j
;

1732 
j
 = 0; j < 
ldb
.
bpcouÁ
; j++)

1733 ià(
ldb
.
bp
[
j
] =ğ
lše
)  1;

1735 
	}
}

1740 
	$ldbAddB»akpošt
(
lše
) {

1741 ià(
lše
 <ğ0 ||†š> 
ldb
.
lšes
)  0;

1742 ià(!
	`ldbIsB»akpošt
(
lše
è&& 
ldb
.
bpcouÁ
 !ğ
LDB_BREAKPOINTS_MAX
) {

1743 
ldb
.
bp
[ldb.
bpcouÁ
++] = 
lše
;

1747 
	}
}

1751 
	$ldbD–B»akpošt
(
lše
) {

1752 
j
;

1754 
j
 = 0; j < 
ldb
.
bpcouÁ
; j++) {

1755 ià(
ldb
.
bp
[
j
] =ğ
lše
) {

1756 
ldb
.
bpcouÁ
--;

1757 
	`memmove
(
ldb
.
bp
+
j
,ldb.bp+j+1,ldb.
bpcouÁ
-j);

1762 
	}
}

1767 
sds
 *
	$ldbR•lP¬£Commªd
(*
¬gı
) {

1768 
sds
 *
¬gv
 = 
NULL
;

1769 
¬gc
 = 0;

1770 ià(
	`sd¦’
(
ldb
.
cbuf
è=ğ0è 
NULL
;

1774 
sds
 
cİy
 = 
	`sdsdup
(
ldb
.
cbuf
);

1775 *
p
 = 
cİy
;

1782 
p
 = 
	`¡rchr
Õ,'*'); ià(!pè
´ÙÛ¼
;

1783 *
¶’
 = 
p
+1;

1784 
p
 = 
	`¡r¡r
Õ,"\r\n"); ià(!pè
´ÙÛ¼
;

1785 *
p
 = '\0';… += 2;

1786 *
¬gı
 = 
	`©oi
(
¶’
);

1787 ià(*
¬gı
 <ğ0 || *¬gı > 1024è
´ÙÛ¼
;

1790 
¬gv
 = 
	`zm®loc
((
sds
)*(*
¬gı
));

1791 
¬gc
 = 0;

1792 
¬gc
 < *
¬gı
) {

1793 ià(*
p
 !ğ'$'è
´ÙÛ¼
;

1794 
¶’
 = 
p
+1;

1795 
p
 = 
	`¡r¡r
Õ,"\r\n"); ià(!pè
´ÙÛ¼
;

1796 *
p
 = '\0';… += 2;

1797 
¦’
 = 
	`©oi
(
¶’
);

1798 ià(
¦’
 <ğ0 || sËÀ> 1024è
´ÙÛ¼
;

1799 
¬gv
[
¬gc
++] = 
	`sd¢ewËn
(
p
,
¦’
);

1800 
p
 +ğ
¦’
;

1801 ià(
p
[0] !ğ'\r' ||…[1] !ğ'\n'è
´ÙÛ¼
;

1802 
p
 += 2;

1804 
	`sdsä“
(
cİy
);

1805  
¬gv
;

1807 
´ÙÛ¼
:

1808 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

1809 
	`sdsä“
(
cİy
);

1810  
NULL
;

1811 
	}
}

1814 
	$ldbLogSourûLše
(
Êum
) {

1815 *
lše
 = 
	`ldbG‘SourûLše
(
Êum
);

1816 *
´efix
;

1817 
bp
 = 
	`ldbIsB»akpošt
(
Êum
);

1818 
cu¼’t
 = 
ldb
.
cu¼’še
 =ğ
Êum
;

1820 ià(
cu¼’t
 && 
bp
)

1821 
´efix
 = "->#";

1822 ià(
cu¼’t
)

1823 
´efix
 = "-> ";

1824 ià(
bp
)

1825 
´efix
 = " #";

1827 
´efix
 = " ";

1828 
sds
 
thi¦še
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"%s%-3d %s", 
´efix
, 
Êum
, 
lše
);

1829 
	`ldbLog
(
thi¦še
);

1830 
	}
}

1837 
	$ldbLi¡
(
¬ound
, 
cÚ‹xt
) {

1838 
j
;

1840 
j
 = 1; j <ğ
ldb
.
lšes
; j++) {

1841 ià(
¬ound
 !ğ0 && 
	`abs
×round-
j
è> 
cÚ‹xt
) ;

1842 
	`ldbLogSourûLše
(
j
);

1844 
	}
}

1853 
	#LDB_MAX_VALUES_DEPTH
 (
LUA_MINSTACK
/2)

	)

1854 
sds
 
	$ldbC©SckV®ueRec
(
sds
 
s
, 
lua_S‹
 *
lua
, 
idx
, 
Ëv–
) {

1855 
t
 = 
	`lua_ty³
(
lua
,
idx
);

1857 ià(
Ëv–
++ =ğ
LDB_MAX_VALUES_DEPTH
)

1858  
	`sdsÿt
(
s
,"<max„ecursion†evel„eached! Nestedable?>");

1860 
t
) {

1861 
LUA_TSTRING
:

1863 
size_t
 
¡¾
;

1864 *
¡½
 = (*)
	`lua_tŞ¡ršg
(
lua
,
idx
,&
¡¾
);

1865 
s
 = 
	`sdsÿŒ•r
(s,
¡½
,
¡¾
);

1868 
LUA_TBOOLEAN
:

1869 
s
 = 
	`sdsÿt
(s,
	`lua_toboŞ—n
(
lua
,
idx
) ? "true" : "false");

1871 
LUA_TNUMBER
:

1872 
s
 = 
	`sdsÿrštf
(s,"%g",()
	`lua_tÚumb”
(
lua
,
idx
));

1874 
LUA_TNIL
:

1875 
s
 = 
	`sdsÿ’
(s,"nil",3);

1877 
LUA_TTABLE
:

1879 
ex³ùed_šdex
 = 1;

1880 
is_¬¿y
 = 1;

1884 
sds
 
»´1
 = 
	`sd£m±y
();

1885 
sds
 
»´2
 = 
	`sd£m±y
();

1886 
	`lua_pushn
(
lua
);

1887 
	`lua_Ãxt
(
lua
,
idx
-1)) {

1889 ià(
is_¬¿y
 &&

1890 (
	`lua_ty³
(
lua
,-2è!ğ
LUA_TNUMBER
 ||

1891 
	`lua_tÚumb”
(
lua
,-2è!ğ
ex³ùed_šdex
)è
is_¬¿y
 = 0;

1894 
»´1
 = 
	`ldbC©SckV®ueRec
Ô•r1,
lua
,-1,
Ëv–
);

1895 
»´1
 = 
	`sdsÿ’
(repr1,"; ",2);

1897 
»´2
 = 
	`sdsÿ’
(repr2,"[",1);

1898 
»´2
 = 
	`ldbC©SckV®ueRec
Ô•r2,
lua
,-2,
Ëv–
);

1899 
»´2
 = 
	`sdsÿ’
(repr2,"]=",2);

1900 
»´2
 = 
	`ldbC©SckV®ueRec
Ô•r2,
lua
,-1,
Ëv–
);

1901 
»´2
 = 
	`sdsÿ’
(repr2,"; ",2);

1902 
	`lua_pİ
(
lua
,1);

1903 
ex³ùed_šdex
++;

1906 ià(
	`sd¦’
(
»´1
)è
	`sd¤ªge
(repr1,0,-3);

1907 ià(
	`sd¦’
(
»´2
)è
	`sd¤ªge
(repr2,0,-3);

1909 
s
 = 
	`sdsÿ’
(s,"{",1);

1910 
s
 = 
	`sdsÿtsds
(s,
is_¬¿y
 ? 
»´1
 : 
»´2
);

1911 
s
 = 
	`sdsÿ’
(s,"}",1);

1912 
	`sdsä“
(
»´1
);

1913 
	`sdsä“
(
»´2
);

1916 
LUA_TFUNCTION
:

1917 
LUA_TUSERDATA
:

1918 
LUA_TTHREAD
:

1919 
LUA_TLIGHTUSERDATA
:

1921 cÚ¡ *
p
 = 
	`lua_tİoš‹r
(
lua
,
idx
);

1922 *
ty³Çme
 = "unknown";

1923 ià(
t
 =ğ
LUA_TFUNCTION
è
ty³Çme
 = "function";

1924 ià(
t
 =ğ
LUA_TUSERDATA
è
ty³Çme
 = "userdata";

1925 ià(
t
 =ğ
LUA_TTHREAD
è
ty³Çme
 = "thread";

1926 ià(
t
 =ğ
LUA_TLIGHTUSERDATA
è
ty³Çme
 = "light-userdata";

1927 
s
 = 
	`sdsÿrštf
(s,"\"%s@%p\"",
ty³Çme
,
p
);

1931 
s
 = 
	`sdsÿt
(s,"\"<unknown-lua-type>\"");

1934  
s
;

1935 
	}
}

1939 
sds
 
	$ldbC©SckV®ue
(
sds
 
s
, 
lua_S‹
 *
lua
, 
idx
) {

1940  
	`ldbC©SckV®ueRec
(
s
,
lua
,
idx
,0);

1941 
	}
}

1946 
	$ldbLogSckV®ue
(
lua_S‹
 *
lua
, *
´efix
) {

1947 
sds
 
s
 = 
	`sd¢ew
(
´efix
);

1948 
s
 = 
	`ldbC©SckV®ue
(s,
lua
,-1);

1949 
	`ldbLogW™hMaxL’
(
s
);

1950 
	}
}

1952 *
ldbRedisPrÙocŞToHumª_IÁ
(
sds
 *
o
, *
»¶y
);

1953 *
ldbRedisPrÙocŞToHumª_Bulk
(
sds
 *
o
, *
»¶y
);

1954 *
ldbRedisPrÙocŞToHumª_Stus
(
sds
 *
o
, *
»¶y
);

1955 *
ldbRedisPrÙocŞToHumª_MuÉiBulk
(
sds
 *
o
, *
»¶y
);

1962 *
	$ldbRedisPrÙocŞToHumª
(
sds
 *
o
, *
»¶y
) {

1963 *
p
 = 
»¶y
;

1964 *
p
) {

1965 ':': 
p
 = 
	`ldbRedisPrÙocŞToHumª_IÁ
(
o
,
»¶y
); ;

1966 '$': 
p
 = 
	`ldbRedisPrÙocŞToHumª_Bulk
(
o
,
»¶y
); ;

1967 '+': 
p
 = 
	`ldbRedisPrÙocŞToHumª_Stus
(
o
,
»¶y
); ;

1968 '-': 
p
 = 
	`ldbRedisPrÙocŞToHumª_Stus
(
o
,
»¶y
); ;

1969 '*': 
p
 = 
	`ldbRedisPrÙocŞToHumª_MuÉiBulk
(
o
,
»¶y
); ;

1971  
p
;

1972 
	}
}

1977 *
	$ldbRedisPrÙocŞToHumª_IÁ
(
sds
 *
o
, *
»¶y
) {

1978 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

1979 *
o
 = 
	`sdsÿ’
(*o,
»¶y
+1,
p
-reply-1);

1980  
p
+2;

1981 
	}
}

1983 *
	$ldbRedisPrÙocŞToHumª_Bulk
(
sds
 *
o
, *
»¶y
) {

1984 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

1985 
bulkËn
;

1987 
	`¡ršg2Î
(
»¶y
+1,
p
-»¶y-1,&
bulkËn
);

1988 ià(
bulkËn
 == -1) {

1989 *
o
 = 
	`sdsÿ’
(*o,"NULL",4);

1990  
p
+2;

1992 *
o
 = 
	`sdsÿŒ•r
(*o,
p
+2,
bulkËn
);

1993  
p
+2+
bulkËn
+2;

1995 
	}
}

1997 *
	$ldbRedisPrÙocŞToHumª_Stus
(
sds
 *
o
, *
»¶y
) {

1998 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

2000 *
o
 = 
	`sdsÿŒ•r
(*o,
»¶y
,
p
-reply);

2001  
p
+2;

2002 
	}
}

2004 *
	$ldbRedisPrÙocŞToHumª_MuÉiBulk
(
sds
 *
o
, *
»¶y
) {

2005 *
p
 = 
	`¡rchr
(
»¶y
+1,'\r');

2006 
mbulkËn
;

2007 
j
 = 0;

2009 
	`¡ršg2Î
(
»¶y
+1,
p
-»¶y-1,&
mbulkËn
);

2010 
p
 += 2;

2011 ià(
mbulkËn
 == -1) {

2012 *
o
 = 
	`sdsÿ’
(*o,"NULL",4);

2013  
p
;

2015 *
o
 = 
	`sdsÿ’
(*o,"[",1);

2016 
j
 = 0; j < 
mbulkËn
; j++) {

2017 
p
 = 
	`ldbRedisPrÙocŞToHumª
(
o
,p);

2018 ià(
j
 !ğ
mbulkËn
-1è*
o
 = 
	`sdsÿ’
(*o,",",1);

2020 *
o
 = 
	`sdsÿ’
(*o,"]",1);

2021  
p
;

2022 
	}
}

2027 
	$ldbLogRedisR•ly
(*
»¶y
) {

2028 
sds
 
log
 = 
	`sd¢ew
("<reply> ");

2029 
	`ldbRedisPrÙocŞToHumª
(&
log
,
»¶y
);

2030 
	`ldbLogW™hMaxL’
(
log
);

2031 
	}
}

2036 
	$ldbPršt
(
lua_S‹
 *
lua
, *
v¬Çme
) {

2037 
lua_Debug
 
¬
;

2039 
l
 = 0;

2040 
	`lua_g‘¡ack
(
lua
,
l
,&
¬
) != 0) {

2041 
l
++;

2042 cÚ¡ *
Çme
;

2043 
i
 = 1;

2044 (
Çme
 = 
	`lua_g‘loÿl
(
lua
,&
¬
,
i
)è!ğ
NULL
) {

2045 
i
++;

2046 ià(
	`¡rcmp
(
v¬Çme
,
Çme
) == 0) {

2047 
	`ldbLogSckV®ue
(
lua
,"<value> ");

2048 
	`lua_pİ
(
lua
,1);

2051 
	`lua_pİ
(
lua
,1);

2057 ià(!
	`¡rcmp
(
v¬Çme
,"ARGV") || !strcmp(varname,"KEYS")) {

2058 
	`lua_g‘glob®
(
lua
, 
v¬Çme
);

2059 
	`ldbLogSckV®ue
(
lua
,"<value> ");

2060 
	`lua_pİ
(
lua
,1);

2062 
	`ldbLog
(
	`sd¢ew
("No such variable."));

2064 
	}
}

2068 
	$ldbPrštAÎ
(
lua_S‹
 *
lua
) {

2069 
lua_Debug
 
¬
;

2070 
v¬s
 = 0;

2072 ià(
	`lua_g‘¡ack
(
lua
,0,&
¬
) != 0) {

2073 cÚ¡ *
Çme
;

2074 
i
 = 1;

2075 (
Çme
 = 
	`lua_g‘loÿl
(
lua
,&
¬
,
i
)è!ğ
NULL
) {

2076 
i
++;

2077 ià(!
	`¡r¡r
(
Çme
,"(*temporary)")) {

2078 
sds
 
´efix
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"<v®ue> % ğ",
Çme
);

2079 
	`ldbLogSckV®ue
(
lua
,
´efix
);

2080 
	`sdsä“
(
´efix
);

2081 
v¬s
++;

2083 
	`lua_pİ
(
lua
,1);

2087 ià(
v¬s
 == 0) {

2088 
	`ldbLog
(
	`sd¢ew
("No†ocal variables inhe current context."));

2090 
	}
}

2093 
	$ldbB»ak
(
sds
 *
¬gv
, 
¬gc
) {

2094 ià(
¬gc
 == 1) {

2095 ià(
ldb
.
bpcouÁ
 == 0) {

2096 
	`ldbLog
(
	`sd¢ew
("No breakpoints set. Use 'b <line>'o‡dd one."));

2099 
	`ldbLog
(
	`sdsÿtfmt
(
	`sd£m±y
(),"%˜b»akpošt £t:",
ldb
.
bpcouÁ
));

2100 
j
;

2101 
j
 = 0; j < 
ldb
.
bpcouÁ
; j++)

2102 
	`ldbLogSourûLše
(
ldb
.
bp
[
j
]);

2105 
j
;

2106 
j
 = 1; j < 
¬gc
; j++) {

2107 *
¬g
 = 
¬gv
[
j
];

2108 
lše
;

2109 ià(!
	`¡ršg2l
(
¬g
,
	`sd¦’
×rg),&
lše
)) {

2110 
	`ldbLog
(
	`sdsÿtfmt
(
	`sd£m±y
(),"Inv®id‡rgum’t:'%s'",
¬g
));

2112 ià(
lše
 == 0) {

2113 
ldb
.
bpcouÁ
 = 0;

2114 
	`ldbLog
(
	`sd¢ew
("All breakpoints„emoved."));

2115 } ià(
lše
 > 0) {

2116 ià(
ldb
.
bpcouÁ
 =ğ
LDB_BREAKPOINTS_MAX
) {

2117 
	`ldbLog
(
	`sd¢ew
("Too many breakpoints set."));

2118 } ià(
	`ldbAddB»akpošt
(
lše
)) {

2119 
	`ldbLi¡
(
lše
,1);

2121 
	`ldbLog
(
	`sd¢ew
("Wrong†ine‚umber."));

2123 } ià(
lše
 < 0) {

2124 ià(
	`ldbD–B»akpošt
(-
lše
))

2125 
	`ldbLog
(
	`sd¢ew
("Breakpoint„emoved."));

2127 
	`ldbLog
(
	`sd¢ew
("No breakpoint inhe specified†ine."));

2132 
	}
}

2137 
	$ldbEv®
(
lua_S‹
 *
lua
, 
sds
 *
¬gv
, 
¬gc
) {

2139 
sds
 
code
 = 
	`sdsjošsds
(
¬gv
+1,
¬gc
-1," ",1);

2140 
sds
 
ex´
 = 
	`sdsÿtsds
(
	`sd¢ew
("»tuº "),
code
);

2143 ià(
	`luaL_lßdbufãr
(
lua
,
ex´
,
	`sd¦’
(expr),"@ldb_eval")) {

2144 
	`lua_pİ
(
lua
,1);

2146 ià(
	`luaL_lßdbufãr
(
lua
,
code
,
	`sd¦’
(code),"@ldb_eval")) {

2147 
	`ldbLog
(
	`sdsÿtfmt
(
	`sd£m±y
(),"<”rÜ> %s",
	`lua_to¡ršg
(
lua
,-1)));

2148 
	`lua_pİ
(
lua
,1);

2149 
	`sdsä“
(
code
);

2155 
	`sdsä“
(
code
);

2156 
	`sdsä“
(
ex´
);

2157 ià(
	`lua_pÿÎ
(
lua
,0,1,0)) {

2158 
	`ldbLog
(
	`sdsÿtfmt
(
	`sd£m±y
(),"<”rÜ> %s",
	`lua_to¡ršg
(
lua
,-1)));

2159 
	`lua_pİ
(
lua
,1);

2162 
	`ldbLogSckV®ue
(
lua
,"<retval> ");

2163 
	`lua_pİ
(
lua
,1);

2164 
	}
}

2170 
	$ldbRedis
(
lua_S‹
 *
lua
, 
sds
 *
¬gv
, 
¬gc
) {

2171 
j
, 
§ved_rc
 = 
£rv”
.
lua_»¶iÿ‹_commªds
;

2173 
	`lua_g‘glob®
(
lua
,"redis");

2174 
	`lua_push¡ršg
(
lua
,"call");

2175 
	`lua_g‘bË
(
lua
,-2);

2176 
j
 = 1; j < 
¬gc
; j++)

2177 
	`lua_pushl¡ršg
(
lua
,
¬gv
[
j
],
	`sd¦’
(argv[j]));

2178 
ldb
.
¡•
 = 1;

2179 
£rv”
.
lua_»¶iÿ‹_commªds
 = 1;

2180 
	`lua_pÿÎ
(
lua
,
¬gc
-1,1,0);

2181 
ldb
.
¡•
 = 0;

2182 
£rv”
.
lua_»¶iÿ‹_commªds
 = 
§ved_rc
;

2183 
	`lua_pİ
(
lua
,2);

2184 
	}
}

2188 
	$ldbT¿û
(
lua_S‹
 *
lua
) {

2189 
lua_Debug
 
¬
;

2190 
Ëv–
 = 0;

2192 
	`lua_g‘¡ack
(
lua
,
Ëv–
,&
¬
)) {

2193 
	`lua_g‘šfo
(
lua
,"SÆ",&
¬
);

2194 if(
	`¡r¡r
(
¬
.
shÜt_¤c
,"u£r_süt"è!ğ
NULL
) {

2195 
	`ldbLog
(
	`sdsÿrštf
(
	`sd£m±y
(),"%s %s:",

2196 (
Ëv–
 == 0) ? "In" : "From",

2197 
¬
.
Çme
 ?‡r.name : "top†evel"));

2198 
	`ldbLogSourûLše
(
¬
.
cu¼’še
);

2200 
Ëv–
++;

2202 ià(
Ëv–
 == 0) {

2203 
	`ldbLog
(
	`sd¢ew
("<error> Can't„etrieve Lua stack."));

2205 
	}
}

2209 
	$ldbMaxËn
(
sds
 *
¬gv
, 
¬gc
) {

2210 ià(
¬gc
 == 2) {

2211 
Ãwv®
 = 
	`©oi
(
¬gv
[1]);

2212 
ldb
.
maxËn_hšt_£Á
 = 1;

2213 ià(
Ãwv®
 != 0 &&‚ewval <= 60)‚ewval = 60;

2214 
ldb
.
maxËn
 = 
Ãwv®
;

2216 ià(
ldb
.
maxËn
) {

2217 
	`ldbLog
(
	`sdsÿrštf
(
	`sd£m±y
(),"<v®ue>„•l› ¬Œunÿ‹d‡ˆ%d by‹s.",()
ldb
.
maxËn
));

2219 
	`ldbLog
(
	`sdsÿrštf
(
	`sd£m±y
(),"<value>„eplies‡re unlimited."));

2221 
	}
}

2226 
	$ldbR•l
(
lua_S‹
 *
lua
) {

2227 
sds
 *
¬gv
;

2228 
¬gc
;

2233 (
¬gv
 = 
	`ldbR•lP¬£Commªd
(&
¬gc
)è=ğ
NULL
) {

2234 
buf
[1024];

2235 
Ä—d
 = 
	`»ad
(
ldb
.
fd
,
buf
,(buf));

2236 ià(
Ä—d
 <= 0) {

2239 
ldb
.
¡•
 = 0;

2240 
ldb
.
bpcouÁ
 = 0;

2241  
C_ERR
;

2243 
ldb
.
cbuf
 = 
	`sdsÿ’
Ödb.cbuf,
buf
,
Ä—d
);

2247 
	`sdsä“
(
ldb
.
cbuf
);

2248 
ldb
.
cbuf
 = 
	`sd£m±y
();

2251 ià(!
	`¡rÿ£cmp
(
¬gv
[0],"h") || !strcasecmp(argv[0],"help")) {

2252 
	`ldbLog
(
	`sd¢ew
("Redis Lua debugger help:"));

2253 
	`ldbLog
(
	`sd¢ew
("[h]elp Showhis help."));

2254 
	`ldbLog
(
	`sd¢ew
("[s]tep Run current†ine‡nd stop‡gain."));

2255 
	`ldbLog
(
	`sd¢ew
("[n]ext Alias for step."));

2256 
	`ldbLog
(
	`sd¢ew
("[c]continue Runill‚ext breakpoint."));

2257 
	`ldbLog
(
	`sd¢ew
("[l]list List source code‡round current†ine."));

2258 
	`ldbLog
(
	`sd¢ew
("[l]list [line] List source code‡round [line]."));

2259 
	`ldbLog
(
	`sd¢ew
("†ine = 0 means: current…osition."));

2260 
	`ldbLog
(
	`sd¢ew
("[l]list [line] [ctx] Inhis form [ctx] specifies how many†ines"));

2261 
	`ldbLog
(
	`sd¢ew
("o show before/after [line]."));

2262 
	`ldbLog
(
	`sd¢ew
("[w]hole List‡ll source code. Alias for 'list 1 1000000'."));

2263 
	`ldbLog
(
	`sd¢ew
("[p]rint Show‡llhe†ocal variables."));

2264 
	`ldbLog
(
	`sd¢ew
("[p]rint <var> Showhe value ofhe specified variable."));

2265 
	`ldbLog
(
	`sd¢ew
(" Can‡lso show global vars KEYS‡nd ARGV."));

2266 
	`ldbLog
(
	`sd¢ew
("[b]reak Show‡ll breakpoints."));

2267 
	`ldbLog
(
	`sd¢ew
("[b]reak <line> Add‡ breakpointohe specified†ine."));

2268 
	`ldbLog
(
	`sd¢ew
("[b]reak -<line> Remove breakpoint fromhe specified†ine."));

2269 
	`ldbLog
(
	`sd¢ew
("[b]reak 0 Remove‡ll breakpoints."));

2270 
	`ldbLog
(
	`sd¢ew
("[t]race Show‡ backtrace."));

2271 
	`ldbLog
(
	`sd¢ew
("[e]eval <code> Execute some Lua code (in‡ different callframe)."));

2272 
	`ldbLog
(
	`sd¢ew
("[r]edis <cmd> Execute‡ Redis command."));

2273 
	`ldbLog
(
	`sd¢ew
("[m]axlen [len] Trim†ogged Redis„eplies‡nd Lua var dumpso†en."));

2274 
	`ldbLog
(
	`sd¢ew
(" Specifying zero‡s <len> means unlimited."));

2275 
	`ldbLog
(
	`sd¢ew
("[a]abort Stopheƒxecution ofhe script. In sync"));

2276 
	`ldbLog
(
	`sd¢ew
(" mode dataset changes will be„etained."));

2277 
	`ldbLog
(
	`sd¢ew
(""));

2278 
	`ldbLog
(
	`sd¢ew
("Debugger functions you can call from Lua scripts:"));

2279 
	`ldbLog
(
	`sd¢ew
("redis.debug() Produce†ogs inhe debugger console."));

2280 
	`ldbLog
(
	`sd¢ew
("redis.breakpoint() Stopƒxecution†ike ifhere was‡ breakpoing."));

2281 
	`ldbLog
(
	`sd¢ew
(" inhe‚ext†ine of code."));

2282 
	`ldbS’dLogs
();

2283 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"s") || !strcasecmp(argv[0],"step") ||

2284 !
	`¡rÿ£cmp
(
¬gv
[0],"n") || !strcasecmp(argv[0],"next")) {

2285 
ldb
.
¡•
 = 1;

2287 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"c") || !strcasecmp(argv[0],"continue")){

2289 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"t") || !strcasecmp(argv[0],"trace")) {

2290 
	`ldbT¿û
(
lua
);

2291 
	`ldbS’dLogs
();

2292 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"m") || !strcasecmp(argv[0],"maxlen")) {

2293 
	`ldbMaxËn
(
¬gv
,
¬gc
);

2294 
	`ldbS’dLogs
();

2295 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"b") || !strcasecmp(argv[0],"break")) {

2296 
	`ldbB»ak
(
¬gv
,
¬gc
);

2297 
	`ldbS’dLogs
();

2298 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"e") || !strcasecmp(argv[0],"eval")) {

2299 
	`ldbEv®
(
lua
,
¬gv
,
¬gc
);

2300 
	`ldbS’dLogs
();

2301 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"a") || !strcasecmp(argv[0],"abort")) {

2302 
	`lua_push¡ršg
(
lua
, "script‡borted for user„equest");

2303 
	`lua_”rÜ
(
lua
);

2304 } ià(
¬gc
 > 1 &&

2305 (!
	`¡rÿ£cmp
(
¬gv
[0],"r") || !strcasecmp(argv[0],"redis"))) {

2306 
	`ldbRedis
(
lua
,
¬gv
,
¬gc
);

2307 
	`ldbS’dLogs
();

2308 } ià((!
	`¡rÿ£cmp
(
¬gv
[0],"p") || !strcasecmp(argv[0],"print"))) {

2309 ià(
¬gc
 == 2)

2310 
	`ldbPršt
(
lua
,
¬gv
[1]);

2312 
	`ldbPrštAÎ
(
lua
);

2313 
	`ldbS’dLogs
();

2314 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"l") || !strcasecmp(argv[0],"list")){

2315 
¬ound
 = 
ldb
.
cu¼’še
, 
ùx
 = 5;

2316 ià(
¬gc
 > 1) {

2317 
num
 = 
	`©oi
(
¬gv
[1]);

2318 ià(
num
 > 0è
¬ound
 =‚um;

2320 ià(
¬gc
 > 2è
ùx
 = 
	`©oi
(
¬gv
[2]);

2321 
	`ldbLi¡
(
¬ound
,
ùx
);

2322 
	`ldbS’dLogs
();

2323 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"w") || !strcasecmp(argv[0],"whole")){

2324 
	`ldbLi¡
(1,1000000);

2325 
	`ldbS’dLogs
();

2327 
	`ldbLog
(
	`sd¢ew
("<error> Unknown Redis Lua debugger command or "

2329 
	`ldbS’dLogs
();

2333 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

2337 
	`sdsä“¥l™»s
(
¬gv
,
¬gc
);

2338  
C_OK
;

2339 
	}
}

2343 
	$luaLdbLšeHook
(
lua_S‹
 *
lua
, 
lua_Debug
 *
¬
) {

2344 
	`lua_g‘¡ack
(
lua
,0,
¬
);

2345 
	`lua_g‘šfo
(
lua
,"Sl",
¬
);

2346 
ldb
.
cu¼’še
 = 
¬
->currentline;

2348 
bp
 = 
	`ldbIsB»akpošt
(
ldb
.
cu¼’še
è||†db.
luabp
;

2349 
timeout
 = 0;

2352 if(
	`¡r¡r
(
¬
->
shÜt_¤c
,"u£r_süt"è=ğ
NULL
) ;

2355 ià(
¬
->
ev’t
 =ğ
LUA_HOOKCOUNT
 && 
ldb
.
¡•
 =ğ0 && 
bp
 == 0) {

2356 
m¡ime_t
 
–­£d
 = 
	`m¡ime
(è- 
£rv”
.
lua_time_¡¬t
;

2357 
m¡ime_t
 
tim–im™
 = 
£rv”
.
lua_time_lim™
 ?

2358 
£rv”
.
lua_time_lim™
 : 5000;

2359 ià(
–­£d
 >ğ
tim–im™
) {

2360 
timeout
 = 1;

2361 
ldb
.
¡•
 = 1;

2367 ià(
ldb
.
¡•
 || 
bp
) {

2368 *
»asÚ
 = "step over";

2369 ià(
bp
è
»asÚ
 = 
ldb
.
luabp
 ? "redis.breakpoint() called" :

2371 ià(
timeout
è
»asÚ
 = "timeout„eached, infinite†oop?";

2372 
ldb
.
¡•
 = 0;

2373 
ldb
.
luabp
 = 0;

2374 
	`ldbLog
(
	`sdsÿrštf
(
	`sd£m±y
(),

2376 
ldb
.
cu¼’še
, 
»asÚ
));

2377 
	`ldbLogSourûLše
(
ldb
.
cu¼’še
);

2378 
	`ldbS’dLogs
();

2379 ià(
	`ldbR•l
(
lua
è=ğ
C_ERR
 && 
timeout
) {

2383 
	`lua_push¡ršg
(
lua
, "timeout during Lua debugging with client closing connection");

2384 
	`lua_”rÜ
(
lua
);

2386 
£rv”
.
lua_time_¡¬t
 = 
	`m¡ime
();

2388 
	}
}

	@sds.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

36 
	~<ùy³.h
>

37 
	~<as£¹.h
>

38 
	~<lim™s.h
>

39 
	~"sds.h
"

40 
	~"sd§Îoc.h
"

42 
šlše
 
	$sdsHdrSize
(
ty³
) {

43 
ty³
&
SDS_TYPE_MASK
) {

44 
SDS_TYPE_5
:

45  (
sdshdr5
);

46 
SDS_TYPE_8
:

47  (
sdshdr8
);

48 
SDS_TYPE_16
:

49  (
sdshdr16
);

50 
SDS_TYPE_32
:

51  (
sdshdr32
);

52 
SDS_TYPE_64
:

53  (
sdshdr64
);

56 
	}
}

58 
šlše
 
	$sdsReqTy³
(
size_t
 
¡ršg_size
) {

59 ià(
¡ršg_size
 < 1<<5)

60  
SDS_TYPE_5
;

61 ià(
¡ršg_size
 < 1<<8)

62  
SDS_TYPE_8
;

63 ià(
¡ršg_size
 < 1<<16)

64  
SDS_TYPE_16
;

65 #ià(
LONG_MAX
 =ğ
LLONG_MAX
)

66 ià(
¡ršg_size
 < 1ll<<32)

67  
SDS_TYPE_32
;

69  
SDS_TYPE_64
;

70 
	}
}

84 
sds
 
	$sd¢ewËn
(cÚ¡ *
š™
, 
size_t
 
š™Ën
) {

85 *
sh
;

86 
sds
 
s
;

87 
ty³
 = 
	`sdsReqTy³
(
š™Ën
);

90 ià(
ty³
 =ğ
SDS_TYPE_5
 && 
š™Ën
 =ğ0èty³ = 
SDS_TYPE_8
;

91 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

92 *
å
;

94 
sh
 = 
	`s_m®loc
(
hd¾’
+
š™Ën
+1);

95 ià(!
š™
)

96 
	`mem£t
(
sh
, 0, 
hd¾’
+
š™Ën
+1);

97 ià(
sh
 =ğ
NULL
)  NULL;

98 
s
 = (*)
sh
+
hd¾’
;

99 
å
 = ((*)
s
)-1;

100 
ty³
) {

101 
SDS_TYPE_5
: {

102 *
å
 = 
ty³
 | (
š™Ën
 << 
SDS_TYPE_BITS
);

105 
SDS_TYPE_8
: {

106 
	`SDS_HDR_VAR
(8,
s
);

107 
sh
->
Ën
 = 
š™Ën
;

108 
sh
->
®loc
 = 
š™Ën
;

109 *
å
 = 
ty³
;

112 
SDS_TYPE_16
: {

113 
	`SDS_HDR_VAR
(16,
s
);

114 
sh
->
Ën
 = 
š™Ën
;

115 
sh
->
®loc
 = 
š™Ën
;

116 *
å
 = 
ty³
;

119 
SDS_TYPE_32
: {

120 
	`SDS_HDR_VAR
(32,
s
);

121 
sh
->
Ën
 = 
š™Ën
;

122 
sh
->
®loc
 = 
š™Ën
;

123 *
å
 = 
ty³
;

126 
SDS_TYPE_64
: {

127 
	`SDS_HDR_VAR
(64,
s
);

128 
sh
->
Ën
 = 
š™Ën
;

129 
sh
->
®loc
 = 
š™Ën
;

130 *
å
 = 
ty³
;

134 ià(
š™Ën
 && 
š™
)

135 
	`memıy
(
s
, 
š™
, 
š™Ën
);

136 
s
[
š™Ën
] = '\0';

137  
s
;

138 
	}
}

142 
sds
 
	$sd£m±y
() {

143  
	`sd¢ewËn
("",0);

144 
	}
}

147 
sds
 
	$sd¢ew
(cÚ¡ *
š™
) {

148 
size_t
 
š™Ën
 = (
š™
 =ğ
NULL
è? 0 : 
	`¡¾’
(init);

149  
	`sd¢ewËn
(
š™
, 
š™Ën
);

150 
	}
}

153 
sds
 
	$sdsdup
(cÚ¡ 
sds
 
s
) {

154  
	`sd¢ewËn
(
s
, 
	`sd¦’
(s));

155 
	}
}

158 
	$sdsä“
(
sds
 
s
) {

159 ià(
s
 =ğ
NULL
) ;

160 
	`s_ä“
((*)
s
-
	`sdsHdrSize
(s[-1]));

161 
	}
}

177 
	$sdsupd©–’
(
sds
 
s
) {

178 
»®Ën
 = 
	`¡¾’
(
s
);

179 
	`sds£’
(
s
, 
»®Ën
);

180 
	}
}

186 
	$sdsş—r
(
sds
 
s
) {

187 
	`sds£’
(
s
, 0);

188 
s
[0] = '\0';

189 
	}
}

197 
sds
 
	$sdsMakeRoomFÜ
(
sds
 
s
, 
size_t
 
addËn
) {

198 *
sh
, *
Ãwsh
;

199 
size_t
 
ava
 = 
	`sd§va
(
s
);

200 
size_t
 
Ën
, 
ÃwËn
;

201 
ty³
, 
Şdty³
 = 
s
[-1] & 
SDS_TYPE_MASK
;

202 
hd¾’
;

205 ià(
ava
 >ğ
addËn
è 
s
;

207 
Ën
 = 
	`sd¦’
(
s
);

208 
sh
 = (*)
s
-
	`sdsHdrSize
(
Şdty³
);

209 
ÃwËn
 = (
Ën
+
addËn
);

210 ià(
ÃwËn
 < 
SDS_MAX_PREALLOC
)

211 
ÃwËn
 *= 2;

213 
ÃwËn
 +ğ
SDS_MAX_PREALLOC
;

215 
ty³
 = 
	`sdsReqTy³
(
ÃwËn
);

220 ià(
ty³
 =ğ
SDS_TYPE_5
èty³ = 
SDS_TYPE_8
;

222 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

223 ià(
Şdty³
==
ty³
) {

224 
Ãwsh
 = 
	`s_»®loc
(
sh
, 
hd¾’
+
ÃwËn
+1);

225 ià(
Ãwsh
 =ğ
NULL
)  NULL;

226 
s
 = (*)
Ãwsh
+
hd¾’
;

230 
Ãwsh
 = 
	`s_m®loc
(
hd¾’
+
ÃwËn
+1);

231 ià(
Ãwsh
 =ğ
NULL
)  NULL;

232 
	`memıy
((*)
Ãwsh
+
hd¾’
, 
s
, 
Ën
+1);

233 
	`s_ä“
(
sh
);

234 
s
 = (*)
Ãwsh
+
hd¾’
;

235 
s
[-1] = 
ty³
;

236 
	`sds£’
(
s
, 
Ën
);

238 
	`sds£Îoc
(
s
, 
ÃwËn
);

239  
s
;

240 
	}
}

248 
sds
 
	$sdsRemoveF»eS·û
(
sds
 
s
) {

249 *
sh
, *
Ãwsh
;

250 
ty³
, 
Şdty³
 = 
s
[-1] & 
SDS_TYPE_MASK
;

251 
hd¾’
;

252 
size_t
 
Ën
 = 
	`sd¦’
(
s
);

253 
sh
 = (*)
s
-
	`sdsHdrSize
(
Şdty³
);

255 
ty³
 = 
	`sdsReqTy³
(
Ën
);

256 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

257 ià(
Şdty³
==
ty³
) {

258 
Ãwsh
 = 
	`s_»®loc
(
sh
, 
hd¾’
+
Ën
+1);

259 ià(
Ãwsh
 =ğ
NULL
)  NULL;

260 
s
 = (*)
Ãwsh
+
hd¾’
;

262 
Ãwsh
 = 
	`s_m®loc
(
hd¾’
+
Ën
+1);

263 ià(
Ãwsh
 =ğ
NULL
)  NULL;

264 
	`memıy
((*)
Ãwsh
+
hd¾’
, 
s
, 
Ën
+1);

265 
	`s_ä“
(
sh
);

266 
s
 = (*)
Ãwsh
+
hd¾’
;

267 
s
[-1] = 
ty³
;

268 
	`sds£’
(
s
, 
Ën
);

270 
	`sds£Îoc
(
s
, 
Ën
);

271  
s
;

272 
	}
}

281 
size_t
 
	$sdsAÎocSize
(
sds
 
s
) {

282 
size_t
 
®loc
 = 
	`sd§Îoc
(
s
);

283  
	`sdsHdrSize
(
s
[-1])+
®loc
+1;

284 
	}
}

288 *
	$sdsAÎocPŒ
(
sds
 
s
) {

289  (*è(
s
-
	`sdsHdrSize
(s[-1]));

290 
	}
}

315 
	$sdsInüL’
(
sds
 
s
, 
šü
) {

316 
æags
 = 
s
[-1];

317 
size_t
 
Ën
;

318 
æags
&
SDS_TYPE_MASK
) {

319 
SDS_TYPE_5
: {

320 *
å
 = ((*)
s
)-1;

321 
ŞdËn
 = 
	`SDS_TYPE_5_LEN
(
æags
);

322 
	`as£¹
((
šü
 > 0 && 
ŞdËn
+incr < 32) || (incr < 0 && oldlen >= ()(-incr)));

323 *
å
 = 
SDS_TYPE_5
 | ((
ŞdËn
+
šü
è<< 
SDS_TYPE_BITS
);

324 
Ën
 = 
ŞdËn
+
šü
;

327 
SDS_TYPE_8
: {

328 
	`SDS_HDR_VAR
(8,
s
);

329 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= incr) || (incr < 0 && sh->len >= ()(-incr)));

330 
Ën
 = (
sh
->ËÀ+ğ
šü
);

333 
SDS_TYPE_16
: {

334 
	`SDS_HDR_VAR
(16,
s
);

335 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= incr) || (incr < 0 && sh->len >= ()(-incr)));

336 
Ën
 = (
sh
->ËÀ+ğ
šü
);

339 
SDS_TYPE_32
: {

340 
	`SDS_HDR_VAR
(32,
s
);

341 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= ()incr) || (incr < 0 && sh->len >= ()(-incr)));

342 
Ën
 = (
sh
->ËÀ+ğ
šü
);

345 
SDS_TYPE_64
: {

346 
	`SDS_HDR_VAR
(64,
s
);

347 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >ğ(
ušt64_t
)incr) || (incr < 0 && sh->len >= (uint64_t)(-incr)));

348 
Ën
 = (
sh
->ËÀ+ğ
šü
);

351 : 
Ën
 = 0;

353 
s
[
Ën
] = '\0';

354 
	}
}

361 
sds
 
	$sdsgrowz”o
(
sds
 
s
, 
size_t
 
Ën
) {

362 
size_t
 
cu¾’
 = 
	`sd¦’
(
s
);

364 ià(
Ën
 <ğ
cu¾’
è 
s
;

365 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
-
cu¾’
);

366 ià(
s
 =ğ
NULL
)  NULL;

369 
	`mem£t
(
s
+
cu¾’
,0,(
Ën
-curlen+1));

370 
	`sds£’
(
s
, 
Ën
);

371  
s
;

372 
	}
}

379 
sds
 
	$sdsÿ’
(
sds
 
s
, cÚ¡ *
t
, 
size_t
 
Ën
) {

380 
size_t
 
cu¾’
 = 
	`sd¦’
(
s
);

382 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
);

383 ià(
s
 =ğ
NULL
)  NULL;

384 
	`memıy
(
s
+
cu¾’
, 
t
, 
Ën
);

385 
	`sds£’
(
s
, 
cu¾’
+
Ën
);

386 
s
[
cu¾’
+
Ën
] = '\0';

387  
s
;

388 
	}
}

394 
sds
 
	$sdsÿt
(
sds
 
s
, cÚ¡ *
t
) {

395  
	`sdsÿ’
(
s
, 
t
, 
	`¡¾’
(t));

396 
	}
}

402 
sds
 
	$sdsÿtsds
(
sds
 
s
, cÚ¡ sd 
t
) {

403  
	`sdsÿ’
(
s
, 
t
, 
	`sd¦’
(t));

404 
	}
}

408 
sds
 
	$sdsıyËn
(
sds
 
s
, cÚ¡ *
t
, 
size_t
 
Ën
) {

409 ià(
	`sd§Îoc
(
s
è< 
Ën
) {

410 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
-
	`sd¦’
(s));

411 ià(
s
 =ğ
NULL
)  NULL;

413 
	`memıy
(
s
, 
t
, 
Ën
);

414 
s
[
Ën
] = '\0';

415 
	`sds£’
(
s
, 
Ën
);

416  
s
;

417 
	}
}

421 
sds
 
	$sdsıy
(
sds
 
s
, cÚ¡ *
t
) {

422  
	`sdsıyËn
(
s
, 
t
, 
	`¡¾’
(t));

423 
	}
}

431 
	#SDS_LLSTR_SIZE
 21

	)

432 
	$sd¦l2¡r
(*
s
, 
v®ue
) {

433 *
p
, 
aux
;

434 
v
;

435 
size_t
 
l
;

439 
v
 = (
v®ue
 < 0) ? -value : value;

440 
p
 = 
s
;

442 *
p
++ = '0'+(
v
%10);

443 
v
 /= 10;

444 } 
v
);

445 ià(
v®ue
 < 0è*
p
++ = '-';

448 
l
 = 
p
-
s
;

449 *
p
 = '\0';

452 
p
--;

453 
s
 < 
p
) {

454 
aux
 = *
s
;

455 *
s
 = *
p
;

456 *
p
 = 
aux
;

457 
s
++;

458 
p
--;

460  
l
;

461 
	}
}

464 
	$sdsuÎ2¡r
(*
s
, 
v
) {

465 *
p
, 
aux
;

466 
size_t
 
l
;

470 
p
 = 
s
;

472 *
p
++ = '0'+(
v
%10);

473 
v
 /= 10;

474 } 
v
);

477 
l
 = 
p
-
s
;

478 *
p
 = '\0';

481 
p
--;

482 
s
 < 
p
) {

483 
aux
 = *
s
;

484 *
s
 = *
p
;

485 *
p
 = 
aux
;

486 
s
++;

487 
p
--;

489  
l
;

490 
	}
}

496 
sds
 
	$sdsäomlÚglÚg
(
v®ue
) {

497 
buf
[
SDS_LLSTR_SIZE
];

498 
Ën
 = 
	`sd¦l2¡r
(
buf
,
v®ue
);

500  
	`sd¢ewËn
(
buf
,
Ën
);

501 
	}
}

504 
sds
 
	$sdsÿtv´štf
(
sds
 
s
, cÚ¡ *
fmt
, 
va_li¡
 
­
) {

505 
va_li¡
 
ıy
;

506 
¡©icbuf
[1024], *
buf
 = sticbuf, *
t
;

507 
size_t
 
buæ’
 = 
	`¡¾’
(
fmt
)*2;

511 ià(
buæ’
 > (
¡©icbuf
)) {

512 
buf
 = 
	`s_m®loc
(
buæ’
);

513 ià(
buf
 =ğ
NULL
)  NULL;

515 
buæ’
 = (
¡©icbuf
);

521 
buf
[
buæ’
-2] = '\0';

522 
	`va_cİy
(
ıy
,
­
);

523 
	`v¢´štf
(
buf
, 
buæ’
, 
fmt
, 
ıy
);

524 
	`va_’d
(
ıy
);

525 ià(
buf
[
buæ’
-2] != '\0') {

526 ià(
buf
 !ğ
¡©icbuf
è
	`s_ä“
(buf);

527 
buæ’
 *= 2;

528 
buf
 = 
	`s_m®loc
(
buæ’
);

529 ià(
buf
 =ğ
NULL
)  NULL;

536 
t
 = 
	`sdsÿt
(
s
, 
buf
);

537 ià(
buf
 !ğ
¡©icbuf
è
	`s_ä“
(buf);

538  
t
;

539 
	}
}

557 
sds
 
	$sdsÿrštf
(
sds
 
s
, cÚ¡ *
fmt
, ...) {

558 
va_li¡
 
­
;

559 *
t
;

560 
	`va_¡¬t
(
­
, 
fmt
);

561 
t
 = 
	`sdsÿtv´štf
(
s
,
fmt
,
­
);

562 
	`va_’d
(
­
);

563  
t
;

564 
	}
}

582 
sds
 
	$sdsÿtfmt
(
sds
 
s
, cÚ¡ *
fmt
, ...) {

583 
size_t
 
š™Ën
 = 
	`sd¦’
(
s
);

584 cÚ¡ *
f
 = 
fmt
;

585 
i
;

586 
va_li¡
 
­
;

588 
	`va_¡¬t
(
­
,
fmt
);

589 
f
 = 
fmt
;

590 
i
 = 
š™Ën
;

591 *
f
) {

592 
Ãxt
, *
¡r
;

593 
size_t
 
l
;

594 
num
;

595 
unum
;

598 ià(
	`sd§va
(
s
)==0) {

599 
s
 = 
	`sdsMakeRoomFÜ
(s,1);

602 *
f
) {

604 
Ãxt
 = *(
f
+1);

605 
f
++;

606 
Ãxt
) {

609 
¡r
 = 
	`va_¬g
(
­
,*);

610 
l
 = (
Ãxt
 =ğ's'è? 
	`¡¾’
(
¡r
è: 
	`sd¦’
(str);

611 ià(
	`sd§va
(
s
è< 
l
) {

612 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

614 
	`memıy
(
s
+
i
,
¡r
,
l
);

615 
	`sdsšş’
(
s
,
l
);

616 
i
 +ğ
l
;

620 ià(
Ãxt
 == 'i')

621 
num
 = 
	`va_¬g
(
­
,);

623 
num
 = 
	`va_¬g
(
­
,);

625 
buf
[
SDS_LLSTR_SIZE
];

626 
l
 = 
	`sd¦l2¡r
(
buf
,
num
);

627 ià(
	`sd§va
(
s
è< 
l
) {

628 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

630 
	`memıy
(
s
+
i
,
buf
,
l
);

631 
	`sdsšş’
(
s
,
l
);

632 
i
 +ğ
l
;

637 ià(
Ãxt
 == 'u')

638 
unum
 = 
	`va_¬g
(
­
,);

640 
unum
 = 
	`va_¬g
(
­
,);

642 
buf
[
SDS_LLSTR_SIZE
];

643 
l
 = 
	`sdsuÎ2¡r
(
buf
,
unum
);

644 ià(
	`sd§va
(
s
è< 
l
) {

645 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

647 
	`memıy
(
s
+
i
,
buf
,
l
);

648 
	`sdsšş’
(
s
,
l
);

649 
i
 +ğ
l
;

653 
s
[
i
++] = 
Ãxt
;

654 
	`sdsšş’
(
s
,1);

659 
s
[
i
++] = *
f
;

660 
	`sdsšş’
(
s
,1);

663 
f
++;

665 
	`va_’d
(
­
);

668 
s
[
i
] = '\0';

669  
s
;

670 
	}
}

686 
sds
 
	$sd¡rim
(
sds
 
s
, cÚ¡ *
c£t
) {

687 *
¡¬t
, *
’d
, *
¥
, *
•
;

688 
size_t
 
Ën
;

690 
¥
 = 
¡¬t
 = 
s
;

691 
•
 = 
’d
 = 
s
+
	`sd¦’
(s)-1;

692 
¥
 <ğ
’d
 && 
	`¡rchr
(
c£t
, *sp)) sp++;

693 
•
 > 
¥
 && 
	`¡rchr
(
c£t
, *ep))ƒp--;

694 
Ën
 = (
¥
 > 
•
) ? 0 : ((ep-sp)+1);

695 ià(
s
 !ğ
¥
è
	`memmove
(s, sp, 
Ën
);

696 
s
[
Ën
] = '\0';

697 
	`sds£’
(
s
,
Ën
);

698  
s
;

699 
	}
}

717 
	$sd¤ªge
(
sds
 
s
, 
¡¬t
, 
’d
) {

718 
size_t
 
ÃwËn
, 
Ën
 = 
	`sd¦’
(
s
);

720 ià(
Ën
 == 0) ;

721 ià(
¡¬t
 < 0) {

722 
¡¬t
 = 
Ën
+start;

723 ià(
¡¬t
 < 0) start = 0;

725 ià(
’d
 < 0) {

726 
’d
 = 
Ën
+end;

727 ià(
’d
 < 0)ƒnd = 0;

729 
ÃwËn
 = (
¡¬t
 > 
’d
) ? 0 : (end-start)+1;

730 ià(
ÃwËn
 != 0) {

731 ià(
¡¬t
 >ğ(sigÃd)
Ën
) {

732 
ÃwËn
 = 0;

733 } ià(
’d
 >ğ(sigÃd)
Ën
) {

734 
’d
 = 
Ën
-1;

735 
ÃwËn
 = (
¡¬t
 > 
’d
) ? 0 : (end-start)+1;

738 
¡¬t
 = 0;

740 ià(
¡¬t
 && 
ÃwËn
è
	`memmove
(
s
, s+start,‚ewlen);

741 
s
[
ÃwËn
] = 0;

742 
	`sds£’
(
s
,
ÃwËn
);

743 
	}
}

746 
	$sd¡Şow”
(
sds
 
s
) {

747 
Ën
 = 
	`sd¦’
(
s
), 
j
;

749 
j
 = 0; j < 
Ën
; j++è
s
[j] = 
	`tŞow”
(s[j]);

750 
	}
}

753 
	$sd¡ouµ”
(
sds
 
s
) {

754 
Ën
 = 
	`sd¦’
(
s
), 
j
;

756 
j
 = 0; j < 
Ën
; j++è
s
[j] = 
	`touµ”
(s[j]);

757 
	}
}

770 
	$sdscmp
(cÚ¡ 
sds
 
s1
, cÚ¡ sd 
s2
) {

771 
size_t
 
l1
, 
l2
, 
mšËn
;

772 
cmp
;

774 
l1
 = 
	`sd¦’
(
s1
);

775 
l2
 = 
	`sd¦’
(
s2
);

776 
mšËn
 = (
l1
 < 
l2
) ?†1 :†2;

777 
cmp
 = 
	`memcmp
(
s1
,
s2
,
mšËn
);

778 ià(
cmp
 =ğ0è 
l1
-
l2
;

779  
cmp
;

780 
	}
}

798 
sds
 *
	$sds¥l™Ën
(cÚ¡ *
s
, 
Ën
, cÚ¡ *
£p
, 
£¶’
, *
couÁ
) {

799 
–em’ts
 = 0, 
¦Ùs
 = 5, 
¡¬t
 = 0, 
j
;

800 
sds
 *
tok’s
;

802 ià(
£¶’
 < 1 || 
Ën
 < 0è 
NULL
;

804 
tok’s
 = 
	`s_m®loc
((
sds
)*
¦Ùs
);

805 ià(
tok’s
 =ğ
NULL
)  NULL;

807 ià(
Ën
 == 0) {

808 *
couÁ
 = 0;

809  
tok’s
;

811 
j
 = 0; j < (
Ën
-(
£¶’
-1)); j++) {

813 ià(
¦Ùs
 < 
–em’ts
+2) {

814 
sds
 *
Ãwtok’s
;

816 
¦Ùs
 *= 2;

817 
Ãwtok’s
 = 
	`s_»®loc
(
tok’s
,(
sds
)*
¦Ùs
);

818 ià(
Ãwtok’s
 =ğ
NULL
è
ş—nup
;

819 
tok’s
 = 
Ãwtok’s
;

822 ià((
£¶’
 =ğ1 && *(
s
+
j
è=ğ
£p
[0]è|| (
	`memcmp
(s+j,sep,seplen) == 0)) {

823 
tok’s
[
–em’ts
] = 
	`sd¢ewËn
(
s
+
¡¬t
,
j
-start);

824 ià(
tok’s
[
–em’ts
] =ğ
NULL
è
ş—nup
;

825 
–em’ts
++;

826 
¡¬t
 = 
j
+
£¶’
;

827 
j
 = j+
£¶’
-1;

831 
tok’s
[
–em’ts
] = 
	`sd¢ewËn
(
s
+
¡¬t
,
Ën
-start);

832 ià(
tok’s
[
–em’ts
] =ğ
NULL
è
ş—nup
;

833 
–em’ts
++;

834 *
couÁ
 = 
–em’ts
;

835  
tok’s
;

837 
ş—nup
:

839 
i
;

840 
i
 = 0; i < 
–em’ts
; i++è
	`sdsä“
(
tok’s
[i]);

841 
	`s_ä“
(
tok’s
);

842 *
couÁ
 = 0;

843  
NULL
;

845 
	}
}

848 
	$sdsä“¥l™»s
(
sds
 *
tok’s
, 
couÁ
) {

849 ià(!
tok’s
) ;

850 
couÁ
--)

851 
	`sdsä“
(
tok’s
[
couÁ
]);

852 
	`s_ä“
(
tok’s
);

853 
	}
}

861 
sds
 
	$sdsÿŒ•r
(
sds
 
s
, cÚ¡ *
p
, 
size_t
 
Ën
) {

862 
s
 = 
	`sdsÿ’
(s,"\"",1);

863 
Ën
--) {

864 *
p
) {

867 
s
 = 
	`sdsÿrštf
(s,"\\%c",*
p
);

869 '\n': 
s
 = 
	`sdsÿ’
(s,"\\n",2); ;

870 '\r': 
s
 = 
	`sdsÿ’
(s,"\\r",2); ;

871 '\t': 
s
 = 
	`sdsÿ’
(s,"\\t",2); ;

872 '\a': 
s
 = 
	`sdsÿ’
(s,"\\a",2); ;

873 '\b': 
s
 = 
	`sdsÿ’
(s,"\\b",2); ;

875 ià(
	`i¥ršt
(*
p
))

876 
s
 = 
	`sdsÿrštf
(s,"%c",*
p
);

878 
s
 = 
	`sdsÿrštf
(s,"\\x%02x",()*
p
);

881 
p
++;

883  
	`sdsÿ’
(
s
,"\"",1);

884 
	}
}

888 
	$is_hex_dig™
(
c
) {

889  (
c
 >= '0' && c <= '9') || (c >= 'a' && c <= 'f') ||

890 (
c
 >= 'A' && c <= 'F');

891 
	}
}

895 
	$hex_dig™_to_št
(
c
) {

896 
c
) {

915 
	}
}

936 
sds
 *
	$sds¥l™¬gs
(cÚ¡ *
lše
, *
¬gc
) {

937 cÚ¡ *
p
 = 
lše
;

938 *
cu¼’t
 = 
NULL
;

939 **
veùÜ
 = 
NULL
;

941 *
¬gc
 = 0;

944 *
p
 && 
	`is¥aû
(*p))…++;

945 ià(*
p
) {

947 
šq
=0;

948 
šsq
=0;

949 
dÚe
=0;

951 ià(
cu¼’t
 =ğ
NULL
ècu¼’ˆğ
	`sd£m±y
();

952 !
dÚe
) {

953 ià(
šq
) {

954 ià(*
p
 == '\\' && *(p+1) == 'x' &&

955 
	`is_hex_dig™
(*(
p
+2)) &&

956 
	`is_hex_dig™
(*(
p
+3)))

958 
by‹
;

960 
by‹
 = (
	`hex_dig™_to_št
(*(
p
+2))*16)+

961 
	`hex_dig™_to_št
(*(
p
+3));

962 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,(*)&
by‹
,1);

963 
p
 += 3;

964 } ià(*
p
 == '\\' && *(p+1)) {

965 
c
;

967 
p
++;

968 *
p
) {

969 'n': 
c
 = '\n'; ;

970 'r': 
c
 = '\r'; ;

971 't': 
c
 = '\t'; ;

972 'b': 
c
 = '\b'; ;

973 'a': 
c
 = '\a'; ;

974 : 
c
 = *
p
; ;

976 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,&
c
,1);

977 } ià(*
p
 == '"') {

980 ià(*(
p
+1è&& !
	`is¥aû
(*Õ+1))è
”r
;

981 
dÚe
=1;

982 } ià(!*
p
) {

984 
”r
;

986 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

988 } ià(
šsq
) {

989 ià(*
p
 == '\\' && *(p+1) == '\'') {

990 
p
++;

991 
cu¼’t
 = 
	`sdsÿ’
(current,"'",1);

992 } ià(*
p
 == '\'') {

995 ià(*(
p
+1è&& !
	`is¥aû
(*Õ+1))è
”r
;

996 
dÚe
=1;

997 } ià(!*
p
) {

999 
”r
;

1001 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

1004 *
p
) {

1010 
dÚe
=1;

1013 
šq
=1;

1016 
šsq
=1;

1019 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

1023 ià(*
p
)…++;

1026 
veùÜ
 = 
	`s_»®loc
(veùÜ,((*
¬gc
)+1)*(*));

1027 
veùÜ
[*
¬gc
] = 
cu¼’t
;

1028 (*
¬gc
)++;

1029 
cu¼’t
 = 
NULL
;

1032 ià(
veùÜ
 =ğ
NULL
èveùÜ = 
	`s_m®loc
((*));

1033  
veùÜ
;

1037 
”r
:

1038 (*
¬gc
)--)

1039 
	`sdsä“
(
veùÜ
[*
¬gc
]);

1040 
	`s_ä“
(
veùÜ
);

1041 ià(
cu¼’t
è
	`sdsä“
(current);

1042 *
¬gc
 = 0;

1043  
NULL
;

1044 
	}
}

1055 
sds
 
	$sdsm­ch¬s
(
sds
 
s
, cÚ¡ *
äom
, cÚ¡ *
to
, 
size_t
 
£’
) {

1056 
size_t
 
j
, 
i
, 
l
 = 
	`sd¦’
(
s
);

1058 
j
 = 0; j < 
l
; j++) {

1059 
i
 = 0; i < 
£’
; i++) {

1060 ià(
s
[
j
] =ğ
äom
[
i
]) {

1061 
s
[
j
] = 
to
[
i
];

1066  
s
;

1067 
	}
}

1071 
sds
 
	$sdsjoš
(**
¬gv
, 
¬gc
, *
£p
) {

1072 
sds
 
još
 = 
	`sd£m±y
();

1073 
j
;

1075 
j
 = 0; j < 
¬gc
; j++) {

1076 
još
 = 
	`sdsÿt
(još, 
¬gv
[
j
]);

1077 ià(
j
 !ğ
¬gc
-1è
još
 = 
	`sdsÿt
(još,
£p
);

1079  
još
;

1080 
	}
}

1083 
sds
 
	$sdsjošsds
(
sds
 *
¬gv
, 
¬gc
, cÚ¡ *
£p
, 
size_t
 
£¶’
) {

1084 
sds
 
još
 = 
	`sd£m±y
();

1085 
j
;

1087 
j
 = 0; j < 
¬gc
; j++) {

1088 
još
 = 
	`sdsÿtsds
(još, 
¬gv
[
j
]);

1089 ià(
j
 !ğ
¬gc
-1è
još
 = 
	`sdsÿ’
(još,
£p
,
£¶’
);

1091  
još
;

1092 
	}
}

1099 *
	$sds_m®loc
(
size_t
 
size
è{  
	`s_m®loc
(size); 
	}
}

1100 *
	$sds_»®loc
(*
±r
, 
size_t
 
size
è{  
	`s_»®loc
ÕŒ,size); 
	}
}

1101 
	$sds_ä“
(*
±r
è{ 
	`s_ä“
ÕŒ); 
	}
}

1103 #ià
defšed
(
SDS_TEST_MAIN
)

1104 
	~<¡dio.h
>

1105 
	~"‹¡h–p.h
"

1106 
	~"lim™s.h
"

1108 
	#UNUSED
(
x
è()(x)

	)

1109 
	$sdsTe¡
() {

1111 
sds
 
x
 = 
	`sd¢ew
("foo"), 
y
;

1113 
	`‹¡_cÚd
("Create‡ string‡nd obtainhe†ength",

1114 
	`sd¦’
(
x
è=ğ3 && 
	`memcmp
(x,"foo\0",4) == 0)

1116 
	`sdsä“
(
x
);

1117 
x
 = 
	`sd¢ewËn
("foo",2);

1118 
	`‹¡_cÚd
("Create‡ string with specified†ength",

1119 
	`sd¦’
(
x
è=ğ2 && 
	`memcmp
(x,"fo\0",3) == 0)

1121 
x
 = 
	`sdsÿt
(x,"bar");

1122 
	`‹¡_cÚd
("Strings concatenation",

1123 
	`sd¦’
(
x
è=ğ5 && 
	`memcmp
(x,"fobar\0",6) == 0);

1125 
x
 = 
	`sdsıy
(x,"a");

1126 
	`‹¡_cÚd
("sdscpy()‡gainst‡n originally†onger string",

1127 
	`sd¦’
(
x
è=ğ1 && 
	`memcmp
(x,"a\0",2) == 0)

1129 
x
 = 
	`sdsıy
(x,"xyzxxxxxxxxxxyyyyyyyyyykkkkkkkkkk");

1130 
	`‹¡_cÚd
("sdscpy()‡gainst‡n originally shorter string",

1131 
	`sd¦’
(
x
) == 33 &&

1132 
	`memcmp
(
x
,"xyzxxxxxxxxxxyyyyyyyyyykkkkkkkkkk\0",33) == 0)

1134 
	`sdsä“
(
x
);

1135 
x
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"%d",123);

1136 
	`‹¡_cÚd
("sdscatprintf() seems working inhe base case",

1137 
	`sd¦’
(
x
è=ğ3 && 
	`memcmp
(x,"123\0",4) == 0)

1139 
	`sdsä“
(
x
);

1140 
x
 = 
	`sd¢ew
("--");

1141 
x
 = 
	`sdsÿtfmt
(x, "H–lØ% WÜld %I,%I--", "Hi!", 
LLONG_MIN
,
LLONG_MAX
);

1142 
	`‹¡_cÚd
("sdscatfmt() seems working inhe base case",

1143 
	`sd¦’
(
x
) == 60 &&

1144 
	`memcmp
(
x
,"--Hello Hi! World -9223372036854775808,"

1146 
	`´štf
("[%s]\n",
x
);

1148 
	`sdsä“
(
x
);

1149 
x
 = 
	`sd¢ew
("--");

1150 
x
 = 
	`sdsÿtfmt
(x, "%u,%U--", 
UINT_MAX
, 
ULLONG_MAX
);

1151 
	`‹¡_cÚd
("sdscatfmt() seems working with unsigned‚umbers",

1152 
	`sd¦’
(
x
) == 35 &&

1153 
	`memcmp
(
x
,"--4294967295,18446744073709551615--",35) == 0)

1155 
	`sdsä“
(
x
);

1156 
x
 = 
	`sd¢ew
(" x ");

1157 
	`sd¡rim
(
x
," x");

1158 
	`‹¡_cÚd
("sdstrim() works when‡ll chars match",

1159 
	`sd¦’
(
x
) == 0)

1161 
	`sdsä“
(
x
);

1162 
x
 = 
	`sd¢ew
(" x ");

1163 
	`sd¡rim
(
x
," ");

1164 
	`‹¡_cÚd
("sdstrim() works when‡ single char„emains",

1165 
	`sd¦’
(
x
) == 1 && x[0] == 'x')

1167 
	`sdsä“
(
x
);

1168 
x
 = 
	`sd¢ew
("xxciaoyyy");

1169 
	`sd¡rim
(
x
,"xy");

1170 
	`‹¡_cÚd
("sdstrim() correctlyrims characters",

1171 
	`sd¦’
(
x
è=ğ4 && 
	`memcmp
(x,"ciao\0",5) == 0)

1173 
y
 = 
	`sdsdup
(
x
);

1174 
	`sd¤ªge
(
y
,1,1);

1175 
	`‹¡_cÚd
("sdsrange(...,1,1)",

1176 
	`sd¦’
(
y
è=ğ1 && 
	`memcmp
(y,"i\0",2) == 0)

1178 
	`sdsä“
(
y
);

1179 
y
 = 
	`sdsdup
(
x
);

1180 
	`sd¤ªge
(
y
,1,-1);

1181 
	`‹¡_cÚd
("sdsrange(...,1,-1)",

1182 
	`sd¦’
(
y
è=ğ3 && 
	`memcmp
(y,"iao\0",4) == 0)

1184 
	`sdsä“
(
y
);

1185 
y
 = 
	`sdsdup
(
x
);

1186 
	`sd¤ªge
(
y
,-2,-1);

1187 
	`‹¡_cÚd
("sdsrange(...,-2,-1)",

1188 
	`sd¦’
(
y
è=ğ2 && 
	`memcmp
(y,"ao\0",3) == 0)

1190 
	`sdsä“
(
y
);

1191 
y
 = 
	`sdsdup
(
x
);

1192 
	`sd¤ªge
(
y
,2,1);

1193 
	`‹¡_cÚd
("sdsrange(...,2,1)",

1194 
	`sd¦’
(
y
è=ğ0 && 
	`memcmp
(y,"\0",1) == 0)

1196 
	`sdsä“
(
y
);

1197 
y
 = 
	`sdsdup
(
x
);

1198 
	`sd¤ªge
(
y
,1,100);

1199 
	`‹¡_cÚd
("sdsrange(...,1,100)",

1200 
	`sd¦’
(
y
è=ğ3 && 
	`memcmp
(y,"iao\0",4) == 0)

1202 
	`sdsä“
(
y
);

1203 
y
 = 
	`sdsdup
(
x
);

1204 
	`sd¤ªge
(
y
,100,100);

1205 
	`‹¡_cÚd
("sdsrange(...,100,100)",

1206 
	`sd¦’
(
y
è=ğ0 && 
	`memcmp
(y,"\0",1) == 0)

1208 
	`sdsä“
(
y
);

1209 
	`sdsä“
(
x
);

1210 
x
 = 
	`sd¢ew
("foo");

1211 
y
 = 
	`sd¢ew
("foa");

1212 
	`‹¡_cÚd
("sdscmp(foo,fß)", 
	`sdscmp
(
x
,
y
) > 0)

1214 
	`sdsä“
(
y
);

1215 
	`sdsä“
(
x
);

1216 
x
 = 
	`sd¢ew
("bar");

1217 
y
 = 
	`sd¢ew
("bar");

1218 
	`‹¡_cÚd
("sdscmp(b¬,b¬)", 
	`sdscmp
(
x
,
y
) == 0)

1220 
	`sdsä“
(
y
);

1221 
	`sdsä“
(
x
);

1222 
x
 = 
	`sd¢ew
("aar");

1223 
y
 = 
	`sd¢ew
("bar");

1224 
	`‹¡_cÚd
("sdscmp(b¬,b¬)", 
	`sdscmp
(
x
,
y
) < 0)

1226 
	`sdsä“
(
y
);

1227 
	`sdsä“
(
x
);

1228 
x
 = 
	`sd¢ewËn
("\a\n\0foo\r",7);

1229 
y
 = 
	`sdsÿŒ•r
(
	`sd£m±y
(),
x
,
	`sd¦’
(x));

1230 
	`‹¡_cÚd
("sdscatrepr(...data...)",

1231 
	`memcmp
(
y
,"\"\\a\\n\\x00foo\\r\"",15) == 0)

1234 
Şdä“
;

1235 *
p
;

1236 
¡•
 = 10, 
j
, 
i
;

1238 
	`sdsä“
(
x
);

1239 
	`sdsä“
(
y
);

1240 
x
 = 
	`sd¢ew
("0");

1241 
	`‹¡_cÚd
("sd¢ew(èä“/ËÀbufãrs", 
	`sd¦’
(
x
è=ğ1 && 
	`sd§va
(x) == 0);

1245 
i
 = 0; i < 10; i++) {

1246 
ŞdËn
 = 
	`sd¦’
(
x
);

1247 
x
 = 
	`sdsMakeRoomFÜ
(x,
¡•
);

1248 
ty³
 = 
x
[-1]&
SDS_TYPE_MASK
;

1250 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èËn", 
	`sd¦’
(
x
è=ğ
ŞdËn
);

1251 ià(
ty³
 !ğ
SDS_TYPE_5
) {

1252 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èä“", 
	`sd§va
(
x
è>ğ
¡•
);

1253 
Şdä“
 = 
	`sd§va
(
x
);

1255 
p
 = 
x
+
ŞdËn
;

1256 
j
 = 0; j < 
¡•
; j++) {

1257 
p
[
j
] = 'A'+j;

1259 
	`sdsInüL’
(
x
,
¡•
);

1261 
	`‹¡_cÚd
("sdsMakeRoomFor() content",

1262 
	`memcmp
("0ABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJ",
x
,101) == 0);

1263 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èfš®†’gth",
	`sd¦’
(
x
)==101);

1265 
	`sdsä“
(
x
);

1268 
	`‹¡_»pÜt
()

1270 
	}
}

1273 #ifdeà
SDS_TEST_MAIN


1274 
	$maš
() {

1275  
	`sdsTe¡
();

1276 
	}
}

	@sds.h

33 #iâdeà
__SDS_H


34 
	#__SDS_H


	)

36 
	#SDS_MAX_PREALLOC
 (1024*1024)

	)

38 
	~<sys/ty³s.h
>

39 
	~<¡d¬g.h
>

40 
	~<¡dšt.h
>

42 *
	tsds
;

46 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr5
 {

47 
	gæags
;

48 
	gbuf
[];

50 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr8
 {

51 
ušt8_t
 
	gËn
;

52 
ušt8_t
 
	g®loc
;

53 
	gæags
;

54 
	gbuf
[];

56 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr16
 {

57 
ušt16_t
 
	gËn
;

58 
ušt16_t
 
	g®loc
;

59 
	gæags
;

60 
	gbuf
[];

62 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr32
 {

63 
ušt32_t
 
	gËn
;

64 
ušt32_t
 
	g®loc
;

65 
	gæags
;

66 
	gbuf
[];

68 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr64
 {

69 
ušt64_t
 
	gËn
;

70 
ušt64_t
 
	g®loc
;

71 
	gæags
;

72 
	gbuf
[];

75 
	#SDS_TYPE_5
 0

	)

76 
	#SDS_TYPE_8
 1

	)

77 
	#SDS_TYPE_16
 2

	)

78 
	#SDS_TYPE_32
 3

	)

79 
	#SDS_TYPE_64
 4

	)

80 
	#SDS_TYPE_MASK
 7

	)

81 
	#SDS_TYPE_BITS
 3

	)

82 
	#SDS_HDR_VAR
(
T
,
s
è
sdshdr
##T *
sh
 = (*)((s)-((sdshdr##T)));

	)

83 
	#SDS_HDR
(
T
,
s
è((
sdshdr
##T *)((s)-((sdshdr##T))))

	)

84 
	#SDS_TYPE_5_LEN
(
f
è((f)>>
SDS_TYPE_BITS
)

	)

86 
šlše
 
size_t
 
	$sd¦’
(cÚ¡ 
sds
 
s
) {

87 
æags
 = 
s
[-1];

88 
æags
&
SDS_TYPE_MASK
) {

89 
SDS_TYPE_5
:

90  
	`SDS_TYPE_5_LEN
(
æags
);

91 
SDS_TYPE_8
:

92  
	`SDS_HDR
(8,
s
)->
Ën
;

93 
SDS_TYPE_16
:

94  
	`SDS_HDR
(16,
s
)->
Ën
;

95 
SDS_TYPE_32
:

96  
	`SDS_HDR
(32,
s
)->
Ën
;

97 
SDS_TYPE_64
:

98  
	`SDS_HDR
(64,
s
)->
Ën
;

101 
	}
}

103 
šlše
 
size_t
 
	$sd§va
(cÚ¡ 
sds
 
s
) {

104 
æags
 = 
s
[-1];

105 
æags
&
SDS_TYPE_MASK
) {

106 
SDS_TYPE_5
: {

109 
SDS_TYPE_8
: {

110 
	`SDS_HDR_VAR
(8,
s
);

111  
sh
->
®loc
 - sh->
Ën
;

113 
SDS_TYPE_16
: {

114 
	`SDS_HDR_VAR
(16,
s
);

115  
sh
->
®loc
 - sh->
Ën
;

117 
SDS_TYPE_32
: {

118 
	`SDS_HDR_VAR
(32,
s
);

119  
sh
->
®loc
 - sh->
Ën
;

121 
SDS_TYPE_64
: {

122 
	`SDS_HDR_VAR
(64,
s
);

123  
sh
->
®loc
 - sh->
Ën
;

127 
	}
}

129 
šlše
 
	$sds£’
(
sds
 
s
, 
size_t
 
ÃwËn
) {

130 
æags
 = 
s
[-1];

131 
æags
&
SDS_TYPE_MASK
) {

132 
SDS_TYPE_5
:

134 *
å
 = ((*)
s
)-1;

135 *
å
 = 
SDS_TYPE_5
 | (
ÃwËn
 << 
SDS_TYPE_BITS
);

138 
SDS_TYPE_8
:

139 
	`SDS_HDR
(8,
s
)->
Ën
 = 
ÃwËn
;

141 
SDS_TYPE_16
:

142 
	`SDS_HDR
(16,
s
)->
Ën
 = 
ÃwËn
;

144 
SDS_TYPE_32
:

145 
	`SDS_HDR
(32,
s
)->
Ën
 = 
ÃwËn
;

147 
SDS_TYPE_64
:

148 
	`SDS_HDR
(64,
s
)->
Ën
 = 
ÃwËn
;

151 
	}
}

153 
šlše
 
	$sdsšş’
(
sds
 
s
, 
size_t
 
šc
) {

154 
æags
 = 
s
[-1];

155 
æags
&
SDS_TYPE_MASK
) {

156 
SDS_TYPE_5
:

158 *
å
 = ((*)
s
)-1;

159 
ÃwËn
 = 
	`SDS_TYPE_5_LEN
(
æags
)+
šc
;

160 *
å
 = 
SDS_TYPE_5
 | (
ÃwËn
 << 
SDS_TYPE_BITS
);

163 
SDS_TYPE_8
:

164 
	`SDS_HDR
(8,
s
)->
Ën
 +ğ
šc
;

166 
SDS_TYPE_16
:

167 
	`SDS_HDR
(16,
s
)->
Ën
 +ğ
šc
;

169 
SDS_TYPE_32
:

170 
	`SDS_HDR
(32,
s
)->
Ën
 +ğ
šc
;

172 
SDS_TYPE_64
:

173 
	`SDS_HDR
(64,
s
)->
Ën
 +ğ
šc
;

176 
	}
}

179 
šlše
 
size_t
 
	$sd§Îoc
(cÚ¡ 
sds
 
s
) {

180 
æags
 = 
s
[-1];

181 
æags
&
SDS_TYPE_MASK
) {

182 
SDS_TYPE_5
:

183  
	`SDS_TYPE_5_LEN
(
æags
);

184 
SDS_TYPE_8
:

185  
	`SDS_HDR
(8,
s
)->
®loc
;

186 
SDS_TYPE_16
:

187  
	`SDS_HDR
(16,
s
)->
®loc
;

188 
SDS_TYPE_32
:

189  
	`SDS_HDR
(32,
s
)->
®loc
;

190 
SDS_TYPE_64
:

191  
	`SDS_HDR
(64,
s
)->
®loc
;

194 
	}
}

196 
šlše
 
	$sds£Îoc
(
sds
 
s
, 
size_t
 
ÃwËn
) {

197 
æags
 = 
s
[-1];

198 
æags
&
SDS_TYPE_MASK
) {

199 
SDS_TYPE_5
:

202 
SDS_TYPE_8
:

203 
	`SDS_HDR
(8,
s
)->
®loc
 = 
ÃwËn
;

205 
SDS_TYPE_16
:

206 
	`SDS_HDR
(16,
s
)->
®loc
 = 
ÃwËn
;

208 
SDS_TYPE_32
:

209 
	`SDS_HDR
(32,
s
)->
®loc
 = 
ÃwËn
;

211 
SDS_TYPE_64
:

212 
	`SDS_HDR
(64,
s
)->
®loc
 = 
ÃwËn
;

215 
	}
}

217 
sds
 
sd¢ewËn
(cÚ¡ *
š™
, 
size_t
 
š™Ën
);

218 
sds
 
sd¢ew
(cÚ¡ *
š™
);

219 
sds
 
sd£m±y
();

220 
sds
 
sdsdup
(cÚ¡ sd 
s
);

221 
sdsä“
(
sds
 
s
);

222 
sds
 
sdsgrowz”o
(sd 
s
, 
size_t
 
Ën
);

223 
sds
 
sdsÿ’
(sd 
s
, cÚ¡ *
t
, 
size_t
 
Ën
);

224 
sds
 
sdsÿt
(sd 
s
, cÚ¡ *
t
);

225 
sds
 
sdsÿtsds
(sd 
s
, cÚ¡ sd 
t
);

226 
sds
 
sdsıyËn
(sd 
s
, cÚ¡ *
t
, 
size_t
 
Ën
);

227 
sds
 
sdsıy
(sd 
s
, cÚ¡ *
t
);

229 
sds
 
sdsÿtv´štf
(sd 
s
, cÚ¡ *
fmt
, 
va_li¡
 
­
);

230 #ifdeà
__GNUC__


231 
sds
 
	$sdsÿrštf
(
sds
 
s
, cÚ¡ *
fmt
, ...)

232 
	`__©Œibu‹__
((
	`fÜm©
(
´štf
, 2, 3)));

234 
sds
 
	`sdsÿrštf
(sd 
s
, cÚ¡ *
fmt
, ...);

237 
sds
 
	`sdsÿtfmt
(sd 
s
, cÚ¡ *
fmt
, ...);

238 
sds
 
	`sd¡rim
(sd 
s
, cÚ¡ *
c£t
);

239 
	`sd¤ªge
(
sds
 
s
, 
¡¬t
, 
’d
);

240 
	`sdsupd©–’
(
sds
 
s
);

241 
	`sdsş—r
(
sds
 
s
);

242 
	`sdscmp
(cÚ¡ 
sds
 
s1
, cÚ¡ sd 
s2
);

243 
sds
 *
	`sds¥l™Ën
(cÚ¡ *
s
, 
Ën
, cÚ¡ *
£p
, 
£¶’
, *
couÁ
);

244 
	`sdsä“¥l™»s
(
sds
 *
tok’s
, 
couÁ
);

245 
	`sd¡Şow”
(
sds
 
s
);

246 
	`sd¡ouµ”
(
sds
 
s
);

247 
sds
 
	`sdsäomlÚglÚg
(
v®ue
);

248 
sds
 
	`sdsÿŒ•r
(sd 
s
, cÚ¡ *
p
, 
size_t
 
Ën
);

249 
sds
 *
	`sds¥l™¬gs
(cÚ¡ *
lše
, *
¬gc
);

250 
sds
 
	`sdsm­ch¬s
(sd 
s
, cÚ¡ *
äom
, cÚ¡ *
to
, 
size_t
 
£’
);

251 
sds
 
	`sdsjoš
(**
¬gv
, 
¬gc
, *
£p
);

252 
sds
 
	`sdsjošsds
(sd *
¬gv
, 
¬gc
, cÚ¡ *
£p
, 
size_t
 
£¶’
);

255 
sds
 
	`sdsMakeRoomFÜ
(sd 
s
, 
size_t
 
addËn
);

256 
	`sdsInüL’
(
sds
 
s
, 
šü
);

257 
sds
 
	`sdsRemoveF»eS·û
(sd 
s
);

258 
size_t
 
	`sdsAÎocSize
(
sds
 
s
);

259 *
	`sdsAÎocPŒ
(
sds
 
s
);

265 *
	`sds_m®loc
(
size_t
 
size
);

266 *
	`sds_»®loc
(*
±r
, 
size_t
 
size
);

267 
	`sds_ä“
(*
±r
);

269 #ifdeà
REDIS_TEST


270 
	`sdsTe¡
(
¬gc
, *
¬gv
[]);

	@sdsalloc.h

39 
	~"zm®loc.h
"

40 
	#s_m®loc
 
zm®loc


	)

41 
	#s_»®loc
 
z»®loc


	)

42 
	#s_ä“
 
zä“


	)

	@sentinel.c

31 
	~"£rv”.h
"

32 
	~"hœedis.h
"

33 
	~"async.h
"

35 
	~<ùy³.h
>

36 
	~<¬·/š‘.h
>

37 
	~<sys/sock‘.h
>

38 
	~<sys/wa™.h
>

39 
	~<fú.h
>

41 **
’vœÚ
;

43 
	#REDIS_SENTINEL_PORT
 26379

	)

48 
	s£Áš–Addr
 {

49 *
	m
;

50 
	mpÜt
;

51 } 
	t£Áš–Addr
;

54 
	#SRI_MASTER
 (1<<0)

	)

55 
	#SRI_SLAVE
 (1<<1)

	)

56 
	#SRI_SENTINEL
 (1<<2)

	)

57 
	#SRI_S_DOWN
 (1<<3è

	)

58 
	#SRI_O_DOWN
 (1<<4è

	)

59 
	#SRI_MASTER_DOWN
 (1<<5è

	)

61 
	#SRI_FAILOVER_IN_PROGRESS
 (1<<6è

	)

63 
	#SRI_PROMOTED
 (1<<7è

	)

64 
	#SRI_RECONF_SENT
 (1<<8è

	)

65 
	#SRI_RECONF_INPROG
 (1<<9è

	)

66 
	#SRI_RECONF_DONE
 (1<<10è

	)

67 
	#SRI_FORCE_FAILOVER
 (1<<11è

	)

68 
	#SRI_SCRIPT_KILL_SENT
 (1<<12è

	)

71 
	#SENTINEL_INFO_PERIOD
 10000

	)

72 
	#SENTINEL_PING_PERIOD
 1000

	)

73 
	#SENTINEL_ASK_PERIOD
 1000

	)

74 
	#SENTINEL_PUBLISH_PERIOD
 2000

	)

75 
	#SENTINEL_DEFAULT_DOWN_AFTER
 30000

	)

76 
	#SENTINEL_HELLO_CHANNEL
 "__£Áš–__:h–lo"

	)

77 
	#SENTINEL_TILT_TRIGGER
 2000

	)

78 
	#SENTINEL_TILT_PERIOD
 (
SENTINEL_PING_PERIOD
*30)

	)

79 
	#SENTINEL_DEFAULT_SLAVE_PRIORITY
 100

	)

80 
	#SENTINEL_SLAVE_RECONF_TIMEOUT
 10000

	)

81 
	#SENTINEL_DEFAULT_PARALLEL_SYNCS
 1

	)

82 
	#SENTINEL_MIN_LINK_RECONNECT_PERIOD
 15000

	)

83 
	#SENTINEL_DEFAULT_FAILOVER_TIMEOUT
 (60*3*1000)

	)

84 
	#SENTINEL_MAX_PENDING_COMMANDS
 100

	)

85 
	#SENTINEL_ELECTION_TIMEOUT
 10000

	)

86 
	#SENTINEL_MAX_DESYNC
 1000

	)

89 
	#SENTINEL_FAILOVER_STATE_NONE
 0

	)

90 
	#SENTINEL_FAILOVER_STATE_WAIT_START
 1

	)

91 
	#SENTINEL_FAILOVER_STATE_SELECT_SLAVE
 2

	)

92 
	#SENTINEL_FAILOVER_STATE_SEND_SLAVEOF_NOONE
 3

	)

93 
	#SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
 4

	)

94 
	#SENTINEL_FAILOVER_STATE_RECONF_SLAVES
 5

	)

95 
	#SENTINEL_FAILOVER_STATE_UPDATE_CONFIG
 6

	)

97 
	#SENTINEL_MASTER_LINK_STATUS_UP
 0

	)

98 
	#SENTINEL_MASTER_LINK_STATUS_DOWN
 1

	)

103 
	#SENTINEL_NO_FLAGS
 0

	)

104 
	#SENTINEL_GENERATE_EVENT
 (1<<16)

	)

105 
	#SENTINEL_LEADER
 (1<<17)

	)

106 
	#SENTINEL_OBSERVER
 (1<<18)

	)

109 
	#SENTINEL_SCRIPT_NONE
 0

	)

110 
	#SENTINEL_SCRIPT_RUNNING
 1

	)

111 
	#SENTINEL_SCRIPT_MAX_QUEUE
 256

	)

112 
	#SENTINEL_SCRIPT_MAX_RUNNING
 16

	)

113 
	#SENTINEL_SCRIPT_MAX_RUNTIME
 60000

	)

114 
	#SENTINEL_SCRIPT_MAX_RETRY
 10

	)

115 
	#SENTINEL_SCRIPT_RETRY_DELAY
 30000

	)

118 
	#SENTINEL_SIMFAILURE_NONE
 0

	)

119 
	#SENTINEL_SIMFAILURE_CRASH_AFTER_ELECTION
 (1<<0)

	)

120 
	#SENTINEL_SIMFAILURE_CRASH_AFTER_PROMOTION
 (1<<1)

	)

136 
	sš¡ªûLšk
 {

137 
	m»fcouÁ
;

138 
	mdiscÚÃùed
;

139 
	m³ndšg_commªds
;

140 
»disAsyncCÚ‹xt
 *
	mcc
;

141 
»disAsyncCÚ‹xt
 *
	mpc
;

142 
m¡ime_t
 
	mcc_cÚn_time
;

143 
m¡ime_t
 
	mpc_cÚn_time
;

144 
m¡ime_t
 
	mpc_Ï¡_aùiv™y
;

145 
m¡ime_t
 
	mÏ¡_ava_time
;

147 
m¡ime_t
 
	maù_pšg_time
;

152 
m¡ime_t
 
	mÏ¡_pšg_time
;

156 
m¡ime_t
 
	mÏ¡_pÚg_time
;

159 
m¡ime_t
 
	mÏ¡_»cÚn_time
;

161 } 
	tš¡ªûLšk
;

163 
	s£Áš–RedisIn¡ªû
 {

164 
	mæags
;

165 *
	mÇme
;

166 *
	mrunid
;

167 
ušt64_t
 
	mcÚfig_•och
;

168 
£Áš–Addr
 *
	maddr
;

169 
š¡ªûLšk
 *
	mlšk
;

170 
m¡ime_t
 
	mÏ¡_pub_time
;

171 
m¡ime_t
 
	mÏ¡_h–lo_time
;

174 
m¡ime_t
 
	mÏ¡_ma¡”_down_»¶y_time
;

176 
m¡ime_t
 
	ms_down_sšû_time
;

177 
m¡ime_t
 
	mo_down_sšû_time
;

178 
m¡ime_t
 
	mdown_aá”_³riod
;

179 
m¡ime_t
 
	mšfo_»äesh
;

186 
	mrŞe_»pÜ‹d
;

187 
m¡ime_t
 
	mrŞe_»pÜ‹d_time
;

188 
m¡ime_t
 
	m¦ave_cÚf_chªge_time
;

191 
diù
 *
	m£Áš–s
;

192 
diù
 *
	m¦aves
;

193 
	mquÜum
;

194 
	m·¿Î–_syncs
;

195 *
	mauth_·ss
;

198 
m¡ime_t
 
	mma¡”_lšk_down_time
;

199 
	m¦ave_´iÜ™y
;

200 
m¡ime_t
 
	m¦ave_»cÚf_£Á_time
;

201 
£Áš–RedisIn¡ªû
 *
	mma¡”
;

202 *
	m¦ave_ma¡”_ho¡
;

203 
	m¦ave_ma¡”_pÜt
;

204 
	m¦ave_ma¡”_lšk_¡©us
;

205 
	m¦ave_»¶_off£t
;

207 *
	mËad”
;

211 
ušt64_t
 
	mËad”_•och
;

212 
ušt64_t
 
	mçov”_•och
;

213 
	mçov”_¡©e
;

214 
m¡ime_t
 
	mçov”_¡©e_chªge_time
;

215 
m¡ime_t
 
	mçov”_¡¬t_time
;

216 
m¡ime_t
 
	mçov”_timeout
;

217 
m¡ime_t
 
	mçov”_d–ay_logged
;

219 
£Áš–RedisIn¡ªû
 *
	m´omÙed_¦ave
;

222 *
	mnÙifiÿtiÚ_süt
;

223 *
	mş›Á_»cÚfig_süt
;

224 
sds
 
	mšfo
;

225 } 
	t£Áš–RedisIn¡ªû
;

228 
	s£Áš–S‹
 {

229 
	mmyid
[
CONFIG_RUN_ID_SIZE
+1];

230 
ušt64_t
 
	mcu¼’t_•och
;

231 
diù
 *
	mma¡”s
;

234 
	mtt
;

235 
	mruÂšg_süts
;

236 
m¡ime_t
 
	mtt_¡¬t_time
;

237 
m¡ime_t
 
	m´evious_time
;

238 
li¡
 *
	msüts_queue
;

239 *
	mªnounû_
;

241 
	mªnounû_pÜt
;

243 
	msimçu»_æags
;

244 } 
	g£Áš–
;

247 
	s£Áš–SütJob
 {

248 
	mæags
;

249 
	m»Œy_num
;

250 **
	m¬gv
;

251 
m¡ime_t
 
	m¡¬t_time
;

256 
pid_t
 
	mpid
;

257 } 
	t£Áš–SütJob
;

264 
	s»disAeEv’ts
 {

265 
»disAsyncCÚ‹xt
 *
	mcÚ‹xt
;

266 
«Ev’tLoİ
 *
	mloİ
;

267 
	mfd
;

268 
	m»adšg
, 
	mwr™šg
;

269 } 
	t»disAeEv’ts
;

271 
	$»disAeR—dEv’t
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

272 (()
–
); (()
fd
); (()
mask
);

274 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

275 
	`»disAsyncHªdËR—d
(
e
->
cÚ‹xt
);

276 
	}
}

278 
	$»disAeWr™eEv’t
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
) {

279 (()
–
); (()
fd
); (()
mask
);

281 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

282 
	`»disAsyncHªdËWr™e
(
e
->
cÚ‹xt
);

283 
	}
}

285 
	$»disAeAddR—d
(*
´ivd©a
) {

286 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

287 
«Ev’tLoİ
 *
loİ
 = 
e
->loop;

288 ià(!
e
->
»adšg
) {

289 
e
->
»adšg
 = 1;

290 
	`«C»©eFeEv’t
(
loİ
,
e
->
fd
,
AE_READABLE
,
»disAeR—dEv’t
,e);

292 
	}
}

294 
	$»disAeD–R—d
(*
´ivd©a
) {

295 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

296 
«Ev’tLoİ
 *
loİ
 = 
e
->loop;

297 ià(
e
->
»adšg
) {

298 
e
->
»adšg
 = 0;

299 
	`«D–‘eFeEv’t
(
loİ
,
e
->
fd
,
AE_READABLE
);

301 
	}
}

303 
	$»disAeAddWr™e
(*
´ivd©a
) {

304 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

305 
«Ev’tLoİ
 *
loİ
 = 
e
->loop;

306 ià(!
e
->
wr™šg
) {

307 
e
->
wr™šg
 = 1;

308 
	`«C»©eFeEv’t
(
loİ
,
e
->
fd
,
AE_WRITABLE
,
»disAeWr™eEv’t
,e);

310 
	}
}

312 
	$»disAeD–Wr™e
(*
´ivd©a
) {

313 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

314 
«Ev’tLoİ
 *
loİ
 = 
e
->loop;

315 ià(
e
->
wr™šg
) {

316 
e
->
wr™šg
 = 0;

317 
	`«D–‘eFeEv’t
(
loİ
,
e
->
fd
,
AE_WRITABLE
);

319 
	}
}

321 
	$»disAeCËªup
(*
´ivd©a
) {

322 
»disAeEv’ts
 *
e
 = (»disAeEv’ts*)
´ivd©a
;

323 
	`»disAeD–R—d
(
´ivd©a
);

324 
	`»disAeD–Wr™e
(
´ivd©a
);

325 
	`zä“
(
e
);

326 
	}
}

328 
	$»disAeA‰ach
(
«Ev’tLoİ
 *
loİ
, 
»disAsyncCÚ‹xt
 *
ac
) {

329 
»disCÚ‹xt
 *
c
 = &(
ac
->c);

330 
»disAeEv’ts
 *
e
;

333 ià(
ac
->
ev
.
d©a
 !ğ
NULL
)

334  
C_ERR
;

337 
e
 = (
»disAeEv’ts
*)
	`zm®loc
((*e));

338 
e
->
cÚ‹xt
 = 
ac
;

339 
e
->
loİ
 =†oop;

340 
e
->
fd
 = 
c
->fd;

341 
e
->
»adšg
 =ƒ->
wr™šg
 = 0;

344 
ac
->
ev
.
addR—d
 = 
»disAeAddR—d
;

345 
ac
->
ev
.
d–R—d
 = 
»disAeD–R—d
;

346 
ac
->
ev
.
addWr™e
 = 
»disAeAddWr™e
;

347 
ac
->
ev
.
d–Wr™e
 = 
»disAeD–Wr™e
;

348 
ac
->
ev
.
ş—nup
 = 
»disAeCËªup
;

349 
ac
->
ev
.
d©a
 = 
e
;

351  
C_OK
;

352 
	}
}

356 
£Áš–LškE¡ablishedC®lback
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
, 
¡©us
);

357 
£Áš–DiscÚÃùC®lback
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
, 
¡©us
);

358 
£Áš–ReûiveH–loMes§ges
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
);

359 
£Áš–RedisIn¡ªû
 *
£Áš–G‘Ma¡”ByName
(*
Çme
);

360 *
£Áš–G‘SubjeùiveL—d”
(
£Áš–RedisIn¡ªû
 *
ma¡”
);

361 *
£Áš–G‘ObjeùiveL—d”
(
£Áš–RedisIn¡ªû
 *
ma¡”
);

362 
ye¢Ùoi
(*
s
);

363 
š¡ªûLškCÚÃùiÚE¼Ü
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
);

364 cÚ¡ *
£Áš–RedisIn¡ªûTy³SŒ
(
£Áš–RedisIn¡ªû
 *
ri
);

365 
£Áš–AbÜtFaov”
(
£Áš–RedisIn¡ªû
 *
ri
);

366 
£Áš–Ev’t
(
Ëv–
, *
ty³
, 
£Áš–RedisIn¡ªû
 *
ri
, cÚ¡ *
fmt
, ...);

367 
£Áš–RedisIn¡ªû
 *
£Áš–S–eùSÏve
(£Áš–RedisIn¡ªû *
ma¡”
);

368 
£Áš–ScheduËSütExecutiÚ
(*
·th
, ...);

369 
£Áš–S¹Faov”
(
£Áš–RedisIn¡ªû
 *
ma¡”
);

370 
£Áš–DisÿrdR•lyC®lback
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
);

371 
£Áš–S’dSÏveOf
(
£Áš–RedisIn¡ªû
 *
ri
, *
ho¡
, 
pÜt
);

372 *
£Áš–VÙeL—d”
(
£Áš–RedisIn¡ªû
 *
ma¡”
, 
ušt64_t
 
»q_•och
, *
»q_runid
, ušt64_ˆ*
Ëad”_•och
);

373 
£Áš–FlushCÚfig
();

374 
£Áš–G’”©eIn™ŸlMÚ™ÜEv’ts
();

375 
£Áš–S’dPšg
(
£Áš–RedisIn¡ªû
 *
ri
);

376 
£Áš–FÜûH–loUpd©eFÜMa¡”
(
£Áš–RedisIn¡ªû
 *
ma¡”
);

377 
£Áš–RedisIn¡ªû
 *
g‘S’tš–RedisIn¡ªûByAddrAndRunID
(
diù
 *
š¡ªûs
, *

, 
pÜt
, *
runid
);

378 
£Áš–SimFau»C¿sh
();

382 
diùSdsHash
(cÚ¡ *
key
);

383 
diùSdsKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
);

384 
»Ëa£S’tš–RedisIn¡ªû
(
£Áš–RedisIn¡ªû
 *
ri
);

386 
	$diùIn¡ªûsV®De¡ruùÜ
 (*
´ivd©a
, *
obj
) {

387 
	`UNUSED
(
´ivd©a
);

388 
	`»Ëa£S’tš–RedisIn¡ªû
(
obj
);

389 
	}
}

395 
diùTy³
 
	gš¡ªûsDiùTy³
 = {

396 
diùSdsHash
,

397 
NULL
,

398 
NULL
,

399 
diùSdsKeyCom·»
,

400 
NULL
,

401 
diùIn¡ªûsV®De¡ruùÜ


408 
diùTy³
 
	gËad”VÙesDiùTy³
 = {

409 
diùSdsHash
,

410 
NULL
,

411 
NULL
,

412 
diùSdsKeyCom·»
,

413 
NULL
,

414 
NULL


419 
£Áš–Commªd
(
ş›Á
 *
c
);

420 
£Áš–InfoCommªd
(
ş›Á
 *
c
);

421 
£Áš–S‘Commªd
(
ş›Á
 *
c
);

422 
£Áš–PublishCommªd
(
ş›Á
 *
c
);

423 
£Áš–RŞeCommªd
(
ş›Á
 *
c
);

425 
»disCommªd
 
	g£Áš–cmds
[] = {

426 {"pšg",
pšgCommªd
,1,"",0,
NULL
,0,0,0,0,0},

427 {"£Áš–",
£Áš–Commªd
,-2,"",0,
NULL
,0,0,0,0,0},

428 {"subsüibe",
subsüibeCommªd
,-2,"",0,
NULL
,0,0,0,0,0},

429 {"unsubsüibe",
unsubsüibeCommªd
,-1,"",0,
NULL
,0,0,0,0,0},

430 {"psubsüibe",
psubsüibeCommªd
,-2,"",0,
NULL
,0,0,0,0,0},

431 {"punsubsüibe",
punsubsüibeCommªd
,-1,"",0,
NULL
,0,0,0,0,0},

432 {"publish",
£Áš–PublishCommªd
,3,"",0,
NULL
,0,0,0,0,0},

433 {"šfo",
£Áš–InfoCommªd
,-1,"",0,
NULL
,0,0,0,0,0},

434 {"rŞe",
£Áš–RŞeCommªd
,1,"l",0,
NULL
,0,0,0,0,0},

435 {"ş›Á",
ş›ÁCommªd
,-2,"rs",0,
NULL
,0,0,0,0,0},

436 {"shutdown",
shutdownCommªd
,-1,"",0,
NULL
,0,0,0,0,0}

441 
	$š™S’tš–CÚfig
() {

442 
£rv”
.
pÜt
 = 
REDIS_SENTINEL_PORT
;

443 
	}
}

446 
	$š™S’tš–
() {

447 
j
;

451 
	`diùEm±y
(
£rv”
.
commªds
,
NULL
);

452 
j
 = 0; j < (
£Áš–cmds
)/(sentinelcmds[0]); j++) {

453 
»tv®
;

454 
»disCommªd
 *
cmd
 = 
£Áš–cmds
+
j
;

456 
»tv®
 = 
	`diùAdd
(
£rv”
.
commªds
, 
	`sd¢ew
(
cmd
->
Çme
), cmd);

457 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

461 
£Áš–
.
cu¼’t_•och
 = 0;

462 
£Áš–
.
ma¡”s
 = 
	`diùC»©e
(&
š¡ªûsDiùTy³
,
NULL
);

463 
£Áš–
.
tt
 = 0;

464 
£Áš–
.
tt_¡¬t_time
 = 0;

465 
£Áš–
.
´evious_time
 = 
	`m¡ime
();

466 
£Áš–
.
ruÂšg_süts
 = 0;

467 
£Áš–
.
süts_queue
 = 
	`li¡C»©e
();

468 
£Áš–
.
ªnounû_
 = 
NULL
;

469 
£Áš–
.
ªnounû_pÜt
 = 0;

470 
£Áš–
.
simçu»_æags
 = 
SENTINEL_SIMFAILURE_NONE
;

471 
	`mem£t
(
£Áš–
.
myid
,0,(sentinel.myid));

472 
	}
}

476 
	$£Áš–IsRuÂšg
() {

477 
j
;

479 ià(
£rv”
.
cÚfigfe
 =ğ
NULL
) {

480 
	`£rv”Log
(
LL_WARNING
,

482 
	`ex™
(1);

483 } ià(
	`acûss
(
£rv”
.
cÚfigfe
,
W_OK
) == -1) {

484 
	`£rv”Log
(
LL_WARNING
,

486 
£rv”
.
cÚfigfe
,
	`¡»¼Ü
(
”ºo
));

487 
	`ex™
(1);

493 
j
 = 0; j < 
CONFIG_RUN_ID_SIZE
; j++)

494 ià(
£Áš–
.
myid
[
j
] != 0) ;

496 ià(
j
 =ğ
CONFIG_RUN_ID_SIZE
) {

498 
	`g‘RªdomHexCh¬s
(
£Áš–
.
myid
,
CONFIG_RUN_ID_SIZE
);

499 
	`£Áš–FlushCÚfig
();

503 
	`£rv”Log
(
LL_WARNING
,"S’tš– ID i %s", 
£Áš–
.
myid
);

507 
	`£Áš–G’”©eIn™ŸlMÚ™ÜEv’ts
();

508 
	}
}

517 
£Áš–Addr
 *
	$ü—‹S’tš–Addr
(*
ho¡Çme
, 
pÜt
) {

518 

[
NET_IP_STR_LEN
];

519 
£Áš–Addr
 *
§
;

521 ià(
pÜt
 < 0 ||…ort > 65535) {

522 
”ºo
 = 
EINVAL
;

523  
NULL
;

525 ià(
	`ª‘ResŞve
(
NULL
,
ho¡Çme
,

,()è=ğ
ANET_ERR
) {

526 
”ºo
 = 
ENOENT
;

527  
NULL
;

529 
§
 = 
	`zm®loc
((*sa));

530 
§
->

 = 
	`sd¢ew
(ip);

531 
§
->
pÜt
 =…ort;

532  
§
;

533 
	}
}

536 
£Áš–Addr
 *
	$dupS’tš–Addr
(
£Áš–Addr
 *
¤c
) {

537 
£Áš–Addr
 *
§
;

539 
§
 = 
	`zm®loc
((*sa));

540 
§
->

 = 
	`sd¢ew
(
¤c
->ip);

541 
§
->
pÜt
 = 
¤c
->port;

542  
§
;

543 
	}
}

546 
	$»Ëa£S’tš–Addr
(
£Áš–Addr
 *
§
) {

547 
	`sdsä“
(
§
->

);

548 
	`zä“
(
§
);

549 
	}
}

552 
	$£Áš–AddrIsEqu®
(
£Áš–Addr
 *
a
, s’tš–Add¸*
b
) {

553  
a
->
pÜt
 =ğ
b
->pÜˆ&& !
	`¡rÿ£cmp
×->

,b->ip);

554 
	}
}

582 
	$£Áš–Ev’t
(
Ëv–
, *
ty³
, 
£Áš–RedisIn¡ªû
 *
ri
,

583 cÚ¡ *
fmt
, ...) {

584 
va_li¡
 
­
;

585 
msg
[
LOG_MAX_LEN
];

586 
robj
 *
chªÃl
, *
·ylßd
;

589 ià(
fmt
[0] == '%' && fmt[1] == '@') {

590 
£Áš–RedisIn¡ªû
 *
ma¡”
 = (
ri
->
æags
 & 
SRI_MASTER
) ?

591 
NULL
 : 
ri
->
ma¡”
;

593 ià(
ma¡”
) {

594 
	`¢´štf
(
msg
, (msg), "%s %s %s %d @ %s %s %d",

595 
	`£Áš–RedisIn¡ªûTy³SŒ
(
ri
),

596 
ri
->
Çme
,„i->
addr
->

,„i->addr->
pÜt
,

597 
ma¡”
->
Çme
, ma¡”->
addr
->

, ma¡”->addr->
pÜt
);

599 
	`¢´štf
(
msg
, (msg), "%s %s %s %d",

600 
	`£Áš–RedisIn¡ªûTy³SŒ
(
ri
),

601 
ri
->
Çme
,„i->
addr
->

,„i->addr->
pÜt
);

603 
fmt
 += 2;

605 
msg
[0] = '\0';

609 ià(
fmt
[0] != '\0') {

610 
	`va_¡¬t
(
­
, 
fmt
);

611 
	`v¢´štf
(
msg
+
	`¡¾’
(msg), (msg)-¡¾’(msg), 
fmt
, 
­
);

612 
	`va_’d
(
­
);

616 ià(
Ëv–
 >ğ
£rv”
.
v”bos™y
)

617 
	`£rv”Log
(
Ëv–
,"% %s",
ty³
,
msg
);

620 ià(
Ëv–
 !ğ
LL_DEBUG
) {

621 
chªÃl
 = 
	`ü—‹SŒšgObjeù
(
ty³
,
	`¡¾’
(type));

622 
·ylßd
 = 
	`ü—‹SŒšgObjeù
(
msg
,
	`¡¾’
(msg));

623 
	`pubsubPublishMes§ge
(
chªÃl
,
·ylßd
);

624 
	`deüRefCouÁ
(
chªÃl
);

625 
	`deüRefCouÁ
(
·ylßd
);

629 ià(
Ëv–
 =ğ
LL_WARNING
 && 
ri
 !ğ
NULL
) {

630 
£Áš–RedisIn¡ªû
 *
ma¡”
 = (
ri
->
æags
 & 
SRI_MASTER
) ?

631 
ri
 :„i->
ma¡”
;

632 ià(
ma¡”
 && ma¡”->
nÙifiÿtiÚ_süt
) {

633 
	`£Áš–ScheduËSütExecutiÚ
(
ma¡”
->
nÙifiÿtiÚ_süt
,

634 
ty³
,
msg
,
NULL
);

637 
	}
}

643 
	$£Áš–G’”©eIn™ŸlMÚ™ÜEv’ts
() {

644 
diùI‹¿tÜ
 *
di
;

645 
diùEÁry
 *
de
;

647 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

648 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

649 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

650 
	`£Áš–Ev’t
(
LL_WARNING
,"+mÚ™Ü",
ri
,"%@ quÜum %d",ri->
quÜum
);

652 
	`diùR–—£I‹¿tÜ
(
di
);

653 
	}
}

658 
	$£Áš–R–—£SütJob
(
£Áš–SütJob
 *
sj
) {

659 
j
 = 0;

661 
sj
->
¬gv
[
j
]è
	`sdsä“
(sj->argv[j++]);

662 
	`zä“
(
sj
->
¬gv
);

663 
	`zä“
(
sj
);

664 
	}
}

666 
	#SENTINEL_SCRIPT_MAX_ARGS
 16

	)

667 
	$£Áš–ScheduËSütExecutiÚ
(*
·th
, ...) {

668 
va_li¡
 
­
;

669 *
¬gv
[
SENTINEL_SCRIPT_MAX_ARGS
+1];

670 
¬gc
 = 1;

671 
£Áš–SütJob
 *
sj
;

673 
	`va_¡¬t
(
­
, 
·th
);

674 
¬gc
 < 
SENTINEL_SCRIPT_MAX_ARGS
) {

675 
¬gv
[
¬gc
] = 
	`va_¬g
(
­
,*);

676 ià(!
¬gv
[
¬gc
]) ;

677 
¬gv
[
¬gc
] = 
	`sd¢ew
(argv[argc]);

678 
¬gc
++;

680 
	`va_’d
(
­
);

681 
¬gv
[0] = 
	`sd¢ew
(
·th
);

683 
sj
 = 
	`zm®loc
((*sj));

684 
sj
->
æags
 = 
SENTINEL_SCRIPT_NONE
;

685 
sj
->
»Œy_num
 = 0;

686 
sj
->
¬gv
 = 
	`zm®loc
((*)*(
¬gc
+1));

687 
sj
->
¡¬t_time
 = 0;

688 
sj
->
pid
 = 0;

689 
	`memıy
(
sj
->
¬gv
,¬gv,(*)*(
¬gc
+1));

691 
	`li¡AddNodeTa
(
£Áš–
.
süts_queue
,
sj
);

694 ià(
	`li¡L’gth
(
£Áš–
.
süts_queue
è> 
SENTINEL_SCRIPT_MAX_QUEUE
) {

695 
li¡Node
 *
Ê
;

696 
li¡I‹r
 
li
;

698 
	`li¡Rewšd
(
£Áš–
.
süts_queue
,&
li
);

699 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

700 
sj
 = 
Ê
->
v®ue
;

702 ià(
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
) ;

704 
	`li¡D–Node
(
£Áš–
.
süts_queue
,
Ê
);

705 
	`£Áš–R–—£SütJob
(
sj
);

708 
	`£rv”As£¹
(
	`li¡L’gth
(
£Áš–
.
süts_queue
) <=

709 
SENTINEL_SCRIPT_MAX_QUEUE
);

711 
	}
}

715 
li¡Node
 *
	$£Áš–G‘SütLi¡NodeByPid
(
pid_t
 
pid
) {

716 
li¡Node
 *
Ê
;

717 
li¡I‹r
 
li
;

719 
	`li¡Rewšd
(
£Áš–
.
süts_queue
,&
li
);

720 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

721 
£Áš–SütJob
 *
sj
 = 
Ê
->
v®ue
;

723 ià((
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
è&& sj->
pid
 ==…id)

724  
Ê
;

726  
NULL
;

727 
	}
}

731 
	$£Áš–RunP’dšgSüts
() {

732 
li¡Node
 *
Ê
;

733 
li¡I‹r
 
li
;

734 
m¡ime_t
 
now
 = 
	`m¡ime
();

738 
	`li¡Rewšd
(
£Áš–
.
süts_queue
,&
li
);

739 
£Áš–
.
ruÂšg_süts
 < 
SENTINEL_SCRIPT_MAX_RUNNING
 &&

740 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
)

742 
£Áš–SütJob
 *
sj
 = 
Ê
->
v®ue
;

743 
pid_t
 
pid
;

746 ià(
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
) ;

749 ià(
sj
->
¡¬t_time
 && sj->¡¬t_tim> 
now
) ;

751 
sj
->
æags
 |ğ
SENTINEL_SCRIPT_RUNNING
;

752 
sj
->
¡¬t_time
 = 
	`m¡ime
();

753 
sj
->
»Œy_num
++;

754 
pid
 = 
	`fÜk
();

756 ià(
pid
 == -1) {

760 
	`£Áš–Ev’t
(
LL_WARNING
,"-süt-”rÜ",
NULL
,

761 "% %d %d", 
sj
->
¬gv
[0], 99, 0);

762 
sj
->
æags
 &ğ~
SENTINEL_SCRIPT_RUNNING
;

763 
sj
->
pid
 = 0;

764 } ià(
pid
 == 0) {

766 
	`execve
(
sj
->
¬gv
[0],sj->¬gv,
’vœÚ
);

768 
	`_ex™
(2);

770 
£Áš–
.
ruÂšg_süts
++;

771 
sj
->
pid
 =…id;

772 
	`£Áš–Ev’t
(
LL_DEBUG
,"+süt-chd",
NULL
,"%ld",()
pid
);

775 
	}
}

784 
m¡ime_t
 
	$£Áš–SütR‘ryD–ay
(
»Œy_num
) {

785 
m¡ime_t
 
d–ay
 = 
SENTINEL_SCRIPT_RETRY_DELAY
;

787 
»Œy_num
-- > 1è
d–ay
 *= 2;

788  
d–ay
;

789 
	}
}

795 
	$£Áš–CŞËùT”mš©edSüts
() {

796 
¡©loc
;

797 
pid_t
 
pid
;

799 (
pid
 = 
	`wa™3
(&
¡©loc
,
WNOHANG
,
NULL
)) > 0) {

800 
ex™code
 = 
	`WEXITSTATUS
(
¡©loc
);

801 
bysigÇl
 = 0;

802 
li¡Node
 *
Ê
;

803 
£Áš–SütJob
 *
sj
;

805 ià(
	`WIFSIGNALED
(
¡©loc
)è
bysigÇl
 = 
	`WTERMSIG
(statloc);

806 
	`£Áš–Ev’t
(
LL_DEBUG
,"-süt-chd",
NULL
,"%ld %d %d",

807 ()
pid
, 
ex™code
, 
bysigÇl
);

809 
Ê
 = 
	`£Áš–G‘SütLi¡NodeByPid
(
pid
);

810 ià(
Ê
 =ğ
NULL
) {

811 
	`£rv”Log
(
LL_WARNING
,"wa™3(è»tuºed‡…id (%ldèwÿn'ˆfšd iÀou¸süt executiÚ queue!", ()
pid
);

814 
sj
 = 
Ê
->
v®ue
;

819 ià((
bysigÇl
 || 
ex™code
 == 1) &&

820 
sj
->
»Œy_num
 !ğ
SENTINEL_SCRIPT_MAX_RETRY
)

822 
sj
->
æags
 &ğ~
SENTINEL_SCRIPT_RUNNING
;

823 
sj
->
pid
 = 0;

824 
sj
->
¡¬t_time
 = 
	`m¡ime
() +

825 
	`£Áš–SütR‘ryD–ay
(
sj
->
»Œy_num
);

829 ià(
bysigÇl
 || 
ex™code
 != 0) {

830 
	`£Áš–Ev’t
(
LL_WARNING
,"-süt-”rÜ",
NULL
,

831 "% %d %d", 
sj
->
¬gv
[0], 
bysigÇl
, 
ex™code
);

833 
	`li¡D–Node
(
£Áš–
.
süts_queue
,
Ê
);

834 
	`£Áš–R–—£SütJob
(
sj
);

835 
£Áš–
.
ruÂšg_süts
--;

838 
	}
}

842 
	$£Áš–KlTimedoutSüts
() {

843 
li¡Node
 *
Ê
;

844 
li¡I‹r
 
li
;

845 
m¡ime_t
 
now
 = 
	`m¡ime
();

847 
	`li¡Rewšd
(
£Áš–
.
süts_queue
,&
li
);

848 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

849 
£Áš–SütJob
 *
sj
 = 
Ê
->
v®ue
;

851 ià(
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
 &&

852 (
now
 - 
sj
->
¡¬t_time
è> 
SENTINEL_SCRIPT_MAX_RUNTIME
)

854 
	`£Áš–Ev’t
(
LL_WARNING
,"-süt-timeout",
NULL
,"%s %ld",

855 
sj
->
¬gv
[0], ()sj->
pid
);

856 
	`kl
(
sj
->
pid
,
SIGKILL
);

859 
	}
}

862 
	$£Áš–P’dšgSütsCommªd
(
ş›Á
 *
c
) {

863 
li¡Node
 *
Ê
;

864 
li¡I‹r
 
li
;

866 
	`addR•lyMuÉiBulkL’
(
c
,
	`li¡L’gth
(
£Áš–
.
süts_queue
));

867 
	`li¡Rewšd
(
£Áš–
.
süts_queue
,&
li
);

868 (
Ê
 = 
	`li¡Next
(&
li
)è!ğ
NULL
) {

869 
£Áš–SütJob
 *
sj
 = 
Ê
->
v®ue
;

870 
j
 = 0;

872 
	`addR•lyMuÉiBulkL’
(
c
,10);

874 
	`addR•lyBulkCSŒšg
(
c
,"argv");

875 
sj
->
¬gv
[
j
]) j++;

876 
	`addR•lyMuÉiBulkL’
(
c
,
j
);

877 
j
 = 0;

878 
sj
->
¬gv
[
j
]è
	`addR•lyBulkCSŒšg
(
c
,sj->argv[j++]);

880 
	`addR•lyBulkCSŒšg
(
c
,"flags");

881 
	`addR•lyBulkCSŒšg
(
c
,

882 (
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
) ? "running" : "scheduled");

884 
	`addR•lyBulkCSŒšg
(
c
,"pid");

885 
	`addR•lyBulkLÚgLÚg
(
c
,
sj
->
pid
);

887 ià(
sj
->
æags
 & 
SENTINEL_SCRIPT_RUNNING
) {

888 
	`addR•lyBulkCSŒšg
(
c
,"run-time");

889 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
sj
->
¡¬t_time
);

891 
m¡ime_t
 
d–ay
 = 
sj
->
¡¬t_time
 ? (sj->¡¬t_time-
	`m¡ime
()) : 0;

892 ià(
d–ay
 < 0) delay = 0;

893 
	`addR•lyBulkCSŒšg
(
c
,"run-delay");

894 
	`addR•lyBulkLÚgLÚg
(
c
,
d–ay
);

897 
	`addR•lyBulkCSŒšg
(
c
,"retry-num");

898 
	`addR•lyBulkLÚgLÚg
(
c
,
sj
->
»Œy_num
);

900 
	}
}

914 
	$£Áš–C®lCl›ÁRecÚfSüt
(
£Áš–RedisIn¡ªû
 *
ma¡”
, 
rŞe
, *
¡©e
, 
£Áš–Addr
 *
äom
, s’tš–Add¸*
to
) {

915 
äompÜt
[32], 
tİÜt
[32];

917 ià(
ma¡”
->
ş›Á_»cÚfig_süt
 =ğ
NULL
) ;

918 
	`Î2¡ršg
(
äompÜt
,(äompÜt),
äom
->
pÜt
);

919 
	`Î2¡ršg
(
tİÜt
,ÑİÜt),
to
->
pÜt
);

920 
	`£Áš–ScheduËSütExecutiÚ
(
ma¡”
->
ş›Á_»cÚfig_süt
,

921 
ma¡”
->
Çme
,

922 (
rŞe
 =ğ
SENTINEL_LEADER
) ? "leader" : "observer",

923 
¡©e
, 
äom
->

, 
äompÜt
, 
to
->, 
tİÜt
, 
NULL
);

924 
	}
}

929 
š¡ªûLšk
 *
	$ü—‹In¡ªûLšk
() {

930 
š¡ªûLšk
 *
lšk
 = 
	`zm®loc
((*link));

932 
lšk
->
»fcouÁ
 = 1;

933 
lšk
->
discÚÃùed
 = 1;

934 
lšk
->
³ndšg_commªds
 = 0;

935 
lšk
->
cc
 = 
NULL
;

936 
lšk
->
pc
 = 
NULL
;

937 
lšk
->
cc_cÚn_time
 = 0;

938 
lšk
->
pc_cÚn_time
 = 0;

939 
lšk
->
Ï¡_»cÚn_time
 = 0;

940 
lšk
->
pc_Ï¡_aùiv™y
 = 0;

945 
lšk
->
aù_pšg_time
 = 
	`m¡ime
();

946 
lšk
->
Ï¡_pšg_time
 = 0;

947 
lšk
->
Ï¡_ava_time
 = 
	`m¡ime
();

948 
lšk
->
Ï¡_pÚg_time
 = 
	`m¡ime
();

949  
lšk
;

950 
	}
}

953 
	$š¡ªûLškClo£CÚÃùiÚ
(
š¡ªûLšk
 *
lšk
, 
»disAsyncCÚ‹xt
 *
c
) {

954 ià(
c
 =ğ
NULL
) ;

956 ià(
lšk
->
cc
 =ğ
c
) {

957 
lšk
->
cc
 = 
NULL
;

958 
lšk
->
³ndšg_commªds
 = 0;

960 ià(
lšk
->
pc
 =ğ
c
èlšk->pøğ
NULL
;

961 
c
->
d©a
 = 
NULL
;

962 
lšk
->
discÚÃùed
 = 1;

963 
	`»disAsyncF»e
(
c
);

964 
	}
}

974 
š¡ªûLšk
 *
	$»Ëa£In¡ªûLšk
(
š¡ªûLšk
 *
lšk
, 
£Áš–RedisIn¡ªû
 *
ri
)

976 
	`£rv”As£¹
(
lšk
->
»fcouÁ
 > 0);

977 
lšk
->
»fcouÁ
--;

978 ià(
lšk
->
»fcouÁ
 != 0) {

979 ià(
ri
 &&„i->
lšk
->
cc
) {

985 
»disC®lback
 *
cb
;

986 
»disC®lbackLi¡
 *
ÿÎbacks
 = &
lšk
->
cc
->
»¶›s
;

988 
cb
 = 
ÿÎbacks
->
h—d
;

989 
cb
) {

990 ià(
cb
->
´ivd©a
 =ğ
ri
) {

991 
cb
->
â
 = 
£Áš–DisÿrdR•lyC®lback
;

992 
cb
->
´ivd©a
 = 
NULL
;

994 
cb
 = cb->
Ãxt
;

997  
lšk
;

1000 
	`š¡ªûLškClo£CÚÃùiÚ
(
lšk
,lšk->
cc
);

1001 
	`š¡ªûLškClo£CÚÃùiÚ
(
lšk
,lšk->
pc
);

1002 
	`zä“
(
lšk
);

1003  
NULL
;

1004 
	}
}

1018 
	$£Áš–TryCÚÃùiÚSh¬šg
(
£Áš–RedisIn¡ªû
 *
ri
) {

1019 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_SENTINEL
);

1020 
diùI‹¿tÜ
 *
di
;

1021 
diùEÁry
 *
de
;

1023 ià(
ri
->
runid
 =ğ
NULL
è 
C_ERR
;

1024 ià(
ri
->
lšk
->
»fcouÁ
 > 1è 
C_ERR
;

1026 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

1027 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1028 
£Áš–RedisIn¡ªû
 *
ma¡”
 = 
	`diùG‘V®
(
de
), *
m©ch
;

1031 ià(
ma¡”
 =ğ
ri
->master) ;

1032 
m©ch
 = 
	`g‘S’tš–RedisIn¡ªûByAddrAndRunID
(
ma¡”
->
£Áš–s
,

1033 
NULL
,0,
ri
->
runid
);

1034 ià(
m©ch
 =ğ
NULL
) ;

1035 ià(
m©ch
 =ğ
ri
) ;

1039 
	`»Ëa£In¡ªûLšk
(
ri
->
lšk
,
NULL
);

1040 
ri
->
lšk
 = 
m©ch
->link;

1041 
m©ch
->
lšk
->
»fcouÁ
++;

1042  
C_OK
;

1044 
	`diùR–—£I‹¿tÜ
(
di
);

1045  
C_ERR
;

1046 
	}
}

1054 
	$£Áš–Upd©eS’tš–Add»ssInAÎMa¡”s
(
£Áš–RedisIn¡ªû
 *
ri
) {

1055 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_SENTINEL
);

1056 
diùI‹¿tÜ
 *
di
;

1057 
diùEÁry
 *
de
;

1058 
»cÚfigu»d
 = 0;

1060 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

1061 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1062 
£Áš–RedisIn¡ªû
 *
ma¡”
 = 
	`diùG‘V®
(
de
), *
m©ch
;

1063 
m©ch
 = 
	`g‘S’tš–RedisIn¡ªûByAddrAndRunID
(
ma¡”
->
£Áš–s
,

1064 
NULL
,0,
ri
->
runid
);

1067 ià(
m©ch
 =ğ
NULL
) ;

1070 ià(
m©ch
->
lšk
->
cc
 !ğ
NULL
)

1071 
	`š¡ªûLškClo£CÚÃùiÚ
(
m©ch
->
lšk
,m©ch->lšk->
cc
);

1072 ià(
m©ch
->
lšk
->
pc
 !ğ
NULL
)

1073 
	`š¡ªûLškClo£CÚÃùiÚ
(
m©ch
->
lšk
,m©ch->lšk->
pc
);

1075 ià(
m©ch
 =ğ
ri
) ;

1079 
	`»Ëa£S’tš–Addr
(
m©ch
->
addr
);

1080 
m©ch
->
addr
 = 
	`dupS’tš–Addr
(
ri
->addr);

1081 
»cÚfigu»d
++;

1083 
	`diùR–—£I‹¿tÜ
(
di
);

1084 ià(
»cÚfigu»d
)

1085 
	`£Áš–Ev’t
(
LL_NOTICE
,"+£Áš–-add»ss-upd©e", 
ri
,

1086 "%@ %d‡dd™iÚ® m©chšg in¡ªûs", 
»cÚfigu»d
);

1087  
»cÚfigu»d
;

1088 
	}
}

1096 
	$š¡ªûLškCÚÃùiÚE¼Ü
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
) {

1097 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

1098 
pubsub
;

1100 ià(!
lšk
) ;

1102 
pubsub
 = (
lšk
->
pc
 =ğ
c
);

1103 ià(
pubsub
)

1104 
lšk
->
pc
 = 
NULL
;

1106 
lšk
->
cc
 = 
NULL
;

1107 
lšk
->
discÚÃùed
 = 1;

1108 
	}
}

1112 
	$£Áš–LškE¡ablishedC®lback
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
, 
¡©us
) {

1113 ià(
¡©us
 !ğ
C_OK
è
	`š¡ªûLškCÚÃùiÚE¼Ü
(
c
);

1114 
	}
}

1116 
	$£Áš–DiscÚÃùC®lback
(cÚ¡ 
»disAsyncCÚ‹xt
 *
c
, 
¡©us
) {

1117 
	`UNUSED
(
¡©us
);

1118 
	`š¡ªûLškCÚÃùiÚE¼Ü
(
c
);

1119 
	}
}

1145 
£Áš–RedisIn¡ªû
 *
	$ü—‹S’tš–RedisIn¡ªû
(*
Çme
, 
æags
, *
ho¡Çme
, 
pÜt
, 
quÜum
, 
£Áš–RedisIn¡ªû
 *
ma¡”
) {

1146 
£Áš–RedisIn¡ªû
 *
ri
;

1147 
£Áš–Addr
 *
addr
;

1148 
diù
 *
bË
 = 
NULL
;

1149 
¦av’ame
[
NET_PEER_ID_LEN
], *
sd¢ame
;

1151 
	`£rv”As£¹
(
æags
 & (
SRI_MASTER
|
SRI_SLAVE
|
SRI_SENTINEL
));

1152 
	`£rv”As£¹
((
æags
 & 
SRI_MASTER
è|| 
ma¡”
 !ğ
NULL
);

1155 
addr
 = 
	`ü—‹S’tš–Addr
(
ho¡Çme
,
pÜt
);

1156 ià(
addr
 =ğ
NULL
)  NULL;

1159 ià(
æags
 & 
SRI_SLAVE
) {

1160 
	`ª‘FÜm©Addr
(
¦av’ame
, (¦av’ame), 
ho¡Çme
, 
pÜt
);

1161 
Çme
 = 
¦av’ame
;

1168 ià(
æags
 & 
SRI_MASTER
è
bË
 = 
£Áš–
.
ma¡”s
;

1169 ià(
æags
 & 
SRI_SLAVE
è
bË
 = 
ma¡”
->
¦aves
;

1170 ià(
æags
 & 
SRI_SENTINEL
è
bË
 = 
ma¡”
->
£Áš–s
;

1171 
sd¢ame
 = 
	`sd¢ew
(
Çme
);

1172 ià(
	`diùFšd
(
bË
,
sd¢ame
)) {

1173 
	`»Ëa£S’tš–Addr
(
addr
);

1174 
	`sdsä“
(
sd¢ame
);

1175 
”ºo
 = 
EBUSY
;

1176  
NULL
;

1180 
ri
 = 
	`zm®loc
((*ri));

1183 
ri
->
æags
 = flags;

1184 
ri
->
Çme
 = 
sd¢ame
;

1185 
ri
->
runid
 = 
NULL
;

1186 
ri
->
cÚfig_•och
 = 0;

1187 
ri
->
addr
 =‡ddr;

1188 
ri
->
lšk
 = 
	`ü—‹In¡ªûLšk
();

1189 
ri
->
Ï¡_pub_time
 = 
	`m¡ime
();

1190 
ri
->
Ï¡_h–lo_time
 = 
	`m¡ime
();

1191 
ri
->
Ï¡_ma¡”_down_»¶y_time
 = 
	`m¡ime
();

1192 
ri
->
s_down_sšû_time
 = 0;

1193 
ri
->
o_down_sšû_time
 = 0;

1194 
ri
->
down_aá”_³riod
 = 
ma¡”
 ? master->down_after_period :

1195 
SENTINEL_DEFAULT_DOWN_AFTER
;

1196 
ri
->
ma¡”_lšk_down_time
 = 0;

1197 
ri
->
auth_·ss
 = 
NULL
;

1198 
ri
->
¦ave_´iÜ™y
 = 
SENTINEL_DEFAULT_SLAVE_PRIORITY
;

1199 
ri
->
¦ave_»cÚf_£Á_time
 = 0;

1200 
ri
->
¦ave_ma¡”_ho¡
 = 
NULL
;

1201 
ri
->
¦ave_ma¡”_pÜt
 = 0;

1202 
ri
->
¦ave_ma¡”_lšk_¡©us
 = 
SENTINEL_MASTER_LINK_STATUS_DOWN
;

1203 
ri
->
¦ave_»¶_off£t
 = 0;

1204 
ri
->
£Áš–s
 = 
	`diùC»©e
(&
š¡ªûsDiùTy³
,
NULL
);

1205 
ri
->
quÜum
 = quorum;

1206 
ri
->
·¿Î–_syncs
 = 
SENTINEL_DEFAULT_PARALLEL_SYNCS
;

1207 
ri
->
ma¡”
 = master;

1208 
ri
->
¦aves
 = 
	`diùC»©e
(&
š¡ªûsDiùTy³
,
NULL
);

1209 
ri
->
šfo_»äesh
 = 0;

1212 
ri
->
Ëad”
 = 
NULL
;

1213 
ri
->
Ëad”_•och
 = 0;

1214 
ri
->
çov”_•och
 = 0;

1215 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_NONE
;

1216 
ri
->
çov”_¡©e_chªge_time
 = 0;

1217 
ri
->
çov”_¡¬t_time
 = 0;

1218 
ri
->
çov”_timeout
 = 
SENTINEL_DEFAULT_FAILOVER_TIMEOUT
;

1219 
ri
->
çov”_d–ay_logged
 = 0;

1220 
ri
->
´omÙed_¦ave
 = 
NULL
;

1221 
ri
->
nÙifiÿtiÚ_süt
 = 
NULL
;

1222 
ri
->
ş›Á_»cÚfig_süt
 = 
NULL
;

1223 
ri
->
šfo
 = 
NULL
;

1226 
ri
->
rŞe_»pÜ‹d
 =„i->
æags
 & (
SRI_MASTER
|
SRI_SLAVE
);

1227 
ri
->
rŞe_»pÜ‹d_time
 = 
	`m¡ime
();

1228 
ri
->
¦ave_cÚf_chªge_time
 = 
	`m¡ime
();

1231 
	`diùAdd
(
bË
, 
ri
->
Çme
,„i);

1232  
ri
;

1233 
	}
}

1239 
	$»Ëa£S’tš–RedisIn¡ªû
(
£Áš–RedisIn¡ªû
 *
ri
) {

1241 
	`diùR–—£
(
ri
->
£Áš–s
);

1242 
	`diùR–—£
(
ri
->
¦aves
);

1245 
	`»Ëa£In¡ªûLšk
(
ri
->
lšk
,ri);

1248 
	`sdsä“
(
ri
->
Çme
);

1249 
	`sdsä“
(
ri
->
runid
);

1250 
	`sdsä“
(
ri
->
nÙifiÿtiÚ_süt
);

1251 
	`sdsä“
(
ri
->
ş›Á_»cÚfig_süt
);

1252 
	`sdsä“
(
ri
->
¦ave_ma¡”_ho¡
);

1253 
	`sdsä“
(
ri
->
Ëad”
);

1254 
	`sdsä“
(
ri
->
auth_·ss
);

1255 
	`sdsä“
(
ri
->
šfo
);

1256 
	`»Ëa£S’tš–Addr
(
ri
->
addr
);

1259 ià((
ri
->
æags
 & 
SRI_SLAVE
è&& (ri->æag & 
SRI_PROMOTED
è&&„i->
ma¡”
)

1260 
ri
->
ma¡”
->
´omÙed_¦ave
 = 
NULL
;

1262 
	`zä“
(
ri
);

1263 
	}
}

1266 
£Áš–RedisIn¡ªû
 *
	$£Áš–RedisIn¡ªûLookupSÏve
(

1267 
£Áš–RedisIn¡ªû
 *
ri
, *

, 
pÜt
)

1269 
sds
 
key
;

1270 
£Áš–RedisIn¡ªû
 *
¦ave
;

1271 
buf
[
NET_PEER_ID_LEN
];

1273 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_MASTER
);

1274 
	`ª‘FÜm©Addr
(
buf
,(buf),

,
pÜt
);

1275 
key
 = 
	`sd¢ew
(
buf
);

1276 
¦ave
 = 
	`diùF‘chV®ue
(
ri
->
¦aves
,
key
);

1277 
	`sdsä“
(
key
);

1278  
¦ave
;

1279 
	}
}

1282 cÚ¡ *
	$£Áš–RedisIn¡ªûTy³SŒ
(
£Áš–RedisIn¡ªû
 *
ri
) {

1283 ià(
ri
->
æags
 & 
SRI_MASTER
)  "master";

1284 ià(
ri
->
æags
 & 
SRI_SLAVE
)  "slave";

1285 ià(
ri
->
æags
 & 
SRI_SENTINEL
)  "sentinel";

1287 
	}
}

1300 
	$»moveM©chšgS’tš–FromMa¡”
(
£Áš–RedisIn¡ªû
 *
ma¡”
, *
runid
) {

1301 
diùI‹¿tÜ
 *
di
;

1302 
diùEÁry
 *
de
;

1303 
»moved
 = 0;

1305 ià(
runid
 =ğ
NULL
)  0;

1307 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
ma¡”
->
£Áš–s
);

1308 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1309 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1311 ià(
ri
->
runid
 && 
	`¡rcmp
(ri->runid,runid) == 0) {

1312 
	`diùD–‘e
(
ma¡”
->
£Áš–s
,
ri
->
Çme
);

1313 
»moved
++;

1316 
	`diùR–—£I‹¿tÜ
(
di
);

1317  
»moved
;

1318 
	}
}

1326 
£Áš–RedisIn¡ªû
 *
	$g‘S’tš–RedisIn¡ªûByAddrAndRunID
(
diù
 *
š¡ªûs
, *

, 
pÜt
, *
runid
) {

1327 
diùI‹¿tÜ
 *
di
;

1328 
diùEÁry
 *
de
;

1329 
£Áš–RedisIn¡ªû
 *
š¡ªû
 = 
NULL
;

1331 
	`£rv”As£¹
(

 || 
runid
);

1332 
di
 = 
	`diùG‘I‹¿tÜ
(
š¡ªûs
);

1333 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1334 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1336 ià(
runid
 && !
ri
->runid) ;

1337 ià((
runid
 =ğ
NULL
 || 
	`¡rcmp
(
ri
->runid,„unid) == 0) &&

1338 (

 =ğ
NULL
 || (
	`¡rcmp
(
ri
->
addr
->ip, ip) == 0 &&

1339 
ri
->
addr
->
pÜt
 ==…ort)))

1341 
š¡ªû
 = 
ri
;

1345 
	`diùR–—£I‹¿tÜ
(
di
);

1346  
š¡ªû
;

1347 
	}
}

1350 
£Áš–RedisIn¡ªû
 *
	$£Áš–G‘Ma¡”ByName
(*
Çme
) {

1351 
£Áš–RedisIn¡ªû
 *
ri
;

1352 
sds
 
sd¢ame
 = 
	`sd¢ew
(
Çme
);

1354 
ri
 = 
	`diùF‘chV®ue
(
£Áš–
.
ma¡”s
,
sd¢ame
);

1355 
	`sdsä“
(
sd¢ame
);

1356  
ri
;

1357 
	}
}

1360 
	$£Áš–AddFÏgsToDiùOfRedisIn¡ªûs
(
diù
 *
š¡ªûs
, 
æags
) {

1361 
diùI‹¿tÜ
 *
di
;

1362 
diùEÁry
 *
de
;

1364 
di
 = 
	`diùG‘I‹¿tÜ
(
š¡ªûs
);

1365 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1366 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1367 
ri
->
æags
 |= flags;

1369 
	`diùR–—£I‹¿tÜ
(
di
);

1370 
	}
}

1374 
	$£Áš–D–FÏgsToDiùOfRedisIn¡ªûs
(
diù
 *
š¡ªûs
, 
æags
) {

1375 
diùI‹¿tÜ
 *
di
;

1376 
diùEÁry
 *
de
;

1378 
di
 = 
	`diùG‘I‹¿tÜ
(
š¡ªûs
);

1379 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1380 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1381 
ri
->
æags
 &= ~flags;

1383 
	`diùR–—£I‹¿tÜ
(
di
);

1384 
	}
}

1397 
	#SENTINEL_RESET_NO_SENTINELS
 (1<<0)

	)

1398 
	$£Áš–Re£tMa¡”
(
£Áš–RedisIn¡ªû
 *
ri
, 
æags
) {

1399 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_MASTER
);

1400 
	`diùR–—£
(
ri
->
¦aves
);

1401 
ri
->
¦aves
 = 
	`diùC»©e
(&
š¡ªûsDiùTy³
,
NULL
);

1402 ià(!(
æags
 & 
SENTINEL_RESET_NO_SENTINELS
)) {

1403 
	`diùR–—£
(
ri
->
£Áš–s
);

1404 
ri
->
£Áš–s
 = 
	`diùC»©e
(&
š¡ªûsDiùTy³
,
NULL
);

1406 
	`š¡ªûLškClo£CÚÃùiÚ
(
ri
->
lšk
,ri->lšk->
cc
);

1407 
	`š¡ªûLškClo£CÚÃùiÚ
(
ri
->
lšk
,ri->lšk->
pc
);

1408 
ri
->
æags
 &ğ
SRI_MASTER
;

1409 ià(
ri
->
Ëad”
) {

1410 
	`sdsä“
(
ri
->
Ëad”
);

1411 
ri
->
Ëad”
 = 
NULL
;

1413 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_NONE
;

1414 
ri
->
çov”_¡©e_chªge_time
 = 0;

1415 
ri
->
çov”_¡¬t_time
 = 0;

1416 
ri
->
´omÙed_¦ave
 = 
NULL
;

1417 
	`sdsä“
(
ri
->
runid
);

1418 
	`sdsä“
(
ri
->
¦ave_ma¡”_ho¡
);

1419 
ri
->
runid
 = 
NULL
;

1420 
ri
->
¦ave_ma¡”_ho¡
 = 
NULL
;

1421 
ri
->
lšk
->
aù_pšg_time
 = 
	`m¡ime
();

1422 
ri
->
lšk
->
Ï¡_pšg_time
 = 0;

1423 
ri
->
lšk
->
Ï¡_ava_time
 = 
	`m¡ime
();

1424 
ri
->
lšk
->
Ï¡_pÚg_time
 = 
	`m¡ime
();

1425 
ri
->
rŞe_»pÜ‹d_time
 = 
	`m¡ime
();

1426 
ri
->
rŞe_»pÜ‹d
 = 
SRI_MASTER
;

1427 ià(
æags
 & 
SENTINEL_GENERATE_EVENT
)

1428 
	`£Áš–Ev’t
(
LL_WARNING
,"+»£t-ma¡”",
ri
,"%@");

1429 
	}
}

1433 
	$£Áš–Re£tMa¡”sByP©‹º
(*
·‰”n
, 
æags
) {

1434 
diùI‹¿tÜ
 *
di
;

1435 
diùEÁry
 *
de
;

1436 
»£t
 = 0;

1438 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

1439 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1440 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1442 ià(
ri
->
Çme
) {

1443 ià(
	`¡ršgm©ch
(
·‰”n
,
ri
->
Çme
,0)) {

1444 
	`£Áš–Re£tMa¡”
(
ri
,
æags
);

1445 
»£t
++;

1449 
	`diùR–—£I‹¿tÜ
(
di
);

1450  
»£t
;

1451 
	}
}

1460 
	$£Áš–Re£tMa¡”AndChªgeAdd»ss
(
£Áš–RedisIn¡ªû
 *
ma¡”
, *

, 
pÜt
) {

1461 
£Áš–Addr
 *
Şdaddr
, *
Ãwaddr
;

1462 
£Áš–Addr
 **
¦aves
 = 
NULL
;

1463 
num¦aves
 = 0, 
j
;

1464 
diùI‹¿tÜ
 *
di
;

1465 
diùEÁry
 *
de
;

1467 
Ãwaddr
 = 
	`ü—‹S’tš–Addr
(

,
pÜt
);

1468 ià(
Ãwaddr
 =ğ
NULL
è 
C_ERR
;

1472 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

1473 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1474 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

1476 ià(
	`£Áš–AddrIsEqu®
(
¦ave
->
addr
,
Ãwaddr
)) ;

1477 
¦aves
 = 
	`z»®loc
(¦aves,(
£Áš–Addr
*)*(
num¦aves
+1));

1478 
¦aves
[
num¦aves
++] = 
	`ü—‹S’tš–Addr
(
¦ave
->
addr
->

,

1479 
¦ave
->
addr
->
pÜt
);

1481 
	`diùR–—£I‹¿tÜ
(
di
);

1486 ià(!
	`£Áš–AddrIsEqu®
(
Ãwaddr
,
ma¡”
->
addr
)) {

1487 
¦aves
 = 
	`z»®loc
(¦aves,(
£Áš–Addr
*)*(
num¦aves
+1));

1488 
¦aves
[
num¦aves
++] = 
	`ü—‹S’tš–Addr
(
ma¡”
->
addr
->

,

1489 
ma¡”
->
addr
->
pÜt
);

1493 
	`£Áš–Re£tMa¡”
(
ma¡”
,
SENTINEL_RESET_NO_SENTINELS
);

1494 
Şdaddr
 = 
ma¡”
->
addr
;

1495 
ma¡”
->
addr
 = 
Ãwaddr
;

1496 
ma¡”
->
o_down_sšû_time
 = 0;

1497 
ma¡”
->
s_down_sšû_time
 = 0;

1500 
j
 = 0; j < 
num¦aves
; j++) {

1501 
£Áš–RedisIn¡ªû
 *
¦ave
;

1503 
¦ave
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
NULL
,
SRI_SLAVE
,
¦aves
[
j
]->

,

1504 
¦aves
[
j
]->
pÜt
, 
ma¡”
->
quÜum
, master);

1505 
	`»Ëa£S’tš–Addr
(
¦aves
[
j
]);

1506 ià(
¦ave
è
	`£Áš–Ev’t
(
LL_NOTICE
,"+slave",slave,"%@");

1508 
	`zä“
(
¦aves
);

1512 
	`»Ëa£S’tš–Addr
(
Şdaddr
);

1513 
	`£Áš–FlushCÚfig
();

1514  
C_OK
;

1515 
	}
}

1519 
	$£Áš–RedisIn¡ªûNoDownFÜ
(
£Áš–RedisIn¡ªû
 *
ri
, 
m¡ime_t
 
ms
) {

1520 
m¡ime_t
 
mo¡_»ûÁ
;

1522 
mo¡_»ûÁ
 = 
ri
->
s_down_sšû_time
;

1523 ià(
ri
->
o_down_sšû_time
 > 
mo¡_»ûÁ
)

1524 
mo¡_»ûÁ
 = 
ri
->
o_down_sšû_time
;

1525  
mo¡_»ûÁ
 =ğ0 || (
	`m¡ime
(è- mo¡_»ûÁè> 
ms
;

1526 
	}
}

1530 
£Áš–Addr
 *
	$£Áš–G‘Cu¼’tMa¡”Add»ss
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

1536 ià((
ma¡”
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
) &&

1537 
ma¡”
->
´omÙed_¦ave
 &&

1538 
ma¡”
->
çov”_¡©e
 >ğ
SENTINEL_FAILOVER_STATE_RECONF_SLAVES
)

1540  
ma¡”
->
´omÙed_¦ave
->
addr
;

1542  
ma¡”
->
addr
;

1544 
	}
}

1548 
	$£Áš–Prİag©eDownAá”P”iod
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

1549 
diùI‹¿tÜ
 *
di
;

1550 
diùEÁry
 *
de
;

1551 
j
;

1552 
diù
 *
d
[] = {
ma¡”
->
¦aves
, ma¡”->
£Áš–s
, 
NULL
};

1554 
j
 = 0; 
d
[j]; j++) {

1555 
di
 = 
	`diùG‘I‹¿tÜ
(
d
[
j
]);

1556 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1557 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

1558 
ri
->
down_aá”_³riod
 = 
ma¡”
->down_after_period;

1560 
	`diùR–—£I‹¿tÜ
(
di
);

1562 
	}
}

1564 *
	$£Áš–G‘In¡ªûTy³SŒšg
(
£Áš–RedisIn¡ªû
 *
ri
) {

1565 ià(
ri
->
æags
 & 
SRI_MASTER
)  "master";

1566 ià(
ri
->
æags
 & 
SRI_SLAVE
)  "slave";

1567 ià(
ri
->
æags
 & 
SRI_SENTINEL
)  "sentinel";

1569 
	}
}

1572 *
	$£Áš–HªdËCÚfigu¿tiÚ
(**
¬gv
, 
¬gc
) {

1573 
£Áš–RedisIn¡ªû
 *
ri
;

1575 ià(!
	`¡rÿ£cmp
(
¬gv
[0],"mÚ™Ü"è&& 
¬gc
 == 5) {

1577 
quÜum
 = 
	`©oi
(
¬gv
[4]);

1579 ià(
quÜum
 <= 0)  "Quorum must be 1 or greater.";

1580 ià(
	`ü—‹S’tš–RedisIn¡ªû
(
¬gv
[1],
SRI_MASTER
,argv[2],

1581 
	`©oi
(
¬gv
[3]),
quÜum
,
NULL
) == NULL)

1583 
”ºo
) {

1584 
EBUSY
:  "Duplicated master‚ame.";

1585 
ENOENT
:  "Can't„esolve master instance hostname.";

1586 
EINVAL
:  "Invalid…ort‚umber";

1589 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"down-aá”-mli£cÚds"è&& 
¬gc
 == 3) {

1591 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1592 ià(!
ri
)  "No such master with specified‚ame.";

1593 
ri
->
down_aá”_³riod
 = 
	`©oi
(
¬gv
[2]);

1594 ià(
ri
->
down_aá”_³riod
 <= 0)

1596 
	`£Áš–Prİag©eDownAá”P”iod
(
ri
);

1597 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"çov”-timeout"è&& 
¬gc
 == 3) {

1599 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1600 ià(!
ri
)  "No such master with specified‚ame.";

1601 
ri
->
çov”_timeout
 = 
	`©oi
(
¬gv
[2]);

1602 ià(
ri
->
çov”_timeout
 <= 0)

1604 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"·¿Î–-syncs"è&& 
¬gc
 == 3) {

1606 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1607 ià(!
ri
)  "No such master with specified‚ame.";

1608 
ri
->
·¿Î–_syncs
 = 
	`©oi
(
¬gv
[2]);

1609 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"nÙifiÿtiÚ-süt"è&& 
¬gc
 == 3) {

1611 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1612 ià(!
ri
)  "No such master with specified‚ame.";

1613 ià(
	`acûss
(
¬gv
[2],
X_OK
) == -1)

1615 
ri
->
nÙifiÿtiÚ_süt
 = 
	`sd¢ew
(
¬gv
[2]);

1616 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"ş›Á-»cÚfig-süt"è&& 
¬gc
 == 3) {

1618 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1619 ià(!
ri
)  "No such master with specified‚ame.";

1620 ià(
	`acûss
(
¬gv
[2],
X_OK
) == -1)

1623 
ri
->
ş›Á_»cÚfig_süt
 = 
	`sd¢ew
(
¬gv
[2]);

1624 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"auth-·ss"è&& 
¬gc
 == 3) {

1626 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1627 ià(!
ri
)  "No such master with specified‚ame.";

1628 
ri
->
auth_·ss
 = 
	`sd¢ew
(
¬gv
[2]);

1629 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cu¼’t-•och"è&& 
¬gc
 == 2) {

1631 
cu¼’t_•och
 = 
	`¡¹ouÎ
(
¬gv
[1],
NULL
,10);

1632 ià(
cu¼’t_•och
 > 
£Áš–
.current_epoch)

1633 
£Áš–
.
cu¼’t_•och
 = current_epoch;

1634 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"myid"è&& 
¬gc
 == 2) {

1635 ià(
	`¡¾’
(
¬gv
[1]è!ğ
CONFIG_RUN_ID_SIZE
)

1637 
	`memıy
(
£Áš–
.
myid
,
¬gv
[1],
CONFIG_RUN_ID_SIZE
);

1638 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"cÚfig-•och"è&& 
¬gc
 == 3) {

1640 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1641 ià(!
ri
)  "No such master with specified‚ame.";

1642 
ri
->
cÚfig_•och
 = 
	`¡¹ouÎ
(
¬gv
[2],
NULL
,10);

1646 ià(
ri
->
cÚfig_•och
 > 
£Áš–
.
cu¼’t_•och
)

1647 
£Áš–
.
cu¼’t_•och
 = 
ri
->
cÚfig_•och
;

1648 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"Ëad”-•och"è&& 
¬gc
 == 3) {

1650 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1651 ià(!
ri
)  "No such master with specified‚ame.";

1652 
ri
->
Ëad”_•och
 = 
	`¡¹ouÎ
(
¬gv
[2],
NULL
,10);

1653 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"known-¦ave"è&& 
¬gc
 == 4) {

1654 
£Áš–RedisIn¡ªû
 *
¦ave
;

1657 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1658 ià(!
ri
)  "No such master with specified‚ame.";

1659 ià((
¦ave
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
NULL
,
SRI_SLAVE
,
¬gv
[2],

1660 
	`©oi
(
¬gv
[3]), 
ri
->
quÜum
,„i)è=ğ
NULL
)

1664 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"known-sentinel") &&

1665 (
¬gc
 == 4 ||‡rgc == 5)) {

1666 
£Áš–RedisIn¡ªû
 *
si
;

1668 ià(
¬gc
 == 5) {

1670 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
¬gv
[1]);

1671 ià(!
ri
)  "No such master with specified‚ame.";

1672 ià((
si
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
¬gv
[4],
SRI_SENTINEL
,argv[2],

1673 
	`©oi
(
¬gv
[3]), 
ri
->
quÜum
,„i)è=ğ
NULL
)

1677 
si
->
runid
 = 
	`sd¢ew
(
¬gv
[4]);

1678 
	`£Áš–TryCÚÃùiÚSh¬šg
(
si
);

1680 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"ªnounû-"è&& 
¬gc
 == 2) {

1682 ià(
	`¡¾’
(
¬gv
[1]))

1683 
£Áš–
.
ªnounû_
 = 
	`sd¢ew
(
¬gv
[1]);

1684 } ià(!
	`¡rÿ£cmp
(
¬gv
[0],"ªnounû-pÜt"è&& 
¬gc
 == 2) {

1686 
£Áš–
.
ªnounû_pÜt
 = 
	`©oi
(
¬gv
[1]);

1690  
NULL
;

1691 
	}
}

1698 
	$»wr™eCÚfigS’tš–O±iÚ
(
»wr™eCÚfigS‹
 *
¡©e
) {

1699 
diùI‹¿tÜ
 *
di
, *
di2
;

1700 
diùEÁry
 *
de
;

1701 
sds
 
lše
;

1704 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(), "£Áš– myid %s", 
£Áš–
.
myid
);

1705 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1708 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

1709 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

1710 
£Áš–RedisIn¡ªû
 *
ma¡”
, *
ri
;

1711 
£Áš–Addr
 *
ma¡”_addr
;

1714 
ma¡”
 = 
	`diùG‘V®
(
de
);

1715 
ma¡”_addr
 = 
	`£Áš–G‘Cu¼’tMa¡”Add»ss
(
ma¡”
);

1716 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"sentinel monitor %s %s %d %d",

1717 
ma¡”
->
Çme
, 
ma¡”_addr
->

, ma¡”_addr->
pÜt
,

1718 
ma¡”
->
quÜum
);

1719 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1722 ià(
ma¡”
->
down_aá”_³riod
 !ğ
SENTINEL_DEFAULT_DOWN_AFTER
) {

1723 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1725 
ma¡”
->
Çme
, (èma¡”->
down_aá”_³riod
);

1726 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1730 ià(
ma¡”
->
çov”_timeout
 !ğ
SENTINEL_DEFAULT_FAILOVER_TIMEOUT
) {

1731 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1733 
ma¡”
->
Çme
, (èma¡”->
çov”_timeout
);

1734 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1738 ià(
ma¡”
->
·¿Î–_syncs
 !ğ
SENTINEL_DEFAULT_PARALLEL_SYNCS
) {

1739 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1741 
ma¡”
->
Çme
, ma¡”->
·¿Î–_syncs
);

1742 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1746 ià(
ma¡”
->
nÙifiÿtiÚ_süt
) {

1747 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1749 
ma¡”
->
Çme
, ma¡”->
nÙifiÿtiÚ_süt
);

1750 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1754 ià(
ma¡”
->
ş›Á_»cÚfig_süt
) {

1755 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1757 
ma¡”
->
Çme
, ma¡”->
ş›Á_»cÚfig_süt
);

1758 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1762 ià(
ma¡”
->
auth_·ss
) {

1763 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1765 
ma¡”
->
Çme
, ma¡”->
auth_·ss
);

1766 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1770 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1772 
ma¡”
->
Çme
, (èma¡”->
cÚfig_•och
);

1773 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1776 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1778 
ma¡”
->
Çme
, (èma¡”->
Ëad”_•och
);

1779 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1782 
di2
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

1783 (
de
 = 
	`diùNext
(
di2
)è!ğ
NULL
) {

1784 
£Áš–Addr
 *
¦ave_addr
;

1786 
ri
 = 
	`diùG‘V®
(
de
);

1787 
¦ave_addr
 = 
ri
->
addr
;

1794 ià(
	`£Áš–AddrIsEqu®
(
¦ave_addr
,
ma¡”_addr
))

1795 
¦ave_addr
 = 
ma¡”
->
addr
;

1796 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1798 
ma¡”
->
Çme
, 
¦ave_addr
->

, sÏve_addr->
pÜt
);

1799 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1801 
	`diùR–—£I‹¿tÜ
(
di2
);

1804 
di2
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
£Áš–s
);

1805 (
de
 = 
	`diùNext
(
di2
)è!ğ
NULL
) {

1806 
ri
 = 
	`diùG‘V®
(
de
);

1807 ià(
ri
->
runid
 =ğ
NULL
) ;

1808 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1810 
ma¡”
->
Çme
, 
ri
->
addr
->

,„i->addr->
pÜt
,„i->
runid
);

1811 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1813 
	`diùR–—£I‹¿tÜ
(
di2
);

1817 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),

1818 "£Áš– cu¼’t-•och %Îu", (è
£Áš–
.
cu¼’t_•och
);

1819 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1822 ià(
£Áš–
.
ªnounû_
) {

1823 
lše
 = 
	`sd¢ew
("sentinel‡nnounce-ip ");

1824 
lše
 = 
	`sdsÿŒ•r
Öše, 
£Áš–
.
ªnounû_
, 
	`sd¦’
(sentinel.announce_ip));

1825 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1829 ià(
£Áš–
.
ªnounû_pÜt
) {

1830 
lše
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"sentinel‡nnounce-port %d",

1831 
£Áš–
.
ªnounû_pÜt
);

1832 
	`»wr™eCÚfigRewr™eLše
(
¡©e
,"£Áš–",
lše
,1);

1835 
	`diùR–—£I‹¿tÜ
(
di
);

1836 
	}
}

1845 
	$£Áš–FlushCÚfig
() {

1846 
fd
 = -1;

1847 
§ved_hz
 = 
£rv”
.
hz
;

1848 
»wr™e_¡©us
;

1850 
£rv”
.
hz
 = 
CONFIG_DEFAULT_HZ
;

1851 
»wr™e_¡©us
 = 
	`»wr™eCÚfig
(
£rv”
.
cÚfigfe
);

1852 
£rv”
.
hz
 = 
§ved_hz
;

1854 ià(
»wr™e_¡©us
 =ğ-1è
w”r
;

1855 ià((
fd
 = 
	`İ’
(
£rv”
.
cÚfigfe
,
O_RDONLY
)è=ğ-1è
w”r
;

1856 ià(
	`fsync
(
fd
è=ğ-1è
w”r
;

1857 ià(
	`şo£
(
fd
è=ğ
EOF
è
w”r
;

1860 
w”r
:

1861 ià(
fd
 !ğ-1è
	`şo£
(fd);

1862 
	`£rv”Log
(
LL_WARNING
,"WARNING: S’tš– wa nÙ‡bËØ§vthÃw cÚfigu¿tiÚ oÀdisk!!!: %s", 
	`¡»¼Ü
(
”ºo
));

1863 
	}
}

1873 
	$£Áš–S’dAuthIfN“ded
(
£Áš–RedisIn¡ªû
 *
ri
, 
»disAsyncCÚ‹xt
 *
c
) {

1874 *
auth_·ss
 = (
ri
->
æags
 & 
SRI_MASTER
) ?„i->auth_pass :

1875 
ri
->
ma¡”
->
auth_·ss
;

1877 ià(
auth_·ss
) {

1878 ià(
	`»disAsyncCommªd
(
c
, 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "AUTH %s",

1879 
auth_·ss
è=ğ
C_OK
è
ri
->
lšk
->
³ndšg_commªds
++;

1881 
	}
}

1889 
	$£Áš–S‘Cl›ÁName
(
£Áš–RedisIn¡ªû
 *
ri
, 
»disAsyncCÚ‹xt
 *
c
, *
ty³
) {

1890 
Çme
[64];

1892 
	`¢´štf
(
Çme
,Òame),"£Áš–-%.8s-%s",
£Áš–
.
myid
,
ty³
);

1893 ià(
	`»disAsyncCommªd
(
c
, 
£Áš–DisÿrdR•lyC®lback
, 
ri
,

1894 "CLIENT SETNAME %s", 
Çme
è=ğ
C_OK
)

1896 
ri
->
lšk
->
³ndšg_commªds
++;

1898 
	}
}

1903 
	$£Áš–RecÚÃùIn¡ªû
(
£Áš–RedisIn¡ªû
 *
ri
) {

1904 ià(
ri
->
lšk
->
discÚÃùed
 == 0) ;

1905 ià(
ri
->
addr
->
pÜt
 == 0) ;

1906 
š¡ªûLšk
 *
lšk
 = 
ri
->link;

1907 
m¡ime_t
 
now
 = 
	`m¡ime
();

1909 ià(
now
 - 
ri
->
lšk
->
Ï¡_»cÚn_time
 < 
SENTINEL_PING_PERIOD
) ;

1910 
ri
->
lšk
->
Ï¡_»cÚn_time
 = 
now
;

1913 ià(
lšk
->
cc
 =ğ
NULL
) {

1914 
lšk
->
cc
 = 
	`»disAsyncCÚÃùBšd
(
ri
->
addr
->

,ri->addr->
pÜt
,
NET_FIRST_BIND_ADDR
);

1915 ià(
lšk
->
cc
->
”r
) {

1916 
	`£Áš–Ev’t
(
LL_DEBUG
,"-cmd-lšk-»cÚÃùiÚ",
ri
,"%@ #%s",

1917 
lšk
->
cc
->
”r¡r
);

1918 
	`š¡ªûLškClo£CÚÃùiÚ
(
lšk
,lšk->
cc
);

1920 
lšk
->
³ndšg_commªds
 = 0;

1921 
lšk
->
cc_cÚn_time
 = 
	`m¡ime
();

1922 
lšk
->
cc
->
d©a
 =†ink;

1923 
	`»disAeA‰ach
(
£rv”
.
–
,
lšk
->
cc
);

1924 
	`»disAsyncS‘CÚÃùC®lback
(
lšk
->
cc
,

1925 
£Áš–LškE¡ablishedC®lback
);

1926 
	`»disAsyncS‘DiscÚÃùC®lback
(
lšk
->
cc
,

1927 
£Áš–DiscÚÃùC®lback
);

1928 
	`£Áš–S’dAuthIfN“ded
(
ri
,
lšk
->
cc
);

1929 
	`£Áš–S‘Cl›ÁName
(
ri
,
lšk
->
cc
,"cmd");

1932 
	`£Áš–S’dPšg
(
ri
);

1936 ià((
ri
->
æags
 & (
SRI_MASTER
|
SRI_SLAVE
)è&& 
lšk
->
pc
 =ğ
NULL
) {

1937 
lšk
->
pc
 = 
	`»disAsyncCÚÃùBšd
(
ri
->
addr
->

,ri->addr->
pÜt
,
NET_FIRST_BIND_ADDR
);

1938 ià(
lšk
->
pc
->
”r
) {

1939 
	`£Áš–Ev’t
(
LL_DEBUG
,"-pubsub-lšk-»cÚÃùiÚ",
ri
,"%@ #%s",

1940 
lšk
->
pc
->
”r¡r
);

1941 
	`š¡ªûLškClo£CÚÃùiÚ
(
lšk
,lšk->
pc
);

1943 
»tv®
;

1945 
lšk
->
pc_cÚn_time
 = 
	`m¡ime
();

1946 
lšk
->
pc
->
d©a
 =†ink;

1947 
	`»disAeA‰ach
(
£rv”
.
–
,
lšk
->
pc
);

1948 
	`»disAsyncS‘CÚÃùC®lback
(
lšk
->
pc
,

1949 
£Áš–LškE¡ablishedC®lback
);

1950 
	`»disAsyncS‘DiscÚÃùC®lback
(
lšk
->
pc
,

1951 
£Áš–DiscÚÃùC®lback
);

1952 
	`£Áš–S’dAuthIfN“ded
(
ri
,
lšk
->
pc
);

1953 
	`£Áš–S‘Cl›ÁName
(
ri
,
lšk
->
pc
,"pubsub");

1955 
»tv®
 = 
	`»disAsyncCommªd
(
lšk
->
pc
,

1956 
£Áš–ReûiveH–loMes§ges
, 
ri
, "SUBSCRIBE %s",

1957 
SENTINEL_HELLO_CHANNEL
);

1958 ià(
»tv®
 !ğ
C_OK
) {

1961 
	`š¡ªûLškClo£CÚÃùiÚ
(
lšk
,lšk->
pc
);

1968 ià(
lšk
->
cc
 && (
ri
->
æags
 & 
SRI_SENTINEL
 ||†šk->
pc
))

1969 
lšk
->
discÚÃùed
 = 0;

1970 
	}
}

1979 
	$£Áš–Ma¡”LooksSªe
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

1981 
ma¡”
->
æags
 & 
SRI_MASTER
 &&

1982 
ma¡”
->
rŞe_»pÜ‹d
 =ğ
SRI_MASTER
 &&

1983 (
ma¡”
->
æags
 & (
SRI_S_DOWN
|
SRI_O_DOWN
)) == 0 &&

1984 (
	`m¡ime
(è- 
ma¡”
->
šfo_»äesh
è< 
SENTINEL_INFO_PERIOD
*2;

1985 
	}
}

1988 
	$£Áš–ReäeshIn¡ªûInfo
(
£Áš–RedisIn¡ªû
 *
ri
, cÚ¡ *
šfo
) {

1989 
sds
 *
lšes
;

1990 
numlšes
, 
j
;

1991 
rŞe
 = 0;

1994 
	`sdsä“
(
ri
->
šfo
);

1995 
ri
->
šfo
 = 
	`sd¢ew
(info);

1999 
ri
->
ma¡”_lšk_down_time
 = 0;

2002 
lšes
 = 
	`sds¥l™Ën
(
šfo
,
	`¡¾’
(šfo),"\r\n",2,&
numlšes
);

2003 
j
 = 0; j < 
numlšes
; j++) {

2004 
£Áš–RedisIn¡ªû
 *
¦ave
;

2005 
sds
 
l
 = 
lšes
[
j
];

2008 ià(
	`sd¦’
(
l
è>ğ47 && !
	`memcmp
(l,"run_id:",7)) {

2009 ià(
ri
->
runid
 =ğ
NULL
) {

2010 
ri
->
runid
 = 
	`sd¢ewËn
(
l
+7,40);

2012 ià(
	`¡ºcmp
(
ri
->
runid
,
l
+7,40) != 0) {

2013 
	`£Áš–Ev’t
(
LL_NOTICE
,"+»boÙ",
ri
,"%@");

2014 
	`sdsä“
(
ri
->
runid
);

2015 
ri
->
runid
 = 
	`sd¢ewËn
(
l
+7,40);

2022 ià((
ri
->
æags
 & 
SRI_MASTER
) &&

2023 
	`sd¦’
(
l
) >= 7 &&

2024 !
	`memcmp
(
l
,"¦ave",5è&& 
	`isdig™
(l[5]))

2026 *

, *
pÜt
, *
’d
;

2028 ià(
	`¡r¡r
(
l
,"="è=ğ
NULL
) {

2030 

 = 
	`¡rchr
(
l
,':'); if (!ip) ;

2031 

++;

2032 
pÜt
 = 
	`¡rchr
(

,','); if (!port) ;

2033 *
pÜt
 = '\0';

2034 
pÜt
++;

2035 
’d
 = 
	`¡rchr
(
pÜt
,','); if (!end) ;

2036 *
’d
 = '\0';

2039 

 = 
	`¡r¡r
(
l
,"ip="); if (!ip) ;

2040 

 += 3;

2041 
pÜt
 = 
	`¡r¡r
(
l
,"port="); if (!port) ;

2042 
pÜt
 += 5;

2044 
’d
 = 
	`¡rchr
(

,','); if (end) *end = '\0';

2045 
’d
 = 
	`¡rchr
(
pÜt
,','); if (end) *end = '\0';

2050 ià(
	`£Áš–RedisIn¡ªûLookupSÏve
(
ri
,

,
	`©oi
(
pÜt
)è=ğ
NULL
) {

2051 ià((
¦ave
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
NULL
,
SRI_SLAVE
,

,

2052 
	`©oi
(
pÜt
), 
ri
->
quÜum
,„i)è!ğ
NULL
)

2054 
	`£Áš–Ev’t
(
LL_NOTICE
,"+¦ave",
¦ave
,"%@");

2055 
	`£Áš–FlushCÚfig
();

2061 ià(
	`sd¦’
(
l
) >= 32 &&

2062 !
	`memcmp
(
l
,"master_link_down_since_seconds",30))

2064 
ri
->
ma¡”_lšk_down_time
 = 
	`¡¹Şl
(
l
+31,
NULL
,10)*1000;

2068 ià(!
	`memcmp
(
l
,"rŞe:ma¡”",11)è
rŞe
 = 
SRI_MASTER
;

2069 ià(!
	`memcmp
(
l
,"rŞe:¦ave",10)è
rŞe
 = 
SRI_SLAVE
;

2071 ià(
rŞe
 =ğ
SRI_SLAVE
) {

2073 ià(
	`sd¦’
(
l
è>ğ12 && !
	`memcmp
(l,"master_host:",12)) {

2074 ià(
ri
->
¦ave_ma¡”_ho¡
 =ğ
NULL
 ||

2075 
	`¡rÿ£cmp
(
l
+12,
ri
->
¦ave_ma¡”_ho¡
))

2077 
	`sdsä“
(
ri
->
¦ave_ma¡”_ho¡
);

2078 
ri
->
¦ave_ma¡”_ho¡
 = 
	`sd¢ew
(
l
+12);

2079 
ri
->
¦ave_cÚf_chªge_time
 = 
	`m¡ime
();

2084 ià(
	`sd¦’
(
l
è>ğ12 && !
	`memcmp
(l,"master_port:",12)) {

2085 
¦ave_ma¡”_pÜt
 = 
	`©oi
(
l
+12);

2087 ià(
ri
->
¦ave_ma¡”_pÜt
 != slave_master_port) {

2088 
ri
->
¦ave_ma¡”_pÜt
 = slave_master_port;

2089 
ri
->
¦ave_cÚf_chªge_time
 = 
	`m¡ime
();

2094 ià(
	`sd¦’
(
l
è>ğ19 && !
	`memcmp
(l,"master_link_status:",19)) {

2095 
ri
->
¦ave_ma¡”_lšk_¡©us
 =

2096 (
	`¡rÿ£cmp
(
l
+19,"up") == 0) ?

2097 
SENTINEL_MASTER_LINK_STATUS_UP
 :

2098 
SENTINEL_MASTER_LINK_STATUS_DOWN
;

2102 ià(
	`sd¦’
(
l
è>ğ15 && !
	`memcmp
(l,"slave_priority:",15))

2103 
ri
->
¦ave_´iÜ™y
 = 
	`©oi
(
l
+15);

2106 ià(
	`sd¦’
(
l
è>ğ18 && !
	`memcmp
(l,"slave_repl_offset:",18))

2107 
ri
->
¦ave_»¶_off£t
 = 
	`¡¹ouÎ
(
l
+18,
NULL
,10);

2110 
ri
->
šfo_»äesh
 = 
	`m¡ime
();

2111 
	`sdsä“¥l™»s
(
lšes
,
numlšes
);

2118 ià(
rŞe
 !ğ
ri
->
rŞe_»pÜ‹d
) {

2119 
ri
->
rŞe_»pÜ‹d_time
 = 
	`m¡ime
();

2120 
ri
->
rŞe_»pÜ‹d
 = 
rŞe
;

2121 ià(
rŞe
 =ğ
SRI_SLAVE
è
ri
->
¦ave_cÚf_chªge_time
 = 
	`m¡ime
();

2124 
	`£Áš–Ev’t
(
LL_VERBOSE
,

2125 ((
ri
->
æags
 & (
SRI_MASTER
|
SRI_SLAVE
)è=ğ
rŞe
) ?

2127 
ri
, "%@‚ew„eported„ole is %s",

2128 
rŞe
 =ğ
SRI_MASTER
 ? "master" : "slave",

2129 
ri
->
æags
 & 
SRI_MASTER
 ? "master" : "slave");

2134 ià(
£Áš–
.
tt
) ;

2137 ià((
ri
->
æags
 & 
SRI_MASTER
è&& 
rŞe
 =ğ
SRI_SLAVE
) {

2144 ià((
ri
->
æags
 & 
SRI_SLAVE
è&& 
rŞe
 =ğ
SRI_MASTER
) {

2147 ià((
ri
->
æags
 & 
SRI_PROMOTED
) &&

2148 (
ri
->
ma¡”
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
) &&

2149 (
ri
->
ma¡”
->
çov”_¡©e
 ==

2150 
SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
))

2157 
ri
->
ma¡”
->
cÚfig_•och
 =„i->ma¡”->
çov”_•och
;

2158 
ri
->
ma¡”
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_RECONF_SLAVES
;

2159 
ri
->
ma¡”
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

2160 
	`£Áš–FlushCÚfig
();

2161 
	`£Áš–Ev’t
(
LL_WARNING
,"+´omÙed-¦ave",
ri
,"%@");

2162 ià(
£Áš–
.
simçu»_æags
 &

2163 
SENTINEL_SIMFAILURE_CRASH_AFTER_PROMOTION
)

2164 
	`£Áš–SimFau»C¿sh
();

2165 
	`£Áš–Ev’t
(
LL_WARNING
,"+failover-state-reconf-slaves",

2166 
ri
->
ma¡”
,"%@");

2167 
	`£Áš–C®lCl›ÁRecÚfSüt
(
ri
->
ma¡”
,
SENTINEL_LEADER
,

2168 "¡¬t",
ri
->
ma¡”
->
addr
,ri->addr);

2169 
	`£Áš–FÜûH–loUpd©eFÜMa¡”
(
ri
->
ma¡”
);

2174 
m¡ime_t
 
wa™_time
 = 
SENTINEL_PUBLISH_PERIOD
*4;

2176 ià(!(
ri
->
æags
 & 
SRI_PROMOTED
) &&

2177 
	`£Áš–Ma¡”LooksSªe
(
ri
->
ma¡”
) &&

2178 
	`£Áš–RedisIn¡ªûNoDownFÜ
(
ri
,
wa™_time
) &&

2179 
	`m¡ime
(è- 
ri
->
rŞe_»pÜ‹d_time
 > 
wa™_time
)

2181 
»tv®
 = 
	`£Áš–S’dSÏveOf
(
ri
,

2182 
ri
->
ma¡”
->
addr
->

,

2183 
ri
->
ma¡”
->
addr
->
pÜt
);

2184 ià(
»tv®
 =ğ
C_OK
)

2185 
	`£Áš–Ev’t
(
LL_NOTICE
,"+cÚv”t-to-¦ave",
ri
,"%@");

2191 ià((
ri
->
æags
 & 
SRI_SLAVE
) &&

2192 
rŞe
 =ğ
SRI_SLAVE
 &&

2193 (
ri
->
¦ave_ma¡”_pÜt
 !ğri->
ma¡”
->
addr
->
pÜt
 ||

2194 
	`¡rÿ£cmp
(
ri
->
¦ave_ma¡”_ho¡
,ri->
ma¡”
->
addr
->

)))

2196 
m¡ime_t
 
wa™_time
 = 
ri
->
ma¡”
->
çov”_timeout
;

2200 ià(
	`£Áš–Ma¡”LooksSªe
(
ri
->
ma¡”
) &&

2201 
	`£Áš–RedisIn¡ªûNoDownFÜ
(
ri
,
wa™_time
) &&

2202 
	`m¡ime
(è- 
ri
->
¦ave_cÚf_chªge_time
 > 
wa™_time
)

2204 
»tv®
 = 
	`£Áš–S’dSÏveOf
(
ri
,

2205 
ri
->
ma¡”
->
addr
->

,

2206 
ri
->
ma¡”
->
addr
->
pÜt
);

2207 ià(
»tv®
 =ğ
C_OK
)

2208 
	`£Áš–Ev’t
(
LL_NOTICE
,"+fix-¦ave-cÚfig",
ri
,"%@");

2214 ià((
ri
->
æags
 & 
SRI_SLAVE
è&& 
rŞe
 == SRI_SLAVE &&

2215 (
ri
->
æags
 & (
SRI_RECONF_SENT
|
SRI_RECONF_INPROG
)))

2218 ià((
ri
->
æags
 & 
SRI_RECONF_SENT
) &&

2219 
ri
->
¦ave_ma¡”_ho¡
 &&

2220 
	`¡rcmp
(
ri
->
¦ave_ma¡”_ho¡
,

2221 
ri
->
ma¡”
->
´omÙed_¦ave
->
addr
->

) == 0 &&

2222 
ri
->
¦ave_ma¡”_pÜt
 =ğri->
ma¡”
->
´omÙed_¦ave
->
addr
->
pÜt
)

2224 
ri
->
æags
 &ğ~
SRI_RECONF_SENT
;

2225 
ri
->
æags
 |ğ
SRI_RECONF_INPROG
;

2226 
	`£Áš–Ev’t
(
LL_NOTICE
,"+¦ave-»cÚf-š´og",
ri
,"%@");

2230 ià((
ri
->
æags
 & 
SRI_RECONF_INPROG
) &&

2231 
ri
->
¦ave_ma¡”_lšk_¡©us
 =ğ
SENTINEL_MASTER_LINK_STATUS_UP
)

2233 
ri
->
æags
 &ğ~
SRI_RECONF_INPROG
;

2234 
ri
->
æags
 |ğ
SRI_RECONF_DONE
;

2235 
	`£Áš–Ev’t
(
LL_NOTICE
,"+¦ave-»cÚf-dÚe",
ri
,"%@");

2238 
	}
}

2240 
	$£Áš–InfoR•lyC®lback
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

2241 
£Áš–RedisIn¡ªû
 *
ri
 = 
´ivd©a
;

2242 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

2243 
»disR•ly
 *
r
;

2245 ià(!
»¶y
 || !
lšk
) ;

2246 
lšk
->
³ndšg_commªds
--;

2247 
r
 = 
»¶y
;

2249 ià(
r
->
ty³
 =ğ
REDIS_REPLY_STRING
)

2250 
	`£Áš–ReäeshIn¡ªûInfo
(
ri
,
r
->
¡r
);

2251 
	}
}

2255 
	$£Áš–DisÿrdR•lyC®lback
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

2256 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

2257 
	`UNUSED
(
»¶y
);

2258 
	`UNUSED
(
´ivd©a
);

2260 ià(
lšk
èlšk->
³ndšg_commªds
--;

2261 
	}
}

2263 
	$£Áš–PšgR•lyC®lback
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

2264 
£Áš–RedisIn¡ªû
 *
ri
 = 
´ivd©a
;

2265 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

2266 
»disR•ly
 *
r
;

2268 ià(!
»¶y
 || !
lšk
) ;

2269 
lšk
->
³ndšg_commªds
--;

2270 
r
 = 
»¶y
;

2272 ià(
r
->
ty³
 =ğ
REDIS_REPLY_STATUS
 ||

2273 
r
->
ty³
 =ğ
REDIS_REPLY_ERROR
) {

2276 ià(
	`¡ºcmp
(
r
->
¡r
,"PONG",4) == 0 ||

2277 
	`¡ºcmp
(
r
->
¡r
,"LOADING",7) == 0 ||

2278 
	`¡ºcmp
(
r
->
¡r
,"MASTERDOWN",10) == 0)

2280 
lšk
->
Ï¡_ava_time
 = 
	`m¡ime
();

2281 
lšk
->
aù_pšg_time
 = 0;

2285 ià(
	`¡ºcmp
(
r
->
¡r
,"BUSY",4) == 0 &&

2286 (
ri
->
æags
 & 
SRI_S_DOWN
) &&

2287 !(
ri
->
æags
 & 
SRI_SCRIPT_KILL_SENT
))

2289 ià(
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

2290 
£Áš–DisÿrdR•lyC®lback
, 
ri
,

2291 "SCRIPT KILL"è=ğ
C_OK
)

2292 
ri
->
lšk
->
³ndšg_commªds
++;

2293 
ri
->
æags
 |ğ
SRI_SCRIPT_KILL_SENT
;

2297 
lšk
->
Ï¡_pÚg_time
 = 
	`m¡ime
();

2298 
	}
}

2302 
	$£Áš–PublishR•lyC®lback
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

2303 
£Áš–RedisIn¡ªû
 *
ri
 = 
´ivd©a
;

2304 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

2305 
»disR•ly
 *
r
;

2307 ià(!
»¶y
 || !
lšk
) ;

2308 
lšk
->
³ndšg_commªds
--;

2309 
r
 = 
»¶y
;

2313 ià(
r
->
ty³
 !ğ
REDIS_REPLY_ERROR
)

2314 
ri
->
Ï¡_pub_time
 = 
	`m¡ime
();

2315 
	}
}

2322 
	$£Áš–ProûssH–loMes§ge
(*
h–lo
, 
h–lo_Ën
) {

2326 
numtok’s
, 
pÜt
, 
»moved
, 
ma¡”_pÜt
;

2327 
ušt64_t
 
cu¼’t_•och
, 
ma¡”_cÚfig_•och
;

2328 **
tok’
 = 
	`sds¥l™Ën
(
h–lo
, 
h–lo_Ën
, ",", 1, &
numtok’s
);

2329 
£Áš–RedisIn¡ªû
 *
si
, *
ma¡”
;

2331 ià(
numtok’s
 == 8) {

2333 
ma¡”
 = 
	`£Áš–G‘Ma¡”ByName
(
tok’
[4]);

2334 ià(!
ma¡”
è
ş—nup
;

2337 
pÜt
 = 
	`©oi
(
tok’
[1]);

2338 
ma¡”_pÜt
 = 
	`©oi
(
tok’
[6]);

2339 
si
 = 
	`g‘S’tš–RedisIn¡ªûByAddrAndRunID
(

2340 
ma¡”
->
£Áš–s
,
tok’
[0],
pÜt
,token[2]);

2341 
cu¼’t_•och
 = 
	`¡¹ouÎ
(
tok’
[3],
NULL
,10);

2342 
ma¡”_cÚfig_•och
 = 
	`¡¹ouÎ
(
tok’
[7],
NULL
,10);

2344 ià(!
si
) {

2348 
»moved
 = 
	`»moveM©chšgS’tš–FromMa¡”
(
ma¡”
,
tok’
[2]);

2349 ià(
»moved
) {

2350 
	`£Áš–Ev’t
(
LL_NOTICE
,"+£Áš–-add»ss-sw™ch",
ma¡”
,

2351 "%@ i°% pÜˆ%d fÜ %s", 
tok’
[0],
pÜt
,token[2]);

2357 
£Áš–RedisIn¡ªû
 *
Ùh”
 =

2358 
	`g‘S’tš–RedisIn¡ªûByAddrAndRunID
(

2359 
ma¡”
->
£Áš–s
, 
tok’
[0],
pÜt
,
NULL
);

2360 ià(
Ùh”
) {

2361 
	`£Áš–Ev’t
(
LL_NOTICE
,"+£Áš–-šv®id-addr",
Ùh”
,"%@");

2362 
Ùh”
->
addr
->
pÜt
 = 0;

2363 
	`£Áš–Upd©eS’tš–Add»ssInAÎMa¡”s
(
Ùh”
);

2368 
si
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
tok’
[2],
SRI_SENTINEL
,

2369 
tok’
[0],
pÜt
,
ma¡”
->
quÜum
,master);

2371 ià(
si
) {

2372 ià(!
»moved
è
	`£Áš–Ev’t
(
LL_NOTICE
,"+£Áš–",
si
,"%@");

2376 
si
->
runid
 = 
	`sd¢ew
(
tok’
[2]);

2377 
	`£Áš–TryCÚÃùiÚSh¬šg
(
si
);

2378 ià(
»moved
è
	`£Áš–Upd©eS’tš–Add»ssInAÎMa¡”s
(
si
);

2379 
	`£Áš–FlushCÚfig
();

2384 ià(
cu¼’t_•och
 > 
£Áš–
.current_epoch) {

2385 
£Áš–
.
cu¼’t_•och
 = current_epoch;

2386 
	`£Áš–FlushCÚfig
();

2387 
	`£Áš–Ev’t
(
LL_WARNING
,"+Ãw-•och",
ma¡”
,"%llu",

2388 (è
£Áš–
.
cu¼’t_•och
);

2392 ià(
si
 && 
ma¡”
->
cÚfig_•och
 < 
ma¡”_cÚfig_•och
) {

2393 
ma¡”
->
cÚfig_•och
 = 
ma¡”_cÚfig_•och
;

2394 ià(
ma¡”_pÜt
 !ğ
ma¡”
->
addr
->
pÜt
 ||

2395 
	`¡rcmp
(
ma¡”
->
addr
->

, 
tok’
[5]))

2397 
£Áš–Addr
 *
Şd_addr
;

2399 
	`£Áš–Ev’t
(
LL_WARNING
,"+cÚfig-upd©e-äom",
si
,"%@");

2400 
	`£Áš–Ev’t
(
LL_WARNING
,"+switch-master",

2401 
ma¡”
,"%s %s %d %s %d",

2402 
ma¡”
->
Çme
,

2403 
ma¡”
->
addr
->

, ma¡”->addr->
pÜt
,

2404 
tok’
[5], 
ma¡”_pÜt
);

2406 
Şd_addr
 = 
	`dupS’tš–Addr
(
ma¡”
->
addr
);

2407 
	`£Áš–Re£tMa¡”AndChªgeAdd»ss
(
ma¡”
, 
tok’
[5], 
ma¡”_pÜt
);

2408 
	`£Áš–C®lCl›ÁRecÚfSüt
(
ma¡”
,

2409 
SENTINEL_OBSERVER
,"start",

2410 
Şd_addr
,
ma¡”
->
addr
);

2411 
	`»Ëa£S’tš–Addr
(
Şd_addr
);

2416 ià(
si
èsi->
Ï¡_h–lo_time
 = 
	`m¡ime
();

2419 
ş—nup
:

2420 
	`sdsä“¥l™»s
(
tok’
,
numtok’s
);

2421 
	}
}

2426 
	$£Áš–ReûiveH–loMes§ges
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

2427 
£Áš–RedisIn¡ªû
 *
ri
 = 
´ivd©a
;

2428 
»disR•ly
 *
r
;

2429 
	`UNUSED
(
c
);

2431 ià(!
»¶y
 || !
ri
) ;

2432 
r
 = 
»¶y
;

2437 
ri
->
lšk
->
pc_Ï¡_aùiv™y
 = 
	`m¡ime
();

2441 ià(
r
->
ty³
 !ğ
REDIS_REPLY_ARRAY
 ||

2442 
r
->
–em’ts
 != 3 ||

2443 
r
->
–em’t
[0]->
ty³
 !ğ
REDIS_REPLY_STRING
 ||

2444 
r
->
–em’t
[1]->
ty³
 !ğ
REDIS_REPLY_STRING
 ||

2445 
r
->
–em’t
[2]->
ty³
 !ğ
REDIS_REPLY_STRING
 ||

2446 
	`¡rcmp
(
r
->
–em’t
[0]->
¡r
,"message") != 0) ;

2449 ià(
	`¡r¡r
(
r
->
–em’t
[2]->
¡r
,
£Áš–
.
myid
è!ğ
NULL
) ;

2451 
	`£Áš–ProûssH–loMes§ge
(
r
->
–em’t
[2]->
¡r
,„->–em’t[2]->
Ën
);

2452 
	}
}

2465 
	$£Áš–S’dH–lo
(
£Áš–RedisIn¡ªû
 *
ri
) {

2466 

[
NET_IP_STR_LEN
];

2467 
·ylßd
[
NET_IP_STR_LEN
+1024];

2468 
»tv®
;

2469 *
ªnounû_
;

2470 
ªnounû_pÜt
;

2471 
£Áš–RedisIn¡ªû
 *
ma¡”
 = (
ri
->
æags
 & 
SRI_MASTER
) ?„i :„i->master;

2472 
£Áš–Addr
 *
ma¡”_addr
 = 
	`£Áš–G‘Cu¼’tMa¡”Add»ss
(
ma¡”
);

2474 ià(
ri
->
lšk
->
discÚÃùed
è 
C_ERR
;

2478 ià(
£Áš–
.
ªnounû_
) {

2479 
ªnounû_
 = 
£Áš–
.announce_ip;

2481 ià(
	`ª‘SockName
(
ri
->
lšk
->
cc
->
c
.
fd
,

,(),
NULL
) == -1)

2482  
C_ERR
;

2483 
ªnounû_
 = 

;

2485 
ªnounû_pÜt
 = 
£Áš–
.announce_port ?

2486 
£Áš–
.
ªnounû_pÜt
 : 
£rv”
.
pÜt
;

2489 
	`¢´štf
(
·ylßd
,(payload),

2492 
ªnounû_
, 
ªnounû_pÜt
, 
£Áš–
.
myid
,

2493 (è
£Áš–
.
cu¼’t_•och
,

2495 
ma¡”
->
Çme
,
ma¡”_addr
->

,ma¡”_addr->
pÜt
,

2496 (è
ma¡”
->
cÚfig_•och
);

2497 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

2498 
£Áš–PublishR•lyC®lback
, 
ri
, "PUBLISH %s %s",

2499 
SENTINEL_HELLO_CHANNEL
,
·ylßd
);

2500 ià(
»tv®
 !ğ
C_OK
è 
C_ERR
;

2501 
ri
->
lšk
->
³ndšg_commªds
++;

2502  
C_OK
;

2503 
	}
}

2507 
	$£Áš–FÜûH–loUpd©eDiùOfRedisIn¡ªûs
(
diù
 *
š¡ªûs
) {

2508 
diùI‹¿tÜ
 *
di
;

2509 
diùEÁry
 *
de
;

2511 
di
 = 
	`diùG‘SaãI‹¿tÜ
(
š¡ªûs
);

2512 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2513 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

2514 ià(
ri
->
Ï¡_pub_time
 >ğ(
SENTINEL_PUBLISH_PERIOD
+1))

2515 
ri
->
Ï¡_pub_time
 -ğ(
SENTINEL_PUBLISH_PERIOD
+1);

2517 
	`diùR–—£I‹¿tÜ
(
di
);

2518 
	}
}

2528 
	$£Áš–FÜûH–loUpd©eFÜMa¡”
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

2529 ià(!(
ma¡”
->
æags
 & 
SRI_MASTER
)è 
C_ERR
;

2530 ià(
ma¡”
->
Ï¡_pub_time
 >ğ(
SENTINEL_PUBLISH_PERIOD
+1))

2531 
ma¡”
->
Ï¡_pub_time
 -ğ(
SENTINEL_PUBLISH_PERIOD
+1);

2532 
	`£Áš–FÜûH–loUpd©eDiùOfRedisIn¡ªûs
(
ma¡”
->
£Áš–s
);

2533 
	`£Áš–FÜûH–loUpd©eDiùOfRedisIn¡ªûs
(
ma¡”
->
¦aves
);

2534  
C_OK
;

2535 
	}
}

2542 
	$£Áš–S’dPšg
(
£Áš–RedisIn¡ªû
 *
ri
) {

2543 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

2544 
£Áš–PšgR•lyC®lback
, 
ri
, "PING");

2545 ià(
»tv®
 =ğ
C_OK
) {

2546 
ri
->
lšk
->
³ndšg_commªds
++;

2547 
ri
->
lšk
->
Ï¡_pšg_time
 = 
	`m¡ime
();

2551 ià(
ri
->
lšk
->
aù_pšg_time
 == 0)

2552 
ri
->
lšk
->
aù_pšg_time
 =„i->lšk->
Ï¡_pšg_time
;

2557 
	}
}

2561 
	$£Áš–S’dP”iodicCommªds
(
£Áš–RedisIn¡ªû
 *
ri
) {

2562 
m¡ime_t
 
now
 = 
	`m¡ime
();

2563 
m¡ime_t
 
šfo_³riod
, 
pšg_³riod
;

2564 
»tv®
;

2568 ià(
ri
->
lšk
->
discÚÃùed
) ;

2576 ià(
ri
->
lšk
->
³ndšg_commªds
 >=

2577 
SENTINEL_MAX_PENDING_COMMANDS
 * 
ri
->
lšk
->
»fcouÁ
) ;

2587 ià((
ri
->
æags
 & 
SRI_SLAVE
) &&

2588 ((
ri
->
ma¡”
->
æags
 & (
SRI_O_DOWN
|
SRI_FAILOVER_IN_PROGRESS
)) ||

2589 (
ri
->
ma¡”_lšk_down_time
 != 0)))

2591 
šfo_³riod
 = 1000;

2593 
šfo_³riod
 = 
SENTINEL_INFO_PERIOD
;

2599 
pšg_³riod
 = 
ri
->
down_aá”_³riod
;

2600 ià(
pšg_³riod
 > 
SENTINEL_PING_PERIOD
)…ing_period = SENTINEL_PING_PERIOD;

2602 ià((
ri
->
æags
 & 
SRI_SENTINEL
) == 0 &&

2603 (
ri
->
šfo_»äesh
 == 0 ||

2604 (
now
 - 
ri
->
šfo_»äesh
è> 
šfo_³riod
))

2607 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

2608 
£Áš–InfoR•lyC®lback
, 
ri
, "INFO");

2609 ià(
»tv®
 =ğ
C_OK
è
ri
->
lšk
->
³ndšg_commªds
++;

2610 } ià((
now
 - 
ri
->
lšk
->
Ï¡_pÚg_time
è> 
pšg_³riod
 &&

2611 (
now
 - 
ri
->
lšk
->
Ï¡_pšg_time
è> 
pšg_³riod
/2) {

2613 
	`£Áš–S’dPšg
(
ri
);

2614 } ià((
now
 - 
ri
->
Ï¡_pub_time
è> 
SENTINEL_PUBLISH_PERIOD
) {

2616 
	`£Áš–S’dH–lo
(
ri
);

2618 
	}
}

2622 cÚ¡ *
	$£Áš–Faov”S‹SŒ
(
¡©e
) {

2623 
¡©e
) {

2624 
SENTINEL_FAILOVER_STATE_NONE
:  "none";

2625 
SENTINEL_FAILOVER_STATE_WAIT_START
:  "wait_start";

2626 
SENTINEL_FAILOVER_STATE_SELECT_SLAVE
:  "select_slave";

2627 
SENTINEL_FAILOVER_STATE_SEND_SLAVEOF_NOONE
:  "send_slaveof_noone";

2628 
SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
:  "wait_promotion";

2629 
SENTINEL_FAILOVER_STATE_RECONF_SLAVES
:  "reconf_slaves";

2630 
SENTINEL_FAILOVER_STATE_UPDATE_CONFIG
:  "update_config";

2633 
	}
}

2636 
	$addR•lyS’tš–RedisIn¡ªû
(
ş›Á
 *
c
, 
£Áš–RedisIn¡ªû
 *
ri
) {

2637 *
æags
 = 
	`sd£m±y
();

2638 *
mbl
;

2639 
f›lds
 = 0;

2641 
mbl
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2643 
	`addR•lyBulkCSŒšg
(
c
,"name");

2644 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
Çme
);

2645 
f›lds
++;

2647 
	`addR•lyBulkCSŒšg
(
c
,"ip");

2648 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
addr
->

);

2649 
f›lds
++;

2651 
	`addR•lyBulkCSŒšg
(
c
,"port");

2652 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
addr
->
pÜt
);

2653 
f›lds
++;

2655 
	`addR•lyBulkCSŒšg
(
c
,"runid");

2656 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
runid
 ?„i->runid : "");

2657 
f›lds
++;

2659 
	`addR•lyBulkCSŒšg
(
c
,"flags");

2660 ià(
ri
->
æags
 & 
SRI_S_DOWN
èæag ğ
	`sdsÿt
(flags,"s_down,");

2661 ià(
ri
->
æags
 & 
SRI_O_DOWN
èæag ğ
	`sdsÿt
(flags,"o_down,");

2662 ià(
ri
->
æags
 & 
SRI_MASTER
èæag ğ
	`sdsÿt
(flags,"master,");

2663 ià(
ri
->
æags
 & 
SRI_SLAVE
èæag ğ
	`sdsÿt
(flags,"slave,");

2664 ià(
ri
->
æags
 & 
SRI_SENTINEL
èæag ğ
	`sdsÿt
(flags,"sentinel,");

2665 ià(
ri
->
lšk
->
discÚÃùed
è
æags
 = 
	`sdsÿt
(flags,"disconnected,");

2666 ià(
ri
->
æags
 & 
SRI_MASTER_DOWN
èæag ğ
	`sdsÿt
(flags,"master_down,");

2667 ià(
ri
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
)

2668 
æags
 = 
	`sdsÿt
(flags,"failover_in_progress,");

2669 ià(
ri
->
æags
 & 
SRI_PROMOTED
èæag ğ
	`sdsÿt
(flags,"promoted,");

2670 ià(
ri
->
æags
 & 
SRI_RECONF_SENT
èæag ğ
	`sdsÿt
(flags,"reconf_sent,");

2671 ià(
ri
->
æags
 & 
SRI_RECONF_INPROG
èæag ğ
	`sdsÿt
(flags,"reconf_inprog,");

2672 ià(
ri
->
æags
 & 
SRI_RECONF_DONE
èæag ğ
	`sdsÿt
(flags,"reconf_done,");

2674 ià(
	`sd¦’
(
æags
è!ğ0è
	`sd¤ªge
(flags,0,-2);

2675 
	`addR•lyBulkCSŒšg
(
c
,
æags
);

2676 
	`sdsä“
(
æags
);

2677 
f›lds
++;

2679 
	`addR•lyBulkCSŒšg
(
c
,"link-pending-commands");

2680 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
lšk
->
³ndšg_commªds
);

2681 
f›lds
++;

2683 
	`addR•lyBulkCSŒšg
(
c
,"link-refcount");

2684 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
lšk
->
»fcouÁ
);

2685 
f›lds
++;

2687 ià(
ri
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
) {

2688 
	`addR•lyBulkCSŒšg
(
c
,"failover-state");

2689 
	`addR•lyBulkCSŒšg
(
c
,(*)
	`£Áš–Faov”S‹SŒ
(
ri
->
çov”_¡©e
));

2690 
f›lds
++;

2693 
	`addR•lyBulkCSŒšg
(
c
,"last-ping-sent");

2694 
	`addR•lyBulkLÚgLÚg
(
c
,

2695 
ri
->
lšk
->
aù_pšg_time
 ? (
	`m¡ime
() -„i->link->act_ping_time) : 0);

2696 
f›lds
++;

2698 
	`addR•lyBulkCSŒšg
(
c
,"last-ok-ping-reply");

2699 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
ri
->
lšk
->
Ï¡_ava_time
);

2700 
f›lds
++;

2702 
	`addR•lyBulkCSŒšg
(
c
,"last-ping-reply");

2703 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
ri
->
lšk
->
Ï¡_pÚg_time
);

2704 
f›lds
++;

2706 ià(
ri
->
æags
 & 
SRI_S_DOWN
) {

2707 
	`addR•lyBulkCSŒšg
(
c
,"s-down-time");

2708 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
()-
ri
->
s_down_sšû_time
);

2709 
f›lds
++;

2712 ià(
ri
->
æags
 & 
SRI_O_DOWN
) {

2713 
	`addR•lyBulkCSŒšg
(
c
,"o-down-time");

2714 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
()-
ri
->
o_down_sšû_time
);

2715 
f›lds
++;

2718 
	`addR•lyBulkCSŒšg
(
c
,"down-after-milliseconds");

2719 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
down_aá”_³riod
);

2720 
f›lds
++;

2723 ià(
ri
->
æags
 & (
SRI_MASTER
|
SRI_SLAVE
)) {

2724 
	`addR•lyBulkCSŒšg
(
c
,"info-refresh");

2725 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
ri
->
šfo_»äesh
);

2726 
f›lds
++;

2728 
	`addR•lyBulkCSŒšg
(
c
,"role-reported");

2729 
	`addR•lyBulkCSŒšg
(
c
, (
ri
->
rŞe_»pÜ‹d
 =ğ
SRI_MASTER
) ? "master" :

2731 
f›lds
++;

2733 
	`addR•lyBulkCSŒšg
(
c
,"role-reported-time");

2734 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
ri
->
rŞe_»pÜ‹d_time
);

2735 
f›lds
++;

2739 ià(
ri
->
æags
 & 
SRI_MASTER
) {

2740 
	`addR•lyBulkCSŒšg
(
c
,"config-epoch");

2741 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
cÚfig_•och
);

2742 
f›lds
++;

2744 
	`addR•lyBulkCSŒšg
(
c
,"num-slaves");

2745 
	`addR•lyBulkLÚgLÚg
(
c
,
	`diùSize
(
ri
->
¦aves
));

2746 
f›lds
++;

2748 
	`addR•lyBulkCSŒšg
(
c
,"num-other-sentinels");

2749 
	`addR•lyBulkLÚgLÚg
(
c
,
	`diùSize
(
ri
->
£Áš–s
));

2750 
f›lds
++;

2752 
	`addR•lyBulkCSŒšg
(
c
,"quorum");

2753 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
quÜum
);

2754 
f›lds
++;

2756 
	`addR•lyBulkCSŒšg
(
c
,"failover-timeout");

2757 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
çov”_timeout
);

2758 
f›lds
++;

2760 
	`addR•lyBulkCSŒšg
(
c
,"parallel-syncs");

2761 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
·¿Î–_syncs
);

2762 
f›lds
++;

2764 ià(
ri
->
nÙifiÿtiÚ_süt
) {

2765 
	`addR•lyBulkCSŒšg
(
c
,"notification-script");

2766 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
nÙifiÿtiÚ_süt
);

2767 
f›lds
++;

2770 ià(
ri
->
ş›Á_»cÚfig_süt
) {

2771 
	`addR•lyBulkCSŒšg
(
c
,"client-reconfig-script");

2772 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
ş›Á_»cÚfig_süt
);

2773 
f›lds
++;

2778 ià(
ri
->
æags
 & 
SRI_SLAVE
) {

2779 
	`addR•lyBulkCSŒšg
(
c
,"master-link-down-time");

2780 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
ma¡”_lšk_down_time
);

2781 
f›lds
++;

2783 
	`addR•lyBulkCSŒšg
(
c
,"master-link-status");

2784 
	`addR•lyBulkCSŒšg
(
c
,

2785 (
ri
->
¦ave_ma¡”_lšk_¡©us
 =ğ
SENTINEL_MASTER_LINK_STATUS_UP
) ?

2787 
f›lds
++;

2789 
	`addR•lyBulkCSŒšg
(
c
,"master-host");

2790 
	`addR•lyBulkCSŒšg
(
c
,

2791 
ri
->
¦ave_ma¡”_ho¡
 ?„i->slave_master_host : "?");

2792 
f›lds
++;

2794 
	`addR•lyBulkCSŒšg
(
c
,"master-port");

2795 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
¦ave_ma¡”_pÜt
);

2796 
f›lds
++;

2798 
	`addR•lyBulkCSŒšg
(
c
,"slave-priority");

2799 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
¦ave_´iÜ™y
);

2800 
f›lds
++;

2802 
	`addR•lyBulkCSŒšg
(
c
,"slave-repl-offset");

2803 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
¦ave_»¶_off£t
);

2804 
f›lds
++;

2808 ià(
ri
->
æags
 & 
SRI_SENTINEL
) {

2809 
	`addR•lyBulkCSŒšg
(
c
,"last-hello-message");

2810 
	`addR•lyBulkLÚgLÚg
(
c
,
	`m¡ime
(è- 
ri
->
Ï¡_h–lo_time
);

2811 
f›lds
++;

2813 
	`addR•lyBulkCSŒšg
(
c
,"voted-leader");

2814 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
Ëad”
 ?„i->leader : "?");

2815 
f›lds
++;

2817 
	`addR•lyBulkCSŒšg
(
c
,"voted-leader-epoch");

2818 
	`addR•lyBulkLÚgLÚg
(
c
,
ri
->
Ëad”_•och
);

2819 
f›lds
++;

2822 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
mbl
,
f›lds
*2);

2823 
	}
}

2827 
	$addR•lyDiùOfRedisIn¡ªûs
(
ş›Á
 *
c
, 
diù
 *
š¡ªûs
) {

2828 
diùI‹¿tÜ
 *
di
;

2829 
diùEÁry
 *
de
;

2831 
di
 = 
	`diùG‘I‹¿tÜ
(
š¡ªûs
);

2832 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
š¡ªûs
));

2833 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2834 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

2836 
	`addR•lyS’tš–RedisIn¡ªû
(
c
,
ri
);

2838 
	`diùR–—£I‹¿tÜ
(
di
);

2839 
	}
}

2844 
£Áš–RedisIn¡ªû
 *
	$£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
ş›Á
 *
c
,

2845 
robj
 *
Çme
)

2847 
£Áš–RedisIn¡ªû
 *
ri
;

2849 
ri
 = 
	`diùF‘chV®ue
(
£Áš–
.
ma¡”s
,
Çme
->
±r
);

2850 ià(!
ri
) {

2851 
	`addR•lyE¼Ü
(
c
,"No such master withhat‚ame");

2852  
NULL
;

2854  
ri
;

2855 
	}
}

2857 
	#SENTINEL_ISQR_OK
 0

	)

2858 
	#SENTINEL_ISQR_NOQUORUM
 (1<<0)

	)

2859 
	#SENTINEL_ISQR_NOAUTH
 (1<<1)

	)

2860 
	$£Áš–IsQuÜumR—chabË
(
£Áš–RedisIn¡ªû
 *
ma¡”
, *
u§bË±r
) {

2861 
diùI‹¿tÜ
 *
di
;

2862 
diùEÁry
 *
de
;

2863 
u§bË
 = 1;

2864 
»suÉ
 = 
SENTINEL_ISQR_OK
;

2865 
vÙ”s
 = 
	`diùSize
(
ma¡”
->
£Áš–s
)+1;

2867 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
£Áš–s
);

2868 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2869 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

2871 ià(
ri
->
æags
 & (
SRI_S_DOWN
|
SRI_O_DOWN
)) ;

2872 
u§bË
++;

2874 
	`diùR–—£I‹¿tÜ
(
di
);

2876 ià(
u§bË
 < ()
ma¡”
->
quÜum
è
»suÉ
 |ğ
SENTINEL_ISQR_NOQUORUM
;

2877 ià(
u§bË
 < 
vÙ”s
/2+1è
»suÉ
 |ğ
SENTINEL_ISQR_NOAUTH
;

2878 ià(
u§bË±r
è*u§bË±¸ğ
u§bË
;

2879  
»suÉ
;

2880 
	}
}

2882 
	$£Áš–Commªd
(
ş›Á
 *
c
) {

2883 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"masters")) {

2885 ià(
c
->
¬gc
 !ğ2è
num¬g£¼
;

2886 
	`addR•lyDiùOfRedisIn¡ªûs
(
c
,
£Áš–
.
ma¡”s
);

2887 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"master")) {

2889 
£Áš–RedisIn¡ªû
 *
ri
;

2891 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2892 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2]))

2893 =ğ
NULL
) ;

2894 
	`addR•lyS’tš–RedisIn¡ªû
(
c
,
ri
);

2895 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"slaves")) {

2897 
£Áš–RedisIn¡ªû
 *
ri
;

2899 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2900 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2])è=ğ
NULL
)

2902 
	`addR•lyDiùOfRedisIn¡ªûs
(
c
,
ri
->
¦aves
);

2903 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"sentinels")) {

2905 
£Áš–RedisIn¡ªû
 *
ri
;

2907 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2908 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2])è=ğ
NULL
)

2910 
	`addR•lyDiùOfRedisIn¡ªûs
(
c
,
ri
->
£Áš–s
);

2911 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"is-master-down-by-addr")) {

2929 
£Áš–RedisIn¡ªû
 *
ri
;

2930 
»q_•och
;

2931 
ušt64_t
 
Ëad”_•och
 = 0;

2932 *
Ëad”
 = 
NULL
;

2933 
pÜt
;

2934 
isdown
 = 0;

2936 ià(
c
->
¬gc
 !ğ6è
num¬g£¼
;

2937 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
pÜt
,
NULL
è!ğ
C_OK
 ||

2938 
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[4],&
»q_•och
,
NULL
)

2939 !ğ
C_OK
)

2941 
ri
 = 
	`g‘S’tš–RedisIn¡ªûByAddrAndRunID
(
£Áš–
.
ma¡”s
,

2942 
c
->
¬gv
[2]->
±r
,
pÜt
,
NULL
);

2946 ià(!
£Áš–
.
tt
 && 
ri
 && (ri->
æags
 & 
SRI_S_DOWN
) &&

2947 (
ri
->
æags
 & 
SRI_MASTER
))

2948 
isdown
 = 1;

2952 ià(
ri
 &&„i->
æags
 & 
SRI_MASTER
 && 
	`¡rÿ£cmp
(
c
->
¬gv
[5]->
±r
,"*")) {

2953 
Ëad”
 = 
	`£Áš–VÙeL—d”
(
ri
,(
ušt64_t
)
»q_•och
,

2954 
c
->
¬gv
[5]->
±r
,

2955 &
Ëad”_•och
);

2960 
	`addR•lyMuÉiBulkL’
(
c
,3);

2961 
	`addR•ly
(
c
, 
isdown
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

2962 
	`addR•lyBulkCSŒšg
(
c
, 
Ëad”
 ?†eader : "*");

2963 
	`addR•lyLÚgLÚg
(
c
, ()
Ëad”_•och
);

2964 ià(
Ëad”
è
	`sdsä“
(leader);

2965 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"reset")) {

2967 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2968 
	`addR•lyLÚgLÚg
(
c
,
	`£Áš–Re£tMa¡”sByP©‹º
(c->
¬gv
[2]->
±r
,
SENTINEL_GENERATE_EVENT
));

2969 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"get-master-addr-by-name")) {

2971 
£Áš–RedisIn¡ªû
 *
ri
;

2973 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2974 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
c
->
¬gv
[2]->
±r
);

2975 ià(
ri
 =ğ
NULL
) {

2976 
	`addR•ly
(
c
,
sh¬ed
.
nuÎmuÉibulk
);

2978 
£Áš–Addr
 *
addr
 = 
	`£Áš–G‘Cu¼’tMa¡”Add»ss
(
ri
);

2980 
	`addR•lyMuÉiBulkL’
(
c
,2);

2981 
	`addR•lyBulkCSŒšg
(
c
,
addr
->

);

2982 
	`addR•lyBulkLÚgLÚg
(
c
,
addr
->
pÜt
);

2984 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"failover")) {

2986 
£Áš–RedisIn¡ªû
 *
ri
;

2988 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

2989 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2])è=ğ
NULL
)

2991 ià(
ri
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
) {

2992 
	`addR•lySds
(
c
,
	`sd¢ew
("-INPROG Failover‡lready in…rogress\r\n"));

2995 ià(
	`£Áš–S–eùSÏve
(
ri
è=ğ
NULL
) {

2996 
	`addR•lySds
(
c
,
	`sd¢ew
("-NOGOODSLAVE No suitable slaveo…romote\r\n"));

2999 
	`£rv”Log
(
LL_WARNING
,"Executing user„equested FAILOVER of '%s'",

3000 
ri
->
Çme
);

3001 
	`£Áš–S¹Faov”
(
ri
);

3002 
ri
->
æags
 |ğ
SRI_FORCE_FAILOVER
;

3003 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3004 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"pending-scripts")) {

3007 ià(
c
->
¬gc
 !ğ2è
num¬g£¼
;

3008 
	`£Áš–P’dšgSütsCommªd
(
c
);

3009 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"monitor")) {

3011 
£Áš–RedisIn¡ªû
 *
ri
;

3012 
quÜum
, 
pÜt
;

3013 

[
NET_IP_STR_LEN
];

3015 ià(
c
->
¬gc
 !ğ6è
num¬g£¼
;

3016 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[5],&
quÜum
,"Invalid quorum")

3017 !ğ
C_OK
) ;

3018 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[4],&
pÜt
,"Invalid…ort")

3019 !ğ
C_OK
) ;

3021 ià(
quÜum
 <= 0) {

3022 
	`addR•lyE¼Ü
(
c
, "Quorum must be 1 or greater.");

3029 ià(
	`ª‘ResŞveIP
(
NULL
,
c
->
¬gv
[3]->
±r
,

,()è=ğ
ANET_ERR
) {

3030 
	`addR•lyE¼Ü
(
c
,"Invalid IP‡ddress specified");

3035 
ri
 = 
	`ü—‹S’tš–RedisIn¡ªû
(
c
->
¬gv
[2]->
±r
,
SRI_MASTER
,

3036 
c
->
¬gv
[3]->
±r
,
pÜt
,
quÜum
,
NULL
);

3037 ià(
ri
 =ğ
NULL
) {

3038 
”ºo
) {

3039 
EBUSY
:

3040 
	`addR•lyE¼Ü
(
c
,"Duplicated master‚ame");

3042 
EINVAL
:

3043 
	`addR•lyE¼Ü
(
c
,"Invalid…ort‚umber");

3046 
	`addR•lyE¼Ü
(
c
,"Unspecifiedƒrror‡ddinghe instance");

3050 
	`£Áš–FlushCÚfig
();

3051 
	`£Áš–Ev’t
(
LL_WARNING
,"+mÚ™Ü",
ri
,"%@ quÜum %d",ri->
quÜum
);

3052 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3054 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"flushconfig")) {

3055 ià(
c
->
¬gc
 !ğ2è
num¬g£¼
;

3056 
	`£Áš–FlushCÚfig
();

3057 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3059 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"remove")) {

3061 
£Áš–RedisIn¡ªû
 *
ri
;

3063 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

3064 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2]))

3065 =ğ
NULL
) ;

3066 
	`£Áš–Ev’t
(
LL_WARNING
,"-mÚ™Ü",
ri
,"%@");

3067 
	`diùD–‘e
(
£Áš–
.
ma¡”s
,
c
->
¬gv
[2]->
±r
);

3068 
	`£Áš–FlushCÚfig
();

3069 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3070 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"ckquorum")) {

3072 
£Áš–RedisIn¡ªû
 *
ri
;

3073 
u§bË
;

3075 ià(
c
->
¬gc
 !ğ3è
num¬g£¼
;

3076 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2]))

3077 =ğ
NULL
) ;

3078 
»suÉ
 = 
	`£Áš–IsQuÜumR—chabË
(
ri
,&
u§bË
);

3079 ià(
»suÉ
 =ğ
SENTINEL_ISQR_OK
) {

3080 
	`addR•lySds
(
c
, 
	`sdsÿtfmt
(
	`sd£m±y
(),

3082 "ÿÀb»ached\r\n",
u§bË
));

3084 
sds
 
e
 = 
	`sdsÿtfmt
(
	`sd£m±y
(),

3085 "-NOQUORUM %˜u§bË S’tš–s. ",
u§bË
);

3086 ià(
»suÉ
 & 
SENTINEL_ISQR_NOQUORUM
)

3087 
e
 = 
	`sdsÿt
(e,"Notƒnough‡vailable Sentinelso„eachhe"

3089 ià(
»suÉ
 & 
SENTINEL_ISQR_NOAUTH
) {

3090 ià(
»suÉ
 & 
SENTINEL_ISQR_NOQUORUM
è
e
 = 
	`sdsÿt
(e,". ");

3091 
e
 = 
	`sdsÿt
(e, "Notƒnough‡vailable Sentinelso„eachhe"

3094 
e
 = 
	`sdsÿt
(e,"\r\n");

3095 
	`addR•lySds
(
c
,
e
);

3097 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"set")) {

3098 ià(
c
->
¬gc
 < 3 || c->¬gø% 2 =ğ0è
num¬g£¼
;

3099 
	`£Áš–S‘Commªd
(
c
);

3100 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"info-cache")) {

3102 ià(
c
->
¬gc
 < 2è
num¬g£¼
;

3103 
m¡ime_t
 
now
 = 
	`m¡ime
();

3108 
diùTy³
 
cİy_k“³r
 = 
š¡ªûsDiùTy³
;

3109 
cİy_k“³r
.
v®De¡ruùÜ
 = 
NULL
;

3110 
diù
 *
ma¡”s_loÿl
 = 
£Áš–
.
ma¡”s
;

3111 ià(
c
->
¬gc
 > 2) {

3112 
ma¡”s_loÿl
 = 
	`diùC»©e
(&
cİy_k“³r
, 
NULL
);

3114 
i
 = 2; i < 
c
->
¬gc
; i++) {

3115 
£Áš–RedisIn¡ªû
 *
ri
;

3116 
ri
 = 
	`£Áš–G‘Ma¡”ByName
(
c
->
¬gv
[
i
]->
±r
);

3117 ià(!
ri
) ;

3118 
	`diùAdd
(
ma¡”s_loÿl
, 
ri
->
Çme
,„i);

3130 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
ma¡”s_loÿl
) * 2);

3132 
diùI‹¿tÜ
 *
di
;

3133 
diùEÁry
 *
de
;

3134 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”s_loÿl
);

3135 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3136 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3137 
	`addR•lyBulkCBufãr
(
c
,
ri
->
Çme
,
	`¡¾’
(ri->name));

3138 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
ri
->
¦aves
) + 1);

3139 
	`addR•lyMuÉiBulkL’
(
c
,2);

3140 
	`addR•lyLÚgLÚg
(
c
, 
now
 - 
ri
->
šfo_»äesh
);

3141 ià(
ri
->
šfo
)

3142 
	`addR•lyBulkCBufãr
(
c
,
ri
->
šfo
,
	`sd¦’
(ri->info));

3144 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

3146 
diùI‹¿tÜ
 *
sdi
;

3147 
diùEÁry
 *
sde
;

3148 
sdi
 = 
	`diùG‘I‹¿tÜ
(
ri
->
¦aves
);

3149 (
sde
 = 
	`diùNext
(
sdi
)è!ğ
NULL
) {

3150 
£Áš–RedisIn¡ªû
 *
¤i
 = 
	`diùG‘V®
(
sde
);

3151 
	`addR•lyMuÉiBulkL’
(
c
,2);

3152 
	`addR•lyLÚgLÚg
(
c
, 
now
 - 
¤i
->
šfo_»äesh
);

3153 ià(
¤i
->
šfo
)

3154 
	`addR•lyBulkCBufãr
(
c
,
¤i
->
šfo
,
	`sd¦’
(sri->info));

3156 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

3158 
	`diùR–—£I‹¿tÜ
(
sdi
);

3160 
	`diùR–—£I‹¿tÜ
(
di
);

3161 ià(
ma¡”s_loÿl
 !ğ
£Áš–
.
ma¡”s
è
	`diùR–—£
(masters_local);

3162 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"simulate-failure")) {

3164 
j
;

3166 
£Áš–
.
simçu»_æags
 = 
SENTINEL_SIMFAILURE_NONE
;

3167 
j
 = 2; j < 
c
->
¬gc
; j++) {

3168 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"crash-after-election")) {

3169 
£Áš–
.
simçu»_æags
 |=

3170 
SENTINEL_SIMFAILURE_CRASH_AFTER_ELECTION
;

3171 
	`£rv”Log
(
LL_WARNING
,"Failure simulation:his Sentinel "

3174 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"crash-after-promotion")) {

3175 
£Áš–
.
simçu»_æags
 |=

3176 
SENTINEL_SIMFAILURE_CRASH_AFTER_PROMOTION
;

3177 
	`£rv”Log
(
LL_WARNING
,"Failure simulation:his Sentinel "

3179 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"help")) {

3180 
	`addR•lyMuÉiBulkL’
(
c
,2);

3181 
	`addR•lyBulkCSŒšg
(
c
,"crash-after-election");

3182 
	`addR•lyBulkCSŒšg
(
c
,"crash-after-promotion");

3184 
	`addR•lyE¼Ü
(
c
,"Unknown failure simulation specified");

3188 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3190 
	`addR•lyE¼ÜFÜm©
(
c
,"Unknown sentinel subcommand '%s'",

3191 (*)
c
->
¬gv
[1]->
±r
);

3195 
num¬g£¼
:

3196 
	`addR•lyE¼ÜFÜm©
(
c
,"Wrong‚umber of‡rguments for 'sentinel %s'",

3197 (*)
c
->
¬gv
[1]->
±r
);

3198 
	}
}

3200 
	#šfo_£ùiÚ_äom_»dis
(
£ùiÚ_Çme
) do { \

3201 ià(
def£ùiÚs
 || 
®l£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,
£ùiÚ_Çme
)) { \

3202 
sds
 
»dis£ùiÚ
; \

3203 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n"); \

3204 
»dis£ùiÚ
 = 
	`g’RedisInfoSŒšg
(
£ùiÚ_Çme
); \

3205 
šfo
 = 
	`sdsÿ’
(šfo,
»dis£ùiÚ
,
	`sd¦’
(redissection)); \

3206 
	`sdsä“
(
»dis£ùiÚ
); \

3208 } 0)

	)

3211 
	$£Áš–InfoCommªd
(
ş›Á
 *
c
) {

3212 ià(
c
->
¬gc
 > 2) {

3213 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

3217 
def£ùiÚs
 = 0, 
®l£ùiÚs
 = 0;

3218 *
£ùiÚ
 = 
c
->
¬gc
 =ğ2 ? c->
¬gv
[1]->
±r
 : 
NULL
;

3219 ià(
£ùiÚ
) {

3220 
®l£ùiÚs
 = !
	`¡rÿ£cmp
(
£ùiÚ
,"all");

3221 
def£ùiÚs
 = !
	`¡rÿ£cmp
(
£ùiÚ
,"default");

3223 
def£ùiÚs
 = 1;

3226 
£ùiÚs
 = 0;

3227 
sds
 
šfo
 = 
	`sd£m±y
();

3229 
	`šfo_£ùiÚ_äom_»dis
("server");

3230 
	`šfo_£ùiÚ_äom_»dis
("clients");

3231 
	`šfo_£ùiÚ_äom_»dis
("cpu");

3232 
	`šfo_£ùiÚ_äom_»dis
("stats");

3234 ià(
def£ùiÚs
 || 
®l£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"sentinel")) {

3235 
diùI‹¿tÜ
 *
di
;

3236 
diùEÁry
 *
de
;

3237 
ma¡”_id
 = 0;

3239 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3240 
šfo
 = 
	`sdsÿrštf
(info,

3247 
	`diùSize
(
£Áš–
.
ma¡”s
),

3248 
£Áš–
.
tt
,

3249 
£Áš–
.
ruÂšg_süts
,

3250 
	`li¡L’gth
(
£Áš–
.
süts_queue
),

3251 
£Áš–
.
simçu»_æags
);

3253 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

3254 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3255 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3256 *
¡©us
 = "ok";

3258 ià(
ri
->
æags
 & 
SRI_O_DOWN
è
¡©us
 = "odown";

3259 ià(
ri
->
æags
 & 
SRI_S_DOWN
è
¡©us
 = "sdown";

3260 
šfo
 = 
	`sdsÿrštf
(info,

3263 
ma¡”_id
++, 
ri
->
Çme
, 
¡©us
,

3264 
ri
->
addr
->

,„i->addr->
pÜt
,

3265 
	`diùSize
(
ri
->
¦aves
),

3266 
	`diùSize
(
ri
->
£Áš–s
)+1);

3268 
	`diùR–—£I‹¿tÜ
(
di
);

3271 
	`addR•lyBulkSds
(
c
, 
šfo
);

3272 
	}
}

3276 
	$£Áš–RŞeCommªd
(
ş›Á
 *
c
) {

3277 
diùI‹¿tÜ
 *
di
;

3278 
diùEÁry
 *
de
;

3280 
	`addR•lyMuÉiBulkL’
(
c
,2);

3281 
	`addR•lyBulkCBufãr
(
c
,"sentinel",8);

3282 
	`addR•lyMuÉiBulkL’
(
c
,
	`diùSize
(
£Áš–
.
ma¡”s
));

3284 
di
 = 
	`diùG‘I‹¿tÜ
(
£Áš–
.
ma¡”s
);

3285 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3286 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3288 
	`addR•lyBulkCSŒšg
(
c
,
ri
->
Çme
);

3290 
	`diùR–—£I‹¿tÜ
(
di
);

3291 
	}
}

3294 
	$£Áš–S‘Commªd
(
ş›Á
 *
c
) {

3295 
£Áš–RedisIn¡ªû
 *
ri
;

3296 
j
, 
chªges
 = 0;

3297 *
İtiÚ
, *
v®ue
;

3299 ià((
ri
 = 
	`£Áš–G‘Ma¡”ByNameOrR•lyE¼Ü
(
c
,c->
¬gv
[2]))

3300 =ğ
NULL
) ;

3303 
j
 = 3; j < 
c
->
¬gc
; j += 2) {

3304 
İtiÚ
 = 
c
->
¬gv
[
j
]->
±r
;

3305 
v®ue
 = 
c
->
¬gv
[
j
+1]->
±r
;

3306 
robj
 *
o
 = 
c
->
¬gv
[
j
+1];

3307 
Î
;

3309 ià(!
	`¡rÿ£cmp
(
İtiÚ
,"down-after-milliseconds")) {

3311 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
 ||†l <= 0)

3312 
badfmt
;

3313 
ri
->
down_aá”_³riod
 = 
Î
;

3314 
	`£Áš–Prİag©eDownAá”P”iod
(
ri
);

3315 
chªges
++;

3316 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"failover-timeout")) {

3318 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
 ||†l <= 0)

3319 
badfmt
;

3320 
ri
->
çov”_timeout
 = 
Î
;

3321 
chªges
++;

3322 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"parallel-syncs")) {

3324 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
 ||†l <= 0)

3325 
badfmt
;

3326 
ri
->
·¿Î–_syncs
 = 
Î
;

3327 
chªges
++;

3328 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"notification-script")) {

3330 ià(
	`¡¾’
(
v®ue
è&& 
	`acûss
(v®ue,
X_OK
) == -1) {

3331 
	`addR•lyE¼Ü
(
c
,

3333 ià(
chªges
è
	`£Áš–FlushCÚfig
();

3336 
	`sdsä“
(
ri
->
nÙifiÿtiÚ_süt
);

3337 
ri
->
nÙifiÿtiÚ_süt
 = 
	`¡¾’
(
v®ue
è? 
	`sd¢ew
(v®ueè: 
NULL
;

3338 
chªges
++;

3339 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"client-reconfig-script")) {

3341 ià(
	`¡¾’
(
v®ue
è&& 
	`acûss
(v®ue,
X_OK
) == -1) {

3342 
	`addR•lyE¼Ü
(
c
,

3345 ià(
chªges
è
	`£Áš–FlushCÚfig
();

3348 
	`sdsä“
(
ri
->
ş›Á_»cÚfig_süt
);

3349 
ri
->
ş›Á_»cÚfig_süt
 = 
	`¡¾’
(
v®ue
è? 
	`sd¢ew
(v®ueè: 
NULL
;

3350 
chªges
++;

3351 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"auth-pass")) {

3353 
	`sdsä“
(
ri
->
auth_·ss
);

3354 
ri
->
auth_·ss
 = 
	`¡¾’
(
v®ue
è? 
	`sd¢ew
(v®ueè: 
NULL
;

3355 
chªges
++;

3356 } ià(!
	`¡rÿ£cmp
(
İtiÚ
,"quorum")) {

3358 ià(
	`g‘LÚgLÚgFromObjeù
(
o
,&
Î
è=ğ
C_ERR
 ||†l <= 0)

3359 
badfmt
;

3360 
ri
->
quÜum
 = 
Î
;

3361 
chªges
++;

3363 
	`addR•lyE¼ÜFÜm©
(
c
,"Unknown option '%s' for SENTINEL SET",

3364 
İtiÚ
);

3365 ià(
chªges
è
	`£Áš–FlushCÚfig
();

3368 
	`£Áš–Ev’t
(
LL_WARNING
,"+£t",
ri
,"%@ % %s",
İtiÚ
,
v®ue
);

3371 ià(
chªges
è
	`£Áš–FlushCÚfig
();

3372 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3375 
badfmt
:

3376 ià(
chªges
è
	`£Áš–FlushCÚfig
();

3377 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid‡rgument '%s' for SENTINEL SET '%s'",

3378 
v®ue
, 
İtiÚ
);

3379 
	}
}

3387 
	$£Áš–PublishCommªd
(
ş›Á
 *
c
) {

3388 ià(
	`¡rcmp
(
c
->
¬gv
[1]->
±r
,
SENTINEL_HELLO_CHANNEL
)) {

3389 
	`addR•lyE¼Ü
(
c
, "Only HELLO messages‡re‡ccepted by Sentinel instances.");

3392 
	`£Áš–ProûssH–loMes§ge
(
c
->
¬gv
[2]->
±r
,
	`sd¦’
(c->argv[2]->ptr));

3393 
	`addR•lyLÚgLÚg
(
c
,1);

3394 
	}
}

3399 
	$£Áš–CheckSubjeùiv–yDown
(
£Áš–RedisIn¡ªû
 *
ri
) {

3400 
m¡ime_t
 
–­£d
 = 0;

3402 ià(
ri
->
lšk
->
aù_pšg_time
)

3403 
–­£d
 = 
	`m¡ime
(è- 
ri
->
lšk
->
aù_pšg_time
;

3404 ià(
ri
->
lšk
->
discÚÃùed
)

3405 
–­£d
 = 
	`m¡ime
(è- 
ri
->
lšk
->
Ï¡_ava_time
;

3413 ià(
ri
->
lšk
->
cc
 &&

3414 (
	`m¡ime
(è- 
ri
->
lšk
->
cc_cÚn_time
) >

3415 
SENTINEL_MIN_LINK_RECONNECT_PERIOD
 &&

3416 
ri
->
lšk
->
aù_pšg_time
 != 0 &&

3419 (
	`m¡ime
(è- 
ri
->
lšk
->
aù_pšg_time
è> (ri->
down_aá”_³riod
/2) &&

3420 (
	`m¡ime
(è- 
ri
->
lšk
->
Ï¡_pÚg_time
è> (ri->
down_aá”_³riod
/2))

3422 
	`š¡ªûLškClo£CÚÃùiÚ
(
ri
->
lšk
,ri->lšk->
cc
);

3430 ià(
ri
->
lšk
->
pc
 &&

3431 (
	`m¡ime
(è- 
ri
->
lšk
->
pc_cÚn_time
) >

3432 
SENTINEL_MIN_LINK_RECONNECT_PERIOD
 &&

3433 (
	`m¡ime
(è- 
ri
->
lšk
->
pc_Ï¡_aùiv™y
è> (
SENTINEL_PUBLISH_PERIOD
*3))

3435 
	`š¡ªûLškClo£CÚÃùiÚ
(
ri
->
lšk
,ri->lšk->
pc
);

3444 ià(
–­£d
 > 
ri
->
down_aá”_³riod
 ||

3445 (
ri
->
æags
 & 
SRI_MASTER
 &&

3446 
ri
->
rŞe_»pÜ‹d
 =ğ
SRI_SLAVE
 &&

3447 
	`m¡ime
(è- 
ri
->
rŞe_»pÜ‹d_time
 >

3448 (
ri
->
down_aá”_³riod
+
SENTINEL_INFO_PERIOD
*2)))

3451 ià((
ri
->
æags
 & 
SRI_S_DOWN
) == 0) {

3452 
	`£Áš–Ev’t
(
LL_WARNING
,"+sdown",
ri
,"%@");

3453 
ri
->
s_down_sšû_time
 = 
	`m¡ime
();

3454 
ri
->
æags
 |ğ
SRI_S_DOWN
;

3458 ià(
ri
->
æags
 & 
SRI_S_DOWN
) {

3459 
	`£Áš–Ev’t
(
LL_WARNING
,"-sdown",
ri
,"%@");

3460 
ri
->
æags
 &ğ~(
SRI_S_DOWN
|
SRI_SCRIPT_KILL_SENT
);

3463 
	}
}

3471 
	$£Áš–CheckObjeùiv–yDown
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

3472 
diùI‹¿tÜ
 *
di
;

3473 
diùEÁry
 *
de
;

3474 
quÜum
 = 0, 
odown
 = 0;

3476 ià(
ma¡”
->
æags
 & 
SRI_S_DOWN
) {

3478 
quÜum
 = 1;

3480 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
£Áš–s
);

3481 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3482 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3484 ià(
ri
->
æags
 & 
SRI_MASTER_DOWN
è
quÜum
++;

3486 
	`diùR–—£I‹¿tÜ
(
di
);

3487 ià(
quÜum
 >ğ
ma¡”
->quÜumè
odown
 = 1;

3491 ià(
odown
) {

3492 ià((
ma¡”
->
æags
 & 
SRI_O_DOWN
) == 0) {

3493 
	`£Áš–Ev’t
(
LL_WARNING
,"+odown",
ma¡”
,"%@ #quorum %d/%d",

3494 
quÜum
, 
ma¡”
->quorum);

3495 
ma¡”
->
æags
 |ğ
SRI_O_DOWN
;

3496 
ma¡”
->
o_down_sšû_time
 = 
	`m¡ime
();

3499 ià(
ma¡”
->
æags
 & 
SRI_O_DOWN
) {

3500 
	`£Áš–Ev’t
(
LL_WARNING
,"-odown",
ma¡”
,"%@");

3501 
ma¡”
->
æags
 &ğ~
SRI_O_DOWN
;

3504 
	}
}

3508 
	$£Áš–ReûiveIsMa¡”DownR•ly
(
»disAsyncCÚ‹xt
 *
c
, *
»¶y
, *
´ivd©a
) {

3509 
£Áš–RedisIn¡ªû
 *
ri
 = 
´ivd©a
;

3510 
š¡ªûLšk
 *
lšk
 = 
c
->
d©a
;

3511 
»disR•ly
 *
r
;

3513 ià(!
»¶y
 || !
lšk
) ;

3514 
lšk
->
³ndšg_commªds
--;

3515 
r
 = 
»¶y
;

3520 ià(
r
->
ty³
 =ğ
REDIS_REPLY_ARRAY
 &&„->
–em’ts
 == 3 &&

3521 
r
->
–em’t
[0]->
ty³
 =ğ
REDIS_REPLY_INTEGER
 &&

3522 
r
->
–em’t
[1]->
ty³
 =ğ
REDIS_REPLY_STRING
 &&

3523 
r
->
–em’t
[2]->
ty³
 =ğ
REDIS_REPLY_INTEGER
)

3525 
ri
->
Ï¡_ma¡”_down_»¶y_time
 = 
	`m¡ime
();

3526 ià(
r
->
–em’t
[0]->
š‹g”
 == 1) {

3527 
ri
->
æags
 |ğ
SRI_MASTER_DOWN
;

3529 
ri
->
æags
 &ğ~
SRI_MASTER_DOWN
;

3531 ià(
	`¡rcmp
(
r
->
–em’t
[1]->
¡r
,"*")) {

3534 
	`sdsä“
(
ri
->
Ëad”
);

3535 ià(()
ri
->
Ëad”_•och
 !ğ
r
->
–em’t
[2]->
š‹g”
)

3536 
	`£rv”Log
(
LL_WARNING
,

3537 "% vÙed fÜ % %Îu", 
ri
->
Çme
,

3538 
r
->
–em’t
[1]->
¡r
,

3539 (è
r
->
–em’t
[2]->
š‹g”
);

3540 
ri
->
Ëad”
 = 
	`sd¢ew
(
r
->
–em’t
[1]->
¡r
);

3541 
ri
->
Ëad”_•och
 = 
r
->
–em’t
[2]->
š‹g”
;

3544 
	}
}

3550 
	#SENTINEL_ASK_FORCED
 (1<<0)

	)

3551 
	$£Áš–AskMa¡”S‹ToOth”S’tš–s
(
£Áš–RedisIn¡ªû
 *
ma¡”
, 
æags
) {

3552 
diùI‹¿tÜ
 *
di
;

3553 
diùEÁry
 *
de
;

3555 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
£Áš–s
);

3556 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3557 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3558 
m¡ime_t
 
–­£d
 = 
	`m¡ime
(è- 
ri
->
Ï¡_ma¡”_down_»¶y_time
;

3559 
pÜt
[32];

3560 
»tv®
;

3563 ià(
–­£d
 > 
SENTINEL_ASK_PERIOD
*5) {

3564 
ri
->
æags
 &ğ~
SRI_MASTER_DOWN
;

3565 
	`sdsä“
(
ri
->
Ëad”
);

3566 
ri
->
Ëad”
 = 
NULL
;

3574 ià((
ma¡”
->
æags
 & 
SRI_S_DOWN
) == 0) ;

3575 ià(
ri
->
lšk
->
discÚÃùed
) ;

3576 ià(!(
æags
 & 
SENTINEL_ASK_FORCED
) &&

3577 
	`m¡ime
(è- 
ri
->
Ï¡_ma¡”_down_»¶y_time
 < 
SENTINEL_ASK_PERIOD
)

3581 
	`Î2¡ršg
(
pÜt
,ÕÜt),
ma¡”
->
addr
->port);

3582 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3583 
£Áš–ReûiveIsMa¡”DownR•ly
, 
ri
,

3585 
ma¡”
->
addr
->

, 
pÜt
,

3586 
£Áš–
.
cu¼’t_•och
,

3587 (
ma¡”
->
çov”_¡©e
 > 
SENTINEL_FAILOVER_STATE_NONE
) ?

3588 
£Áš–
.
myid
 : "*");

3589 ià(
»tv®
 =ğ
C_OK
è
ri
->
lšk
->
³ndšg_commªds
++;

3591 
	`diùR–—£I‹¿tÜ
(
di
);

3592 
	}
}

3597 
	$£Áš–SimFau»C¿sh
() {

3598 
	`£rv”Log
(
LL_WARNING
,

3600 
	`ex™
(99);

3601 
	}
}

3608 *
	$£Áš–VÙeL—d”
(
£Áš–RedisIn¡ªû
 *
ma¡”
, 
ušt64_t
 
»q_•och
, *
»q_runid
, ušt64_ˆ*
Ëad”_•och
) {

3609 ià(
»q_•och
 > 
£Áš–
.
cu¼’t_•och
) {

3610 
£Áš–
.
cu¼’t_•och
 = 
»q_•och
;

3611 
	`£Áš–FlushCÚfig
();

3612 
	`£Áš–Ev’t
(
LL_WARNING
,"+Ãw-•och",
ma¡”
,"%llu",

3613 (è
£Áš–
.
cu¼’t_•och
);

3616 ià(
ma¡”
->
Ëad”_•och
 < 
»q_•och
 && 
£Áš–
.
cu¼’t_•och
 <=„eq_epoch)

3618 
	`sdsä“
(
ma¡”
->
Ëad”
);

3619 
ma¡”
->
Ëad”
 = 
	`sd¢ew
(
»q_runid
);

3620 
ma¡”
->
Ëad”_•och
 = 
£Áš–
.
cu¼’t_•och
;

3621 
	`£Áš–FlushCÚfig
();

3622 
	`£Áš–Ev’t
(
LL_WARNING
,"+vÙe-fÜ-Ëad”",
ma¡”
,"%s %llu",

3623 
ma¡”
->
Ëad”
, (èma¡”->
Ëad”_•och
);

3627 ià(
	`¡rÿ£cmp
(
ma¡”
->
Ëad”
,
£Áš–
.
myid
))

3628 
ma¡”
->
çov”_¡¬t_time
 = 
	`m¡ime
()+
	`¿nd
()%
SENTINEL_MAX_DESYNC
;

3631 *
Ëad”_•och
 = 
ma¡”
->leader_epoch;

3632  
ma¡”
->
Ëad”
 ? 
	`sd¢ew
(ma¡”->Ëad”è: 
NULL
;

3633 
	}
}

3635 
	s£Áš–L—d”
 {

3636 *
	mrunid
;

3637 
	mvÙes
;

3642 
	$£Áš–L—d”Inü
(
diù
 *
couÁ”s
, *
runid
) {

3643 
diùEÁry
 *
exi¡šg
, *
de
;

3644 
ušt64_t
 
Şdv®
;

3646 
de
 = 
	`diùAddRaw
(
couÁ”s
,
runid
,&
exi¡šg
);

3647 ià(
exi¡šg
) {

3648 
Şdv®
 = 
	`diùG‘UnsigÃdIÁeg”V®
(
exi¡šg
);

3649 
	`diùS‘UnsigÃdIÁeg”V®
(
exi¡šg
,
Şdv®
+1);

3650  
Şdv®
+1;

3652 
	`£rv”As£¹
(
de
 !ğ
NULL
);

3653 
	`diùS‘UnsigÃdIÁeg”V®
(
de
,1);

3656 
	}
}

3664 *
	$£Áš–G‘L—d”
(
£Áš–RedisIn¡ªû
 *
ma¡”
, 
ušt64_t
 
•och
) {

3665 
diù
 *
couÁ”s
;

3666 
diùI‹¿tÜ
 *
di
;

3667 
diùEÁry
 *
de
;

3668 
vÙ”s
 = 0, 
vÙ”s_quÜum
;

3669 *
myvÙe
;

3670 *
wšÃr
 = 
NULL
;

3671 
ušt64_t
 
Ëad”_•och
;

3672 
ušt64_t
 
max_vÙes
 = 0;

3674 
	`£rv”As£¹
(
ma¡”
->
æags
 & (
SRI_O_DOWN
|
SRI_FAILOVER_IN_PROGRESS
));

3675 
couÁ”s
 = 
	`diùC»©e
(&
Ëad”VÙesDiùTy³
,
NULL
);

3677 
vÙ”s
 = 
	`diùSize
(
ma¡”
->
£Áš–s
)+1;

3680 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
£Áš–s
);

3681 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3682 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

3683 ià(
ri
->
Ëad”
 !ğ
NULL
 &&„i->
Ëad”_•och
 =ğ
£Áš–
.
cu¼’t_•och
)

3684 
	`£Áš–L—d”Inü
(
couÁ”s
,
ri
->
Ëad”
);

3686 
	`diùR–—£I‹¿tÜ
(
di
);

3691 
di
 = 
	`diùG‘I‹¿tÜ
(
couÁ”s
);

3692 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3693 
ušt64_t
 
vÙes
 = 
	`diùG‘UnsigÃdIÁeg”V®
(
de
);

3695 ià(
vÙes
 > 
max_vÙes
) {

3696 
max_vÙes
 = 
vÙes
;

3697 
wšÃr
 = 
	`diùG‘Key
(
de
);

3700 
	`diùR–—£I‹¿tÜ
(
di
);

3705 ià(
wšÃr
)

3706 
myvÙe
 = 
	`£Áš–VÙeL—d”
(
ma¡”
,
•och
,
wšÃr
,&
Ëad”_•och
);

3708 
myvÙe
 = 
	`£Áš–VÙeL—d”
(
ma¡”
,
•och
,
£Áš–
.
myid
,&
Ëad”_•och
);

3710 ià(
myvÙe
 && 
Ëad”_•och
 =ğ
•och
) {

3711 
ušt64_t
 
vÙes
 = 
	`£Áš–L—d”Inü
(
couÁ”s
,
myvÙe
);

3713 ià(
vÙes
 > 
max_vÙes
) {

3714 
max_vÙes
 = 
vÙes
;

3715 
wšÃr
 = 
myvÙe
;

3719 
vÙ”s_quÜum
 = 
vÙ”s
/2+1;

3720 ià(
wšÃr
 && (
max_vÙes
 < 
vÙ”s_quÜum
 || max_vÙe < 
ma¡”
->
quÜum
))

3721 
wšÃr
 = 
NULL
;

3723 
wšÃr
 = wšÃ¸? 
	`sd¢ew
(wšÃrè: 
NULL
;

3724 
	`sdsä“
(
myvÙe
);

3725 
	`diùR–—£
(
couÁ”s
);

3726  
wšÃr
;

3727 
	}
}

3739 
	$£Áš–S’dSÏveOf
(
£Áš–RedisIn¡ªû
 *
ri
, *
ho¡
, 
pÜt
) {

3740 
pÜt¡r
[32];

3741 
»tv®
;

3743 
	`Î2¡ršg
(
pÜt¡r
,ÕÜt¡r),
pÜt
);

3747 ià(
ho¡
 =ğ
NULL
) {

3748 
ho¡
 = "NO";

3749 
	`memıy
(
pÜt¡r
,"ONE",4);

3762 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3763 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "MULTI");

3764 ià(
»tv®
 =ğ
C_ERR
) „etval;

3765 
ri
->
lšk
->
³ndšg_commªds
++;

3767 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3768 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "SLAVEOF % %s", 
ho¡
, 
pÜt¡r
);

3769 ià(
»tv®
 =ğ
C_ERR
) „etval;

3770 
ri
->
lšk
->
³ndšg_commªds
++;

3772 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3773 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "CONFIG REWRITE");

3774 ià(
»tv®
 =ğ
C_ERR
) „etval;

3775 
ri
->
lšk
->
³ndšg_commªds
++;

3782 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3783 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "CLIENT KILL TYPE‚ormal");

3784 ià(
»tv®
 =ğ
C_ERR
) „etval;

3785 
ri
->
lšk
->
³ndšg_commªds
++;

3787 
»tv®
 = 
	`»disAsyncCommªd
(
ri
->
lšk
->
cc
,

3788 
£Áš–DisÿrdR•lyC®lback
, 
ri
, "EXEC");

3789 ià(
»tv®
 =ğ
C_ERR
) „etval;

3790 
ri
->
lšk
->
³ndšg_commªds
++;

3792  
C_OK
;

3793 
	}
}

3796 
	$£Áš–S¹Faov”
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

3797 
	`£rv”As£¹
(
ma¡”
->
æags
 & 
SRI_MASTER
);

3799 
ma¡”
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_WAIT_START
;

3800 
ma¡”
->
æags
 |ğ
SRI_FAILOVER_IN_PROGRESS
;

3801 
ma¡”
->
çov”_•och
 = ++
£Áš–
.
cu¼’t_•och
;

3802 
	`£Áš–Ev’t
(
LL_WARNING
,"+Ãw-•och",
ma¡”
,"%llu",

3803 (è
£Áš–
.
cu¼’t_•och
);

3804 
	`£Áš–Ev’t
(
LL_WARNING
,"+Œy-çov”",
ma¡”
,"%@");

3805 
ma¡”
->
çov”_¡¬t_time
 = 
	`m¡ime
()+
	`¿nd
()%
SENTINEL_MAX_DESYNC
;

3806 
ma¡”
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

3807 
	}
}

3820 
	$£Áš–S¹Faov”IfN“ded
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

3822 ià(!(
ma¡”
->
æags
 & 
SRI_O_DOWN
))  0;

3825 ià(
ma¡”
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
)  0;

3828 ià(
	`m¡ime
(è- 
ma¡”
->
çov”_¡¬t_time
 <

3829 
ma¡”
->
çov”_timeout
*2)

3831 ià(
ma¡”
->
çov”_d–ay_logged
 !ğma¡”->
çov”_¡¬t_time
) {

3832 
time_t
 
şock
 = (
ma¡”
->
çov”_¡¬t_time
 +

3833 
ma¡”
->
çov”_timeout
*2) / 1000;

3834 
ùimebuf
[26];

3836 
	`ùime_r
(&
şock
,
ùimebuf
);

3837 
ùimebuf
[24] = '\0';

3838 
ma¡”
->
çov”_d–ay_logged
 = ma¡”->
çov”_¡¬t_time
;

3839 
	`£rv”Log
(
LL_WARNING
,

3841 
ùimebuf
);

3846 
	`£Áš–S¹Faov”
(
ma¡”
);

3848 
	}
}

3882 
	$com·»SÏvesFÜPromÙiÚ
(cÚ¡ *
a
, cÚ¡ *
b
) {

3883 
£Áš–RedisIn¡ªû
 **
§
 = (£Áš–RedisIn¡ªû **)
a
,

3884 **
sb
 = (
£Áš–RedisIn¡ªû
 **)
b
;

3885 *
§_runid
, *
sb_runid
;

3887 ià((*
§
)->
¦ave_´iÜ™y
 !ğ(*
sb
)->slave_priority)

3888  (*
§
)->
¦ave_´iÜ™y
 - (*
sb
)->slave_priority;

3892 ià((*
§
)->
¦ave_»¶_off£t
 > (*
sb
)->slave_repl_offset) {

3894 } ià((*
§
)->
¦ave_»¶_off£t
 < (*
sb
)->slave_repl_offset) {

3902 
§_runid
 = (*
§
)->
runid
;

3903 
sb_runid
 = (*
sb
)->
runid
;

3904 ià(
§_runid
 =ğ
NULL
 && 
sb_runid
 == NULL)  0;

3905 ià(
§_runid
 =ğ
NULL
)  1;

3906 ià(
sb_runid
 =ğ
NULL
)  -1;

3907  
	`¡rÿ£cmp
(
§_runid
, 
sb_runid
);

3908 
	}
}

3910 
£Áš–RedisIn¡ªû
 *
	$£Áš–S–eùSÏve
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

3911 
£Áš–RedisIn¡ªû
 **
š¡ªû
 =

3912 
	`zm®loc
((
š¡ªû
[0])*
	`diùSize
(
ma¡”
->
¦aves
));

3913 
£Áš–RedisIn¡ªû
 *
£Ëùed
 = 
NULL
;

3914 
š¡ªûs
 = 0;

3915 
diùI‹¿tÜ
 *
di
;

3916 
diùEÁry
 *
de
;

3917 
m¡ime_t
 
max_ma¡”_down_time
 = 0;

3919 ià(
ma¡”
->
æags
 & 
SRI_S_DOWN
)

3920 
max_ma¡”_down_time
 +ğ
	`m¡ime
(è- 
ma¡”
->
s_down_sšû_time
;

3921 
max_ma¡”_down_time
 +ğ
ma¡”
->
down_aá”_³riod
 * 10;

3923 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

3924 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

3925 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

3926 
m¡ime_t
 
šfo_v®id™y_time
;

3928 ià(
¦ave
->
æags
 & (
SRI_S_DOWN
|
SRI_O_DOWN
)) ;

3929 ià(
¦ave
->
lšk
->
discÚÃùed
) ;

3930 ià(
	`m¡ime
(è- 
¦ave
->
lšk
->
Ï¡_ava_time
 > 
SENTINEL_PING_PERIOD
*5) ;

3931 ià(
¦ave
->
¦ave_´iÜ™y
 == 0) ;

3936 ià(
ma¡”
->
æags
 & 
SRI_S_DOWN
)

3937 
šfo_v®id™y_time
 = 
SENTINEL_PING_PERIOD
*5;

3939 
šfo_v®id™y_time
 = 
SENTINEL_INFO_PERIOD
*3;

3940 ià(
	`m¡ime
(è- 
¦ave
->
šfo_»äesh
 > 
šfo_v®id™y_time
) ;

3941 ià(
¦ave
->
ma¡”_lšk_down_time
 > 
max_ma¡”_down_time
) ;

3942 
š¡ªû
[
š¡ªûs
++] = 
¦ave
;

3944 
	`diùR–—£I‹¿tÜ
(
di
);

3945 ià(
š¡ªûs
) {

3946 
	`qsÜt
(
š¡ªû
,
š¡ªûs
,(
£Áš–RedisIn¡ªû
*),

3947 
com·»SÏvesFÜPromÙiÚ
);

3948 
£Ëùed
 = 
š¡ªû
[0];

3950 
	`zä“
(
š¡ªû
);

3951  
£Ëùed
;

3952 
	}
}

3955 
	$£Áš–Faov”Wa™S¹
(
£Áš–RedisIn¡ªû
 *
ri
) {

3956 *
Ëad”
;

3957 
i¦—d”
;

3960 
Ëad”
 = 
	`£Áš–G‘L—d”
(
ri
,„i->
çov”_•och
);

3961 
i¦—d”
 = 
Ëad”
 && 
	`¡rÿ£cmp
Ö—d”,
£Áš–
.
myid
) == 0;

3962 
	`sdsä“
(
Ëad”
);

3966 ià(!
i¦—d”
 && !(
ri
->
æags
 & 
SRI_FORCE_FAILOVER
)) {

3967 
–eùiÚ_timeout
 = 
SENTINEL_ELECTION_TIMEOUT
;

3971 ià(
–eùiÚ_timeout
 > 
ri
->
çov”_timeout
)

3972 
–eùiÚ_timeout
 = 
ri
->
çov”_timeout
;

3974 ià(
	`m¡ime
(è- 
ri
->
çov”_¡¬t_time
 > 
–eùiÚ_timeout
) {

3975 
	`£Áš–Ev’t
(
LL_WARNING
,"-çov”-abÜt-nÙ-–eùed",
ri
,"%@");

3976 
	`£Áš–AbÜtFaov”
(
ri
);

3980 
	`£Áš–Ev’t
(
LL_WARNING
,"+–eùed-Ëad”",
ri
,"%@");

3981 ià(
£Áš–
.
simçu»_æags
 & 
SENTINEL_SIMFAILURE_CRASH_AFTER_ELECTION
)

3982 
	`£Áš–SimFau»C¿sh
();

3983 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_SELECT_SLAVE
;

3984 
ri
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

3985 
	`£Áš–Ev’t
(
LL_WARNING
,"+çov”-¡©e-£Ëù-¦ave",
ri
,"%@");

3986 
	}
}

3988 
	$£Áš–Faov”S–eùSÏve
(
£Áš–RedisIn¡ªû
 *
ri
) {

3989 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`£Áš–S–eùSÏve
(
ri
);

3993 ià(
¦ave
 =ğ
NULL
) {

3994 
	`£Áš–Ev’t
(
LL_WARNING
,"-çov”-abÜt-no-good-¦ave",
ri
,"%@");

3995 
	`£Áš–AbÜtFaov”
(
ri
);

3997 
	`£Áš–Ev’t
(
LL_WARNING
,"+£Ëùed-¦ave",
¦ave
,"%@");

3998 
¦ave
->
æags
 |ğ
SRI_PROMOTED
;

3999 
ri
->
´omÙed_¦ave
 = 
¦ave
;

4000 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_SEND_SLAVEOF_NOONE
;

4001 
ri
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

4002 
	`£Áš–Ev’t
(
LL_NOTICE
,"+failover-state-send-slaveof-noone",

4003 
¦ave
, "%@");

4005 
	}
}

4007 
	$£Áš–Faov”S’dSÏveOfNoOÃ
(
£Áš–RedisIn¡ªû
 *
ri
) {

4008 
»tv®
;

4013 ià(
ri
->
´omÙed_¦ave
->
lšk
->
discÚÃùed
) {

4014 ià(
	`m¡ime
(è- 
ri
->
çov”_¡©e_chªge_time
 >„i->
çov”_timeout
) {

4015 
	`£Áš–Ev’t
(
LL_WARNING
,"-çov”-abÜt-¦ave-timeout",
ri
,"%@");

4016 
	`£Áš–AbÜtFaov”
(
ri
);

4025 
»tv®
 = 
	`£Áš–S’dSÏveOf
(
ri
->
´omÙed_¦ave
,
NULL
,0);

4026 ià(
»tv®
 !ğ
C_OK
) ;

4027 
	`£Áš–Ev’t
(
LL_NOTICE
, "+failover-state-wait-promotion",

4028 
ri
->
´omÙed_¦ave
,"%@");

4029 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
;

4030 
ri
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

4031 
	}
}

4035 
	$£Áš–Faov”Wa™PromÙiÚ
(
£Áš–RedisIn¡ªû
 *
ri
) {

4038 ià(
	`m¡ime
(è- 
ri
->
çov”_¡©e_chªge_time
 >„i->
çov”_timeout
) {

4039 
	`£Áš–Ev’t
(
LL_WARNING
,"-çov”-abÜt-¦ave-timeout",
ri
,"%@");

4040 
	`£Áš–AbÜtFaov”
(
ri
);

4042 
	}
}

4044 
	$£Áš–Faov”D‘eùEnd
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

4045 
nÙ_»cÚfigu»d
 = 0, 
timeout
 = 0;

4046 
diùI‹¿tÜ
 *
di
;

4047 
diùEÁry
 *
de
;

4048 
m¡ime_t
 
–­£d
 = 
	`m¡ime
(è- 
ma¡”
->
çov”_¡©e_chªge_time
;

4052 ià(
ma¡”
->
´omÙed_¦ave
 =ğ
NULL
 ||

4053 
ma¡”
->
´omÙed_¦ave
->
æags
 & 
SRI_S_DOWN
) ;

4057 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

4058 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

4059 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

4061 ià(
¦ave
->
æags
 & (
SRI_PROMOTED
|
SRI_RECONF_DONE
)) ;

4062 ià(
¦ave
->
æags
 & 
SRI_S_DOWN
) ;

4063 
nÙ_»cÚfigu»d
++;

4065 
	`diùR–—£I‹¿tÜ
(
di
);

4068 ià(
–­£d
 > 
ma¡”
->
çov”_timeout
) {

4069 
nÙ_»cÚfigu»d
 = 0;

4070 
timeout
 = 1;

4071 
	`£Áš–Ev’t
(
LL_WARNING
,"+çov”-’d-fÜ-timeout",
ma¡”
,"%@");

4074 ià(
nÙ_»cÚfigu»d
 == 0) {

4075 
	`£Áš–Ev’t
(
LL_WARNING
,"+çov”-’d",
ma¡”
,"%@");

4076 
ma¡”
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_UPDATE_CONFIG
;

4077 
ma¡”
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

4083 ià(
timeout
) {

4084 
diùI‹¿tÜ
 *
di
;

4085 
diùEÁry
 *
de
;

4087 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

4088 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

4089 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

4090 
»tv®
;

4092 ià(
¦ave
->
æags
 & (
SRI_RECONF_DONE
|
SRI_RECONF_SENT
)) ;

4093 ià(
¦ave
->
lšk
->
discÚÃùed
) ;

4095 
»tv®
 = 
	`£Áš–S’dSÏveOf
(
¦ave
,

4096 
ma¡”
->
´omÙed_¦ave
->
addr
->

,

4097 
ma¡”
->
´omÙed_¦ave
->
addr
->
pÜt
);

4098 ià(
»tv®
 =ğ
C_OK
) {

4099 
	`£Áš–Ev’t
(
LL_NOTICE
,"+¦ave-»cÚf-£Á-be",
¦ave
,"%@");

4100 
¦ave
->
æags
 |ğ
SRI_RECONF_SENT
;

4103 
	`diùR–—£I‹¿tÜ
(
di
);

4105 
	}
}

4109 
	$£Áš–Faov”RecÚfNextSÏve
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

4110 
diùI‹¿tÜ
 *
di
;

4111 
diùEÁry
 *
de
;

4112 
š_´og»ss
 = 0;

4114 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

4115 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

4116 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

4118 ià(
¦ave
->
æags
 & (
SRI_RECONF_SENT
|
SRI_RECONF_INPROG
))

4119 
š_´og»ss
++;

4121 
	`diùR–—£I‹¿tÜ
(
di
);

4123 
di
 = 
	`diùG‘I‹¿tÜ
(
ma¡”
->
¦aves
);

4124 
š_´og»ss
 < 
ma¡”
->
·¿Î–_syncs
 &&

4125 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
)

4127 
£Áš–RedisIn¡ªû
 *
¦ave
 = 
	`diùG‘V®
(
de
);

4128 
»tv®
;

4131 ià(
¦ave
->
æags
 & (
SRI_PROMOTED
|
SRI_RECONF_DONE
)) ;

4137 ià((
¦ave
->
æags
 & 
SRI_RECONF_SENT
) &&

4138 (
	`m¡ime
(è- 
¦ave
->
¦ave_»cÚf_£Á_time
) >

4139 
SENTINEL_SLAVE_RECONF_TIMEOUT
)

4141 
	`£Áš–Ev’t
(
LL_NOTICE
,"-¦ave-»cÚf-£Á-timeout",
¦ave
,"%@");

4142 
¦ave
->
æags
 &ğ~
SRI_RECONF_SENT
;

4143 
¦ave
->
æags
 |ğ
SRI_RECONF_DONE
;

4148 ià(
¦ave
->
æags
 & (
SRI_RECONF_SENT
|
SRI_RECONF_INPROG
)) ;

4149 ià(
¦ave
->
lšk
->
discÚÃùed
) ;

4152 
»tv®
 = 
	`£Áš–S’dSÏveOf
(
¦ave
,

4153 
ma¡”
->
´omÙed_¦ave
->
addr
->

,

4154 
ma¡”
->
´omÙed_¦ave
->
addr
->
pÜt
);

4155 ià(
»tv®
 =ğ
C_OK
) {

4156 
¦ave
->
æags
 |ğ
SRI_RECONF_SENT
;

4157 
¦ave
->
¦ave_»cÚf_£Á_time
 = 
	`m¡ime
();

4158 
	`£Áš–Ev’t
(
LL_NOTICE
,"+¦ave-»cÚf-£Á",
¦ave
,"%@");

4159 
š_´og»ss
++;

4162 
	`diùR–—£I‹¿tÜ
(
di
);

4165 
	`£Áš–Faov”D‘eùEnd
(
ma¡”
);

4166 
	}
}

4171 
	$£Áš–Faov”Sw™chToPromÙedSÏve
(
£Áš–RedisIn¡ªû
 *
ma¡”
) {

4172 
£Áš–RedisIn¡ªû
 *
»f
 = 
ma¡”
->
´omÙed_¦ave
 ?

4173 
ma¡”
->
´omÙed_¦ave
 : master;

4175 
	`£Áš–Ev’t
(
LL_WARNING
,"+sw™ch-ma¡”",
ma¡”
,"%s %s %d %s %d",

4176 
ma¡”
->
Çme
, ma¡”->
addr
->

, ma¡”->addr->
pÜt
,

4177 
»f
->
addr
->

,„ef->addr->
pÜt
);

4179 
	`£Áš–Re£tMa¡”AndChªgeAdd»ss
(
ma¡”
,
»f
->
addr
->

,»f->addr->
pÜt
);

4180 
	}
}

4182 
	$£Áš–Faov”S‹Machše
(
£Áš–RedisIn¡ªû
 *
ri
) {

4183 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_MASTER
);

4185 ià(!(
ri
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
)) ;

4187 
ri
->
çov”_¡©e
) {

4188 
SENTINEL_FAILOVER_STATE_WAIT_START
:

4189 
	`£Áš–Faov”Wa™S¹
(
ri
);

4191 
SENTINEL_FAILOVER_STATE_SELECT_SLAVE
:

4192 
	`£Áš–Faov”S–eùSÏve
(
ri
);

4194 
SENTINEL_FAILOVER_STATE_SEND_SLAVEOF_NOONE
:

4195 
	`£Áš–Faov”S’dSÏveOfNoOÃ
(
ri
);

4197 
SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
:

4198 
	`£Áš–Faov”Wa™PromÙiÚ
(
ri
);

4200 
SENTINEL_FAILOVER_STATE_RECONF_SLAVES
:

4201 
	`£Áš–Faov”RecÚfNextSÏve
(
ri
);

4204 
	}
}

4211 
	$£Áš–AbÜtFaov”
(
£Áš–RedisIn¡ªû
 *
ri
) {

4212 
	`£rv”As£¹
(
ri
->
æags
 & 
SRI_FAILOVER_IN_PROGRESS
);

4213 
	`£rv”As£¹
(
ri
->
çov”_¡©e
 <ğ
SENTINEL_FAILOVER_STATE_WAIT_PROMOTION
);

4215 
ri
->
æags
 &ğ~(
SRI_FAILOVER_IN_PROGRESS
|
SRI_FORCE_FAILOVER
);

4216 
ri
->
çov”_¡©e
 = 
SENTINEL_FAILOVER_STATE_NONE
;

4217 
ri
->
çov”_¡©e_chªge_time
 = 
	`m¡ime
();

4218 ià(
ri
->
´omÙed_¦ave
) {

4219 
ri
->
´omÙed_¦ave
->
æags
 &ğ~
SRI_PROMOTED
;

4220 
ri
->
´omÙed_¦ave
 = 
NULL
;

4222 
	}
}

4230 
	$£Áš–HªdËRedisIn¡ªû
(
£Áš–RedisIn¡ªû
 *
ri
) {

4233 
	`£Áš–RecÚÃùIn¡ªû
(
ri
);

4234 
	`£Áš–S’dP”iodicCommªds
(
ri
);

4240 ià(
£Áš–
.
tt
) {

4241 ià(
	`m¡ime
()-
£Áš–
.
tt_¡¬t_time
 < 
SENTINEL_TILT_PERIOD
) ;

4242 
£Áš–
.
tt
 = 0;

4243 
	`£Áš–Ev’t
(
LL_WARNING
,"-tt",
NULL
,"#tilt modeƒxited");

4247 
	`£Áš–CheckSubjeùiv–yDown
(
ri
);

4250 ià(
ri
->
æags
 & (
SRI_MASTER
|
SRI_SLAVE
)) {

4255 ià(
ri
->
æags
 & 
SRI_MASTER
) {

4256 
	`£Áš–CheckObjeùiv–yDown
(
ri
);

4257 ià(
	`£Áš–S¹Faov”IfN“ded
(
ri
))

4258 
	`£Áš–AskMa¡”S‹ToOth”S’tš–s
(
ri
,
SENTINEL_ASK_FORCED
);

4259 
	`£Áš–Faov”S‹Machše
(
ri
);

4260 
	`£Áš–AskMa¡”S‹ToOth”S’tš–s
(
ri
,
SENTINEL_NO_FLAGS
);

4262 
	}
}

4266 
	$£Áš–HªdËDiùOfRedisIn¡ªûs
(
diù
 *
š¡ªûs
) {

4267 
diùI‹¿tÜ
 *
di
;

4268 
diùEÁry
 *
de
;

4269 
£Áš–RedisIn¡ªû
 *
sw™ch_to_´omÙed
 = 
NULL
;

4272 
di
 = 
	`diùG‘I‹¿tÜ
(
š¡ªûs
);

4273 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

4274 
£Áš–RedisIn¡ªû
 *
ri
 = 
	`diùG‘V®
(
de
);

4276 
	`£Áš–HªdËRedisIn¡ªû
(
ri
);

4277 ià(
ri
->
æags
 & 
SRI_MASTER
) {

4278 
	`£Áš–HªdËDiùOfRedisIn¡ªûs
(
ri
->
¦aves
);

4279 
	`£Áš–HªdËDiùOfRedisIn¡ªûs
(
ri
->
£Áš–s
);

4280 ià(
ri
->
çov”_¡©e
 =ğ
SENTINEL_FAILOVER_STATE_UPDATE_CONFIG
) {

4281 
sw™ch_to_´omÙed
 = 
ri
;

4285 ià(
sw™ch_to_´omÙed
)

4286 
	`£Áš–Faov”Sw™chToPromÙedSÏve
(
sw™ch_to_´omÙed
);

4287 
	`diùR–—£I‹¿tÜ
(
di
);

4288 
	}
}

4309 
	$£Áš–CheckTtCÚd™iÚ
() {

4310 
m¡ime_t
 
now
 = 
	`m¡ime
();

4311 
m¡ime_t
 
d–
 = 
now
 - 
£Áš–
.
´evious_time
;

4313 ià(
d–
 < 0 || d– > 
SENTINEL_TILT_TRIGGER
) {

4314 
£Áš–
.
tt
 = 1;

4315 
£Áš–
.
tt_¡¬t_time
 = 
	`m¡ime
();

4316 
	`£Áš–Ev’t
(
LL_WARNING
,"+tt",
NULL
,"#tilt modeƒntered");

4318 
£Áš–
.
´evious_time
 = 
	`m¡ime
();

4319 
	}
}

4321 
	$£Áš–Tim”
() {

4322 
	`£Áš–CheckTtCÚd™iÚ
();

4323 
	`£Áš–HªdËDiùOfRedisIn¡ªûs
(
£Áš–
.
ma¡”s
);

4324 
	`£Áš–RunP’dšgSüts
();

4325 
	`£Áš–CŞËùT”mš©edSüts
();

4326 
	`£Áš–KlTimedoutSüts
();

4334 
£rv”
.
hz
 = 
CONFIG_DEFAULT_HZ
 + 
	`¿nd
() % CONFIG_DEFAULT_HZ;

4335 
	}
}

	@server.c

30 
	~"£rv”.h
"

31 
	~"şu¡”.h
"

32 
	~"¦owlog.h
"

33 
	~"bio.h
"

34 
	~"Ï‹ncy.h
"

36 
	~<time.h
>

37 
	~<sigÇl.h
>

38 
	~<sys/wa™.h
>

39 
	~<”ºo.h
>

40 
	~<as£¹.h
>

41 
	~<ùy³.h
>

42 
	~<¡d¬g.h
>

43 
	~<¬·/š‘.h
>

44 
	~<sys/¡©.h
>

45 
	~<fú.h
>

46 
	~<sys/time.h
>

47 
	~<sys/»sourû.h
>

48 
	~<sys/uio.h
>

49 
	~<sys/un.h
>

50 
	~<lim™s.h
>

51 
	~<æßt.h
>

52 
	~<m©h.h
>

53 
	~<sys/»sourû.h
>

54 
	~<sys/ut¢ame.h
>

55 
	~<loÿË.h
>

56 
	~<sys/sock‘.h
>

58 
¥¬£InU£
;

62 
sh¬edObjeùsSŒuù
 
	gsh¬ed
;

68 
	gR_Z”o
, 
	gR_PosInf
, 
	gR_NegInf
, 
	gR_Nª
;

73 
»disS”v”
 
	g£rv”
;

127 
»disCommªd
 
	g»disCommªdTabË
[] = {

128 {"moduË",
moduËCommªd
,-2,"as",0,
NULL
,1,1,1,0,0},

129 {"g‘",
g‘Commªd
,2,"rF",0,
NULL
,1,1,1,0,0},

130 {"£t",
£tCommªd
,-3,"wm",0,
NULL
,1,1,1,0,0},

131 {"£Šx",
£ŠxCommªd
,3,"wmF",0,
NULL
,1,1,1,0,0},

132 {"£‹x",
£‹xCommªd
,4,"wm",0,
NULL
,1,1,1,0,0},

133 {"p£‹x",
p£‹xCommªd
,4,"wm",0,
NULL
,1,1,1,0,0},

134 {"­³nd",
­³ndCommªd
,3,"wm",0,
NULL
,1,1,1,0,0},

135 {"¡¾’",
¡¾’Commªd
,2,"rF",0,
NULL
,1,1,1,0,0},

136 {"d–",
d–Commªd
,-2,"w",0,
NULL
,1,-1,1,0,0},

137 {"uÆšk",
uÆškCommªd
,-2,"wF",0,
NULL
,1,-1,1,0,0},

138 {"exi¡s",
exi¡sCommªd
,-2,"rF",0,
NULL
,1,-1,1,0,0},

139 {"£tb™",
£tb™Commªd
,4,"wm",0,
NULL
,1,1,1,0,0},

140 {"g‘b™",
g‘b™Commªd
,3,"rF",0,
NULL
,1,1,1,0,0},

141 {"b™f›ld",
b™f›ldCommªd
,-2,"wm",0,
NULL
,1,1,1,0,0},

142 {"£Œªge",
£ŒªgeCommªd
,4,"wm",0,
NULL
,1,1,1,0,0},

143 {"g‘¿nge",
g‘¿ngeCommªd
,4,"r",0,
NULL
,1,1,1,0,0},

144 {"sub¡r",
g‘¿ngeCommªd
,4,"r",0,
NULL
,1,1,1,0,0},

145 {"šü",
šüCommªd
,2,"wmF",0,
NULL
,1,1,1,0,0},

146 {"deü",
deüCommªd
,2,"wmF",0,
NULL
,1,1,1,0,0},

147 {"mg‘",
mg‘Commªd
,-2,"r",0,
NULL
,1,-1,1,0,0},

148 {"½ush",
½ushCommªd
,-3,"wmF",0,
NULL
,1,1,1,0,0},

149 {"Íush",
ÍushCommªd
,-3,"wmF",0,
NULL
,1,1,1,0,0},

150 {"½ushx",
½ushxCommªd
,-3,"wmF",0,
NULL
,1,1,1,0,0},

151 {"Íushx",
ÍushxCommªd
,-3,"wmF",0,
NULL
,1,1,1,0,0},

152 {"lš£¹",
lš£¹Commªd
,5,"wm",0,
NULL
,1,1,1,0,0},

153 {"½İ",
½İCommªd
,2,"wF",0,
NULL
,1,1,1,0,0},

154 {"Íİ",
ÍİCommªd
,2,"wF",0,
NULL
,1,1,1,0,0},

155 {"b½İ",
b½İCommªd
,-3,"ws",0,
NULL
,1,1,1,0,0},

156 {"b½İÍush",
b½İÍushCommªd
,4,"wms",0,
NULL
,1,2,1,0,0},

157 {"bÍİ",
bÍİCommªd
,-3,"ws",0,
NULL
,1,-2,1,0,0},

158 {"Î’",
Î’Commªd
,2,"rF",0,
NULL
,1,1,1,0,0},

159 {"lšdex",
lšdexCommªd
,3,"r",0,
NULL
,1,1,1,0,0},

160 {"l£t",
l£tCommªd
,4,"wm",0,
NULL
,1,1,1,0,0},

161 {"Ìªge",
ÌªgeCommªd
,4,"r",0,
NULL
,1,1,1,0,0},

162 {"Érim",
ÉrimCommªd
,4,"w",0,
NULL
,1,1,1,0,0},

163 {"Ìem",
ÌemCommªd
,4,"w",0,
NULL
,1,1,1,0,0},

164 {"½İÍush",
½İÍushCommªd
,3,"wm",0,
NULL
,1,2,1,0,0},

165 {"§dd",
§ddCommªd
,-3,"wmF",0,
NULL
,1,1,1,0,0},

166 {"¤em",
¤emCommªd
,-3,"wF",0,
NULL
,1,1,1,0,0},

167 {"smove",
smoveCommªd
,4,"wF",0,
NULL
,1,2,1,0,0},

168 {"sismemb”",
sismemb”Commªd
,3,"rF",0,
NULL
,1,1,1,0,0},

169 {"sÿrd",
sÿrdCommªd
,2,"rF",0,
NULL
,1,1,1,0,0},

170 {"¥İ",
¥İCommªd
,-2,"wRF",0,
NULL
,1,1,1,0,0},

171 {"¤ªdmemb”",
¤ªdmemb”Commªd
,-2,"rR",0,
NULL
,1,1,1,0,0},

172 {"sš‹r",
sš‹rCommªd
,-2,"rS",0,
NULL
,1,-1,1,0,0},

173 {"sš‹r¡Üe",
sš‹r¡ÜeCommªd
,-3,"wm",0,
NULL
,1,-1,1,0,0},

174 {"suniÚ",
suniÚCommªd
,-2,"rS",0,
NULL
,1,-1,1,0,0},

175 {"suniÚ¡Üe",
suniÚ¡ÜeCommªd
,-3,"wm",0,
NULL
,1,-1,1,0,0},

176 {"sdiff",
sdiffCommªd
,-2,"rS",0,
NULL
,1,-1,1,0,0},

177 {"sdiff¡Üe",
sdiff¡ÜeCommªd
,-3,"wm",0,
NULL
,1,-1,1,0,0},

178 {"smemb”s",
sš‹rCommªd
,2,"rS",0,
NULL
,1,1,1,0,0},

179 {"ssÿn",
ssÿnCommªd
,-3,"rR",0,
NULL
,1,1,1,0,0},

180 {"zadd",
zaddCommªd
,-4,"wmF",0,
NULL
,1,1,1,0,0},

181 {"zšüby",
zšübyCommªd
,4,"wmF",0,
NULL
,1,1,1,0,0},

182 {"z»m",
z»mCommªd
,-3,"wF",0,
NULL
,1,1,1,0,0},

183 {"z»m¿ngebyscÜe",
z»m¿ngebyscÜeCommªd
,4,"w",0,
NULL
,1,1,1,0,0},

184 {"z»m¿ngeby¿nk",
z»m¿ngeby¿nkCommªd
,4,"w",0,
NULL
,1,1,1,0,0},

185 {"z»m¿ngebyËx",
z»m¿ngebyËxCommªd
,4,"w",0,
NULL
,1,1,1,0,0},

186 {"zuniÚ¡Üe",
zuniÚ¡ÜeCommªd
,-4,"wm",0,
zuniÚIÁ”G‘Keys
,0,0,0,0,0},

187 {"zš‹r¡Üe",
zš‹r¡ÜeCommªd
,-4,"wm",0,
zuniÚIÁ”G‘Keys
,0,0,0,0,0},

188 {"z¿nge",
z¿ngeCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

189 {"z¿ngebyscÜe",
z¿ngebyscÜeCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

190 {"z»v¿ngebyscÜe",
z»v¿ngebyscÜeCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

191 {"z¿ngebyËx",
z¿ngebyËxCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

192 {"z»v¿ngebyËx",
z»v¿ngebyËxCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

193 {"zcouÁ",
zcouÁCommªd
,4,"rF",0,
NULL
,1,1,1,0,0},

194 {"zËxcouÁ",
zËxcouÁCommªd
,4,"rF",0,
NULL
,1,1,1,0,0},

195 {"z»v¿nge",
z»v¿ngeCommªd
,-4,"r",0,
NULL
,1,1,1,0,0},

196 {"zÿrd",
zÿrdCommªd
,2,"rF",0,
NULL
,1,1,1,0,0},

197 {"zscÜe",
zscÜeCommªd
,3,"rF",0,
NULL
,1,1,1,0,0},

198 {"z¿nk",
z¿nkCommªd
,3,"rF",0,
NULL
,1,1,1,0,0},

199 {"z»v¿nk",
z»v¿nkCommªd
,3,"rF",0,
NULL
,1,1,1,0,0},

200 {"zsÿn",
zsÿnCommªd
,-3,"rR",0,
NULL
,1,1,1,0,0},

201 {"h£t",
h£tCommªd
,4,"wmF",0,
NULL
,1,1,1,0,0},

202 {"h£Šx",
h£ŠxCommªd
,4,"wmF",0,
NULL
,1,1,1,0,0},

203 {"hg‘",
hg‘Commªd
,3,"rF",0,
NULL
,1,1,1,0,0},

204 {"hm£t",
hm£tCommªd
,-4,"wm",0,
NULL
,1,1,1,0,0},

205 {"hmg‘",
hmg‘Commªd
,-3,"r",0,
NULL
,1,1,1,0,0},

206 {"hšüby",
hšübyCommªd
,4,"wmF",0,
NULL
,1,1,1,0,0},

207 {"hšübyæßt",
hšübyæßtCommªd
,4,"wmF",0,
NULL
,1,1,1,0,0},

208 {"hd–",
hd–Commªd
,-3,"wF",0,
NULL
,1,1,1,0,0},

209 {"hËn",
hËnCommªd
,2,"rF",0,
NULL
,1,1,1,0,0},

210 {"h¡¾’",
h¡¾’Commªd
,3,"rF",0,
NULL
,1,1,1,0,0},

211 {"hkeys",
hkeysCommªd
,2,"rS",0,
NULL
,1,1,1,0,0},

212 {"hv®s",
hv®sCommªd
,2,"rS",0,
NULL
,1,1,1,0,0},

213 {"hg‘®l",
hg‘®lCommªd
,2,"r",0,
NULL
,1,1,1,0,0},

214 {"hexi¡s",
hexi¡sCommªd
,3,"rF",0,
NULL
,1,1,1,0,0},

215 {"hsÿn",
hsÿnCommªd
,-3,"rR",0,
NULL
,1,1,1,0,0},

216 {"šüby",
šübyCommªd
,3,"wmF",0,
NULL
,1,1,1,0,0},

217 {"deüby",
deübyCommªd
,3,"wmF",0,
NULL
,1,1,1,0,0},

218 {"šübyæßt",
šübyæßtCommªd
,3,"wmF",0,
NULL
,1,1,1,0,0},

219 {"g‘£t",
g‘£tCommªd
,3,"wm",0,
NULL
,1,1,1,0,0},

220 {"m£t",
m£tCommªd
,-3,"wm",0,
NULL
,1,-1,2,0,0},

221 {"m£Šx",
m£ŠxCommªd
,-3,"wm",0,
NULL
,1,-1,2,0,0},

222 {"¿ndomkey",
¿ndomkeyCommªd
,1,"rR",0,
NULL
,0,0,0,0,0},

223 {"£Ëù",
£ËùCommªd
,2,"lF",0,
NULL
,0,0,0,0,0},

224 {"move",
moveCommªd
,3,"wF",0,
NULL
,1,1,1,0,0},

225 {"»Çme",
»ÇmeCommªd
,3,"w",0,
NULL
,1,2,1,0,0},

226 {"»Çm’x",
»Çm’xCommªd
,3,"wF",0,
NULL
,1,2,1,0,0},

227 {"expœe",
expœeCommªd
,3,"wF",0,
NULL
,1,1,1,0,0},

228 {"expœ—t",
expœ—tCommªd
,3,"wF",0,
NULL
,1,1,1,0,0},

229 {"³xpœe",
³xpœeCommªd
,3,"wF",0,
NULL
,1,1,1,0,0},

230 {"³xpœ—t",
³xpœ—tCommªd
,3,"wF",0,
NULL
,1,1,1,0,0},

231 {"keys",
keysCommªd
,2,"rS",0,
NULL
,0,0,0,0,0},

232 {"sÿn",
sÿnCommªd
,-2,"rR",0,
NULL
,0,0,0,0,0},

233 {"dbsize",
dbsizeCommªd
,1,"rF",0,
NULL
,0,0,0,0,0},

234 {"auth",
authCommªd
,2,"¦tF",0,
NULL
,0,0,0,0,0},

235 {"pšg",
pšgCommªd
,-1,"tF",0,
NULL
,0,0,0,0,0},

236 {"echo",
echoCommªd
,2,"F",0,
NULL
,0,0,0,0,0},

237 {"§ve",
§veCommªd
,1,"as",0,
NULL
,0,0,0,0,0},

238 {"bg§ve",
bg§veCommªd
,-1,"a",0,
NULL
,0,0,0,0,0},

239 {"bg»wr™—of",
bg»wr™—ofCommªd
,1,"a",0,
NULL
,0,0,0,0,0},

240 {"shutdown",
shutdownCommªd
,-1,"®t",0,
NULL
,0,0,0,0,0},

241 {"Ï¡§ve",
Ï¡§veCommªd
,1,"RF",0,
NULL
,0,0,0,0,0},

242 {"ty³",
ty³Commªd
,2,"rF",0,
NULL
,1,1,1,0,0},

243 {"muÉi",
muÉiCommªd
,1,"sF",0,
NULL
,0,0,0,0,0},

244 {"exec",
execCommªd
,1,"sM",0,
NULL
,0,0,0,0,0},

245 {"disÿrd",
disÿrdCommªd
,1,"sF",0,
NULL
,0,0,0,0,0},

246 {"sync",
syncCommªd
,1,"¬s",0,
NULL
,0,0,0,0,0},

247 {"psync",
syncCommªd
,3,"¬s",0,
NULL
,0,0,0,0,0},

248 {"»¶cÚf",
»¶cÚfCommªd
,-1,"a¦t",0,
NULL
,0,0,0,0,0},

249 {"æushdb",
æushdbCommªd
,-1,"w",0,
NULL
,0,0,0,0,0},

250 {"æush®l",
æush®lCommªd
,-1,"w",0,
NULL
,0,0,0,0,0},

251 {"sÜt",
sÜtCommªd
,-2,"wm",0,
sÜtG‘Keys
,1,1,1,0,0},

252 {"šfo",
šfoCommªd
,-1,"É",0,
NULL
,0,0,0,0,0},

253 {"mÚ™Ü",
mÚ™ÜCommªd
,1,"as",0,
NULL
,0,0,0,0,0},

254 {"‰l",
‰lCommªd
,2,"rF",0,
NULL
,1,1,1,0,0},

255 {"touch",
touchCommªd
,-2,"rF",0,
NULL
,1,1,1,0,0},

256 {"±",
±Commªd
,2,"rF",0,
NULL
,1,1,1,0,0},

257 {"³rsi¡",
³rsi¡Commªd
,2,"wF",0,
NULL
,1,1,1,0,0},

258 {"¦aveof",
¦aveofCommªd
,3,"a¡",0,
NULL
,0,0,0,0,0},

259 {"rŞe",
rŞeCommªd
,1,"l¡",0,
NULL
,0,0,0,0,0},

260 {"debug",
debugCommªd
,-1,"as",0,
NULL
,0,0,0,0,0},

261 {"cÚfig",
cÚfigCommªd
,-2,"Ït",0,
NULL
,0,0,0,0,0},

262 {"subsüibe",
subsüibeCommªd
,-2,"p¦t",0,
NULL
,0,0,0,0,0},

263 {"unsubsüibe",
unsubsüibeCommªd
,-1,"p¦t",0,
NULL
,0,0,0,0,0},

264 {"psubsüibe",
psubsüibeCommªd
,-2,"p¦t",0,
NULL
,0,0,0,0,0},

265 {"punsubsüibe",
punsubsüibeCommªd
,-1,"p¦t",0,
NULL
,0,0,0,0,0},

266 {"publish",
publishCommªd
,3,"¶tF",0,
NULL
,0,0,0,0,0},

267 {"pubsub",
pubsubCommªd
,-2,"¶tR",0,
NULL
,0,0,0,0,0},

268 {"w©ch",
w©chCommªd
,-2,"sF",0,
NULL
,1,-1,1,0,0},

269 {"unw©ch",
unw©chCommªd
,1,"sF",0,
NULL
,0,0,0,0,0},

270 {"şu¡”",
şu¡”Commªd
,-2,"a",0,
NULL
,0,0,0,0,0},

271 {"»¡Üe",
»¡ÜeCommªd
,-4,"wm",0,
NULL
,1,1,1,0,0},

272 {"»¡Üe-askšg",
»¡ÜeCommªd
,-4,"wmk",0,
NULL
,1,1,1,0,0},

273 {"mig¿‹",
mig¿‹Commªd
,-6,"w",0,
mig¿‹G‘Keys
,0,0,0,0,0},

274 {"askšg",
askšgCommªd
,1,"F",0,
NULL
,0,0,0,0,0},

275 {"»adÚly",
»adÚlyCommªd
,1,"F",0,
NULL
,0,0,0,0,0},

276 {"»adwr™e",
»adwr™eCommªd
,1,"F",0,
NULL
,0,0,0,0,0},

277 {"dump",
dumpCommªd
,2,"r",0,
NULL
,1,1,1,0,0},

278 {"objeù",
objeùCommªd
,3,"r",0,
NULL
,2,2,2,0,0},

279 {"memÜy",
memÜyCommªd
,-2,"r",0,
NULL
,0,0,0,0,0},

280 {"ş›Á",
ş›ÁCommªd
,-2,"as",0,
NULL
,0,0,0,0,0},

281 {"ev®",
ev®Commªd
,-3,"s",0,
ev®G‘Keys
,0,0,0,0,0},

282 {"ev®sha",
ev®ShaCommªd
,-3,"s",0,
ev®G‘Keys
,0,0,0,0,0},

283 {"¦owlog",
¦owlogCommªd
,-2,"a",0,
NULL
,0,0,0,0,0},

284 {"süt",
sütCommªd
,-2,"s",0,
NULL
,0,0,0,0,0},

285 {"time",
timeCommªd
,1,"RF",0,
NULL
,0,0,0,0,0},

286 {"b™İ",
b™İCommªd
,-4,"wm",0,
NULL
,2,-1,1,0,0},

287 {"b™couÁ",
b™couÁCommªd
,-2,"r",0,
NULL
,1,1,1,0,0},

288 {"b™pos",
b™posCommªd
,-3,"r",0,
NULL
,1,1,1,0,0},

289 {"wa™",
wa™Commªd
,3,"s",0,
NULL
,0,0,0,0,0},

290 {"commªd",
commªdCommªd
,0,"É",0,
NULL
,0,0,0,0,0},

291 {"geßdd",
geßddCommªd
,-5,"wm",0,
NULL
,1,1,1,0,0},

292 {"geÜadius",
geÜadiusCommªd
,-6,"w",0,
NULL
,1,1,1,0,0},

293 {"geÜadiusbymemb”",
geÜadiusByMemb”Commªd
,-5,"w",0,
NULL
,1,1,1,0,0},

294 {"geohash",
geohashCommªd
,-2,"r",0,
NULL
,1,1,1,0,0},

295 {"geİos",
geİosCommªd
,-2,"r",0,
NULL
,1,1,1,0,0},

296 {"geodi¡",
geodi¡Commªd
,-4,"r",0,
NULL
,1,1,1,0,0},

297 {"pf£láe¡",
pf£láe¡Commªd
,1,"a",0,
NULL
,0,0,0,0,0},

298 {"pçdd",
pçddCommªd
,-2,"wmF",0,
NULL
,1,1,1,0,0},

299 {"pfcouÁ",
pfcouÁCommªd
,-2,"r",0,
NULL
,1,-1,1,0,0},

300 {"pfm”ge",
pfm”geCommªd
,-2,"wm",0,
NULL
,1,-1,1,0,0},

301 {"pfdebug",
pfdebugCommªd
,-3,"w",0,
NULL
,0,0,0,0,0},

302 {"po¡",
£cur™yW¬nšgCommªd
,-1,"É",0,
NULL
,0,0,0,0,0},

303 {"ho¡:",
£cur™yW¬nšgCommªd
,-1,"É",0,
NULL
,0,0,0,0,0},

304 {"Ï‹ncy",
Ï‹ncyCommªd
,-2,"a¦t",0,
NULL
,0,0,0,0,0}

311 
	$£rv”LogRaw
(
Ëv–
, cÚ¡ *
msg
) {

312 cÚ¡ 
sy¦ogLev–M­
[] = { 
LOG_DEBUG
, 
LOG_INFO
, 
LOG_NOTICE
, 
LOG_WARNING
 };

313 cÚ¡ *
c
 = ".-*#";

314 
FILE
 *
å
;

315 
buf
[64];

316 
¿wmode
 = (
Ëv–
 & 
LL_RAW
);

317 
log_to_¡dout
 = 
£rv”
.
logfe
[0] == '\0';

319 
Ëv–
 &= 0xff;

320 ià(
Ëv–
 < 
£rv”
.
v”bos™y
) ;

322 
å
 = 
log_to_¡dout
 ? 
¡dout
 : 
	`fİ’
(
£rv”
.
logfe
,"a");

323 ià(!
å
) ;

325 ià(
¿wmode
) {

326 
	`årštf
(
å
,"%s",
msg
);

328 
off
;

329 
timev®
 
tv
;

330 
rŞe_ch¬
;

331 
pid_t
 
pid
 = 
	`g‘pid
();

333 
	`g‘timeofday
(&
tv
,
NULL
);

334 
off
 = 
	`¡ráime
(
buf
,(buf),"%d %b %H:%M:%S.",
	`loÿÉime
(&
tv
.
tv_£c
));

335 
	`¢´štf
(
buf
+
off
,(buf)-off,"%03d",()
tv
.
tv_u£c
/1000);

336 ià(
£rv”
.
£Áš–_mode
) {

337 
rŞe_ch¬
 = 'X';

338 } ià(
pid
 !ğ
£rv”
.pid) {

339 
rŞe_ch¬
 = 'C';

341 
rŞe_ch¬
 = (
£rv”
.
ma¡”ho¡
 ? 'S':'M');

343 
	`årštf
(
å
,"%d:%c %s %c %s\n",

344 ()
	`g‘pid
(),
rŞe_ch¬
, 
buf
,
c
[
Ëv–
],
msg
);

346 
	`fæush
(
å
);

348 ià(!
log_to_¡dout
è
	`fşo£
(
å
);

349 ià(
£rv”
.
sy¦og_’abËd
è
	`sy¦og
(
sy¦ogLev–M­
[
Ëv–
], "%s", 
msg
);

350 
	}
}

355 
	$£rv”Log
(
Ëv–
, cÚ¡ *
fmt
, ...) {

356 
va_li¡
 
­
;

357 
msg
[
LOG_MAX_LEN
];

359 ià((
Ëv–
&0xffè< 
£rv”
.
v”bos™y
) ;

361 
	`va_¡¬t
(
­
, 
fmt
);

362 
	`v¢´štf
(
msg
, (msg), 
fmt
, 
­
);

363 
	`va_’d
(
­
);

365 
	`£rv”LogRaw
(
Ëv–
,
msg
);

366 
	}
}

374 
	$£rv”LogFromHªdËr
(
Ëv–
, cÚ¡ *
msg
) {

375 
fd
;

376 
log_to_¡dout
 = 
£rv”
.
logfe
[0] == '\0';

377 
buf
[64];

379 ià((
Ëv–
&0xffè< 
£rv”
.
v”bos™y
 || (
log_to_¡dout
 && s”v”.
d«mÚize
))

381 
fd
 = 
log_to_¡dout
 ? 
STDOUT_FILENO
 :

382 
	`İ’
(
£rv”
.
logfe
, 
O_APPEND
|
O_CREAT
|
O_WRONLY
, 0644);

383 ià(
fd
 == -1) ;

384 
	`Î2¡ršg
(
buf
,(buf),
	`g‘pid
());

385 ià(
	`wr™e
(
fd
,
buf
,
	`¡¾’
(buf)è=ğ-1è
”r
;

386 ià(
	`wr™e
(
fd
,":sigÇl-hªdË¸(",17è=ğ-1è
”r
;

387 
	`Î2¡ršg
(
buf
,(buf),
	`time
(
NULL
));

388 ià(
	`wr™e
(
fd
,
buf
,
	`¡¾’
(buf)è=ğ-1è
”r
;

389 ià(
	`wr™e
(
fd
,"è",2è=ğ-1è
”r
;

390 ià(
	`wr™e
(
fd
,
msg
,
	`¡¾’
(msg)è=ğ-1è
”r
;

391 ià(
	`wr™e
(
fd
,"\n",1è=ğ-1è
”r
;

392 
”r
:

393 ià(!
log_to_¡dout
è
	`şo£
(
fd
);

394 
	}
}

397 
	$u¡ime
() {

398 
timev®
 
tv
;

399 
u¡
;

401 
	`g‘timeofday
(&
tv
, 
NULL
);

402 
u¡
 = (()
tv
.
tv_£c
)*1000000;

403 
u¡
 +ğ
tv
.
tv_u£c
;

404  
u¡
;

405 
	}
}

408 
m¡ime_t
 
	$m¡ime
() {

409  
	`u¡ime
()/1000;

410 
	}
}

416 
	$ex™FromChd
(
»tcode
) {

417 #ifdeà
COVERAGE_TEST


418 
	`ex™
(
»tcode
);

420 
	`_ex™
(
»tcode
);

422 
	}
}

430 
	$diùVªÏF»e
(*
´ivd©a
, *
v®
)

432 
	`DICT_NOTUSED
(
´ivd©a
);

433 
	`zä“
(
v®
);

434 
	}
}

436 
	$diùLi¡De¡ruùÜ
(*
´ivd©a
, *
v®
)

438 
	`DICT_NOTUSED
(
´ivd©a
);

439 
	`li¡R–—£
((
li¡
*)
v®
);

440 
	}
}

442 
	$diùSdsKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
,

443 cÚ¡ *
key2
)

445 
l1
,
l2
;

446 
	`DICT_NOTUSED
(
´ivd©a
);

448 
l1
 = 
	`sd¦’
((
sds
)
key1
);

449 
l2
 = 
	`sd¦’
((
sds
)
key2
);

450 ià(
l1
 !ğ
l2
)  0;

451  
	`memcmp
(
key1
, 
key2
, 
l1
) == 0;

452 
	}
}

456 
	$diùSdsKeyCa£Com·»
(*
´ivd©a
, cÚ¡ *
key1
,

457 cÚ¡ *
key2
)

459 
	`DICT_NOTUSED
(
´ivd©a
);

461  
	`¡rÿ£cmp
(
key1
, 
key2
) == 0;

462 
	}
}

464 
	$diùObjeùDe¡ruùÜ
(*
´ivd©a
, *
v®
)

466 
	`DICT_NOTUSED
(
´ivd©a
);

468 ià(
v®
 =ğ
NULL
) ;

469 
	`deüRefCouÁ
(
v®
);

470 
	}
}

472 
	$diùSdsDe¡ruùÜ
(*
´ivd©a
, *
v®
)

474 
	`DICT_NOTUSED
(
´ivd©a
);

476 
	`sdsä“
(
v®
);

477 
	}
}

479 
	$diùObjKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
,

480 cÚ¡ *
key2
)

482 cÚ¡ 
robj
 *
o1
 = 
key1
, *
o2
 = 
key2
;

483  
	`diùSdsKeyCom·»
(
´ivd©a
,
o1
->
±r
,
o2
->ptr);

484 
	}
}

486 
	$diùObjHash
(cÚ¡ *
key
) {

487 cÚ¡ 
robj
 *
o
 = 
key
;

488  
	`diùG’HashFunùiÚ
(
o
->
±r
, 
	`sd¦’
((
sds
)o->ptr));

489 
	}
}

491 
	$diùSdsHash
(cÚ¡ *
key
) {

492  
	`diùG’HashFunùiÚ
((*)
key
, 
	`sd¦’
((*)key));

493 
	}
}

495 
	$diùSdsCa£Hash
(cÚ¡ *
key
) {

496  
	`diùG’Ca£HashFunùiÚ
((*)
key
, 
	`sd¦’
((*)key));

497 
	}
}

499 
	$diùEncObjKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
,

500 cÚ¡ *
key2
)

502 
robj
 *
o1
 = (robj*è
key1
, *
o2
 = (robj*è
key2
;

503 
cmp
;

505 ià(
o1
->
’codšg
 =ğ
OBJ_ENCODING_INT
 &&

506 
o2
->
’codšg
 =ğ
OBJ_ENCODING_INT
)

507  
o1
->
±r
 =ğ
o2
->ptr;

509 
o1
 = 
	`g‘DecodedObjeù
(o1);

510 
o2
 = 
	`g‘DecodedObjeù
(o2);

511 
cmp
 = 
	`diùSdsKeyCom·»
(
´ivd©a
,
o1
->
±r
,
o2
->ptr);

512 
	`deüRefCouÁ
(
o1
);

513 
	`deüRefCouÁ
(
o2
);

514  
cmp
;

515 
	}
}

517 
	$diùEncObjHash
(cÚ¡ *
key
) {

518 
robj
 *
o
 = (robj*è
key
;

520 ià(
	`sdsEncodedObjeù
(
o
)) {

521  
	`diùG’HashFunùiÚ
(
o
->
±r
, 
	`sd¦’
((
sds
)o->ptr));

523 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

524 
buf
[32];

525 
Ën
;

527 
Ën
 = 
	`Î2¡ršg
(
buf
,32,()
o
->
±r
);

528  
	`diùG’HashFunùiÚ
((*)
buf
, 
Ën
);

530 
hash
;

532 
o
 = 
	`g‘DecodedObjeù
(o);

533 
hash
 = 
	`diùG’HashFunùiÚ
(
o
->
±r
, 
	`sd¦’
((
sds
)o->ptr));

534 
	`deüRefCouÁ
(
o
);

535  
hash
;

538 
	}
}

542 
diùTy³
 
	gobjeùKeyPoš‹rV®ueDiùTy³
 = {

543 
diùEncObjHash
,

544 
NULL
,

545 
NULL
,

546 
diùEncObjKeyCom·»
,

547 
diùObjeùDe¡ruùÜ
,

548 
NULL


552 
diùTy³
 
	g£tDiùTy³
 = {

553 
diùSdsHash
,

554 
NULL
,

555 
NULL
,

556 
diùSdsKeyCom·»
,

557 
diùSdsDe¡ruùÜ
,

558 
NULL


562 
diùTy³
 
	gz£tDiùTy³
 = {

563 
diùSdsHash
,

564 
NULL
,

565 
NULL
,

566 
diùSdsKeyCom·»
,

567 
NULL
,

568 
NULL


572 
diùTy³
 
	gdbDiùTy³
 = {

573 
diùSdsHash
,

574 
NULL
,

575 
NULL
,

576 
diùSdsKeyCom·»
,

577 
diùSdsDe¡ruùÜ
,

578 
diùObjeùDe¡ruùÜ


582 
diùTy³
 
	gshaSütObjeùDiùTy³
 = {

583 
diùSdsCa£Hash
,

584 
NULL
,

585 
NULL
,

586 
diùSdsKeyCa£Com·»
,

587 
diùSdsDe¡ruùÜ
,

588 
diùObjeùDe¡ruùÜ


592 
diùTy³
 
	gkey±rDiùTy³
 = {

593 
diùSdsHash
,

594 
NULL
,

595 
NULL
,

596 
diùSdsKeyCom·»
,

597 
NULL
,

598 
NULL


602 
diùTy³
 
	gcommªdTabËDiùTy³
 = {

603 
diùSdsCa£Hash
,

604 
NULL
,

605 
NULL
,

606 
diùSdsKeyCa£Com·»
,

607 
diùSdsDe¡ruùÜ
,

608 
NULL


612 
diùTy³
 
	ghashDiùTy³
 = {

613 
diùSdsHash
,

614 
NULL
,

615 
NULL
,

616 
diùSdsKeyCom·»
,

617 
diùSdsDe¡ruùÜ
,

618 
diùSdsDe¡ruùÜ


624 
diùTy³
 
	gkeyli¡DiùTy³
 = {

625 
diùObjHash
,

626 
NULL
,

627 
NULL
,

628 
diùObjKeyCom·»
,

629 
diùObjeùDe¡ruùÜ
,

630 
diùLi¡De¡ruùÜ


635 
diùTy³
 
	gşu¡”NodesDiùTy³
 = {

636 
diùSdsHash
,

637 
NULL
,

638 
NULL
,

639 
diùSdsKeyCom·»
,

640 
diùSdsDe¡ruùÜ
,

641 
NULL


647 
diùTy³
 
	gşu¡”NodesBÏckLi¡DiùTy³
 = {

648 
diùSdsCa£Hash
,

649 
NULL
,

650 
NULL
,

651 
diùSdsKeyCa£Com·»
,

652 
diùSdsDe¡ruùÜ
,

653 
NULL


659 
diùTy³
 
	gmoduËsDiùTy³
 = {

660 
diùSdsCa£Hash
,

661 
NULL
,

662 
NULL
,

663 
diùSdsKeyCa£Com·»
,

664 
diùSdsDe¡ruùÜ
,

665 
NULL


669 
diùTy³
 
	gmig¿‹CacheDiùTy³
 = {

670 
diùSdsHash
,

671 
NULL
,

672 
NULL
,

673 
diùSdsKeyCom·»
,

674 
diùSdsDe¡ruùÜ
,

675 
NULL


681 
diùTy³
 
	g»¶SütCacheDiùTy³
 = {

682 
diùSdsCa£Hash
,

683 
NULL
,

684 
NULL
,

685 
diùSdsKeyCa£Com·»
,

686 
diùSdsDe¡ruùÜ
,

687 
NULL


690 
	$htN“dsResize
(
diù
 *dict) {

691 
size
, 
u£d
;

693 
size
 = 
	`diùSlÙs
(
diù
);

694 
u£d
 = 
	`diùSize
(
diù
);

695  (
size
 > 
DICT_HT_INITIAL_SIZE
 &&

696 (
u£d
*100/
size
 < 
HASHTABLE_MIN_FILL
));

697 
	}
}

701 
	$ŒyResizeHashTabËs
(
dbid
) {

702 ià(
	`htN“dsResize
(
£rv”
.
db
[
dbid
].
diù
))

703 
	`diùResize
(
£rv”
.
db
[
dbid
].
diù
);

704 ià(
	`htN“dsResize
(
£rv”
.
db
[
dbid
].
expœes
))

705 
	`diùResize
(
£rv”
.
db
[
dbid
].
expœes
);

706 
	}
}

715 
	$šüem’ÎyRehash
(
dbid
) {

717 ià(
	`diùIsRehashšg
(
£rv”
.
db
[
dbid
].
diù
)) {

718 
	`diùRehashMli£cÚds
(
£rv”
.
db
[
dbid
].
diù
,1);

722 ià(
	`diùIsRehashšg
(
£rv”
.
db
[
dbid
].
expœes
)) {

723 
	`diùRehashMli£cÚds
(
£rv”
.
db
[
dbid
].
expœes
,1);

727 
	}
}

735 
	$upd©eDiùResizePŞicy
() {

736 ià(
£rv”
.
rdb_chd_pid
 =ğ-1 && s”v”.
aof_chd_pid
 == -1)

737 
	`diùEÇbËResize
();

739 
	`diùDi§bËResize
();

740 
	}
}

745 
	$ŒackIn¡ªÃousM‘ric
(
m‘ric
, 
cu¼’t_»adšg
) {

746 
t
 = 
	`m¡ime
(è- 
£rv”
.
š¡_m‘ric
[
m‘ric
].
Ï¡_§m¶e_time
;

747 
İs
 = 
cu¼’t_»adšg
 -

748 
£rv”
.
š¡_m‘ric
[
m‘ric
].
Ï¡_§m¶e_couÁ
;

749 
İs_£c
;

751 
İs_£c
 = 
t
 > 0 ? (
İs
*1000/t) : 0;

753 
£rv”
.
š¡_m‘ric
[
m‘ric
].
§m¶es
[£rv”.š¡_m‘ric[m‘ric].
idx
] =

754 
İs_£c
;

755 
£rv”
.
š¡_m‘ric
[
m‘ric
].
idx
++;

756 
£rv”
.
š¡_m‘ric
[
m‘ric
].
idx
 %ğ
STATS_METRIC_SAMPLES
;

757 
£rv”
.
š¡_m‘ric
[
m‘ric
].
Ï¡_§m¶e_time
 = 
	`m¡ime
();

758 
£rv”
.
š¡_m‘ric
[
m‘ric
].
Ï¡_§m¶e_couÁ
 = 
cu¼’t_»adšg
;

759 
	}
}

762 
	$g‘In¡ªÃousM‘ric
(
m‘ric
) {

763 
j
;

764 
sum
 = 0;

766 
j
 = 0; j < 
STATS_METRIC_SAMPLES
; j++)

767 
sum
 +ğ
£rv”
.
š¡_m‘ric
[
m‘ric
].
§m¶es
[
j
];

768  
sum
 / 
STATS_METRIC_SAMPLES
;

769 
	}
}

775 
	$ş›ÁsCrÚHªdËTimeout
(
ş›Á
 *
c
, 
m¡ime_t
 
now_ms
) {

776 
time_t
 
now
 = 
now_ms
/1000;

778 ià(
£rv”
.
maxidËtime
 &&

779 !(
c
->
æags
 & 
CLIENT_SLAVE
) &&

780 !(
c
->
æags
 & 
CLIENT_MASTER
) &&

781 !(
c
->
æags
 & 
CLIENT_BLOCKED
) &&

782 !(
c
->
æags
 & 
CLIENT_PUBSUB
) &&

783 (
now
 - 
c
->
Ï¡š‹¿ùiÚ
 > 
£rv”
.
maxidËtime
))

785 
	`£rv”Log
(
LL_VERBOSE
,"Closing idle client");

786 
	`ä“Cl›Á
(
c
);

788 } ià(
c
->
æags
 & 
CLIENT_BLOCKED
) {

793 ià(
c
->
bpİ
.
timeout
 !ğ0 && c->bpİ.timeouˆ< 
now_ms
) {

795 
	`»¶yToBlockedCl›ÁTimedOut
(
c
);

796 
	`unblockCl›Á
(
c
);

797 } ià(
£rv”
.
şu¡”_’abËd
) {

800 ià(
	`şu¡”RedœeùBlockedCl›ÁIfN“ded
(
c
))

801 
	`unblockCl›Á
(
c
);

805 
	}
}

811 
	$ş›ÁsCrÚResizeQu”yBufãr
(
ş›Á
 *
c
) {

812 
size_t
 
qu”ybuf_size
 = 
	`sdsAÎocSize
(
c
->
qu”ybuf
);

813 
time_t
 
idËtime
 = 
£rv”
.
unixtime
 - 
c
->
Ï¡š‹¿ùiÚ
;

818 ià(((
qu”ybuf_size
 > 
PROTO_MBULK_BIG_ARG
) &&

819 (
qu”ybuf_size
/(
c
->
qu”ybuf_³ak
+1)) > 2) ||

820 (
qu”ybuf_size
 > 1024 && 
idËtime
 > 2))

823 ià(
	`sd§va
(
c
->
qu”ybuf
) > 1024) {

824 
c
->
qu”ybuf
 = 
	`sdsRemoveF»eS·û
(c->querybuf);

829 
c
->
qu”ybuf_³ak
 = 0;

831 
	}
}

833 
	#CLIENTS_CRON_MIN_ITERATIONS
 5

	)

834 
	$ş›ÁsCrÚ
() {

839 
numş›Ás
 = 
	`li¡L’gth
(
£rv”
.
ş›Ás
);

840 
™”©iÚs
 = 
numş›Ás
/
£rv”
.
hz
;

841 
m¡ime_t
 
now
 = 
	`m¡ime
();

846 ià(
™”©iÚs
 < 
CLIENTS_CRON_MIN_ITERATIONS
)

847 
™”©iÚs
 = (
numş›Ás
 < 
CLIENTS_CRON_MIN_ITERATIONS
) ?

848 
numş›Ás
 : 
CLIENTS_CRON_MIN_ITERATIONS
;

850 
	`li¡L’gth
(
£rv”
.
ş›Ás
è&& 
™”©iÚs
--) {

851 
ş›Á
 *
c
;

852 
li¡Node
 *
h—d
;

857 
	`li¡RÙ©e
(
£rv”
.
ş›Ás
);

858 
h—d
 = 
	`li¡Fœ¡
(
£rv”
.
ş›Ás
);

859 
c
 = 
	`li¡NodeV®ue
(
h—d
);

863 ià(
	`ş›ÁsCrÚHªdËTimeout
(
c
,
now
)) ;

864 ià(
	`ş›ÁsCrÚResizeQu”yBufãr
(
c
)) ;

866 
	}
}

871 
	$d©aba£sCrÚ
() {

874 ià(
£rv”
.
aùive_expœe_’abËd
 && s”v”.
ma¡”ho¡
 =ğ
NULL
)

875 
	`aùiveExpœeCyşe
(
ACTIVE_EXPIRE_CYCLE_SLOW
);

880 ià(
£rv”
.
rdb_chd_pid
 =ğ-1 && s”v”.
aof_chd_pid
 == -1) {

884 
»size_db
 = 0;

885 
»hash_db
 = 0;

886 
dbs_³r_ÿÎ
 = 
CRON_DBS_PER_CALL
;

887 
j
;

890 ià(
dbs_³r_ÿÎ
 > 
£rv”
.
dbnum
) dbs_per_call = server.dbnum;

893 
j
 = 0; j < 
dbs_³r_ÿÎ
; j++) {

894 
	`ŒyResizeHashTabËs
(
»size_db
 % 
£rv”
.
dbnum
);

895 
»size_db
++;

899 ià(
£rv”
.
aùiv”ehashšg
) {

900 
j
 = 0; j < 
dbs_³r_ÿÎ
; j++) {

901 
wÜk_dÚe
 = 
	`šüem’ÎyRehash
(
»hash_db
 % 
£rv”
.
dbnum
);

902 
»hash_db
++;

903 ià(
wÜk_dÚe
) {

911 
	}
}

917 
	$upd©eCachedTime
() {

918 
£rv”
.
unixtime
 = 
	`time
(
NULL
);

919 
£rv”
.
m¡ime
 = 
	`m¡ime
();

920 
	}
}

941 
	$£rv”CrÚ
(
«Ev’tLoİ
 *
ev’tLoİ
, 
id
, *
ş›ÁD©a
) {

942 
j
;

943 
	`UNUSED
(
ev’tLoİ
);

944 
	`UNUSED
(
id
);

945 
	`UNUSED
(
ş›ÁD©a
);

949 ià(
£rv”
.
w©chdog_³riod
è
	`w©chdogScheduËSigÇl
(server.watchdog_period);

952 
	`upd©eCachedTime
();

954 
	`run_w™h_³riod
(100) {

955 
	`ŒackIn¡ªÃousM‘ric
(
STATS_METRIC_COMMAND
,
£rv”
.
¡©_numcommªds
);

956 
	`ŒackIn¡ªÃousM‘ric
(
STATS_METRIC_NET_INPUT
,

957 
£rv”
.
¡©_Ãt_šput_by‹s
);

958 
	`ŒackIn¡ªÃousM‘ric
(
STATS_METRIC_NET_OUTPUT
,

959 
£rv”
.
¡©_Ãt_ouut_by‹s
);

973 
£rv”
.
Ìuşock
 = 
	`g‘LRUClock
();

976 ià(
	`zm®loc_u£d_memÜy
(è> 
£rv”
.
¡©_³ak_memÜy
)

977 
£rv”
.
¡©_³ak_memÜy
 = 
	`zm®loc_u£d_memÜy
();

980 
£rv”
.
»sid’t_£t_size
 = 
	`zm®loc_g‘_rss
();

984 ià(
£rv”
.
shutdown_a§p
) {

985 ià(
	`´•¬eFÜShutdown
(
SHUTDOWN_NOFLAGS
è=ğ
C_OK
è
	`ex™
(0);

986 
	`£rv”Log
(
LL_WARNING
,"SIGTERM„eceived butƒrrorsryingo shut downhe server, checkhe†ogs for more information");

987 
£rv”
.
shutdown_a§p
 = 0;

991 
	`run_w™h_³riod
(5000) {

992 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

993 
size
, 
u£d
, 
vkeys
;

995 
size
 = 
	`diùSlÙs
(
£rv”
.
db
[
j
].
diù
);

996 
u£d
 = 
	`diùSize
(
£rv”
.
db
[
j
].
diù
);

997 
vkeys
 = 
	`diùSize
(
£rv”
.
db
[
j
].
expœes
);

998 ià(
u£d
 || 
vkeys
) {

999 
	`£rv”Log
(
LL_VERBOSE
,"DB %d: %Îd key (%Îd vŞ©eèš %Îd slÙ HT.",
j
,
u£d
,
vkeys
,
size
);

1006 ià(!
£rv”
.
£Áš–_mode
) {

1007 
	`run_w™h_³riod
(5000) {

1008 
	`£rv”Log
(
LL_VERBOSE
,

1010 
	`li¡L’gth
(
£rv”
.
ş›Ás
)-li¡L’gth(£rv”.
¦aves
),

1011 
	`li¡L’gth
(
£rv”
.
¦aves
),

1012 
	`zm®loc_u£d_memÜy
());

1017 
	`ş›ÁsCrÚ
();

1020 
	`d©aba£sCrÚ
();

1024 ià(
£rv”
.
rdb_chd_pid
 =ğ-1 && s”v”.
aof_chd_pid
 == -1 &&

1025 
£rv”
.
aof_»wr™e_scheduËd
)

1027 
	`»wr™eAµ’dOÆyFeBackground
();

1031 ià(
£rv”
.
rdb_chd_pid
 !ğ-1 || s”v”.
aof_chd_pid
 != -1 ||

1032 
	`ldbP’dšgChd»n
())

1034 
¡©loc
;

1035 
pid_t
 
pid
;

1037 ià((
pid
 = 
	`wa™3
(&
¡©loc
,
WNOHANG
,
NULL
)) != 0) {

1038 
ex™code
 = 
	`WEXITSTATUS
(
¡©loc
);

1039 
bysigÇl
 = 0;

1041 ià(
	`WIFSIGNALED
(
¡©loc
)è
bysigÇl
 = 
	`WTERMSIG
(statloc);

1043 ià(
pid
 == -1) {

1044 
	`£rv”Log
(
LL_WARNING
,"wait3()„eturned‡nƒrror: %s. "

1046 
	`¡»¼Ü
(
”ºo
),

1047 (è
£rv”
.
rdb_chd_pid
,

1048 (è
£rv”
.
aof_chd_pid
);

1049 } ià(
pid
 =ğ
£rv”
.
rdb_chd_pid
) {

1050 
	`backgroundSaveDÚeHªdËr
(
ex™code
,
bysigÇl
);

1051 ià(!
bysigÇl
 && 
ex™code
 =ğ0è
	`»ûiveChdInfo
();

1052 } ià(
pid
 =ğ
£rv”
.
aof_chd_pid
) {

1053 
	`backgroundRewr™eDÚeHªdËr
(
ex™code
,
bysigÇl
);

1054 ià(!
bysigÇl
 && 
ex™code
 =ğ0è
	`»ûiveChdInfo
();

1056 ià(!
	`ldbRemoveChd
(
pid
)) {

1057 
	`£rv”Log
(
LL_WARNING
,

1059 ()
pid
);

1062 
	`upd©eDiùResizePŞicy
();

1063 
	`şo£ChdInfoPe
();

1068 
j
 = 0; j < 
£rv”
.
§v•¬am¦’
; j++) {

1069 
§v•¬am
 *
¥
 = 
£rv”
.
§v•¬ams
+
j
;

1075 ià(
£rv”
.
dœty
 >ğ
¥
->
chªges
 &&

1076 
£rv”
.
unixtime
-£rv”.
Ï¡§ve
 > 
¥
->
£cÚds
 &&

1077 (
£rv”
.
unixtime
-£rv”.
Ï¡bg§ve_Œy
 >

1078 
CONFIG_BGSAVE_RETRY_DELAY
 ||

1079 
£rv”
.
Ï¡bg§ve_¡©us
 =ğ
C_OK
))

1081 
	`£rv”Log
(
LL_NOTICE
,"%d changes in %d seconds. Saving...",

1082 
¥
->
chªges
, ()¥->
£cÚds
);

1083 
	`rdbSaveBackground
(
£rv”
.
rdb_f’ame
);

1089 ià(
£rv”
.
rdb_chd_pid
 == -1 &&

1090 
£rv”
.
aof_chd_pid
 == -1 &&

1091 
£rv”
.
aof_»wr™e_³rc
 &&

1092 
£rv”
.
aof_cu¼’t_size
 > s”v”.
aof_»wr™e_mš_size
)

1094 
ba£
 = 
£rv”
.
aof_»wr™e_ba£_size
 ?

1095 
£rv”
.
aof_»wr™e_ba£_size
 : 1;

1096 
growth
 = (
£rv”
.
aof_cu¼’t_size
*100/
ba£
) - 100;

1097 ià(
growth
 >ğ
£rv”
.
aof_»wr™e_³rc
) {

1098 
	`£rv”Log
(
LL_NOTICE
,"S¹šg‡utom©iø»wr™šg oàAOF oÀ%Îd%% growth",
growth
);

1099 
	`»wr™eAµ’dOÆyFeBackground
();

1107 ià(
£rv”
.
aof_æush_po¡pÚed_¡¬t
è
	`æushAµ’dOÆyFe
(0);

1113 
	`run_w™h_³riod
(1000) {

1114 ià(
£rv”
.
aof_Ï¡_wr™e_¡©us
 =ğ
C_ERR
)

1115 
	`æushAµ’dOÆyFe
(0);

1119 
	`ä“Cl›ÁsInAsyncF»eQueue
();

1122 
	`ş›ÁsA»Pau£d
();

1126 
	`run_w™h_³riod
(1000è
	`»¶iÿtiÚCrÚ
();

1129 
	`run_w™h_³riod
(100) {

1130 ià(
£rv”
.
şu¡”_’abËd
è
	`şu¡”CrÚ
();

1134 
	`run_w™h_³riod
(100) {

1135 ià(
£rv”
.
£Áš–_mode
è
	`£Áš–Tim”
();

1139 
	`run_w™h_³riod
(1000) {

1140 
	`mig¿‹Clo£TimedoutSock‘s
();

1150 ià(
£rv”
.
rdb_chd_pid
 =ğ-1 && s”v”.
aof_chd_pid
 == -1 &&

1151 
£rv”
.
rdb_bg§ve_scheduËd
 &&

1152 (
£rv”
.
unixtime
-£rv”.
Ï¡bg§ve_Œy
 > 
CONFIG_BGSAVE_RETRY_DELAY
 ||

1153 
£rv”
.
Ï¡bg§ve_¡©us
 =ğ
C_OK
))

1155 ià(
	`rdbSaveBackground
(
£rv”
.
rdb_f’ame
è=ğ
C_OK
)

1156 
£rv”
.
rdb_bg§ve_scheduËd
 = 0;

1159 
£rv”
.
üÚloİs
++;

1160  1000/
£rv”
.
hz
;

1161 
	}
}

1166 
	$befÜeSË•
(
«Ev’tLoİ
 *
ev’tLoİ
) {

1167 
	`UNUSED
(
ev’tLoİ
);

1173 ià(
£rv”
.
şu¡”_’abËd
è
	`şu¡”BefÜeSË•
();

1177 ià(
£rv”
.
aùive_expœe_’abËd
 && s”v”.
ma¡”ho¡
 =ğ
NULL
)

1178 
	`aùiveExpœeCyşe
(
ACTIVE_EXPIRE_CYCLE_FAST
);

1182 ià(
£rv”
.
g‘_ack_äom_¦aves
) {

1183 
robj
 *
¬gv
[3];

1185 
¬gv
[0] = 
	`ü—‹SŒšgObjeù
("REPLCONF",8);

1186 
¬gv
[1] = 
	`ü—‹SŒšgObjeù
("GETACK",6);

1187 
¬gv
[2] = 
	`ü—‹SŒšgObjeù
("*",1);

1188 
	`»¶iÿtiÚF“dSÏves
(
£rv”
.
¦aves
, s”v”.
¦ave£ldb
, 
¬gv
, 3);

1189 
	`deüRefCouÁ
(
¬gv
[0]);

1190 
	`deüRefCouÁ
(
¬gv
[1]);

1191 
	`deüRefCouÁ
(
¬gv
[2]);

1192 
£rv”
.
g‘_ack_äom_¦aves
 = 0;

1197 ià(
	`li¡L’gth
(
£rv”
.
ş›Ás_wa™šg_acks
))

1198 
	`´oûssCl›ÁsWa™šgR•liÿs
();

1201 ià(
	`li¡L’gth
(
£rv”
.
unblocked_ş›Ás
))

1202 
	`´oûssUnblockedCl›Ás
();

1205 
	`æushAµ’dOÆyFe
(0);

1208 
	`hªdËCl›ÁsW™hP’dšgWr™es
();

1209 
	}
}

1213 
	$ü—‹Sh¬edObjeùs
() {

1214 
j
;

1216 
sh¬ed
.
ülf
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("\r\n"));

1217 
sh¬ed
.
ok
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("+OK\r\n"));

1218 
sh¬ed
.
”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("-ERR\r\n"));

1219 
sh¬ed
.
em±ybulk
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("$0\r\n\r\n"));

1220 
sh¬ed
.
cz”o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(":0\r\n"));

1221 
sh¬ed
.
cÚe
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(":1\r\n"));

1222 
sh¬ed
.
úegÚe
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(":-1\r\n"));

1223 
sh¬ed
.
nuÎbulk
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("$-1\r\n"));

1224 
sh¬ed
.
nuÎmuÉibulk
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("*-1\r\n"));

1225 
sh¬ed
.
em±ymuÉibulk
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("*0\r\n"));

1226 
sh¬ed
.
pÚg
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("+PONG\r\n"));

1227 
sh¬ed
.
queued
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("+QUEUED\r\n"));

1228 
sh¬ed
.
em±ysÿn
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("*2\r\n$1\r\n0\r\n*0\r\n"));

1229 
sh¬ed
.
wrÚgty³”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1231 
sh¬ed
.
nokey”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1233 
sh¬ed
.
syÁax”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1235 
sh¬ed
.
§meobjeù”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1237 
sh¬ed
.
outoäªg“¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1239 
sh¬ed
.
nosü‹¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1241 
sh¬ed
.
lßdšg”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1243 
sh¬ed
.
¦owsü‹¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1245 
sh¬ed
.
ma¡”dowÃ¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1247 
sh¬ed
.
bg§v“¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1249 
sh¬ed
.
ro¦av“¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1251 
sh¬ed
.
nßuth”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1253 
sh¬ed
.
oom”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1255 
sh¬ed
.
exeÿbÜ‹¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1257 
sh¬ed
.
nÜ•liÿ£¼
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1259 
sh¬ed
.
busykey”r
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(

1261 
sh¬ed
.
¥aû
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(" "));

1262 
sh¬ed
.
cŞÚ
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
(":"));

1263 
sh¬ed
.
¶us
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ew
("+"));

1265 
j
 = 0; j < 
PROTO_SHARED_SELECT_CMDS
; j++) {

1266 
diùid_¡r
[64];

1267 
diùid_Ën
;

1269 
diùid_Ën
 = 
	`Î2¡ršg
(
diùid_¡r
,(diùid_¡r),
j
);

1270 
sh¬ed
.
£Ëù
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,

1271 
	`sdsÿrštf
(
	`sd£m±y
(),

1273 
diùid_Ën
, 
diùid_¡r
));

1275 
sh¬ed
.
mes§gebulk
 = 
	`ü—‹SŒšgObjeù
("$7\r\nmessage\r\n",13);

1276 
sh¬ed
.
pmes§gebulk
 = 
	`ü—‹SŒšgObjeù
("$8\r\npmessage\r\n",14);

1277 
sh¬ed
.
subsüibebulk
 = 
	`ü—‹SŒšgObjeù
("$9\r\nsubscribe\r\n",15);

1278 
sh¬ed
.
unsubsüibebulk
 = 
	`ü—‹SŒšgObjeù
("$11\r\nunsubscribe\r\n",18);

1279 
sh¬ed
.
psubsüibebulk
 = 
	`ü—‹SŒšgObjeù
("$10\r\npsubscribe\r\n",17);

1280 
sh¬ed
.
punsubsüibebulk
 = 
	`ü—‹SŒšgObjeù
("$12\r\npunsubscribe\r\n",19);

1281 
sh¬ed
.
d–
 = 
	`ü—‹SŒšgObjeù
("DEL",3);

1282 
sh¬ed
.
uÆšk
 = 
	`ü—‹SŒšgObjeù
("UNLINK",6);

1283 
sh¬ed
.
½İ
 = 
	`ü—‹SŒšgObjeù
("RPOP",4);

1284 
sh¬ed
.
Íİ
 = 
	`ü—‹SŒšgObjeù
("LPOP",4);

1285 
sh¬ed
.
Íush
 = 
	`ü—‹SŒšgObjeù
("LPUSH",5);

1286 
j
 = 0; j < 
OBJ_SHARED_INTEGERS
; j++) {

1287 
sh¬ed
.
š‹g”s
[
j
] =

1288 
	`makeObjeùSh¬ed
(
	`ü—‹Objeù
(
OBJ_STRING
,(*)()
j
));

1289 
sh¬ed
.
š‹g”s
[
j
]->
’codšg
 = 
OBJ_ENCODING_INT
;

1291 
j
 = 0; j < 
OBJ_SHARED_BULKHDR_LEN
; j++) {

1292 
sh¬ed
.
mbulkhdr
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,

1293 
	`sdsÿrštf
(
	`sd£m±y
(),"*%d\r\n",
j
));

1294 
sh¬ed
.
bulkhdr
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,

1295 
	`sdsÿrštf
(
	`sd£m±y
(),"$%d\r\n",
j
));

1301 
sh¬ed
.
mš¡ršg
 = 
	`sd¢ew
("minstring");

1302 
sh¬ed
.
max¡ršg
 = 
	`sd¢ew
("maxstring");

1303 
	}
}

1305 
	$š™S”v”CÚfig
() {

1306 
j
;

1308 
	`g‘RªdomHexCh¬s
(
£rv”
.
runid
,
CONFIG_RUN_ID_SIZE
);

1309 
£rv”
.
cÚfigfe
 = 
NULL
;

1310 
£rv”
.
execubË
 = 
NULL
;

1311 
£rv”
.
hz
 = 
CONFIG_DEFAULT_HZ
;

1312 
£rv”
.
runid
[
CONFIG_RUN_ID_SIZE
] = '\0';

1313 
£rv”
.
¬ch_b™s
 = (() == 8) ? 64 : 32;

1314 
£rv”
.
pÜt
 = 
CONFIG_DEFAULT_SERVER_PORT
;

1315 
£rv”
.
tı_backlog
 = 
CONFIG_DEFAULT_TCP_BACKLOG
;

1316 
£rv”
.
bšdaddr_couÁ
 = 0;

1317 
£rv”
.
unixsock‘
 = 
NULL
;

1318 
£rv”
.
unixsock‘³rm
 = 
CONFIG_DEFAULT_UNIX_SOCKET_PERM
;

1319 
£rv”
.
fd_couÁ
 = 0;

1320 
£rv”
.
sofd
 = -1;

1321 
£rv”
.
´Ùeùed_mode
 = 
CONFIG_DEFAULT_PROTECTED_MODE
;

1322 
£rv”
.
dbnum
 = 
CONFIG_DEFAULT_DBNUM
;

1323 
£rv”
.
v”bos™y
 = 
CONFIG_DEFAULT_VERBOSITY
;

1324 
£rv”
.
maxidËtime
 = 
CONFIG_DEFAULT_CLIENT_TIMEOUT
;

1325 
£rv”
.
tık“·live
 = 
CONFIG_DEFAULT_TCP_KEEPALIVE
;

1326 
£rv”
.
aùive_expœe_’abËd
 = 1;

1327 
£rv”
.
ş›Á_max_qu”ybuf_Ën
 = 
PROTO_MAX_QUERYBUF_LEN
;

1328 
£rv”
.
§v•¬ams
 = 
NULL
;

1329 
£rv”
.
lßdšg
 = 0;

1330 
£rv”
.
logfe
 = 
	`z¡rdup
(
CONFIG_DEFAULT_LOGFILE
);

1331 
£rv”
.
sy¦og_’abËd
 = 
CONFIG_DEFAULT_SYSLOG_ENABLED
;

1332 
£rv”
.
sy¦og_id’t
 = 
	`z¡rdup
(
CONFIG_DEFAULT_SYSLOG_IDENT
);

1333 
£rv”
.
sy¦og_çc™y
 = 
LOG_LOCAL0
;

1334 
£rv”
.
d«mÚize
 = 
CONFIG_DEFAULT_DAEMONIZE
;

1335 
£rv”
.
su³rvi£d
 = 0;

1336 
£rv”
.
su³rvi£d_mode
 = 
SUPERVISED_NONE
;

1337 
£rv”
.
aof_¡©e
 = 
AOF_OFF
;

1338 
£rv”
.
aof_fsync
 = 
CONFIG_DEFAULT_AOF_FSYNC
;

1339 
£rv”
.
aof_no_fsync_Ú_»wr™e
 = 
CONFIG_DEFAULT_AOF_NO_FSYNC_ON_REWRITE
;

1340 
£rv”
.
aof_»wr™e_³rc
 = 
AOF_REWRITE_PERC
;

1341 
£rv”
.
aof_»wr™e_mš_size
 = 
AOF_REWRITE_MIN_SIZE
;

1342 
£rv”
.
aof_»wr™e_ba£_size
 = 0;

1343 
£rv”
.
aof_»wr™e_scheduËd
 = 0;

1344 
£rv”
.
aof_Ï¡_fsync
 = 
	`time
(
NULL
);

1345 
£rv”
.
aof_»wr™e_time_Ï¡
 = -1;

1346 
£rv”
.
aof_»wr™e_time_¡¬t
 = -1;

1347 
£rv”
.
aof_Ï¡bg»wr™e_¡©us
 = 
C_OK
;

1348 
£rv”
.
aof_d–ayed_fsync
 = 0;

1349 
£rv”
.
aof_fd
 = -1;

1350 
£rv”
.
aof_£Ëùed_db
 = -1;

1351 
£rv”
.
aof_æush_po¡pÚed_¡¬t
 = 0;

1352 
£rv”
.
aof_»wr™e_šüem’l_fsync
 = 
CONFIG_DEFAULT_AOF_REWRITE_INCREMENTAL_FSYNC
;

1353 
£rv”
.
aof_lßd_Œunÿ‹d
 = 
CONFIG_DEFAULT_AOF_LOAD_TRUNCATED
;

1354 
£rv”
.
aof_u£_rdb_´—mbË
 = 
CONFIG_DEFAULT_AOF_USE_RDB_PREAMBLE
;

1355 
£rv”
.
pidfe
 = 
NULL
;

1356 
£rv”
.
rdb_f’ame
 = 
	`z¡rdup
(
CONFIG_DEFAULT_RDB_FILENAME
);

1357 
£rv”
.
aof_f’ame
 = 
	`z¡rdup
(
CONFIG_DEFAULT_AOF_FILENAME
);

1358 
£rv”
.
»quœ•ass
 = 
NULL
;

1359 
£rv”
.
rdb_com´essiÚ
 = 
CONFIG_DEFAULT_RDB_COMPRESSION
;

1360 
£rv”
.
rdb_checksum
 = 
CONFIG_DEFAULT_RDB_CHECKSUM
;

1361 
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
 = 
CONFIG_DEFAULT_STOP_WRITES_ON_BGSAVE_ERROR
;

1362 
£rv”
.
aùiv”ehashšg
 = 
CONFIG_DEFAULT_ACTIVE_REHASHING
;

1363 
£rv”
.
nÙify_key¥aû_ev’ts
 = 0;

1364 
£rv”
.
maxş›Ás
 = 
CONFIG_DEFAULT_MAX_CLIENTS
;

1365 
£rv”
.
bpİ_blocked_ş›Ás
 = 0;

1366 
£rv”
.
maxmemÜy
 = 
CONFIG_DEFAULT_MAXMEMORY
;

1367 
£rv”
.
maxmemÜy_pŞicy
 = 
CONFIG_DEFAULT_MAXMEMORY_POLICY
;

1368 
£rv”
.
maxmemÜy_§m¶es
 = 
CONFIG_DEFAULT_MAXMEMORY_SAMPLES
;

1369 
£rv”
.
lfu_log_çùÜ
 = 
CONFIG_DEFAULT_LFU_LOG_FACTOR
;

1370 
£rv”
.
lfu_deÿy_time
 = 
CONFIG_DEFAULT_LFU_DECAY_TIME
;

1371 
£rv”
.
hash_max_zli¡_’Œ›s
 = 
OBJ_HASH_MAX_ZIPLIST_ENTRIES
;

1372 
£rv”
.
hash_max_zli¡_v®ue
 = 
OBJ_HASH_MAX_ZIPLIST_VALUE
;

1373 
£rv”
.
li¡_max_zli¡_size
 = 
OBJ_LIST_MAX_ZIPLIST_SIZE
;

1374 
£rv”
.
li¡_com´ess_d•th
 = 
OBJ_LIST_COMPRESS_DEPTH
;

1375 
£rv”
.
£t_max_št£t_’Œ›s
 = 
OBJ_SET_MAX_INTSET_ENTRIES
;

1376 
£rv”
.
z£t_max_zli¡_’Œ›s
 = 
OBJ_ZSET_MAX_ZIPLIST_ENTRIES
;

1377 
£rv”
.
z£t_max_zli¡_v®ue
 = 
OBJ_ZSET_MAX_ZIPLIST_VALUE
;

1378 
£rv”
.
hÎ_¥¬£_max_by‹s
 = 
CONFIG_DEFAULT_HLL_SPARSE_MAX_BYTES
;

1379 
£rv”
.
shutdown_a§p
 = 0;

1380 
£rv”
.
şu¡”_’abËd
 = 0;

1381 
£rv”
.
şu¡”_node_timeout
 = 
CLUSTER_DEFAULT_NODE_TIMEOUT
;

1382 
£rv”
.
şu¡”_mig¿tiÚ_b¬r›r
 = 
CLUSTER_DEFAULT_MIGRATION_BARRIER
;

1383 
£rv”
.
şu¡”_¦ave_v®id™y_çùÜ
 = 
CLUSTER_DEFAULT_SLAVE_VALIDITY
;

1384 
£rv”
.
şu¡”_»quœe_fuÎ_cov”age
 = 
CLUSTER_DEFAULT_REQUIRE_FULL_COVERAGE
;

1385 
£rv”
.
şu¡”_cÚfigfe
 = 
	`z¡rdup
(
CONFIG_DEFAULT_CLUSTER_CONFIG_FILE
);

1386 
£rv”
.
şu¡”_ªnounû_
 = 
CONFIG_DEFAULT_CLUSTER_ANNOUNCE_IP
;

1387 
£rv”
.
şu¡”_ªnounû_pÜt
 = 
CONFIG_DEFAULT_CLUSTER_ANNOUNCE_PORT
;

1388 
£rv”
.
şu¡”_ªnounû_bus_pÜt
 = 
CONFIG_DEFAULT_CLUSTER_ANNOUNCE_BUS_PORT
;

1389 
£rv”
.
mig¿‹_ÿched_sock‘s
 = 
	`diùC»©e
(&
mig¿‹CacheDiùTy³
,
NULL
);

1390 
£rv”
.
Ãxt_ş›Á_id
 = 1;

1391 
£rv”
.
lßdšg_´oûss_ev’ts_š‹rv®_by‹s
 = (1024*1024*2);

1392 
£rv”
.
Ïzyä“_Ïzy_eviùiÚ
 = 
CONFIG_DEFAULT_LAZYFREE_LAZY_EVICTION
;

1393 
£rv”
.
Ïzyä“_Ïzy_expœe
 = 
CONFIG_DEFAULT_LAZYFREE_LAZY_EXPIRE
;

1394 
£rv”
.
Ïzyä“_Ïzy_£rv”_d–
 = 
CONFIG_DEFAULT_LAZYFREE_LAZY_SERVER_DEL
;

1396 
£rv”
.
Ìuşock
 = 
	`g‘LRUClock
();

1397 
	`»£tS”v”SaveP¬ams
();

1399 
	`­³ndS”v”SaveP¬ams
(60*60,1);

1400 
	`­³ndS”v”SaveP¬ams
(300,100);

1401 
	`­³ndS”v”SaveP¬ams
(60,10000);

1404 
£rv”
.
ma¡”auth
 = 
NULL
;

1405 
£rv”
.
ma¡”ho¡
 = 
NULL
;

1406 
£rv”
.
ma¡”pÜt
 = 6379;

1407 
£rv”
.
ma¡”
 = 
NULL
;

1408 
£rv”
.
ÿched_ma¡”
 = 
NULL
;

1409 
£rv”
.
»¶_ma¡”_š™Ÿl_off£t
 = -1;

1410 
£rv”
.
»¶_¡©e
 = 
REPL_STATE_NONE
;

1411 
£rv”
.
»¶_syncio_timeout
 = 
CONFIG_REPL_SYNCIO_TIMEOUT
;

1412 
£rv”
.
»¶_£rve_¡®e_d©a
 = 
CONFIG_DEFAULT_SLAVE_SERVE_STALE_DATA
;

1413 
£rv”
.
»¶_¦ave_ro
 = 
CONFIG_DEFAULT_SLAVE_READ_ONLY
;

1414 
£rv”
.
»¶_¦ave_Ïzy_æush
 = 
CONFIG_DEFAULT_SLAVE_LAZY_FLUSH
;

1415 
£rv”
.
»¶_down_sšû
 = 0;

1416 
£rv”
.
»¶_di§bË_tı_nod–ay
 = 
CONFIG_DEFAULT_REPL_DISABLE_TCP_NODELAY
;

1417 
£rv”
.
»¶_diskËss_sync
 = 
CONFIG_DEFAULT_REPL_DISKLESS_SYNC
;

1418 
£rv”
.
»¶_diskËss_sync_d–ay
 = 
CONFIG_DEFAULT_REPL_DISKLESS_SYNC_DELAY
;

1419 
£rv”
.
»¶_pšg_¦ave_³riod
 = 
CONFIG_DEFAULT_REPL_PING_SLAVE_PERIOD
;

1420 
£rv”
.
»¶_timeout
 = 
CONFIG_DEFAULT_REPL_TIMEOUT
;

1421 
£rv”
.
»¶_mš_¦aves_to_wr™e
 = 
CONFIG_DEFAULT_MIN_SLAVES_TO_WRITE
;

1422 
£rv”
.
»¶_mš_¦aves_max_Ïg
 = 
CONFIG_DEFAULT_MIN_SLAVES_MAX_LAG
;

1423 
£rv”
.
¦ave_´iÜ™y
 = 
CONFIG_DEFAULT_SLAVE_PRIORITY
;

1424 
£rv”
.
¦ave_ªnounû_
 = 
CONFIG_DEFAULT_SLAVE_ANNOUNCE_IP
;

1425 
£rv”
.
¦ave_ªnounû_pÜt
 = 
CONFIG_DEFAULT_SLAVE_ANNOUNCE_PORT
;

1426 
£rv”
.
ma¡”_»¶_off£t
 = 0;

1429 
£rv”
.
»¶_backlog
 = 
NULL
;

1430 
£rv”
.
»¶_backlog_size
 = 
CONFIG_DEFAULT_REPL_BACKLOG_SIZE
;

1431 
£rv”
.
»¶_backlog_hi¡Ën
 = 0;

1432 
£rv”
.
»¶_backlog_idx
 = 0;

1433 
£rv”
.
»¶_backlog_off
 = 0;

1434 
£rv”
.
»¶_backlog_time_lim™
 = 
CONFIG_DEFAULT_REPL_BACKLOG_TIME_LIMIT
;

1435 
£rv”
.
»¶_no_¦aves_sšû
 = 
	`time
(
NULL
);

1438 
j
 = 0; j < 
CLIENT_TYPE_OBUF_COUNT
; j++)

1439 
£rv”
.
ş›Á_obuf_lim™s
[
j
] = 
ş›ÁBufãrLim™sDeçuÉs
[j];

1442 
R_Z”o
 = 0.0;

1443 
R_PosInf
 = 1.0/
R_Z”o
;

1444 
R_NegInf
 = -1.0/
R_Z”o
;

1445 
R_Nª
 = 
R_Z”o
/R_Zero;

1450 
£rv”
.
commªds
 = 
	`diùC»©e
(&
commªdTabËDiùTy³
,
NULL
);

1451 
£rv”
.
Üig_commªds
 = 
	`diùC»©e
(&
commªdTabËDiùTy³
,
NULL
);

1452 
	`pİuÏ‹CommªdTabË
();

1453 
£rv”
.
d–Commªd
 = 
	`lookupCommªdByCSŒšg
("del");

1454 
£rv”
.
muÉiCommªd
 = 
	`lookupCommªdByCSŒšg
("multi");

1455 
£rv”
.
ÍushCommªd
 = 
	`lookupCommªdByCSŒšg
("lpush");

1456 
£rv”
.
ÍİCommªd
 = 
	`lookupCommªdByCSŒšg
("lpop");

1457 
£rv”
.
½İCommªd
 = 
	`lookupCommªdByCSŒšg
("rpop");

1458 
£rv”
.
¤emCommªd
 = 
	`lookupCommªdByCSŒšg
("srem");

1459 
£rv”
.
execCommªd
 = 
	`lookupCommªdByCSŒšg
("exec");

1462 
£rv”
.
¦owlog_log_¦ow”_thª
 = 
CONFIG_DEFAULT_SLOWLOG_LOG_SLOWER_THAN
;

1463 
£rv”
.
¦owlog_max_Ën
 = 
CONFIG_DEFAULT_SLOWLOG_MAX_LEN
;

1466 
£rv”
.
Ï‹ncy_mÚ™Ü_th»shŞd
 = 
CONFIG_DEFAULT_LATENCY_MONITOR_THRESHOLD
;

1469 
£rv”
.
as£¹_çed
 = "<no‡ssertion failed>";

1470 
£rv”
.
as£¹_fe
 = "<no file>";

1471 
£rv”
.
as£¹_lše
 = 0;

1472 
£rv”
.
bug_»pÜt_¡¬t
 = 0;

1473 
£rv”
.
w©chdog_³riod
 = 0;

1474 
	}
}

1476 **
’vœÚ
;

1493 
	$»¡¬tS”v”
(
æags
, 
m¡ime_t
 
d–ay
) {

1494 
j
;

1498 ià(
	`acûss
(
£rv”
.
execubË
,
X_OK
è=ğ-1è 
C_ERR
;

1501 ià(
æags
 & 
RESTART_SERVER_CONFIG_REWRITE
 &&

1502 
£rv”
.
cÚfigfe
 &&

1503 
	`»wr™eCÚfig
(
£rv”
.
cÚfigfe
è=ğ-1è 
C_ERR
;

1506 ià(
æags
 & 
RESTART_SERVER_GRACEFULLY
 &&

1507 
	`´•¬eFÜShutdown
(
SHUTDOWN_NOFLAGS
è!ğ
C_OK
è 
C_ERR
;

1511 
j
 = 3; j < ()
£rv”
.
maxş›Ás
 + 1024; j++è
	`şo£
(j);

1514 ià(
d–ay
è
	`u¦“p
(delay*1000);

1515 
	`execve
(
£rv”
.
execubË
,£rv”.
exec_¬gv
,
’vœÚ
);

1518 
	`_ex™
(1);

1520  
C_ERR
;

1521 
	}
}

1531 
	$adju¡O³nFesLim™
() {

1532 
¾im_t
 
maxfes
 = 
£rv”
.
maxş›Ás
+
CONFIG_MIN_RESERVED_FDS
;

1533 
¾im™
 
lim™
;

1535 ià(
	`g‘¾im™
(
RLIMIT_NOFILE
,&
lim™
) == -1) {

1536 
	`£rv”Log
(
LL_WARNING
,"Unableo obtainhe current NOFILE†imit (%s),‡ssuming 1024‡nd settinghe max clients configuration‡ccordingly.",

1537 
	`¡»¼Ü
(
”ºo
));

1538 
£rv”
.
maxş›Ás
 = 1024-
CONFIG_MIN_RESERVED_FDS
;

1540 
¾im_t
 
Şdlim™
 = 
lim™
.
¾im_cur
;

1544 ià(
Şdlim™
 < 
maxfes
) {

1545 
¾im_t
 
be¡lim™
;

1546 
£Œlim™_”rÜ
 = 0;

1550 
be¡lim™
 = 
maxfes
;

1551 
be¡lim™
 > 
Şdlim™
) {

1552 
¾im_t
 
deü_¡•
 = 16;

1554 
lim™
.
¾im_cur
 = 
be¡lim™
;

1555 
lim™
.
¾im_max
 = 
be¡lim™
;

1556 ià(
	`£Œlim™
(
RLIMIT_NOFILE
,&
lim™
) != -1) ;

1557 
£Œlim™_”rÜ
 = 
”ºo
;

1561 ià(
be¡lim™
 < 
deü_¡•
) ;

1562 
be¡lim™
 -ğ
deü_¡•
;

1567 ià(
be¡lim™
 < 
Şdlim™
) bestlimit = oldlimit;

1569 ià(
be¡lim™
 < 
maxfes
) {

1570 
Şd_maxş›Ás
 = 
£rv”
.
maxş›Ás
;

1571 
£rv”
.
maxş›Ás
 = 
be¡lim™
-
CONFIG_MIN_RESERVED_FDS
;

1572 ià(
£rv”
.
maxş›Ás
 < 1) {

1573 
	`£rv”Log
(
LL_WARNING
,"Your current 'ulimit -n' "

1577 (è
Şdlim™
,

1578 (è
maxfes
);

1579 
	`ex™
(1);

1581 
	`£rv”Log
(
LL_WARNING
,"You„equested maxclients of %d "

1583 
Şd_maxş›Ás
,

1584 (è
maxfes
);

1585 
	`£rv”Log
(
LL_WARNING
,"Server can't set maximum open files "

1587 (è
maxfes
, 
	`¡»¼Ü
(
£Œlim™_”rÜ
));

1588 
	`£rv”Log
(
LL_WARNING
,"Current maximum open files is %llu. "

1592 (è
be¡lim™
, 
£rv”
.
maxş›Ás
);

1594 
	`£rv”Log
(
LL_NOTICE
,"Increased maximum‚umber of open files "

1596 (è
maxfes
,

1597 (è
Şdlim™
);

1601 
	}
}

1605 
	$checkTıBacklogS‘tšgs
() {

1606 #ifdeà
HAVE_PROC_SOMAXCONN


1607 
FILE
 *
å
 = 
	`fİ’
("/proc/sys/net/core/somaxconn","r");

1608 
buf
[1024];

1609 ià(!
å
) ;

1610 ià(
	`fg‘s
(
buf
,(buf),
å
è!ğ
NULL
) {

1611 
somaxcÚn
 = 
	`©oi
(
buf
);

1612 ià(
somaxcÚn
 > 0 && somaxcÚÀ< 
£rv”
.
tı_backlog
) {

1613 
	`£rv”Log
(
LL_WARNING
,"WARNING: ThTCP‡dkjsh backlog s‘tšg oà%d cªnÙ b’fÜûd beÿu£ /´oc/sys/Ãt/cÜe/somaxcÚÀi £ˆtØthlow” v®uoà%d.", 
£rv”
.
tı_backlog
, 
somaxcÚn
);

1616 
	`fşo£
(
å
);

1618 
	}
}

1638 
	$li¡’ToPÜt
(
pÜt
, *
fds
, *
couÁ
) {

1639 
j
;

1643 ià(
£rv”
.
bšdaddr_couÁ
 =ğ0è£rv”.
bšdaddr
[0] = 
NULL
;

1644 
j
 = 0; j < 
£rv”
.
bšdaddr_couÁ
 || j == 0; j++) {

1645 ià(
£rv”
.
bšdaddr
[
j
] =ğ
NULL
) {

1646 
unsuµÜ‹d
 = 0;

1649 
fds
[*
couÁ
] = 
	`ª‘Tı6S”v”
(
£rv”
.
Ã‹¼
,
pÜt
,
NULL
,

1650 
£rv”
.
tı_backlog
);

1651 ià(
fds
[*
couÁ
] !ğ
ANET_ERR
) {

1652 
	`ª‘NÚBlock
(
NULL
,
fds
[*
couÁ
]);

1653 (*
couÁ
)++;

1654 } ià(
”ºo
 =ğ
EAFNOSUPPORT
) {

1655 
unsuµÜ‹d
++;

1656 
	`£rv”Log
(
LL_WARNING
,"Not†isteningo IPv6: unsupproted");

1659 ià(*
couÁ
 =ğ1 || 
unsuµÜ‹d
) {

1661 
fds
[*
couÁ
] = 
	`ª‘TıS”v”
(
£rv”
.
Ã‹¼
,
pÜt
,
NULL
,

1662 
£rv”
.
tı_backlog
);

1663 ià(
fds
[*
couÁ
] !ğ
ANET_ERR
) {

1664 
	`ª‘NÚBlock
(
NULL
,
fds
[*
couÁ
]);

1665 (*
couÁ
)++;

1666 } ià(
”ºo
 =ğ
EAFNOSUPPORT
) {

1667 
unsuµÜ‹d
++;

1668 
	`£rv”Log
(
LL_WARNING
,"Not†isteningo IPv4: unsupproted");

1674 ià(*
couÁ
 + 
unsuµÜ‹d
 == 2) ;

1675 } ià(
	`¡rchr
(
£rv”
.
bšdaddr
[
j
],':')) {

1677 
fds
[*
couÁ
] = 
	`ª‘Tı6S”v”
(
£rv”
.
Ã‹¼
,
pÜt
,£rv”.
bšdaddr
[
j
],

1678 
£rv”
.
tı_backlog
);

1681 
fds
[*
couÁ
] = 
	`ª‘TıS”v”
(
£rv”
.
Ã‹¼
,
pÜt
,£rv”.
bšdaddr
[
j
],

1682 
£rv”
.
tı_backlog
);

1684 ià(
fds
[*
couÁ
] =ğ
ANET_ERR
) {

1685 
	`£rv”Log
(
LL_WARNING
,

1687 
£rv”
.
bšdaddr
[
j
] ? server.bindaddr[j] : "*",

1688 
pÜt
, 
£rv”
.
Ã‹¼
);

1689  
C_ERR
;

1691 
	`ª‘NÚBlock
(
NULL
,
fds
[*
couÁ
]);

1692 (*
couÁ
)++;

1694  
C_OK
;

1695 
	}
}

1700 
	$»£tS”v”Sts
() {

1701 
j
;

1703 
£rv”
.
¡©_numcommªds
 = 0;

1704 
£rv”
.
¡©_numcÚÃùiÚs
 = 0;

1705 
£rv”
.
¡©_expœedkeys
 = 0;

1706 
£rv”
.
¡©_eviùedkeys
 = 0;

1707 
£rv”
.
¡©_key¥aû_mis£s
 = 0;

1708 
£rv”
.
¡©_key¥aû_h™s
 = 0;

1709 
£rv”
.
¡©_fÜk_time
 = 0;

1710 
£rv”
.
¡©_fÜk_¿‹
 = 0;

1711 
£rv”
.
¡©_»jeùed_cÚn
 = 0;

1712 
£rv”
.
¡©_sync_fuÎ
 = 0;

1713 
£rv”
.
¡©_sync_·¹Ÿl_ok
 = 0;

1714 
£rv”
.
¡©_sync_·¹Ÿl_”r
 = 0;

1715 
j
 = 0; j < 
STATS_METRIC_COUNT
; j++) {

1716 
£rv”
.
š¡_m‘ric
[
j
].
idx
 = 0;

1717 
£rv”
.
š¡_m‘ric
[
j
].
Ï¡_§m¶e_time
 = 
	`m¡ime
();

1718 
£rv”
.
š¡_m‘ric
[
j
].
Ï¡_§m¶e_couÁ
 = 0;

1719 
	`mem£t
(
£rv”
.
š¡_m‘ric
[
j
].
§m¶es
,0,

1720 (
£rv”
.
š¡_m‘ric
[
j
].
§m¶es
));

1722 
£rv”
.
¡©_Ãt_šput_by‹s
 = 0;

1723 
£rv”
.
¡©_Ãt_ouut_by‹s
 = 0;

1724 
£rv”
.
aof_d–ayed_fsync
 = 0;

1725 
	}
}

1727 
	$š™S”v”
() {

1728 
j
;

1730 
	`sigÇl
(
SIGHUP
, 
SIG_IGN
);

1731 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

1732 
	`£tupSigÇlHªdËrs
();

1734 ià(
£rv”
.
sy¦og_’abËd
) {

1735 
	`İ’log
(
£rv”
.
sy¦og_id’t
, 
LOG_PID
 | 
LOG_NDELAY
 | 
LOG_NOWAIT
,

1736 
£rv”
.
sy¦og_çc™y
);

1739 
£rv”
.
pid
 = 
	`g‘pid
();

1740 
£rv”
.
cu¼’t_ş›Á
 = 
NULL
;

1741 
£rv”
.
ş›Ás
 = 
	`li¡C»©e
();

1742 
£rv”
.
ş›Ás_to_şo£
 = 
	`li¡C»©e
();

1743 
£rv”
.
¦aves
 = 
	`li¡C»©e
();

1744 
£rv”
.
mÚ™Üs
 = 
	`li¡C»©e
();

1745 
£rv”
.
ş›Ás_³ndšg_wr™e
 = 
	`li¡C»©e
();

1746 
£rv”
.
¦ave£ldb
 = -1;

1747 
£rv”
.
unblocked_ş›Ás
 = 
	`li¡C»©e
();

1748 
£rv”
.
»ady_keys
 = 
	`li¡C»©e
();

1749 
£rv”
.
ş›Ás_wa™šg_acks
 = 
	`li¡C»©e
();

1750 
£rv”
.
g‘_ack_äom_¦aves
 = 0;

1751 
£rv”
.
ş›Ás_·u£d
 = 0;

1752 
£rv”
.
sy¡em_memÜy_size
 = 
	`zm®loc_g‘_memÜy_size
();

1754 
	`ü—‹Sh¬edObjeùs
();

1755 
	`adju¡O³nFesLim™
();

1756 
£rv”
.
–
 = 
	`«C»©eEv’tLoİ
(£rv”.
maxş›Ás
+
CONFIG_FDSET_INCR
);

1757 
£rv”
.
db
 = 
	`zm®loc
((
»disDb
)*£rv”.
dbnum
);

1760 ià(
£rv”
.
pÜt
 != 0 &&

1761 
	`li¡’ToPÜt
(
£rv”
.
pÜt
,£rv”.
fd
,&£rv”.
fd_couÁ
è=ğ
C_ERR
)

1762 
	`ex™
(1);

1765 ià(
£rv”
.
unixsock‘
 !ğ
NULL
) {

1766 
	`uÆšk
(
£rv”
.
unixsock‘
);

1767 
£rv”
.
sofd
 = 
	`ª‘UnixS”v”
(£rv”.
Ã‹¼
,£rv”.
unixsock‘
,

1768 
£rv”
.
unixsock‘³rm
, s”v”.
tı_backlog
);

1769 ià(
£rv”
.
sofd
 =ğ
ANET_ERR
) {

1770 
	`£rv”Log
(
LL_WARNING
, "O³nšg Unix sock‘: %s", 
£rv”
.
Ã‹¼
);

1771 
	`ex™
(1);

1773 
	`ª‘NÚBlock
(
NULL
,
£rv”
.
sofd
);

1777 ià(
£rv”
.
fd_couÁ
 =ğ0 && s”v”.
sofd
 < 0) {

1778 
	`£rv”Log
(
LL_WARNING
, "Configuredo‚ot†isten‡nywhere,ƒxiting.");

1779 
	`ex™
(1);

1783 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

1784 
£rv”
.
db
[
j
].
diù
 = 
	`diùC»©e
(&
dbDiùTy³
,
NULL
);

1785 
£rv”
.
db
[
j
].
expœes
 = 
	`diùC»©e
(&
key±rDiùTy³
,
NULL
);

1786 
£rv”
.
db
[
j
].
blockšg_keys
 = 
	`diùC»©e
(&
keyli¡DiùTy³
,
NULL
);

1787 
£rv”
.
db
[
j
].
»ady_keys
 = 
	`diùC»©e
(&
objeùKeyPoš‹rV®ueDiùTy³
,
NULL
);

1788 
£rv”
.
db
[
j
].
w©ched_keys
 = 
	`diùC»©e
(&
keyli¡DiùTy³
,
NULL
);

1789 
£rv”
.
db
[
j
].
id
 = j;

1790 
£rv”
.
db
[
j
].
avg_‰l
 = 0;

1792 
	`eviùiÚPoŞAÎoc
();

1793 
£rv”
.
pubsub_chªÃls
 = 
	`diùC»©e
(&
keyli¡DiùTy³
,
NULL
);

1794 
£rv”
.
pubsub_·‰”ns
 = 
	`li¡C»©e
();

1795 
	`li¡S‘F»eM‘hod
(
£rv”
.
pubsub_·‰”ns
,
ä“PubsubP©‹º
);

1796 
	`li¡S‘M©chM‘hod
(
£rv”
.
pubsub_·‰”ns
,
li¡M©chPubsubP©‹º
);

1797 
£rv”
.
üÚloİs
 = 0;

1798 
£rv”
.
rdb_chd_pid
 = -1;

1799 
£rv”
.
aof_chd_pid
 = -1;

1800 
£rv”
.
rdb_chd_ty³
 = 
RDB_CHILD_TYPE_NONE
;

1801 
£rv”
.
rdb_bg§ve_scheduËd
 = 0;

1802 
£rv”
.
chd_šfo_pe
[0] = -1;

1803 
£rv”
.
chd_šfo_pe
[1] = -1;

1804 
£rv”
.
chd_šfo_d©a
.
magic
 = 0;

1805 
	`aofRewr™eBufãrRe£t
();

1806 
£rv”
.
aof_buf
 = 
	`sd£m±y
();

1807 
£rv”
.
Ï¡§ve
 = 
	`time
(
NULL
);

1808 
£rv”
.
Ï¡bg§ve_Œy
 = 0;

1809 
£rv”
.
rdb_§ve_time_Ï¡
 = -1;

1810 
£rv”
.
rdb_§ve_time_¡¬t
 = -1;

1811 
£rv”
.
dœty
 = 0;

1812 
	`»£tS”v”Sts
();

1814 
£rv”
.
¡©_¡¬‰ime
 = 
	`time
(
NULL
);

1815 
£rv”
.
¡©_³ak_memÜy
 = 0;

1816 
£rv”
.
¡©_rdb_cow_by‹s
 = 0;

1817 
£rv”
.
¡©_aof_cow_by‹s
 = 0;

1818 
£rv”
.
»sid’t_£t_size
 = 0;

1819 
£rv”
.
Ï¡bg§ve_¡©us
 = 
C_OK
;

1820 
£rv”
.
aof_Ï¡_wr™e_¡©us
 = 
C_OK
;

1821 
£rv”
.
aof_Ï¡_wr™e_”ºo
 = 0;

1822 
£rv”
.
»¶_good_¦aves_couÁ
 = 0;

1823 
	`upd©eCachedTime
();

1828 ià(
	`«C»©eTimeEv’t
(
£rv”
.
–
, 1, 
£rv”CrÚ
, 
NULL
, NULLè=ğ
AE_ERR
) {

1829 
	`£rv”Pªic
("Can't createƒvent†oopimers.");

1830 
	`ex™
(1);

1835 
j
 = 0; j < 
£rv”
.
fd_couÁ
; j++) {

1836 ià(
	`«C»©eFeEv’t
(
£rv”
.
–
, s”v”.
fd
[
j
], 
AE_READABLE
,

1837 
acû±TıHªdËr
,
NULL
è=ğ
AE_ERR
)

1839 
	`£rv”Pªic
(

1843 ià(
£rv”
.
sofd
 > 0 && 
	`«C»©eFeEv’t
(£rv”.
–
,£rv”.sofd,
AE_READABLE
,

1844 
acû±UnixHªdËr
,
NULL
è=ğ
AE_ERR
è
	`£rv”Pªic
("Unrecoverableƒrror creating server.sofd fileƒvent.");

1847 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_ON
) {

1848 
£rv”
.
aof_fd
 = 
	`İ’
(£rv”.
aof_f’ame
,

1849 
O_WRONLY
|
O_APPEND
|
O_CREAT
,0644);

1850 ià(
£rv”
.
aof_fd
 == -1) {

1851 
	`£rv”Log
(
LL_WARNING
, "Can't openhe‡ppend-only file: %s",

1852 
	`¡»¼Ü
(
”ºo
));

1853 
	`ex™
(1);

1861 ià(
£rv”
.
¬ch_b™s
 =ğ32 && s”v”.
maxmemÜy
 == 0) {

1862 
	`£rv”Log
(
LL_WARNING
,"Warning: 32 bit instance detected but‚o memory†imit set. Setting 3 GB maxmemory†imit with 'noeviction'…olicy‚ow.");

1863 
£rv”
.
maxmemÜy
 = 3072LL*(1024*1024);

1864 
£rv”
.
maxmemÜy_pŞicy
 = 
MAXMEMORY_NO_EVICTION
;

1867 ià(
£rv”
.
şu¡”_’abËd
è
	`şu¡”In™
();

1868 
	`»¶iÿtiÚSütCacheIn™
();

1869 
	`sütšgIn™
(1);

1870 
	`¦owlogIn™
();

1871 
	`Ï‹ncyMÚ™ÜIn™
();

1872 
	`bioIn™
();

1873 
£rv”
.
š™Ÿl_memÜy_u§ge
 = 
	`zm®loc_u£d_memÜy
();

1874 
	}
}

1878 
	$pİuÏ‹CommªdTabË
() {

1879 
j
;

1880 
numcommªds
 = (
»disCommªdTabË
)/(
»disCommªd
);

1882 
j
 = 0; j < 
numcommªds
; j++) {

1883 
»disCommªd
 *
c
 = 
»disCommªdTabË
+
j
;

1884 *
f
 = 
c
->
sæags
;

1885 
»tv®1
, 
»tv®2
;

1887 *
f
 != '\0') {

1888 *
f
) {

1889 'w': 
c
->
æags
 |ğ
CMD_WRITE
; ;

1890 'r': 
c
->
æags
 |ğ
CMD_READONLY
; ;

1891 'm': 
c
->
æags
 |ğ
CMD_DENYOOM
; ;

1892 'a': 
c
->
æags
 |ğ
CMD_ADMIN
; ;

1893 'p': 
c
->
æags
 |ğ
CMD_PUBSUB
; ;

1894 's': 
c
->
æags
 |ğ
CMD_NOSCRIPT
; ;

1895 'R': 
c
->
æags
 |ğ
CMD_RANDOM
; ;

1896 'S': 
c
->
æags
 |ğ
CMD_SORT_FOR_SCRIPT
; ;

1897 'l': 
c
->
æags
 |ğ
CMD_LOADING
; ;

1898 't': 
c
->
æags
 |ğ
CMD_STALE
; ;

1899 'M': 
c
->
æags
 |ğ
CMD_SKIP_MONITOR
; ;

1900 'k': 
c
->
æags
 |ğ
CMD_ASKING
; ;

1901 'F': 
c
->
æags
 |ğ
CMD_FAST
; ;

1902 : 
	`£rv”Pªic
("Unsupported command flag"); ;

1904 
f
++;

1907 
»tv®1
 = 
	`diùAdd
(
£rv”
.
commªds
, 
	`sd¢ew
(
c
->
Çme
), c);

1910 
»tv®2
 = 
	`diùAdd
(
£rv”
.
Üig_commªds
, 
	`sd¢ew
(
c
->
Çme
), c);

1911 
	`£rv”As£¹
(
»tv®1
 =ğ
DICT_OK
 && 
»tv®2
 == DICT_OK);

1913 
	}
}

1915 
	$»£tCommªdTabËSts
() {

1916 
numcommªds
 = (
»disCommªdTabË
)/(
»disCommªd
);

1917 
j
;

1919 
j
 = 0; j < 
numcommªds
; j++) {

1920 
»disCommªd
 *
c
 = 
»disCommªdTabË
+
j
;

1922 
c
->
miüo£cÚds
 = 0;

1923 
c
->
ÿÎs
 = 0;

1925 
	}
}

1929 
	$»disOpA¼ayIn™
(
»disOpA¼ay
 *
ß
) {

1930 
ß
->
İs
 = 
NULL
;

1931 
ß
->
numİs
 = 0;

1932 
	}
}

1934 
	$»disOpA¼ayAµ’d
(
»disOpA¼ay
 *
ß
, 
»disCommªd
 *
cmd
, 
dbid
,

1935 
robj
 **
¬gv
, 
¬gc
, 
rg‘
)

1937 
»disOp
 *
İ
;

1939 
ß
->
İs
 = 
	`z»®loc
(ß->İs,(
»disOp
)*(ß->
numİs
+1));

1940 
İ
 = 
ß
->
İs
+ß->
numİs
;

1941 
İ
->
cmd
 = cmd;

1942 
İ
->
dbid
 = dbid;

1943 
İ
->
¬gv
 =‡rgv;

1944 
İ
->
¬gc
 =‡rgc;

1945 
İ
->
rg‘
 =arget;

1946 
ß
->
numİs
++;

1947  
ß
->
numİs
;

1948 
	}
}

1950 
	$»disOpA¼ayF»e
(
»disOpA¼ay
 *
ß
) {

1951 
ß
->
numİs
) {

1952 
j
;

1953 
»disOp
 *
İ
;

1955 
ß
->
numİs
--;

1956 
İ
 = 
ß
->
İs
+ß->
numİs
;

1957 
j
 = 0; j < 
İ
->
¬gc
; j++)

1958 
	`deüRefCouÁ
(
İ
->
¬gv
[
j
]);

1959 
	`zä“
(
İ
->
¬gv
);

1961 
	`zä“
(
ß
->
İs
);

1962 
	}
}

1966 
»disCommªd
 *
	$lookupCommªd
(
sds
 
Çme
) {

1967  
	`diùF‘chV®ue
(
£rv”
.
commªds
, 
Çme
);

1968 
	}
}

1970 
»disCommªd
 *
	$lookupCommªdByCSŒšg
(*
s
) {

1971 
»disCommªd
 *
cmd
;

1972 
sds
 
Çme
 = 
	`sd¢ew
(
s
);

1974 
cmd
 = 
	`diùF‘chV®ue
(
£rv”
.
commªds
, 
Çme
);

1975 
	`sdsä“
(
Çme
);

1976  
cmd
;

1977 
	}
}

1986 
»disCommªd
 *
	$lookupCommªdOrOrigš®
(
sds
 
Çme
) {

1987 
»disCommªd
 *
cmd
 = 
	`diùF‘chV®ue
(
£rv”
.
commªds
, 
Çme
);

1989 ià(!
cmd
ècmd = 
	`diùF‘chV®ue
(
£rv”
.
Üig_commªds
,
Çme
);

1990  
cmd
;

1991 
	}
}

2004 
	$´İag©e
(
»disCommªd
 *
cmd
, 
dbid
, 
robj
 **
¬gv
, 
¬gc
,

2005 
æags
)

2007 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
 && 
æags
 & 
PROPAGATE_AOF
)

2008 
	`ãedAµ’dOÆyFe
(
cmd
,
dbid
,
¬gv
,
¬gc
);

2009 ià(
æags
 & 
PROPAGATE_REPL
)

2010 
	`»¶iÿtiÚF“dSÏves
(
£rv”
.
¦aves
,
dbid
,
¬gv
,
¬gc
);

2011 
	}
}

2025 
	$®soPrİag©e
(
»disCommªd
 *
cmd
, 
dbid
, 
robj
 **
¬gv
, 
¬gc
,

2026 
rg‘
)

2028 
robj
 **
¬gvcİy
;

2029 
j
;

2031 ià(
£rv”
.
lßdšg
) ;

2033 
¬gvcİy
 = 
	`zm®loc
((
robj
*)*
¬gc
);

2034 
j
 = 0; j < 
¬gc
; j++) {

2035 
¬gvcİy
[
j
] = 
¬gv
[j];

2036 
	`šüRefCouÁ
(
¬gv
[
j
]);

2038 
	`»disOpA¼ayAµ’d
(&
£rv”
.
®so_´İag©e
,
cmd
,
dbid
,
¬gvcİy
,
¬gc
,
rg‘
);

2039 
	}
}

2044 
	$fÜûCommªdPrİag©iÚ
(
ş›Á
 *
c
, 
æags
) {

2045 ià(
æags
 & 
PROPAGATE_REPL
è
c
->æag |ğ
CLIENT_FORCE_REPL
;

2046 ià(
æags
 & 
PROPAGATE_AOF
è
c
->æag |ğ
CLIENT_FORCE_AOF
;

2047 
	}
}

2052 
	$´ev’tCommªdPrİag©iÚ
(
ş›Á
 *
c
) {

2053 
c
->
æags
 |ğ
CLIENT_PREVENT_PROP
;

2054 
	}
}

2057 
	$´ev’tCommªdAOF
(
ş›Á
 *
c
) {

2058 
c
->
æags
 |ğ
CLIENT_PREVENT_AOF_PROP
;

2059 
	}
}

2062 
	$´ev’tCommªdR•liÿtiÚ
(
ş›Á
 *
c
) {

2063 
c
->
æags
 |ğ
CLIENT_PREVENT_REPL_PROP
;

2064 
	}
}

2103 
	$ÿÎ
(
ş›Á
 *
c
, 
æags
) {

2104 
dœty
, 
¡¬t
, 
du¿tiÚ
;

2105 
ş›Á_Şd_æags
 = 
c
->
æags
;

2109 ià(
	`li¡L’gth
(
£rv”
.
mÚ™Üs
) &&

2110 !
£rv”
.
lßdšg
 &&

2111 !(
c
->
cmd
->
æags
 & (
CMD_SKIP_MONITOR
|
CMD_ADMIN
)))

2113 
	`»¶iÿtiÚF“dMÚ™Üs
(
c
,
£rv”
.
mÚ™Üs
,c->
db
->
id
,c->
¬gv
,c->
¬gc
);

2118 
c
->
æags
 &ğ~(
CLIENT_FORCE_AOF
|
CLIENT_FORCE_REPL
|
CLIENT_PREVENT_PROP
);

2119 
»disOpA¼ay
 
´ev_®so_´İag©e
 = 
£rv”
.
®so_´İag©e
;

2120 
	`»disOpA¼ayIn™
(&
£rv”
.
®so_´İag©e
);

2123 
dœty
 = 
£rv”
.dirty;

2124 
¡¬t
 = 
	`u¡ime
();

2125 
c
->
cmd
->
	`´oc
(c);

2126 
du¿tiÚ
 = 
	`u¡ime
()-
¡¬t
;

2127 
dœty
 = 
£rv”
.dirty-dirty;

2128 ià(
dœty
 < 0) dirty = 0;

2132 ià(
£rv”
.
lßdšg
 && 
c
->
æags
 & 
CLIENT_LUA
)

2133 
æags
 &ğ~(
CMD_CALL_SLOWLOG
 | 
CMD_CALL_STATS
);

2138 ià(
c
->
æags
 & 
CLIENT_LUA
 && 
£rv”
.
lua_ÿÎ”
) {

2139 ià(
c
->
æags
 & 
CLIENT_FORCE_REPL
)

2140 
£rv”
.
lua_ÿÎ”
->
æags
 |ğ
CLIENT_FORCE_REPL
;

2141 ià(
c
->
æags
 & 
CLIENT_FORCE_AOF
)

2142 
£rv”
.
lua_ÿÎ”
->
æags
 |ğ
CLIENT_FORCE_AOF
;

2147 ià(
æags
 & 
CMD_CALL_SLOWLOG
 && 
c
->
cmd
->
´oc
 !ğ
execCommªd
) {

2148 *
Ï‹ncy_ev’t
 = (
c
->
cmd
->
æags
 & 
CMD_FAST
) ?

2150 
	`Ï‹ncyAddSam¶eIfN“ded
(
Ï‹ncy_ev’t
,
du¿tiÚ
/1000);

2151 
	`¦owlogPushEÁryIfN“ded
(
c
->
¬gv
,c->
¬gc
,
du¿tiÚ
);

2153 ià(
æags
 & 
CMD_CALL_STATS
) {

2154 
c
->
Ï¡cmd
->
miüo£cÚds
 +ğ
du¿tiÚ
;

2155 
c
->
Ï¡cmd
->
ÿÎs
++;

2159 ià(
æags
 & 
CMD_CALL_PROPAGATE
 &&

2160 (
c
->
æags
 & 
CLIENT_PREVENT_PROP
) != CLIENT_PREVENT_PROP)

2162 
´İag©e_æags
 = 
PROPAGATE_NONE
;

2166 ià(
dœty
è
´İag©e_æags
 |ğ(
PROPAGATE_AOF
|
PROPAGATE_REPL
);

2170 ià(
c
->
æags
 & 
CLIENT_FORCE_REPL
è
´İag©e_æags
 |ğ
PROPAGATE_REPL
;

2171 ià(
c
->
æags
 & 
CLIENT_FORCE_AOF
è
´İag©e_æags
 |ğ
PROPAGATE_AOF
;

2176 ià(
c
->
æags
 & 
CLIENT_PREVENT_REPL_PROP
 ||

2177 !(
æags
 & 
CMD_CALL_PROPAGATE_REPL
))

2178 
´İag©e_æags
 &ğ~
PROPAGATE_REPL
;

2179 ià(
c
->
æags
 & 
CLIENT_PREVENT_AOF_PROP
 ||

2180 !(
æags
 & 
CMD_CALL_PROPAGATE_AOF
))

2181 
´İag©e_æags
 &ğ~
PROPAGATE_AOF
;

2185 ià(
´İag©e_æags
 !ğ
PROPAGATE_NONE
)

2186 
	`´İag©e
(
c
->
cmd
,c->
db
->
id
,c->
¬gv
,c->
¬gc
,
´İag©e_æags
);

2191 
c
->
æags
 &ğ~(
CLIENT_FORCE_AOF
|
CLIENT_FORCE_REPL
|
CLIENT_PREVENT_PROP
);

2192 
c
->
æags
 |ğ
ş›Á_Şd_æags
 &

2193 (
CLIENT_FORCE_AOF
|
CLIENT_FORCE_REPL
|
CLIENT_PREVENT_PROP
);

2198 ià(
£rv”
.
®so_´İag©e
.
numİs
) {

2199 
j
;

2200 
»disOp
 *
rİ
;

2202 ià(
æags
 & 
CMD_CALL_PROPAGATE
) {

2203 
j
 = 0; j < 
£rv”
.
®so_´İag©e
.
numİs
; j++) {

2204 
rİ
 = &
£rv”
.
®so_´İag©e
.
İs
[
j
];

2205 
rg‘
 = 
rİ
->target;

2207 ià(!(
æags
&
CMD_CALL_PROPAGATE_AOF
)è
rg‘
 &ğ~
PROPAGATE_AOF
;

2208 ià(!(
æags
&
CMD_CALL_PROPAGATE_REPL
)è
rg‘
 &ğ~
PROPAGATE_REPL
;

2209 ià(
rg‘
)

2210 
	`´İag©e
(
rİ
->
cmd
,rİ->
dbid
,rİ->
¬gv
,rİ->
¬gc
,
rg‘
);

2213 
	`»disOpA¼ayF»e
(&
£rv”
.
®so_´İag©e
);

2215 
£rv”
.
®so_´İag©e
 = 
´ev_®so_´İag©e
;

2216 
£rv”
.
¡©_numcommªds
++;

2217 
	}
}

2227 
	$´oûssCommªd
(
ş›Á
 *
c
) {

2232 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[0]->
±r
,"quit")) {

2233 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

2234 
c
->
æags
 |ğ
CLIENT_CLOSE_AFTER_REPLY
;

2235  
C_ERR
;

2240 
c
->
cmd
 = c->
Ï¡cmd
 = 
	`lookupCommªd
(c->
¬gv
[0]->
±r
);

2241 ià(!
c
->
cmd
) {

2242 
	`æagT¿n§ùiÚ
(
c
);

2243 
	`addR•lyE¼ÜFÜm©
(
c
,"unknown command '%s'",

2244 (*)
c
->
¬gv
[0]->
±r
);

2245  
C_OK
;

2246 } ià((
c
->
cmd
->
¬™y
 > 0 && c->cmd->¬™y !ğc->
¬gc
) ||

2247 (
c
->
¬gc
 < -c->
cmd
->
¬™y
)) {

2248 
	`æagT¿n§ùiÚ
(
c
);

2249 
	`addR•lyE¼ÜFÜm©
(
c
,"wrong‚umber of‡rguments for '%s' command",

2250 
c
->
cmd
->
Çme
);

2251  
C_OK
;

2255 ià(
£rv”
.
»quœ•ass
 && !
c
->
auth’tiÿ‹d
 && c->
cmd
->
´oc
 !ğ
authCommªd
)

2257 
	`æagT¿n§ùiÚ
(
c
);

2258 
	`addR•ly
(
c
,
sh¬ed
.
nßuth”r
);

2259  
C_OK
;

2266 ià(
£rv”
.
şu¡”_’abËd
 &&

2267 !(
c
->
æags
 & 
CLIENT_MASTER
) &&

2268 !(
c
->
æags
 & 
CLIENT_LUA
 &&

2269 
£rv”
.
lua_ÿÎ”
->
æags
 & 
CLIENT_MASTER
) &&

2270 !(
c
->
cmd
->
g‘keys_´oc
 =ğ
NULL
 && c->cmd->
fœ¡key
 == 0 &&

2271 
c
->
cmd
->
´oc
 !ğ
execCommªd
))

2273 
hash¦Ù
;

2274 
”rÜ_code
;

2275 
şu¡”Node
 *
n
 = 
	`g‘NodeByQu”y
(
c
,c->
cmd
,c->
¬gv
,c->
¬gc
,

2276 &
hash¦Ù
,&
”rÜ_code
);

2277 ià(
n
 =ğ
NULL
 ||‚ !ğ
£rv”
.
şu¡”
->
my£lf
) {

2278 ià(
c
->
cmd
->
´oc
 =ğ
execCommªd
) {

2279 
	`disÿrdT¿n§ùiÚ
(
c
);

2281 
	`æagT¿n§ùiÚ
(
c
);

2283 
	`şu¡”RedœeùCl›Á
(
c
,
n
,
hash¦Ù
,
”rÜ_code
);

2284  
C_OK
;

2293 ià(
£rv”
.
maxmemÜy
) {

2294 
»tv®
 = 
	`ä“MemÜyIfN“ded
();

2297 ià(
£rv”
.
cu¼’t_ş›Á
 =ğ
NULL
è 
C_ERR
;

2301 ià((
c
->
cmd
->
æags
 & 
CMD_DENYOOM
è&& 
»tv®
 =ğ
C_ERR
) {

2302 
	`æagT¿n§ùiÚ
(
c
);

2303 
	`addR•ly
(
c
, 
sh¬ed
.
oom”r
);

2304  
C_OK
;

2310 ià(((
£rv”
.
¡İ_wr™es_Ú_bg§ve_”r
 &&

2311 
£rv”
.
§v•¬am¦’
 > 0 &&

2312 
£rv”
.
Ï¡bg§ve_¡©us
 =ğ
C_ERR
) ||

2313 
£rv”
.
aof_Ï¡_wr™e_¡©us
 =ğ
C_ERR
) &&

2314 
£rv”
.
ma¡”ho¡
 =ğ
NULL
 &&

2315 (
c
->
cmd
->
æags
 & 
CMD_WRITE
 ||

2316 
c
->
cmd
->
´oc
 =ğ
pšgCommªd
))

2318 
	`æagT¿n§ùiÚ
(
c
);

2319 ià(
£rv”
.
aof_Ï¡_wr™e_¡©us
 =ğ
C_OK
)

2320 
	`addR•ly
(
c
, 
sh¬ed
.
bg§v“¼
);

2322 
	`addR•lySds
(
c
,

2323 
	`sdsÿrštf
(
	`sd£m±y
(),

2325 
	`¡»¼Ü
(
£rv”
.
aof_Ï¡_wr™e_”ºo
)));

2326  
C_OK
;

2331 ià(
£rv”
.
ma¡”ho¡
 =ğ
NULL
 &&

2332 
£rv”
.
»¶_mš_¦aves_to_wr™e
 &&

2333 
£rv”
.
»¶_mš_¦aves_max_Ïg
 &&

2334 
c
->
cmd
->
æags
 & 
CMD_WRITE
 &&

2335 
£rv”
.
»¶_good_¦aves_couÁ
 < s”v”.
»¶_mš_¦aves_to_wr™e
)

2337 
	`æagT¿n§ùiÚ
(
c
);

2338 
	`addR•ly
(
c
, 
sh¬ed
.
nÜ•liÿ£¼
);

2339  
C_OK
;

2344 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¦ave_ro
 &&

2345 !(
c
->
æags
 & 
CLIENT_MASTER
) &&

2346 
c
->
cmd
->
æags
 & 
CMD_WRITE
)

2348 
	`addR•ly
(
c
, 
sh¬ed
.
ro¦av“¼
);

2349  
C_OK
;

2353 ià(
c
->
æags
 & 
CLIENT_PUBSUB
 &&

2354 
c
->
cmd
->
´oc
 !ğ
pšgCommªd
 &&

2355 
c
->
cmd
->
´oc
 !ğ
subsüibeCommªd
 &&

2356 
c
->
cmd
->
´oc
 !ğ
unsubsüibeCommªd
 &&

2357 
c
->
cmd
->
´oc
 !ğ
psubsüibeCommªd
 &&

2358 
c
->
cmd
->
´oc
 !ğ
punsubsüibeCommªd
) {

2359 
	`addR•lyE¼Ü
(
c
,"only (P)SUBSCRIBE / (P)UNSUBSCRIBE / PING / QUIT‡llowed inhis context");

2360  
C_OK
;

2365 ià(
£rv”
.
ma¡”ho¡
 && s”v”.
»¶_¡©e
 !ğ
REPL_STATE_CONNECTED
 &&

2366 
£rv”
.
»¶_£rve_¡®e_d©a
 == 0 &&

2367 !(
c
->
cmd
->
æags
 & 
CMD_STALE
))

2369 
	`æagT¿n§ùiÚ
(
c
);

2370 
	`addR•ly
(
c
, 
sh¬ed
.
ma¡”dowÃ¼
);

2371  
C_OK
;

2376 ià(
£rv”
.
lßdšg
 && !(
c
->
cmd
->
æags
 & 
CMD_LOADING
)) {

2377 
	`addR•ly
(
c
, 
sh¬ed
.
lßdšg”r
);

2378  
C_OK
;

2382 ià(
£rv”
.
lua_timedout
 &&

2383 
c
->
cmd
->
´oc
 !ğ
authCommªd
 &&

2384 
c
->
cmd
->
´oc
 !ğ
»¶cÚfCommªd
 &&

2385 !(
c
->
cmd
->
´oc
 =ğ
shutdownCommªd
 &&

2386 
c
->
¬gc
 == 2 &&

2387 
	`tŞow”
(((*)
c
->
¬gv
[1]->
±r
)[0]) == 'n') &&

2388 !(
c
->
cmd
->
´oc
 =ğ
sütCommªd
 &&

2389 
c
->
¬gc
 == 2 &&

2390 
	`tŞow”
(((*)
c
->
¬gv
[1]->
±r
)[0]) == 'k'))

2392 
	`æagT¿n§ùiÚ
(
c
);

2393 
	`addR•ly
(
c
, 
sh¬ed
.
¦owsü‹¼
);

2394  
C_OK
;

2398 ià(
c
->
æags
 & 
CLIENT_MULTI
 &&

2399 
c
->
cmd
->
´oc
 !ğ
execCommªd
 && c->cmd->´oø!ğ
disÿrdCommªd
 &&

2400 
c
->
cmd
->
´oc
 !ğ
muÉiCommªd
 && c->cmd->´oø!ğ
w©chCommªd
)

2402 
	`queueMuÉiCommªd
(
c
);

2403 
	`addR•ly
(
c
,
sh¬ed
.
queued
);

2405 
	`ÿÎ
(
c
,
CMD_CALL_FULL
);

2406 
c
->
woff
 = 
£rv”
.
ma¡”_»¶_off£t
;

2407 ià(
	`li¡L’gth
(
£rv”
.
»ady_keys
))

2408 
	`hªdËCl›ÁsBlockedOnLi¡s
();

2410  
C_OK
;

2411 
	}
}

2417 
	$şo£Li¡’šgSock‘s
(
uÆšk_unix_sock‘
) {

2418 
j
;

2420 
j
 = 0; j < 
£rv”
.
fd_couÁ
; j++è
	`şo£
(£rv”.
fd
[j]);

2421 ià(
£rv”
.
sofd
 !ğ-1è
	`şo£
(server.sofd);

2422 ià(
£rv”
.
şu¡”_’abËd
)

2423 
j
 = 0; j < 
£rv”
.
cfd_couÁ
; j++è
	`şo£
(£rv”.
cfd
[j]);

2424 ià(
uÆšk_unix_sock‘
 && 
£rv”
.
unixsock‘
) {

2425 
	`£rv”Log
(
LL_NOTICE
,"Removinghe unix socket file.");

2426 
	`uÆšk
(
£rv”
.
unixsock‘
);

2428 
	}
}

2430 
	$´•¬eFÜShutdown
(
æags
) {

2431 
§ve
 = 
æags
 & 
SHUTDOWN_SAVE
;

2432 
no§ve
 = 
æags
 & 
SHUTDOWN_NOSAVE
;

2434 
	`£rv”Log
(
LL_WARNING
,"User„equested shutdown...");

2437 
	`ldbKlFÜkedSessiÚs
();

2442 ià(
£rv”
.
rdb_chd_pid
 != -1) {

2443 
	`£rv”Log
(
LL_WARNING
,"There is‡ child saving‡n .rdb. Killing it!");

2444 
	`kl
(
£rv”
.
rdb_chd_pid
,
SIGUSR1
);

2445 
	`rdbRemoveTempFe
(
£rv”
.
rdb_chd_pid
);

2448 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

2451 ià(
£rv”
.
aof_chd_pid
 != -1) {

2454 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_WAIT_REWRITE
) {

2455 
	`£rv”Log
(
LL_WARNING
, "Writing initial AOF, can'tƒxit.");

2456  
C_ERR
;

2458 
	`£rv”Log
(
LL_WARNING
,

2460 
	`kl
(
£rv”
.
aof_chd_pid
,
SIGUSR1
);

2463 
	`£rv”Log
(
LL_NOTICE
,"Calling fsync() onhe AOF file.");

2464 
	`aof_fsync
(
£rv”
.
aof_fd
);

2468 ià((
£rv”
.
§v•¬am¦’
 > 0 && !
no§ve
è|| 
§ve
) {

2469 if(
¥¬£InU£
)

2470 
	`£rv”Log
(
LL_NOTICE
, "Flushinghe RDB");

2472 
	`£rv”Log
(
LL_NOTICE
,"Savinghe final RDB snapshot beforeƒxiting.");

2474 ià(
	`rdbSave
(
£rv”
.
rdb_f’ame
è!ğ
C_OK
) {

2480 
	`£rv”Log
(
LL_WARNING
,"Errorryingo savehe DB, can'tƒxit.");

2481  
C_ERR
;

2486 ià(
£rv”
.
d«mÚize
 || s”v”.
pidfe
) {

2487 
	`£rv”Log
(
LL_NOTICE
,"Removinghe…id file.");

2488 
	`uÆšk
(
£rv”
.
pidfe
);

2493 
	`æushSÏvesOuutBufãrs
();

2496 
	`şo£Li¡’šgSock‘s
(1);

2497 
	`£rv”Log
(
LL_WARNING
,"%s is‚ow„eadyoƒxit, bye bye...",

2498 
£rv”
.
£Áš–_mode
 ? "Sentinel" : "Redis");

2499  
C_OK
;

2500 
	}
}

2513 
	$time_šd•’d’t_¡rcmp
(*
a
, *
b
) {

2514 
buç
[
CONFIG_AUTHPASS_MAX_LEN
], 
bufb
[CONFIG_AUTHPASS_MAX_LEN];

2519 
®’
 = 
	`¡¾’
(
a
);

2520 
bËn
 = 
	`¡¾’
(
b
);

2521 
j
;

2522 
diff
 = 0;

2527 ià(
®’
 > (
buç
è|| 
bËn
 > (
bufb
))  1;

2529 
	`mem£t
(
buç
,0,(bufa));

2530 
	`mem£t
(
bufb
,0,(bufb));

2533 
	`memıy
(
buç
,
a
,
®’
);

2534 
	`memıy
(
bufb
,
b
,
bËn
);

2538 
j
 = 0; j < (
buç
); j++) {

2539 
diff
 |ğ(
buç
[
j
] ^ 
bufb
[j]);

2542 
diff
 |ğ
®’
 ^ 
bËn
;

2543  
diff
;

2544 
	}
}

2546 
	$authCommªd
(
ş›Á
 *
c
) {

2547 ià(!
£rv”
.
»quœ•ass
) {

2548 
	`addR•lyE¼Ü
(
c
,"Client sent AUTH, but‚o…assword is set");

2549 } ià(!
	`time_šd•’d’t_¡rcmp
(
c
->
¬gv
[1]->
±r
, 
£rv”
.
»quœ•ass
)) {

2550 
c
->
auth’tiÿ‹d
 = 1;

2551 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

2553 
c
->
auth’tiÿ‹d
 = 0;

2554 
	`addR•lyE¼Ü
(
c
,"invalid…assword");

2556 
	}
}

2560 
	$pšgCommªd
(
ş›Á
 *
c
) {

2562 ià(
c
->
¬gc
 > 2) {

2563 
	`addR•lyE¼ÜFÜm©
(
c
,"wrong‚umber of‡rguments for '%s' command",

2564 
c
->
cmd
->
Çme
);

2568 ià(
c
->
æags
 & 
CLIENT_PUBSUB
) {

2569 
	`addR•ly
(
c
,
sh¬ed
.
mbulkhdr
[2]);

2570 
	`addR•lyBulkCBufãr
(
c
,"pong",4);

2571 ià(
c
->
¬gc
 == 1)

2572 
	`addR•lyBulkCBufãr
(
c
,"",0);

2574 
	`addR•lyBulk
(
c
,c->
¬gv
[1]);

2576 ià(
c
->
¬gc
 == 1)

2577 
	`addR•ly
(
c
,
sh¬ed
.
pÚg
);

2579 
	`addR•lyBulk
(
c
,c->
¬gv
[1]);

2581 
	}
}

2583 
	$echoCommªd
(
ş›Á
 *
c
) {

2584 
	`addR•lyBulk
(
c
,c->
¬gv
[1]);

2585 
	}
}

2587 
	$timeCommªd
(
ş›Á
 *
c
) {

2588 
timev®
 
tv
;

2592 
	`g‘timeofday
(&
tv
,
NULL
);

2593 
	`addR•lyMuÉiBulkL’
(
c
,2);

2594 
	`addR•lyBulkLÚgLÚg
(
c
,
tv
.
tv_£c
);

2595 
	`addR•lyBulkLÚgLÚg
(
c
,
tv
.
tv_u£c
);

2596 
	}
}

2599 
	$addR•lyCommªdFÏg
(
ş›Á
 *
c
, 
»disCommªd
 *
cmd
, 
f
, *
»¶y
) {

2600 ià(
cmd
->
æags
 & 
f
) {

2601 
	`addR•lyStus
(
c
, 
»¶y
);

2605 
	}
}

2608 
	$addR•lyCommªd
(
ş›Á
 *
c
, 
»disCommªd
 *
cmd
) {

2609 ià(!
cmd
) {

2610 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

2613 
	`addR•lyMuÉiBulkL’
(
c
, 6);

2614 
	`addR•lyBulkCSŒšg
(
c
, 
cmd
->
Çme
);

2615 
	`addR•lyLÚgLÚg
(
c
, 
cmd
->
¬™y
);

2617 
æagcouÁ
 = 0;

2618 *
æagËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2619 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_WRITE
, "write");

2620 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_READONLY
, "readonly");

2621 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_DENYOOM
, "denyoom");

2622 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_ADMIN
, "admin");

2623 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_PUBSUB
, "pubsub");

2624 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_NOSCRIPT
, "noscript");

2625 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_RANDOM
, "random");

2626 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_SORT_FOR_SCRIPT
,"sort_for_script");

2627 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_LOADING
, "loading");

2628 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_STALE
, "stale");

2629 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_SKIP_MONITOR
, "skip_monitor");

2630 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_ASKING
, "asking");

2631 
æagcouÁ
 +ğ
	`addR•lyCommªdFÏg
(
c
,
cmd
,
CMD_FAST
, "fast");

2632 ià((
cmd
->
g‘keys_´oc
 && !(cmd->
æags
 & 
CMD_MODULE
)) ||

2633 
cmd
->
æags
 & 
CMD_MODULE_GETKEYS
)

2635 
	`addR•lyStus
(
c
, "movablekeys");

2636 
æagcouÁ
 += 1;

2638 
	`£tDeã¼edMuÉiBulkL’gth
(
c
, 
æagËn
, 
æagcouÁ
);

2640 
	`addR•lyLÚgLÚg
(
c
, 
cmd
->
fœ¡key
);

2641 
	`addR•lyLÚgLÚg
(
c
, 
cmd
->
Ï¡key
);

2642 
	`addR•lyLÚgLÚg
(
c
, 
cmd
->
key¡•
);

2644 
	}
}

2647 
	$commªdCommªd
(
ş›Á
 *
c
) {

2648 
diùI‹¿tÜ
 *
di
;

2649 
diùEÁry
 *
de
;

2651 ià(
c
->
¬gc
 == 1) {

2652 
	`addR•lyMuÉiBulkL’
(
c
, 
	`diùSize
(
£rv”
.
commªds
));

2653 
di
 = 
	`diùG‘I‹¿tÜ
(
£rv”
.
commªds
);

2654 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2655 
	`addR•lyCommªd
(
c
, 
	`diùG‘V®
(
de
));

2657 
	`diùR–—£I‹¿tÜ
(
di
);

2658 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
, "info")) {

2659 
i
;

2660 
	`addR•lyMuÉiBulkL’
(
c
, c->
¬gc
-2);

2661 
i
 = 2; i < 
c
->
¬gc
; i++) {

2662 
	`addR•lyCommªd
(
c
, 
	`diùF‘chV®ue
(
£rv”
.
commªds
, c->
¬gv
[
i
]->
±r
));

2664 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
, "couÁ"è&& c->
¬gc
 == 2) {

2665 
	`addR•lyLÚgLÚg
(
c
, 
	`diùSize
(
£rv”
.
commªds
));

2666 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"g‘keys"è&& c->
¬gc
 >= 3) {

2667 
»disCommªd
 *
cmd
 = 
	`lookupCommªd
(
c
->
¬gv
[2]->
±r
);

2668 *
keys
, 
numkeys
, 
j
;

2670 ià(!
cmd
) {

2671 
	`addR•lyE¼ÜFÜm©
(
c
,"Invalid command specified");

2673 } ià((
cmd
->
¬™y
 > 0 && cmd->¬™y !ğ
c
->
¬gc
-2) ||

2674 ((
c
->
¬gc
-2è< -
cmd
->
¬™y
))

2676 
	`addR•lyE¼Ü
(
c
,"Invalid‚umber of‡rguments specified for command");

2680 
keys
 = 
	`g‘KeysFromCommªd
(
cmd
,
c
->
¬gv
+2,c->
¬gc
-2,&
numkeys
);

2681 
	`addR•lyMuÉiBulkL’
(
c
,
numkeys
);

2682 
j
 = 0; j < 
numkeys
; j++è
	`addR•lyBulk
(
c
,c->
¬gv
[
keys
[j]+2]);

2683 
	`g‘KeysF»eResuÉ
(
keys
);

2685 
	`addR•lyE¼Ü
(
c
, "Unknown subcommand or wrong‚umber of‡rguments.");

2688 
	}
}

2692 
	$by‹sToHumª
(*
s
, 
n
) {

2693 
d
;

2695 ià(
n
 < 1024) {

2697 
	`¥rštf
(
s
,"%ÎuB",
n
);

2699 } ià(
n
 < (1024*1024)) {

2700 
d
 = ()
n
/(1024);

2701 
	`¥rštf
(
s
,"%.2fK",
d
);

2702 } ià(
n
 < (1024LL*1024*1024)) {

2703 
d
 = ()
n
/(1024*1024);

2704 
	`¥rštf
(
s
,"%.2fM",
d
);

2705 } ià(
n
 < (1024LL*1024*1024*1024)) {

2706 
d
 = ()
n
/(1024LL*1024*1024);

2707 
	`¥rštf
(
s
,"%.2fG",
d
);

2708 } ià(
n
 < (1024LL*1024*1024*1024*1024)) {

2709 
d
 = ()
n
/(1024LL*1024*1024*1024);

2710 
	`¥rštf
(
s
,"%.2fT",
d
);

2711 } ià(
n
 < (1024LL*1024*1024*1024*1024*1024)) {

2712 
d
 = ()
n
/(1024LL*1024*1024*1024*1024);

2713 
	`¥rštf
(
s
,"%.2fP",
d
);

2716 
	`¥rštf
(
s
,"%ÎuB",
n
);

2718 
	}
}

2723 
sds
 
	$g’RedisInfoSŒšg
(*
£ùiÚ
) {

2724 
sds
 
šfo
 = 
	`sd£m±y
();

2725 
time_t
 
u±ime
 = 
£rv”
.
unixtime
-£rv”.
¡©_¡¬‰ime
;

2726 
j
, 
numcommªds
;

2727 
ru§ge
 
£lf_ru
, 
c_ru
;

2728 
lŞ
, 
bib
;

2729 
®l£ùiÚs
 = 0, 
def£ùiÚs
 = 0;

2730 
£ùiÚs
 = 0;

2732 ià(
£ùiÚ
 =ğ
NULL
) section = "default";

2733 
®l£ùiÚs
 = 
	`¡rÿ£cmp
(
£ùiÚ
,"all") == 0;

2734 
def£ùiÚs
 = 
	`¡rÿ£cmp
(
£ùiÚ
,"default") == 0;

2736 
	`g‘ru§ge
(
RUSAGE_SELF
, &
£lf_ru
);

2737 
	`g‘ru§ge
(
RUSAGE_CHILDREN
, &
c_ru
);

2738 
	`g‘Cl›ÁsMaxBufãrs
(&
lŞ
,&
bib
);

2741 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"server")) {

2742 
ÿÎ_uÇme
 = 1;

2743 
ut¢ame
 
Çme
;

2744 *
mode
;

2746 ià(
£rv”
.
şu¡”_’abËd
è
mode
 = "cluster";

2747 ià(
£rv”
.
£Áš–_mode
è
mode
 = "sentinel";

2748 
mode
 = "standalone";

2750 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

2752 ià(
ÿÎ_uÇme
) {

2754 
	`uÇme
(&
Çme
);

2755 
ÿÎ_uÇme
 = 0;

2758 
šfo
 = 
	`sdsÿrštf
(info,

2778 
REDIS_VERSION
,

2779 
	`»disG™SHA1
(),

2780 
	`¡¹Ş
(
	`»disG™Dœty
(),
NULL
,10) > 0,

2781 (è
	`»disBudId
(),

2782 
mode
,

2783 
Çme
.
sy¢ame
,‚ame.
»Ëa£
,‚ame.
machše
,

2784 
£rv”
.
¬ch_b™s
,

2785 
	`«G‘ApiName
(),

2786 #ifdeà
__GNUC__


2787 
__GNUC__
,
__GNUC_MINOR__
,
__GNUC_PATCHLEVEL__
,

2791 (è
	`g‘pid
(),

2792 
£rv”
.
runid
,

2793 
£rv”
.
pÜt
,

2794 (
štmax_t
)
u±ime
,

2795 (
štmax_t
)(
u±ime
/(3600*24)),

2796 
£rv”
.
hz
,

2797 (è
£rv”
.
Ìuşock
,

2798 
£rv”
.
execubË
 ? server.executable : "",

2799 
£rv”
.
cÚfigfe
 ? server.configfile : "");

2803 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"clients")) {

2804 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

2805 
šfo
 = 
	`sdsÿrštf
(info,

2811 
	`li¡L’gth
(
£rv”
.
ş›Ás
)-li¡L’gth(£rv”.
¦aves
),

2812 
lŞ
, 
bib
,

2813 
£rv”
.
bpİ_blocked_ş›Ás
);

2817 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"memory")) {

2818 
hmem
[64];

2819 
³ak_hmem
[64];

2820 
tÙ®_sy¡em_hmem
[64];

2821 
u£d_memÜy_lua_hmem
[64];

2822 
u£d_memÜy_rss_hmem
[64];

2823 
maxmemÜy_hmem
[64];

2824 
size_t
 
zm®loc_u£d
 = 
	`zm®loc_u£d_memÜy
();

2825 
size_t
 
tÙ®_sy¡em_mem
 = 
£rv”
.
sy¡em_memÜy_size
;

2826 cÚ¡ *
eviù_pŞicy
 = 
	`eviùPŞicyToSŒšg
();

2827 
memÜy_lua
 = ()
	`lua_gc
(
£rv”
.
lua
,
LUA_GCCOUNT
,0)*1024;

2828 
»disMemOv”h—d
 *
mh
 = 
	`g‘MemÜyOv”h—dD©a
();

2834 ià(
zm®loc_u£d
 > 
£rv”
.
¡©_³ak_memÜy
)

2835 
£rv”
.
¡©_³ak_memÜy
 = 
zm®loc_u£d
;

2837 
	`by‹sToHumª
(
hmem
,
zm®loc_u£d
);

2838 
	`by‹sToHumª
(
³ak_hmem
,
£rv”
.
¡©_³ak_memÜy
);

2839 
	`by‹sToHumª
(
tÙ®_sy¡em_hmem
,
tÙ®_sy¡em_mem
);

2840 
	`by‹sToHumª
(
u£d_memÜy_lua_hmem
,
memÜy_lua
);

2841 
	`by‹sToHumª
(
u£d_memÜy_rss_hmem
,
£rv”
.
»sid’t_£t_size
);

2842 
	`by‹sToHumª
(
maxmemÜy_hmem
,
£rv”
.
maxmemÜy
);

2844 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

2845 
šfo
 = 
	`sdsÿrštf
(info,

2868 
zm®loc_u£d
,

2869 
hmem
,

2870 
£rv”
.
»sid’t_£t_size
,

2871 
u£d_memÜy_rss_hmem
,

2872 
£rv”
.
¡©_³ak_memÜy
,

2873 
³ak_hmem
,

2874 
mh
->
³ak_³rc
,

2875 
mh
->
ov”h—d_tÙ®
,

2876 
mh
->
¡¬tup_®loÿ‹d
,

2877 
mh
->
d©a£t
,

2878 
mh
->
d©a£t_³rc
,

2879 ()
tÙ®_sy¡em_mem
,

2880 
tÙ®_sy¡em_hmem
,

2881 
memÜy_lua
,

2882 
u£d_memÜy_lua_hmem
,

2883 
£rv”
.
maxmemÜy
,

2884 
maxmemÜy_hmem
,

2885 
eviù_pŞicy
,

2886 
mh
->
äagm’tiÚ
,

2887 
ZMALLOC_LIB
,

2888 
	`Ïzyä“G‘P’dšgObjeùsCouÁ
()

2890 
	`ä“MemÜyOv”h—dD©a
(
mh
);

2894 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"persistence")) {

2895 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

2896 
šfo
 = 
	`sdsÿrštf
(info,

2914 
£rv”
.
lßdšg
,

2915 
£rv”
.
dœty
,

2916 
£rv”
.
rdb_chd_pid
 != -1,

2917 (
štmax_t
)
£rv”
.
Ï¡§ve
,

2918 (
£rv”
.
Ï¡bg§ve_¡©us
 =ğ
C_OK
) ? "ok" : "err",

2919 (
štmax_t
)
£rv”
.
rdb_§ve_time_Ï¡
,

2920 (
štmax_t
)((
£rv”
.
rdb_chd_pid
 == -1) ?

2921 -1 : 
	`time
(
NULL
)-
£rv”
.
rdb_§ve_time_¡¬t
),

2922 
£rv”
.
¡©_rdb_cow_by‹s
,

2923 
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
,

2924 
£rv”
.
aof_chd_pid
 != -1,

2925 
£rv”
.
aof_»wr™e_scheduËd
,

2926 (
štmax_t
)
£rv”
.
aof_»wr™e_time_Ï¡
,

2927 (
štmax_t
)((
£rv”
.
aof_chd_pid
 == -1) ?

2928 -1 : 
	`time
(
NULL
)-
£rv”
.
aof_»wr™e_time_¡¬t
),

2929 (
£rv”
.
aof_Ï¡bg»wr™e_¡©us
 =ğ
C_OK
) ? "ok" : "err",

2930 (
£rv”
.
aof_Ï¡_wr™e_¡©us
 =ğ
C_OK
) ? "ok" : "err",

2931 
£rv”
.
¡©_aof_cow_by‹s
);

2933 ià(
£rv”
.
aof_¡©e
 !ğ
AOF_OFF
) {

2934 
šfo
 = 
	`sdsÿrštf
(info,

2942 (è
£rv”
.
aof_cu¼’t_size
,

2943 (è
£rv”
.
aof_»wr™e_ba£_size
,

2944 
£rv”
.
aof_»wr™e_scheduËd
,

2945 
	`sd¦’
(
£rv”
.
aof_buf
),

2946 
	`aofRewr™eBufãrSize
(),

2947 
	`bioP’dšgJobsOfTy³
(
BIO_AOF_FSYNC
),

2948 
£rv”
.
aof_d–ayed_fsync
);

2951 ià(
£rv”
.
lßdšg
) {

2952 
³rc
;

2953 
time_t
 
‘a
, 
–­£d
;

2954 
off_t
 
»maššg_by‹s
 = 
£rv”
.
lßdšg_tÙ®_by‹s
-

2955 
£rv”
.
lßdšg_lßded_by‹s
;

2957 
³rc
 = (()
£rv”
.
lßdšg_lßded_by‹s
 /

2958 (
£rv”
.
lßdšg_tÙ®_by‹s
+1)) * 100;

2960 
–­£d
 = 
	`time
(
NULL
)-
£rv”
.
lßdšg_¡¬t_time
;

2961 ià(
–­£d
 == 0) {

2962 
‘a
 = 1;

2965 
‘a
 = (
–­£d
*
»maššg_by‹s
)/(
£rv”
.
lßdšg_lßded_by‹s
+1);

2968 
šfo
 = 
	`sdsÿrštf
(info,

2974 (
štmax_t
è
£rv”
.
lßdšg_¡¬t_time
,

2975 (è
£rv”
.
lßdšg_tÙ®_by‹s
,

2976 (è
£rv”
.
lßdšg_lßded_by‹s
,

2977 
³rc
,

2978 (
štmax_t
)
‘a


2984 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"stats")) {

2985 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

2986 
šfo
 = 
	`sdsÿrštf
(info,

3007 
£rv”
.
¡©_numcÚÃùiÚs
,

3008 
£rv”
.
¡©_numcommªds
,

3009 
	`g‘In¡ªÃousM‘ric
(
STATS_METRIC_COMMAND
),

3010 
£rv”
.
¡©_Ãt_šput_by‹s
,

3011 
£rv”
.
¡©_Ãt_ouut_by‹s
,

3012 ()
	`g‘In¡ªÃousM‘ric
(
STATS_METRIC_NET_INPUT
)/1024,

3013 ()
	`g‘In¡ªÃousM‘ric
(
STATS_METRIC_NET_OUTPUT
)/1024,

3014 
£rv”
.
¡©_»jeùed_cÚn
,

3015 
£rv”
.
¡©_sync_fuÎ
,

3016 
£rv”
.
¡©_sync_·¹Ÿl_ok
,

3017 
£rv”
.
¡©_sync_·¹Ÿl_”r
,

3018 
£rv”
.
¡©_expœedkeys
,

3019 
£rv”
.
¡©_eviùedkeys
,

3020 
£rv”
.
¡©_key¥aû_h™s
,

3021 
£rv”
.
¡©_key¥aû_mis£s
,

3022 
	`diùSize
(
£rv”
.
pubsub_chªÃls
),

3023 
	`li¡L’gth
(
£rv”
.
pubsub_·‰”ns
),

3024 
£rv”
.
¡©_fÜk_time
,

3025 
	`diùSize
(
£rv”
.
mig¿‹_ÿched_sock‘s
));

3029 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"replication")) {

3030 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3031 
šfo
 = 
	`sdsÿrštf
(info,

3034 
£rv”
.
ma¡”ho¡
 =ğ
NULL
 ? "master" : "slave");

3035 ià(
£rv”
.
ma¡”ho¡
) {

3036 
¦ave_»¶_off£t
 = 1;

3038 ià(
£rv”
.
ma¡”
)

3039 
¦ave_»¶_off£t
 = 
£rv”
.
ma¡”
->
»¶off
;

3040 ià(
£rv”
.
ÿched_ma¡”
)

3041 
¦ave_»¶_off£t
 = 
£rv”
.
ÿched_ma¡”
->
»¶off
;

3043 
šfo
 = 
	`sdsÿrštf
(info,

3050 ,
£rv”
.
ma¡”ho¡
,

3051 
£rv”
.
ma¡”pÜt
,

3052 (
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_CONNECTED
) ?

3054 
£rv”
.
ma¡”
 ?

3055 (()(
£rv”
.
unixtime
-£rv”.
ma¡”
->
Ï¡š‹¿ùiÚ
)) : -1,

3056 
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
,

3057 
¦ave_»¶_off£t


3060 ià(
£rv”
.
»¶_¡©e
 =ğ
REPL_STATE_TRANSFER
) {

3061 
šfo
 = 
	`sdsÿrštf
(info,

3065 (
£rv”
.
»¶_Œªsãr_size
 - s”v”.
»¶_Œªsãr_»ad
),

3066 ()(
£rv”
.
unixtime
-£rv”.
»¶_Œªsãr_Ï¡io
)

3070 ià(
£rv”
.
»¶_¡©e
 !ğ
REPL_STATE_CONNECTED
) {

3071 
šfo
 = 
	`sdsÿrštf
(info,

3073 (
štmax_t
)
£rv”
.
unixtime
-£rv”.
»¶_down_sšû
);

3075 
šfo
 = 
	`sdsÿrštf
(info,

3078 
£rv”
.
¦ave_´iÜ™y
,

3079 
£rv”
.
»¶_¦ave_ro
);

3082 
šfo
 = 
	`sdsÿrštf
(info,

3084 
	`li¡L’gth
(
£rv”
.
¦aves
));

3088 ià(
£rv”
.
»¶_mš_¦aves_to_wr™e
 &&

3089 
£rv”
.
»¶_mš_¦aves_max_Ïg
) {

3090 
šfo
 = 
	`sdsÿrštf
(info,

3092 
£rv”
.
»¶_good_¦aves_couÁ
);

3095 ià(
	`li¡L’gth
(
£rv”
.
¦aves
)) {

3096 
¦aveid
 = 0;

3097 
li¡Node
 *
Ê
;

3098 
li¡I‹r
 
li
;

3100 
	`li¡Rewšd
(
£rv”
.
¦aves
,&
li
);

3101 (
Ê
 = 
	`li¡Next
(&
li
))) {

3102 
ş›Á
 *
¦ave
 = 
	`li¡NodeV®ue
(
Ê
);

3103 *
¡©e
 = 
NULL
;

3104 

[
NET_IP_STR_LEN
], *
¦ave
 = 
¦ave
->
¦ave_
;

3105 
pÜt
;

3106 
Ïg
 = 0;

3108 ià(
¦ave
[0] == '\0') {

3109 ià(
	`ª‘P“rToSŒšg
(
¦ave
->
fd
,

,(),&
pÜt
) == -1)

3111 
¦ave
 = 

;

3113 
¦ave
->
»¶¡©e
) {

3114 
SLAVE_STATE_WAIT_BGSAVE_START
:

3115 
SLAVE_STATE_WAIT_BGSAVE_END
:

3116 
¡©e
 = "wait_bgsave";

3118 
SLAVE_STATE_SEND_BULK
:

3119 
¡©e
 = "send_bulk";

3121 
SLAVE_STATE_ONLINE
:

3122 
¡©e
 = "online";

3125 ià(
¡©e
 =ğ
NULL
) ;

3126 ià(
¦ave
->
»¶¡©e
 =ğ
SLAVE_STATE_ONLINE
)

3127 
Ïg
 = 
	`time
(
NULL
è- 
¦ave
->
»¶_ack_time
;

3129 
šfo
 = 
	`sdsÿrštf
(info,

3132 
¦aveid
,
¦ave
,
¦ave
->
¦ave_li¡’šg_pÜt
,
¡©e
,

3133 
¦ave
->
»¶_ack_off
, 
Ïg
);

3134 
¦aveid
++;

3137 
šfo
 = 
	`sdsÿrštf
(info,

3143 
£rv”
.
ma¡”_»¶_off£t
,

3144 
£rv”
.
»¶_backlog
 !ğ
NULL
,

3145 
£rv”
.
»¶_backlog_size
,

3146 
£rv”
.
»¶_backlog_off
,

3147 
£rv”
.
»¶_backlog_hi¡Ën
);

3151 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"cpu")) {

3152 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3153 
šfo
 = 
	`sdsÿrštf
(info,

3159 ()
£lf_ru
.
ru_¡ime
.
tv_£c
+()£lf_ru.ru_¡ime.
tv_u£c
/1000000,

3160 ()
£lf_ru
.
ru_utime
.
tv_£c
+()£lf_ru.ru_utime.
tv_u£c
/1000000,

3161 ()
c_ru
.
ru_¡ime
.
tv_£c
+()c_ru.ru_¡ime.
tv_u£c
/1000000,

3162 ()
c_ru
.
ru_utime
.
tv_£c
+()c_ru.ru_utime.
tv_u£c
/1000000);

3166 ià(
®l£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"commandstats")) {

3167 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3168 
šfo
 = 
	`sdsÿrštf
(info, "# Commandstats\r\n");

3169 
numcommªds
 = (
»disCommªdTabË
)/(
»disCommªd
);

3170 
j
 = 0; j < 
numcommªds
; j++) {

3171 
»disCommªd
 *
c
 = 
»disCommªdTabË
+
j
;

3173 ià(!
c
->
ÿÎs
) ;

3174 
šfo
 = 
	`sdsÿrštf
(info,

3176 
c
->
Çme
, c->
ÿÎs
, c->
miüo£cÚds
,

3177 (
c
->
ÿÎs
 =ğ0è? 0 : (()c->
miüo£cÚds
/c->calls));

3182 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"cluster")) {

3183 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3184 
šfo
 = 
	`sdsÿrštf
(info,

3187 
£rv”
.
şu¡”_’abËd
);

3191 ià(
®l£ùiÚs
 || 
def£ùiÚs
 || !
	`¡rÿ£cmp
(
£ùiÚ
,"keyspace")) {

3192 ià(
£ùiÚs
++è
šfo
 = 
	`sdsÿt
(info,"\r\n");

3193 
šfo
 = 
	`sdsÿrštf
(info, "# Keyspace\r\n");

3194 
j
 = 0; j < 
£rv”
.
dbnum
; j++) {

3195 
keys
, 
vkeys
;

3197 
keys
 = 
	`diùSize
(
£rv”
.
db
[
j
].
diù
);

3198 
vkeys
 = 
	`diùSize
(
£rv”
.
db
[
j
].
expœes
);

3199 ià(
keys
 || 
vkeys
) {

3200 
šfo
 = 
	`sdsÿrštf
(info,

3202 
j
, 
keys
, 
vkeys
, 
£rv”
.
db
[j].
avg_‰l
);

3206  
šfo
;

3207 
	}
}

3209 
	$šfoCommªd
(
ş›Á
 *
c
) {

3210 *
£ùiÚ
 = 
c
->
¬gc
 =ğ2 ? c->
¬gv
[1]->
±r
 : "default";

3212 ià(
c
->
¬gc
 > 2) {

3213 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

3216 
	`addR•lyBulkSds
(
c
, 
	`g’RedisInfoSŒšg
(
£ùiÚ
));

3217 
	}
}

3219 
	$mÚ™ÜCommªd
(
ş›Á
 *
c
) {

3221 ià(
c
->
æags
 & 
CLIENT_SLAVE
) ;

3223 
c
->
æags
 |ğ(
CLIENT_SLAVE
|
CLIENT_MONITOR
);

3224 
	`li¡AddNodeTa
(
£rv”
.
mÚ™Üs
,
c
);

3225 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

3226 
	}
}

3230 #ifdeà
__lšux__


3231 
	$lšuxOv”comm™MemÜyV®ue
() {

3232 
FILE
 *
å
 = 
	`fİ’
("/proc/sys/vm/overcommit_memory","r");

3233 
buf
[64];

3235 ià(!
å
)  -1;

3236 ià(
	`fg‘s
(
buf
,64,
å
è=ğ
NULL
) {

3237 
	`fşo£
(
å
);

3240 
	`fşo£
(
å
);

3242  
	`©oi
(
buf
);

3243 
	}
}

3245 
	$lšuxMemÜyW¬nšgs
() {

3246 ià(
	`lšuxOv”comm™MemÜyV®ue
() == 0) {

3247 
	`£rv”Log
(
LL_WARNING
,"WARNING overcommit_memory is seto 0! Background save may fail under†ow memory condition. To fixhis issue‡dd 'vm.overcommit_memory = 1'o /etc/sysctl.conf‡ndhen„eboot or„unhe command 'sysctl vm.overcommit_memory=1' forhisoakeƒffect.");

3249 ià(
	`THPIsEÇbËd
()) {

3250 
	`£rv”Log
(
LL_WARNING
,"WARNING you have Transparent Huge Pages (THP) supportƒnabled in your kernel. This will create†atency‡nd memory usage issues with Redis. To fixhis issue„unhe command 'echo‚ever > /sys/kernel/mm/transparent_hugepage/enabled'‡s„oot,‡nd‡dd ito your /etc/rc.local in ordero„etainhe setting‡fter‡„eboot. Redis must be„estarted‡fter THP is disabled.");

3252 
	}
}

3255 
	$ü—‹PidFe
() {

3258 ià(!
£rv”
.
pidfe
è£rv”.pidfğ
	`z¡rdup
(
CONFIG_DEFAULT_PID_FILE
);

3261 
FILE
 *
å
 = 
	`fİ’
(
£rv”
.
pidfe
,"w");

3262 ià(
å
) {

3263 
	`årštf
(
å
,"%d\n",()
	`g‘pid
());

3264 
	`fşo£
(
å
);

3266 
	}
}

3268 
	$d«mÚize
() {

3269 
fd
;

3271 ià(
	`fÜk
(è!ğ0è
	`ex™
(0);

3272 
	`£tsid
();

3277 ià((
fd
 = 
	`İ’
("/dev/nuÎ", 
O_RDWR
, 0)) != -1) {

3278 
	`dup2
(
fd
, 
STDIN_FILENO
);

3279 
	`dup2
(
fd
, 
STDOUT_FILENO
);

3280 
	`dup2
(
fd
, 
STDERR_FILENO
);

3281 ià(
fd
 > 
STDERR_FILENO
è
	`şo£
(fd);

3283 
	}
}

3285 
	$v”siÚ
() {

3286 
	`´štf
("Redis server v=%s sha=%s:%d malloc=%s bits=%d build=%llx\n",

3287 
REDIS_VERSION
,

3288 
	`»disG™SHA1
(),

3289 
	`©oi
(
	`»disG™Dœty
()) > 0,

3290 
ZMALLOC_LIB
,

3292 (è
	`»disBudId
());

3293 
	`ex™
(0);

3294 
	}
}

3296 
	$u§ge
() {

3297 
	`årštf
(
¡d”r
,"Usage: ./redis-server [/path/to/redis.conf] [options]\n");

3298 
	`årštf
(
¡d”r
," ./redis-server - (read config from stdin)\n");

3299 
	`årštf
(
¡d”r
," ./redis-server -v or --version\n");

3300 
	`årštf
(
¡d”r
," ./redis-server -h or --help\n");

3301 
	`årštf
(
¡d”r
," ./redis-server --test-memory <megabytes>\n\n");

3302 
	`årštf
(
¡d”r
,"Examples:\n");

3303 
	`årštf
(
¡d”r
," ./redis-server (runhe server with default conf)\n");

3304 
	`årštf
(
¡d”r
," ./redis-server /etc/redis/6379.conf\n");

3305 
	`årštf
(
¡d”r
," ./redis-server --port 7777\n");

3306 
	`årštf
(
¡d”r
," ./redis-server --port 7777 --slaveof 127.0.0.1 8888\n");

3307 
	`årštf
(
¡d”r
," ./redis-server /etc/myredis.conf --loglevel verbose\n\n");

3308 
	`årštf
(
¡d”r
,"Sentinel mode:\n");

3309 
	`årštf
(
¡d”r
," ./redis-server /etc/sentinel.conf --sentinel\n");

3310 
	`ex™
(1);

3311 
	}
}

3313 
	$»disAsciiA¹
() {

3314 
	~"asciogo.h
"

3315 *
buf
 = 
	`zm®loc
(1024*16);

3316 *
mode
;

3318 ià(
£rv”
.
şu¡”_’abËd
è
mode
 = "cluster";

3319 ià(
£rv”
.
£Áš–_mode
è
mode
 = "sentinel";

3320 
mode
 = "standalone";

3322 ià(
£rv”
.
sy¦og_’abËd
) {

3323 
	`£rv”Log
(
LL_NOTICE
,

3325 
REDIS_VERSION
,

3326 
	`»disG™SHA1
(),

3327 
	`¡¹Ş
(
	`»disG™Dœty
(),
NULL
,10) > 0,

3329 
mode
, 
£rv”
.
pÜt
,

3330 (è
	`g‘pid
()

3333 
	`¢´štf
(
buf
,1024*16,
ascii_logo
,

3334 
REDIS_VERSION
,

3335 
	`»disG™SHA1
(),

3336 
	`¡¹Ş
(
	`»disG™Dœty
(),
NULL
,10) > 0,

3338 
mode
, 
£rv”
.
pÜt
,

3339 (è
	`g‘pid
()

3341 
	`£rv”LogRaw
(
LL_NOTICE
|
LL_RAW
,
buf
);

3343 
	`zä“
(
buf
);

3344 
	}
}

3346 
	$sigShutdownHªdËr
(
sig
) {

3347 *
msg
;

3349 
sig
) {

3350 
SIGINT
:

3351 
msg
 = "Received SIGINT scheduling shutdown...";

3353 
SIGTERM
:

3354 
msg
 = "Received SIGTERM scheduling shutdown...";

3357 
msg
 = "Received shutdown signal, scheduling shutdown...";

3364 ià(
£rv”
.
shutdown_a§p
 && 
sig
 =ğ
SIGINT
) {

3365 
	`£rv”LogFromHªdËr
(
LL_WARNING
, "You insist...ƒxiting‚ow.");

3366 
	`rdbRemoveTempFe
(
	`g‘pid
());

3367 
	`ex™
(1);

3368 } ià(
£rv”
.
lßdšg
) {

3369 
	`ex™
(0);

3372 
	`£rv”LogFromHªdËr
(
LL_WARNING
, 
msg
);

3373 
£rv”
.
shutdown_a§p
 = 1;

3374 
	}
}

3376 
	$£tupSigÇlHªdËrs
() {

3377 
sigaùiÚ
 
aù
;

3381 
	`sigem±y£t
(&
aù
.
§_mask
);

3382 
aù
.
§_æags
 = 0;

3383 
aù
.
§_hªdËr
 = 
sigShutdownHªdËr
;

3384 
	`sigaùiÚ
(
SIGTERM
, &
aù
, 
NULL
);

3385 
	`sigaùiÚ
(
SIGINT
, &
aù
, 
NULL
);

3387 #ifdeà
HAVE_BACKTRACE


3388 
	`sigem±y£t
(&
aù
.
§_mask
);

3389 
aù
.
§_æags
 = 
SA_NODEFER
 | 
SA_RESETHAND
 | 
SA_SIGINFO
;

3390 
aù
.
§_sigaùiÚ
 = 
sig£gvHªdËr
;

3391 
	`sigaùiÚ
(
SIGSEGV
, &
aù
, 
NULL
);

3392 
	`sigaùiÚ
(
SIGBUS
, &
aù
, 
NULL
);

3393 
	`sigaùiÚ
(
SIGFPE
, &
aù
, 
NULL
);

3394 
	`sigaùiÚ
(
SIGILL
, &
aù
, 
NULL
);

3397 
	}
}

3399 
mem‹¡
(
size_t
 
megaby‹s
, 
·s£s
);

3403 
	$checkFÜS’tš–Mode
(
¬gc
, **
¬gv
) {

3404 
j
;

3406 ià(
	`¡r¡r
(
¬gv
[0],"»dis-£Áš–"è!ğ
NULL
)  1;

3407 
j
 = 1; j < 
¬gc
; j++)

3408 ià(!
	`¡rcmp
(
¬gv
[
j
],"--sentinel"))  1;

3410 
	}
}

3413 
	$lßdD©aFromDisk
() {

3414 
¡¬t
 = 
	`u¡ime
();

3415 ià(
£rv”
.
aof_¡©e
 =ğ
AOF_ON
) {

3416 ià(
	`lßdAµ’dOÆyFe
(
£rv”
.
aof_f’ame
è=ğ
C_OK
)

3417 
	`£rv”Log
(
LL_NOTICE
,"DB†ßded from‡µ’d oÆy fe: %.3à£cÚds",()(
	`u¡ime
()-
¡¬t
)/1000000);

3419 ià(
	`rdbLßd
(
£rv”
.
rdb_f’ame
è=ğ
C_OK
) {

3420 
	`£rv”Log
(
LL_NOTICE
,"DB†oaded from disk: %.3f seconds",

3421 ()(
	`u¡ime
()-
¡¬t
)/1000000);

3422 } ià(
”ºo
 !ğ
ENOENT
) {

3423 
	`£rv”Log
(
LL_WARNING
,"F©®ƒ¼Ü†ßdšghDB: %s. Ex™šg.",
	`¡»¼Ü
(
”ºo
));

3424 
	`ex™
(1);

3427 
	}
}

3429 
	$»disOutOfMemÜyHªdËr
(
size_t
 
®loÿtiÚ_size
) {

3430 
	`£rv”Log
(
LL_WARNING
,"Out Of Memory‡llocating %zu bytes!",

3431 
®loÿtiÚ_size
);

3432 
	`£rv”Pªic
("Redis‡borting for OUT OF MEMORY");

3433 
	}
}

3435 
	$»disS‘ProcT™Ë
(*
t™Ë
) {

3436 #ifdeà
USE_SETPROCTITLE


3437 *
£rv”_mode
 = "";

3438 ià(
£rv”
.
şu¡”_’abËd
è
£rv”_mode
 = " [cluster]";

3439 ià(
£rv”
.
£Áš–_mode
è
£rv”_mode
 = " [sentinel]";

3441 
	`£roù™Ë
("%s %s:%d%s",

3442 
t™Ë
,

3443 
£rv”
.
bšdaddr_couÁ
 ? s”v”.
bšdaddr
[0] : "*",

3444 
£rv”
.
pÜt
,

3445 
£rv”_mode
);

3447 
	`UNUSED
(
t™Ë
);

3449 
	}
}

3455 
	$»disSu³rvi£dUp¡¬t
() {

3456 cÚ¡ *
up¡¬t_job
 = 
	`g‘’v
("UPSTART_JOB");

3458 ià(!
up¡¬t_job
) {

3459 
	`£rv”Log
(
LL_WARNING
,

3464 
	`£rv”Log
(
LL_NOTICE
, "supervised by upstart, will stopo signal„eadiness");

3465 
	`¿i£
(
SIGSTOP
);

3466 
	`un£‹nv
("UPSTART_JOB");

3468 
	}
}

3470 
	$»disSu³rvi£dSy¡emd
() {

3471 cÚ¡ *
nÙify_sock‘
 = 
	`g‘’v
("NOTIFY_SOCKET");

3472 
fd
 = 1;

3473 
sockaddr_un
 
su
;

3474 
iovec
 
iov
;

3475 
msghdr
 
hdr
;

3476 
£ndto_æags
 = 0;

3478 ià(!
nÙify_sock‘
) {

3479 
	`£rv”Log
(
LL_WARNING
,

3484 ià((
	`¡rchr
("@/", 
nÙify_sock‘
[0])è=ğ
NULL
 || 
	`¡¾’
(notify_socket) < 2) {

3488 
	`£rv”Log
(
LL_NOTICE
, "supervised by systemd, will signal„eadiness");

3489 ià((
fd
 = 
	`sock‘
(
AF_UNIX
, 
SOCK_DGRAM
, 0)) == -1) {

3490 
	`£rv”Log
(
LL_WARNING
,

3491 "Cª'ˆcÚÃùØsy¡emd sock‘ %s", 
nÙify_sock‘
);

3495 
	`mem£t
(&
su
, 0, (su));

3496 
su
.
sun_çmy
 = 
AF_UNIX
;

3497 
	`¡ºıy
 (
su
.
sun_·th
, 
nÙify_sock‘
, (su.sun_path) -1);

3498 
su
.
sun_·th
[(su.sun_path) - 1] = '\0';

3500 ià(
nÙify_sock‘
[0] == '@')

3501 
su
.
sun_·th
[0] = '\0';

3503 
	`mem£t
(&
iov
, 0, (iov));

3504 
iov
.
iov_ba£
 = "READY=1";

3505 
iov
.
iov_Ën
 = 
	`¡¾’
("READY=1");

3507 
	`mem£t
(&
hdr
, 0, (hdr));

3508 
hdr
.
msg_Çme
 = &
su
;

3509 
hdr
.
msg_Çm–’
 = 
	`off£tof
(
sockaddr_un
, 
sun_·th
) +

3510 
	`¡¾’
(
nÙify_sock‘
);

3511 
hdr
.
msg_iov
 = &
iov
;

3512 
hdr
.
msg_iovËn
 = 1;

3514 
	`un£‹nv
("NOTIFY_SOCKET");

3515 #ifdeà
HAVE_MSG_NOSIGNAL


3516 
£ndto_æags
 |ğ
MSG_NOSIGNAL
;

3518 ià(
	`£ndmsg
(
fd
, &
hdr
, 
£ndto_æags
) < 0) {

3519 
	`£rv”Log
(
LL_WARNING
, "Can't send‚otificationo systemd");

3520 
	`şo£
(
fd
);

3523 
	`şo£
(
fd
);

3525 
	}
}

3527 
	$»disIsSu³rvi£d
(
mode
) {

3528 ià(
mode
 =ğ
SUPERVISED_AUTODETECT
) {

3529 cÚ¡ *
up¡¬t_job
 = 
	`g‘’v
("UPSTART_JOB");

3530 cÚ¡ *
nÙify_sock‘
 = 
	`g‘’v
("NOTIFY_SOCKET");

3532 ià(
up¡¬t_job
) {

3533 
	`»disSu³rvi£dUp¡¬t
();

3534 } ià(
nÙify_sock‘
) {

3535 
	`»disSu³rvi£dSy¡emd
();

3537 } ià(
mode
 =ğ
SUPERVISED_UPSTART
) {

3538  
	`»disSu³rvi£dUp¡¬t
();

3539 } ià(
mode
 =ğ
SUPERVISED_SYSTEMD
) {

3540  
	`»disSu³rvi£dSy¡emd
();

3544 
	}
}

3547 
	$maš
(
¬gc
, **
¬gv
) {

3548 
timev®
 
tv
;

3549 
j
;

3551 #ifdeà
REDIS_TEST


3552 ià(
¬gc
 =ğ3 && !
	`¡rÿ£cmp
(
¬gv
[1], "test")) {

3553 ià(!
	`¡rÿ£cmp
(
¬gv
[2], "ziplist")) {

3554  
	`zli¡Te¡
(
¬gc
, 
¬gv
);

3555 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "quicklist")) {

3556 
	`quickli¡Te¡
(
¬gc
, 
¬gv
);

3557 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "intset")) {

3558  
	`št£tTe¡
(
¬gc
, 
¬gv
);

3559 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "zipmap")) {

3560  
	`zm­Te¡
(
¬gc
, 
¬gv
);

3561 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "sha1test")) {

3562  
	`sha1Te¡
(
¬gc
, 
¬gv
);

3563 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "util")) {

3564  
	`utTe¡
(
¬gc
, 
¬gv
);

3565 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "sds")) {

3566  
	`sdsTe¡
(
¬gc
, 
¬gv
);

3567 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "endianconv")) {

3568  
	`’dŸncÚvTe¡
(
¬gc
, 
¬gv
);

3569 } ià(!
	`¡rÿ£cmp
(
¬gv
[2], "crc64")) {

3570  
	`üc64Te¡
(
¬gc
, 
¬gv
);

3578 #ifdeà
INIT_SETPROCTITLE_REPLACEMENT


3579 
	`¥t_š™
(
¬gc
, 
¬gv
);

3581 
	`£oÿË
(
LC_COLLATE
,"");

3582 
	`zm®loc_’abË_th»ad_§ãÃss
();

3583 
	`zm®loc_£t_oom_hªdËr
(
»disOutOfMemÜyHªdËr
);

3584 
	`¤ªd
(
	`time
(
NULL
)^
	`g‘pid
());

3585 
	`g‘timeofday
(&
tv
,
NULL
);

3586 
	`diùS‘HashFunùiÚS“d
(
tv
.
tv_£c
^tv.
tv_u£c
^
	`g‘pid
());

3587 
£rv”
.
£Áš–_mode
 = 
	`checkFÜS’tš–Mode
(
¬gc
,
¬gv
);

3588 
	`š™S”v”CÚfig
();

3589 
	`moduËIn™ModuËsSy¡em
();

3593 
£rv”
.
execubË
 = 
	`g‘AbsŞu‹P©h
(
¬gv
[0]);

3594 
£rv”
.
exec_¬gv
 = 
	`zm®loc
((*)*(
¬gc
+1));

3595 
£rv”
.
exec_¬gv
[
¬gc
] = 
NULL
;

3596 
j
 = 0; j < 
¬gc
; j++è
£rv”
.
exec_¬gv
[j] = 
	`z¡rdup
(
¬gv
[j]);

3601 ià(
£rv”
.
£Áš–_mode
) {

3602 
	`š™S’tš–CÚfig
();

3603 
	`š™S’tš–
();

3609 ià(
	`¡r¡r
(
¬gv
[0],"»dis-check-rdb"è!ğ
NULL
)

3610 
	`»dis_check_rdb_maš
(
¬gc
,
¬gv
);

3612 ià(
¬gc
 >= 2) {

3613 
j
 = 1;

3614 
sds
 
İtiÚs
 = 
	`sd£m±y
();

3615 *
cÚfigfe
 = 
NULL
;

3618 ià(
	`¡rcmp
(
¬gv
[1], "-v") == 0 ||

3619 
	`¡rcmp
(
¬gv
[1], "--v”siÚ"è=ğ0è
	`v”siÚ
();

3620 ià(
	`¡rcmp
(
¬gv
[1], "--help") == 0 ||

3621 
	`¡rcmp
(
¬gv
[1], "-h"è=ğ0è
	`u§ge
();

3622 ià(
	`¡rcmp
(
¬gv
[1], "--test-memory") == 0) {

3623 ià(
¬gc
 == 3) {

3624 
	`mem‹¡
(
	`©oi
(
¬gv
[2]),50);

3625 
	`ex™
(0);

3627 
	`årštf
(
¡d”r
,"Please specifyhe‡mount of memoryoest in megabytes.\n");

3628 
	`årštf
(
¡d”r
,"Example: ./redis-server --test-memory 4096\n\n");

3629 
	`ex™
(1);

3634 ià(
¬gv
[
j
][0] != '-' ||‡rgv[j][1] != '-') {

3635 
cÚfigfe
 = 
¬gv
[
j
];

3636 
£rv”
.
cÚfigfe
 = 
	`g‘AbsŞu‹P©h
(configfile);

3639 
	`zä“
(
£rv”
.
exec_¬gv
[
j
]);

3640 
£rv”
.
exec_¬gv
[
j
] = 
	`z¡rdup
(£rv”.
cÚfigfe
);

3641 
j
++;

3648 
j
 !ğ
¬gc
) {

3649 ià(
¬gv
[
j
][0] == '-' &&‡rgv[j][1] == '-') {

3651 ià(!
	`¡rcmp
(
¬gv
[
j
], "--check-rdb")) {

3653 
j
++;

3656 ià(
	`sd¦’
(
İtiÚs
)èİtiÚ ğ
	`sdsÿt
(options,"\n");

3657 
İtiÚs
 = 
	`sdsÿt
(İtiÚs,
¬gv
[
j
]+2);

3658 
İtiÚs
 = 
	`sdsÿt
(options," ");

3661 
İtiÚs
 = 
	`sdsÿŒ•r
(İtiÚs,
¬gv
[
j
],
	`¡¾’
(argv[j]));

3662 
İtiÚs
 = 
	`sdsÿt
(options," ");

3664 
j
++;

3666 ià(
£rv”
.
£Áš–_mode
 && 
cÚfigfe
 && *configfile == '-') {

3667 
	`£rv”Log
(
LL_WARNING
,

3669 
	`£rv”Log
(
LL_WARNING
,

3671 
	`ex™
(1);

3673 
	`»£tS”v”SaveP¬ams
();

3674 
	`lßdS”v”CÚfig
(
cÚfigfe
,
İtiÚs
);

3675 
	`sdsä“
(
İtiÚs
);

3677 
	`£rv”Log
(
LL_WARNING
, "W¬nšg:‚ØcÚfig f¥ecif›d, usšghdeçuÉ cÚfig. IÀÜd”Ø¥ecify‡ cÚfig fu£ % /·th/to/%s.cÚf", 
¬gv
[0], 
£rv”
.
£Áš–_mode
 ? "sentinel" : "redis");

3680 
£rv”
.
su³rvi£d
 = 
	`»disIsSu³rvi£d
(£rv”.
su³rvi£d_mode
);

3681 
background
 = 
£rv”
.
d«mÚize
 && !£rv”.
su³rvi£d
;

3682 ià(
background
è
	`d«mÚize
();

3684 
	`š™S”v”
();

3685 ià(
background
 || 
£rv”
.
pidfe
è
	`ü—‹PidFe
();

3686 
	`»disS‘ProcT™Ë
(
¬gv
[0]);

3687 
	`»disAsciiA¹
();

3688 
	`checkTıBacklogS‘tšgs
();

3690 ià(!
£rv”
.
£Áš–_mode
) {

3692 
	`£rv”Log
(
LL_WARNING
,"S”v” s¹ed, Redi v”siÚ " 
REDIS_VERSION
);

3693 #ifdeà
__lšux__


3694 
	`lšuxMemÜyW¬nšgs
();

3696 
	`moduËLßdFromQueue
();

3697 
	`lßdD©aFromDisk
();

3698 ià(
£rv”
.
şu¡”_’abËd
) {

3699 ià(
	`v”ifyClu¡”CÚfigW™hD©a
(è=ğ
C_ERR
) {

3700 
	`£rv”Log
(
LL_WARNING
,

3703 
	`ex™
(1);

3706 ià(
£rv”
.
fd_couÁ
 > 0)

3707 
	`£rv”Log
(
LL_NOTICE
,"Th£rv” i now„—dyØacû± cÚÃùiÚ Ú…Üˆ%d", 
£rv”
.
pÜt
);

3708 ià(
£rv”
.
sofd
 > 0)

3709 
	`£rv”Log
(
LL_NOTICE
,"Th£rv” i now„—dyØacû± cÚÃùiÚ © %s", 
£rv”
.
unixsock‘
);

3711 
	`£Áš–IsRuÂšg
();

3715 ià(
£rv”
.
maxmemÜy
 > 0 && server.maxmemory < 1024*1024) {

3716 
	`£rv”Log
(
LL_WARNING
,"WARNING: You s³cif›d‡ maxmemÜy v®uth© i Ës thª 1MB (cu¼’ˆv®ui %Îu by‹s). A» you su»hi i wh© you„—Îy wªt?", 
£rv”
.
maxmemÜy
);

3719 
	`«S‘BefÜeSË•Proc
(
£rv”
.
–
,
befÜeSË•
);

3720 
	`«Maš
(
£rv”
.
–
);

3721 
	`«D–‘eEv’tLoİ
(
£rv”
.
–
);

3723 
	}
}

	@server.h

30 #iâdeà
__REDIS_H


31 
	#__REDIS_H


	)

33 
	~"fmaüos.h
"

34 
	~"cÚfig.h
"

35 
	~"sŞ¬isfixes.h
"

36 
	~"rio.h
"

38 
	~<¡dio.h
>

39 
	~<¡dlib.h
>

40 
	~<¡ršg.h
>

41 
	~<time.h
>

42 
	~<lim™s.h
>

43 
	~<uni¡d.h
>

44 
	~<”ºo.h
>

45 
	~<š‰y³s.h
>

46 
	~<±h»ad.h
>

47 
	~<sy¦og.h
>

48 
	~<Ãtš‘/š.h
>

49 
	~<lua.h
>

50 
	~<sigÇl.h
>

52 
	tm¡ime_t
;

54 
	~"«.h
"

55 
	~"sds.h
"

56 
	~"diù.h
"

57 
	~"adli¡.h
"

58 
	~"zm®loc.h
"

59 
	~"ª‘.h
"

60 
	~"zli¡.h
"

61 
	~"št£t.h
"

62 
	~"v”siÚ.h
"

63 
	~"ut.h
"

64 
	~"Ï‹ncy.h
"

65 
	~"¥¬klše.h
"

66 
	~"quickli¡.h
"

69 
	~"zm­.h
"

70 
	~"sha1.h
"

71 
	~"’dŸncÚv.h
"

72 
	~"üc64.h
"

75 
	#C_OK
 0

	)

76 
	#C_ERR
 -1

	)

79 
	#CONFIG_DEFAULT_HZ
 10

	)

80 
	#CONFIG_MIN_HZ
 1

	)

81 
	#CONFIG_MAX_HZ
 500

	)

82 
	#CONFIG_DEFAULT_SERVER_PORT
 6379

	)

83 
	#CONFIG_DEFAULT_TCP_BACKLOG
 511

	)

84 
	#CONFIG_DEFAULT_CLIENT_TIMEOUT
 0

	)

85 
	#CONFIG_DEFAULT_DBNUM
 16

	)

86 
	#CONFIG_MAX_LINE
 1024

	)

87 
	#CRON_DBS_PER_CALL
 16

	)

88 
	#NET_MAX_WRITES_PER_EVENT
 (1024*64)

	)

89 
	#PROTO_SHARED_SELECT_CMDS
 10

	)

90 
	#OBJ_SHARED_INTEGERS
 10000

	)

91 
	#OBJ_SHARED_BULKHDR_LEN
 32

	)

92 
	#LOG_MAX_LEN
 1024

	)

93 
	#AOF_REWRITE_PERC
 100

	)

94 
	#AOF_REWRITE_MIN_SIZE
 (64*1024*1024)

	)

95 
	#AOF_REWRITE_ITEMS_PER_CMD
 64

	)

96 
	#AOF_READ_DIFF_INTERVAL_BYTES
 (1024*10)

	)

97 
	#CONFIG_DEFAULT_SLOWLOG_LOG_SLOWER_THAN
 10000

	)

98 
	#CONFIG_DEFAULT_SLOWLOG_MAX_LEN
 128

	)

99 
	#CONFIG_DEFAULT_MAX_CLIENTS
 10000

	)

100 
	#CONFIG_AUTHPASS_MAX_LEN
 512

	)

101 
	#CONFIG_DEFAULT_SLAVE_PRIORITY
 100

	)

102 
	#CONFIG_DEFAULT_REPL_TIMEOUT
 60

	)

103 
	#CONFIG_DEFAULT_REPL_PING_SLAVE_PERIOD
 10

	)

104 
	#CONFIG_RUN_ID_SIZE
 40

	)

105 
	#RDB_EOF_MARK_SIZE
 40

	)

106 
	#CONFIG_DEFAULT_REPL_BACKLOG_SIZE
 (1024*1024è

	)

107 
	#CONFIG_DEFAULT_REPL_BACKLOG_TIME_LIMIT
 (60*60è

	)

108 
	#CONFIG_REPL_BACKLOG_MIN_SIZE
 (1024*16è

	)

109 
	#CONFIG_BGSAVE_RETRY_DELAY
 5

	)

110 
	#CONFIG_DEFAULT_PID_FILE
 "/v¬/run/»dis.pid"

	)

111 
	#CONFIG_DEFAULT_SYSLOG_IDENT
 "»dis"

	)

112 
	#CONFIG_DEFAULT_CLUSTER_CONFIG_FILE
 "nodes.cÚf"

	)

113 
	#CONFIG_DEFAULT_CLUSTER_ANNOUNCE_IP
 
NULL


	)

114 
	#CONFIG_DEFAULT_CLUSTER_ANNOUNCE_PORT
 0

	)

115 
	#CONFIG_DEFAULT_CLUSTER_ANNOUNCE_BUS_PORT
 0

	)

116 
	#CONFIG_DEFAULT_DAEMONIZE
 0

	)

117 
	#CONFIG_DEFAULT_UNIX_SOCKET_PERM
 0

	)

118 
	#CONFIG_DEFAULT_TCP_KEEPALIVE
 300

	)

119 
	#CONFIG_DEFAULT_PROTECTED_MODE
 1

	)

120 
	#CONFIG_DEFAULT_LOGFILE
 ""

	)

121 
	#CONFIG_DEFAULT_SYSLOG_ENABLED
 0

	)

122 
	#CONFIG_DEFAULT_STOP_WRITES_ON_BGSAVE_ERROR
 1

	)

123 
	#CONFIG_DEFAULT_RDB_COMPRESSION
 1

	)

124 
	#CONFIG_DEFAULT_RDB_CHECKSUM
 1

	)

125 
	#CONFIG_DEFAULT_RDB_FILENAME
 "dump.rdb"

	)

126 
	#CONFIG_DEFAULT_REPL_DISKLESS_SYNC
 0

	)

127 
	#CONFIG_DEFAULT_REPL_DISKLESS_SYNC_DELAY
 5

	)

128 
	#CONFIG_DEFAULT_SLAVE_SERVE_STALE_DATA
 1

	)

129 
	#CONFIG_DEFAULT_SLAVE_READ_ONLY
 1

	)

130 
	#CONFIG_DEFAULT_SLAVE_ANNOUNCE_IP
 
NULL


	)

131 
	#CONFIG_DEFAULT_SLAVE_ANNOUNCE_PORT
 0

	)

132 
	#CONFIG_DEFAULT_REPL_DISABLE_TCP_NODELAY
 0

	)

133 
	#CONFIG_DEFAULT_MAXMEMORY
 0

	)

134 
	#CONFIG_DEFAULT_MAXMEMORY_SAMPLES
 5

	)

135 
	#CONFIG_DEFAULT_LFU_LOG_FACTOR
 10

	)

136 
	#CONFIG_DEFAULT_LFU_DECAY_TIME
 1

	)

137 
	#CONFIG_DEFAULT_AOF_FILENAME
 "­³ndÚly.aof"

	)

138 
	#CONFIG_DEFAULT_AOF_NO_FSYNC_ON_REWRITE
 0

	)

139 
	#CONFIG_DEFAULT_AOF_LOAD_TRUNCATED
 1

	)

140 
	#CONFIG_DEFAULT_AOF_USE_RDB_PREAMBLE
 0

	)

141 
	#CONFIG_DEFAULT_ACTIVE_REHASHING
 1

	)

142 
	#CONFIG_DEFAULT_AOF_REWRITE_INCREMENTAL_FSYNC
 1

	)

143 
	#CONFIG_DEFAULT_MIN_SLAVES_TO_WRITE
 0

	)

144 
	#CONFIG_DEFAULT_MIN_SLAVES_MAX_LAG
 10

	)

145 
	#NET_IP_STR_LEN
 46

	)

146 
	#NET_PEER_ID_LEN
 (
NET_IP_STR_LEN
+32è

	)

147 
	#CONFIG_BINDADDR_MAX
 16

	)

148 
	#CONFIG_MIN_RESERVED_FDS
 32

	)

149 
	#CONFIG_DEFAULT_LATENCY_MONITOR_THRESHOLD
 0

	)

150 
	#CONFIG_DEFAULT_SLAVE_LAZY_FLUSH
 0

	)

151 
	#CONFIG_DEFAULT_LAZYFREE_LAZY_EVICTION
 0

	)

152 
	#CONFIG_DEFAULT_LAZYFREE_LAZY_EXPIRE
 0

	)

153 
	#CONFIG_DEFAULT_LAZYFREE_LAZY_SERVER_DEL
 0

	)

155 
	#ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP
 20

	)

156 
	#ACTIVE_EXPIRE_CYCLE_FAST_DURATION
 1000

	)

157 
	#ACTIVE_EXPIRE_CYCLE_SLOW_TIME_PERC
 25

	)

158 
	#ACTIVE_EXPIRE_CYCLE_SLOW
 0

	)

159 
	#ACTIVE_EXPIRE_CYCLE_FAST
 1

	)

162 
	#STATS_METRIC_SAMPLES
 16

	)

163 
	#STATS_METRIC_COMMAND
 0

	)

164 
	#STATS_METRIC_NET_INPUT
 1

	)

165 
	#STATS_METRIC_NET_OUTPUT
 2

	)

166 
	#STATS_METRIC_COUNT
 3

	)

169 
	#PROTO_MAX_QUERYBUF_LEN
 (1024*1024*1024è

	)

170 
	#PROTO_IOBUF_LEN
 (1024*16è

	)

171 
	#PROTO_REPLY_CHUNK_BYTES
 (16*1024è

	)

172 
	#PROTO_INLINE_MAX_SIZE
 (1024*64è

	)

173 
	#PROTO_MBULK_BIG_ARG
 (1024*32)

	)

174 
	#LONG_STR_SIZE
 21

	)

175 
	#AOF_AUTOSYNC_BYTES
 (1024*1024*32è

	)

181 
	#CONFIG_FDSET_INCR
 (
CONFIG_MIN_RESERVED_FDS
+96)

	)

184 
	#HASHTABLE_MIN_FILL
 10

	)

188 
	#CMD_WRITE
 (1<<0è

	)

189 
	#CMD_READONLY
 (1<<1è

	)

190 
	#CMD_DENYOOM
 (1<<2è

	)

191 
	#CMD_MODULE
 (1<<3è

	)

192 
	#CMD_ADMIN
 (1<<4è

	)

193 
	#CMD_PUBSUB
 (1<<5è

	)

194 
	#CMD_NOSCRIPT
 (1<<6è

	)

195 
	#CMD_RANDOM
 (1<<7è

	)

196 
	#CMD_SORT_FOR_SCRIPT
 (1<<8è

	)

197 
	#CMD_LOADING
 (1<<9è

	)

198 
	#CMD_STALE
 (1<<10è

	)

199 
	#CMD_SKIP_MONITOR
 (1<<11è

	)

200 
	#CMD_ASKING
 (1<<12è

	)

201 
	#CMD_FAST
 (1<<13è

	)

202 
	#CMD_MODULE_GETKEYS
 (1<<14è

	)

203 
	#CMD_MODULE_NO_CLUSTER
 (1<<15è

	)

206 
	#AOF_OFF
 0

	)

207 
	#AOF_ON
 1

	)

208 
	#AOF_WAIT_REWRITE
 2

	)

211 
	#CLIENT_SLAVE
 (1<<0è

	)

212 
	#CLIENT_MASTER
 (1<<1è

	)

213 
	#CLIENT_MONITOR
 (1<<2è

	)

214 
	#CLIENT_MULTI
 (1<<3è

	)

215 
	#CLIENT_BLOCKED
 (1<<4è

	)

216 
	#CLIENT_DIRTY_CAS
 (1<<5è

	)

217 
	#CLIENT_CLOSE_AFTER_REPLY
 (1<<6è

	)

218 
	#CLIENT_UNBLOCKED
 (1<<7è

	)

220 
	#CLIENT_LUA
 (1<<8è

	)

221 
	#CLIENT_ASKING
 (1<<9è

	)

222 
	#CLIENT_CLOSE_ASAP
 (1<<10)

	)

223 
	#CLIENT_UNIX_SOCKET
 (1<<11è

	)

224 
	#CLIENT_DIRTY_EXEC
 (1<<12è

	)

225 
	#CLIENT_MASTER_FORCE_REPLY
 (1<<13è

	)

226 
	#CLIENT_FORCE_AOF
 (1<<14è

	)

227 
	#CLIENT_FORCE_REPL
 (1<<15è

	)

228 
	#CLIENT_PRE_PSYNC
 (1<<16è

	)

229 
	#CLIENT_READONLY
 (1<<17è

	)

230 
	#CLIENT_PUBSUB
 (1<<18è

	)

231 
	#CLIENT_PREVENT_AOF_PROP
 (1<<19è

	)

232 
	#CLIENT_PREVENT_REPL_PROP
 (1<<20è

	)

233 
	#CLIENT_PREVENT_PROP
 (
CLIENT_PREVENT_AOF_PROP
|
CLIENT_PREVENT_REPL_PROP
)

	)

234 
	#CLIENT_PENDING_WRITE
 (1<<21è

	)

236 
	#CLIENT_REPLY_OFF
 (1<<22è

	)

237 
	#CLIENT_REPLY_SKIP_NEXT
 (1<<23è

	)

238 
	#CLIENT_REPLY_SKIP
 (1<<24è

	)

239 
	#CLIENT_LUA_DEBUG
 (1<<25è

	)

240 
	#CLIENT_LUA_DEBUG_SYNC
 (1<<26è

	)

241 
	#CLIENT_MODULE
 (1<<27è

	)

245 
	#BLOCKED_NONE
 0

	)

246 
	#BLOCKED_LIST
 1

	)

247 
	#BLOCKED_WAIT
 2

	)

250 
	#PROTO_REQ_INLINE
 1

	)

251 
	#PROTO_REQ_MULTIBULK
 2

	)

255 
	#CLIENT_TYPE_NORMAL
 0

	)

256 
	#CLIENT_TYPE_SLAVE
 1

	)

257 
	#CLIENT_TYPE_PUBSUB
 2

	)

258 
	#CLIENT_TYPE_MASTER
 3

	)

259 
	#CLIENT_TYPE_OBUF_COUNT
 3

	)

265 
	#REPL_STATE_NONE
 0

	)

266 
	#REPL_STATE_CONNECT
 1

	)

267 
	#REPL_STATE_CONNECTING
 2

	)

269 
	#REPL_STATE_RECEIVE_PONG
 3

	)

270 
	#REPL_STATE_SEND_AUTH
 4

	)

271 
	#REPL_STATE_RECEIVE_AUTH
 5

	)

272 
	#REPL_STATE_SEND_PORT
 6

	)

273 
	#REPL_STATE_RECEIVE_PORT
 7

	)

274 
	#REPL_STATE_SEND_IP
 8

	)

275 
	#REPL_STATE_RECEIVE_IP
 9

	)

276 
	#REPL_STATE_SEND_CAPA
 10

	)

277 
	#REPL_STATE_RECEIVE_CAPA
 11

	)

278 
	#REPL_STATE_SEND_PSYNC
 12

	)

279 
	#REPL_STATE_RECEIVE_PSYNC
 13

	)

281 
	#REPL_STATE_TRANSFER
 14

	)

282 
	#REPL_STATE_CONNECTED
 15

	)

288 
	#SLAVE_STATE_WAIT_BGSAVE_START
 6

	)

289 
	#SLAVE_STATE_WAIT_BGSAVE_END
 7

	)

290 
	#SLAVE_STATE_SEND_BULK
 8

	)

291 
	#SLAVE_STATE_ONLINE
 9

	)

294 
	#SLAVE_CAPA_NONE
 0

	)

295 
	#SLAVE_CAPA_EOF
 (1<<0è

	)

298 
	#CONFIG_REPL_SYNCIO_TIMEOUT
 5

	)

301 
	#LIST_HEAD
 0

	)

302 
	#LIST_TAIL
 1

	)

305 
	#SORT_OP_GET
 0

	)

308 
	#LL_DEBUG
 0

	)

309 
	#LL_VERBOSE
 1

	)

310 
	#LL_NOTICE
 2

	)

311 
	#LL_WARNING
 3

	)

312 
	#LL_RAW
 (1<<10è

	)

313 
	#CONFIG_DEFAULT_VERBOSITY
 
LL_NOTICE


	)

316 
	#SUPERVISED_NONE
 0

	)

317 
	#SUPERVISED_AUTODETECT
 1

	)

318 
	#SUPERVISED_SYSTEMD
 2

	)

319 
	#SUPERVISED_UPSTART
 3

	)

322 
	#UNUSED
(
V
è((èV)

	)

324 
	#ZSKIPLIST_MAXLEVEL
 32

	)

325 
	#ZSKIPLIST_P
 0.25

	)

328 
	#AOF_FSYNC_NO
 0

	)

329 
	#AOF_FSYNC_ALWAYS
 1

	)

330 
	#AOF_FSYNC_EVERYSEC
 2

	)

331 
	#CONFIG_DEFAULT_AOF_FSYNC
 
AOF_FSYNC_EVERYSEC


	)

334 
	#OBJ_HASH_MAX_ZIPLIST_ENTRIES
 512

	)

335 
	#OBJ_HASH_MAX_ZIPLIST_VALUE
 64

	)

336 
	#OBJ_SET_MAX_INTSET_ENTRIES
 512

	)

337 
	#OBJ_ZSET_MAX_ZIPLIST_ENTRIES
 128

	)

338 
	#OBJ_ZSET_MAX_ZIPLIST_VALUE
 64

	)

341 
	#OBJ_LIST_MAX_ZIPLIST_SIZE
 -2

	)

342 
	#OBJ_LIST_COMPRESS_DEPTH
 0

	)

345 
	#CONFIG_DEFAULT_HLL_SPARSE_MAX_BYTES
 3000

	)

348 
	#SET_OP_UNION
 0

	)

349 
	#SET_OP_DIFF
 1

	)

350 
	#SET_OP_INTER
 2

	)

355 
	#MAXMEMORY_FLAG_LRU
 (1<<0)

	)

356 
	#MAXMEMORY_FLAG_LFU
 (1<<1)

	)

357 
	#MAXMEMORY_FLAG_ALLKEYS
 (1<<2)

	)

358 
	#MAXMEMORY_FLAG_NO_SHARED_INTEGERS
 \

359 (
MAXMEMORY_FLAG_LRU
|
MAXMEMORY_FLAG_LFU
)

	)

361 
	#MAXMEMORY_VOLATILE_LRU
 ((0<<8)|
MAXMEMORY_FLAG_LRU
)

	)

362 
	#MAXMEMORY_VOLATILE_LFU
 ((1<<8)|
MAXMEMORY_FLAG_LFU
)

	)

363 
	#MAXMEMORY_VOLATILE_TTL
 (2<<8)

	)

364 
	#MAXMEMORY_VOLATILE_RANDOM
 (3<<8)

	)

365 
	#MAXMEMORY_ALLKEYS_LRU
 ((4<<8)|
MAXMEMORY_FLAG_LRU
|
MAXMEMORY_FLAG_ALLKEYS
)

	)

366 
	#MAXMEMORY_ALLKEYS_LFU
 ((5<<8)|
MAXMEMORY_FLAG_LFU
|
MAXMEMORY_FLAG_ALLKEYS
)

	)

367 
	#MAXMEMORY_ALLKEYS_RANDOM
 ((6<<8)|
MAXMEMORY_FLAG_ALLKEYS
)

	)

368 
	#MAXMEMORY_NO_EVICTION
 (7<<8)

	)

370 
	#CONFIG_DEFAULT_MAXMEMORY_POLICY
 
MAXMEMORY_NO_EVICTION


	)

373 
	#LUA_SCRIPT_TIME_LIMIT
 5000

	)

376 
	#UNIT_SECONDS
 0

	)

377 
	#UNIT_MILLISECONDS
 1

	)

380 
	#SHUTDOWN_NOFLAGS
 0

	)

381 
	#SHUTDOWN_SAVE
 1

	)

383 
	#SHUTDOWN_NOSAVE
 2

	)

386 
	#CMD_CALL_NONE
 0

	)

387 
	#CMD_CALL_SLOWLOG
 (1<<0)

	)

388 
	#CMD_CALL_STATS
 (1<<1)

	)

389 
	#CMD_CALL_PROPAGATE_AOF
 (1<<2)

	)

390 
	#CMD_CALL_PROPAGATE_REPL
 (1<<3)

	)

391 
	#CMD_CALL_PROPAGATE
 (
CMD_CALL_PROPAGATE_AOF
|
CMD_CALL_PROPAGATE_REPL
)

	)

392 
	#CMD_CALL_FULL
 (
CMD_CALL_SLOWLOG
 | 
CMD_CALL_STATS
 | 
CMD_CALL_PROPAGATE
)

	)

395 
	#PROPAGATE_NONE
 0

	)

396 
	#PROPAGATE_AOF
 1

	)

397 
	#PROPAGATE_REPL
 2

	)

400 
	#RDB_CHILD_TYPE_NONE
 0

	)

401 
	#RDB_CHILD_TYPE_DISK
 1

	)

402 
	#RDB_CHILD_TYPE_SOCKET
 2

	)

406 
	#NOTIFY_KEYSPACE
 (1<<0è

	)

407 
	#NOTIFY_KEYEVENT
 (1<<1è

	)

408 
	#NOTIFY_GENERIC
 (1<<2è

	)

409 
	#NOTIFY_STRING
 (1<<3è

	)

410 
	#NOTIFY_LIST
 (1<<4è

	)

411 
	#NOTIFY_SET
 (1<<5è

	)

412 
	#NOTIFY_HASH
 (1<<6è

	)

413 
	#NOTIFY_ZSET
 (1<<7è

	)

414 
	#NOTIFY_EXPIRED
 (1<<8è

	)

415 
	#NOTIFY_EVICTED
 (1<<9è

	)

416 
	#NOTIFY_ALL
 (
NOTIFY_GENERIC
 | 
NOTIFY_STRING
 | 
NOTIFY_LIST
 | 
NOTIFY_SET
 | 
NOTIFY_HASH
 | 
NOTIFY_ZSET
 | 
NOTIFY_EXPIRED
 | 
NOTIFY_EVICTED
è

	)

419 
	#NET_FIRST_BIND_ADDR
 (
£rv”
.
bšdaddr_couÁ
 ? s”v”.
bšdaddr
[0] : 
NULL
)

	)

424 
	#run_w™h_³riod
(
_ms_
èià((_ms_ <ğ1000/
£rv”
.
hz
è|| !(£rv”.
üÚloİs
%((_ms_)/(1000/£rv”.hz))))

	)

427 
	#£rv”As£¹W™hInfo
(
_c
,
_o
,
_e
è((_e)?()0 : (
	`_£rv”As£¹W™hInfo
(_c,_o,#_e,
__FILE__
,
__LINE__
),
	`_ex™
(1)))

	)

428 
	#£rv”As£¹
(
_e
è((_e)?()0 : (
	`_£rv”As£¹
(#_e,
__FILE__
,
__LINE__
),
	`_ex™
(1)))

	)

429 
	#£rv”Pªic
(
_e
è
	`_£rv”Pªic
(#_e,
__FILE__
,
__LINE__
),
	`_ex™
(1)

	)

438 
	#OBJ_STRING
 0

	)

439 
	#OBJ_LIST
 1

	)

440 
	#OBJ_SET
 2

	)

441 
	#OBJ_ZSET
 3

	)

442 
	#OBJ_HASH
 4

	)

455 
	#OBJ_MODULE
 5

	)

458 
	#REDISMODULE_TYPE_ENCVER_BITS
 10

	)

459 
	#REDISMODULE_TYPE_ENCVER_MASK
 ((1<<
REDISMODULE_TYPE_ENCVER_BITS
)-1)

	)

460 
	#REDISMODULE_TYPE_ENCVER
(
id
è(id & 
REDISMODULE_TYPE_ENCVER_MASK
)

	)

461 
	#REDISMODULE_TYPE_SIGN
(
id
è((id & ~((
ušt64_t
)
REDISMODULE_TYPE_ENCVER_MASK
)è>>
REDISMODULE_TYPE_ENCVER_BITS
)

	)

463 
	gRedisModuË
;

464 
	gRedisModuËIO
;

465 
	gRedisModuËDige¡
;

466 
	gRedisModuËCtx
;

467 
	g»disObjeù
;

473 *(*
	tmoduËTy³LßdFunc
)(
	tRedisModuËIO
 *
	tio
, 
	t’cv”
);

474 (*
	tmoduËTy³SaveFunc
)(
	tRedisModuËIO
 *
	tio
, *
	tv®ue
);

475 (*
	tmoduËTy³Rewr™eFunc
)(
	tRedisModuËIO
 *
	tio
, 
	t»disObjeù
 *
	tkey
, *
	tv®ue
);

476 (*
	tmoduËTy³Dige¡Func
)(
	tRedisModuËDige¡
 *
	tdige¡
, *
	tv®ue
);

477 (*
	tmoduËTy³F»eFunc
)(*
	tv®ue
);

481 
	sRedisModuËTy³
 {

482 
ušt64_t
 
id
;

483 
RedisModuË
 *
moduË
;

484 
moduËTy³LßdFunc
 
rdb_lßd
;

485 
moduËTy³SaveFunc
 
rdb_§ve
;

486 
moduËTy³Rewr™eFunc
 
aof_»wr™e
;

487 
moduËTy³Dige¡Func
 
dige¡
;

488 
moduËTy³F»eFunc
 
ä“
;

489 
Çme
[10];

490 } 
	tmoduËTy³
;

507 
	smoduËV®ue
 {

508 
moduËTy³
 *
ty³
;

509 *
v®ue
;

510 } 
	tmoduËV®ue
;

515 
	sRedisModuËIO
 {

516 
size_t
 
by‹s
;

517 
rio
 *rio;

518 
moduËTy³
 *
ty³
;

519 
”rÜ
;

520 
RedisModuËCtx
 *
ùx
;

521 } 
	tRedisModuËIO
;

523 
	#moduËIn™IOCÚ‹xt
(
iov¬
,
mty³
,
riİŒ
) do { \

524 
iov¬
.
rio
 = 
riİŒ
; \

525 
iov¬
.
ty³
 = 
mty³
; \

526 
iov¬
.
by‹s
 = 0; \

527 
iov¬
.
”rÜ
 = 0; \

528 
iov¬
.
ùx
 = 
NULL
; \

529 
	}
} 0);

	)

534 
	#OBJ_ENCODING_RAW
 0

	)

535 
	#OBJ_ENCODING_INT
 1

	)

536 
	#OBJ_ENCODING_HT
 2

	)

537 
	#OBJ_ENCODING_ZIPMAP
 3

	)

538 
	#OBJ_ENCODING_LINKEDLIST
 4

	)

539 
	#OBJ_ENCODING_ZIPLIST
 5

	)

540 
	#OBJ_ENCODING_INTSET
 6

	)

541 
	#OBJ_ENCODING_SKIPLIST
 7

	)

542 
	#OBJ_ENCODING_EMBSTR
 8

	)

543 
	#OBJ_ENCODING_QUICKLIST
 9

	)

544 
	#OBJ_ENCODING_SPM
 10

	)

546 
	#LRU_BITS
 24

	)

547 
	#LRU_CLOCK_MAX
 ((1<<
LRU_BITS
)-1è

	)

548 
	#LRU_CLOCK_RESOLUTION
 1000

	)

550 
	#OBJ_SHARED_REFCOUNT
 
INT_MAX


	)

551 
	s»disObjeù
 {

552 
	mty³
:4;

553 
	m’codšg
:4;

554 
	mÌu
:
LRU_BITS
;

557 
	m»fcouÁ
;

558 *
	m±r
;

559 } 
	trobj
;

565 
	#LRU_CLOCK
(è((1000/
£rv”
.
hz
 <ğ
LRU_CLOCK_RESOLUTION
è? s”v”.
Ìuşock
 : 
	`g‘LRUClock
())

	)

571 
	#š™SticSŒšgObjeù
(
_v¬
,
_±r
) do { \

572 
_v¬
.
»fcouÁ
 = 1; \

573 
_v¬
.
ty³
 = 
OBJ_STRING
; \

574 
_v¬
.
’codšg
 = 
OBJ_ENCODING_RAW
; \

575 
_v¬
.
±r
 = 
_±r
; \

576 } 0)

	)

578 
	geviùiÚPoŞEÁry
;

583 
	s»disDb
 {

584 
diù
 *
	mdiù
;

585 
diù
 *
	mexpœes
;

586 
diù
 *
	mblockšg_keys
;

587 
diù
 *
	m»ady_keys
;

588 
diù
 *
	mw©ched_keys
;

589 
	mid
;

590 
	mavg_‰l
;

591 } 
	t»disDb
;

594 
	smuÉiCmd
 {

595 
robj
 **
	m¬gv
;

596 
	m¬gc
;

597 
»disCommªd
 *
	mcmd
;

598 } 
	tmuÉiCmd
;

600 
	smuÉiS‹
 {

601 
muÉiCmd
 *
	mcommªds
;

602 
	mcouÁ
;

603 
	mmš»¶iÿs
;

604 
time_t
 
	mmš»¶iÿs_timeout
;

605 } 
	tmuÉiS‹
;

609 
	sblockšgS‹
 {

611 
m¡ime_t
 
	mtimeout
;

615 
diù
 *
	mkeys
;

617 
robj
 *
	mrg‘
;

621 
	mnum»¶iÿs
;

622 
	m»¶off£t
;

623 } 
	tblockšgS‹
;

636 
	s»adyLi¡
 {

637 
»disDb
 *
	mdb
;

638 
robj
 *
	mkey
;

639 } 
	t»adyLi¡
;

643 
	sş›Á
 {

644 
ušt64_t
 
	mid
;

645 
	mfd
;

646 
»disDb
 *
	mdb
;

647 
robj
 *
	mÇme
;

648 
sds
 
	mqu”ybuf
;

649 
size_t
 
	mqu”ybuf_³ak
;

650 
	m¬gc
;

651 
robj
 **
	m¬gv
;

652 
»disCommªd
 *
	mcmd
, *
	mÏ¡cmd
;

653 
	m»qty³
;

654 
	mmuÉibulkËn
;

655 
	mbulkËn
;

656 
li¡
 *
	m»¶y
;

657 
	m»¶y_by‹s
;

658 
size_t
 
	m£ÁËn
;

660 
time_t
 
	mùime
;

661 
time_t
 
	mÏ¡š‹¿ùiÚ
;

662 
time_t
 
	mobuf_soá_lim™_»ached_time
;

663 
	mæags
;

664 
	mauth’tiÿ‹d
;

665 
	m»¶¡©e
;

666 
	m»¶_put_Úlše_Ú_ack
;

667 
	m»¶dbfd
;

668 
off_t
 
	m»¶dboff
;

669 
off_t
 
	m»¶dbsize
;

670 
sds
 
	m»¶´—mbË
;

671 
	m»¶off
;

672 
	m»¶_ack_off
;

673 
	m»¶_ack_time
;

674 
	mpsync_š™Ÿl_off£t
;

677 
	m»¶runid
[
CONFIG_RUN_ID_SIZE
+1];

678 
	m¦ave_li¡’šg_pÜt
;

679 
	m¦ave_
[
NET_IP_STR_LEN
];

680 
	m¦ave_ÿ·
;

681 
muÉiS‹
 
	mm¡©e
;

682 
	mbty³
;

683 
blockšgS‹
 
	mbpİ
;

684 
	mwoff
;

685 
li¡
 *
	mw©ched_keys
;

686 
diù
 *
	mpubsub_chªÃls
;

687 
li¡
 *
	mpubsub_·‰”ns
;

688 
sds
 
	m³”id
;

691 
	mbuåos
;

692 
	mbuf
[
PROTO_REPLY_CHUNK_BYTES
];

693 } 
	tş›Á
;

695 
	s§v•¬am
 {

696 
time_t
 
	m£cÚds
;

697 
	mchªges
;

700 
	smoduËLßdQueueEÁry
 {

701 
sds
 
	m·th
;

702 
	m¬gc
;

703 
robj
 **
	m¬gv
;

706 
	ssh¬edObjeùsSŒuù
 {

707 
robj
 *
	mülf
, *
	mok
, *
	m”r
, *
	mem±ybulk
, *
	mcz”o
, *
	mcÚe
, *
	múegÚe
, *
	mpÚg
, *
	m¥aû
,

708 *
	mcŞÚ
, *
	mnuÎbulk
, *
	mnuÎmuÉibulk
, *
	mqueued
,

709 *
	mem±ymuÉibulk
, *
	mwrÚgty³”r
, *
	mnokey”r
, *
	msyÁax”r
, *
	m§meobjeù”r
,

710 *
	moutoäªg“¼
, *
	mnosü‹¼
, *
	mlßdšg”r
, *
	m¦owsü‹¼
, *
	mbg§v“¼
,

711 *
	mma¡”dowÃ¼
, *
	mro¦av“¼
, *
	mexeÿbÜ‹¼
, *
	mnßuth”r
, *
	mnÜ•liÿ£¼
,

712 *
	mbusykey”r
, *
	moom”r
, *
	m¶us
, *
	mmes§gebulk
, *
	mpmes§gebulk
, *
	msubsüibebulk
,

713 *
	munsubsüibebulk
, *
	mpsubsüibebulk
, *
	mpunsubsüibebulk
, *
	md–
, *
	muÆšk
,

714 *
	m½İ
, *
	mÍİ
, *
	mÍush
, *
	mem±ysÿn
,

715 *
	m£Ëù
[
PROTO_SHARED_SELECT_CMDS
],

716 *
	mš‹g”s
[
OBJ_SHARED_INTEGERS
],

717 *
	mmbulkhdr
[
OBJ_SHARED_BULKHDR_LEN
],

718 *
	mbulkhdr
[
OBJ_SHARED_BULKHDR_LEN
];

719 
sds
 
	mmš¡ršg
, 
	mmax¡ršg
;

723 
	szskli¡Node
 {

724 
sds
 
	m–e
;

725 
	mscÜe
;

726 
zskli¡Node
 *
	mbackw¬d
;

727 
	szskli¡Lev–
 {

728 
zskli¡Node
 *
	mfÜw¬d
;

729 
	m¥ª
;

730 } 
	mËv–
[];

731 } 
	tzskli¡Node
;

733 
	szskli¡
 {

734 
zskli¡Node
 *
	mh—d”
, *
	m
;

735 
	mËngth
;

736 
	mËv–
;

737 } 
	tzskli¡
;

739 
	sz£t
 {

740 
diù
 *
	mdiù
;

741 
zskli¡
 *
	mz¦
;

742 } 
	tz£t
;

744 
	sş›ÁBufãrLim™sCÚfig
 {

745 
	mh¬d_lim™_by‹s
;

746 
	msoá_lim™_by‹s
;

747 
time_t
 
	msoá_lim™_£cÚds
;

748 } 
	tş›ÁBufãrLim™sCÚfig
;

750 
ş›ÁBufãrLim™sCÚfig
 
ş›ÁBufãrLim™sDeçuÉs
[
CLIENT_TYPE_OBUF_COUNT
];

758 
	s»disOp
 {

759 
robj
 **
	m¬gv
;

760 
	m¬gc
, 
	mdbid
, 
	mrg‘
;

761 
»disCommªd
 *
	mcmd
;

762 } 
	t»disOp
;

771 
	s»disOpA¼ay
 {

772 
»disOp
 *
	mİs
;

773 
	mnumİs
;

774 } 
	t»disOpA¼ay
;

778 
	s»disMemOv”h—d
 {

779 
size_t
 
	m³ak_®loÿ‹d
;

780 
size_t
 
	mtÙ®_®loÿ‹d
;

781 
size_t
 
	m¡¬tup_®loÿ‹d
;

782 
size_t
 
	m»¶_backlog
;

783 
size_t
 
	mş›Ás_¦aves
;

784 
size_t
 
	mş›Ás_nÜm®
;

785 
size_t
 
	maof_bufãr
;

786 
size_t
 
	mov”h—d_tÙ®
;

787 
size_t
 
	md©a£t
;

788 
size_t
 
	mtÙ®_keys
;

789 
size_t
 
	mby‹s_³r_key
;

790 
	md©a£t_³rc
;

791 
	m³ak_³rc
;

792 
	mäagm’tiÚ
;

793 
size_t
 
	mnum_dbs
;

795 
size_t
 
	mdbid
;

796 
size_t
 
	mov”h—d_ht_maš
;

797 
size_t
 
	mov”h—d_ht_expœes
;

798 } *
	mdb
;

805 
	gşu¡”S‹
;

809 #ifdeà
_AIX


810 #undeà
hz


813 
	#CHILD_INFO_MAGIC
 0xC17DDA7A12345678LL

	)

814 
	#CHILD_INFO_TYPE_RDB
 0

	)

815 
	#CHILD_INFO_TYPE_AOF
 1

	)

817 
	s»disS”v”
 {

819 
pid_t
 
	mpid
;

820 *
	mcÚfigfe
;

821 *
	mexecubË
;

822 **
	mexec_¬gv
;

823 
	mhz
;

824 
»disDb
 *
	mdb
;

825 
diù
 *
	mcommªds
;

826 
diù
 *
	mÜig_commªds
;

827 
«Ev’tLoİ
 *
	m–
;

828 
	mÌuşock
:
LRU_BITS
;

829 
	mshutdown_a§p
;

830 
	maùiv”ehashšg
;

831 *
	m»quœ•ass
;

832 *
	mpidfe
;

833 
	m¬ch_b™s
;

834 
	müÚloİs
;

835 
	mrunid
[
CONFIG_RUN_ID_SIZE
+1];

836 
	m£Áš–_mode
;

837 
size_t
 
	mš™Ÿl_memÜy_u§ge
;

839 
diù
 *
	mmoduË­i
;

840 
li¡
 *
	mlßdmoduË_queue
;

842 
	mpÜt
;

843 
	mtı_backlog
;

844 *
	mbšdaddr
[
CONFIG_BINDADDR_MAX
];

845 
	mbšdaddr_couÁ
;

846 *
	munixsock‘
;

847 
mode_t
 
	munixsock‘³rm
;

848 
	mfd
[
CONFIG_BINDADDR_MAX
];

849 
	mfd_couÁ
;

850 
	msofd
;

851 
	mcfd
[
CONFIG_BINDADDR_MAX
];

852 
	mcfd_couÁ
;

853 
li¡
 *
	mş›Ás
;

854 
li¡
 *
	mş›Ás_to_şo£
;

855 
li¡
 *
	mş›Ás_³ndšg_wr™e
;

856 
li¡
 *
	m¦aves
, *
	mmÚ™Üs
;

857 
ş›Á
 *
	mcu¼’t_ş›Á
;

858 
	mş›Ás_·u£d
;

859 
m¡ime_t
 
	mş›Ás_·u£_’d_time
;

860 
	mÃ‹¼
[
ANET_ERR_LEN
];

861 
diù
 *
	mmig¿‹_ÿched_sock‘s
;

862 
ušt64_t
 
	mÃxt_ş›Á_id
;

863 
	m´Ùeùed_mode
;

865 
	mlßdšg
;

866 
off_t
 
	mlßdšg_tÙ®_by‹s
;

867 
off_t
 
	mlßdšg_lßded_by‹s
;

868 
time_t
 
	mlßdšg_¡¬t_time
;

869 
off_t
 
	mlßdšg_´oûss_ev’ts_š‹rv®_by‹s
;

871 
»disCommªd
 *
	md–Commªd
, *
	mmuÉiCommªd
, *
	mÍushCommªd
, *
	mÍİCommªd
,

872 *
	m½İCommªd
, *
	m¤emCommªd
, *
	mexecCommªd
;

874 
time_t
 
	m¡©_¡¬‰ime
;

875 
	m¡©_numcommªds
;

876 
	m¡©_numcÚÃùiÚs
;

877 
	m¡©_expœedkeys
;

878 
	m¡©_eviùedkeys
;

879 
	m¡©_key¥aû_h™s
;

880 
	m¡©_key¥aû_mis£s
;

881 
size_t
 
	m¡©_³ak_memÜy
;

882 
	m¡©_fÜk_time
;

883 
	m¡©_fÜk_¿‹
;

884 
	m¡©_»jeùed_cÚn
;

885 
	m¡©_sync_fuÎ
;

886 
	m¡©_sync_·¹Ÿl_ok
;

887 
	m¡©_sync_·¹Ÿl_”r
;

888 
li¡
 *
	m¦owlog
;

889 
	m¦owlog_’Œy_id
;

890 
	m¦owlog_log_¦ow”_thª
;

891 
	m¦owlog_max_Ën
;

892 
size_t
 
	m»sid’t_£t_size
;

893 
	m¡©_Ãt_šput_by‹s
;

894 
	m¡©_Ãt_ouut_by‹s
;

895 
size_t
 
	m¡©_rdb_cow_by‹s
;

896 
size_t
 
	m¡©_aof_cow_by‹s
;

900 
	mÏ¡_§m¶e_time
;

901 
	mÏ¡_§m¶e_couÁ
;

902 
	m§m¶es
[
STATS_METRIC_SAMPLES
];

903 
	midx
;

904 } 
	mš¡_m‘ric
[
STATS_METRIC_COUNT
];

906 
	mv”bos™y
;

907 
	mmaxidËtime
;

908 
	mtık“·live
;

909 
	maùive_expœe_’abËd
;

910 
size_t
 
	mş›Á_max_qu”ybuf_Ën
;

911 
	mdbnum
;

912 
	msu³rvi£d
;

913 
	msu³rvi£d_mode
;

914 
	md«mÚize
;

915 
ş›ÁBufãrLim™sCÚfig
 
	mş›Á_obuf_lim™s
[
CLIENT_TYPE_OBUF_COUNT
];

917 
	maof_¡©e
;

918 
	maof_fsync
;

919 *
	maof_f’ame
;

920 
	maof_no_fsync_Ú_»wr™e
;

921 
	maof_»wr™e_³rc
;

922 
off_t
 
	maof_»wr™e_mš_size
;

923 
off_t
 
	maof_»wr™e_ba£_size
;

924 
off_t
 
	maof_cu¼’t_size
;

925 
	maof_»wr™e_scheduËd
;

926 
pid_t
 
	maof_chd_pid
;

927 
li¡
 *
	maof_»wr™e_buf_blocks
;

928 
sds
 
	maof_buf
;

929 
	maof_fd
;

930 
	maof_£Ëùed_db
;

931 
time_t
 
	maof_æush_po¡pÚed_¡¬t
;

932 
time_t
 
	maof_Ï¡_fsync
;

933 
time_t
 
	maof_»wr™e_time_Ï¡
;

934 
time_t
 
	maof_»wr™e_time_¡¬t
;

935 
	maof_Ï¡bg»wr™e_¡©us
;

936 
	maof_d–ayed_fsync
;

937 
	maof_»wr™e_šüem’l_fsync
;

938 
	maof_Ï¡_wr™e_¡©us
;

939 
	maof_Ï¡_wr™e_”ºo
;

940 
	maof_lßd_Œunÿ‹d
;

941 
	maof_u£_rdb_´—mbË
;

943 
	maof_pe_wr™e_d©a_to_chd
;

944 
	maof_pe_»ad_d©a_äom_·»Á
;

945 
	maof_pe_wr™e_ack_to_·»Á
;

946 
	maof_pe_»ad_ack_äom_chd
;

947 
	maof_pe_wr™e_ack_to_chd
;

948 
	maof_pe_»ad_ack_äom_·»Á
;

949 
	maof_¡İ_£ndšg_diff
;

951 
sds
 
	maof_chd_diff
;

953 
	mdœty
;

954 
	mdœty_befÜe_bg§ve
;

955 
pid_t
 
	mrdb_chd_pid
;

956 
§v•¬am
 *
	m§v•¬ams
;

957 
	m§v•¬am¦’
;

958 *
	mrdb_f’ame
;

959 
	mrdb_com´essiÚ
;

960 
	mrdb_checksum
;

961 
time_t
 
	mÏ¡§ve
;

962 
time_t
 
	mÏ¡bg§ve_Œy
;

963 
time_t
 
	mrdb_§ve_time_Ï¡
;

964 
time_t
 
	mrdb_§ve_time_¡¬t
;

965 
	mrdb_bg§ve_scheduËd
;

966 
	mrdb_chd_ty³
;

967 
	mÏ¡bg§ve_¡©us
;

968 
	m¡İ_wr™es_Ú_bg§ve_”r
;

969 
	mrdb_pe_wr™e_»suÉ_to_·»Á
;

970 
	mrdb_pe_»ad_»suÉ_äom_chd
;

972 
	mchd_šfo_pe
[2];

974 
	m´oûss_ty³
;

975 
size_t
 
	mcow_size
;

976 
	mmagic
;

977 } 
	mchd_šfo_d©a
;

979 
»disOpA¼ay
 
	m®so_´İag©e
;

981 *
	mlogfe
;

982 
	msy¦og_’abËd
;

983 *
	msy¦og_id’t
;

984 
	msy¦og_çc™y
;

986 
	m¦ave£ldb
;

987 
	mma¡”_»¶_off£t
;

988 
	m»¶_pšg_¦ave_³riod
;

989 *
	m»¶_backlog
;

990 
	m»¶_backlog_size
;

991 
	m»¶_backlog_hi¡Ën
;

992 
	m»¶_backlog_idx
;

993 
	m»¶_backlog_off
;

995 
time_t
 
	m»¶_backlog_time_lim™
;

997 
time_t
 
	m»¶_no_¦aves_sšû
;

999 
	m»¶_mš_¦aves_to_wr™e
;

1000 
	m»¶_mš_¦aves_max_Ïg
;

1001 
	m»¶_good_¦aves_couÁ
;

1002 
	m»¶_diskËss_sync
;

1003 
	m»¶_diskËss_sync_d–ay
;

1005 *
	mma¡”auth
;

1006 *
	mma¡”ho¡
;

1007 
	mma¡”pÜt
;

1008 
	m»¶_timeout
;

1009 
ş›Á
 *
	mma¡”
;

1010 
ş›Á
 *
	mÿched_ma¡”
;

1011 
	m»¶_syncio_timeout
;

1012 
	m»¶_¡©e
;

1013 
off_t
 
	m»¶_Œªsãr_size
;

1014 
off_t
 
	m»¶_Œªsãr_»ad
;

1015 
off_t
 
	m»¶_Œªsãr_Ï¡_fsync_off
;

1016 
	m»¶_Œªsãr_s
;

1017 
	m»¶_Œªsãr_fd
;

1018 *
	m»¶_Œªsãr_tmpfe
;

1019 
time_t
 
	m»¶_Œªsãr_Ï¡io
;

1020 
	m»¶_£rve_¡®e_d©a
;

1021 
	m»¶_¦ave_ro
;

1022 
time_t
 
	m»¶_down_sšû
;

1023 
	m»¶_di§bË_tı_nod–ay
;

1024 
	m¦ave_´iÜ™y
;

1025 
	m¦ave_ªnounû_pÜt
;

1026 *
	m¦ave_ªnounû_
;

1027 
	m»¶_ma¡”_runid
[
CONFIG_RUN_ID_SIZE
+1];

1028 
	m»¶_ma¡”_š™Ÿl_off£t
;

1029 
	m»¶_¦ave_Ïzy_æush
;

1031 
diù
 *
	m»¶_sütÿche_diù
;

1032 
li¡
 *
	m»¶_sütÿche_fifo
;

1033 
	m»¶_sütÿche_size
;

1035 
li¡
 *
	mş›Ás_wa™šg_acks
;

1036 
	mg‘_ack_äom_¦aves
;

1038 
	mmaxş›Ás
;

1039 
	mmaxmemÜy
;

1040 
	mmaxmemÜy_pŞicy
;

1041 
	mmaxmemÜy_§m¶es
;

1042 
	mlfu_log_çùÜ
;

1043 
	mlfu_deÿy_time
;

1045 
	mbpİ_blocked_ş›Ás
;

1046 
li¡
 *
	munblocked_ş›Ás
;

1047 
li¡
 *
	m»ady_keys
;

1050 
	msÜt_desc
;

1051 
	msÜt_®pha
;

1052 
	msÜt_by·‰”n
;

1053 
	msÜt_¡Üe
;

1055 
size_t
 
	mhash_max_zli¡_’Œ›s
;

1056 
size_t
 
	mhash_max_zli¡_v®ue
;

1057 
size_t
 
	m£t_max_št£t_’Œ›s
;

1058 
size_t
 
	mz£t_max_zli¡_’Œ›s
;

1059 
size_t
 
	mz£t_max_zli¡_v®ue
;

1060 
size_t
 
	mhÎ_¥¬£_max_by‹s
;

1062 
	mli¡_max_zli¡_size
;

1063 
	mli¡_com´ess_d•th
;

1065 
time_t
 
	munixtime
;

1066 
	mm¡ime
;

1068 
diù
 *
	mpubsub_chªÃls
;

1069 
li¡
 *
	mpubsub_·‰”ns
;

1070 
	mnÙify_key¥aû_ev’ts
;

1073 
	mşu¡”_’abËd
;

1074 
m¡ime_t
 
	mşu¡”_node_timeout
;

1075 *
	mşu¡”_cÚfigfe
;

1076 
şu¡”S‹
 *
	mşu¡”
;

1077 
	mşu¡”_mig¿tiÚ_b¬r›r
;

1078 
	mşu¡”_¦ave_v®id™y_çùÜ
;

1079 
	mşu¡”_»quœe_fuÎ_cov”age
;

1081 *
	mşu¡”_ªnounû_
;

1082 
	mşu¡”_ªnounû_pÜt
;

1083 
	mşu¡”_ªnounû_bus_pÜt
;

1085 
lua_S‹
 *
	mlua
;

1086 
ş›Á
 *
	mlua_ş›Á
;

1087 
ş›Á
 *
	mlua_ÿÎ”
;

1088 
diù
 *
	mlua_süts
;

1089 
m¡ime_t
 
	mlua_time_lim™
;

1090 
m¡ime_t
 
	mlua_time_¡¬t
;

1091 
	mlua_wr™e_dœty
;

1093 
	mlua_¿ndom_dœty
;

1095 
	mlua_»¶iÿ‹_commªds
;

1096 
	mlua_muÉi_em™‹d
;

1097 
	mlua_»¶
;

1098 
	mlua_timedout
;

1100 
	mlua_kl
;

1101 
	mlua_®ways_»¶iÿ‹_commªds
;

1103 
	mÏzyä“_Ïzy_eviùiÚ
;

1104 
	mÏzyä“_Ïzy_expœe
;

1105 
	mÏzyä“_Ïzy_£rv”_d–
;

1107 
	mÏ‹ncy_mÚ™Ü_th»shŞd
;

1108 
diù
 *
	mÏ‹ncy_ev’ts
;

1110 cÚ¡ *
	mas£¹_çed
;

1111 cÚ¡ *
	mas£¹_fe
;

1112 
	mas£¹_lše
;

1113 
	mbug_»pÜt_¡¬t
;

1114 
	mw©chdog_³riod
;

1116 
size_t
 
	msy¡em_memÜy_size
;

1119 
	spubsubP©‹º
 {

1120 
ş›Á
 *
	mş›Á
;

1121 
robj
 *
	m·‰”n
;

1122 } 
	tpubsubP©‹º
;

1124 
	t»disCommªdProc
(
	tş›Á
 *
	tc
);

1125 *
	t»disG‘KeysProc
(
	t»disCommªd
 *
	tcmd
, 
	trobj
 **
	t¬gv
, 
	t¬gc
, *
	tnumkeys
);

1126 
	s»disCommªd
 {

1127 *
	mÇme
;

1128 
»disCommªdProc
 *
	m´oc
;

1129 
	m¬™y
;

1130 *
	msæags
;

1131 
	mæags
;

1134 
»disG‘KeysProc
 *
	mg‘keys_´oc
;

1136 
	mfœ¡key
;

1137 
	mÏ¡key
;

1138 
	mkey¡•
;

1139 
	mmiüo£cÚds
, 
	mÿÎs
;

1142 
	s»disFunùiÚSym
 {

1143 *
	mÇme
;

1144 
	mpoš‹r
;

1147 
	s_»disSÜtObjeù
 {

1148 
robj
 *
	mobj
;

1150 
	mscÜe
;

1151 
robj
 *
	mcmpobj
;

1152 } 
	mu
;

1153 } 
	t»disSÜtObjeù
;

1155 
	s_»disSÜtO³¿tiÚ
 {

1156 
	mty³
;

1157 
robj
 *
	m·‰”n
;

1158 } 
	t»disSÜtO³¿tiÚ
;

1162 
robj
 *
	msubjeù
;

1163 
	m’codšg
;

1164 
	mdœeùiÚ
;

1165 
quickli¡I‹r
 *
	m™”
;

1166 } 
	tli¡Ty³I‹¿tÜ
;

1170 
li¡Ty³I‹¿tÜ
 *
	mli
;

1171 
quickli¡EÁry
 
	m’Œy
;

1172 } 
	tli¡Ty³EÁry
;

1176 
robj
 *
	msubjeù
;

1177 
	m’codšg
;

1178 
	mii
;

1179 
diùI‹¿tÜ
 *
	mdi
;

1180 } 
	t£tTy³I‹¿tÜ
;

1187 
robj
 *
	msubjeù
;

1188 
	m’codšg
;

1190 *
	måŒ
, *
	mv±r
;

1192 
diùI‹¿tÜ
 *
	mdi
;

1193 
diùEÁry
 *
	mde
;

1194 } 
	thashTy³I‹¿tÜ
;

1196 
	#OBJ_HASH_KEY
 1

	)

1197 
	#OBJ_HASH_VALUE
 2

	)

1203 
»disS”v”
 
£rv”
;

1204 
sh¬edObjeùsSŒuù
 
sh¬ed
;

1205 
diùTy³
 
objeùKeyPoš‹rV®ueDiùTy³
;

1206 
diùTy³
 
£tDiùTy³
;

1207 
diùTy³
 
z£tDiùTy³
;

1208 
diùTy³
 
şu¡”NodesDiùTy³
;

1209 
diùTy³
 
şu¡”NodesBÏckLi¡DiùTy³
;

1210 
diùTy³
 
dbDiùTy³
;

1211 
diùTy³
 
shaSütObjeùDiùTy³
;

1212 
R_Z”o
, 
R_PosInf
, 
R_NegInf
, 
R_Nª
;

1213 
diùTy³
 
hashDiùTy³
;

1214 
diùTy³
 
»¶SütCacheDiùTy³
;

1215 
diùTy³
 
key±rDiùTy³
;

1216 
diùTy³
 
moduËsDiùTy³
;

1223 
moduËIn™ModuËsSy¡em
();

1224 
moduËLßd
(cÚ¡ *
·th
, **
¬gv
, 
¬gc
);

1225 
moduËLßdFromQueue
();

1226 *
moduËG‘CommªdKeysVŸAPI
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1227 
moduËTy³
 *
moduËTy³LookupModuËByID
(
ušt64_t
 
id
);

1228 
moduËTy³NameByID
(*
Çme
, 
ušt64_t
 
moduËid
);

1229 
moduËF»eCÚ‹xt
(
RedisModuËCtx
 *
ùx
);

1232 
u¡ime
();

1233 
m¡ime
();

1234 
g‘RªdomHexCh¬s
(*
p
, 
Ën
);

1235 
ušt64_t
 
üc64
(ušt64_ˆ
üc
, cÚ¡ *
s
, ušt64_ˆ
l
);

1236 
ex™FromChd
(
»tcode
);

1237 
size_t
 
»disPİcouÁ
(*
s
, 
couÁ
);

1238 
»disS‘ProcT™Ë
(*
t™Ë
);

1241 
ş›Á
 *
ü—‹Cl›Á
(
fd
);

1242 
şo£TimedoutCl›Ás
();

1243 
ä“Cl›Á
(
ş›Á
 *
c
);

1244 
ä“Cl›ÁAsync
(
ş›Á
 *
c
);

1245 
»£tCl›Á
(
ş›Á
 *
c
);

1246 
£ndR•lyToCl›Á
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

1247 *
addDeã¼edMuÉiBulkL’gth
(
ş›Á
 *
c
);

1248 
£tDeã¼edMuÉiBulkL’gth
(
ş›Á
 *
c
, *
node
, 
Ëngth
);

1249 
´oûssIÅutBufãr
(
ş›Á
 *
c
);

1250 
acû±HªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

1251 
acû±TıHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

1252 
acû±UnixHªdËr
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

1253 
»adQu”yFromCl›Á
(
«Ev’tLoİ
 *
–
, 
fd
, *
´ivd©a
, 
mask
);

1254 
addR•lyBulk
(
ş›Á
 *
c
, 
robj
 *
obj
);

1255 
addR•lyBulkCSŒšg
(
ş›Á
 *
c
, cÚ¡ *
s
);

1256 
addR•lyBulkCBufãr
(
ş›Á
 *
c
, cÚ¡ *
p
, 
size_t
 
Ën
);

1257 
addR•lyBulkLÚgLÚg
(
ş›Á
 *
c
, 
Î
);

1258 
addR•ly
(
ş›Á
 *
c
, 
robj
 *
obj
);

1259 
addR•lySds
(
ş›Á
 *
c
, 
sds
 
s
);

1260 
addR•lyBulkSds
(
ş›Á
 *
c
, 
sds
 
s
);

1261 
addR•lyE¼Ü
(
ş›Á
 *
c
, cÚ¡ *
”r
);

1262 
addR•lyStus
(
ş›Á
 *
c
, cÚ¡ *
¡©us
);

1263 
addR•lyDoubË
(
ş›Á
 *
c
, 
d
);

1264 
addR•lyHumªLÚgDoubË
(
ş›Á
 *
c
, 
d
);

1265 
addR•lyLÚgLÚg
(
ş›Á
 *
c
, 
Î
);

1266 
addR•lyMuÉiBulkL’
(
ş›Á
 *
c
, 
Ëngth
);

1267 
cİyCl›ÁOuutBufãr
(
ş›Á
 *
d¡
, cl›Á *
¤c
);

1268 
size_t
 
sdsZm®locSize
(
sds
 
s
);

1269 
size_t
 
g‘SŒšgObjeùSdsU£dMemÜy
(
robj
 *
o
);

1270 *
dupCl›ÁR•lyV®ue
(*
o
);

1271 
g‘Cl›ÁsMaxBufãrs
(*
lÚge¡_ouut_li¡
,

1272 *
bigge¡_šput_bufãr
);

1273 *
g‘Cl›ÁP“rId
(
ş›Á
 *client);

1274 
sds
 
ÿtCl›ÁInfoSŒšg
(sd 
s
, 
ş›Á
 *client);

1275 
sds
 
g‘AÎCl›ÁsInfoSŒšg
();

1276 
»wr™eCl›ÁCommªdVeùÜ
(
ş›Á
 *
c
, 
¬gc
, ...);

1277 
»wr™eCl›ÁCommªdArgum’t
(
ş›Á
 *
c
, 
i
, 
robj
 *
Ãwv®
);

1278 
»¶aûCl›ÁCommªdVeùÜ
(
ş›Á
 *
c
, 
¬gc
, 
robj
 **
¬gv
);

1279 
g‘Cl›ÁOuutBufãrMemÜyU§ge
(
ş›Á
 *
c
);

1280 
ä“Cl›ÁsInAsyncF»eQueue
();

1281 
asyncClo£Cl›ÁOnOuutBufãrLim™R—ched
(
ş›Á
 *
c
);

1282 
g‘Cl›ÁTy³
(
ş›Á
 *
c
);

1283 
g‘Cl›ÁTy³ByName
(*
Çme
);

1284 *
g‘Cl›ÁTy³Name
(
şass
);

1285 
æushSÏvesOuutBufãrs
();

1286 
discÚÃùSÏves
();

1287 
li¡’ToPÜt
(
pÜt
, *
fds
, *
couÁ
);

1288 
·u£Cl›Ás
(
m¡ime_t
 
du¿tiÚ
);

1289 
ş›ÁsA»Pau£d
();

1290 
´oûssEv’tsWheBlocked
();

1291 
hªdËCl›ÁsW™hP’dšgWr™es
();

1292 
ş›ÁHasP’dšgR•l›s
(
ş›Á
 *
c
);

1293 
uÆškCl›Á
(
ş›Á
 *
c
);

1294 
wr™eToCl›Á
(
fd
, 
ş›Á
 *
c
, 
hªdËr_š¡®Ëd
);

1296 #ifdeà
__GNUC__


1297 
	$addR•lyE¼ÜFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...)

1298 
	`__©Œibu‹__
((
	`fÜm©
(
´štf
, 2, 3)));

1299 
	$addR•lyStusFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...)

1300 
	`__©Œibu‹__
((
	`fÜm©
(
´štf
, 2, 3)));

1302 
	`addR•lyE¼ÜFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...);

1303 
	`addR•lyStusFÜm©
(
ş›Á
 *
c
, cÚ¡ *
fmt
, ...);

1307 
	`li¡Ty³TryCÚv”siÚ
(
robj
 *
subjeù
,„obj *
v®ue
);

1308 
	`li¡Ty³Push
(
robj
 *
subjeù
,„obj *
v®ue
, 
wh”e
);

1309 
robj
 *
	`li¡Ty³Pİ
Ôobj *
subjeù
, 
wh”e
);

1310 
	`li¡Ty³L’gth
(cÚ¡ 
robj
 *
subjeù
);

1311 
li¡Ty³I‹¿tÜ
 *
	`li¡Ty³In™I‹¿tÜ
(
robj
 *
subjeù
, 
šdex
, 
dœeùiÚ
);

1312 
	`li¡Ty³R–—£I‹¿tÜ
(
li¡Ty³I‹¿tÜ
 *
li
);

1313 
	`li¡Ty³Next
(
li¡Ty³I‹¿tÜ
 *
li
, 
li¡Ty³EÁry
 *
’Œy
);

1314 
robj
 *
	`li¡Ty³G‘
(
li¡Ty³EÁry
 *
’Œy
);

1315 
	`li¡Ty³In£¹
(
li¡Ty³EÁry
 *
’Œy
, 
robj
 *
v®ue
, 
wh”e
);

1316 
	`li¡Ty³Equ®
(
li¡Ty³EÁry
 *
’Œy
, 
robj
 *
o
);

1317 
	`li¡Ty³D–‘e
(
li¡Ty³I‹¿tÜ
 *
™”
, 
li¡Ty³EÁry
 *
’Œy
);

1318 
	`li¡Ty³CÚv”t
(
robj
 *
subjeù
, 
’c
);

1319 
	`unblockCl›ÁWa™šgD©a
(
ş›Á
 *
c
);

1320 
	`hªdËCl›ÁsBlockedOnLi¡s
();

1321 
	`pİG’”icCommªd
(
ş›Á
 *
c
, 
wh”e
);

1322 
	`sigÇlLi¡AsR—dy
(
»disDb
 *
db
, 
robj
 *
key
);

1325 
	`unw©chAÎKeys
(
ş›Á
 *
c
);

1326 
	`š™Cl›ÁMuÉiS‹
(
ş›Á
 *
c
);

1327 
	`ä“Cl›ÁMuÉiS‹
(
ş›Á
 *
c
);

1328 
	`queueMuÉiCommªd
(
ş›Á
 *
c
);

1329 
	`touchW©chedKey
(
»disDb
 *
db
, 
robj
 *
key
);

1330 
	`touchW©chedKeysOnFlush
(
dbid
);

1331 
	`disÿrdT¿n§ùiÚ
(
ş›Á
 *
c
);

1332 
	`æagT¿n§ùiÚ
(
ş›Á
 *
c
);

1333 
	`execCommªdPrİag©eMuÉi
(
ş›Á
 *
c
);

1336 
	`deüRefCouÁ
(
robj
 *
o
);

1337 
	`deüRefCouÁVoid
(*
o
);

1338 
	`šüRefCouÁ
(
robj
 *
o
);

1339 
robj
 *
	`makeObjeùSh¬ed
Ôobj *
o
);

1340 
robj
 *
	`»£tRefCouÁ
Ôobj *
obj
);

1341 
	`ä“SŒšgObjeù
(
robj
 *
o
);

1342 
	`ä“Li¡Objeù
(
robj
 *
o
);

1343 
	`ä“S‘Objeù
(
robj
 *
o
);

1344 
	`ä“Z£tObjeù
(
robj
 *
o
);

1345 
	`ä“HashObjeù
(
robj
 *
o
);

1346 
robj
 *
	`ü—‹Objeù
(
ty³
, *
±r
);

1347 
robj
 *
	`ü—‹SŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
);

1348 
robj
 *
	`ü—‹RawSŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
);

1349 
robj
 *
	`ü—‹EmbeddedSŒšgObjeù
(cÚ¡ *
±r
, 
size_t
 
Ën
);

1350 
robj
 *
	`dupSŒšgObjeù
(cÚ¡„obj *
o
);

1351 
	`isSdsR•»£ÁabËAsLÚgLÚg
(
sds
 
s
, *
Îv®
);

1352 
	`isObjeùR•»£ÁabËAsLÚgLÚg
(
robj
 *
o
, *
ÎÚgv®
);

1353 
robj
 *
	`ŒyObjeùEncodšg
Ôobj *
o
);

1354 
robj
 *
	`g‘DecodedObjeù
Ôobj *
o
);

1355 
size_t
 
	`¡ršgObjeùL’
(
robj
 *
o
);

1356 
robj
 *
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
v®ue
);

1357 
robj
 *
	`ü—‹SŒšgObjeùFromLÚgDoubË
(
v®ue
, 
humªä›ndly
);

1358 
robj
 *
	`ü—‹Quickli¡Objeù
();

1359 
robj
 *
	`ü—‹Zli¡Objeù
();

1360 
robj
 *
	`ü—‹S‘Objeù
();

1361 
robj
 *
	`ü—‹IÁ£tObjeù
();

1362 
robj
 *
	`ü—‹HashObjeù
();

1363 
robj
 *
	`ü—‹Z£tObjeù
();

1364 
robj
 *
	`ü—‹Z£tZli¡Objeù
();

1365 
robj
 *
	`ü—‹ModuËObjeù
(
moduËTy³
 *
mt
, *
v®ue
);

1366 
	`g‘LÚgFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
);

1367 
	`checkTy³
(
ş›Á
 *
c
, 
robj
 *
o
, 
ty³
);

1368 
	`g‘LÚgLÚgFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
);

1369 
	`g‘DoubËFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
);

1370 
	`g‘DoubËFromObjeù
(cÚ¡ 
robj
 *
o
, *
rg‘
);

1371 
	`g‘LÚgLÚgFromObjeù
(
robj
 *
o
, *
rg‘
);

1372 
	`g‘LÚgDoubËFromObjeù
(
robj
 *
o
, *
rg‘
);

1373 
	`g‘LÚgDoubËFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
rg‘
, cÚ¡ *
msg
);

1374 *
	`¡rEncodšg
(
’codšg
);

1375 
	`com·»SŒšgObjeùs
(
robj
 *
a
,„obj *
b
);

1376 
	`cŞÏ‹SŒšgObjeùs
(
robj
 *
a
,„obj *
b
);

1377 
	`equ®SŒšgObjeùs
(
robj
 *
a
,„obj *
b
);

1378 
	`e¡im©eObjeùIdËTime
(
robj
 *
o
);

1379 
	#sdsEncodedObjeù
(
obj±r
è(obj±r->
’codšg
 =ğ
OBJ_ENCODING_RAW
 || obj±r->’codšg =ğ
OBJ_ENCODING_EMBSTR
)

	)

1382 
ssize_t
 
	`syncWr™e
(
fd
, *
±r
, ssize_ˆ
size
, 
timeout
);

1383 
ssize_t
 
	`syncR—d
(
fd
, *
±r
, ssize_ˆ
size
, 
timeout
);

1384 
ssize_t
 
	`syncR—dLše
(
fd
, *
±r
, ssize_ˆ
size
, 
timeout
);

1387 
	`»¶iÿtiÚF“dSÏves
(
li¡
 *
¦aves
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
);

1388 
	`»¶iÿtiÚF“dMÚ™Üs
(
ş›Á
 *
c
, 
li¡
 *
mÚ™Üs
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
);

1389 
	`upd©eSÏvesWa™šgBg§ve
(
bg§v“¼
, 
ty³
);

1390 
	`»¶iÿtiÚCrÚ
();

1391 
	`»¶iÿtiÚHªdËMa¡”DiscÚÃùiÚ
();

1392 
	`»¶iÿtiÚCacheMa¡”
(
ş›Á
 *
c
);

1393 
	`»sizeR•liÿtiÚBacklog
(
Ãwsize
);

1394 
	`»¶iÿtiÚS‘Ma¡”
(*

, 
pÜt
);

1395 
	`»¶iÿtiÚUn£tMa¡”
();

1396 
	`»äeshGoodSÏvesCouÁ
();

1397 
	`»¶iÿtiÚSütCacheIn™
();

1398 
	`»¶iÿtiÚSütCacheFlush
();

1399 
	`»¶iÿtiÚSütCacheAdd
(
sds
 
sha1
);

1400 
	`»¶iÿtiÚSütCacheExi¡s
(
sds
 
sha1
);

1401 
	`´oûssCl›ÁsWa™šgR•liÿs
();

1402 
	`unblockCl›ÁWa™šgR•liÿs
(
ş›Á
 *
c
);

1403 
	`»¶iÿtiÚCouÁAcksByOff£t
(
off£t
);

1404 
	`»¶iÿtiÚS’dNewlšeToMa¡”
();

1405 
	`»¶iÿtiÚG‘SÏveOff£t
();

1406 *
	`»¶iÿtiÚG‘SÏveName
(
ş›Á
 *
c
);

1407 
	`g‘PsyncIn™ŸlOff£t
();

1408 
	`»¶iÿtiÚS‘upSÏveFÜFuÎResync
(
ş›Á
 *
¦ave
, 
off£t
);

1411 
	`¡¬tLßdšg
(
FILE
 *
å
);

1412 
	`lßdšgProg»ss
(
off_t
 
pos
);

1413 
	`¡İLßdšg
();

1416 
	~"rdb.h
"

1417 
	`rdbSaveRio
(
rio
 *
rdb
, *
”rÜ
, 
æags
);

1420 
	`æushAµ’dOÆyFe
(
fÜû
);

1421 
	`ãedAµ’dOÆyFe
(
»disCommªd
 *
cmd
, 
diùid
, 
robj
 **
¬gv
, 
¬gc
);

1422 
	`aofRemoveTempFe
(
pid_t
 
chdpid
);

1423 
	`»wr™eAµ’dOÆyFeBackground
();

1424 
	`lßdAµ’dOÆyFe
(*
f’ame
);

1425 
	`¡İAµ’dOÆy
();

1426 
	`¡¬tAµ’dOÆy
();

1427 
	`backgroundRewr™eDÚeHªdËr
(
ex™code
, 
bysigÇl
);

1428 
	`aofRewr™eBufãrRe£t
();

1429 
	`aofRewr™eBufãrSize
();

1430 
ssize_t
 
	`aofR—dDiffFromP¬’t
();

1433 
	`İ’ChdInfoPe
();

1434 
	`şo£ChdInfoPe
();

1435 
	`£ndChdInfo
(
´oûss_ty³
);

1436 
	`»ûiveChdInfo
();

1441 
	#ZADD_NONE
 0

	)

1442 
	#ZADD_INCR
 (1<<0è

	)

1443 
	#ZADD_NX
 (1<<1è

	)

1444 
	#ZADD_XX
 (1<<2è

	)

1447 
	#ZADD_NOP
 (1<<3è

	)

1448 
	#ZADD_NAN
 (1<<4è

	)

1449 
	#ZADD_ADDED
 (1<<5è

	)

1450 
	#ZADD_UPDATED
 (1<<6è

	)

1453 
	#ZADD_CH
 (1<<16è

	)

1457 
mš
, 
max
;

1458 
mšex
, 
maxex
;

1459 } 
	tz¿nge¥ec
;

1463 
sds
 
mš
, 
max
;

1464 
mšex
, 
maxex
;

1465 } 
	tzËx¿nge¥ec
;

1467 
zskli¡
 *
	`z¦C»©e
();

1468 
	`z¦F»e
(
zskli¡
 *
z¦
);

1469 
zskli¡Node
 *
	`z¦In£¹
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
–e
);

1470 *
	`zzlIn£¹
(*
zl
, 
sds
 
–e
, 
scÜe
);

1471 
	`z¦D–‘e
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
–e
, 
zskli¡Node
 **
node
);

1472 
zskli¡Node
 *
	`z¦Fœ¡InRªge
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
);

1473 
zskli¡Node
 *
	`z¦La¡InRªge
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
);

1474 
	`zzlG‘ScÜe
(*
¥Œ
);

1475 
	`zzlNext
(*
zl
, **
•Œ
, **
¥Œ
);

1476 
	`zzlP»v
(*
zl
, **
•Œ
, **
¥Œ
);

1477 *
	`zzlFœ¡InRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
);

1478 *
	`zzlLa¡InRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
);

1479 
	`z£tL’gth
(cÚ¡ 
robj
 *
zobj
);

1480 
	`z£tCÚv”t
(
robj
 *
zobj
, 
’codšg
);

1481 
	`z£tCÚv”tToZli¡IfN“ded
(
robj
 *
zobj
, 
size_t
 
max––’
);

1482 
	`z£tScÜe
(
robj
 *
zobj
, 
sds
 
memb”
, *
scÜe
);

1483 
	`z¦G‘Rªk
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
o
);

1484 
	`z£tAdd
(
robj
 *
zobj
, 
scÜe
, 
sds
 
–e
, *
æags
, *
ÃwscÜe
);

1485 
	`z£tRªk
(
robj
 *
zobj
, 
sds
 
–e
, 
»v”£
);

1486 
	`z£tD–
(
robj
 *
zobj
, 
sds
 
–e
);

1487 
sds
 
	`zli¡G‘Objeù
(*
¥Œ
);

1488 
	`z¦V®ueG‹Mš
(
v®ue
, 
z¿nge¥ec
 *
¥ec
);

1489 
	`z¦V®ueL‹Max
(
v®ue
, 
z¿nge¥ec
 *
¥ec
);

1490 
	`z¦F»eLexRªge
(
zËx¿nge¥ec
 *
¥ec
);

1491 
	`z¦P¬£LexRªge
(
robj
 *
mš
,„obj *
max
, 
zËx¿nge¥ec
 *
¥ec
);

1492 *
	`zzlFœ¡InLexRªge
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
);

1493 *
	`zzlLa¡InLexRªge
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
);

1494 
zskli¡Node
 *
	`z¦Fœ¡InLexRªge
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
);

1495 
zskli¡Node
 *
	`z¦La¡InLexRªge
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
);

1496 
	`zzlLexV®ueG‹Mš
(*
p
, 
zËx¿nge¥ec
 *
¥ec
);

1497 
	`zzlLexV®ueL‹Max
(*
p
, 
zËx¿nge¥ec
 *
¥ec
);

1498 
	`z¦LexV®ueG‹Mš
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
);

1499 
	`z¦LexV®ueL‹Max
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
);

1502 
	`ä“MemÜyIfN“ded
();

1503 
	`´oûssCommªd
(
ş›Á
 *
c
);

1504 
	`£tupSigÇlHªdËrs
();

1505 
»disCommªd
 *
	`lookupCommªd
(
sds
 
Çme
);

1506 
»disCommªd
 *
	`lookupCommªdByCSŒšg
(*
s
);

1507 
»disCommªd
 *
	`lookupCommªdOrOrigš®
(
sds
 
Çme
);

1508 
	`ÿÎ
(
ş›Á
 *
c
, 
æags
);

1509 
	`´İag©e
(
»disCommªd
 *
cmd
, 
dbid
, 
robj
 **
¬gv
, 
¬gc
, 
æags
);

1510 
	`®soPrİag©e
(
»disCommªd
 *
cmd
, 
dbid
, 
robj
 **
¬gv
, 
¬gc
, 
rg‘
);

1511 
	`fÜûCommªdPrİag©iÚ
(
ş›Á
 *
c
, 
æags
);

1512 
	`´ev’tCommªdPrİag©iÚ
(
ş›Á
 *
c
);

1513 
	`´ev’tCommªdAOF
(
ş›Á
 *
c
);

1514 
	`´ev’tCommªdR•liÿtiÚ
(
ş›Á
 *
c
);

1515 
	`´•¬eFÜShutdown
();

1516 #ifdeà
__GNUC__


1517 
	$£rv”Log
(
Ëv–
, cÚ¡ *
fmt
, ...)

1518 
	`__©Œibu‹__
((
	`fÜm©
(
´štf
, 2, 3)));

1520 
	`£rv”Log
(
Ëv–
, cÚ¡ *
fmt
, ...);

1522 
	`£rv”LogRaw
(
Ëv–
, cÚ¡ *
msg
);

1523 
	`£rv”LogFromHªdËr
(
Ëv–
, cÚ¡ *
msg
);

1524 
	`u§ge
();

1525 
	`upd©eDiùResizePŞicy
();

1526 
	`htN“dsResize
(
diù
 *dict);

1527 
	`pİuÏ‹CommªdTabË
();

1528 
	`»£tCommªdTabËSts
();

1529 
	`adju¡O³nFesLim™
();

1530 
	`şo£Li¡’šgSock‘s
(
uÆšk_unix_sock‘
);

1531 
	`upd©eCachedTime
();

1532 
	`»£tS”v”Sts
();

1533 
	`g‘LRUClock
();

1534 cÚ¡ *
	`eviùPŞicyToSŒšg
();

1535 
»disMemOv”h—d
 *
	`g‘MemÜyOv”h—dD©a
();

1536 
	`ä“MemÜyOv”h—dD©a
(
»disMemOv”h—d
 *
mh
);

1538 
	#RESTART_SERVER_NONE
 0

	)

1539 
	#RESTART_SERVER_GRACEFULLY
 (1<<0è

	)

1540 
	#RESTART_SERVER_CONFIG_REWRITE
 (1<<1è

	)

1541 
	`»¡¬tS”v”
(
æags
, 
m¡ime_t
 
d–ay
);

1544 
robj
 *
	`£tTy³C»©e
(
sds
 
v®ue
);

1545 
	`£tTy³Add
(
robj
 *
subjeù
, 
sds
 
v®ue
);

1546 
	`£tTy³Remove
(
robj
 *
subjeù
, 
sds
 
v®ue
);

1547 
	`£tTy³IsMemb”
(
robj
 *
subjeù
, 
sds
 
v®ue
);

1548 
£tTy³I‹¿tÜ
 *
	`£tTy³In™I‹¿tÜ
(
robj
 *
subjeù
);

1549 
	`£tTy³R–—£I‹¿tÜ
(
£tTy³I‹¿tÜ
 *
si
);

1550 
	`£tTy³Next
(
£tTy³I‹¿tÜ
 *
si
, 
sds
 *
sd£Ë
, 
št64_t
 *
Î–e
);

1551 
sds
 
	`£tTy³NextObjeù
(
£tTy³I‹¿tÜ
 *
si
);

1552 
	`£tTy³RªdomEËm’t
(
robj
 *
£tobj
, 
sds
 *
sd£Ë
, 
št64_t
 *
Î–e
);

1553 
	`£tTy³RªdomEËm’ts
(
robj
 *
£t
, 
couÁ
,„obj *
aux_£t
);

1554 
	`£tTy³Size
(cÚ¡ 
robj
 *
subjeù
);

1555 
	`£tTy³CÚv”t
(
robj
 *
subjeù
, 
’c
);

1558 
	#HASH_SET_TAKE_FIELD
 (1<<0)

	)

1559 
	#HASH_SET_TAKE_VALUE
 (1<<1)

	)

1560 
	#HASH_SET_COPY
 0

	)

1562 
	`hashTy³CÚv”t
(
robj
 *
o
, 
’c
);

1563 
	`hashTy³TryCÚv”siÚ
(
robj
 *
subjeù
,„obj **
¬gv
, 
¡¬t
, 
’d
);

1564 
	`hashTy³TryObjeùEncodšg
(
robj
 *
subjeù
,„obj **
o1
,„obj **
o2
);

1565 
	`hashTy³Exi¡s
(
robj
 *
o
, 
sds
 
key
);

1566 
	`hashTy³D–‘e
(
robj
 *
o
, 
sds
 
key
);

1567 
	`hashTy³L’gth
(cÚ¡ 
robj
 *
o
);

1568 
hashTy³I‹¿tÜ
 *
	`hashTy³In™I‹¿tÜ
(
robj
 *
subjeù
);

1569 
	`hashTy³R–—£I‹¿tÜ
(
hashTy³I‹¿tÜ
 *
hi
);

1570 
	`hashTy³Next
(
hashTy³I‹¿tÜ
 *
hi
);

1571 
	`hashTy³Cu¼’tFromZli¡
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
,

1572 **
v¡r
,

1573 *
vËn
,

1574 *
vÎ
);

1575 
sds
 
	`hashTy³Cu¼’tFromHashTabË
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
);

1576 
	`hashTy³Cu¼’tObjeù
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
, **
v¡r
, *
vËn
, *
vÎ
);

1577 
sds
 
	`hashTy³Cu¼’tObjeùNewSds
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
);

1578 
robj
 *
	`hashTy³LookupWr™eOrC»©e
(
ş›Á
 *
c
,„obj *
key
);

1579 
robj
 *
	`hashTy³G‘V®ueObjeù
Ôobj *
o
, 
sds
 
f›ld
);

1580 
	`hashTy³S‘
(
robj
 *
o
, 
sds
 
f›ld
, sd 
v®ue
, 
æags
);

1583 
	`pubsubUnsubsüibeAÎChªÃls
(
ş›Á
 *
c
, 
nÙify
);

1584 
	`pubsubUnsubsüibeAÎP©‹ºs
(
ş›Á
 *
c
, 
nÙify
);

1585 
	`ä“PubsubP©‹º
(*
p
);

1586 
	`li¡M©chPubsubP©‹º
(*
a
, *
b
);

1587 
	`pubsubPublishMes§ge
(
robj
 *
chªÃl
,„obj *
mes§ge
);

1590 
	`nÙifyKey¥aûEv’t
(
ty³
, *
ev’t
, 
robj
 *
key
, 
dbid
);

1591 
	`key¥aûEv’tsSŒšgToFÏgs
(*
şas£s
);

1592 
sds
 
	`key¥aûEv’tsFÏgsToSŒšg
(
æags
);

1595 
	`lßdS”v”CÚfig
(*
f’ame
, *
İtiÚs
);

1596 
	`­³ndS”v”SaveP¬ams
(
time_t
 
£cÚds
, 
chªges
);

1597 
	`»£tS”v”SaveP¬ams
();

1598 
»wr™eCÚfigS‹
;

1599 
	`»wr™eCÚfigRewr™eLše
(
»wr™eCÚfigS‹
 *
¡©e
, cÚ¡ *
İtiÚ
, 
sds
 
lše
, 
fÜû
);

1600 
	`»wr™eCÚfig
(*
·th
);

1603 
	`»moveExpœe
(
»disDb
 *
db
, 
robj
 *
key
);

1604 
	`´İag©eExpœe
(
»disDb
 *
db
, 
robj
 *
key
, 
Ïzy
);

1605 
	`expœeIfN“ded
(
»disDb
 *
db
, 
robj
 *
key
);

1606 
	`g‘Expœe
(
»disDb
 *
db
, 
robj
 *
key
);

1607 
	`£tExpœe
(
»disDb
 *
db
, 
robj
 *
key
, 
wh’
);

1608 
robj
 *
	`lookupKey
(
»disDb
 *
db
,„obj *
key
, 
æags
);

1609 
robj
 *
	`lookupKeyR—d
(
»disDb
 *
db
,„obj *
key
);

1610 
robj
 *
	`lookupKeyWr™e
(
»disDb
 *
db
,„obj *
key
);

1611 
robj
 *
	`lookupKeyR—dOrR•ly
(
ş›Á
 *
c
,„obj *
key
,„obj *
»¶y
);

1612 
robj
 *
	`lookupKeyWr™eOrR•ly
(
ş›Á
 *
c
,„obj *
key
,„obj *
»¶y
);

1613 
robj
 *
	`lookupKeyR—dW™hFÏgs
(
»disDb
 *
db
,„obj *
key
, 
æags
);

1614 
	#LOOKUP_NONE
 0

	)

1615 
	#LOOKUP_NOTOUCH
 (1<<0)

	)

1616 
	`dbAdd
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
);

1617 
	`dbOv”wr™e
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
);

1618 
	`£tKey
(
»disDb
 *
db
, 
robj
 *
key
,„obj *
v®
);

1619 
	`dbExi¡s
(
»disDb
 *
db
, 
robj
 *
key
);

1620 
robj
 *
	`dbRªdomKey
(
»disDb
 *
db
);

1621 
	`dbSyncD–‘e
(
»disDb
 *
db
, 
robj
 *
key
);

1622 
	`dbD–‘e
(
»disDb
 *
db
, 
robj
 *
key
);

1623 
robj
 *
	`dbUnsh¬eSŒšgV®ue
(
»disDb
 *
db
,„obj *
key
,„obj *
o
);

1625 
	#EMPTYDB_NO_FLAGS
 0

	)

1626 
	#EMPTYDB_ASYNC
 (1<<0è

	)

1627 
	`em±yDb
(
dbnum
, 
æags
, (
ÿÎback
)(*));

1629 
	`£ËùDb
(
ş›Á
 *
c
, 
id
);

1630 
	`sigÇlModif›dKey
(
»disDb
 *
db
, 
robj
 *
key
);

1631 
	`sigÇlFlushedDb
(
dbid
);

1632 
	`g‘KeysInSlÙ
(
hash¦Ù
, 
robj
 **
keys
, 
couÁ
);

1633 
	`couÁKeysInSlÙ
(
hash¦Ù
);

1634 
	`d–KeysInSlÙ
(
hash¦Ù
);

1635 
	`v”ifyClu¡”CÚfigW™hD©a
();

1636 
	`sÿnG’”icCommªd
(
ş›Á
 *
c
, 
robj
 *
o
, 
cursÜ
);

1637 
	`·r£SÿnCursÜOrR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, *
cursÜ
);

1638 
	`¦ÙToKeyAdd
(
robj
 *
key
);

1639 
	`¦ÙToKeyD–
(
robj
 *
key
);

1640 
	`¦ÙToKeyFlush
();

1641 
	`dbAsyncD–‘e
(
»disDb
 *
db
, 
robj
 *
key
);

1642 
	`em±yDbAsync
(
»disDb
 *
db
);

1643 
	`¦ÙToKeyFlushAsync
();

1644 
size_t
 
	`Ïzyä“G‘P’dšgObjeùsCouÁ
();

1647 *
	`g‘KeysFromCommªd
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1648 
	`g‘KeysF»eResuÉ
(*
»suÉ
);

1649 *
	`zuniÚIÁ”G‘Keys
(
»disCommªd
 *
cmd
,
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1650 *
	`ev®G‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1651 *
	`sÜtG‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1652 *
	`mig¿‹G‘Keys
(
»disCommªd
 *
cmd
, 
robj
 **
¬gv
, 
¬gc
, *
numkeys
);

1655 
	`şu¡”In™
();

1656 
	`üc16
(cÚ¡ *
buf
, 
Ën
);

1657 
	`keyHashSlÙ
(*
key
, 
keyËn
);

1658 
	`şu¡”CrÚ
();

1659 
	`şu¡”Prİag©ePublish
(
robj
 *
chªÃl
,„obj *
mes§ge
);

1660 
	`mig¿‹Clo£TimedoutSock‘s
();

1661 
	`şu¡”BefÜeSË•
();

1664 
	`š™S’tš–CÚfig
();

1665 
	`š™S’tš–
();

1666 
	`£Áš–Tim”
();

1667 *
	`£Áš–HªdËCÚfigu¿tiÚ
(**
¬gv
, 
¬gc
);

1668 
	`£Áš–IsRuÂšg
();

1671 
	`»dis_check_rdb
(*
rdbf’ame
);

1672 
	`»dis_check_rdb_maš
(
¬gc
, **
¬gv
);

1675 
	`sütšgIn™
(
£tup
);

1676 
	`ldbRemoveChd
(
pid_t
 
pid
);

1677 
	`ldbKlFÜkedSessiÚs
();

1678 
	`ldbP’dšgChd»n
();

1681 
	`´oûssUnblockedCl›Ás
();

1682 
	`blockCl›Á
(
ş›Á
 *
c
, 
bty³
);

1683 
	`unblockCl›Á
(
ş›Á
 *
c
);

1684 
	`»¶yToBlockedCl›ÁTimedOut
(
ş›Á
 *
c
);

1685 
	`g‘TimeoutFromObjeùOrR•ly
(
ş›Á
 *
c
, 
robj
 *
objeù
, 
m¡ime_t
 *
timeout
, 
un™
);

1686 
	`discÚÃùAÎBlockedCl›Ás
();

1689 
	`aùiveExpœeCyşe
(
ty³
);

1692 
	`eviùiÚPoŞAÎoc
();

1693 
	#LFU_INIT_VAL
 5

	)

1694 
	`LFUG‘TimeInMšu‹s
();

1695 
ušt8_t
 
	`LFULogInü
(ušt8_ˆ
v®ue
);

1698 *
	`»disG™SHA1
();

1699 *
	`»disG™Dœty
();

1700 
ušt64_t
 
	`»disBudId
();

1703 
	`authCommªd
(
ş›Á
 *
c
);

1704 
	`pšgCommªd
(
ş›Á
 *
c
);

1705 
	`echoCommªd
(
ş›Á
 *
c
);

1706 
	`commªdCommªd
(
ş›Á
 *
c
);

1707 
	`£tCommªd
(
ş›Á
 *
c
);

1708 
	`£ŠxCommªd
(
ş›Á
 *
c
);

1709 
	`£‹xCommªd
(
ş›Á
 *
c
);

1710 
	`p£‹xCommªd
(
ş›Á
 *
c
);

1711 
	`g‘Commªd
(
ş›Á
 *
c
);

1712 
	`d–Commªd
(
ş›Á
 *
c
);

1713 
	`uÆškCommªd
(
ş›Á
 *
c
);

1714 
	`exi¡sCommªd
(
ş›Á
 *
c
);

1715 
	`£tb™Commªd
(
ş›Á
 *
c
);

1716 
	`g‘b™Commªd
(
ş›Á
 *
c
);

1717 
	`b™f›ldCommªd
(
ş›Á
 *
c
);

1718 
	`£ŒªgeCommªd
(
ş›Á
 *
c
);

1719 
	`g‘¿ngeCommªd
(
ş›Á
 *
c
);

1720 
	`šüCommªd
(
ş›Á
 *
c
);

1721 
	`deüCommªd
(
ş›Á
 *
c
);

1722 
	`šübyCommªd
(
ş›Á
 *
c
);

1723 
	`deübyCommªd
(
ş›Á
 *
c
);

1724 
	`šübyæßtCommªd
(
ş›Á
 *
c
);

1725 
	`£ËùCommªd
(
ş›Á
 *
c
);

1726 
	`¿ndomkeyCommªd
(
ş›Á
 *
c
);

1727 
	`keysCommªd
(
ş›Á
 *
c
);

1728 
	`sÿnCommªd
(
ş›Á
 *
c
);

1729 
	`dbsizeCommªd
(
ş›Á
 *
c
);

1730 
	`Ï¡§veCommªd
(
ş›Á
 *
c
);

1731 
	`§veCommªd
(
ş›Á
 *
c
);

1732 
	`bg§veCommªd
(
ş›Á
 *
c
);

1733 
	`bg»wr™—ofCommªd
(
ş›Á
 *
c
);

1734 
	`shutdownCommªd
(
ş›Á
 *
c
);

1735 
	`moveCommªd
(
ş›Á
 *
c
);

1736 
	`»ÇmeCommªd
(
ş›Á
 *
c
);

1737 
	`»Çm’xCommªd
(
ş›Á
 *
c
);

1738 
	`ÍushCommªd
(
ş›Á
 *
c
);

1739 
	`½ushCommªd
(
ş›Á
 *
c
);

1740 
	`ÍushxCommªd
(
ş›Á
 *
c
);

1741 
	`½ushxCommªd
(
ş›Á
 *
c
);

1742 
	`lš£¹Commªd
(
ş›Á
 *
c
);

1743 
	`ÍİCommªd
(
ş›Á
 *
c
);

1744 
	`½İCommªd
(
ş›Á
 *
c
);

1745 
	`Î’Commªd
(
ş›Á
 *
c
);

1746 
	`lšdexCommªd
(
ş›Á
 *
c
);

1747 
	`ÌªgeCommªd
(
ş›Á
 *
c
);

1748 
	`ÉrimCommªd
(
ş›Á
 *
c
);

1749 
	`ty³Commªd
(
ş›Á
 *
c
);

1750 
	`l£tCommªd
(
ş›Á
 *
c
);

1751 
	`§ddCommªd
(
ş›Á
 *
c
);

1752 
	`¤emCommªd
(
ş›Á
 *
c
);

1753 
	`smoveCommªd
(
ş›Á
 *
c
);

1754 
	`sismemb”Commªd
(
ş›Á
 *
c
);

1755 
	`sÿrdCommªd
(
ş›Á
 *
c
);

1756 
	`¥İCommªd
(
ş›Á
 *
c
);

1757 
	`¤ªdmemb”Commªd
(
ş›Á
 *
c
);

1758 
	`sš‹rCommªd
(
ş›Á
 *
c
);

1759 
	`sš‹r¡ÜeCommªd
(
ş›Á
 *
c
);

1760 
	`suniÚCommªd
(
ş›Á
 *
c
);

1761 
	`suniÚ¡ÜeCommªd
(
ş›Á
 *
c
);

1762 
	`sdiffCommªd
(
ş›Á
 *
c
);

1763 
	`sdiff¡ÜeCommªd
(
ş›Á
 *
c
);

1764 
	`ssÿnCommªd
(
ş›Á
 *
c
);

1765 
	`syncCommªd
(
ş›Á
 *
c
);

1766 
	`æushdbCommªd
(
ş›Á
 *
c
);

1767 
	`æush®lCommªd
(
ş›Á
 *
c
);

1768 
	`sÜtCommªd
(
ş›Á
 *
c
);

1769 
	`ÌemCommªd
(
ş›Á
 *
c
);

1770 
	`½İÍushCommªd
(
ş›Á
 *
c
);

1771 
	`šfoCommªd
(
ş›Á
 *
c
);

1772 
	`mg‘Commªd
(
ş›Á
 *
c
);

1773 
	`mÚ™ÜCommªd
(
ş›Á
 *
c
);

1774 
	`expœeCommªd
(
ş›Á
 *
c
);

1775 
	`expœ—tCommªd
(
ş›Á
 *
c
);

1776 
	`³xpœeCommªd
(
ş›Á
 *
c
);

1777 
	`³xpœ—tCommªd
(
ş›Á
 *
c
);

1778 
	`g‘£tCommªd
(
ş›Á
 *
c
);

1779 
	`‰lCommªd
(
ş›Á
 *
c
);

1780 
	`touchCommªd
(
ş›Á
 *
c
);

1781 
	`±Commªd
(
ş›Á
 *
c
);

1782 
	`³rsi¡Commªd
(
ş›Á
 *
c
);

1783 
	`¦aveofCommªd
(
ş›Á
 *
c
);

1784 
	`rŞeCommªd
(
ş›Á
 *
c
);

1785 
	`debugCommªd
(
ş›Á
 *
c
);

1786 
	`m£tCommªd
(
ş›Á
 *
c
);

1787 
	`m£ŠxCommªd
(
ş›Á
 *
c
);

1788 
	`zaddCommªd
(
ş›Á
 *
c
);

1789 
	`zšübyCommªd
(
ş›Á
 *
c
);

1790 
	`z¿ngeCommªd
(
ş›Á
 *
c
);

1791 
	`z¿ngebyscÜeCommªd
(
ş›Á
 *
c
);

1792 
	`z»v¿ngebyscÜeCommªd
(
ş›Á
 *
c
);

1793 
	`z¿ngebyËxCommªd
(
ş›Á
 *
c
);

1794 
	`z»v¿ngebyËxCommªd
(
ş›Á
 *
c
);

1795 
	`zcouÁCommªd
(
ş›Á
 *
c
);

1796 
	`zËxcouÁCommªd
(
ş›Á
 *
c
);

1797 
	`z»v¿ngeCommªd
(
ş›Á
 *
c
);

1798 
	`zÿrdCommªd
(
ş›Á
 *
c
);

1799 
	`z»mCommªd
(
ş›Á
 *
c
);

1800 
	`zscÜeCommªd
(
ş›Á
 *
c
);

1801 
	`z»m¿ngebyscÜeCommªd
(
ş›Á
 *
c
);

1802 
	`z»m¿ngebyËxCommªd
(
ş›Á
 *
c
);

1803 
	`muÉiCommªd
(
ş›Á
 *
c
);

1804 
	`execCommªd
(
ş›Á
 *
c
);

1805 
	`disÿrdCommªd
(
ş›Á
 *
c
);

1806 
	`bÍİCommªd
(
ş›Á
 *
c
);

1807 
	`b½İCommªd
(
ş›Á
 *
c
);

1808 
	`b½İÍushCommªd
(
ş›Á
 *
c
);

1809 
	`­³ndCommªd
(
ş›Á
 *
c
);

1810 
	`¡¾’Commªd
(
ş›Á
 *
c
);

1811 
	`z¿nkCommªd
(
ş›Á
 *
c
);

1812 
	`z»v¿nkCommªd
(
ş›Á
 *
c
);

1813 
	`h£tCommªd
(
ş›Á
 *
c
);

1814 
	`h£ŠxCommªd
(
ş›Á
 *
c
);

1815 
	`hg‘Commªd
(
ş›Á
 *
c
);

1816 
	`hm£tCommªd
(
ş›Á
 *
c
);

1817 
	`hmg‘Commªd
(
ş›Á
 *
c
);

1818 
	`hd–Commªd
(
ş›Á
 *
c
);

1819 
	`hËnCommªd
(
ş›Á
 *
c
);

1820 
	`h¡¾’Commªd
(
ş›Á
 *
c
);

1821 
	`z»m¿ngeby¿nkCommªd
(
ş›Á
 *
c
);

1822 
	`zuniÚ¡ÜeCommªd
(
ş›Á
 *
c
);

1823 
	`zš‹r¡ÜeCommªd
(
ş›Á
 *
c
);

1824 
	`zsÿnCommªd
(
ş›Á
 *
c
);

1825 
	`hkeysCommªd
(
ş›Á
 *
c
);

1826 
	`hv®sCommªd
(
ş›Á
 *
c
);

1827 
	`hg‘®lCommªd
(
ş›Á
 *
c
);

1828 
	`hexi¡sCommªd
(
ş›Á
 *
c
);

1829 
	`hsÿnCommªd
(
ş›Á
 *
c
);

1830 
	`cÚfigCommªd
(
ş›Á
 *
c
);

1831 
	`hšübyCommªd
(
ş›Á
 *
c
);

1832 
	`hšübyæßtCommªd
(
ş›Á
 *
c
);

1833 
	`subsüibeCommªd
(
ş›Á
 *
c
);

1834 
	`unsubsüibeCommªd
(
ş›Á
 *
c
);

1835 
	`psubsüibeCommªd
(
ş›Á
 *
c
);

1836 
	`punsubsüibeCommªd
(
ş›Á
 *
c
);

1837 
	`publishCommªd
(
ş›Á
 *
c
);

1838 
	`pubsubCommªd
(
ş›Á
 *
c
);

1839 
	`w©chCommªd
(
ş›Á
 *
c
);

1840 
	`unw©chCommªd
(
ş›Á
 *
c
);

1841 
	`şu¡”Commªd
(
ş›Á
 *
c
);

1842 
	`»¡ÜeCommªd
(
ş›Á
 *
c
);

1843 
	`mig¿‹Commªd
(
ş›Á
 *
c
);

1844 
	`askšgCommªd
(
ş›Á
 *
c
);

1845 
	`»adÚlyCommªd
(
ş›Á
 *
c
);

1846 
	`»adwr™eCommªd
(
ş›Á
 *
c
);

1847 
	`dumpCommªd
(
ş›Á
 *
c
);

1848 
	`objeùCommªd
(
ş›Á
 *
c
);

1849 
	`memÜyCommªd
(
ş›Á
 *
c
);

1850 
	`ş›ÁCommªd
(
ş›Á
 *
c
);

1851 
	`ev®Commªd
(
ş›Á
 *
c
);

1852 
	`ev®ShaCommªd
(
ş›Á
 *
c
);

1853 
	`sütCommªd
(
ş›Á
 *
c
);

1854 
	`timeCommªd
(
ş›Á
 *
c
);

1855 
	`b™İCommªd
(
ş›Á
 *
c
);

1856 
	`b™couÁCommªd
(
ş›Á
 *
c
);

1857 
	`b™posCommªd
(
ş›Á
 *
c
);

1858 
	`»¶cÚfCommªd
(
ş›Á
 *
c
);

1859 
	`wa™Commªd
(
ş›Á
 *
c
);

1860 
	`geÛncodeCommªd
(
ş›Á
 *
c
);

1861 
	`geodecodeCommªd
(
ş›Á
 *
c
);

1862 
	`geÜadiusByMemb”Commªd
(
ş›Á
 *
c
);

1863 
	`geÜadiusCommªd
(
ş›Á
 *
c
);

1864 
	`geßddCommªd
(
ş›Á
 *
c
);

1865 
	`geohashCommªd
(
ş›Á
 *
c
);

1866 
	`geİosCommªd
(
ş›Á
 *
c
);

1867 
	`geodi¡Commªd
(
ş›Á
 *
c
);

1868 
	`pf£láe¡Commªd
(
ş›Á
 *
c
);

1869 
	`pçddCommªd
(
ş›Á
 *
c
);

1870 
	`pfcouÁCommªd
(
ş›Á
 *
c
);

1871 
	`pfm”geCommªd
(
ş›Á
 *
c
);

1872 
	`pfdebugCommªd
(
ş›Á
 *
c
);

1873 
	`Ï‹ncyCommªd
(
ş›Á
 *
c
);

1874 
	`moduËCommªd
(
ş›Á
 *
c
);

1875 
	`£cur™yW¬nšgCommªd
(
ş›Á
 *
c
);

1877 #ià
	`defšed
(
__GNUC__
)

1878 *
	$ÿÎoc
(
size_t
 
couÁ
, size_ˆ
size
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

1879 
	$ä“
(*
±r
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

1880 *
	$m®loc
(
size_t
 
size
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

1881 *
	$»®loc
(*
±r
, 
size_t
 
size
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

1885 
	`_£rv”As£¹W™hInfo
(cÚ¡ 
ş›Á
 *
c
, cÚ¡ 
robj
 *
o
, cÚ¡ *
e¡r
, cÚ¡ *
fe
, 
lše
);

1886 
	`_£rv”As£¹
(cÚ¡ *
e¡r
, cÚ¡ *
fe
, 
lše
);

1887 
	`_£rv”Pªic
(cÚ¡ *
msg
, cÚ¡ *
fe
, 
lše
);

1888 
	`bugR•ÜtS¹
();

1889 
	`£rv”LogObjeùDebugInfo
(cÚ¡ 
robj
 *
o
);

1890 
	`sig£gvHªdËr
(
sig
, 
sigšfo_t
 *
šfo
, *
£ü‘
);

1891 
sds
 
	`g’RedisInfoSŒšg
(*
£ùiÚ
);

1892 
	`’abËW©chdog
(
³riod
);

1893 
	`di§bËW©chdog
();

1894 
	`w©chdogScheduËSigÇl
(
³riod
);

1895 
	`£rv”LogHexDump
(
Ëv–
, *
desü
, *
v®ue
, 
size_t
 
Ën
);

1896 
	`mem‹¡_´e£rvšg_‹¡
(*
m
, 
size_t
 
by‹s
, 
·s£s
);

1898 
	#»disDebug
(
fmt
, ...) \

1899 
	`´štf
("DEBUG %s:%d > " 
fmt
 "\n", 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
)

	)

1900 
	#»disDebugM¬k
() \

1901 
	`´štf
("-- MARK %s:%d --\n", 
__FILE__
, 
__LINE__
)

	)

	@setproctitle.c

28 #iâdeà
_GNU_SOURCE


29 
	#_GNU_SOURCE


	)

32 
	~<¡ddef.h
>

33 
	~<¡d¬g.h
>

34 
	~<¡dlib.h
>

35 
	~<¡dio.h
>

37 
	~<¡ršg.h
>

39 
	~<”ºo.h
>

41 #ià!
defšed
(
HAVE_SETPROCTITLE
)

42 
	#HAVE_SETPROCTITLE
 (
defšed
 
__N‘BSD__
 || defšed 
__F»eBSD__
 || defšed 
__O³nBSD__
)

	)

46 #ià!
HAVE_SETPROCTITLE


47 #ià(
defšed
 
__lšux
 || defšed 
__APPLE__
)

49 **
’vœÚ
;

53 cÚ¡ *
	m¬g0
;

56 *
	mba£
, *
	m’d
;

59 *
	mnul
;

61 
_BoŞ
 
	m»£t
;

62 
	m”rÜ
;

63 } 
	gSPT
;

66 #iâdeà
SPT_MIN


67 
	#SPT_MIN
(
a
, 
b
è((×è< (b))? (aè: (b))

	)

70 
šlše
 
size_t
 
	$¥t_mš
(
size_t
 
a
, size_ˆ
b
) {

71  
	`SPT_MIN
(
a
, 
b
);

72 
	}
}

79 
	$¥t_ş—»nv
() {

80 #ià
__GLIBC__


81 
	`ş—»nv
();

85 **
’vœÚ
;

86 **
tmp
;

88 ià(!(
tmp
 = 
	`m®loc
( *tmp)))

89  
”ºo
;

91 
tmp
[0] = 
NULL
;

92 
’vœÚ
 = 
tmp
;

96 
	}
}

99 
	$¥t_cİy’v
(*
Şd’v
[]) {

100 **
’vœÚ
;

101 *
eq
;

102 
i
, 
”rÜ
;

104 ià(
’vœÚ
 !ğ
Şd’v
)

107 ià((
”rÜ
 = 
	`¥t_ş—»nv
()))

108 
”rÜ
;

110 
i
 = 0; 
Şd’v
[i]; i++) {

111 ià(!(
eq
 = 
	`¡rchr
(
Şd’v
[
i
], '=')))

114 *
eq
 = '\0';

115 
”rÜ
 = (0 !ğ
	`£‹nv
(
Şd’v
[
i
], 
eq
 + 1, 1))? 
”ºo
 : 0;

116 *
eq
 = '=';

118 ià(
”rÜ
)

119 
”rÜ
;

123 
”rÜ
:

124 
’vœÚ
 = 
Şd’v
;

126  
”rÜ
;

127 
	}
}

130 
	$¥t_cİy¬gs
(
¬gc
, *
¬gv
[]) {

131 *
tmp
;

132 
i
;

134 
i
 = 1; i < 
¬gc
 || (˜>ğ¬gø&& 
¬gv
[i]); i++) {

135 ià(!
¬gv
[
i
])

138 ià(!(
tmp
 = 
	`¡rdup
(
¬gv
[
i
])))

139  
”ºo
;

141 
¬gv
[
i
] = 
tmp
;

145 
	}
}

148 
	$¥t_š™
(
¬gc
, *
¬gv
[]) {

149 **
’vp
 = 
’vœÚ
;

150 *
ba£
, *
’d
, *
nul
, *
tmp
;

151 
i
, 
”rÜ
;

153 ià(!(
ba£
 = 
¬gv
[0]))

156 
nul
 = &
ba£
[
	`¡¾’
(base)];

157 
’d
 = 
nul
 + 1;

159 
i
 = 0; i < 
¬gc
 || (˜>ğ¬gø&& 
¬gv
[i]); i++) {

160 ià(!
¬gv
[
i
] ||‡rgv[i] < 
’d
)

163 
’d
 = 
¬gv
[
i
] + 
	`¡¾’
(argv[i]) + 1;

166 
i
 = 0; 
’vp
[i]; i++) {

167 ià(
’vp
[
i
] < 
’d
)

170 
’d
 = 
’vp
[
i
] + 
	`¡¾’
(envp[i]) + 1;

173 ià(!(
SPT
.
¬g0
 = 
	`¡rdup
(
¬gv
[0])))

174 
sy”r
;

176 #ià
__GLIBC__


177 ià(!(
tmp
 = 
	`¡rdup
(
´og¿m_švoÿtiÚ_Çme
)))

178 
sy”r
;

180 
´og¿m_švoÿtiÚ_Çme
 = 
tmp
;

182 ià(!(
tmp
 = 
	`¡rdup
(
´og¿m_švoÿtiÚ_shÜt_Çme
)))

183 
sy”r
;

185 
´og¿m_švoÿtiÚ_shÜt_Çme
 = 
tmp
;

186 #–ià
__APPLE__


187 ià(!(
tmp
 = 
	`¡rdup
(
	`g‘´ogÇme
())))

188 
sy”r
;

190 
	`£rogÇme
(
tmp
);

194 ià((
”rÜ
 = 
	`¥t_cİy’v
(
’vp
)))

195 
”rÜ
;

197 ià((
”rÜ
 = 
	`¥t_cİy¬gs
(
¬gc
, 
¬gv
)))

198 
”rÜ
;

200 
SPT
.
nul
 =‚ul;

201 
SPT
.
ba£
 = base;

202 
SPT
.
’d
 =ƒnd;

205 
sy”r
:

206 
”rÜ
 = 
”ºo
;

207 
”rÜ
:

208 
SPT
.
”rÜ
 =ƒrror;

209 
	}
}

212 #iâdeà
SPT_MAXTITLE


213 
	#SPT_MAXTITLE
 255

	)

216 
	$£roù™Ë
(cÚ¡ *
fmt
, ...) {

217 
buf
[
SPT_MAXTITLE
 + 1];

218 
va_li¡
 
­
;

219 *
nul
;

220 
Ën
, 
”rÜ
;

222 ià(!
SPT
.
ba£
)

225 ià(
fmt
) {

226 
	`va_¡¬t
(
­
, 
fmt
);

227 
Ën
 = 
	`v¢´štf
(
buf
,  buf, 
fmt
, 
­
);

228 
	`va_’d
(
­
);

230 
Ën
 = 
	`¢´štf
(
buf
,  buf, "%s", 
SPT
.
¬g0
);

233 ià(
Ën
 <= 0)

234 { 
”rÜ
 = 
”ºo
; error; }

236 ià(!
SPT
.
»£t
) {

237 
	`mem£t
(
SPT
.
ba£
, 0, SPT.
’d
 - SPT.base);

238 
SPT
.
»£t
 = 1;

240 
	`mem£t
(
SPT
.
ba£
, 0, 
	`¥t_mš
( 
buf
, SPT.
’d
 - SPT.base));

243 
Ën
 = 
	`¥t_mš
Ö’, s±_mš( 
buf
, 
SPT
.
’d
 - SPT.
ba£
) - 1);

244 
	`memıy
(
SPT
.
ba£
, 
buf
, 
Ën
);

245 
nul
 = &
SPT
.
ba£
[
Ën
];

247 ià(
nul
 < 
SPT
.nul) {

248 *
SPT
.
nul
 = '.';

249 } ià(
nul
 =ğ
SPT
.nuÈ&& &nul[1] < SPT.
’d
) {

250 *
SPT
.
nul
 = ' ';

251 *++
nul
 = '\0';

255 
”rÜ
:

256 
SPT
.
”rÜ
 =ƒrror;

257 
	}
}

	@sha1.c

22 
	#SHA1HANDSOFF


	)

24 
	~<¡dio.h
>

25 
	~<¡ršg.h
>

26 
	~<¡dšt.h
>

27 
	~"sŞ¬isfixes.h
"

28 
	~"sha1.h
"

29 
	~"cÚfig.h
"

31 
	#rŞ
(
v®ue
, 
b™s
è(((v®ueè<< (b™s)è| ((v®ueè>> (32 - (b™s))))

	)

35 #ià
BYTE_ORDER
 =ğ
LITTLE_ENDIAN


36 
	#blk0
(
i
è(
block
->
l
[i] = (
	`rŞ
(block->l[i],24)&0xFF00FF00) \

37 |(
	`rŞ
(
block
->
l
[
i
],8)&0x00FF00FF))

	)

38 #–ià
BYTE_ORDER
 =ğ
BIG_ENDIAN


39 
	#blk0
(
i
è
block
->
l
[i]

	)

43 
	#blk
(
i
è(
block
->
l
[i&15] = 
	`rŞ
(block->l[(i+13)&15]^block->l[(i+8)&15] \

44 ^
block
->
l
[(
i
+2)&15]^block->l[i&15],1))

	)

47 
	#R0
(
v
,
w
,
x
,
y
,
z
,
i
èz+=((w&(x^y))^y)+
	`blk0
(i)+0x5A827999+
	`rŞ
(v,5);wôŞ(w,30);

	)

48 
	#R1
(
v
,
w
,
x
,
y
,
z
,
i
èz+=((w&(x^y))^y)+
	`blk
(i)+0x5A827999+
	`rŞ
(v,5);wôŞ(w,30);

	)

49 
	#R2
(
v
,
w
,
x
,
y
,
z
,
i
èz+=(w^x^y)+
	`blk
(i)+0x6ED9EBA1+
	`rŞ
(v,5);wôŞ(w,30);

	)

50 
	#R3
(
v
,
w
,
x
,
y
,
z
,
i
èz+=(((w|x)&y)|(w&x))+
	`blk
(i)+0x8F1BBCDC+
	`rŞ
(v,5);wôŞ(w,30);

	)

51 
	#R4
(
v
,
w
,
x
,
y
,
z
,
i
èz+=(w^x^y)+
	`blk
(i)+0xCA62C1D6+
	`rŞ
(v,5);wôŞ(w,30);

	)

56 
	$SHA1T¿nsfÜm
(
ušt32_t
 
¡©e
[5], cÚ¡ 
bufãr
[64])

58 
ušt32_t
 
a
, 
b
, 
c
, 
d
, 
e
;

60 
c
[64];

61 
ušt32_t
 
l
[16];

62 } 
	tCHAR64LONG16
;

63 #ifdeà
SHA1HANDSOFF


64 
CHAR64LONG16
 
block
[1];

65 
	`memıy
(
block
, 
bufãr
, 64);

72 
CHAR64LONG16
* 
block
 = (cÚ¡ CHAR64LONG16*)
bufãr
;

75 
a
 = 
¡©e
[0];

76 
b
 = 
¡©e
[1];

77 
c
 = 
¡©e
[2];

78 
d
 = 
¡©e
[3];

79 
e
 = 
¡©e
[4];

81 
	`R0
(
a
,
b
,
c
,
d
,
e
, 0); R0(e,a,b,c,d, 1); R0(d,e,a,b,c, 2); R0(c,d,e,a,b, 3);

82 
	`R0
(
b
,
c
,
d
,
e
,
a
, 4); R0(a,b,c,d,e, 5); R0(e,a,b,c,d, 6); R0(d,e,a,b,c, 7);

83 
	`R0
(
c
,
d
,
e
,
a
,
b
, 8); R0(b,c,d,e,a, 9); R0(a,b,c,d,e,10); R0(e,a,b,c,d,11);

84 
	`R0
(
d
,
e
,
a
,
b
,
c
,12); R0(c,d,e,a,b,13); R0(b,c,d,e,a,14); R0(a,b,c,d,e,15);

85 
	`R1
(
e
,
a
,
b
,
c
,
d
,16); R1(d,e,a,b,c,17); R1(c,d,e,a,b,18); R1(b,c,d,e,a,19);

86 
	`R2
(
a
,
b
,
c
,
d
,
e
,20); R2(e,a,b,c,d,21); R2(d,e,a,b,c,22); R2(c,d,e,a,b,23);

87 
	`R2
(
b
,
c
,
d
,
e
,
a
,24); R2(a,b,c,d,e,25); R2(e,a,b,c,d,26); R2(d,e,a,b,c,27);

88 
	`R2
(
c
,
d
,
e
,
a
,
b
,28); R2(b,c,d,e,a,29); R2(a,b,c,d,e,30); R2(e,a,b,c,d,31);

89 
	`R2
(
d
,
e
,
a
,
b
,
c
,32); R2(c,d,e,a,b,33); R2(b,c,d,e,a,34); R2(a,b,c,d,e,35);

90 
	`R2
(
e
,
a
,
b
,
c
,
d
,36); R2(d,e,a,b,c,37); R2(c,d,e,a,b,38); R2(b,c,d,e,a,39);

91 
	`R3
(
a
,
b
,
c
,
d
,
e
,40); R3(e,a,b,c,d,41); R3(d,e,a,b,c,42); R3(c,d,e,a,b,43);

92 
	`R3
(
b
,
c
,
d
,
e
,
a
,44); R3(a,b,c,d,e,45); R3(e,a,b,c,d,46); R3(d,e,a,b,c,47);

93 
	`R3
(
c
,
d
,
e
,
a
,
b
,48); R3(b,c,d,e,a,49); R3(a,b,c,d,e,50); R3(e,a,b,c,d,51);

94 
	`R3
(
d
,
e
,
a
,
b
,
c
,52); R3(c,d,e,a,b,53); R3(b,c,d,e,a,54); R3(a,b,c,d,e,55);

95 
	`R3
(
e
,
a
,
b
,
c
,
d
,56); R3(d,e,a,b,c,57); R3(c,d,e,a,b,58); R3(b,c,d,e,a,59);

96 
	`R4
(
a
,
b
,
c
,
d
,
e
,60); R4(e,a,b,c,d,61); R4(d,e,a,b,c,62); R4(c,d,e,a,b,63);

97 
	`R4
(
b
,
c
,
d
,
e
,
a
,64); R4(a,b,c,d,e,65); R4(e,a,b,c,d,66); R4(d,e,a,b,c,67);

98 
	`R4
(
c
,
d
,
e
,
a
,
b
,68); R4(b,c,d,e,a,69); R4(a,b,c,d,e,70); R4(e,a,b,c,d,71);

99 
	`R4
(
d
,
e
,
a
,
b
,
c
,72); R4(c,d,e,a,b,73); R4(b,c,d,e,a,74); R4(a,b,c,d,e,75);

100 
	`R4
(
e
,
a
,
b
,
c
,
d
,76); R4(d,e,a,b,c,77); R4(c,d,e,a,b,78); R4(b,c,d,e,a,79);

102 
¡©e
[0] +ğ
a
;

103 
¡©e
[1] +ğ
b
;

104 
¡©e
[2] +ğ
c
;

105 
¡©e
[3] +ğ
d
;

106 
¡©e
[4] +ğ
e
;

108 
a
 = 
b
 = 
c
 = 
d
 = 
e
 = 0;

109 #ifdeà
SHA1HANDSOFF


110 
	`mem£t
(
block
, '\0', (block));

112 
	}
}

117 
	$SHA1In™
(
SHA1_CTX
* 
cÚ‹xt
)

120 
cÚ‹xt
->
¡©e
[0] = 0x67452301;

121 
cÚ‹xt
->
¡©e
[1] = 0xEFCDAB89;

122 
cÚ‹xt
->
¡©e
[2] = 0x98BADCFE;

123 
cÚ‹xt
->
¡©e
[3] = 0x10325476;

124 
cÚ‹xt
->
¡©e
[4] = 0xC3D2E1F0;

125 
cÚ‹xt
->
couÁ
[0] = context->count[1] = 0;

126 
	}
}

131 
	$SHA1Upd©e
(
SHA1_CTX
* 
cÚ‹xt
, cÚ¡ * 
d©a
, 
ušt32_t
 
Ën
)

133 
ušt32_t
 
i
, 
j
;

135 
j
 = 
cÚ‹xt
->
couÁ
[0];

136 ià((
cÚ‹xt
->
couÁ
[0] +ğ
Ën
 << 3è< 
j
)

137 
cÚ‹xt
->
couÁ
[1]++;

138 
cÚ‹xt
->
couÁ
[1] +ğ(
Ën
>>29);

139 
j
 = (j >> 3) & 63;

140 ià((
j
 + 
Ën
) > 63) {

141 
	`memıy
(&
cÚ‹xt
->
bufãr
[
j
], 
d©a
, (
i
 = 64-j));

142 
	`SHA1T¿nsfÜm
(
cÚ‹xt
->
¡©e
, cÚ‹xt->
bufãr
);

143  ; 
i
 + 63 < 
Ën
; i += 64) {

144 
	`SHA1T¿nsfÜm
(
cÚ‹xt
->
¡©e
, &
d©a
[
i
]);

146 
j
 = 0;

148 
i
 = 0;

149 
	`memıy
(&
cÚ‹xt
->
bufãr
[
j
], &
d©a
[
i
], 
Ën
 - i);

150 
	}
}

155 
	$SHA1Fš®
(
dige¡
[20], 
SHA1_CTX
* 
cÚ‹xt
)

157 
i
;

158 
fš®couÁ
[8];

159 
c
;

167 *
fı
 = &
fš®couÁ
[8];

169 
i
 = 0; i < 2; i++)

171 
ušt32_t
 
t
 = 
cÚ‹xt
->
couÁ
[
i
];

172 
j
;

174 
j
 = 0; j < 4; 
t
 >>= 8, j++)

175 *--
fı
 = (è
t
;

178 
i
 = 0; i < 8; i++) {

179 
fš®couÁ
[
i
] = ()((
cÚ‹xt
->
couÁ
[(i >= 4 ? 0 : 1)]

180 >> ((3-(
i
 & 3)) * 8) ) & 255);

183 
c
 = 0200;

184 
	`SHA1Upd©e
(
cÚ‹xt
, &
c
, 1);

185 (
cÚ‹xt
->
couÁ
[0] & 504) != 448) {

186 
c
 = 0000;

187 
	`SHA1Upd©e
(
cÚ‹xt
, &
c
, 1);

189 
	`SHA1Upd©e
(
cÚ‹xt
, 
fš®couÁ
, 8);

190 
i
 = 0; i < 20; i++) {

191 
dige¡
[
i
] = ()

192 ((
cÚ‹xt
->
¡©e
[
i
>>2] >> ((3-(i & 3)) * 8) ) & 255);

195 
	`mem£t
(
cÚ‹xt
, '\0', (*context));

196 
	`mem£t
(&
fš®couÁ
, '\0', (finalcount));

197 
	}
}

200 #ifdeà
REDIS_TEST


201 
	#BUFSIZE
 4096

	)

203 
	#UNUSED
(
x
è()(x)

	)

204 
	$sha1Te¡
(
¬gc
, **
¬gv
)

206 
SHA1_CTX
 
ùx
;

207 
hash
[20], 
buf
[
BUFSIZE
];

208 
i
;

210 
	`UNUSED
(
¬gc
);

211 
	`UNUSED
(
¬gv
);

213 
i
=0;i<
BUFSIZE
;i++)

214 
buf
[
i
] = i;

216 
	`SHA1In™
(&
ùx
);

217 
i
=0;i<1000;i++)

218 
	`SHA1Upd©e
(&
ùx
, 
buf
, 
BUFSIZE
);

219 
	`SHA1Fš®
(
hash
, &
ùx
);

221 
	`´štf
("SHA1=");

222 
i
=0;i<20;i++)

223 
	`´štf
("%02x", 
hash
[
i
]);

224 
	`´štf
("\n");

226 
	}
}

	@sha1.h

1 #iâdeà
SHA1_H


2 
	#SHA1_H


	)

11 
ušt32_t
 
	m¡©e
[5];

12 
ušt32_t
 
	mcouÁ
[2];

13 
	mbufãr
[64];

14 } 
	tSHA1_CTX
;

16 
SHA1T¿nsfÜm
(
ušt32_t
 
¡©e
[5], cÚ¡ 
bufãr
[64]);

17 
SHA1In™
(
SHA1_CTX
* 
cÚ‹xt
);

18 
SHA1Upd©e
(
SHA1_CTX
* 
cÚ‹xt
, cÚ¡ * 
d©a
, 
ušt32_t
 
Ën
);

19 
SHA1Fš®
(
dige¡
[20], 
SHA1_CTX
* 
cÚ‹xt
);

21 #ifdeà
REDIS_TEST


22 
sha1Te¡
(
¬gc
, **
¬gv
);

	@slowlog.c

42 
	~"£rv”.h
"

43 
	~"¦owlog.h
"

48 
¦owlogEÁry
 *
	$¦owlogC»©eEÁry
(
robj
 **
¬gv
, 
¬gc
, 
du¿tiÚ
) {

49 
¦owlogEÁry
 *
£
 = 
	`zm®loc
((*se));

50 
j
, 
¦¬gc
 = 
¬gc
;

52 ià(
¦¬gc
 > 
SLOWLOG_ENTRY_MAX_ARGC
) slargc = SLOWLOG_ENTRY_MAX_ARGC;

53 
£
->
¬gc
 = 
¦¬gc
;

54 
£
->
¬gv
 = 
	`zm®loc
((
robj
*)*
¦¬gc
);

55 
j
 = 0; j < 
¦¬gc
; j++) {

59 ià(
¦¬gc
 !ğ
¬gc
 && 
j
 == slargc-1) {

60 
£
->
¬gv
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,

61 
	`sdsÿrštf
(
	`sd£m±y
(),"... (%d more‡rguments)",

62 
¬gc
-
¦¬gc
+1));

65 ià(
¬gv
[
j
]->
ty³
 =ğ
OBJ_STRING
 &&

66 
	`sdsEncodedObjeù
(
¬gv
[
j
]) &&

67 
	`sd¦’
(
¬gv
[
j
]->
±r
è> 
SLOWLOG_ENTRY_MAX_STRING
)

69 
sds
 
s
 = 
	`sd¢ewËn
(
¬gv
[
j
]->
±r
, 
SLOWLOG_ENTRY_MAX_STRING
);

71 
s
 = 
	`sdsÿrštf
(s,"... (%lu more bytes)",

73 
	`sd¦’
(
¬gv
[
j
]->
±r
è- 
SLOWLOG_ENTRY_MAX_STRING
);

74 
£
->
¬gv
[
j
] = 
	`ü—‹Objeù
(
OBJ_STRING
,
s
);

76 
£
->
¬gv
[
j
] =‡rgv[j];

77 
	`šüRefCouÁ
(
¬gv
[
j
]);

81 
£
->
time
 = 
	`time
(
NULL
);

82 
£
->
du¿tiÚ
 = duration;

83 
£
->
id
 = 
£rv”
.
¦owlog_’Œy_id
++;

84  
£
;

85 
	}
}

91 
	$¦owlogF»eEÁry
(*
£±r
) {

92 
¦owlogEÁry
 *
£
 = 
£±r
;

93 
j
;

95 
j
 = 0; j < 
£
->
¬gc
; j++)

96 
	`deüRefCouÁ
(
£
->
¬gv
[
j
]);

97 
	`zä“
(
£
->
¬gv
);

98 
	`zä“
(
£
);

99 
	}
}

103 
	$¦owlogIn™
() {

104 
£rv”
.
¦owlog
 = 
	`li¡C»©e
();

105 
£rv”
.
¦owlog_’Œy_id
 = 0;

106 
	`li¡S‘F»eM‘hod
(
£rv”
.
¦owlog
,
¦owlogF»eEÁry
);

107 
	}
}

112 
	$¦owlogPushEÁryIfN“ded
(
robj
 **
¬gv
, 
¬gc
, 
du¿tiÚ
) {

113 ià(
£rv”
.
¦owlog_log_¦ow”_thª
 < 0) ;

114 ià(
du¿tiÚ
 >ğ
£rv”
.
¦owlog_log_¦ow”_thª
)

115 
	`li¡AddNodeH—d
(
£rv”
.
¦owlog
,
	`¦owlogC»©eEÁry
(
¬gv
,
¬gc
,
du¿tiÚ
));

118 
	`li¡L’gth
(
£rv”
.
¦owlog
è> s”v”.
¦owlog_max_Ën
)

119 
	`li¡D–Node
(
£rv”
.
¦owlog
,
	`li¡La¡
(server.slowlog));

120 
	}
}

123 
	$¦owlogRe£t
() {

124 
	`li¡L’gth
(
£rv”
.
¦owlog
) > 0)

125 
	`li¡D–Node
(
£rv”
.
¦owlog
,
	`li¡La¡
(server.slowlog));

126 
	}
}

130 
	$¦owlogCommªd
(
ş›Á
 *
c
) {

131 ià(
c
->
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"reset")) {

132 
	`¦owlogRe£t
();

133 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

134 } ià(
c
->
¬gc
 =ğ2 && !
	`¡rÿ£cmp
(c->
¬gv
[1]->
±r
,"len")) {

135 
	`addR•lyLÚgLÚg
(
c
,
	`li¡L’gth
(
£rv”
.
¦owlog
));

136 } ià((
c
->
¬gc
 == 2 || c->argc == 3) &&

137 !
	`¡rÿ£cmp
(
c
->
¬gv
[1]->
±r
,"get"))

139 
couÁ
 = 10, 
£Á
 = 0;

140 
li¡I‹r
 
li
;

141 *
tÙ’Œ›s
;

142 
li¡Node
 *
Ê
;

143 
¦owlogEÁry
 *
£
;

145 ià(
c
->
¬gc
 == 3 &&

146 
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
couÁ
,
NULL
è!ğ
C_OK
)

149 
	`li¡Rewšd
(
£rv”
.
¦owlog
,&
li
);

150 
tÙ’Œ›s
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

151 
couÁ
-- && (
Ê
 = 
	`li¡Next
(&
li
))) {

152 
j
;

154 
£
 = 
Ê
->
v®ue
;

155 
	`addR•lyMuÉiBulkL’
(
c
,4);

156 
	`addR•lyLÚgLÚg
(
c
,
£
->
id
);

157 
	`addR•lyLÚgLÚg
(
c
,
£
->
time
);

158 
	`addR•lyLÚgLÚg
(
c
,
£
->
du¿tiÚ
);

159 
	`addR•lyMuÉiBulkL’
(
c
,
£
->
¬gc
);

160 
j
 = 0; j < 
£
->
¬gc
; j++)

161 
	`addR•lyBulk
(
c
,
£
->
¬gv
[
j
]);

162 
£Á
++;

164 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
tÙ’Œ›s
,
£Á
);

166 
	`addR•lyE¼Ü
(
c
,

169 
	}
}

	@slowlog.h

30 
	#SLOWLOG_ENTRY_MAX_ARGC
 32

	)

31 
	#SLOWLOG_ENTRY_MAX_STRING
 128

	)

34 
	s¦owlogEÁry
 {

35 
robj
 **
	m¬gv
;

36 
	m¬gc
;

37 
	mid
;

38 
	mdu¿tiÚ
;

39 
time_t
 
	mtime
;

40 } 
	t¦owlogEÁry
;

43 
¦owlogIn™
();

44 
¦owlogPushEÁryIfN“ded
(
robj
 **
¬gv
, 
¬gc
, 
du¿tiÚ
);

47 
¦owlogCommªd
(
ş›Á
 *
c
);

	@solarisfixes.h

31 #ià
defšed
(
__sun
)

33 #ià
defšed
(
__GNUC__
)

34 
	~<m©h.h
>

35 #undeà
i¢ª


36 
	#i¢ª
(
x
) \

37 
	`__ex‹nsiÚ__
({ 
	`__ty³of
 (
x
è
__x_a
 = (x); \

38 
	`__butš_ex³ù
(
__x_a
 !ğ__x_a, 0); })

	)

40 #undeà
isfš™e


41 
	#isfš™e
(
x
) \

42 
	`__ex‹nsiÚ__
 ({ 
	`__ty³of
 (
x
è
__x_f
 = (x); \

43 
	`__butš_ex³ù
(!
	`i¢ª
(
__x_f
 - __x_f), 1); })

	)

45 #undeà
isšf


46 
	#isšf
(
x
) \

47 
	`__ex‹nsiÚ__
 ({ 
	`__ty³of
 (
x
è
__x_i
 = (x); \

48 
	`__butš_ex³ù
(!
	`i¢ª
(
__x_i
è&& !
	`isfš™e
(__x_i), 0); })

	)

50 
	#u_št
 
ušt


	)

51 
	#u_št32_t
 
ušt32_t


	)

	@sort.c

32 
	~"£rv”.h
"

33 
	~"pqsÜt.h
"

34 
	~<m©h.h
>

36 
zskli¡Node
* 
z¦G‘EËm’tByRªk
(
zskli¡
 *
z¦
, 
¿nk
);

38 
»disSÜtO³¿tiÚ
 *
	$ü—‹SÜtO³¿tiÚ
(
ty³
, 
robj
 *
·‰”n
) {

39 
»disSÜtO³¿tiÚ
 *
so
 = 
	`zm®loc
((*so));

40 
so
->
ty³
 =ype;

41 
so
->
·‰”n
 =…attern;

42  
so
;

43 
	}
}

61 
robj
 *
	$lookupKeyByP©‹º
(
»disDb
 *
db
, 
robj
 *
·‰”n
,„obj *
sub¡
) {

62 *
p
, *
f
, *
k
;

63 
sds
 
¥©
, 
ssub
;

64 
robj
 *
keyobj
, *
f›ldobj
 = 
NULL
, *
o
;

65 
´efixËn
, 
subËn
, 
po¡fixËn
, 
f›ldËn
;

69 
¥©
 = 
·‰”n
->
±r
;

70 ià(
¥©
[0] == '#' && spat[1] == '\0') {

71 
	`šüRefCouÁ
(
sub¡
);

72  
sub¡
;

78 
sub¡
 = 
	`g‘DecodedObjeù
(subst);

79 
ssub
 = 
sub¡
->
±r
;

83 
p
 = 
	`¡rchr
(
¥©
,'*');

84 ià(!
p
) {

85 
	`deüRefCouÁ
(
sub¡
);

86  
NULL
;

90 ià((
f
 = 
	`¡r¡r
(
p
+1, "->")è!ğ
NULL
 && *(f+2) != '\0') {

91 
f›ldËn
 = 
	`sd¦’
(
¥©
)-(
f
-spat)-2;

92 
f›ldobj
 = 
	`ü—‹SŒšgObjeù
(
f
+2,
f›ldËn
);

94 
f›ldËn
 = 0;

98 
´efixËn
 = 
p
-
¥©
;

99 
subËn
 = 
	`sd¦’
(
ssub
);

100 
po¡fixËn
 = 
	`sd¦’
(
¥©
)-(
´efixËn
+1)-(
f›ldËn
 ? fieldlen+2 : 0);

101 
keyobj
 = 
	`ü—‹SŒšgObjeù
(
NULL
,
´efixËn
+
subËn
+
po¡fixËn
);

102 
k
 = 
keyobj
->
±r
;

103 
	`memıy
(
k
,
¥©
,
´efixËn
);

104 
	`memıy
(
k
+
´efixËn
,
ssub
,
subËn
);

105 
	`memıy
(
k
+
´efixËn
+
subËn
,
p
+1,
po¡fixËn
);

106 
	`deüRefCouÁ
(
sub¡
);

109 
o
 = 
	`lookupKeyR—d
(
db
,
keyobj
);

110 ià(
o
 =ğ
NULL
è
noobj
;

112 ià(
f›ldobj
) {

113 ià(
o
->
ty³
 !ğ
OBJ_HASH
è
noobj
;

117 
o
 = 
	`hashTy³G‘V®ueObjeù
(o, 
f›ldobj
->
±r
);

119 ià(
o
->
ty³
 !ğ
OBJ_STRING
è
noobj
;

123 
	`šüRefCouÁ
(
o
);

125 
	`deüRefCouÁ
(
keyobj
);

126 ià(
f›ldobj
è
	`deüRefCouÁ
(fieldobj);

127  
o
;

129 
noobj
:

130 
	`deüRefCouÁ
(
keyobj
);

131 ià(
f›ldËn
è
	`deüRefCouÁ
(
f›ldobj
);

132  
NULL
;

133 
	}
}

138 
	$sÜtCom·»
(cÚ¡ *
s1
, cÚ¡ *
s2
) {

139 cÚ¡ 
»disSÜtObjeù
 *
so1
 = 
s1
, *
so2
 = 
s2
;

140 
cmp
;

142 ià(!
£rv”
.
sÜt_®pha
) {

144 ià(
so1
->
u
.
scÜe
 > 
so2
->u.score) {

145 
cmp
 = 1;

146 } ià(
so1
->
u
.
scÜe
 < 
so2
->u.score) {

147 
cmp
 = -1;

152 
cmp
 = 
	`com·»SŒšgObjeùs
(
so1
->
obj
,
so2
->obj);

156 ià(
£rv”
.
sÜt_by·‰”n
) {

157 ià(!
so1
->
u
.
cmpobj
 || !
so2
->u.cmpobj) {

159 ià(
so1
->
u
.
cmpobj
 =ğ
so2
->u.cmpobj)

160 
cmp
 = 0;

161 ià(
so1
->
u
.
cmpobj
 =ğ
NULL
)

162 
cmp
 = -1;

164 
cmp
 = 1;

167 ià(
£rv”
.
sÜt_¡Üe
) {

168 
cmp
 = 
	`com·»SŒšgObjeùs
(
so1
->
u
.
cmpobj
,
so2
->u.cmpobj);

172 
cmp
 = 
	`¡rcŞl
(
so1
->
u
.
cmpobj
->
±r
,
so2
->u.cmpobj->ptr);

177 ià(
£rv”
.
sÜt_¡Üe
) {

178 
cmp
 = 
	`com·»SŒšgObjeùs
(
so1
->
obj
,
so2
->obj);

180 
cmp
 = 
	`cŞÏ‹SŒšgObjeùs
(
so1
->
obj
,
so2
->obj);

184  
£rv”
.
sÜt_desc
 ? -
cmp
 : cmp;

185 
	}
}

189 
	$sÜtCommªd
(
ş›Á
 *
c
) {

190 
li¡
 *
İ”©iÚs
;

191 
ouu’
 = 0;

192 
desc
 = 0, 
®pha
 = 0;

193 
lim™_¡¬t
 = 0, 
lim™_couÁ
 = -1, 
¡¬t
, 
’d
;

194 
j
, 
dÚtsÜt
 = 0, 
veùÜËn
;

195 
g‘İ
 = 0;

196 
št_cÚv”tiÚ_”rÜ
 = 0;

197 
syÁax_”rÜ
 = 0;

198 
robj
 *
sÜtv®
, *
sÜtby
 = 
NULL
, *
¡Üekey
 = NULL;

199 
»disSÜtObjeù
 *
veùÜ
;

202 
sÜtv®
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[1]);

203 ià(
sÜtv®
 && sÜtv®->
ty³
 !ğ
OBJ_SET
 &&

204 
sÜtv®
->
ty³
 !ğ
OBJ_LIST
 &&

205 
sÜtv®
->
ty³
 !ğ
OBJ_ZSET
)

207 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

213 
İ”©iÚs
 = 
	`li¡C»©e
();

214 
	`li¡S‘F»eM‘hod
(
İ”©iÚs
,
zä“
);

215 
j
 = 2;

220 ià(
sÜtv®
)

221 
	`šüRefCouÁ
(
sÜtv®
);

223 
sÜtv®
 = 
	`ü—‹Quickli¡Objeù
();

226 
j
 < 
c
->
¬gc
) {

227 
Ëá¬gs
 = 
c
->
¬gc
-
j
-1;

228 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"asc")) {

229 
desc
 = 0;

230 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"desc")) {

231 
desc
 = 1;

232 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"alpha")) {

233 
®pha
 = 1;

234 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"lim™"è&& 
Ëá¬gs
 >= 2) {

235 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
j
+1], &
lim™_¡¬t
, 
NULL
)

236 !ğ
C_OK
) ||

237 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
j
+2], &
lim™_couÁ
, 
NULL
)

238 !ğ
C_OK
))

240 
syÁax_”rÜ
++;

243 
j
+=2;

244 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"¡Üe"è&& 
Ëá¬gs
 >= 1) {

245 
¡Üekey
 = 
c
->
¬gv
[
j
+1];

246 
j
++;

247 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"by"è&& 
Ëá¬gs
 >= 1) {

248 
sÜtby
 = 
c
->
¬gv
[
j
+1];

251 ià(
	`¡rchr
(
c
->
¬gv
[
j
+1]->
±r
,'*'è=ğ
NULL
) {

252 
dÚtsÜt
 = 1;

256 ià(
£rv”
.
şu¡”_’abËd
) {

257 
	`addR•lyE¼Ü
(
c
,"BY option of SORT denied in Cluster mode.");

258 
syÁax_”rÜ
++;

262 
j
++;

263 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"g‘"è&& 
Ëá¬gs
 >= 1) {

264 ià(
£rv”
.
şu¡”_’abËd
) {

265 
	`addR•lyE¼Ü
(
c
,"GET option of SORT denied in Cluster mode.");

266 
syÁax_”rÜ
++;

269 
	`li¡AddNodeTa
(
İ”©iÚs
,
	`ü—‹SÜtO³¿tiÚ
(

270 
SORT_OP_GET
,
c
->
¬gv
[
j
+1]));

271 
g‘İ
++;

272 
j
++;

274 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

275 
syÁax_”rÜ
++;

278 
j
++;

282 ià(
syÁax_”rÜ
) {

283 
	`deüRefCouÁ
(
sÜtv®
);

284 
	`li¡R–—£
(
İ”©iÚs
);

294 ià(
dÚtsÜt
 &&

295 
sÜtv®
->
ty³
 =ğ
OBJ_SET
 &&

296 (
¡Üekey
 || 
c
->
æags
 & 
CLIENT_LUA
))

299 
dÚtsÜt
 = 0;

300 
®pha
 = 1;

301 
sÜtby
 = 
NULL
;

305 ià(
sÜtv®
->
ty³
 =ğ
OBJ_ZSET
)

306 
	`z£tCÚv”t
(
sÜtv®
, 
OBJ_ENCODING_SKIPLIST
);

309 
sÜtv®
->
ty³
) {

310 
OBJ_LIST
: 
veùÜËn
 = 
	`li¡Ty³L’gth
(
sÜtv®
); ;

311 
OBJ_SET
: 
veùÜËn
 = 
	`£tTy³Size
(
sÜtv®
); ;

312 
OBJ_ZSET
: 
veùÜËn
 = 
	`diùSize
(((
z£t
*)
sÜtv®
->
±r
)->
diù
); ;

313 : 
veùÜËn
 = 0; 
	`£rv”Pªic
("Bad SORType");

317 
¡¬t
 = (
lim™_¡¬t
 < 0) ? 0 :†imit_start;

318 
’d
 = (
lim™_couÁ
 < 0è? 
veùÜËn
-1 : 
¡¬t
+limit_count-1;

319 ià(
¡¬t
 >ğ
veùÜËn
) {

320 
¡¬t
 = 
veùÜËn
-1;

321 
’d
 = 
veùÜËn
-2;

323 ià(
’d
 >ğ
veùÜËn
)ƒnd = vectorlen-1;

335 ià((
sÜtv®
->
ty³
 =ğ
OBJ_ZSET
 || sÜtv®->ty³ =ğ
OBJ_LIST
) &&

336 
dÚtsÜt
 &&

337 (
¡¬t
 !ğ0 || 
’d
 !ğ
veùÜËn
-1))

339 
veùÜËn
 = 
’d
-
¡¬t
+1;

343 
veùÜ
 = 
	`zm®loc
((
»disSÜtObjeù
)*
veùÜËn
);

344 
j
 = 0;

346 ià(
sÜtv®
->
ty³
 =ğ
OBJ_LIST
 && 
dÚtsÜt
) {

353 ià(
’d
 >ğ
¡¬t
) {

354 
li¡Ty³I‹¿tÜ
 *
li
;

355 
li¡Ty³EÁry
 
’Œy
;

356 
li
 = 
	`li¡Ty³In™I‹¿tÜ
(
sÜtv®
,

357 
desc
 ? ()(
	`li¡Ty³L’gth
(
sÜtv®
è- 
¡¬t
 - 1) : start,

358 
desc
 ? 
LIST_HEAD
 : 
LIST_TAIL
);

360 
j
 < 
veùÜËn
 && 
	`li¡Ty³Next
(
li
,&
’Œy
)) {

361 
veùÜ
[
j
].
obj
 = 
	`li¡Ty³G‘
(&
’Œy
);

362 
veùÜ
[
j
].
u
.
scÜe
 = 0;

363 
veùÜ
[
j
].
u
.
cmpobj
 = 
NULL
;

364 
j
++;

366 
	`li¡Ty³R–—£I‹¿tÜ
(
li
);

368 
’d
 -ğ
¡¬t
;

369 
¡¬t
 = 0;

371 } ià(
sÜtv®
->
ty³
 =ğ
OBJ_LIST
) {

372 
li¡Ty³I‹¿tÜ
 *
li
 = 
	`li¡Ty³In™I‹¿tÜ
(
sÜtv®
,0,
LIST_TAIL
);

373 
li¡Ty³EÁry
 
’Œy
;

374 
	`li¡Ty³Next
(
li
,&
’Œy
)) {

375 
veùÜ
[
j
].
obj
 = 
	`li¡Ty³G‘
(&
’Œy
);

376 
veùÜ
[
j
].
u
.
scÜe
 = 0;

377 
veùÜ
[
j
].
u
.
cmpobj
 = 
NULL
;

378 
j
++;

380 
	`li¡Ty³R–—£I‹¿tÜ
(
li
);

381 } ià(
sÜtv®
->
ty³
 =ğ
OBJ_SET
) {

382 
£tTy³I‹¿tÜ
 *
si
 = 
	`£tTy³In™I‹¿tÜ
(
sÜtv®
);

383 
sds
 
sd£Ë
;

384 (
sd£Ë
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

385 
veùÜ
[
j
].
obj
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
sd£Ë
);

386 
veùÜ
[
j
].
u
.
scÜe
 = 0;

387 
veùÜ
[
j
].
u
.
cmpobj
 = 
NULL
;

388 
j
++;

390 
	`£tTy³R–—£I‹¿tÜ
(
si
);

391 } ià(
sÜtv®
->
ty³
 =ğ
OBJ_ZSET
 && 
dÚtsÜt
) {

399 
z£t
 *
zs
 = 
sÜtv®
->
±r
;

400 
zskli¡
 *
z¦
 = 
zs
->zsl;

401 
zskli¡Node
 *
Ê
;

402 
sds
 
sd£Ë
;

403 
¿ng–’
 = 
veùÜËn
;

406 ià(
desc
) {

407 
z£’
 = 
	`diùSize
(((
z£t
*)
sÜtv®
->
±r
)->
diù
);

409 
Ê
 = 
z¦
->

;

410 ià(
¡¬t
 > 0)

411 
Ê
 = 
	`z¦G‘EËm’tByRªk
(
z¦
,
z£’
-
¡¬t
);

413 
Ê
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

414 ià(
¡¬t
 > 0)

415 
Ê
 = 
	`z¦G‘EËm’tByRªk
(
z¦
,
¡¬t
+1);

418 
¿ng–’
--) {

419 
	`£rv”As£¹W™hInfo
(
c
,
sÜtv®
,
Ê
 !ğ
NULL
);

420 
sd£Ë
 = 
Ê
->
–e
;

421 
veùÜ
[
j
].
obj
 = 
	`ü—‹SŒšgObjeù
(
sd£Ë
,
	`sd¦’
(sdsele));

422 
veùÜ
[
j
].
u
.
scÜe
 = 0;

423 
veùÜ
[
j
].
u
.
cmpobj
 = 
NULL
;

424 
j
++;

425 
Ê
 = 
desc
 ?†n->
backw¬d
 :†n->
Ëv–
[0].
fÜw¬d
;

428 
’d
 -ğ
¡¬t
;

429 
¡¬t
 = 0;

430 } ià(
sÜtv®
->
ty³
 =ğ
OBJ_ZSET
) {

431 
diù
 *
£t
 = ((
z£t
*)
sÜtv®
->
±r
)->dict;

432 
diùI‹¿tÜ
 *
di
;

433 
diùEÁry
 *
£‹Ë
;

434 
sds
 
sd£Ë
;

435 
di
 = 
	`diùG‘I‹¿tÜ
(
£t
);

436 (
£‹Ë
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

437 
sd£Ë
 = 
	`diùG‘Key
(
£‹Ë
);

438 
veùÜ
[
j
].
obj
 = 
	`ü—‹SŒšgObjeù
(
sd£Ë
,
	`sd¦’
(sdsele));

439 
veùÜ
[
j
].
u
.
scÜe
 = 0;

440 
veùÜ
[
j
].
u
.
cmpobj
 = 
NULL
;

441 
j
++;

443 
	`diùR–—£I‹¿tÜ
(
di
);

445 
	`£rv”Pªic
("Unknownype");

447 
	`£rv”As£¹W™hInfo
(
c
,
sÜtv®
,
j
 =ğ
veùÜËn
);

450 ià(
dÚtsÜt
 == 0) {

451 
j
 = 0; j < 
veùÜËn
; j++) {

452 
robj
 *
byv®
;

453 ià(
sÜtby
) {

455 
byv®
 = 
	`lookupKeyByP©‹º
(
c
->
db
,
sÜtby
,
veùÜ
[
j
].
obj
);

456 ià(!
byv®
) ;

459 
byv®
 = 
veùÜ
[
j
].
obj
;

462 ià(
®pha
) {

463 ià(
sÜtby
è
veùÜ
[
j
].
u
.
cmpobj
 = 
	`g‘DecodedObjeù
(
byv®
);

465 ià(
	`sdsEncodedObjeù
(
byv®
)) {

466 *
•Œ
;

468 
veùÜ
[
j
].
u
.
scÜe
 = 
	`¡¹od
(
byv®
->
±r
,&
•Œ
);

469 ià(
•Œ
[0] !ğ'\0' || 
”ºo
 =ğ
ERANGE
 ||

470 
	`i¢ª
(
veùÜ
[
j
].
u
.
scÜe
))

472 
št_cÚv”tiÚ_”rÜ
 = 1;

474 } ià(
byv®
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

478 
veùÜ
[
j
].
u
.
scÜe
 = ()
byv®
->
±r
;

480 
	`£rv”As£¹W™hInfo
(
c
,
sÜtv®
,1 != 1);

486 ià(
sÜtby
) {

487 
	`deüRefCouÁ
(
byv®
);

492 ià(
dÚtsÜt
 == 0) {

493 
£rv”
.
sÜt_desc
 = 
desc
;

494 
£rv”
.
sÜt_®pha
 = 
®pha
;

495 
£rv”
.
sÜt_by·‰”n
 = 
sÜtby
 ? 1 : 0;

496 
£rv”
.
sÜt_¡Üe
 = 
¡Üekey
 ? 1 : 0;

497 ià(
sÜtby
 && (
¡¬t
 !ğ0 || 
’d
 !ğ
veùÜËn
-1))

498 
	`pqsÜt
(
veùÜ
,
veùÜËn
,(
»disSÜtObjeù
),
sÜtCom·»
, 
¡¬t
,
’d
);

500 
	`qsÜt
(
veùÜ
,
veùÜËn
,(
»disSÜtObjeù
),
sÜtCom·»
);

505 
ouu’
 = 
g‘İ
 ? g‘İ*(
’d
-
¡¬t
+1) :ƒnd-start+1;

506 ià(
št_cÚv”tiÚ_”rÜ
) {

507 
	`addR•lyE¼Ü
(
c
,"One or more scores can't be converted into double");

508 } ià(
¡Üekey
 =ğ
NULL
) {

510 
	`addR•lyMuÉiBulkL’
(
c
,
ouu’
);

511 
j
 = 
¡¬t
; j <ğ
’d
; j++) {

512 
li¡Node
 *
Ê
;

513 
li¡I‹r
 
li
;

515 ià(!
g‘İ
è
	`addR•lyBulk
(
c
,
veùÜ
[
j
].
obj
);

516 
	`li¡Rewšd
(
İ”©iÚs
,&
li
);

517 (
Ê
 = 
	`li¡Next
(&
li
))) {

518 
»disSÜtO³¿tiÚ
 *
sİ
 = 
Ê
->
v®ue
;

519 
robj
 *
v®
 = 
	`lookupKeyByP©‹º
(
c
->
db
,
sİ
->
·‰”n
,

520 
veùÜ
[
j
].
obj
);

522 ià(
sİ
->
ty³
 =ğ
SORT_OP_GET
) {

523 ià(!
v®
) {

524 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

526 
	`addR•lyBulk
(
c
,
v®
);

527 
	`deüRefCouÁ
(
v®
);

531 
	`£rv”As£¹W™hInfo
(
c
,
sÜtv®
,
sİ
->
ty³
 =ğ
SORT_OP_GET
);

536 
robj
 *
sobj
 = 
	`ü—‹Quickli¡Objeù
();

539 
j
 = 
¡¬t
; j <ğ
’d
; j++) {

540 
li¡Node
 *
Ê
;

541 
li¡I‹r
 
li
;

543 ià(!
g‘İ
) {

544 
	`li¡Ty³Push
(
sobj
,
veùÜ
[
j
].
obj
,
LIST_TAIL
);

546 
	`li¡Rewšd
(
İ”©iÚs
,&
li
);

547 (
Ê
 = 
	`li¡Next
(&
li
))) {

548 
»disSÜtO³¿tiÚ
 *
sİ
 = 
Ê
->
v®ue
;

549 
robj
 *
v®
 = 
	`lookupKeyByP©‹º
(
c
->
db
,
sİ
->
·‰”n
,

550 
veùÜ
[
j
].
obj
);

552 ià(
sİ
->
ty³
 =ğ
SORT_OP_GET
) {

553 ià(!
v®
èv® = 
	`ü—‹SŒšgObjeù
("",0);

558 
	`li¡Ty³Push
(
sobj
,
v®
,
LIST_TAIL
);

559 
	`deüRefCouÁ
(
v®
);

562 
	`£rv”As£¹W™hInfo
(
c
,
sÜtv®
,
sİ
->
ty³
 =ğ
SORT_OP_GET
);

567 ià(
ouu’
) {

568 
	`£tKey
(
c
->
db
,
¡Üekey
,
sobj
);

569 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"sÜt¡Üe",
¡Üekey
,

570 
c
->
db
->
id
);

571 
£rv”
.
dœty
 +ğ
ouu’
;

572 } ià(
	`dbD–‘e
(
c
->
db
,
¡Üekey
)) {

573 
	`sigÇlModif›dKey
(
c
->
db
,
¡Üekey
);

574 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
¡Üekey
,
c
->
db
->
id
);

575 
£rv”
.
dœty
++;

577 
	`deüRefCouÁ
(
sobj
);

578 
	`addR•lyLÚgLÚg
(
c
,
ouu’
);

582 
j
 = 0; j < 
veùÜËn
; j++)

583 
	`deüRefCouÁ
(
veùÜ
[
j
].
obj
);

585 
	`deüRefCouÁ
(
sÜtv®
);

586 
	`li¡R–—£
(
İ”©iÚs
);

587 
j
 = 0; j < 
veùÜËn
; j++) {

588 ià(
®pha
 && 
veùÜ
[
j
].
u
.
cmpobj
)

589 
	`deüRefCouÁ
(
veùÜ
[
j
].
u
.
cmpobj
);

591 
	`zä“
(
veùÜ
);

592 
	}
}

	@sparkline.c

33 
	~"£rv”.h
"

35 
	~<m©h.h
>

39 
	gch¬£t
[] = "_-`";

40 
	gch¬£t_fl
[] = "_o#";

41 
	gch¬£t_Ën
 = (
ch¬£t
)-1;

42 
	gÏb–_m¬gš_tİ
 = 1;

57 
£qu’û
 *
	$ü—‹S·rklšeSequ’û
() {

58 
£qu’û
 *
£q
 = 
	`zm®loc
((*seq));

59 
£q
->
Ëngth
 = 0;

60 
£q
->
§m¶es
 = 
NULL
;

61  
£q
;

62 
	}
}

65 
	$¥¬klšeSequ’ûAddSam¶e
(
£qu’û
 *
£q
, 
v®ue
, *
Ïb–
) {

66 
Ïb–
 = (Ïb– =ğ
NULL
 ||†ab–[0] =ğ'\0'è? NULL : 
	`z¡rdup
(label);

67 ià(
£q
->
Ëngth
 == 0) {

68 
£q
->
mš
 = seq->
max
 = 
v®ue
;

70 ià(
v®ue
 < 
£q
->
mš
) seq->min = value;

71 ià(
v®ue
 > 
£q
->
max
) seq->max = value;

73 
£q
->
§m¶es
 = 
	`z»®loc
(£q->§m¶es,(
§m¶e
)*(£q->
Ëngth
+1));

74 
£q
->
§m¶es
[£q->
Ëngth
].
v®ue
 = value;

75 
£q
->
§m¶es
[£q->
Ëngth
].
Ïb–
 =†abel;

76 
£q
->
Ëngth
++;

77 ià(
Ïb–
è
£q
->
Ïb–s
++;

78 
	}
}

81 
	$ä“S·rklšeSequ’û
(
£qu’û
 *
£q
) {

82 
j
;

84 
j
 = 0; j < 
£q
->
Ëngth
; j++)

85 
	`zä“
(
£q
->
§m¶es
[
j
].
Ïb–
);

86 
	`zä“
(
£q
->
§m¶es
);

87 
	`zä“
(
£q
);

88 
	}
}

97 
sds
 
	$¥¬klšeR’d”Rªge
(
sds
 
ouut
, 
£qu’û
 *
£q
, 
rows
, 
off£t
, 
Ën
, 
æags
) {

98 
j
;

99 
»lmax
 = 
£q
->
max
 - seq->
mš
;

100 
¡•s
 = 
ch¬£t_Ën
*
rows
;

101 
row
 = 0;

102 *
ch¬s
 = 
	`zm®loc
(
Ën
);

103 
loİ
 = 1;

104 
İt_fl
 = 
æags
 & 
SPARKLINE_FILL
;

105 
İt_log
 = 
æags
 & 
SPARKLINE_LOG_SCALE
;

107 ià(
İt_log
) {

108 
»lmax
 = 
	`log
(relmax+1);

109 } ià(
»lmax
 == 0) {

110 
»lmax
 = 1;

113 
loİ
) {

114 
loİ
 = 0;

115 
	`mem£t
(
ch¬s
,' ',
Ën
);

116 
j
 = 0; j < 
Ën
; j++) {

117 
§m¶e
 *
s
 = &
£q
->
§m¶es
[
j
+
off£t
];

118 
»lv®
 = 
s
->
v®ue
 - 
£q
->
mš
;

119 
¡•
;

121 ià(
İt_log
è
»lv®
 = 
	`log
(relval+1);

122 
¡•
 = (è(
»lv®
*
¡•s
)/
»lmax
;

123 ià(
¡•
 < 0) step = 0;

124 ià(
¡•
 >ğ
¡•s
) step = steps-1;

126 ià(
row
 < 
rows
) {

128 
ch¬idx
 = 
¡•
-((
rows
-
row
-1)*
ch¬£t_Ën
);

129 
loİ
 = 1;

130 ià(
ch¬idx
 >ğ0 && ch¬idx < 
ch¬£t_Ën
) {

131 
ch¬s
[
j
] = 
İt_fl
 ? 
ch¬£t_fl
[
ch¬idx
] :

132 
ch¬£t
[
ch¬idx
];

133 } if(
İt_fl
 && 
ch¬idx
 >ğ
ch¬£t_Ën
) {

134 
ch¬s
[
j
] = '|';

138 ià(
£q
->
Ïb–s
 && 
row
-
rows
 < 
Ïb–_m¬gš_tİ
) {

139 
loİ
 = 1;

143 ià(
s
->
Ïb–
) {

144 
Ïb–_Ën
 = 
	`¡¾’
(
s
->
Ïb–
);

145 
Ïb–_ch¬
 = 
row
 - 
rows
 - 
Ïb–_m¬gš_tİ
;

147 ià(
Ïb–_Ën
 > 
Ïb–_ch¬
) {

148 
loİ
 = 1;

149 
ch¬s
[
j
] = 
s
->
Ïb–
[
Ïb–_ch¬
];

154 ià(
loİ
) {

155 
row
++;

156 
ouut
 = 
	`sdsÿ’
(ouut,
ch¬s
,
Ën
);

157 
ouut
 = 
	`sdsÿ’
(output,"\n",1);

160 
	`zä“
(
ch¬s
);

161  
ouut
;

162 
	}
}

165 
sds
 
	$¥¬klšeR’d”
(
sds
 
ouut
, 
£qu’û
 *
£q
, 
cŞumns
, 
rows
, 
æags
) {

166 
j
;

168 
j
 = 0; j < 
£q
->
Ëngth
; j +ğ
cŞumns
) {

169 
subËn
 = (
£q
->
Ëngth
-
j
è< 
cŞumns
 ? (seq->length-j) : columns;

171 ià(
j
 !ğ0è
ouut
 = 
	`sdsÿ’
(output,"\n",1);

172 
ouut
 = 
	`¥¬klšeR’d”Rªge
(ouut, 
£q
, 
rows
, 
j
, 
subËn
, 
æags
);

174  
ouut
;

175 
	}
}

	@sparkline.h

30 #iâdeà
__SPARKLINE_H


31 
	#__SPARKLINE_H


	)

34 
	s§m¶e
 {

35 
	mv®ue
;

36 *
	mÏb–
;

39 
	s£qu’û
 {

40 
	mËngth
;

41 
	mÏb–s
;

42 
§m¶e
 *
	m§m¶es
;

43 
	mmš
, 
	mmax
;

46 
	#SPARKLINE_NO_FLAGS
 0

	)

47 
	#SPARKLINE_FILL
 1

	)

48 
	#SPARKLINE_LOG_SCALE
 2

	)

50 
£qu’û
 *
ü—‹S·rklšeSequ’û
();

51 
¥¬klšeSequ’ûAddSam¶e
(
£qu’û
 *
£q
, 
v®ue
, *
Ïb–
);

52 
ä“S·rklšeSequ’û
(
£qu’û
 *
£q
);

53 
sds
 
¥¬klšeR’d”Rªge
(sd 
ouut
, 
£qu’û
 *
£q
, 
rows
, 
off£t
, 
Ën
, 
æags
);

54 
sds
 
¥¬klšeR’d”
(sd 
ouut
, 
£qu’û
 *
£q
, 
cŞumns
, 
rows
, 
æags
);

	@syncio.c

31 
	~"£rv”.h
"

43 
	#SYNCIO__RESOLUTION
 10

	)

49 
ssize_t
 
	$syncWr™e
(
fd
, *
±r
, 
ssize_t
 
size
, 
timeout
) {

50 
ssize_t
 
nwr™‹n
, 
»t
 = 
size
;

51 
¡¬t
 = 
	`m¡ime
();

52 
»maššg
 = 
timeout
;

55 
wa™
 = (
»maššg
 > 
SYNCIO__RESOLUTION
) ?

56 
»maššg
 : 
SYNCIO__RESOLUTION
;

57 
–­£d
;

61 
nwr™‹n
 = 
	`wr™e
(
fd
,
±r
,
size
);

62 ià(
nwr™‹n
 == -1) {

63 ià(
”ºo
 !ğ
EAGAIN
)  -1;

65 
±r
 +ğ
nwr™‹n
;

66 
size
 -ğ
nwr™‹n
;

68 ià(
size
 =ğ0è 
»t
;

71 
	`«Wa™
(
fd
,
AE_WRITABLE
,
wa™
);

72 
–­£d
 = 
	`m¡ime
(è- 
¡¬t
;

73 ià(
–­£d
 >ğ
timeout
) {

74 
”ºo
 = 
ETIMEDOUT
;

77 
»maššg
 = 
timeout
 - 
–­£d
;

79 
	}
}

85 
ssize_t
 
	$syncR—d
(
fd
, *
±r
, 
ssize_t
 
size
, 
timeout
) {

86 
ssize_t
 
Ä—d
, 
tÙ»ad
 = 0;

87 
¡¬t
 = 
	`m¡ime
();

88 
»maššg
 = 
timeout
;

90 ià(
size
 == 0)  0;

92 
wa™
 = (
»maššg
 > 
SYNCIO__RESOLUTION
) ?

93 
»maššg
 : 
SYNCIO__RESOLUTION
;

94 
–­£d
;

98 
Ä—d
 = 
	`»ad
(
fd
,
±r
,
size
);

99 ià(
Ä—d
 == 0)  -1;

100 ià(
Ä—d
 == -1) {

101 ià(
”ºo
 !ğ
EAGAIN
)  -1;

103 
±r
 +ğ
Ä—d
;

104 
size
 -ğ
Ä—d
;

105 
tÙ»ad
 +ğ
Ä—d
;

107 ià(
size
 =ğ0è 
tÙ»ad
;

110 
	`«Wa™
(
fd
,
AE_READABLE
,
wa™
);

111 
–­£d
 = 
	`m¡ime
(è- 
¡¬t
;

112 ià(
–­£d
 >ğ
timeout
) {

113 
”ºo
 = 
ETIMEDOUT
;

116 
»maššg
 = 
timeout
 - 
–­£d
;

118 
	}
}

125 
ssize_t
 
	$syncR—dLše
(
fd
, *
±r
, 
ssize_t
 
size
, 
timeout
) {

126 
ssize_t
 
Ä—d
 = 0;

128 
size
--;

129 
size
) {

130 
c
;

132 ià(
	`syncR—d
(
fd
,&
c
,1,
timeout
) == -1)  -1;

133 ià(
c
 == '\n') {

134 *
±r
 = '\0';

135 ià(
Ä—d
 && *(
±r
-1) == '\r') *(ptr-1) = '\0';

136  
Ä—d
;

138 *
±r
++ = 
c
;

139 *
±r
 = '\0';

140 
Ä—d
++;

142 
size
--;

144  
Ä—d
;

145 
	}
}

	@t_hash.c

30 
	~"£rv”.h
"

31 
	~<m©h.h
>

33 
	g¥¬£InU£
 = 1;

42 
	$hashTy³TryCÚv”siÚ
(
robj
 *
o
,„obj **
¬gv
, 
¡¬t
, 
’d
) {

43 
i
;

45 ià(
o
->
’codšg
 !ğ
OBJ_ENCODING_ZIPLIST
) ;

47 
i
 = 
¡¬t
; i <ğ
’d
; i++) {

48 ià(
	`sdsEncodedObjeù
(
¬gv
[
i
]) &&

49 
	`sd¦’
(
¬gv
[
i
]->
±r
è> 
£rv”
.
hash_max_zli¡_v®ue
)

51 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

55 
	}
}

59 
	$hashTy³G‘FromZli¡
(
robj
 *
o
, 
sds
 
f›ld
,

60 **
v¡r
,

61 *
vËn
,

62 *
vÎ
)

64 *
zl
, *
åŒ
 = 
NULL
, *
v±r
 = NULL;

65 
»t
;

67 
	`£rv”As£¹
(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
);

69 
zl
 = 
o
->
±r
;

70 
åŒ
 = 
	`zli¡Index
(
zl
, 
ZIPLIST_HEAD
);

71 ià(
åŒ
 !ğ
NULL
) {

72 
åŒ
 = 
	`zli¡Fšd
(åŒ, (*)
f›ld
, 
	`sd¦’
(field), 1);

73 ià(
åŒ
 !ğ
NULL
) {

75 
v±r
 = 
	`zli¡Next
(
zl
, 
åŒ
);

76 
	`£rv”As£¹
(
v±r
 !ğ
NULL
);

80 ià(
v±r
 !ğ
NULL
) {

81 
»t
 = 
	`zli¡G‘
(
v±r
, 
v¡r
, 
vËn
, 
vÎ
);

82 
	`£rv”As£¹
(
»t
);

87 
	}
}

92 
sds
 
	$hashTy³G‘FromHashTabË
(
robj
 *
o
, 
sds
 
f›ld
) {

93 
diùEÁry
 *
de
;

95 
	`£rv”As£¹
(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
);

97 
de
 = 
	`diùFšd
(
o
->
±r
, 
f›ld
);

98 ià(
de
 =ğ
NULL
)  NULL;

99  
	`diùG‘V®
(
de
);

100 
	}
}

111 
	$hashTy³G‘V®ue
(
robj
 *
o
, 
sds
 
f›ld
, **
v¡r
, *
vËn
, *
vÎ
) {

112 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

113 *
v¡r
 = 
NULL
;

114 ià(
	`hashTy³G‘FromZli¡
(
o
, 
f›ld
, 
v¡r
, 
vËn
, 
vÎ
) == 0)

115  
C_OK
;

116 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

117 
sds
 
v®ue
;

118 ià((
v®ue
 = 
	`hashTy³G‘FromHashTabË
(
o
, 
f›ld
)è!ğ
NULL
) {

119 *
v¡r
 = (*è
v®ue
;

120 *
vËn
 = 
	`sd¦’
(
v®ue
);

121  
C_OK
;

124 
	`£rv”Pªic
("Unknown hashƒncoding");

126  
C_ERR
;

127 
	}
}

133 
robj
 *
	$hashTy³G‘V®ueObjeù
(
robj
 *
o
, 
sds
 
f›ld
) {

134 *
v¡r
;

135 
vËn
;

136 
vÎ
;

138 ià(
	`hashTy³G‘V®ue
(
o
,
f›ld
,&
v¡r
,&
vËn
,&
vÎ
è=ğ
C_ERR
è 
NULL
;

139 ià(
v¡r
è 
	`ü—‹SŒšgObjeù
((*)v¡r,
vËn
);

140  
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
vÎ
);

141 
	}
}

146 
size_t
 
	$hashTy³G‘V®ueL’gth
(
robj
 *
o
, 
sds
 
f›ld
) {

147 
size_t
 
Ën
 = 0;

148 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

149 *
v¡r
 = 
NULL
;

150 
vËn
 = 
UINT_MAX
;

151 
vÎ
 = 
LLONG_MAX
;

153 ià(
	`hashTy³G‘FromZli¡
(
o
, 
f›ld
, &
v¡r
, &
vËn
, &
vÎ
) == 0)

154 
Ën
 = 
v¡r
 ? 
vËn
 : 
	`sdig™s10
(
vÎ
);

155 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

156 
sds
 
aux
;

158 ià((
aux
 = 
	`hashTy³G‘FromHashTabË
(
o
, 
f›ld
)è!ğ
NULL
)

159 
Ën
 = 
	`sd¦’
(
aux
);

161 
	`£rv”Pªic
("Unknown hashƒncoding");

163  
Ën
;

164 
	}
}

168 
	$hashTy³Exi¡s
(
robj
 *
o
, 
sds
 
f›ld
) {

169 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

170 *
v¡r
 = 
NULL
;

171 
vËn
 = 
UINT_MAX
;

172 
vÎ
 = 
LLONG_MAX
;

174 ià(
	`hashTy³G‘FromZli¡
(
o
, 
f›ld
, &
v¡r
, &
vËn
, &
vÎ
) == 0)  1;

175 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

176 ià(
	`hashTy³G‘FromHashTabË
(
o
, 
f›ld
è!ğ
NULL
)  1;

178 
	`£rv”Pªic
("Unknown hashƒncoding");

181 
	}
}

201 
	#HASH_SET_TAKE_FIELD
 (1<<0)

	)

202 
	#HASH_SET_TAKE_VALUE
 (1<<1)

	)

203 
	#HASH_SET_COPY
 0

	)

204 
	$hashTy³S‘
(
robj
 *
o
, 
sds
 
f›ld
, sd 
v®ue
, 
æags
) {

205 
upd©e
 = 0;

207 ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
è&& (!
¥¬£InU£
)) {

208 *
zl
, *
åŒ
, *
v±r
;

210 
zl
 = 
o
->
±r
;

211 
åŒ
 = 
	`zli¡Index
(
zl
, 
ZIPLIST_HEAD
);

212 ià(
åŒ
 !ğ
NULL
) {

213 
åŒ
 = 
	`zli¡Fšd
(åŒ, (*)
f›ld
, 
	`sd¦’
(field), 1);

214 ià(
åŒ
 !ğ
NULL
) {

216 
v±r
 = 
	`zli¡Next
(
zl
, 
åŒ
);

217 
	`£rv”As£¹
(
v±r
 !ğ
NULL
);

218 
upd©e
 = 1;

221 
zl
 = 
	`zli¡D–‘e
(zl, &
v±r
);

224 
zl
 = 
	`zli¡In£¹
(zl, 
v±r
, (*)
v®ue
,

225 
	`sd¦’
(
v®ue
));

229 ià(!
upd©e
) {

231 
zl
 = 
	`zli¡Push
(zl, (*)
f›ld
, 
	`sd¦’
(field),

232 
ZIPLIST_TAIL
);

233 
zl
 = 
	`zli¡Push
(zl, (*)
v®ue
, 
	`sd¦’
(value),

234 
ZIPLIST_TAIL
);

236 
o
->
±r
 = 
zl
;

239 ià(
	`hashTy³L’gth
(
o
è> 
£rv”
.
hash_max_zli¡_’Œ›s
)

240 
	`hashTy³CÚv”t
(
o
, 
OBJ_ENCODING_HT
);

241 } ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
è|| (
¥¬£InU£
==2)) {

242 
diùEÁry
 *
de
 = 
	`diùFšd
(
o
->
±r
,
f›ld
);

243 ià(
de
) {

244 
	`sdsä“
(
	`diùG‘V®
(
de
));

245 ià(
æags
 & 
HASH_SET_TAKE_VALUE
) {

246 
	`diùG‘V®
(
de
èğ
v®ue
;

247 
v®ue
 = 
NULL
;

249 
	`diùG‘V®
(
de
èğ
	`sdsdup
(
v®ue
);

251 
upd©e
 = 1;

253 
sds
 
f
,
v
;

254 ià(
æags
 & 
HASH_SET_TAKE_FIELD
) {

255 
f
 = 
f›ld
;

256 
f›ld
 = 
NULL
;

258 
f
 = 
	`sdsdup
(
f›ld
);

260 ià(
æags
 & 
HASH_SET_TAKE_VALUE
) {

261 
v
 = 
v®ue
;

262 
v®ue
 = 
NULL
;

264 
v
 = 
	`sdsdup
(
v®ue
);

266 
	`diùAdd
(
o
->
±r
,
f
,
v
);

268 } ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_SPM
è|| (
¥¬£InU£
 == 1) ) {

269 
diù
 *
d
 = 
o
->
±r
;

270 
keyCİy
[(
ulÚg
)];

271 
	`memıy
(
keyCİy
, 
f›ld
, (field)+1);

272 
HTI‹m
 *
bck
;

273 
bck
 = 
	`HashIn£¹
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT,
keyCİy
),
v®ue
);

274 if(
bck
 =ğ
NULL
) {

275 
	`£rv”Pªic
("SPM hash‚ot done");

277 
	`£rv”Log
(
LL_NOTICE
,"Done");

281 
	`£rv”Pªic
("Unknown hashƒncoding");

286 ià(
æags
 & 
HASH_SET_TAKE_FIELD
 && 
f›ld
è
	`sdsä“
(field);

287 ià(
æags
 & 
HASH_SET_TAKE_VALUE
 && 
v®ue
è
	`sdsä“
(value);

288  
upd©e
;

289 
	}
}

293 
	$hashTy³D–‘e
(
robj
 *
o
, 
sds
 
f›ld
) {

294 
d–‘ed
 = 0;

296 ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
è&& (!
¥¬£InU£
)) {

297 *
zl
, *
åŒ
;

299 
zl
 = 
o
->
±r
;

300 
åŒ
 = 
	`zli¡Index
(
zl
, 
ZIPLIST_HEAD
);

301 ià(
åŒ
 !ğ
NULL
) {

302 
åŒ
 = 
	`zli¡Fšd
(åŒ, (*)
f›ld
, 
	`sd¦’
(field), 1);

303 ià(
åŒ
 !ğ
NULL
) {

304 
zl
 = 
	`zli¡D–‘e
(zl,&
åŒ
);

305 
zl
 = 
	`zli¡D–‘e
(zl,&
åŒ
);

306 
o
->
±r
 = 
zl
;

307 
d–‘ed
 = 1;

310 } ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
è&&(!
¥¬£InU£
)) {

311 ià(
	`diùD–‘e
((
diù
*)
o
->
±r
, 
f›ld
è=ğ
C_OK
) {

312 
d–‘ed
 = 1;

315 ià(
	`htN“dsResize
(
o
->
±r
)è
	`diùResize
(o->ptr);

318 } ià((
o
->
’codšg
 =ğ
OBJ_ENCODING_SPM
)||(
¥¬£InU£
)) {

320 
diù
 *
d
 = 
o
->
±r
;

321 
keyCİy
[(
ulÚg
)];

322 
	`memıy
(
keyCİy
, 
f›ld
, (field)+1);

323 ià((
	`HashD–‘e
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT,
keyCİy
)) == 1)) {

324 
d–‘ed
 = 1;

328 
	`£rv”Log
(
LL_NOTICE
,"Could‚ot delete");

331 
	`£rv”Pªic
("Unknown hashƒncoding");

333  
d–‘ed
;

334 
	}
}

337 
	$hashTy³L’gth
(cÚ¡ 
robj
 *
o
) {

338 
Ëngth
 = 
ULONG_MAX
;

340 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

341 
Ëngth
 = 
	`zli¡L’
(
o
->
±r
) / 2;

342 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

343 
Ëngth
 = 
	`diùSize
((cÚ¡ 
diù
*)
o
->
±r
);

344 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SPM
) {

345 
Ëngth
 = 0;

347 
	`£rv”Pªic
("Unknown hashƒncoding");

349  
Ëngth
;

350 
	}
}

352 
hashTy³I‹¿tÜ
 *
	$hashTy³In™I‹¿tÜ
(
robj
 *
subjeù
) {

353 
hashTy³I‹¿tÜ
 *
hi
 = 
	`zm®loc
((hashTypeIterator));

354 
hi
->
subjeù
 = subject;

355 
hi
->
’codšg
 = 
subjeù
->encoding;

357 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

358 
hi
->
åŒ
 = 
NULL
;

359 
hi
->
v±r
 = 
NULL
;

360 } ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

361 
hi
->
di
 = 
	`diùG‘I‹¿tÜ
(
subjeù
->
±r
);

363 
	`£rv”Pªic
("Unknown hashƒncoding");

365  
hi
;

366 
	}
}

368 
	$hashTy³R–—£I‹¿tÜ
(
hashTy³I‹¿tÜ
 *
hi
) {

369 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
)

370 
	`diùR–—£I‹¿tÜ
(
hi
->
di
);

371 
	`zä“
(
hi
);

372 
	}
}

376 
	$hashTy³Next
(
hashTy³I‹¿tÜ
 *
hi
) {

377 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

378 *
zl
;

379 *
åŒ
, *
v±r
;

381 
zl
 = 
hi
->
subjeù
->
±r
;

382 
åŒ
 = 
hi
->fptr;

383 
v±r
 = 
hi
->vptr;

385 ià(
åŒ
 =ğ
NULL
) {

387 
	`£rv”As£¹
(
v±r
 =ğ
NULL
);

388 
åŒ
 = 
	`zli¡Index
(
zl
, 0);

391 
	`£rv”As£¹
(
v±r
 !ğ
NULL
);

392 
åŒ
 = 
	`zli¡Next
(
zl
, 
v±r
);

394 ià(
åŒ
 =ğ
NULL
è 
C_ERR
;

397 
v±r
 = 
	`zli¡Next
(
zl
, 
åŒ
);

398 
	`£rv”As£¹
(
v±r
 !ğ
NULL
);

401 
hi
->
åŒ
 = fptr;

402 
hi
->
v±r
 = vptr;

403 } ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

404 ià((
hi
->
de
 = 
	`diùNext
(hi->
di
)è=ğ
NULL
è 
C_ERR
;

406 
	`£rv”Pªic
("Unknown hashƒncoding");

408  
C_OK
;

409 
	}
}

413 
	$hashTy³Cu¼’tFromZli¡
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
,

414 **
v¡r
,

415 *
vËn
,

416 *
vÎ
)

418 
»t
;

420 
	`£rv”As£¹
(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
);

422 ià(
wh©
 & 
OBJ_HASH_KEY
) {

423 
»t
 = 
	`zli¡G‘
(
hi
->
åŒ
, 
v¡r
, 
vËn
, 
vÎ
);

424 
	`£rv”As£¹
(
»t
);

426 
»t
 = 
	`zli¡G‘
(
hi
->
v±r
, 
v¡r
, 
vËn
, 
vÎ
);

427 
	`£rv”As£¹
(
»t
);

429 
	}
}

434 
sds
 
	$hashTy³Cu¼’tFromHashTabË
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
) {

435 
	`£rv”As£¹
(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
);

437 ià(
wh©
 & 
OBJ_HASH_KEY
) {

438  
	`diùG‘Key
(
hi
->
de
);

440  
	`diùG‘V®
(
hi
->
de
);

442 
	}
}

454 
	$hashTy³Cu¼’tObjeù
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
, **
v¡r
, *
vËn
, *
vÎ
) {

455 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

456 *
v¡r
 = 
NULL
;

457 
	`hashTy³Cu¼’tFromZli¡
(
hi
, 
wh©
, 
v¡r
, 
vËn
, 
vÎ
);

458 } ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

459 
sds
 
–e
 = 
	`hashTy³Cu¼’tFromHashTabË
(
hi
, 
wh©
);

460 *
v¡r
 = (*è
–e
;

461 *
vËn
 = 
	`sd¦’
(
–e
);

463 
	`£rv”Pªic
("Unknown hashƒncoding");

465 
	}
}

469 
sds
 
	$hashTy³Cu¼’tObjeùNewSds
(
hashTy³I‹¿tÜ
 *
hi
, 
wh©
) {

470 *
v¡r
;

471 
vËn
;

472 
vÎ
;

474 
	`hashTy³Cu¼’tObjeù
(
hi
,
wh©
,&
v¡r
,&
vËn
,&
vÎ
);

475 ià(
v¡r
è 
	`sd¢ewËn
(v¡r,
vËn
);

476  
	`sdsäomlÚglÚg
(
vÎ
);

477 
	}
}

479 
robj
 *
	$hashTy³LookupWr™eOrC»©e
(
ş›Á
 *
c
, 
robj
 *
key
) {

480 
robj
 *
o
 = 
	`lookupKeyWr™e
(
c
->
db
,
key
);

481 ià(
o
 =ğ
NULL
) {

482 
o
 = 
	`ü—‹HashObjeù
();

483 
	`dbAdd
(
c
->
db
,
key
,
o
);

485 ià(
o
->
ty³
 !ğ
OBJ_HASH
) {

486 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

487  
NULL
;

490  
o
;

491 
	}
}

493 
	$hashTy³CÚv”tZli¡
(
robj
 *
o
, 
’c
) {

494 
	`£rv”As£¹
(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
);

496 ià(
’c
 =ğ
OBJ_ENCODING_ZIPLIST
) {

499 } ià(
’c
 =ğ
OBJ_ENCODING_HT
) {

500 
hashTy³I‹¿tÜ
 *
hi
;

501 
diù
 *dict;

502 
»t
;

504 
hi
 = 
	`hashTy³In™I‹¿tÜ
(
o
);

505 
diù
 = 
	`diùC»©e
(&
hashDiùTy³
, 
NULL
);

507 
	`hashTy³Next
(
hi
è!ğ
C_ERR
) {

508 
sds
 
key
, 
v®ue
;

510 
key
 = 
	`hashTy³Cu¼’tObjeùNewSds
(
hi
,
OBJ_HASH_KEY
);

511 
v®ue
 = 
	`hashTy³Cu¼’tObjeùNewSds
(
hi
,
OBJ_HASH_VALUE
);

512 
»t
 = 
	`diùAdd
(
diù
, 
key
, 
v®ue
);

513 ià(
»t
 !ğ
DICT_OK
) {

514 
	`£rv”LogHexDump
(
LL_WARNING
,"ziplist with dupƒlements dump",

515 
o
->
±r
,
	`zli¡BlobL’
(o->ptr));

516 
	`£rv”Pªic
("Ziplist corruption detected");

519 
	`hashTy³R–—£I‹¿tÜ
(
hi
);

520 
	`zä“
(
o
->
±r
);

521 
o
->
’codšg
 = 
OBJ_ENCODING_HT
;

522 
o
->
±r
 = 
diù
;

524 
	`£rv”Pªic
("Unknown hashƒncoding");

526 
	}
}

528 
	$hashTy³CÚv”t
(
robj
 *
o
, 
’c
) {

529 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

530 
	`hashTy³CÚv”tZli¡
(
o
, 
’c
);

531 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

532 
	`£rv”Pªic
("Not implemented");

534 
	`£rv”Pªic
("Unknown hashƒncoding");

536 
	}
}

542 
	$h£tCommªd
(
ş›Á
 *
c
) {

543 
upd©e
;

544 
robj
 *
o
;

546 ià((
o
 = 
	`hashTy³LookupWr™eOrC»©e
(
c
,c->
¬gv
[1])è=ğ
NULL
) ;

547 
	`hashTy³TryCÚv”siÚ
(
o
,
c
->
¬gv
,2,3);

548 
upd©e
 = 
	`hashTy³S‘
(
o
,
c
->
¬gv
[2]->
±r
,c->¬gv[3]->±r,
HASH_SET_COPY
);

549 
	`addR•ly
(
c
, 
upd©e
 ? 
sh¬ed
.
cz”o
 : sh¬ed.
cÚe
);

550 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

551 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"h£t",
c
->
¬gv
[1],c->
db
->
id
);

552 
£rv”
.
dœty
++;

553 
	}
}

555 
	$h£ŠxCommªd
(
ş›Á
 *
c
) {

556 
robj
 *
o
;

557 ià((
o
 = 
	`hashTy³LookupWr™eOrC»©e
(
c
,c->
¬gv
[1])è=ğ
NULL
) ;

558 
	`hashTy³TryCÚv”siÚ
(
o
,
c
->
¬gv
,2,3);

560 ià(
	`hashTy³Exi¡s
(
o
, 
c
->
¬gv
[2]->
±r
)) {

561 
	`addR•ly
(
c
, 
sh¬ed
.
cz”o
);

563 
	`hashTy³S‘
(
o
,
c
->
¬gv
[2]->
±r
,c->¬gv[3]->±r,
HASH_SET_COPY
);

564 
	`addR•ly
(
c
, 
sh¬ed
.
cÚe
);

565 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

566 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"h£t",
c
->
¬gv
[1],c->
db
->
id
);

567 
£rv”
.
dœty
++;

569 
	}
}

571 
	$hm£tCommªd
(
ş›Á
 *
c
) {

572 
i
;

573 
robj
 *
o
;

575 ià((
c
->
¬gc
 % 2) == 1) {

576 
	`addR•lyE¼Ü
(
c
,"wrong‚umber of‡rguments for HMSET");

580 ià((
o
 = 
	`hashTy³LookupWr™eOrC»©e
(
c
,c->
¬gv
[1])è=ğ
NULL
) ;

581 
	`hashTy³TryCÚv”siÚ
(
o
,
c
->
¬gv
,2,c->
¬gc
-1);

582 
i
 = 2; i < 
c
->
¬gc
; i += 2) {

583 
	`hashTy³S‘
(
o
,
c
->
¬gv
[
i
]->
±r
,c->¬gv[i+1]->±r,
HASH_SET_COPY
);

585 
	`addR•ly
(
c
, 
sh¬ed
.
ok
);

586 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

587 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"h£t",
c
->
¬gv
[1],c->
db
->
id
);

588 
£rv”
.
dœty
++;

589 
	}
}

591 
	$hšübyCommªd
(
ş›Á
 *
c
) {

592 
v®ue
, 
šü
, 
Şdv®ue
;

593 
robj
 *
o
;

594 
sds
 
Ãw
;

595 *
v¡r
;

596 
vËn
;

598 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
šü
,
NULL
è!ğ
C_OK
) ;

599 ià((
o
 = 
	`hashTy³LookupWr™eOrC»©e
(
c
,c->
¬gv
[1])è=ğ
NULL
) ;

600 ià(
	`hashTy³G‘V®ue
(
o
,
c
->
¬gv
[2]->
±r
,&
v¡r
,&
vËn
,&
v®ue
è=ğ
C_OK
) {

601 ià(
v¡r
) {

602 ià(
	`¡ršg2Î
((*)
v¡r
,
vËn
,&
v®ue
) == 0) {

603 
	`addR•lyE¼Ü
(
c
,"hash value is‚ot‡n integer");

608 
v®ue
 = 0;

611 
Şdv®ue
 = 
v®ue
;

612 ià((
šü
 < 0 && 
Şdv®ue
 < 0 && inü < (
LLONG_MIN
-oldvalue)) ||

613 (
šü
 > 0 && 
Şdv®ue
 > 0 && inü > (
LLONG_MAX
-oldvalue))) {

614 
	`addR•lyE¼Ü
(
c
,"increment or decrement would overflow");

617 
v®ue
 +ğ
šü
;

618 
Ãw
 = 
	`sdsäomlÚglÚg
(
v®ue
);

619 
	`hashTy³S‘
(
o
,
c
->
¬gv
[2]->
±r
,
Ãw
,
HASH_SET_TAKE_VALUE
);

620 
	`addR•lyLÚgLÚg
(
c
,
v®ue
);

621 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

622 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"hšüby",
c
->
¬gv
[1],c->
db
->
id
);

623 
£rv”
.
dœty
++;

624 
	}
}

626 
	$hšübyæßtCommªd
(
ş›Á
 *
c
) {

627 
v®ue
, 
šü
;

628 
Î
;

629 
robj
 *
o
;

630 
sds
 
Ãw
;

631 *
v¡r
;

632 
vËn
;

634 ià(
	`g‘LÚgDoubËFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
šü
,
NULL
è!ğ
C_OK
) ;

635 ià((
o
 = 
	`hashTy³LookupWr™eOrC»©e
(
c
,c->
¬gv
[1])è=ğ
NULL
) ;

636 ià(
	`hashTy³G‘V®ue
(
o
,
c
->
¬gv
[2]->
±r
,&
v¡r
,&
vËn
,&
Î
è=ğ
C_OK
) {

637 ià(
v¡r
) {

638 ià(
	`¡ršg2ld
((*)
v¡r
,
vËn
,&
v®ue
) == 0) {

639 
	`addR•lyE¼Ü
(
c
,"hash value is‚ot‡ float");

643 
v®ue
 = ()
Î
;

646 
v®ue
 = 0;

649 
v®ue
 +ğ
šü
;

651 
buf
[256];

652 
Ën
 = 
	`ld2¡ršg
(
buf
,(buf),
v®ue
,1);

653 
Ãw
 = 
	`sd¢ewËn
(
buf
,
Ën
);

654 
	`hashTy³S‘
(
o
,
c
->
¬gv
[2]->
±r
,
Ãw
,
HASH_SET_TAKE_VALUE
);

655 
	`addR•lyBulkCBufãr
(
c
,
buf
,
Ën
);

656 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

657 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"hšübyæßt",
c
->
¬gv
[1],c->
db
->
id
);

658 
£rv”
.
dœty
++;

663 
robj
 *
aux
, *
Ãwobj
;

664 
aux
 = 
	`ü—‹SŒšgObjeù
("HSET",4);

665 
Ãwobj
 = 
	`ü—‹RawSŒšgObjeù
(
buf
,
Ën
);

666 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,0,
aux
);

667 
	`deüRefCouÁ
(
aux
);

668 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,3,
Ãwobj
);

669 
	`deüRefCouÁ
(
Ãwobj
);

670 
	}
}

672 
	$addHashF›ldToR•ly
(
ş›Á
 *
c
, 
robj
 *
o
, 
sds
 
f›ld
) {

673 
»t
;

675 ià(
o
 =ğ
NULL
) {

676 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

680 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

681 *
v¡r
 = 
NULL
;

682 
vËn
 = 
UINT_MAX
;

683 
vÎ
 = 
LLONG_MAX
;

685 
»t
 = 
	`hashTy³G‘FromZli¡
(
o
, 
f›ld
, &
v¡r
, &
vËn
, &
vÎ
);

686 ià(
»t
 < 0) {

687 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

689 ià(
v¡r
) {

690 
	`addR•lyBulkCBufãr
(
c
, 
v¡r
, 
vËn
);

692 
	`addR•lyBulkLÚgLÚg
(
c
, 
vÎ
);

696 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

697 
sds
 
v®ue
 = 
	`hashTy³G‘FromHashTabË
(
o
, 
f›ld
);

698 ià(
v®ue
 =ğ
NULL
)

699 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

701 
	`addR•lyBulkCBufãr
(
c
, 
v®ue
, 
	`sd¦’
(value));

702 } ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_SPM
) {

703 
sds
 
v®ue
;

704 
keyCİy
[(
ulÚg
)];

705 
	`memıy
(
keyCİy
, 
f›ld
, (field)+1);

706 
diù
* 
d
 = 
o
->
±r
;

707 
HTI‹m
 *
™em
;

708 
™em
 = 
	`HashFšd
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT, 
keyCİy
));

709 
v®ue
 = 
™em
->
d©a
;

710 if(
v®ue
 =ğ
NULL
) {

711 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

712 
	`´štf
("The value is‚ull");

715 
	`addR•lyBulkCBufãr
(
c
, 
v®ue
, 
	`sd¦’
(value));

719 
	`£rv”Pªic
("Unknown hashƒncoding");

721 
	}
}

723 
	$hg‘Commªd
(
ş›Á
 *
c
) {

724 
robj
 *
o
;

726 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

727 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

729 
	`addHashF›ldToR•ly
(
c
, 
o
, c->
¬gv
[2]->
±r
);

730 
	}
}

732 
	$hmg‘Commªd
(
ş›Á
 *
c
) {

733 
robj
 *
o
;

734 
i
;

738 
o
 = 
	`lookupKeyR—d
(
c
->
db
, c->
¬gv
[1]);

739 ià(
o
 !ğ
NULL
 && o->
ty³
 !ğ
OBJ_HASH
) {

740 
	`addR•ly
(
c
, 
sh¬ed
.
wrÚgty³”r
);

744 
	`addR•lyMuÉiBulkL’
(
c
, c->
¬gc
-2);

745 
i
 = 2; i < 
c
->
¬gc
; i++) {

746 
	`addHashF›ldToR•ly
(
c
, 
o
, c->
¬gv
[
i
]->
±r
);

748 
	}
}

750 
	$hd–Commªd
(
ş›Á
 *
c
) {

751 
robj
 *
o
;

752 
j
, 
d–‘ed
 = 0, 
key»moved
 = 0;

754 ià((
o
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

755 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

757 
j
 = 2; j < 
c
->
¬gc
; j++) {

758 ià(
	`hashTy³D–‘e
(
o
,
c
->
¬gv
[
j
]->
±r
)) {

759 
d–‘ed
++;

760 ià((!
¥¬£InU£
è&& (
	`hashTy³L’gth
(
o
) == 0)) {

761 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

762 
key»moved
 = 1;

769 ià(
d–‘ed
) {

770 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

771 
	`nÙifyKey¥aûEv’t
(
NOTIFY_HASH
,"hd–",
c
->
¬gv
[1],c->
db
->
id
);

772 ià(
key»moved
)

773 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],

774 
c
->
db
->
id
);

775 
£rv”
.
dœty
 +ğ
d–‘ed
;

777 
	`addR•lyLÚgLÚg
(
c
,
d–‘ed
);

778 
	}
}

780 
	$hËnCommªd
(
ş›Á
 *
c
) {

781 
robj
 *
o
;

783 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

784 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

786 
	`addR•lyLÚgLÚg
(
c
,
	`hashTy³L’gth
(
o
));

787 
	}
}

789 
	$h¡¾’Commªd
(
ş›Á
 *
c
) {

790 
robj
 *
o
;

792 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

793 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

794 
	`addR•lyLÚgLÚg
(
c
,
	`hashTy³G‘V®ueL’gth
(
o
,c->
¬gv
[2]->
±r
));

795 
	}
}

797 
	$addHashI‹¿tÜCursÜToR•ly
(
ş›Á
 *
c
, 
hashTy³I‹¿tÜ
 *
hi
, 
wh©
) {

798 ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

799 *
v¡r
 = 
NULL
;

800 
vËn
 = 
UINT_MAX
;

801 
vÎ
 = 
LLONG_MAX
;

803 
	`hashTy³Cu¼’tFromZli¡
(
hi
, 
wh©
, &
v¡r
, &
vËn
, &
vÎ
);

804 ià(
v¡r
)

805 
	`addR•lyBulkCBufãr
(
c
, 
v¡r
, 
vËn
);

807 
	`addR•lyBulkLÚgLÚg
(
c
, 
vÎ
);

808 } ià(
hi
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

809 
sds
 
v®ue
 = 
	`hashTy³Cu¼’tFromHashTabË
(
hi
, 
wh©
);

810 
	`addR•lyBulkCBufãr
(
c
, 
v®ue
, 
	`sd¦’
(value));

812 
	`£rv”Pªic
("Unknown hashƒncoding");

814 
	}
}

816 
	$g’”icHg‘®lCommªd
(
ş›Á
 *
c
, 
æags
) {

817 
robj
 *
o
;

818 
hashTy³I‹¿tÜ
 *
hi
;

819 
muÉl›r
 = 0;

820 
Ëngth
, 
couÁ
 = 0;

822 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL


823 || 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

825 ià(
æags
 & 
OBJ_HASH_KEY
è
muÉl›r
++;

826 ià(
æags
 & 
OBJ_HASH_VALUE
è
muÉl›r
++;

828 
Ëngth
 = 
	`hashTy³L’gth
(
o
è* 
muÉl›r
;

829 
	`addR•lyMuÉiBulkL’
(
c
, 
Ëngth
);

831 
hi
 = 
	`hashTy³In™I‹¿tÜ
(
o
);

832 
	`hashTy³Next
(
hi
è!ğ
C_ERR
) {

833 ià(
æags
 & 
OBJ_HASH_KEY
) {

834 
	`addHashI‹¿tÜCursÜToR•ly
(
c
, 
hi
, 
OBJ_HASH_KEY
);

835 
couÁ
++;

837 ià(
æags
 & 
OBJ_HASH_VALUE
) {

838 
	`addHashI‹¿tÜCursÜToR•ly
(
c
, 
hi
, 
OBJ_HASH_VALUE
);

839 
couÁ
++;

843 
	`hashTy³R–—£I‹¿tÜ
(
hi
);

844 
	`£rv”As£¹
(
couÁ
 =ğ
Ëngth
);

845 
	}
}

847 
	$hkeysCommªd
(
ş›Á
 *
c
) {

848 
	`g’”icHg‘®lCommªd
(
c
,
OBJ_HASH_KEY
);

849 
	}
}

851 
	$hv®sCommªd
(
ş›Á
 *
c
) {

852 
	`g’”icHg‘®lCommªd
(
c
,
OBJ_HASH_VALUE
);

853 
	}
}

855 
	$hg‘®lCommªd
(
ş›Á
 *
c
) {

856 
	`g’”icHg‘®lCommªd
(
c
,
OBJ_HASH_KEY
|
OBJ_HASH_VALUE
);

857 
	}
}

859 
	$hexi¡sCommªd
(
ş›Á
 *
c
) {

860 
robj
 *
o
;

861 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

862 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

864 
	`addR•ly
(
c
, 
	`hashTy³Exi¡s
(
o
,c->
¬gv
[2]->
±r
è? 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

865 
	}
}

867 
	$hsÿnCommªd
(
ş›Á
 *
c
) {

868 
robj
 *
o
;

869 
cursÜ
;

871 ià(
	`·r£SÿnCursÜOrR•ly
(
c
,c->
¬gv
[2],&
cursÜ
è=ğ
C_ERR
) ;

872 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ysÿn
)è=ğ
NULL
 ||

873 
	`checkTy³
(
c
,
o
,
OBJ_HASH
)) ;

874 
	`sÿnG’”icCommªd
(
c
,
o
,
cursÜ
);

875 
	}
}

	@t_list.c

30 
	~"£rv”.h
"

41 
	$li¡Ty³Push
(
robj
 *
subjeù
,„obj *
v®ue
, 
wh”e
) {

42 ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

43 
pos
 = (
wh”e
 =ğ
LIST_HEAD
è? 
QUICKLIST_HEAD
 : 
QUICKLIST_TAIL
;

44 
v®ue
 = 
	`g‘DecodedObjeù
(value);

45 
size_t
 
Ën
 = 
	`sd¦’
(
v®ue
->
±r
);

46 
	`quickli¡Push
(
subjeù
->
±r
, 
v®ue
->±r, 
Ën
, 
pos
);

47 
	`deüRefCouÁ
(
v®ue
);

49 
	`£rv”Pªic
("Unknown†istƒncoding");

51 
	}
}

53 *
	$li¡PİSav”
(*
d©a
, 
sz
) {

54  
	`ü—‹SŒšgObjeù
((*)
d©a
,
sz
);

55 
	}
}

57 
robj
 *
	$li¡Ty³Pİ
(
robj
 *
subjeù
, 
wh”e
) {

58 
vlÚg
;

59 
robj
 *
v®ue
 = 
NULL
;

61 
ql_wh”e
 = 
wh”e
 =ğ
LIST_HEAD
 ? 
QUICKLIST_HEAD
 : 
QUICKLIST_TAIL
;

62 ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

63 ià(
	`quickli¡PİCu¡om
(
subjeù
->
±r
, 
ql_wh”e
, (**)&
v®ue
,

64 
NULL
, &
vlÚg
, 
li¡PİSav”
)) {

65 ià(!
v®ue
)

66 
v®ue
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
vlÚg
);

69 
	`£rv”Pªic
("Unknown†istƒncoding");

71  
v®ue
;

72 
	}
}

74 
	$li¡Ty³L’gth
(cÚ¡ 
robj
 *
subjeù
) {

75 ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

76  
	`quickli¡CouÁ
(
subjeù
->
±r
);

78 
	`£rv”Pªic
("Unknown†istƒncoding");

80 
	}
}

83 
li¡Ty³I‹¿tÜ
 *
	$li¡Ty³In™I‹¿tÜ
(
robj
 *
subjeù
, 
šdex
,

84 
dœeùiÚ
) {

85 
li¡Ty³I‹¿tÜ
 *
li
 = 
	`zm®loc
((listTypeIterator));

86 
li
->
subjeù
 = subject;

87 
li
->
’codšg
 = 
subjeù
->encoding;

88 
li
->
dœeùiÚ
 = direction;

89 
li
->
™”
 = 
NULL
;

92 
™”_dœeùiÚ
 =

93 
dœeùiÚ
 =ğ
LIST_HEAD
 ? 
AL_START_TAIL
 : 
AL_START_HEAD
;

94 ià(
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

95 
li
->
™”
 = 
	`quickli¡G‘I‹¿tÜAtIdx
Öi->
subjeù
->
±r
,

96 
™”_dœeùiÚ
, 
šdex
);

98 
	`£rv”Pªic
("Unknown†istƒncoding");

100  
li
;

101 
	}
}

104 
	$li¡Ty³R–—£I‹¿tÜ
(
li¡Ty³I‹¿tÜ
 *
li
) {

105 
	`zä“
(
li
->
™”
);

106 
	`zä“
(
li
);

107 
	}
}

112 
	$li¡Ty³Next
(
li¡Ty³I‹¿tÜ
 *
li
, 
li¡Ty³EÁry
 *
’Œy
) {

114 
	`£rv”As£¹
(
li
->
subjeù
->
’codšg
 ==†i->encoding);

116 
’Œy
->
li
 =†i;

117 ià(
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

118  
	`quickli¡Next
(
li
->
™”
, &
’Œy
->entry);

120 
	`£rv”Pªic
("Unknown†istƒncoding");

123 
	}
}

126 
robj
 *
	$li¡Ty³G‘
(
li¡Ty³EÁry
 *
’Œy
) {

127 
robj
 *
v®ue
 = 
NULL
;

128 ià(
’Œy
->
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

129 ià(
’Œy
->’Œy.
v®ue
) {

130 
v®ue
 = 
	`ü—‹SŒšgObjeù
((*)
’Œy
->entry.value,

131 
’Œy
->’Œy.
sz
);

133 
v®ue
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
’Œy
->’Œy.
lÚgv®
);

136 
	`£rv”Pªic
("Unknown†istƒncoding");

138  
v®ue
;

139 
	}
}

141 
	$li¡Ty³In£¹
(
li¡Ty³EÁry
 *
’Œy
, 
robj
 *
v®ue
, 
wh”e
) {

142 ià(
’Œy
->
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

143 
v®ue
 = 
	`g‘DecodedObjeù
(value);

144 
sds
 
¡r
 = 
v®ue
->
±r
;

145 
size_t
 
Ën
 = 
	`sd¦’
(
¡r
);

146 ià(
wh”e
 =ğ
LIST_TAIL
) {

147 
	`quickli¡In£¹Aá”
((
quickli¡
 *)
’Œy
->entry.quicklist,

148 &
’Œy
->’Œy, 
¡r
, 
Ën
);

149 } ià(
wh”e
 =ğ
LIST_HEAD
) {

150 
	`quickli¡In£¹BefÜe
((
quickli¡
 *)
’Œy
->entry.quicklist,

151 &
’Œy
->’Œy, 
¡r
, 
Ën
);

153 
	`deüRefCouÁ
(
v®ue
);

155 
	`£rv”Pªic
("Unknown†istƒncoding");

157 
	}
}

160 
	$li¡Ty³Equ®
(
li¡Ty³EÁry
 *
’Œy
, 
robj
 *
o
) {

161 ià(
’Œy
->
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

162 
	`£rv”As£¹W™hInfo
(
NULL
,
o
,
	`sdsEncodedObjeù
(o));

163  
	`quickli¡Com·»
(
’Œy
->’Œy.
zi
,
o
->
±r
,
	`sd¦’
(o->ptr));

165 
	`£rv”Pªic
("Unknown†istƒncoding");

167 
	}
}

170 
	$li¡Ty³D–‘e
(
li¡Ty³I‹¿tÜ
 *
™”
, 
li¡Ty³EÁry
 *
’Œy
) {

171 ià(
’Œy
->
li
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

172 
	`quickli¡D–EÁry
(
™”
->™”, &
’Œy
->entry);

174 
	`£rv”Pªic
("Unknown†istƒncoding");

176 
	}
}

179 
	$li¡Ty³CÚv”t
(
robj
 *
subjeù
, 
’c
) {

180 
	`£rv”As£¹W™hInfo
(
NULL
,
subjeù
,subjeù->
ty³
==
OBJ_LIST
);

181 
	`£rv”As£¹W™hInfo
(
NULL
,
subjeù
,subjeù->
’codšg
==
OBJ_ENCODING_ZIPLIST
);

183 ià(
’c
 =ğ
OBJ_ENCODING_QUICKLIST
) {

184 
size_t
 
zËn
 = 
£rv”
.
li¡_max_zli¡_size
;

185 
d•th
 = 
£rv”
.
li¡_com´ess_d•th
;

186 
subjeù
->
±r
 = 
	`quickli¡C»©eFromZli¡
(
zËn
, 
d•th
, subject->ptr);

187 
subjeù
->
’codšg
 = 
OBJ_ENCODING_QUICKLIST
;

189 
	`£rv”Pªic
("Unsupported†ist conversion");

191 
	}
}

197 
	$pushG’”icCommªd
(
ş›Á
 *
c
, 
wh”e
) {

198 
j
, 
pushed
 = 0;

199 
robj
 *
lobj
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

201 ià(
lobj
 &&†obj->
ty³
 !ğ
OBJ_LIST
) {

202 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

206 
j
 = 2; j < 
c
->
¬gc
; j++) {

207 ià(!
lobj
) {

208 
lobj
 = 
	`ü—‹Quickli¡Objeù
();

209 
	`quickli¡S‘O±iÚs
(
lobj
->
±r
, 
£rv”
.
li¡_max_zli¡_size
,

210 
£rv”
.
li¡_com´ess_d•th
);

211 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
lobj
);

213 
	`li¡Ty³Push
(
lobj
,
c
->
¬gv
[
j
],
wh”e
);

214 
pushed
++;

216 
	`addR•lyLÚgLÚg
(
c
, (
lobj
 ? 
	`li¡Ty³L’gth
(lobj) : 0));

217 ià(
pushed
) {

218 *
ev’t
 = (
wh”e
 =ğ
LIST_HEAD
) ? "lpush" : "rpush";

220 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

221 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,
ev’t
,
c
->
¬gv
[1],c->
db
->
id
);

223 
£rv”
.
dœty
 +ğ
pushed
;

224 
	}
}

226 
	$ÍushCommªd
(
ş›Á
 *
c
) {

227 
	`pushG’”icCommªd
(
c
,
LIST_HEAD
);

228 
	}
}

230 
	$½ushCommªd
(
ş›Á
 *
c
) {

231 
	`pushG’”icCommªd
(
c
,
LIST_TAIL
);

232 
	}
}

234 
	$pushxG’”icCommªd
(
ş›Á
 *
c
, 
wh”e
) {

235 
j
, 
pushed
 = 0;

236 
robj
 *
subjeù
;

238 ià((
subjeù
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

239 
	`checkTy³
(
c
,
subjeù
,
OBJ_LIST
)) ;

241 
j
 = 2; j < 
c
->
¬gc
; j++) {

242 
	`li¡Ty³Push
(
subjeù
,
c
->
¬gv
[
j
],
wh”e
);

243 
pushed
++;

246 
	`addR•lyLÚgLÚg
(
c
,
	`li¡Ty³L’gth
(
subjeù
));

248 ià(
pushed
) {

249 *
ev’t
 = (
wh”e
 =ğ
LIST_HEAD
) ? "lpush" : "rpush";

250 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

251 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,
ev’t
,
c
->
¬gv
[1],c->
db
->
id
);

253 
£rv”
.
dœty
 +ğ
pushed
;

254 
	}
}

256 
	$ÍushxCommªd
(
ş›Á
 *
c
) {

257 
	`pushxG’”icCommªd
(
c
,
LIST_HEAD
);

258 
	}
}

260 
	$½ushxCommªd
(
ş›Á
 *
c
) {

261 
	`pushxG’”icCommªd
(
c
,
LIST_TAIL
);

262 
	}
}

264 
	$lš£¹Commªd
(
ş›Á
 *
c
) {

265 
wh”e
;

266 
robj
 *
subjeù
;

267 
li¡Ty³I‹¿tÜ
 *
™”
;

268 
li¡Ty³EÁry
 
’Œy
;

269 
š£¹ed
 = 0;

271 ià(
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"after") == 0) {

272 
wh”e
 = 
LIST_TAIL
;

273 } ià(
	`¡rÿ£cmp
(
c
->
¬gv
[2]->
±r
,"before") == 0) {

274 
wh”e
 = 
LIST_HEAD
;

276 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

280 ià((
subjeù
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

281 
	`checkTy³
(
c
,
subjeù
,
OBJ_LIST
)) ;

284 
™”
 = 
	`li¡Ty³In™I‹¿tÜ
(
subjeù
,0,
LIST_TAIL
);

285 
	`li¡Ty³Next
(
™”
,&
’Œy
)) {

286 ià(
	`li¡Ty³Equ®
(&
’Œy
,
c
->
¬gv
[3])) {

287 
	`li¡Ty³In£¹
(&
’Œy
,
c
->
¬gv
[4],
wh”e
);

288 
š£¹ed
 = 1;

292 
	`li¡Ty³R–—£I‹¿tÜ
(
™”
);

294 ià(
š£¹ed
) {

295 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

296 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"linsert",

297 
c
->
¬gv
[1],c->
db
->
id
);

298 
£rv”
.
dœty
++;

301 
	`addR•ly
(
c
,
sh¬ed
.
úegÚe
);

305 
	`addR•lyLÚgLÚg
(
c
,
	`li¡Ty³L’gth
(
subjeù
));

306 
	}
}

308 
	$Î’Commªd
(
ş›Á
 *
c
) {

309 
robj
 *
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
);

310 ià(
o
 =ğ
NULL
 || 
	`checkTy³
(
c
,o,
OBJ_LIST
)) ;

311 
	`addR•lyLÚgLÚg
(
c
,
	`li¡Ty³L’gth
(
o
));

312 
	}
}

314 
	$lšdexCommªd
(
ş›Á
 *
c
) {

315 
robj
 *
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
);

316 ià(
o
 =ğ
NULL
 || 
	`checkTy³
(
c
,o,
OBJ_LIST
)) ;

317 
šdex
;

318 
robj
 *
v®ue
 = 
NULL
;

320 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
šdex
, 
NULL
è!ğ
C_OK
))

323 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

324 
quickli¡EÁry
 
’Œy
;

325 ià(
	`quickli¡Index
(
o
->
±r
, 
šdex
, &
’Œy
)) {

326 ià(
’Œy
.
v®ue
) {

327 
v®ue
 = 
	`ü—‹SŒšgObjeù
((*)
’Œy
.v®ue,’Œy.
sz
);

329 
v®ue
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
’Œy
.
lÚgv®
);

331 
	`addR•lyBulk
(
c
,
v®ue
);

332 
	`deüRefCouÁ
(
v®ue
);

334 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

337 
	`£rv”Pªic
("Unknown†istƒncoding");

339 
	}
}

341 
	$l£tCommªd
(
ş›Á
 *
c
) {

342 
robj
 *
o
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nokey”r
);

343 ià(
o
 =ğ
NULL
 || 
	`checkTy³
(
c
,o,
OBJ_LIST
)) ;

344 
šdex
;

345 
robj
 *
v®ue
 = 
c
->
¬gv
[3];

347 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
šdex
, 
NULL
è!ğ
C_OK
))

350 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

351 
quickli¡
 *
ql
 = 
o
->
±r
;

352 
»¶aûd
 = 
	`quickli¡R•ÏûAtIndex
(
ql
, 
šdex
,

353 
v®ue
->
±r
, 
	`sd¦’
(value->ptr));

354 ià(!
»¶aûd
) {

355 
	`addR•ly
(
c
,
sh¬ed
.
outoäªg“¼
);

357 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

358 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

359 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"l£t",
c
->
¬gv
[1],c->
db
->
id
);

360 
£rv”
.
dœty
++;

363 
	`£rv”Pªic
("Unknown†istƒncoding");

365 
	}
}

367 
	$pİG’”icCommªd
(
ş›Á
 *
c
, 
wh”e
) {

368 
robj
 *
o
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
);

369 ià(
o
 =ğ
NULL
 || 
	`checkTy³
(
c
,o,
OBJ_LIST
)) ;

371 
robj
 *
v®ue
 = 
	`li¡Ty³Pİ
(
o
,
wh”e
);

372 ià(
v®ue
 =ğ
NULL
) {

373 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

375 *
ev’t
 = (
wh”e
 =ğ
LIST_HEAD
) ? "lpop" : "rpop";

377 
	`addR•lyBulk
(
c
,
v®ue
);

378 
	`deüRefCouÁ
(
v®ue
);

379 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,
ev’t
,
c
->
¬gv
[1],c->
db
->
id
);

380 ià(
	`li¡Ty³L’gth
(
o
) == 0) {

381 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"del",

382 
c
->
¬gv
[1],c->
db
->
id
);

383 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

385 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

386 
£rv”
.
dœty
++;

388 
	}
}

390 
	$ÍİCommªd
(
ş›Á
 *
c
) {

391 
	`pİG’”icCommªd
(
c
,
LIST_HEAD
);

392 
	}
}

394 
	$½İCommªd
(
ş›Á
 *
c
) {

395 
	`pİG’”icCommªd
(
c
,
LIST_TAIL
);

396 
	}
}

398 
	$ÌªgeCommªd
(
ş›Á
 *
c
) {

399 
robj
 *
o
;

400 
¡¬t
, 
’d
, 
Î’
, 
¿ng–’
;

402 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
¡¬t
, 
NULL
è!ğ
C_OK
) ||

403 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[3], &
’d
, 
NULL
è!ğ
C_OK
)) ;

405 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL


406 || 
	`checkTy³
(
c
,
o
,
OBJ_LIST
)) ;

407 
Î’
 = 
	`li¡Ty³L’gth
(
o
);

410 ià(
¡¬t
 < 0è¡¬ˆğ
Î’
+start;

411 ià(
’d
 < 0è’d = 
Î’
+end;

412 ià(
¡¬t
 < 0) start = 0;

416 ià(
¡¬t
 > 
’d
 || s¹ >ğ
Î’
) {

417 
	`addR•ly
(
c
,
sh¬ed
.
em±ymuÉibulk
);

420 ià(
’d
 >ğ
Î’
)ƒnd =†len-1;

421 
¿ng–’
 = (
’d
-
¡¬t
)+1;

424 
	`addR•lyMuÉiBulkL’
(
c
,
¿ng–’
);

425 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

426 
li¡Ty³I‹¿tÜ
 *
™”
 = 
	`li¡Ty³In™I‹¿tÜ
(
o
, 
¡¬t
, 
LIST_TAIL
);

428 
¿ng–’
--) {

429 
li¡Ty³EÁry
 
’Œy
;

430 
	`li¡Ty³Next
(
™”
, &
’Œy
);

431 
quickli¡EÁry
 *
qe
 = &
’Œy
.entry;

432 ià(
qe
->
v®ue
) {

433 
	`addR•lyBulkCBufãr
(
c
,
qe
->
v®ue
,qe->
sz
);

435 
	`addR•lyBulkLÚgLÚg
(
c
,
qe
->
lÚgv®
);

438 
	`li¡Ty³R–—£I‹¿tÜ
(
™”
);

440 
	`£rv”Pªic
("Listƒncoding is‚ot QUICKLIST!");

442 
	}
}

444 
	$ÉrimCommªd
(
ş›Á
 *
c
) {

445 
robj
 *
o
;

446 
¡¬t
, 
’d
, 
Î’
, 
Érim
, 
¹rim
;

448 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
¡¬t
, 
NULL
è!ğ
C_OK
) ||

449 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[3], &
’d
, 
NULL
è!ğ
C_OK
)) ;

451 ià((
o
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
ok
)è=ğ
NULL
 ||

452 
	`checkTy³
(
c
,
o
,
OBJ_LIST
)) ;

453 
Î’
 = 
	`li¡Ty³L’gth
(
o
);

456 ià(
¡¬t
 < 0è¡¬ˆğ
Î’
+start;

457 ià(
’d
 < 0è’d = 
Î’
+end;

458 ià(
¡¬t
 < 0) start = 0;

462 ià(
¡¬t
 > 
’d
 || s¹ >ğ
Î’
) {

464 
Érim
 = 
Î’
;

465 
¹rim
 = 0;

467 ià(
’d
 >ğ
Î’
)ƒnd =†len-1;

468 
Érim
 = 
¡¬t
;

469 
¹rim
 = 
Î’
-
’d
-1;

473 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_QUICKLIST
) {

474 
	`quickli¡D–Rªge
(
o
->
±r
,0,
Érim
);

475 
	`quickli¡D–Rªge
(
o
->
±r
,-
¹rim
,rtrim);

477 
	`£rv”Pªic
("Unknown†istƒncoding");

480 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"Érim",
c
->
¬gv
[1],c->
db
->
id
);

481 ià(
	`li¡Ty³L’gth
(
o
) == 0) {

482 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

483 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],c->
db
->
id
);

485 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

486 
£rv”
.
dœty
++;

487 
	`addR•ly
(
c
,
sh¬ed
.
ok
);

488 
	}
}

490 
	$ÌemCommªd
(
ş›Á
 *
c
) {

491 
robj
 *
subjeù
, *
obj
;

492 
obj
 = 
c
->
¬gv
[3];

493 
tÜemove
;

494 
»moved
 = 0;

496 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
tÜemove
, 
NULL
è!ğ
C_OK
))

499 
subjeù
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
);

500 ià(
subjeù
 =ğ
NULL
 || 
	`checkTy³
(
c
,subjeù,
OBJ_LIST
)) ;

502 
li¡Ty³I‹¿tÜ
 *
li
;

503 ià(
tÜemove
 < 0) {

504 
tÜemove
 = -toremove;

505 
li
 = 
	`li¡Ty³In™I‹¿tÜ
(
subjeù
,-1,
LIST_HEAD
);

507 
li
 = 
	`li¡Ty³In™I‹¿tÜ
(
subjeù
,0,
LIST_TAIL
);

510 
li¡Ty³EÁry
 
’Œy
;

511 
	`li¡Ty³Next
(
li
,&
’Œy
)) {

512 ià(
	`li¡Ty³Equ®
(&
’Œy
,
obj
)) {

513 
	`li¡Ty³D–‘e
(
li
, &
’Œy
);

514 
£rv”
.
dœty
++;

515 
»moved
++;

516 ià(
tÜemove
 && 
»moved
 ==oremove) ;

519 
	`li¡Ty³R–—£I‹¿tÜ
(
li
);

521 ià(
»moved
) {

522 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

523 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"Ìem",
c
->
¬gv
[1],c->
db
->
id
);

526 ià(
	`li¡Ty³L’gth
(
subjeù
) == 0) {

527 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

528 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],c->
db
->
id
);

531 
	`addR•lyLÚgLÚg
(
c
,
»moved
);

532 
	}
}

550 
	$½İÍushHªdËPush
(
ş›Á
 *
c
, 
robj
 *
d¡key
,„obj *
d¡obj
,„obj *
v®ue
) {

552 ià(!
d¡obj
) {

553 
d¡obj
 = 
	`ü—‹Quickli¡Objeù
();

554 
	`quickli¡S‘O±iÚs
(
d¡obj
->
±r
, 
£rv”
.
li¡_max_zli¡_size
,

555 
£rv”
.
li¡_com´ess_d•th
);

556 
	`dbAdd
(
c
->
db
,
d¡key
,
d¡obj
);

558 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

559 
	`li¡Ty³Push
(
d¡obj
,
v®ue
,
LIST_HEAD
);

560 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"Íush",
d¡key
,
c
->
db
->
id
);

562 
	`addR•lyBulk
(
c
,
v®ue
);

563 
	}
}

565 
	$½İÍushCommªd
(
ş›Á
 *
c
) {

566 
robj
 *
sobj
, *
v®ue
;

567 ià((
sobj
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

568 
	`checkTy³
(
c
,
sobj
,
OBJ_LIST
)) ;

570 ià(
	`li¡Ty³L’gth
(
sobj
) == 0) {

573 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

575 
robj
 *
dobj
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[2]);

576 
robj
 *
touchedkey
 = 
c
->
¬gv
[1];

578 ià(
dobj
 && 
	`checkTy³
(
c
,dobj,
OBJ_LIST
)) ;

579 
v®ue
 = 
	`li¡Ty³Pİ
(
sobj
,
LIST_TAIL
);

583 
	`šüRefCouÁ
(
touchedkey
);

584 
	`½İÍushHªdËPush
(
c
,c->
¬gv
[2],
dobj
,
v®ue
);

587 
	`deüRefCouÁ
(
v®ue
);

590 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,"½İ",
touchedkey
,
c
->
db
->
id
);

591 ià(
	`li¡Ty³L’gth
(
sobj
) == 0) {

592 
	`dbD–‘e
(
c
->
db
,
touchedkey
);

593 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"del",

594 
touchedkey
,
c
->
db
->
id
);

596 
	`sigÇlModif›dKey
(
c
->
db
,
touchedkey
);

597 
	`deüRefCouÁ
(
touchedkey
);

598 
£rv”
.
dœty
++;

600 
	}
}

625 
	$blockFÜKeys
(
ş›Á
 *
c
, 
robj
 **
keys
, 
numkeys
, 
m¡ime_t
 
timeout
,„obj *
rg‘
) {

626 
diùEÁry
 *
de
;

627 
li¡
 *
l
;

628 
j
;

630 
c
->
bpİ
.
timeout
 =imeout;

631 
c
->
bpİ
.
rg‘
 =arget;

633 ià(
rg‘
 !ğ
NULL
è
	`šüRefCouÁ
(target);

635 
j
 = 0; j < 
numkeys
; j++) {

637 ià(
	`diùAdd
(
c
->
bpİ
.
keys
,keys[
j
],
NULL
è!ğ
DICT_OK
) ;

638 
	`šüRefCouÁ
(
keys
[
j
]);

641 
de
 = 
	`diùFšd
(
c
->
db
->
blockšg_keys
,
keys
[
j
]);

642 ià(
de
 =ğ
NULL
) {

643 
»tv®
;

646 
l
 = 
	`li¡C»©e
();

647 
»tv®
 = 
	`diùAdd
(
c
->
db
->
blockšg_keys
,
keys
[
j
],
l
);

648 
	`šüRefCouÁ
(
keys
[
j
]);

649 
	`£rv”As£¹W™hInfo
(
c
,
keys
[
j
],
»tv®
 =ğ
DICT_OK
);

651 
l
 = 
	`diùG‘V®
(
de
);

653 
	`li¡AddNodeTa
(
l
,
c
);

655 
	`blockCl›Á
(
c
,
BLOCKED_LIST
);

656 
	}
}

660 
	$unblockCl›ÁWa™šgD©a
(
ş›Á
 *
c
) {

661 
diùEÁry
 *
de
;

662 
diùI‹¿tÜ
 *
di
;

663 
li¡
 *
l
;

665 
	`£rv”As£¹W™hInfo
(
c
,
NULL
,
	`diùSize
(c->
bpİ
.
keys
) != 0);

666 
di
 = 
	`diùG‘I‹¿tÜ
(
c
->
bpİ
.
keys
);

668 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

669 
robj
 *
key
 = 
	`diùG‘Key
(
de
);

672 
l
 = 
	`diùF‘chV®ue
(
c
->
db
->
blockšg_keys
,
key
);

673 
	`£rv”As£¹W™hInfo
(
c
,
key
,
l
 !ğ
NULL
);

674 
	`li¡D–Node
(
l
,
	`li¡S—rchKey
Ö,
c
));

676 ià(
	`li¡L’gth
(
l
) == 0)

677 
	`diùD–‘e
(
c
->
db
->
blockšg_keys
,
key
);

679 
	`diùR–—£I‹¿tÜ
(
di
);

682 
	`diùEm±y
(
c
->
bpİ
.
keys
,
NULL
);

683 ià(
c
->
bpİ
.
rg‘
) {

684 
	`deüRefCouÁ
(
c
->
bpİ
.
rg‘
);

685 
c
->
bpİ
.
rg‘
 = 
NULL
;

687 
	}
}

696 
	$sigÇlLi¡AsR—dy
(
»disDb
 *
db
, 
robj
 *
key
) {

697 
»adyLi¡
 *
¾
;

700 ià(
	`diùFšd
(
db
->
blockšg_keys
,
key
è=ğ
NULL
) ;

703 ià(
	`diùFšd
(
db
->
»ady_keys
,
key
è!ğ
NULL
) ;

706 
¾
 = 
	`zm®loc
((*rl));

707 
¾
->
key
 = key;

708 
¾
->
db
 = db;

709 
	`šüRefCouÁ
(
key
);

710 
	`li¡AddNodeTa
(
£rv”
.
»ady_keys
,
¾
);

715 
	`šüRefCouÁ
(
key
);

716 
	`£rv”As£¹
(
	`diùAdd
(
db
->
»ady_keys
,
key
,
NULL
è=ğ
DICT_OK
);

717 
	}
}

738 
	$£rveCl›ÁBlockedOnLi¡
(
ş›Á
 *
»ûiv”
, 
robj
 *
key
,„obj *
d¡key
, 
»disDb
 *
db
,„obj *
v®ue
, 
wh”e
)

740 
robj
 *
¬gv
[3];

742 ià(
d¡key
 =ğ
NULL
) {

744 
¬gv
[0] = (
wh”e
 =ğ
LIST_HEAD
è? 
sh¬ed
.
Íİ
 :

745 
sh¬ed
.
½İ
;

746 
¬gv
[1] = 
key
;

747 
	`´İag©e
((
wh”e
 =ğ
LIST_HEAD
) ?

748 
£rv”
.
ÍİCommªd
 : s”v”.
½İCommªd
,

749 
db
->
id
,
¬gv
,2,
PROPAGATE_AOF
|
PROPAGATE_REPL
);

752 
	`addR•lyMuÉiBulkL’
(
»ûiv”
,2);

753 
	`addR•lyBulk
(
»ûiv”
,
key
);

754 
	`addR•lyBulk
(
»ûiv”
,
v®ue
);

757 
robj
 *
d¡obj
 =

758 
	`lookupKeyWr™e
(
»ûiv”
->
db
,
d¡key
);

759 ià(!(
d¡obj
 &&

760 
	`checkTy³
(
»ûiv”
,
d¡obj
,
OBJ_LIST
)))

763 
¬gv
[0] = 
sh¬ed
.
½İ
;

764 
¬gv
[1] = 
key
;

765 
	`´İag©e
(
£rv”
.
½İCommªd
,

766 
db
->
id
,
¬gv
,2,

767 
PROPAGATE_AOF
|

768 
PROPAGATE_REPL
);

769 
	`½İÍushHªdËPush
(
»ûiv”
,
d¡key
,
d¡obj
,

770 
v®ue
);

772 
¬gv
[0] = 
sh¬ed
.
Íush
;

773 
¬gv
[1] = 
d¡key
;

774 
¬gv
[2] = 
v®ue
;

775 
	`´İag©e
(
£rv”
.
ÍushCommªd
,

776 
db
->
id
,
¬gv
,3,

777 
PROPAGATE_AOF
|

778 
PROPAGATE_REPL
);

782  
C_ERR
;

785  
C_OK
;

786 
	}
}

798 
	$hªdËCl›ÁsBlockedOnLi¡s
() {

799 
	`li¡L’gth
(
£rv”
.
»ady_keys
) != 0) {

800 
li¡
 *
l
;

806 
l
 = 
£rv”
.
»ady_keys
;

807 
£rv”
.
»ady_keys
 = 
	`li¡C»©e
();

809 
	`li¡L’gth
(
l
) != 0) {

810 
li¡Node
 *
Ê
 = 
	`li¡Fœ¡
(
l
);

811 
»adyLi¡
 *
¾
 = 
Ê
->
v®ue
;

815 
	`diùD–‘e
(
¾
->
db
->
»ady_keys
,¾->
key
);

819 
robj
 *
o
 = 
	`lookupKeyWr™e
(
¾
->
db
,¾->
key
);

820 ià(
o
 !ğ
NULL
 && o->
ty³
 =ğ
OBJ_LIST
) {

821 
diùEÁry
 *
de
;

825 
de
 = 
	`diùFšd
(
¾
->
db
->
blockšg_keys
,¾->
key
);

826 ià(
de
) {

827 
li¡
 *
ş›Ás
 = 
	`diùG‘V®
(
de
);

828 
numş›Ás
 = 
	`li¡L’gth
(
ş›Ás
);

830 
numş›Ás
--) {

831 
li¡Node
 *
ş›Ánode
 = 
	`li¡Fœ¡
(
ş›Ás
);

832 
ş›Á
 *
»ûiv”
 = 
ş›Ánode
->
v®ue
;

833 
robj
 *
d¡key
 = 
»ûiv”
->
bpİ
.
rg‘
;

834 
wh”e
 = (
»ûiv”
->
Ï¡cmd
 &&

835 
»ûiv”
->
Ï¡cmd
->
´oc
 =ğ
bÍİCommªd
) ?

836 
LIST_HEAD
 : 
LIST_TAIL
;

837 
robj
 *
v®ue
 = 
	`li¡Ty³Pİ
(
o
,
wh”e
);

839 ià(
v®ue
) {

843 ià(
d¡key
è
	`šüRefCouÁ
(dstkey);

844 
	`unblockCl›Á
(
»ûiv”
);

846 ià(
	`£rveCl›ÁBlockedOnLi¡
(
»ûiv”
,

847 
¾
->
key
,
d¡key
,¾->
db
,
v®ue
,

848 
wh”e
è=ğ
C_ERR
)

852 
	`li¡Ty³Push
(
o
,
v®ue
,
wh”e
);

855 ià(
d¡key
è
	`deüRefCouÁ
(dstkey);

856 
	`deüRefCouÁ
(
v®ue
);

863 ià(
	`li¡Ty³L’gth
(
o
) == 0) {

864 
	`dbD–‘e
(
¾
->
db
,¾->
key
);

871 
	`deüRefCouÁ
(
¾
->
key
);

872 
	`zä“
(
¾
);

873 
	`li¡D–Node
(
l
,
Ê
);

875 
	`li¡R–—£
(
l
);

877 
	}
}

880 
	$blockšgPİG’”icCommªd
(
ş›Á
 *
c
, 
wh”e
) {

881 
robj
 *
o
;

882 
m¡ime_t
 
timeout
;

883 
j
;

885 ià(
	`g‘TimeoutFromObjeùOrR•ly
(
c
,c->
¬gv
[c->
¬gc
-1],&
timeout
,
UNIT_SECONDS
)

886 !ğ
C_OK
) ;

888 
j
 = 1; j < 
c
->
¬gc
-1; j++) {

889 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[
j
]);

890 ià(
o
 !ğ
NULL
) {

891 ià(
o
->
ty³
 !ğ
OBJ_LIST
) {

892 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

895 ià(
	`li¡Ty³L’gth
(
o
) != 0) {

897 *
ev’t
 = (
wh”e
 =ğ
LIST_HEAD
) ? "lpop" : "rpop";

898 
robj
 *
v®ue
 = 
	`li¡Ty³Pİ
(
o
,
wh”e
);

899 
	`£rv”As£¹
(
v®ue
 !ğ
NULL
);

901 
	`addR•lyMuÉiBulkL’
(
c
,2);

902 
	`addR•lyBulk
(
c
,c->
¬gv
[
j
]);

903 
	`addR•lyBulk
(
c
,
v®ue
);

904 
	`deüRefCouÁ
(
v®ue
);

905 
	`nÙifyKey¥aûEv’t
(
NOTIFY_LIST
,
ev’t
,

906 
c
->
¬gv
[
j
],c->
db
->
id
);

907 ià(
	`li¡Ty³L’gth
(
o
) == 0) {

908 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[
j
]);

909 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"del",

910 
c
->
¬gv
[
j
],c->
db
->
id
);

912 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[
j
]);

913 
£rv”
.
dœty
++;

916 
	`»wr™eCl›ÁCommªdVeùÜ
(
c
,2,

917 (
wh”e
 =ğ
LIST_HEAD
è? 
sh¬ed
.
Íİ
 : sh¬ed.
½İ
,

918 
c
->
¬gv
[
j
]);

927 ià(
c
->
æags
 & 
CLIENT_MULTI
) {

928 
	`addR•ly
(
c
,
sh¬ed
.
nuÎmuÉibulk
);

933 
	`blockFÜKeys
(
c
, c->
¬gv
 + 1, c->
¬gc
 - 2, 
timeout
, 
NULL
);

934 
	}
}

936 
	$bÍİCommªd
(
ş›Á
 *
c
) {

937 
	`blockšgPİG’”icCommªd
(
c
,
LIST_HEAD
);

938 
	}
}

940 
	$b½İCommªd
(
ş›Á
 *
c
) {

941 
	`blockšgPİG’”icCommªd
(
c
,
LIST_TAIL
);

942 
	}
}

944 
	$b½İÍushCommªd
(
ş›Á
 *
c
) {

945 
m¡ime_t
 
timeout
;

947 ià(
	`g‘TimeoutFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
timeout
,
UNIT_SECONDS
)

948 !ğ
C_OK
) ;

950 
robj
 *
key
 = 
	`lookupKeyWr™e
(
c
->
db
, c->
¬gv
[1]);

952 ià(
key
 =ğ
NULL
) {

953 ià(
c
->
æags
 & 
CLIENT_MULTI
) {

956 
	`addR•ly
(
c
, 
sh¬ed
.
nuÎbulk
);

959 
	`blockFÜKeys
(
c
, c->
¬gv
 + 1, 1, 
timeout
, c->argv[2]);

962 ià(
key
->
ty³
 !ğ
OBJ_LIST
) {

963 
	`addR•ly
(
c
, 
sh¬ed
.
wrÚgty³”r
);

967 
	`£rv”As£¹W™hInfo
(
c
,
key
,
	`li¡Ty³L’gth
(key) > 0);

968 
	`½İÍushCommªd
(
c
);

971 
	}
}

	@t_set.c

30 
	~"£rv”.h
"

32 
¥¬£InU£
;

38 
suniÚDiffG’”icCommªd
(
ş›Á
 *
c
, 
robj
 **
£tkeys
, 
£Šum
,

39 
robj
 *
d¡key
, 
İ
);

44 
robj
 *
	$£tTy³C»©e
(
sds
 
v®ue
) {

45 ià(
	`isSdsR•»£ÁabËAsLÚgLÚg
(
v®ue
,
NULL
è=ğ
C_OK
)

46  
	`ü—‹IÁ£tObjeù
();

47  
	`ü—‹S‘Objeù
();

48 
	}
}

54 
	$£tTy³Add
(
robj
 *
subjeù
, 
sds
 
v®ue
) {

55 
Îv®
;

56 ià((
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_HT
è&& (!
¥¬£InU£
)) {

57 
diù
 *
ht
 = 
subjeù
->
±r
;

58 
diùEÁry
 *
de
 = 
	`diùAddRaw
(
ht
,
v®ue
,
NULL
);

59 ià(
de
) {

60 
	`diùS‘Key
(
ht
,
de
,
	`sdsdup
(
v®ue
));

61 
	`diùS‘V®
(
ht
,
de
,
NULL
);

64 } ià((
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
è&& (!
¥¬£InU£
)){

65 ià(
	`isSdsR•»£ÁabËAsLÚgLÚg
(
v®ue
,&
Îv®
è=ğ
C_OK
) {

66 
ušt8_t
 
sucûss
 = 0;

67 
subjeù
->
±r
 = 
	`št£tAdd
(subjeù->±r,
Îv®
,&
sucûss
);

68 ià(
sucûss
) {

71 ià(
	`št£tL’
(
subjeù
->
±r
è> 
£rv”
.
£t_max_št£t_’Œ›s
)

72 
	`£tTy³CÚv”t
(
subjeù
,
OBJ_ENCODING_HT
);

77 
	`£tTy³CÚv”t
(
subjeù
,
OBJ_ENCODING_HT
);

81 
	`£rv”As£¹
(
	`diùAdd
(
subjeù
->
±r
,
	`sdsdup
(
v®ue
),
NULL
è=ğ
DICT_OK
);

84 } ià((
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_SPM
è|| (
¥¬£InU£
)) {

86 
diù
 *
ht
 = 
subjeù
->
±r
;

87 
keyCİy
[(
ulÚg
)];

88 
	`memıy
(
keyCİy
, 
v®ue
, (value)+1);

89 
HTI‹m
 *
bck
;

90 
bck
 = 
	`HashIn£¹
(
ht
->
¥mHT
, 
	`PTR_KEY
(ht->¥mHT,
v®ue
), 0);

91 if(
bck
 !ğ
NULL
) {

95 
	`£rv”Pªic
("Unknown setƒncoding");

99 
	}
}

101 
	$£tTy³Remove
(
robj
 *
£tobj
, 
sds
 
v®ue
) {

102 
Îv®
;

103 ià((
£tobj
->
’codšg
 =ğ
OBJ_ENCODING_HT
è&& (!
¥¬£InU£
)) {

104 ià(
	`diùD–‘e
(
£tobj
->
±r
,
v®ue
è=ğ
DICT_OK
) {

105 ià(
	`htN“dsResize
(
£tobj
->
±r
)è
	`diùResize
(setobj->ptr);

108 } ià((
£tobj
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
)&& (!
¥¬£InU£
)) {

109 ià(
	`isSdsR•»£ÁabËAsLÚgLÚg
(
v®ue
,&
Îv®
è=ğ
C_OK
) {

110 
sucûss
;

111 
£tobj
->
±r
 = 
	`št£tRemove
(£tobj->±r,
Îv®
,&
sucûss
);

112 ià(
sucûss
)  1;

114 } ià(
¥¬£InU£
) {

115 
diù
 *
d
 = 
£tobj
->
±r
;

116 
keyCİy
[(
ulÚg
)];

117 
	`memıy
(
keyCİy
, 
v®ue
, (value)+1);

118 ià((
	`HashD–‘e
(
d
->
¥mHT
, 
	`PTR_KEY
(d->¥mHT,
keyCİy
)) == 1)) {

119 
	`£rv”Log
(
LL_NOTICE
,"deleted");

122 
	`£rv”Log
(
LL_NOTICE
, "could‚ot delete");

125 
	`£rv”Pªic
("Unknown setƒncoding");

128 
	}
}

130 
	$£tTy³IsMemb”
(
robj
 *
subjeù
, 
sds
 
v®ue
) {

131 
Îv®
;

132 ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

133  
	`diùFšd
((
diù
*)
subjeù
->
±r
,
v®ue
è!ğ
NULL
;

134 } ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

135 ià(
	`isSdsR•»£ÁabËAsLÚgLÚg
(
v®ue
,&
Îv®
è=ğ
C_OK
) {

136  
	`št£tFšd
((
št£t
*)
subjeù
->
±r
,
Îv®
);

139 
	`£rv”Pªic
("Unknown setƒncoding");

142 
	}
}

144 
£tTy³I‹¿tÜ
 *
	$£tTy³In™I‹¿tÜ
(
robj
 *
subjeù
) {

145 
£tTy³I‹¿tÜ
 *
si
 = 
	`zm®loc
((setTypeIterator));

146 
si
->
subjeù
 = subject;

147 
si
->
’codšg
 = 
subjeù
->encoding;

148 ià(
si
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

149 
si
->
di
 = 
	`diùG‘I‹¿tÜ
(
subjeù
->
±r
);

150 } ià(
si
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

151 
si
->
ii
 = 0;

153 
	`£rv”Pªic
("Unknown setƒncoding");

155  
si
;

156 
	}
}

158 
	$£tTy³R–—£I‹¿tÜ
(
£tTy³I‹¿tÜ
 *
si
) {

159 ià(
si
->
’codšg
 =ğ
OBJ_ENCODING_HT
)

160 
	`diùR–—£I‹¿tÜ
(
si
->
di
);

161 
	`zä“
(
si
);

162 
	}
}

177 
	$£tTy³Next
(
£tTy³I‹¿tÜ
 *
si
, 
sds
 *
sd£Ë
, 
št64_t
 *
Î–e
) {

178 ià(
si
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

179 
diùEÁry
 *
de
 = 
	`diùNext
(
si
->
di
);

180 ià(
de
 =ğ
NULL
)  -1;

181 *
sd£Ë
 = 
	`diùG‘Key
(
de
);

182 *
Î–e
 = -123456789;

183 } ià(
si
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

184 ià(!
	`št£tG‘
(
si
->
subjeù
->
±r
,si->
ii
++,
Î–e
))

186 *
sd£Ë
 = 
NULL
;

188 
	`£rv”Pªic
("Wrong setƒncoding in setTypeNext");

190  
si
->
’codšg
;

191 
	}
}

200 
sds
 
	$£tTy³NextObjeù
(
£tTy³I‹¿tÜ
 *
si
) {

201 
št64_t
 
š‹Ë
;

202 
sds
 
sd£Ë
;

203 
’codšg
;

205 
’codšg
 = 
	`£tTy³Next
(
si
,&
sd£Ë
,&
š‹Ë
);

206 
’codšg
) {

207 -1:  
NULL
;

208 
OBJ_ENCODING_INTSET
:

209  
	`sdsäomlÚglÚg
(
š‹Ë
);

210 
OBJ_ENCODING_HT
:

211  
	`sdsdup
(
sd£Ë
);

213 
	`£rv”Pªic
("Unsupportedƒncoding");

215  
NULL
;

216 
	}
}

231 
	$£tTy³RªdomEËm’t
(
robj
 *
£tobj
, 
sds
 *
sd£Ë
, 
št64_t
 *
Î–e
) {

232 ià(
£tobj
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

233 
diùEÁry
 *
de
 = 
	`diùG‘RªdomKey
(
£tobj
->
±r
);

234 *
sd£Ë
 = 
	`diùG‘Key
(
de
);

235 *
Î–e
 = -123456789;

236 } ià(
£tobj
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

237 *
Î–e
 = 
	`št£tRªdom
(
£tobj
->
±r
);

238 *
sd£Ë
 = 
NULL
;

240 
	`£rv”Pªic
("Unknown setƒncoding");

242  
£tobj
->
’codšg
;

243 
	}
}

245 
	$£tTy³Size
(cÚ¡ 
robj
 *
subjeù
) {

246 ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

247  
	`diùSize
((cÚ¡ 
diù
*)
subjeù
->
±r
);

248 } ià(
subjeù
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

249  
	`št£tL’
((cÚ¡ 
št£t
*)
subjeù
->
±r
);

251 
	`£rv”Pªic
("Unknown setƒncoding");

253 
	}
}

258 
	$£tTy³CÚv”t
(
robj
 *
£tobj
, 
’c
) {

259 
£tTy³I‹¿tÜ
 *
si
;

260 
	`£rv”As£¹W™hInfo
(
NULL
,
£tobj
,£tobj->
ty³
 =ğ
OBJ_SET
 &&

261 
£tobj
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
);

263 ià(
’c
 =ğ
OBJ_ENCODING_HT
) {

264 
št64_t
 
š‹Ë
;

265 
diù
 *
d
 = 
	`diùC»©e
(&
£tDiùTy³
,
NULL
);

266 
sds
 
–em’t
;

269 
	`diùEx·nd
(
d
,
	`št£tL’
(
£tobj
->
±r
));

272 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£tobj
);

273 
	`£tTy³Next
(
si
,&
–em’t
,&
š‹Ë
) != -1) {

274 
–em’t
 = 
	`sdsäomlÚglÚg
(
š‹Ë
);

275 
	`£rv”As£¹
(
	`diùAdd
(
d
,
–em’t
,
NULL
è=ğ
DICT_OK
);

277 
	`£tTy³R–—£I‹¿tÜ
(
si
);

279 
£tobj
->
’codšg
 = 
OBJ_ENCODING_HT
;

280 
	`zä“
(
£tobj
->
±r
);

281 
£tobj
->
±r
 = 
d
;

283 
	`£rv”Pªic
("Unsupported set conversion");

285 
	}
}

287 
	$§ddCommªd
(
ş›Á
 *
c
) {

288 
robj
 *
£t
;

289 
j
, 
added
 = 0;

291 
£t
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

292 ià(
£t
 =ğ
NULL
) {

293 
£t
 = 
	`£tTy³C»©e
(
c
->
¬gv
[2]->
±r
);

294 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
£t
);

296 ià(
£t
->
ty³
 !ğ
OBJ_SET
) {

297 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

302 
j
 = 2; j < 
c
->
¬gc
; j++) {

303 ià(
	`£tTy³Add
(
£t
,
c
->
¬gv
[
j
]->
±r
)è
added
++;

305 ià(
added
) {

306 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

307 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"§dd",
c
->
¬gv
[1],c->
db
->
id
);

309 
£rv”
.
dœty
 +ğ
added
;

310 
	`addR•lyLÚgLÚg
(
c
,
added
);

311 
	}
}

313 
	$¤emCommªd
(
ş›Á
 *
c
) {

314 
robj
 *
£t
;

315 
j
, 
d–‘ed
 = 0, 
key»moved
 = 0;

317 ià((
£t
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

318 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) {

322 
j
 = 2; j < 
c
->
¬gc
; j++) {

323 ià(
	`£tTy³Remove
(
£t
,
c
->
¬gv
[
j
]->
±r
)) {

324 
d–‘ed
++;

325 ià((!
¥¬£InU£
è&& (
	`£tTy³Size
(
£t
) == 0)) {

326 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

327 
key»moved
 = 1;

332 ià(
d–‘ed
) {

333 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

334 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"¤em",
c
->
¬gv
[1],c->
db
->
id
);

335 ià(
key»moved
)

336 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],

337 
c
->
db
->
id
);

338 
£rv”
.
dœty
 +ğ
d–‘ed
;

340 
	`addR•lyLÚgLÚg
(
c
,
d–‘ed
);

341 
	}
}

343 
	$smoveCommªd
(
ş›Á
 *
c
) {

344 
robj
 *
¤c£t
, *
d¡£t
, *
–e
;

345 
¤c£t
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

346 
d¡£t
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[2]);

347 
–e
 = 
c
->
¬gv
[3];

350 ià(
¤c£t
 =ğ
NULL
) {

351 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

357 ià(
	`checkTy³
(
c
,
¤c£t
,
OBJ_SET
) ||

358 (
d¡£t
 && 
	`checkTy³
(
c
,d¡£t,
OBJ_SET
))) ;

361 ià(
¤c£t
 =ğ
d¡£t
) {

362 
	`addR•ly
(
c
,
	`£tTy³IsMemb”
(
¤c£t
,
–e
->
±r
) ?

363 
sh¬ed
.
cÚe
 : sh¬ed.
cz”o
);

368 ià(!
	`£tTy³Remove
(
¤c£t
,
–e
->
±r
)) {

369 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

372 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"¤em",
c
->
¬gv
[1],c->
db
->
id
);

375 ià(
	`£tTy³Size
(
¤c£t
) == 0) {

376 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

377 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],c->
db
->
id
);

381 ià(!
d¡£t
) {

382 
d¡£t
 = 
	`£tTy³C»©e
(
–e
->
±r
);

383 
	`dbAdd
(
c
->
db
,c->
¬gv
[2],
d¡£t
);

386 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

387 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[2]);

388 
£rv”
.
dœty
++;

391 ià(
	`£tTy³Add
(
d¡£t
,
–e
->
±r
)) {

392 
£rv”
.
dœty
++;

393 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"§dd",
c
->
¬gv
[2],c->
db
->
id
);

395 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

396 
	}
}

398 
	$sismemb”Commªd
(
ş›Á
 *
c
) {

399 
robj
 *
£t
;

401 ià((
£t
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

402 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

404 ià(
	`£tTy³IsMemb”
(
£t
,
c
->
¬gv
[2]->
±r
))

405 
	`addR•ly
(
c
,
sh¬ed
.
cÚe
);

407 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

408 
	}
}

410 
	$sÿrdCommªd
(
ş›Á
 *
c
) {

411 
robj
 *
o
;

413 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

414 
	`checkTy³
(
c
,
o
,
OBJ_SET
)) ;

416 
	`addR•lyLÚgLÚg
(
c
,
	`£tTy³Size
(
o
));

417 
	}
}

425 
	#SPOP_MOVE_STRATEGY_MUL
 5

	)

427 
	$¥İW™hCouÁCommªd
(
ş›Á
 *
c
) {

428 
l
;

429 
couÁ
, 
size
;

430 
robj
 *
£t
;

433 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
l
,
NULL
è!ğ
C_OK
) ;

434 ià(
l
 >= 0) {

435 
couÁ
 = (è
l
;

437 
	`addR•ly
(
c
,
sh¬ed
.
outoäªg“¼
);

443 ià((
£t
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ymuÉibulk
))

444 =ğ
NULL
 || 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

448 ià(
couÁ
 == 0) {

449 
	`addR•ly
(
c
,
sh¬ed
.
em±ymuÉibulk
);

453 
size
 = 
	`£tTy³Size
(
£t
);

456 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"¥İ",
c
->
¬gv
[1],c->
db
->
id
);

457 
£rv”
.
dœty
 +ğ
couÁ
;

462 ià(
couÁ
 >ğ
size
) {

464 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+1,1,
NULL
,
SET_OP_UNION
);

467 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

468 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],c->
db
->
id
);

471 
	`»wr™eCl›ÁCommªdVeùÜ
(
c
,2,
sh¬ed
.
d–
,c->
¬gv
[1]);

472 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

473 
£rv”
.
dœty
++;

480 
robj
 *
´İ¬gv
[3];

481 
´İ¬gv
[0] = 
	`ü—‹SŒšgObjeù
("SREM",4);

482 
´İ¬gv
[1] = 
c
->
¬gv
[1];

483 
	`addR•lyMuÉiBulkL’
(
c
,
couÁ
);

486 
sds
 
sd£Ë
;

487 
robj
 *
obj–e
;

488 
’codšg
;

489 
št64_t
 
Î–e
;

490 
»maššg
 = 
size
-
couÁ
;

499 ià(
»maššg
*
SPOP_MOVE_STRATEGY_MUL
 > 
couÁ
) {

500 
couÁ
--) {

502 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
sd£Ë
,&
Î–e
);

503 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

504 
	`addR•lyBulkLÚgLÚg
(
c
,
Î–e
);

505 
obj–e
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î–e
);

506 
£t
->
±r
 = 
	`št£tRemove
(£t->±r,
Î–e
,
NULL
);

508 
	`addR•lyBulkCBufãr
(
c
,
sd£Ë
,
	`sd¦’
(sdsele));

509 
obj–e
 = 
	`ü—‹SŒšgObjeù
(
sd£Ë
,
	`sd¦’
(sdsele));

510 
	`£tTy³Remove
(
£t
,
sd£Ë
);

514 
´İ¬gv
[2] = 
obj–e
;

515 
	`®soPrİag©e
(
£rv”
.
¤emCommªd
,
c
->
db
->
id
,
´İ¬gv
,3,

516 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

517 
	`deüRefCouÁ
(
obj–e
);

528 
robj
 *
Ãw£t
 = 
NULL
;

531 
»maššg
--) {

532 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
sd£Ë
,&
Î–e
);

533 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

534 
sd£Ë
 = 
	`sdsäomlÚglÚg
(
Î–e
);

536 
sd£Ë
 = 
	`sdsdup
(sdsele);

538 ià(!
Ãw£t
èÃw£ˆğ
	`£tTy³C»©e
(
sd£Ë
);

539 
	`£tTy³Add
(
Ãw£t
,
sd£Ë
);

540 
	`£tTy³Remove
(
£t
,
sd£Ë
);

541 
	`sdsä“
(
sd£Ë
);

545 
	`šüRefCouÁ
(
£t
);

546 
	`dbOv”wr™e
(
c
->
db
,c->
¬gv
[1],
Ãw£t
);

549 
£tTy³I‹¿tÜ
 *
si
;

550 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£t
);

551 (
’codšg
 = 
	`£tTy³Next
(
si
,&
sd£Ë
,&
Î–e
)) != -1) {

552 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

553 
	`addR•lyBulkLÚgLÚg
(
c
,
Î–e
);

554 
obj–e
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î–e
);

556 
	`addR•lyBulkCBufãr
(
c
,
sd£Ë
,
	`sd¦’
(sdsele));

557 
obj–e
 = 
	`ü—‹SŒšgObjeù
(
sd£Ë
,
	`sd¦’
(sdsele));

561 
´İ¬gv
[2] = 
obj–e
;

562 
	`®soPrİag©e
(
£rv”
.
¤emCommªd
,
c
->
db
->
id
,
´İ¬gv
,3,

563 
PROPAGATE_AOF
|
PROPAGATE_REPL
);

564 
	`deüRefCouÁ
(
obj–e
);

566 
	`£tTy³R–—£I‹¿tÜ
(
si
);

567 
	`deüRefCouÁ
(
£t
);

574 
	`deüRefCouÁ
(
´İ¬gv
[0]);

575 
	`´ev’tCommªdPrİag©iÚ
(
c
);

576 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

577 
£rv”
.
dœty
++;

578 
	}
}

580 
	$¥İCommªd
(
ş›Á
 *
c
) {

581 
robj
 *
£t
, *
–e
, *
aux
;

582 
sds
 
sd£Ë
;

583 
št64_t
 
Î–e
;

584 
’codšg
;

586 ià(
c
->
¬gc
 == 3) {

587 
	`¥İW™hCouÁCommªd
(
c
);

589 } ià(
c
->
¬gc
 > 3) {

590 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

596 ià((
£t
 = 
	`lookupKeyWr™eOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

597 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

600 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
sd£Ë
,&
Î–e
);

603 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

604 
–e
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î–e
);

605 
£t
->
±r
 = 
	`št£tRemove
(£t->±r,
Î–e
,
NULL
);

607 
–e
 = 
	`ü—‹SŒšgObjeù
(
sd£Ë
,
	`sd¦’
(sdsele));

608 
	`£tTy³Remove
(
£t
,
–e
->
±r
);

611 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"¥İ",
c
->
¬gv
[1],c->
db
->
id
);

614 
aux
 = 
	`ü—‹SŒšgObjeù
("SREM",4);

615 
	`»wr™eCl›ÁCommªdVeùÜ
(
c
,3,
aux
,c->
¬gv
[1],
–e
);

616 
	`deüRefCouÁ
(
aux
);

619 
	`addR•lyBulk
(
c
,
–e
);

620 
	`deüRefCouÁ
(
–e
);

623 ià(
	`£tTy³Size
(
£t
) == 0) {

624 
	`dbD–‘e
(
c
->
db
,c->
¬gv
[1]);

625 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
c
->
¬gv
[1],c->
db
->
id
);

629 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

630 
£rv”
.
dœty
++;

631 
	}
}

639 
	#SRANDMEMBER_SUB_STRATEGY_MUL
 3

	)

641 
	$¤ªdmemb”W™hCouÁCommªd
(
ş›Á
 *
c
) {

642 
l
;

643 
couÁ
, 
size
;

644 
uniq
 = 1;

645 
robj
 *
£t
;

646 
sds
 
–e
;

647 
št64_t
 
Î–e
;

648 
’codšg
;

650 
diù
 *
d
;

652 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
l
,
NULL
è!ğ
C_OK
) ;

653 ià(
l
 >= 0) {

654 
couÁ
 = (è
l
;

658 
couÁ
 = -
l
;

659 
uniq
 = 0;

662 ià((
£t
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ymuÉibulk
))

663 =ğ
NULL
 || 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

664 
size
 = 
	`£tTy³Size
(
£t
);

667 ià(
couÁ
 == 0) {

668 
	`addR•ly
(
c
,
sh¬ed
.
em±ymuÉibulk
);

676 ià(!
uniq
) {

677 
	`addR•lyMuÉiBulkL’
(
c
,
couÁ
);

678 
couÁ
--) {

679 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
–e
,&
Î–e
);

680 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

681 
	`addR•lyBulkLÚgLÚg
(
c
,
Î–e
);

683 
	`addR•lyBulkCBufãr
(
c
,
–e
,
	`sd¦’
(ele));

692 ià(
couÁ
 >ğ
size
) {

693 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+1,1,
NULL
,
SET_OP_UNION
);

698 
d
 = 
	`diùC»©e
(&
objeùKeyPoš‹rV®ueDiùTy³
,
NULL
);

709 ià(
couÁ
*
SRANDMEMBER_SUB_STRATEGY_MUL
 > 
size
) {

710 
£tTy³I‹¿tÜ
 *
si
;

713 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£t
);

714 (
’codšg
 = 
	`£tTy³Next
(
si
,&
–e
,&
Î–e
)) != -1) {

715 
»tv®
 = 
DICT_ERR
;

717 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

718 
»tv®
 = 
	`diùAdd
(
d
,
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î–e
),
NULL
);

720 
»tv®
 = 
	`diùAdd
(
d
,
	`ü—‹SŒšgObjeù
(
–e
,
	`sd¦’
ÓË)),
NULL
);

722 
	`£rv”As£¹
(
»tv®
 =ğ
DICT_OK
);

724 
	`£tTy³R–—£I‹¿tÜ
(
si
);

725 
	`£rv”As£¹
(
	`diùSize
(
d
è=ğ
size
);

728 
size
 > 
couÁ
) {

729 
diùEÁry
 *
de
;

731 
de
 = 
	`diùG‘RªdomKey
(
d
);

732 
	`diùD–‘e
(
d
,
	`diùG‘Key
(
de
));

733 
size
--;

742 
added
 = 0;

743 
robj
 *
obj–e
;

745 
added
 < 
couÁ
) {

746 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
–e
,&
Î–e
);

747 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

748 
obj–e
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
Î–e
);

750 
obj–e
 = 
	`ü—‹SŒšgObjeù
(
–e
,
	`sd¦’
(ele));

755 ià(
	`diùAdd
(
d
,
obj–e
,
NULL
è=ğ
DICT_OK
)

756 
added
++;

758 
	`deüRefCouÁ
(
obj–e
);

764 
diùI‹¿tÜ
 *
di
;

765 
diùEÁry
 *
de
;

767 
	`addR•lyMuÉiBulkL’
(
c
,
couÁ
);

768 
di
 = 
	`diùG‘I‹¿tÜ
(
d
);

769 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
)

770 
	`addR•lyBulk
(
c
,
	`diùG‘Key
(
de
));

771 
	`diùR–—£I‹¿tÜ
(
di
);

772 
	`diùR–—£
(
d
);

774 
	}
}

776 
	$¤ªdmemb”Commªd
(
ş›Á
 *
c
) {

777 
robj
 *
£t
;

778 
sds
 
–e
;

779 
št64_t
 
Î–e
;

780 
’codšg
;

782 ià(
c
->
¬gc
 == 3) {

783 
	`¤ªdmemb”W™hCouÁCommªd
(
c
);

785 } ià(
c
->
¬gc
 > 3) {

786 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

790 ià((
£t
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

791 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

793 
’codšg
 = 
	`£tTy³RªdomEËm’t
(
£t
,&
–e
,&
Î–e
);

794 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

795 
	`addR•lyBulkLÚgLÚg
(
c
,
Î–e
);

797 
	`addR•lyBulkCBufãr
(
c
,
–e
,
	`sd¦’
(ele));

799 
	}
}

801 
	$qsÜtCom·»S‘sByC¬dš®™y
(cÚ¡ *
s1
, cÚ¡ *
s2
) {

802  
	`£tTy³Size
(*(
robj
**)
s1
)-£tTy³Size(*Ôobj**)
s2
);

803 
	}
}

807 
	$qsÜtCom·»S‘sByRevC¬dš®™y
(cÚ¡ *
s1
, cÚ¡ *
s2
) {

808 
robj
 *
o1
 = *Ôobj**)
s1
, *
o2
 = *Ôobj**)
s2
;

810  (
o2
 ? 
	`£tTy³Size
(o2è: 0è- (
o1
 ? setTypeSize(o1) : 0);

811 
	}
}

813 
	$sš‹rG’”icCommªd
(
ş›Á
 *
c
, 
robj
 **
£tkeys
,

814 
£Šum
, 
robj
 *
d¡key
) {

815 
robj
 **
£ts
 = 
	`zm®loc
(Ôobj*)*
£Šum
);

816 
£tTy³I‹¿tÜ
 *
si
;

817 
robj
 *
d¡£t
 = 
NULL
;

818 
sds
 
–esds
;

819 
št64_t
 
štobj
;

820 *
»¶yËn
 = 
NULL
;

821 
j
, 
ÿrdš®™y
 = 0;

822 
’codšg
;

824 
j
 = 0; j < 
£Šum
; j++) {

825 
robj
 *
£tobj
 = 
d¡key
 ?

826 
	`lookupKeyWr™e
(
c
->
db
,
£tkeys
[
j
]) :

827 
	`lookupKeyR—d
(
c
->
db
,
£tkeys
[
j
]);

828 ià(!
£tobj
) {

829 
	`zä“
(
£ts
);

830 ià(
d¡key
) {

831 ià(
	`dbD–‘e
(
c
->
db
,
d¡key
)) {

832 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

833 
£rv”
.
dœty
++;

835 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

837 
	`addR•ly
(
c
,
sh¬ed
.
em±ymuÉibulk
);

841 ià(
	`checkTy³
(
c
,
£tobj
,
OBJ_SET
)) {

842 
	`zä“
(
£ts
);

845 
£ts
[
j
] = 
£tobj
;

849 
	`qsÜt
(
£ts
,
£Šum
,(
robj
*),
qsÜtCom·»S‘sByC¬dš®™y
);

856 ià(!
d¡key
) {

857 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

861 
d¡£t
 = 
	`ü—‹IÁ£tObjeù
();

867 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£ts
[0]);

868 (
’codšg
 = 
	`£tTy³Next
(
si
,&
–esds
,&
štobj
)) != -1) {

869 
j
 = 1; j < 
£Šum
; j++) {

870 ià(
£ts
[
j
] == sets[0]) ;

871 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

873 ià(
£ts
[
j
]->
’codšg
 =ğ
OBJ_ENCODING_INTSET
 &&

874 !
	`št£tFšd
((
št£t
*)
£ts
[
j
]->
±r
,
štobj
))

880 } ià(
£ts
[
j
]->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

881 
–esds
 = 
	`sdsäomlÚglÚg
(
štobj
);

882 ià(!
	`£tTy³IsMemb”
(
£ts
[
j
],
–esds
)) {

883 
	`sdsä“
(
–esds
);

886 
	`sdsä“
(
–esds
);

888 } ià(
’codšg
 =ğ
OBJ_ENCODING_HT
) {

889 ià(!
	`£tTy³IsMemb”
(
£ts
[
j
],
–esds
)) {

896 ià(
j
 =ğ
£Šum
) {

897 ià(!
d¡key
) {

898 ià(
’codšg
 =ğ
OBJ_ENCODING_HT
)

899 
	`addR•lyBulkCBufãr
(
c
,
–esds
,
	`sd¦’
(elesds));

901 
	`addR•lyBulkLÚgLÚg
(
c
,
štobj
);

902 
ÿrdš®™y
++;

904 ià(
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

905 
–esds
 = 
	`sdsäomlÚglÚg
(
štobj
);

906 
	`£tTy³Add
(
d¡£t
,
–esds
);

907 
	`sdsä“
(
–esds
);

909 
	`£tTy³Add
(
d¡£t
,
–esds
);

914 
	`£tTy³R–—£I‹¿tÜ
(
si
);

916 ià(
d¡key
) {

919 
d–‘ed
 = 
	`dbD–‘e
(
c
->
db
,
d¡key
);

920 ià(
	`£tTy³Size
(
d¡£t
) > 0) {

921 
	`dbAdd
(
c
->
db
,
d¡key
,
d¡£t
);

922 
	`addR•lyLÚgLÚg
(
c
,
	`£tTy³Size
(
d¡£t
));

923 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,"sinterstore",

924 
d¡key
,
c
->
db
->
id
);

926 
	`deüRefCouÁ
(
d¡£t
);

927 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

928 ià(
d–‘ed
)

929 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"del",

930 
d¡key
,
c
->
db
->
id
);

932 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

933 
£rv”
.
dœty
++;

935 
	`£tDeã¼edMuÉiBulkL’gth
(
c
,
»¶yËn
,
ÿrdš®™y
);

937 
	`zä“
(
£ts
);

938 
	}
}

940 
	$sš‹rCommªd
(
ş›Á
 *
c
) {

941 
	`sš‹rG’”icCommªd
(
c
,c->
¬gv
+1,c->
¬gc
-1,
NULL
);

942 
	}
}

944 
	$sš‹r¡ÜeCommªd
(
ş›Á
 *
c
) {

945 
	`sš‹rG’”icCommªd
(
c
,c->
¬gv
+2,c->
¬gc
-2,c->argv[1]);

946 
	}
}

948 
	#SET_OP_UNION
 0

	)

949 
	#SET_OP_DIFF
 1

	)

950 
	#SET_OP_INTER
 2

	)

952 
	$suniÚDiffG’”icCommªd
(
ş›Á
 *
c
, 
robj
 **
£tkeys
, 
£Šum
,

953 
robj
 *
d¡key
, 
İ
) {

954 
robj
 **
£ts
 = 
	`zm®loc
(Ôobj*)*
£Šum
);

955 
£tTy³I‹¿tÜ
 *
si
;

956 
robj
 *
d¡£t
 = 
NULL
;

957 
sds
 
–e
;

958 
j
, 
ÿrdš®™y
 = 0;

959 
diff_®go
 = 1;

961 
j
 = 0; j < 
£Šum
; j++) {

962 
robj
 *
£tobj
 = 
d¡key
 ?

963 
	`lookupKeyWr™e
(
c
->
db
,
£tkeys
[
j
]) :

964 
	`lookupKeyR—d
(
c
->
db
,
£tkeys
[
j
]);

965 ià(!
£tobj
) {

966 
£ts
[
j
] = 
NULL
;

969 ià(
	`checkTy³
(
c
,
£tobj
,
OBJ_SET
)) {

970 
	`zä“
(
£ts
);

973 
£ts
[
j
] = 
£tobj
;

985 ià(
İ
 =ğ
SET_OP_DIFF
 && 
£ts
[0]) {

986 
®go_Úe_wÜk
 = 0, 
®go_two_wÜk
 = 0;

988 
j
 = 0; j < 
£Šum
; j++) {

989 ià(
£ts
[
j
] =ğ
NULL
) ;

991 
®go_Úe_wÜk
 +ğ
	`£tTy³Size
(
£ts
[0]);

992 
®go_two_wÜk
 +ğ
	`£tTy³Size
(
£ts
[
j
]);

997 
®go_Úe_wÜk
 /= 2;

998 
diff_®go
 = (
®go_Úe_wÜk
 <ğ
®go_two_wÜk
) ? 1 : 2;

1000 ià(
diff_®go
 =ğ1 && 
£Šum
 > 1) {

1004 
	`qsÜt
(
£ts
+1,
£Šum
-1,(
robj
*),

1005 
qsÜtCom·»S‘sByRevC¬dš®™y
);

1012 
d¡£t
 = 
	`ü—‹IÁ£tObjeù
();

1014 ià(
İ
 =ğ
SET_OP_UNION
) {

1017 
j
 = 0; j < 
£Šum
; j++) {

1018 ià(!
£ts
[
j
]) ;

1020 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£ts
[
j
]);

1021 (
–e
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

1022 ià(
	`£tTy³Add
(
d¡£t
,
–e
)è
ÿrdš®™y
++;

1023 
	`sdsä“
(
–e
);

1025 
	`£tTy³R–—£I‹¿tÜ
(
si
);

1027 } ià(
İ
 =ğ
SET_OP_DIFF
 && 
£ts
[0] && 
diff_®go
 == 1) {

1036 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£ts
[0]);

1037 (
–e
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

1038 
j
 = 1; j < 
£Šum
; j++) {

1039 ià(!
£ts
[
j
]) ;

1040 ià(
£ts
[
j
] == sets[0]) ;

1041 ià(
	`£tTy³IsMemb”
(
£ts
[
j
],
–e
)) ;

1043 ià(
j
 =ğ
£Šum
) {

1045 
	`£tTy³Add
(
d¡£t
,
–e
);

1046 
ÿrdš®™y
++;

1048 
	`sdsä“
(
–e
);

1050 
	`£tTy³R–—£I‹¿tÜ
(
si
);

1051 } ià(
İ
 =ğ
SET_OP_DIFF
 && 
£ts
[0] && 
diff_®go
 == 2) {

1059 
j
 = 0; j < 
£Šum
; j++) {

1060 ià(!
£ts
[
j
]) ;

1062 
si
 = 
	`£tTy³In™I‹¿tÜ
(
£ts
[
j
]);

1063 (
–e
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

1064 ià(
j
 == 0) {

1065 ià(
	`£tTy³Add
(
d¡£t
,
–e
)è
ÿrdš®™y
++;

1067 ià(
	`£tTy³Remove
(
d¡£t
,
–e
)è
ÿrdš®™y
--;

1069 
	`sdsä“
(
–e
);

1071 
	`£tTy³R–—£I‹¿tÜ
(
si
);

1075 ià(
ÿrdš®™y
 == 0) ;

1080 ià(!
d¡key
) {

1081 
	`addR•lyMuÉiBulkL’
(
c
,
ÿrdš®™y
);

1082 
si
 = 
	`£tTy³In™I‹¿tÜ
(
d¡£t
);

1083 (
–e
 = 
	`£tTy³NextObjeù
(
si
)è!ğ
NULL
) {

1084 
	`addR•lyBulkCBufãr
(
c
,
–e
,
	`sd¦’
(ele));

1085 
	`sdsä“
(
–e
);

1087 
	`£tTy³R–—£I‹¿tÜ
(
si
);

1088 
	`deüRefCouÁ
(
d¡£t
);

1092 
d–‘ed
 = 
	`dbD–‘e
(
c
->
db
,
d¡key
);

1093 ià(
	`£tTy³Size
(
d¡£t
) > 0) {

1094 
	`dbAdd
(
c
->
db
,
d¡key
,
d¡£t
);

1095 
	`addR•lyLÚgLÚg
(
c
,
	`£tTy³Size
(
d¡£t
));

1096 
	`nÙifyKey¥aûEv’t
(
NOTIFY_SET
,

1097 
İ
 =ğ
SET_OP_UNION
 ? "sunionstore" : "sdiffstore",

1098 
d¡key
,
c
->
db
->
id
);

1100 
	`deüRefCouÁ
(
d¡£t
);

1101 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

1102 ià(
d–‘ed
)

1103 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"del",

1104 
d¡key
,
c
->
db
->
id
);

1106 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

1107 
£rv”
.
dœty
++;

1109 
	`zä“
(
£ts
);

1110 
	}
}

1112 
	$suniÚCommªd
(
ş›Á
 *
c
) {

1113 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+1,c->
¬gc
-1,
NULL
,
SET_OP_UNION
);

1114 
	}
}

1116 
	$suniÚ¡ÜeCommªd
(
ş›Á
 *
c
) {

1117 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+2,c->
¬gc
-2,c->¬gv[1],
SET_OP_UNION
);

1118 
	}
}

1120 
	$sdiffCommªd
(
ş›Á
 *
c
) {

1121 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+1,c->
¬gc
-1,
NULL
,
SET_OP_DIFF
);

1122 
	}
}

1124 
	$sdiff¡ÜeCommªd
(
ş›Á
 *
c
) {

1125 
	`suniÚDiffG’”icCommªd
(
c
,c->
¬gv
+2,c->
¬gc
-2,c->¬gv[1],
SET_OP_DIFF
);

1126 
	}
}

1128 
	$ssÿnCommªd
(
ş›Á
 *
c
) {

1129 
robj
 *
£t
;

1130 
cursÜ
;

1132 ià(
	`·r£SÿnCursÜOrR•ly
(
c
,c->
¬gv
[2],&
cursÜ
è=ğ
C_ERR
) ;

1133 ià((
£t
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ysÿn
)è=ğ
NULL
 ||

1134 
	`checkTy³
(
c
,
£t
,
OBJ_SET
)) ;

1135 
	`sÿnG’”icCommªd
(
c
,
£t
,
cursÜ
);

1136 
	}
}

	@t_string.c

30 
	~"£rv”.h
"

31 
	~<m©h.h
>

33 
¥¬£InU£
;

39 
	$checkSŒšgL’gth
(
ş›Á
 *
c
, 
size
) {

40 ià(
size
 > 512*1024*1024) {

41 
	`addR•lyE¼Ü
(
c
,"stringƒxceeds maximum‡llowed size (512MB)");

42  
C_ERR
;

44  
C_OK
;

45 
	}
}

63 
	#OBJ_SET_NO_FLAGS
 0

	)

64 
	#OBJ_SET_NX
 (1<<0è

	)

65 
	#OBJ_SET_XX
 (1<<1è

	)

66 
	#OBJ_SET_EX
 (1<<2è

	)

67 
	#OBJ_SET_PX
 (1<<3è

	)

69 
	$£tG’”icCommªd
(
ş›Á
 *
c
, 
æags
, 
robj
 *
key
,„obj *
v®
,„obj *
expœe
, 
un™
,„obj *
ok_»¶y
,„obj *
abÜt_»¶y
) {

70 
mli£cÚds
 = 0;

72 ià(
expœe
) {

73 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, 
expœe
, &
mli£cÚds
, 
NULL
è!ğ
C_OK
)

75 ià(
mli£cÚds
 <= 0) {

76 
	`addR•lyE¼ÜFÜm©
(
c
,"šv®idƒxpœtimš %s",c->
cmd
->
Çme
);

79 ià(
un™
 =ğ
UNIT_SECONDS
è
mli£cÚds
 *= 1000;

82 ià((
æags
 & 
OBJ_SET_NX
 && 
	`lookupKeyWr™e
(
c
->
db
,
key
è!ğ
NULL
) ||

83 (
æags
 & 
OBJ_SET_XX
 && 
	`lookupKeyWr™e
(
c
->
db
,
key
è=ğ
NULL
))

85 
	`addR•ly
(
c
, 
abÜt_»¶y
 ?‡bÜt_»¶y : 
sh¬ed
.
nuÎbulk
);

88 
	`£tKey
(
c
->
db
,
key
,
v®
);

89 
£rv”
.
dœty
++;

90 ià(
expœe
è
	`£tExpœe
(
c
->
db
,
key
,
	`m¡ime
()+
mli£cÚds
);

91 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£t",
key
,
c
->
db
->
id
);

92 ià(
expœe
è
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,

93 "expœe",
key
,
c
->
db
->
id
);

94 
	`addR•ly
(
c
, 
ok_»¶y
 ? ok_»¶y : 
sh¬ed
.
ok
);

95 
	}
}

98 
	$£tCommªd
(
ş›Á
 *
c
) {

99 
j
;

100 
robj
 *
expœe
 = 
NULL
;

101 
un™
 = 
UNIT_SECONDS
;

102 
æags
 = 
OBJ_SET_NO_FLAGS
;

104 
j
 = 3; j < 
c
->
¬gc
; j++) {

105 *
a
 = 
c
->
¬gv
[
j
]->
±r
;

106 
robj
 *
Ãxt
 = (
j
 =ğ
c
->
¬gc
-1è? 
NULL
 : c->
¬gv
[j+1];

108 ià((
a
[0] == 'n' ||‡[0] == 'N') &&

109 (
a
[1] == 'x' ||‡[1] == 'X') &&‡[2] == '\0' &&

110 !(
æags
 & 
OBJ_SET_XX
))

112 
æags
 |ğ
OBJ_SET_NX
;

113 } ià((
a
[0] == 'x' ||‡[0] == 'X') &&

114 (
a
[1] == 'x' ||‡[1] == 'X') &&‡[2] == '\0' &&

115 !(
æags
 & 
OBJ_SET_NX
))

117 
æags
 |ğ
OBJ_SET_XX
;

118 } ià((
a
[0] == 'e' ||‡[0] == 'E') &&

119 (
a
[1] == 'x' ||‡[1] == 'X') &&‡[2] == '\0' &&

120 !(
æags
 & 
OBJ_SET_PX
è&& 
Ãxt
)

122 
æags
 |ğ
OBJ_SET_EX
;

123 
un™
 = 
UNIT_SECONDS
;

124 
expœe
 = 
Ãxt
;

125 
j
++;

126 } ià((
a
[0] == 'p' ||‡[0] == 'P') &&

127 (
a
[1] == 'x' ||‡[1] == 'X') &&‡[2] == '\0' &&

128 !(
æags
 & 
OBJ_SET_EX
è&& 
Ãxt
)

130 
æags
 |ğ
OBJ_SET_PX
;

131 
un™
 = 
UNIT_MILLISECONDS
;

132 
expœe
 = 
Ãxt
;

133 
j
++;

135 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

140 
c
->
¬gv
[2] = 
	`ŒyObjeùEncodšg
(c->argv[2]);

141 
	`£tG’”icCommªd
(
c
,
æags
,c->
¬gv
[1],c->¬gv[2],
expœe
,
un™
,
NULL
,NULL);

142 
	}
}

144 
	$£ŠxCommªd
(
ş›Á
 *
c
) {

145 
c
->
¬gv
[2] = 
	`ŒyObjeùEncodšg
(c->argv[2]);

146 
	`£tG’”icCommªd
(
c
,
OBJ_SET_NX
,c->
¬gv
[1],c->¬gv[2],
NULL
,0,
sh¬ed
.
cÚe
,sh¬ed.
cz”o
);

147 
	}
}

149 
	$£‹xCommªd
(
ş›Á
 *
c
) {

150 
c
->
¬gv
[3] = 
	`ŒyObjeùEncodšg
(c->argv[3]);

151 
	`£tG’”icCommªd
(
c
,
OBJ_SET_NO_FLAGS
,c->
¬gv
[1],c->¬gv[3],c->¬gv[2],
UNIT_SECONDS
,
NULL
,NULL);

152 
	}
}

154 
	$p£‹xCommªd
(
ş›Á
 *
c
) {

155 
c
->
¬gv
[3] = 
	`ŒyObjeùEncodšg
(c->argv[3]);

156 
	`£tG’”icCommªd
(
c
,
OBJ_SET_NO_FLAGS
,c->
¬gv
[1],c->¬gv[3],c->¬gv[2],
UNIT_MILLISECONDS
,
NULL
,NULL);

157 
	}
}

159 
	$g‘G’”icCommªd
(
ş›Á
 *
c
) {

160 
robj
 *
o
;

162 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
nuÎbulk
)è=ğ
NULL
)

163  
C_OK
;

165 ià(
o
->
ty³
 !ğ
OBJ_STRING
) {

166 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

167  
C_ERR
;

170 
	`addR•lyBulk
(
c
,
o
);

171  
C_OK
;

173 
	}
}

175 
	$g‘Commªd
(
ş›Á
 *
c
) {

176 
	`g‘G’”icCommªd
(
c
);

177 
	}
}

179 
	$g‘£tCommªd
(
ş›Á
 *
c
) {

180 ià(
	`g‘G’”icCommªd
(
c
è=ğ
C_ERR
) ;

181 
c
->
¬gv
[2] = 
	`ŒyObjeùEncodšg
(c->argv[2]);

182 
	`£tKey
(
c
->
db
,c->
¬gv
[1],c->argv[2]);

183 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£t",
c
->
¬gv
[1],c->
db
->
id
);

184 
£rv”
.
dœty
++;

185 
	}
}

187 
	$£ŒªgeCommªd
(
ş›Á
 *
c
) {

188 
robj
 *
o
;

189 
off£t
;

190 
sds
 
v®ue
 = 
c
->
¬gv
[3]->
±r
;

192 ià(
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
off£t
,
NULL
è!ğ
C_OK
)

195 ià(
off£t
 < 0) {

196 
	`addR•lyE¼Ü
(
c
,"offset is out of„ange");

200 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

201 ià(
o
 =ğ
NULL
) {

203 ià(
	`sd¦’
(
v®ue
) == 0) {

204 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

209 ià(
	`checkSŒšgL’gth
(
c
,
off£t
+
	`sd¦’
(
v®ue
)è!ğ
C_OK
)

212 
o
 = 
	`ü—‹Objeù
(
OBJ_STRING
,
	`sd¢ewËn
(
NULL
, 
off£t
+
	`sd¦’
(
v®ue
)));

213 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
o
);

215 
size_t
 
Ş’
;

218 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
))

222 
Ş’
 = 
	`¡ršgObjeùL’
(
o
);

223 ià(
	`sd¦’
(
v®ue
) == 0) {

224 
	`addR•lyLÚgLÚg
(
c
,
Ş’
);

229 ià(
	`checkSŒšgL’gth
(
c
,
off£t
+
	`sd¦’
(
v®ue
)è!ğ
C_OK
)

233 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

236 ià(
	`sd¦’
(
v®ue
) > 0) {

237 
o
->
±r
 = 
	`sdsgrowz”o
(o->±r,
off£t
+
	`sd¦’
(
v®ue
));

238 
	`memıy
((*)
o
->
±r
+
off£t
,
v®ue
,
	`sd¦’
(value));

239 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

240 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,

241 "£Œªge",
c
->
¬gv
[1],c->
db
->
id
);

242 
£rv”
.
dœty
++;

244 
	`addR•lyLÚgLÚg
(
c
,
	`sd¦’
(
o
->
±r
));

245 
	}
}

247 
	$g‘¿ngeCommªd
(
ş›Á
 *
c
) {

248 
robj
 *
o
;

249 
¡¬t
, 
’d
;

250 *
¡r
, 
Îbuf
[32];

251 
size_t
 
¡¾’
;

253 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
¡¬t
,
NULL
è!ğ
C_OK
)

255 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
’d
,
NULL
è!ğ
C_OK
)

257 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ybulk
)è=ğ
NULL
 ||

258 
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) ;

260 ià(
o
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

261 
¡r
 = 
Îbuf
;

262 
¡¾’
 = 
	`Î2¡ršg
(
Îbuf
,Ölbuf),()
o
->
±r
);

264 
¡r
 = 
o
->
±r
;

265 
¡¾’
 = 
	`sd¦’
(
¡r
);

269 ià(
¡¬t
 < 0 && 
’d
 < 0 && start >ƒnd) {

270 
	`addR•ly
(
c
,
sh¬ed
.
em±ybulk
);

273 ià(
¡¬t
 < 0è¡¬ˆğ
¡¾’
+start;

274 ià(
’d
 < 0è’d = 
¡¾’
+end;

275 ià(
¡¬t
 < 0) start = 0;

276 ià(
’d
 < 0)ƒnd = 0;

277 ià(()
’d
 >ğ
¡¾’
)ƒnd = strlen-1;

281 ià(
¡¬t
 > 
’d
 || 
¡¾’
 == 0) {

282 
	`addR•ly
(
c
,
sh¬ed
.
em±ybulk
);

284 
	`addR•lyBulkCBufãr
(
c
,(*)
¡r
+
¡¬t
,
’d
-start+1);

286 
	}
}

288 
	$mg‘Commªd
(
ş›Á
 *
c
) {

289 
j
;

291 
	`addR•lyMuÉiBulkL’
(
c
,c->
¬gc
-1);

292 
j
 = 1; j < 
c
->
¬gc
; j++) {

293 
robj
 *
o
 = 
	`lookupKeyR—d
(
c
->
db
,c->
¬gv
[
j
]);

294 ià(
o
 =ğ
NULL
) {

295 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

297 ià(
o
->
ty³
 !ğ
OBJ_STRING
) {

298 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

300 
	`addR•lyBulk
(
c
,
o
);

304 
	}
}

306 
	$m£tG’”icCommªd
(
ş›Á
 *
c
, 
nx
) {

307 
j
, 
busykeys
 = 0;

309 ià((
c
->
¬gc
 % 2) == 0) {

310 
	`addR•lyE¼Ü
(
c
,"wrong‚umber of‡rguments for MSET");

315 ià(
nx
) {

316 
j
 = 1; j < 
c
->
¬gc
; j += 2) {

317 ià(
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[
j
]è!ğ
NULL
) {

318 
busykeys
++;

321 ià(
busykeys
) {

322 
	`addR•ly
(
c
, 
sh¬ed
.
cz”o
);

327 
j
 = 1; j < 
c
->
¬gc
; j += 2) {

328 
c
->
¬gv
[
j
+1] = 
	`ŒyObjeùEncodšg
(c->argv[j+1]);

329 
	`£tKey
(
c
->
db
,c->
¬gv
[
j
],c->argv[j+1]);

330 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"£t",
c
->
¬gv
[
j
],c->
db
->
id
);

332 
£rv”
.
dœty
 +ğ(
c
->
¬gc
-1)/2;

333 
	`addR•ly
(
c
, 
nx
 ? 
sh¬ed
.
cÚe
 : sh¬ed.
ok
);

334 
	}
}

336 
	$m£tCommªd
(
ş›Á
 *
c
) {

337 
	`m£tG’”icCommªd
(
c
,0);

338 
	}
}

340 
	$m£ŠxCommªd
(
ş›Á
 *
c
) {

341 
	`m£tG’”icCommªd
(
c
,1);

342 
	}
}

344 
	$šüDeüCommªd
(
ş›Á
 *
c
, 
šü
) {

345 
v®ue
, 
Şdv®ue
;

346 
robj
 *
o
, *
Ãw
;

348 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

349 ià(
o
 !ğ
NULL
 && 
	`checkTy³
(
c
,o,
OBJ_STRING
)) ;

350 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
,
o
,&
v®ue
,
NULL
è!ğ
C_OK
) ;

352 
Şdv®ue
 = 
v®ue
;

353 ià((
šü
 < 0 && 
Şdv®ue
 < 0 && inü < (
LLONG_MIN
-oldvalue)) ||

354 (
šü
 > 0 && 
Şdv®ue
 > 0 && inü > (
LLONG_MAX
-oldvalue))) {

355 
	`addR•lyE¼Ü
(
c
,"increment or decrement would overflow");

358 
v®ue
 +ğ
šü
;

360 ià(
o
 && o->
»fcouÁ
 =ğ1 && o->
’codšg
 =ğ
OBJ_ENCODING_INT
 &&

361 (
v®ue
 < 0 || v®u>ğ
OBJ_SHARED_INTEGERS
) &&

362 
v®ue
 >ğ
LONG_MIN
 && v®u<ğ
LONG_MAX
)

364 
Ãw
 = 
o
;

365 
o
->
±r
 = (*)(()
v®ue
);

367 
Ãw
 = 
	`ü—‹SŒšgObjeùFromLÚgLÚg
(
v®ue
);

368 ià(
o
) {

369 
	`dbOv”wr™e
(
c
->
db
,c->
¬gv
[1],
Ãw
);

371 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
Ãw
);

374 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

375 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"šüby",
c
->
¬gv
[1],c->
db
->
id
);

376 
£rv”
.
dœty
++;

377 
	`addR•ly
(
c
,
sh¬ed
.
cŞÚ
);

378 
	`addR•ly
(
c
,
Ãw
);

379 
	`addR•ly
(
c
,
sh¬ed
.
ülf
);

380 
	}
}

382 
	$šüCommªd
(
ş›Á
 *
c
) {

383 
	`šüDeüCommªd
(
c
,1);

384 
	}
}

386 
	$deüCommªd
(
ş›Á
 *
c
) {

387 
	`šüDeüCommªd
(
c
,-1);

388 
	}
}

390 
	$šübyCommªd
(
ş›Á
 *
c
) {

391 
šü
;

393 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
šü
, 
NULL
è!ğ
C_OK
) ;

394 
	`šüDeüCommªd
(
c
,
šü
);

395 
	}
}

397 
	$deübyCommªd
(
ş›Á
 *
c
) {

398 
šü
;

400 ià(
	`g‘LÚgLÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
šü
, 
NULL
è!ğ
C_OK
) ;

401 
	`šüDeüCommªd
(
c
,-
šü
);

402 
	}
}

404 
	$šübyæßtCommªd
(
ş›Á
 *
c
) {

405 
šü
, 
v®ue
;

406 
robj
 *
o
, *
Ãw
, *
aux
;

408 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

409 ià(
o
 !ğ
NULL
 && 
	`checkTy³
(
c
,o,
OBJ_STRING
)) ;

410 ià(
	`g‘LÚgDoubËFromObjeùOrR•ly
(
c
,
o
,&
v®ue
,
NULL
è!ğ
C_OK
 ||

411 
	`g‘LÚgDoubËFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
šü
,
NULL
è!ğ
C_OK
)

414 
v®ue
 +ğ
šü
;

415 ià(
	`i¢ª
(
v®ue
è|| 
	`isšf
(value)) {

416 
	`addR•lyE¼Ü
(
c
,"increment would…roduce NaN or Infinity");

419 
Ãw
 = 
	`ü—‹SŒšgObjeùFromLÚgDoubË
(
v®ue
,1);

420 ià(
o
)

421 
	`dbOv”wr™e
(
c
->
db
,c->
¬gv
[1],
Ãw
);

423 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],
Ãw
);

424 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

425 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"šübyæßt",
c
->
¬gv
[1],c->
db
->
id
);

426 
£rv”
.
dœty
++;

427 
	`addR•lyBulk
(
c
,
Ãw
);

432 
aux
 = 
	`ü—‹SŒšgObjeù
("SET",3);

433 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,0,
aux
);

434 
	`deüRefCouÁ
(
aux
);

435 
	`»wr™eCl›ÁCommªdArgum’t
(
c
,2,
Ãw
);

436 
	}
}

438 
	$­³ndCommªd
(
ş›Á
 *
c
) {

439 
size_t
 
tÙËn
;

440 
robj
 *
o
, *
­³nd
;

442 
o
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[1]);

443 ià(
o
 =ğ
NULL
) {

445 
c
->
¬gv
[2] = 
	`ŒyObjeùEncodšg
(c->argv[2]);

446 
	`dbAdd
(
c
->
db
,c->
¬gv
[1],c->argv[2]);

447 
	`šüRefCouÁ
(
c
->
¬gv
[2]);

448 
tÙËn
 = 
	`¡ršgObjeùL’
(
c
->
¬gv
[2]);

451 ià(
	`checkTy³
(
c
,
o
,
OBJ_STRING
))

455 
­³nd
 = 
c
->
¬gv
[2];

456 
tÙËn
 = 
	`¡ršgObjeùL’
(
o
)+
	`sd¦’
(
­³nd
->
±r
);

457 ià(
	`checkSŒšgL’gth
(
c
,
tÙËn
è!ğ
C_OK
)

461 
o
 = 
	`dbUnsh¬eSŒšgV®ue
(
c
->
db
,c->
¬gv
[1],o);

462 
o
->
±r
 = 
	`sdsÿ’
(o->±r,
­³nd
->±r,
	`sd¦’
(append->ptr));

463 
tÙËn
 = 
	`sd¦’
(
o
->
±r
);

465 
	`sigÇlModif›dKey
(
c
->
db
,c->
¬gv
[1]);

466 
	`nÙifyKey¥aûEv’t
(
NOTIFY_STRING
,"­³nd",
c
->
¬gv
[1],c->
db
->
id
);

467 
£rv”
.
dœty
++;

468 
	`addR•lyLÚgLÚg
(
c
,
tÙËn
);

469 
	}
}

471 
	$¡¾’Commªd
(
ş›Á
 *
c
) {

472 
robj
 *
o
;

473 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

474 
	`checkTy³
(
c
,
o
,
OBJ_STRING
)) ;

475 
	`addR•lyLÚgLÚg
(
c
,
	`¡ršgObjeùL’
(
o
));

476 
	}
}

	@t_zset.c

59 
	~"£rv”.h
"

60 
	~<m©h.h
>

66 
z¦LexV®ueG‹Mš
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
);

67 
z¦LexV®ueL‹Max
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
);

71 
zskli¡Node
 *
	$z¦C»©eNode
(
Ëv–
, 
scÜe
, 
sds
 
–e
) {

72 
zskli¡Node
 *
zn
 =

73 
	`zm®loc
((*
zn
)+
Ëv–
*(
zskli¡Lev–
));

74 
zn
->
scÜe
 = score;

75 
zn
->
–e
 =ƒle;

76  
zn
;

77 
	}
}

80 
zskli¡
 *
	$z¦C»©e
() {

81 
j
;

82 
zskli¡
 *
z¦
;

84 
z¦
 = 
	`zm®loc
((*zsl));

85 
z¦
->
Ëv–
 = 1;

86 
z¦
->
Ëngth
 = 0;

87 
z¦
->
h—d”
 = 
	`z¦C»©eNode
(
ZSKIPLIST_MAXLEVEL
,0,
NULL
);

88 
j
 = 0; j < 
ZSKIPLIST_MAXLEVEL
; j++) {

89 
z¦
->
h—d”
->
Ëv–
[
j
].
fÜw¬d
 = 
NULL
;

90 
z¦
->
h—d”
->
Ëv–
[
j
].
¥ª
 = 0;

92 
z¦
->
h—d”
->
backw¬d
 = 
NULL
;

93 
z¦
->

 = 
NULL
;

94  
z¦
;

95 
	}
}

100 
	$z¦F»eNode
(
zskli¡Node
 *
node
) {

101 
	`sdsä“
(
node
->
–e
);

102 
	`zä“
(
node
);

103 
	}
}

106 
	$z¦F»e
(
zskli¡
 *
z¦
) {

107 
zskli¡Node
 *
node
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
, *
Ãxt
;

109 
	`zä“
(
z¦
->
h—d”
);

110 
node
) {

111 
Ãxt
 = 
node
->
Ëv–
[0].
fÜw¬d
;

112 
	`z¦F»eNode
(
node
);

113 
node
 = 
Ãxt
;

115 
	`zä“
(
z¦
);

116 
	}
}

122 
	$z¦RªdomLev–
() {

123 
Ëv–
 = 1;

124 (
	`¿ndom
()&0xFFFFè< (
ZSKIPLIST_P
 * 0xFFFF))

125 
Ëv–
 += 1;

126  (
Ëv–
<
ZSKIPLIST_MAXLEVEL
) ?†evel : ZSKIPLIST_MAXLEVEL;

127 
	}
}

132 
zskli¡Node
 *
	$z¦In£¹
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
–e
) {

133 
zskli¡Node
 *
upd©e
[
ZSKIPLIST_MAXLEVEL
], *
x
;

134 
¿nk
[
ZSKIPLIST_MAXLEVEL
];

135 
i
, 
Ëv–
;

137 
	`£rv”As£¹
(!
	`i¢ª
(
scÜe
));

138 
x
 = 
z¦
->
h—d”
;

139 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

141 
¿nk
[
i
] = i =ğ(
z¦
->
Ëv–
-1) ? 0 :„ank[i+1];

142 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

143 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 < score ||

144 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 == score &&

145 
	`sdscmp
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,ele) < 0)))

147 
¿nk
[
i
] +ğ
x
->
Ëv–
[i].
¥ª
;

148 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

150 
upd©e
[
i
] = 
x
;

156 
Ëv–
 = 
	`z¦RªdomLev–
();

157 ià(
Ëv–
 > 
z¦
->level) {

158 
i
 = 
z¦
->
Ëv–
; i <†evel; i++) {

159 
¿nk
[
i
] = 0;

160 
upd©e
[
i
] = 
z¦
->
h—d”
;

161 
upd©e
[
i
]->
Ëv–
[i].
¥ª
 = 
z¦
->
Ëngth
;

163 
z¦
->
Ëv–
 =†evel;

165 
x
 = 
	`z¦C»©eNode
(
Ëv–
,
scÜe
,
–e
);

166 
i
 = 0; i < 
Ëv–
; i++) {

167 
x
->
Ëv–
[
i
].
fÜw¬d
 = 
upd©e
[i]->level[i].forward;

168 
upd©e
[
i
]->
Ëv–
[i].
fÜw¬d
 = 
x
;

171 
x
->
Ëv–
[
i
].
¥ª
 = 
upd©e
[i]->Ëv–[i].¥ª - (
¿nk
[0] -„ank[i]);

172 
upd©e
[
i
]->
Ëv–
[i].
¥ª
 = (
¿nk
[0] -„ank[i]) + 1;

176 
i
 = 
Ëv–
; i < 
z¦
->level; i++) {

177 
upd©e
[
i
]->
Ëv–
[i].
¥ª
++;

180 
x
->
backw¬d
 = (
upd©e
[0] =ğ
z¦
->
h—d”
è? 
NULL
 : update[0];

181 ià(
x
->
Ëv–
[0].
fÜw¬d
)

182 
x
->
Ëv–
[0].
fÜw¬d
->
backw¬d
 = x;

184 
z¦
->

 = 
x
;

185 
z¦
->
Ëngth
++;

186  
x
;

187 
	}
}

190 
	$z¦D–‘eNode
(
zskli¡
 *
z¦
, 
zskli¡Node
 *
x
, zskli¡Nod**
upd©e
) {

191 
i
;

192 
i
 = 0; i < 
z¦
->
Ëv–
; i++) {

193 ià(
upd©e
[
i
]->
Ëv–
[i].
fÜw¬d
 =ğ
x
) {

194 
upd©e
[
i
]->
Ëv–
[i].
¥ª
 +ğ
x
->level[i].span - 1;

195 
upd©e
[
i
]->
Ëv–
[i].
fÜw¬d
 = 
x
->level[i].forward;

197 
upd©e
[
i
]->
Ëv–
[i].
¥ª
 -= 1;

200 ià(
x
->
Ëv–
[0].
fÜw¬d
) {

201 
x
->
Ëv–
[0].
fÜw¬d
->
backw¬d
 = x->backward;

203 
z¦
->

 = 
x
->
backw¬d
;

205 
z¦
->
Ëv–
 > 1 && z¦->
h—d”
->Ëv–[z¦->Ëv–-1].
fÜw¬d
 =ğ
NULL
)

206 
z¦
->
Ëv–
--;

207 
z¦
->
Ëngth
--;

208 
	}
}

218 
	$z¦D–‘e
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
–e
, 
zskli¡Node
 **
node
) {

219 
zskli¡Node
 *
upd©e
[
ZSKIPLIST_MAXLEVEL
], *
x
;

220 
i
;

222 
x
 = 
z¦
->
h—d”
;

223 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

224 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

225 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 < score ||

226 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 == score &&

227 
	`sdscmp
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,ele) < 0)))

229 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

231 
upd©e
[
i
] = 
x
;

235 
x
 = x->
Ëv–
[0].
fÜw¬d
;

236 ià(
x
 && 
scÜe
 =ğx->scÜ&& 
	`sdscmp
(x->
–e
,ele) == 0) {

237 
	`z¦D–‘eNode
(
z¦
, 
x
, 
upd©e
);

238 ià(!
node
)

239 
	`z¦F»eNode
(
x
);

241 *
node
 = 
x
;

245 
	}
}

247 
	$z¦V®ueG‹Mš
(
v®ue
, 
z¿nge¥ec
 *
¥ec
) {

248  
¥ec
->
mšex
 ? (
v®ue
 > s³c->
mš
) : (value >= spec->min);

249 
	}
}

251 
	$z¦V®ueL‹Max
(
v®ue
, 
z¿nge¥ec
 *
¥ec
) {

252  
¥ec
->
maxex
 ? (
v®ue
 < s³c->
max
) : (value <= spec->max);

253 
	}
}

256 
	$z¦IsInRªge
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
) {

257 
zskli¡Node
 *
x
;

260 ià(
¿nge
->
mš
 >„ªge->
max
 ||

261 (
¿nge
->
mš
 =ğ¿nge->
max
 && (¿nge->
mšex
 ||„ªge->
maxex
)))

263 
x
 = 
z¦
->

;

264 ià(
x
 =ğ
NULL
 || !
	`z¦V®ueG‹Mš
(x->
scÜe
,
¿nge
))

266 
x
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

267 ià(
x
 =ğ
NULL
 || !
	`z¦V®ueL‹Max
(x->
scÜe
,
¿nge
))

270 
	}
}

274 
zskli¡Node
 *
	$z¦Fœ¡InRªge
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
) {

275 
zskli¡Node
 *
x
;

276 
i
;

279 ià(!
	`z¦IsInRªge
(
z¦
,
¿nge
)è 
NULL
;

281 
x
 = 
z¦
->
h—d”
;

282 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

284 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

285 !
	`z¦V®ueG‹Mš
(
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
,
¿nge
))

286 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

290 
x
 = x->
Ëv–
[0].
fÜw¬d
;

291 
	`£rv”As£¹
(
x
 !ğ
NULL
);

294 ià(!
	`z¦V®ueL‹Max
(
x
->
scÜe
,
¿nge
)è 
NULL
;

295  
x
;

296 
	}
}

300 
zskli¡Node
 *
	$z¦La¡InRªge
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
) {

301 
zskli¡Node
 *
x
;

302 
i
;

305 ià(!
	`z¦IsInRªge
(
z¦
,
¿nge
)è 
NULL
;

307 
x
 = 
z¦
->
h—d”
;

308 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

310 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

311 
	`z¦V®ueL‹Max
(
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
,
¿nge
))

312 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

316 
	`£rv”As£¹
(
x
 !ğ
NULL
);

319 ià(!
	`z¦V®ueG‹Mš
(
x
->
scÜe
,
¿nge
)è 
NULL
;

320  
x
;

321 
	}
}

327 
	$z¦D–‘eRªgeByScÜe
(
zskli¡
 *
z¦
, 
z¿nge¥ec
 *
¿nge
, 
diù
 *dict) {

328 
zskli¡Node
 *
upd©e
[
ZSKIPLIST_MAXLEVEL
], *
x
;

329 
»moved
 = 0;

330 
i
;

332 
x
 = 
z¦
->
h—d”
;

333 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

334 
x
->
Ëv–
[
i
].
fÜw¬d
 && (
¿nge
->
mšex
 ?

335 
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 <ğ
¿nge
->
mš
 :

336 
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 < 
¿nge
->
mš
))

337 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

338 
upd©e
[
i
] = 
x
;

342 
x
 = x->
Ëv–
[0].
fÜw¬d
;

345 
x
 &&

346 (
¿nge
->
maxex
 ? 
x
->
scÜe
 <„ªge->
max
 : x->score <=„ange->max))

348 
zskli¡Node
 *
Ãxt
 = 
x
->
Ëv–
[0].
fÜw¬d
;

349 
	`z¦D–‘eNode
(
z¦
,
x
,
upd©e
);

350 
	`diùD–‘e
(
diù
,
x
->
–e
);

351 
	`z¦F»eNode
(
x
);

352 
»moved
++;

353 
x
 = 
Ãxt
;

355  
»moved
;

356 
	}
}

358 
	$z¦D–‘eRªgeByLex
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
, 
diù
 *dict) {

359 
zskli¡Node
 *
upd©e
[
ZSKIPLIST_MAXLEVEL
], *
x
;

360 
»moved
 = 0;

361 
i
;

364 
x
 = 
z¦
->
h—d”
;

365 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

366 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

367 !
	`z¦LexV®ueG‹Mš
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,
¿nge
))

368 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

369 
upd©e
[
i
] = 
x
;

373 
x
 = x->
Ëv–
[0].
fÜw¬d
;

376 
x
 && 
	`z¦LexV®ueL‹Max
(x->
–e
,
¿nge
)) {

377 
zskli¡Node
 *
Ãxt
 = 
x
->
Ëv–
[0].
fÜw¬d
;

378 
	`z¦D–‘eNode
(
z¦
,
x
,
upd©e
);

379 
	`diùD–‘e
(
diù
,
x
->
–e
);

380 
	`z¦F»eNode
(
x
);

381 
»moved
++;

382 
x
 = 
Ãxt
;

384  
»moved
;

385 
	}
}

389 
	$z¦D–‘eRªgeByRªk
(
zskli¡
 *
z¦
, 
¡¬t
, 
’d
, 
diù
 *dict) {

390 
zskli¡Node
 *
upd©e
[
ZSKIPLIST_MAXLEVEL
], *
x
;

391 
Œav”£d
 = 0, 
»moved
 = 0;

392 
i
;

394 
x
 = 
z¦
->
h—d”
;

395 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

396 
x
->
Ëv–
[
i
].
fÜw¬d
 && (
Œav”£d
 + x->Ëv–[i].
¥ª
è< 
¡¬t
) {

397 
Œav”£d
 +ğ
x
->
Ëv–
[
i
].
¥ª
;

398 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

400 
upd©e
[
i
] = 
x
;

403 
Œav”£d
++;

404 
x
 = x->
Ëv–
[0].
fÜw¬d
;

405 
x
 && 
Œav”£d
 <ğ
’d
) {

406 
zskli¡Node
 *
Ãxt
 = 
x
->
Ëv–
[0].
fÜw¬d
;

407 
	`z¦D–‘eNode
(
z¦
,
x
,
upd©e
);

408 
	`diùD–‘e
(
diù
,
x
->
–e
);

409 
	`z¦F»eNode
(
x
);

410 
»moved
++;

411 
Œav”£d
++;

412 
x
 = 
Ãxt
;

414  
»moved
;

415 
	}
}

421 
	$z¦G‘Rªk
(
zskli¡
 *
z¦
, 
scÜe
, 
sds
 
–e
) {

422 
zskli¡Node
 *
x
;

423 
¿nk
 = 0;

424 
i
;

426 
x
 = 
z¦
->
h—d”
;

427 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

428 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

429 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 < score ||

430 (
x
->
Ëv–
[
i
].
fÜw¬d
->
scÜe
 == score &&

431 
	`sdscmp
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,ele) <= 0))) {

432 
¿nk
 +ğ
x
->
Ëv–
[
i
].
¥ª
;

433 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

437 ià(
x
->
–e
 && 
	`sdscmp
(x->ele,ele) == 0) {

438  
¿nk
;

442 
	}
}

445 
zskli¡Node
* 
	$z¦G‘EËm’tByRªk
(
zskli¡
 *
z¦
, 
¿nk
) {

446 
zskli¡Node
 *
x
;

447 
Œav”£d
 = 0;

448 
i
;

450 
x
 = 
z¦
->
h—d”
;

451 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

452 
x
->
Ëv–
[
i
].
fÜw¬d
 && (
Œav”£d
 + x->Ëv–[i].
¥ª
è<ğ
¿nk
)

454 
Œav”£d
 +ğ
x
->
Ëv–
[
i
].
¥ª
;

455 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

457 ià(
Œav”£d
 =ğ
¿nk
) {

458  
x
;

461  
NULL
;

462 
	}
}

465 
	$z¦P¬£Rªge
(
robj
 *
mš
,„obj *
max
, 
z¿nge¥ec
 *
¥ec
) {

466 *
•Œ
;

467 
¥ec
->
mšex
 = s³c->
maxex
 = 0;

473 ià(
mš
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

474 
¥ec
->
mš
 = ()mš->
±r
;

476 ià(((*)
mš
->
±r
)[0] == '(') {

477 
¥ec
->
mš
 = 
	`¡¹od
((*)mš->
±r
+1,&
•Œ
);

478 ià(
•Œ
[0] !ğ'\0' || 
	`i¢ª
(
¥ec
->
mš
)è 
C_ERR
;

479 
¥ec
->
mšex
 = 1;

481 
¥ec
->
mš
 = 
	`¡¹od
((*)mš->
±r
,&
•Œ
);

482 ià(
•Œ
[0] !ğ'\0' || 
	`i¢ª
(
¥ec
->
mš
)è 
C_ERR
;

485 ià(
max
->
’codšg
 =ğ
OBJ_ENCODING_INT
) {

486 
¥ec
->
max
 = ()max->
±r
;

488 ià(((*)
max
->
±r
)[0] == '(') {

489 
¥ec
->
max
 = 
	`¡¹od
((*)max->
±r
+1,&
•Œ
);

490 ià(
•Œ
[0] !ğ'\0' || 
	`i¢ª
(
¥ec
->
max
)è 
C_ERR
;

491 
¥ec
->
maxex
 = 1;

493 
¥ec
->
max
 = 
	`¡¹od
((*)max->
±r
,&
•Œ
);

494 ià(
•Œ
[0] !ğ'\0' || 
	`i¢ª
(
¥ec
->
max
)è 
C_ERR
;

498  
C_OK
;

499 
	}
}

516 
	$z¦P¬£LexRªgeI‹m
(
robj
 *
™em
, 
sds
 *
de¡
, *
ex
) {

517 *
c
 = 
™em
->
±r
;

519 
c
[0]) {

521 ià(
c
[1] !ğ'\0'è 
C_ERR
;

522 *
ex
 = 0;

523 *
de¡
 = 
sh¬ed
.
max¡ršg
;

524  
C_OK
;

526 ià(
c
[1] !ğ'\0'è 
C_ERR
;

527 *
ex
 = 0;

528 *
de¡
 = 
sh¬ed
.
mš¡ršg
;

529  
C_OK
;

531 *
ex
 = 1;

532 *
de¡
 = 
	`sd¢ewËn
(
c
+1,
	`sd¦’
(c)-1);

533  
C_OK
;

535 *
ex
 = 0;

536 *
de¡
 = 
	`sd¢ewËn
(
c
+1,
	`sd¦’
(c)-1);

537  
C_OK
;

539  
C_ERR
;

541 
	}
}

545 
	$z¦F»eLexRªge
(
zËx¿nge¥ec
 *
¥ec
) {

546 ià(
¥ec
->
mš
 !ğ
sh¬ed
.
mš¡ršg
 &&

547 
¥ec
->
mš
 !ğ
sh¬ed
.
max¡ršg
è
	`sdsä“
(spec->min);

548 ià(
¥ec
->
max
 !ğ
sh¬ed
.
mš¡ršg
 &&

549 
¥ec
->
max
 !ğ
sh¬ed
.
max¡ršg
è
	`sdsä“
(spec->max);

550 
	}
}

557 
	$z¦P¬£LexRªge
(
robj
 *
mš
,„obj *
max
, 
zËx¿nge¥ec
 *
¥ec
) {

560 ià(
mš
->
’codšg
 =ğ
OBJ_ENCODING_INT
 ||

561 
max
->
’codšg
 =ğ
OBJ_ENCODING_INT
è 
C_ERR
;

563 
¥ec
->
mš
 = s³c->
max
 = 
NULL
;

564 ià(
	`z¦P¬£LexRªgeI‹m
(
mš
, &
¥ec
->mš, &¥ec->
mšex
è=ğ
C_ERR
 ||

565 
	`z¦P¬£LexRªgeI‹m
(
max
, &
¥ec
->max, &¥ec->
maxex
è=ğ
C_ERR
) {

566 
	`z¦F»eLexRªge
(
¥ec
);

567  
C_ERR
;

569  
C_OK
;

571 
	}
}

576 
	$sdscm¶ex
(
sds
 
a
, sd 
b
) {

577 ià(
a
 =ğ
b
)  0;

578 ià(
a
 =ğ
sh¬ed
.
mš¡ršg
 || 
b
 =ğsh¬ed.
max¡ršg
)  -1;

579 ià(
a
 =ğ
sh¬ed
.
max¡ršg
 || 
b
 =ğsh¬ed.
mš¡ršg
)  1;

580  
	`sdscmp
(
a
,
b
);

581 
	}
}

583 
	$z¦LexV®ueG‹Mš
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
) {

584  
¥ec
->
mšex
 ?

585 (
	`sdscm¶ex
(
v®ue
,
¥ec
->
mš
) > 0) :

586 (
	`sdscm¶ex
(
v®ue
,
¥ec
->
mš
) >= 0);

587 
	}
}

589 
	$z¦LexV®ueL‹Max
(
sds
 
v®ue
, 
zËx¿nge¥ec
 *
¥ec
) {

590  
¥ec
->
maxex
 ?

591 (
	`sdscm¶ex
(
v®ue
,
¥ec
->
max
) < 0) :

592 (
	`sdscm¶ex
(
v®ue
,
¥ec
->
max
) <= 0);

593 
	}
}

596 
	$z¦IsInLexRªge
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
) {

597 
zskli¡Node
 *
x
;

600 ià(
	`sdscm¶ex
(
¿nge
->
mš
,¿nge->
max
) > 1 ||

601 (
	`sdscmp
(
¿nge
->
mš
,¿nge->
max
) == 0 &&

602 (
¿nge
->
mšex
 ||„ªge->
maxex
)))

604 
x
 = 
z¦
->

;

605 ià(
x
 =ğ
NULL
 || !
	`z¦LexV®ueG‹Mš
(x->
–e
,
¿nge
))

607 
x
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

608 ià(
x
 =ğ
NULL
 || !
	`z¦LexV®ueL‹Max
(x->
–e
,
¿nge
))

611 
	}
}

615 
zskli¡Node
 *
	$z¦Fœ¡InLexRªge
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
) {

616 
zskli¡Node
 *
x
;

617 
i
;

620 ià(!
	`z¦IsInLexRªge
(
z¦
,
¿nge
)è 
NULL
;

622 
x
 = 
z¦
->
h—d”
;

623 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

625 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

626 !
	`z¦LexV®ueG‹Mš
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,
¿nge
))

627 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

631 
x
 = x->
Ëv–
[0].
fÜw¬d
;

632 
	`£rv”As£¹
(
x
 !ğ
NULL
);

635 ià(!
	`z¦LexV®ueL‹Max
(
x
->
–e
,
¿nge
)è 
NULL
;

636  
x
;

637 
	}
}

641 
zskli¡Node
 *
	$z¦La¡InLexRªge
(
zskli¡
 *
z¦
, 
zËx¿nge¥ec
 *
¿nge
) {

642 
zskli¡Node
 *
x
;

643 
i
;

646 ià(!
	`z¦IsInLexRªge
(
z¦
,
¿nge
)è 
NULL
;

648 
x
 = 
z¦
->
h—d”
;

649 
i
 = 
z¦
->
Ëv–
-1; i >= 0; i--) {

651 
x
->
Ëv–
[
i
].
fÜw¬d
 &&

652 
	`z¦LexV®ueL‹Max
(
x
->
Ëv–
[
i
].
fÜw¬d
->
–e
,
¿nge
))

653 
x
 = x->
Ëv–
[
i
].
fÜw¬d
;

657 
	`£rv”As£¹
(
x
 !ğ
NULL
);

660 ià(!
	`z¦LexV®ueG‹Mš
(
x
->
–e
,
¿nge
)è 
NULL
;

661  
x
;

662 
	}
}

668 
	$zzlG‘ScÜe
(*
¥Œ
) {

669 *
v¡r
;

670 
vËn
;

671 
vlÚg
;

672 
buf
[128];

673 
scÜe
;

675 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

676 
	`£rv”As£¹
(
	`zli¡G‘
(
¥Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

678 ià(
v¡r
) {

679 
	`memıy
(
buf
,
v¡r
,
vËn
);

680 
buf
[
vËn
] = '\0';

681 
scÜe
 = 
	`¡¹od
(
buf
,
NULL
);

683 
scÜe
 = 
vlÚg
;

686  
scÜe
;

687 
	}
}

690 
sds
 
	$zli¡G‘Objeù
(*
¥Œ
) {

691 *
v¡r
;

692 
vËn
;

693 
vlÚg
;

695 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

696 
	`£rv”As£¹
(
	`zli¡G‘
(
¥Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

698 ià(
v¡r
) {

699  
	`sd¢ewËn
((*)
v¡r
,
vËn
);

701  
	`sdsäomlÚglÚg
(
vlÚg
);

703 
	}
}

706 
	$zzlCom·»EËm’ts
(*
•Œ
, *
c¡r
, 
ş’
) {

707 *
v¡r
;

708 
vËn
;

709 
vlÚg
;

710 
vbuf
[32];

711 
mšËn
, 
cmp
;

713 
	`£rv”As£¹
(
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

714 ià(
v¡r
 =ğ
NULL
) {

716 
vËn
 = 
	`Î2¡ršg
((*)
vbuf
,(vbuf),
vlÚg
);

717 
v¡r
 = 
vbuf
;

720 
mšËn
 = (
vËn
 < 
ş’
) ? vlen : clen;

721 
cmp
 = 
	`memcmp
(
v¡r
,
c¡r
,
mšËn
);

722 ià(
cmp
 =ğ0è 
vËn
-
ş’
;

723  
cmp
;

724 
	}
}

726 
	$zzlL’gth
(*
zl
) {

727  
	`zli¡L’
(
zl
)/2;

728 
	}
}

732 
	$zzlNext
(*
zl
, **
•Œ
, **
¥Œ
) {

733 *
_•Œ
, *
_¥Œ
;

734 
	`£rv”As£¹
(*
•Œ
 !ğ
NULL
 && *
¥Œ
 != NULL);

736 
_•Œ
 = 
	`zli¡Next
(
zl
,*
¥Œ
);

737 ià(
_•Œ
 !ğ
NULL
) {

738 
_¥Œ
 = 
	`zli¡Next
(
zl
,
_•Œ
);

739 
	`£rv”As£¹
(
_¥Œ
 !ğ
NULL
);

742 
_¥Œ
 = 
NULL
;

745 *
•Œ
 = 
_•Œ
;

746 *
¥Œ
 = 
_¥Œ
;

747 
	}
}

751 
	$zzlP»v
(*
zl
, **
•Œ
, **
¥Œ
) {

752 *
_•Œ
, *
_¥Œ
;

753 
	`£rv”As£¹
(*
•Œ
 !ğ
NULL
 && *
¥Œ
 != NULL);

755 
_¥Œ
 = 
	`zli¡P»v
(
zl
,*
•Œ
);

756 ià(
_¥Œ
 !ğ
NULL
) {

757 
_•Œ
 = 
	`zli¡P»v
(
zl
,
_¥Œ
);

758 
	`£rv”As£¹
(
_•Œ
 !ğ
NULL
);

761 
_•Œ
 = 
NULL
;

764 *
•Œ
 = 
_•Œ
;

765 *
¥Œ
 = 
_¥Œ
;

766 
	}
}

770 
	$zzlIsInRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
) {

771 *
p
;

772 
scÜe
;

775 ià(
¿nge
->
mš
 >„ªge->
max
 ||

776 (
¿nge
->
mš
 =ğ¿nge->
max
 && (¿nge->
mšex
 ||„ªge->
maxex
)))

779 
p
 = 
	`zli¡Index
(
zl
,-1);

780 ià(
p
 =ğ
NULL
)  0;

781 
scÜe
 = 
	`zzlG‘ScÜe
(
p
);

782 ià(!
	`z¦V®ueG‹Mš
(
scÜe
,
¿nge
))

785 
p
 = 
	`zli¡Index
(
zl
,1);

786 
	`£rv”As£¹
(
p
 !ğ
NULL
);

787 
scÜe
 = 
	`zzlG‘ScÜe
(
p
);

788 ià(!
	`z¦V®ueL‹Max
(
scÜe
,
¿nge
))

792 
	}
}

796 *
	$zzlFœ¡InRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
) {

797 *
•Œ
 = 
	`zli¡Index
(
zl
,0), *
¥Œ
;

798 
scÜe
;

801 ià(!
	`zzlIsInRªge
(
zl
,
¿nge
)è 
NULL
;

803 
•Œ
 !ğ
NULL
) {

804 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

805 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

807 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

808 ià(
	`z¦V®ueG‹Mš
(
scÜe
,
¿nge
)) {

810 ià(
	`z¦V®ueL‹Max
(
scÜe
,
¿nge
))

811  
•Œ
;

812  
NULL
;

816 
•Œ
 = 
	`zli¡Next
(
zl
,
¥Œ
);

819  
NULL
;

820 
	}
}

824 *
	$zzlLa¡InRªge
(*
zl
, 
z¿nge¥ec
 *
¿nge
) {

825 *
•Œ
 = 
	`zli¡Index
(
zl
,-2), *
¥Œ
;

826 
scÜe
;

829 ià(!
	`zzlIsInRªge
(
zl
,
¿nge
)è 
NULL
;

831 
•Œ
 !ğ
NULL
) {

832 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

833 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

835 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

836 ià(
	`z¦V®ueL‹Max
(
scÜe
,
¿nge
)) {

838 ià(
	`z¦V®ueG‹Mš
(
scÜe
,
¿nge
))

839  
•Œ
;

840  
NULL
;

845 
¥Œ
 = 
	`zli¡P»v
(
zl
,
•Œ
);

846 ià(
¥Œ
 !ğ
NULL
)

847 
	`£rv”As£¹
((
•Œ
 = 
	`zli¡P»v
(
zl
,
¥Œ
)è!ğ
NULL
);

849 
•Œ
 = 
NULL
;

852  
NULL
;

853 
	}
}

855 
	$zzlLexV®ueG‹Mš
(*
p
, 
zËx¿nge¥ec
 *
¥ec
) {

856 
sds
 
v®ue
 = 
	`zli¡G‘Objeù
(
p
);

857 
»s
 = 
	`z¦LexV®ueG‹Mš
(
v®ue
,
¥ec
);

858 
	`sdsä“
(
v®ue
);

859  
»s
;

860 
	}
}

862 
	$zzlLexV®ueL‹Max
(*
p
, 
zËx¿nge¥ec
 *
¥ec
) {

863 
sds
 
v®ue
 = 
	`zli¡G‘Objeù
(
p
);

864 
»s
 = 
	`z¦LexV®ueL‹Max
(
v®ue
,
¥ec
);

865 
	`sdsä“
(
v®ue
);

866  
»s
;

867 
	}
}

871 
	$zzlIsInLexRªge
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
) {

872 *
p
;

875 ià(
	`sdscm¶ex
(
¿nge
->
mš
,¿nge->
max
) > 1 ||

876 (
	`sdscmp
(
¿nge
->
mš
,¿nge->
max
) == 0 &&

877 (
¿nge
->
mšex
 ||„ªge->
maxex
)))

880 
p
 = 
	`zli¡Index
(
zl
,-2);

881 ià(
p
 =ğ
NULL
)  0;

882 ià(!
	`zzlLexV®ueG‹Mš
(
p
,
¿nge
))

885 
p
 = 
	`zli¡Index
(
zl
,0);

886 
	`£rv”As£¹
(
p
 !ğ
NULL
);

887 ià(!
	`zzlLexV®ueL‹Max
(
p
,
¿nge
))

891 
	}
}

895 *
	$zzlFœ¡InLexRªge
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
) {

896 *
•Œ
 = 
	`zli¡Index
(
zl
,0), *
¥Œ
;

899 ià(!
	`zzlIsInLexRªge
(
zl
,
¿nge
)è 
NULL
;

901 
•Œ
 !ğ
NULL
) {

902 ià(
	`zzlLexV®ueG‹Mš
(
•Œ
,
¿nge
)) {

904 ià(
	`zzlLexV®ueL‹Max
(
•Œ
,
¿nge
))

905  
•Œ
;

906  
NULL
;

910 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

911 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

912 
•Œ
 = 
	`zli¡Next
(
zl
,
¥Œ
);

915  
NULL
;

916 
	}
}

920 *
	$zzlLa¡InLexRªge
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
) {

921 *
•Œ
 = 
	`zli¡Index
(
zl
,-2), *
¥Œ
;

924 ià(!
	`zzlIsInLexRªge
(
zl
,
¿nge
)è 
NULL
;

926 
•Œ
 !ğ
NULL
) {

927 ià(
	`zzlLexV®ueL‹Max
(
•Œ
,
¿nge
)) {

929 ià(
	`zzlLexV®ueG‹Mš
(
•Œ
,
¿nge
))

930  
•Œ
;

931  
NULL
;

936 
¥Œ
 = 
	`zli¡P»v
(
zl
,
•Œ
);

937 ià(
¥Œ
 !ğ
NULL
)

938 
	`£rv”As£¹
((
•Œ
 = 
	`zli¡P»v
(
zl
,
¥Œ
)è!ğ
NULL
);

940 
•Œ
 = 
NULL
;

943  
NULL
;

944 
	}
}

946 *
	$zzlFšd
(*
zl
, 
sds
 
–e
, *
scÜe
) {

947 *
•Œ
 = 
	`zli¡Index
(
zl
,0), *
¥Œ
;

949 
•Œ
 !ğ
NULL
) {

950 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

951 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

953 ià(
	`zli¡Com·»
(
•Œ
,(*)
–e
,
	`sd¦’
(ele))) {

955 ià(
scÜe
 !ğ
NULL
è*scÜğ
	`zzlG‘ScÜe
(
¥Œ
);

956  
•Œ
;

960 
•Œ
 = 
	`zli¡Next
(
zl
,
¥Œ
);

962  
NULL
;

963 
	}
}

967 *
	$zzlD–‘e
(*
zl
, *
•Œ
) {

968 *
p
 = 
•Œ
;

971 
zl
 = 
	`zli¡D–‘e
(zl,&
p
);

972 
zl
 = 
	`zli¡D–‘e
(zl,&
p
);

973  
zl
;

974 
	}
}

976 *
	$zzlIn£¹At
(*
zl
, *
•Œ
, 
sds
 
–e
, 
scÜe
) {

977 *
¥Œ
;

978 
scÜebuf
[128];

979 
scÜ–’
;

980 
size_t
 
off£t
;

982 
scÜ–’
 = 
	`d2¡ršg
(
scÜebuf
,(scÜebuf),
scÜe
);

983 ià(
•Œ
 =ğ
NULL
) {

984 
zl
 = 
	`zli¡Push
(zl,(*)
–e
,
	`sd¦’
ÓË),
ZIPLIST_TAIL
);

985 
zl
 = 
	`zli¡Push
(zl,(*)
scÜebuf
,
scÜ–’
,
ZIPLIST_TAIL
);

988 
off£t
 = 
•Œ
-
zl
;

989 
zl
 = 
	`zli¡In£¹
(zl,
•Œ
,(*)
–e
,
	`sd¦’
(ele));

990 
•Œ
 = 
zl
+
off£t
;

993 
	`£rv”As£¹
((
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
)è!ğ
NULL
);

994 
zl
 = 
	`zli¡In£¹
(zl,
¥Œ
,(*)
scÜebuf
,
scÜ–’
);

996  
zl
;

997 
	}
}

1001 *
	$zzlIn£¹
(*
zl
, 
sds
 
–e
, 
scÜe
) {

1002 *
•Œ
 = 
	`zli¡Index
(
zl
,0), *
¥Œ
;

1003 
s
;

1005 
•Œ
 !ğ
NULL
) {

1006 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

1007 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

1008 
s
 = 
	`zzlG‘ScÜe
(
¥Œ
);

1010 ià(
s
 > 
scÜe
) {

1014 
zl
 = 
	`zzlIn£¹At
(zl,
•Œ
,
–e
,
scÜe
);

1016 } ià(
s
 =ğ
scÜe
) {

1018 ià(
	`zzlCom·»EËm’ts
(
•Œ
,(*)
–e
,
	`sd¦’
(ele)) > 0) {

1019 
zl
 = 
	`zzlIn£¹At
(zl,
•Œ
,
–e
,
scÜe
);

1025 
•Œ
 = 
	`zli¡Next
(
zl
,
¥Œ
);

1029 ià(
•Œ
 =ğ
NULL
)

1030 
zl
 = 
	`zzlIn£¹At
(zl,
NULL
,
–e
,
scÜe
);

1031  
zl
;

1032 
	}
}

1034 *
	$zzlD–‘eRªgeByScÜe
(*
zl
, 
z¿nge¥ec
 *
¿nge
, *
d–‘ed
) {

1035 *
•Œ
, *
¥Œ
;

1036 
scÜe
;

1037 
num
 = 0;

1039 ià(
d–‘ed
 !ğ
NULL
) *deleted = 0;

1041 
•Œ
 = 
	`zzlFœ¡InRªge
(
zl
,
¿nge
);

1042 ià(
•Œ
 =ğ
NULL
è 
zl
;

1046 (
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
)è!ğ
NULL
) {

1047 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

1048 ià(
	`z¦V®ueL‹Max
(
scÜe
,
¿nge
)) {

1050 
zl
 = 
	`zli¡D–‘e
(zl,&
•Œ
);

1051 
zl
 = 
	`zli¡D–‘e
(zl,&
•Œ
);

1052 
num
++;

1059 ià(
d–‘ed
 !ğ
NULL
è*d–‘ed = 
num
;

1060  
zl
;

1061 
	}
}

1063 *
	$zzlD–‘eRªgeByLex
(*
zl
, 
zËx¿nge¥ec
 *
¿nge
, *
d–‘ed
) {

1064 *
•Œ
, *
¥Œ
;

1065 
num
 = 0;

1067 ià(
d–‘ed
 !ğ
NULL
) *deleted = 0;

1069 
•Œ
 = 
	`zzlFœ¡InLexRªge
(
zl
,
¿nge
);

1070 ià(
•Œ
 =ğ
NULL
è 
zl
;

1074 (
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
)è!ğ
NULL
) {

1075 ià(
	`zzlLexV®ueL‹Max
(
•Œ
,
¿nge
)) {

1077 
zl
 = 
	`zli¡D–‘e
(zl,&
•Œ
);

1078 
zl
 = 
	`zli¡D–‘e
(zl,&
•Œ
);

1079 
num
++;

1086 ià(
d–‘ed
 !ğ
NULL
è*d–‘ed = 
num
;

1087  
zl
;

1088 
	}
}

1092 *
	$zzlD–‘eRªgeByRªk
(*
zl
, 
¡¬t
, 
’d
, *
d–‘ed
) {

1093 
num
 = (
’d
-
¡¬t
)+1;

1094 ià(
d–‘ed
è*d–‘ed = 
num
;

1095 
zl
 = 
	`zli¡D–‘eRªge
(zl,2*(
¡¬t
-1),2*
num
);

1096  
zl
;

1097 
	}
}

1103 
	$z£tL’gth
(cÚ¡ 
robj
 *
zobj
) {

1104 
Ëngth
 = -1;

1105 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1106 
Ëngth
 = 
	`zzlL’gth
(
zobj
->
±r
);

1107 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1108 
Ëngth
 = ((cÚ¡ 
z£t
*)
zobj
->
±r
)->
z¦
->length;

1110 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1112  
Ëngth
;

1113 
	}
}

1115 
	$z£tCÚv”t
(
robj
 *
zobj
, 
’codšg
) {

1116 
z£t
 *
zs
;

1117 
zskli¡Node
 *
node
, *
Ãxt
;

1118 
sds
 
–e
;

1119 
scÜe
;

1121 ià(
zobj
->
’codšg
 ==ƒncoding) ;

1122 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1123 *
zl
 = 
zobj
->
±r
;

1124 *
•Œ
, *
¥Œ
;

1125 *
v¡r
;

1126 
vËn
;

1127 
vlÚg
;

1129 ià(
’codšg
 !ğ
OBJ_ENCODING_SKIPLIST
)

1130 
	`£rv”Pªic
("Unknownargetƒncoding");

1132 
zs
 = 
	`zm®loc
((*zs));

1133 
zs
->
diù
 = 
	`diùC»©e
(&
z£tDiùTy³
,
NULL
);

1134 
zs
->
z¦
 = 
	`z¦C»©e
();

1136 
•Œ
 = 
	`zli¡Index
(
zl
,0);

1137 
	`£rv”As£¹W™hInfo
(
NULL
,
zobj
,
•Œ
 != NULL);

1138 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

1139 
	`£rv”As£¹W™hInfo
(
NULL
,
zobj
,
¥Œ
 != NULL);

1141 
•Œ
 !ğ
NULL
) {

1142 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

1143 
	`£rv”As£¹W™hInfo
(
NULL
,
zobj
,
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

1144 ià(
v¡r
 =ğ
NULL
)

1145 
–e
 = 
	`sdsäomlÚglÚg
(
vlÚg
);

1147 
–e
 = 
	`sd¢ewËn
((*)
v¡r
,
vËn
);

1149 
node
 = 
	`z¦In£¹
(
zs
->
z¦
,
scÜe
,
–e
);

1150 
	`£rv”As£¹
(
	`diùAdd
(
zs
->
diù
,
–e
,&
node
->
scÜe
è=ğ
DICT_OK
);

1151 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

1154 
	`zä“
(
zobj
->
±r
);

1155 
zobj
->
±r
 = 
zs
;

1156 
zobj
->
’codšg
 = 
OBJ_ENCODING_SKIPLIST
;

1157 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1158 *
zl
 = 
	`zli¡New
();

1160 ià(
’codšg
 !ğ
OBJ_ENCODING_ZIPLIST
)

1161 
	`£rv”Pªic
("Unknownargetƒncoding");

1165 
zs
 = 
zobj
->
±r
;

1166 
	`diùR–—£
(
zs
->
diù
);

1167 
node
 = 
zs
->
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

1168 
	`zä“
(
zs
->
z¦
->
h—d”
);

1169 
	`zä“
(
zs
->
z¦
);

1171 
node
) {

1172 
zl
 = 
	`zzlIn£¹At
(zl,
NULL
,
node
->
–e
,node->
scÜe
);

1173 
Ãxt
 = 
node
->
Ëv–
[0].
fÜw¬d
;

1174 
	`z¦F»eNode
(
node
);

1175 
node
 = 
Ãxt
;

1178 
	`zä“
(
zs
);

1179 
zobj
->
±r
 = 
zl
;

1180 
zobj
->
’codšg
 = 
OBJ_ENCODING_ZIPLIST
;

1182 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1184 
	}
}

1189 
	$z£tCÚv”tToZli¡IfN“ded
(
robj
 *
zobj
, 
size_t
 
max––’
) {

1190 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) ;

1191 
z£t
 *z£ˆğ
zobj
->
±r
;

1193 ià(
z£t
->
z¦
->
Ëngth
 <ğ
£rv”
.
z£t_max_zli¡_’Œ›s
 &&

1194 
max––’
 <ğ
£rv”
.
z£t_max_zli¡_v®ue
)

1195 
	`z£tCÚv”t
(
zobj
,
OBJ_ENCODING_ZIPLIST
);

1196 
	}
}

1202 
	$z£tScÜe
(
robj
 *
zobj
, 
sds
 
memb”
, *
scÜe
) {

1203 ià(!
zobj
 || !
memb”
è 
C_ERR
;

1205 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1206 ià(
	`zzlFšd
(
zobj
->
±r
, 
memb”
, 
scÜe
è=ğ
NULL
è 
C_ERR
;

1207 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1208 
z£t
 *
zs
 = 
zobj
->
±r
;

1209 
diùEÁry
 *
de
 = 
	`diùFšd
(
zs
->
diù
, 
memb”
);

1210 ià(
de
 =ğ
NULL
è 
C_ERR
;

1211 *
scÜe
 = *(*)
	`diùG‘V®
(
de
);

1213 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1215  
C_OK
;

1216 
	}
}

1261 
	$z£tAdd
(
robj
 *
zobj
, 
scÜe
, 
sds
 
–e
, *
æags
, *
ÃwscÜe
) {

1263 
šü
 = (*
æags
 & 
ZADD_INCR
) != 0;

1264 
nx
 = (*
æags
 & 
ZADD_NX
) != 0;

1265 
xx
 = (*
æags
 & 
ZADD_XX
) != 0;

1266 *
æags
 = 0;

1267 
curscÜe
;

1270 ià(
	`i¢ª
(
scÜe
)) {

1271 *
æags
 = 
ZADD_NAN
;

1276 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1277 *
•Œ
;

1279 ià((
•Œ
 = 
	`zzlFšd
(
zobj
->
±r
,
–e
,&
curscÜe
)è!ğ
NULL
) {

1281 ià(
nx
) {

1282 *
æags
 |ğ
ZADD_NOP
;

1287 ià(
šü
) {

1288 
scÜe
 +ğ
curscÜe
;

1289 ià(
	`i¢ª
(
scÜe
)) {

1290 *
æags
 |ğ
ZADD_NAN
;

1293 ià(
ÃwscÜe
è*ÃwscÜğ
scÜe
;

1297 ià(
scÜe
 !ğ
curscÜe
) {

1298 
zobj
->
±r
 = 
	`zzlD–‘e
(zobj->±r,
•Œ
);

1299 
zobj
->
±r
 = 
	`zzlIn£¹
(zobj->±r,
–e
,
scÜe
);

1300 *
æags
 |ğ
ZADD_UPDATED
;

1303 } ià(!
xx
) {

1306 
zobj
->
±r
 = 
	`zzlIn£¹
(zobj->±r,
–e
,
scÜe
);

1307 ià(
	`zzlL’gth
(
zobj
->
±r
è> 
£rv”
.
z£t_max_zli¡_’Œ›s
)

1308 
	`z£tCÚv”t
(
zobj
,
OBJ_ENCODING_SKIPLIST
);

1309 ià(
	`sd¦’
(
–e
è> 
£rv”
.
z£t_max_zli¡_v®ue
)

1310 
	`z£tCÚv”t
(
zobj
,
OBJ_ENCODING_SKIPLIST
);

1311 ià(
ÃwscÜe
è*ÃwscÜğ
scÜe
;

1312 *
æags
 |ğ
ZADD_ADDED
;

1315 *
æags
 |ğ
ZADD_NOP
;

1318 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1319 
z£t
 *
zs
 = 
zobj
->
±r
;

1320 
zskli¡Node
 *
znode
;

1321 
diùEÁry
 *
de
;

1323 
de
 = 
	`diùFšd
(
zs
->
diù
,
–e
);

1324 ià(
de
 !ğ
NULL
) {

1326 ià(
nx
) {

1327 *
æags
 |ğ
ZADD_NOP
;

1330 
curscÜe
 = *(*)
	`diùG‘V®
(
de
);

1333 ià(
šü
) {

1334 
scÜe
 +ğ
curscÜe
;

1335 ià(
	`i¢ª
(
scÜe
)) {

1336 *
æags
 |ğ
ZADD_NAN
;

1339 ià(
ÃwscÜe
è*ÃwscÜğ
scÜe
;

1343 ià(
scÜe
 !ğ
curscÜe
) {

1344 
zskli¡Node
 *
node
;

1345 
	`£rv”As£¹
(
	`z¦D–‘e
(
zs
->
z¦
,
curscÜe
,
–e
,&
node
));

1346 
znode
 = 
	`z¦In£¹
(
zs
->
z¦
,
scÜe
,
node
->
–e
);

1349 
node
->
–e
 = 
NULL
;

1350 
	`z¦F»eNode
(
node
);

1354 
	`diùG‘V®
(
de
èğ&
znode
->
scÜe
;

1355 *
æags
 |ğ
ZADD_UPDATED
;

1358 } ià(!
xx
) {

1359 
–e
 = 
	`sdsdup
(ele);

1360 
znode
 = 
	`z¦In£¹
(
zs
->
z¦
,
scÜe
,
–e
);

1361 
	`£rv”As£¹
(
	`diùAdd
(
zs
->
diù
,
–e
,&
znode
->
scÜe
è=ğ
DICT_OK
);

1362 *
æags
 |ğ
ZADD_ADDED
;

1363 ià(
ÃwscÜe
è*ÃwscÜğ
scÜe
;

1366 *
æags
 |ğ
ZADD_NOP
;

1370 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1373 
	}
}

1377 
	$z£tD–
(
robj
 *
zobj
, 
sds
 
–e
) {

1378 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1379 *
•Œ
;

1381 ià((
•Œ
 = 
	`zzlFšd
(
zobj
->
±r
,
–e
,
NULL
)) != NULL) {

1382 
zobj
->
±r
 = 
	`zzlD–‘e
(zobj->±r,
•Œ
);

1385 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1386 
z£t
 *
zs
 = 
zobj
->
±r
;

1387 
diùEÁry
 *
de
;

1388 
scÜe
;

1390 
de
 = 
	`diùUÆšk
(
zs
->
diù
,
–e
);

1391 ià(
de
 !ğ
NULL
) {

1393 
scÜe
 = *(*)
	`diùG‘V®
(
de
);

1400 
	`diùF»eUÆškedEÁry
(
zs
->
diù
,
de
);

1403 
»tv®
 = 
	`z¦D–‘e
(
zs
->
z¦
,
scÜe
,
–e
,
NULL
);

1404 
	`£rv”As£¹
(
»tv®
);

1406 ià(
	`htN“dsResize
(
zs
->
diù
)è
	`diùResize
(zs->dict);

1410 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1413 
	}
}

1426 
	$z£tRªk
(
robj
 *
zobj
, 
sds
 
–e
, 
»v”£
) {

1427 
Î’
;

1428 
¿nk
;

1430 
Î’
 = 
	`z£tL’gth
(
zobj
);

1432 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1433 *
zl
 = 
zobj
->
±r
;

1434 *
•Œ
, *
¥Œ
;

1436 
•Œ
 = 
	`zli¡Index
(
zl
,0);

1437 
	`£rv”As£¹
(
•Œ
 !ğ
NULL
);

1438 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

1439 
	`£rv”As£¹
(
¥Œ
 !ğ
NULL
);

1441 
¿nk
 = 1;

1442 
•Œ
 !ğ
NULL
) {

1443 ià(
	`zli¡Com·»
(
•Œ
,(*)
–e
,
	`sd¦’
(ele)))

1445 
¿nk
++;

1446 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

1449 ià(
•Œ
 !ğ
NULL
) {

1450 ià(
»v”£
)

1451  
Î’
-
¿nk
;

1453  
¿nk
-1;

1457 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1458 
z£t
 *
zs
 = 
zobj
->
±r
;

1459 
zskli¡
 *
z¦
 = 
zs
->zsl;

1460 
diùEÁry
 *
de
;

1461 
scÜe
;

1463 
de
 = 
	`diùFšd
(
zs
->
diù
,
–e
);

1464 ià(
de
 !ğ
NULL
) {

1465 
scÜe
 = *(*)
	`diùG‘V®
(
de
);

1466 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
,
scÜe
,
–e
);

1468 
	`£rv”As£¹
(
¿nk
 != 0);

1469 ià(
»v”£
)

1470  
Î’
-
¿nk
;

1472  
¿nk
-1;

1477 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1479 
	}
}

1486 
	$zaddG’”icCommªd
(
ş›Á
 *
c
, 
æags
) {

1487 *
ÇÃ¼
 = "resulting score is‚ot‡‚umber (NaN)";

1488 
robj
 *
key
 = 
c
->
¬gv
[1];

1489 
robj
 *
zobj
;

1490 
sds
 
–e
;

1491 
scÜe
 = 0, *
scÜes
 = 
NULL
;

1492 
j
, 
–em’ts
;

1493 
scÜeidx
 = 0;

1497 
added
 = 0;

1498 
upd©ed
 = 0;

1499 
´oûs£d
 = 0;

1504 
scÜeidx
 = 2;

1505 
scÜeidx
 < 
c
->
¬gc
) {

1506 *
İt
 = 
c
->
¬gv
[
scÜeidx
]->
±r
;

1507 ià(!
	`¡rÿ£cmp
(
İt
,"nx")è
æags
 |ğ
ZADD_NX
;

1508 ià(!
	`¡rÿ£cmp
(
İt
,"xx")è
æags
 |ğ
ZADD_XX
;

1509 ià(!
	`¡rÿ£cmp
(
İt
,"ch")è
æags
 |ğ
ZADD_CH
;

1510 ià(!
	`¡rÿ£cmp
(
İt
,"šü")è
æags
 |ğ
ZADD_INCR
;

1512 
scÜeidx
++;

1516 
šü
 = (
æags
 & 
ZADD_INCR
) != 0;

1517 
nx
 = (
æags
 & 
ZADD_NX
) != 0;

1518 
xx
 = (
æags
 & 
ZADD_XX
) != 0;

1519 
ch
 = (
æags
 & 
ZADD_CH
) != 0;

1523 
–em’ts
 = 
c
->
¬gc
-
scÜeidx
;

1524 ià(
–em’ts
 % 2) {

1525 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

1528 
–em’ts
 /= 2;

1531 ià(
nx
 && 
xx
) {

1532 
	`addR•lyE¼Ü
(
c
,

1537 ià(
šü
 && 
–em’ts
 > 1) {

1538 
	`addR•lyE¼Ü
(
c
,

1546 
scÜes
 = 
	`zm®loc
(()*
–em’ts
);

1547 
j
 = 0; j < 
–em’ts
; j++) {

1548 ià(
	`g‘DoubËFromObjeùOrR•ly
(
c
,c->
¬gv
[
scÜeidx
+
j
*2],&
scÜes
[j],
NULL
)

1549 !ğ
C_OK
è
ş—nup
;

1553 
zobj
 = 
	`lookupKeyWr™e
(
c
->
db
,
key
);

1554 ià(
zobj
 =ğ
NULL
) {

1555 ià(
xx
è
»¶y_to_ş›Á
;

1556 ià(
£rv”
.
z£t_max_zli¡_’Œ›s
 == 0 ||

1557 
£rv”
.
z£t_max_zli¡_v®ue
 < 
	`sd¦’
(
c
->
¬gv
[
scÜeidx
+1]->
±r
))

1559 
zobj
 = 
	`ü—‹Z£tObjeù
();

1561 
zobj
 = 
	`ü—‹Z£tZli¡Objeù
();

1563 
	`dbAdd
(
c
->
db
,
key
,
zobj
);

1565 ià(
zobj
->
ty³
 !ğ
OBJ_ZSET
) {

1566 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

1567 
ş—nup
;

1571 
j
 = 0; j < 
–em’ts
; j++) {

1572 
ÃwscÜe
;

1573 
scÜe
 = 
scÜes
[
j
];

1574 
»tæags
 = 
æags
;

1576 
–e
 = 
c
->
¬gv
[
scÜeidx
+1+
j
*2]->
±r
;

1577 
»tv®
 = 
	`z£tAdd
(
zobj
, 
scÜe
, 
–e
, &
»tæags
, &
ÃwscÜe
);

1578 ià(
»tv®
 == 0) {

1579 
	`addR•lyE¼Ü
(
c
,
ÇÃ¼
);

1580 
ş—nup
;

1582 ià(
»tæags
 & 
ZADD_ADDED
è
added
++;

1583 ià(
»tæags
 & 
ZADD_UPDATED
è
upd©ed
++;

1584 ià(!(
»tæags
 & 
ZADD_NOP
)è
´oûs£d
++;

1585 
scÜe
 = 
ÃwscÜe
;

1587 
£rv”
.
dœty
 +ğ(
added
+
upd©ed
);

1589 
»¶y_to_ş›Á
:

1590 ià(
šü
) {

1591 ià(
´oûs£d
)

1592 
	`addR•lyDoubË
(
c
,
scÜe
);

1594 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

1596 
	`addR•lyLÚgLÚg
(
c
,
ch
 ? 
added
+
upd©ed
 :‡dded);

1599 
ş—nup
:

1600 
	`zä“
(
scÜes
);

1601 ià(
added
 || 
upd©ed
) {

1602 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

1603 
	`nÙifyKey¥aûEv’t
(
NOTIFY_ZSET
,

1604 
šü
 ? "zšü" : "zadd", 
key
, 
c
->
db
->
id
);

1606 
	}
}

1608 
	$zaddCommªd
(
ş›Á
 *
c
) {

1609 
	`zaddG’”icCommªd
(
c
,
ZADD_NONE
);

1610 
	}
}

1612 
	$zšübyCommªd
(
ş›Á
 *
c
) {

1613 
	`zaddG’”icCommªd
(
c
,
ZADD_INCR
);

1614 
	}
}

1616 
	$z»mCommªd
(
ş›Á
 *
c
) {

1617 
robj
 *
key
 = 
c
->
¬gv
[1];

1618 
robj
 *
zobj
;

1619 
d–‘ed
 = 0, 
key»moved
 = 0, 
j
;

1621 ià((
zobj
 = 
	`lookupKeyWr™eOrR•ly
(
c
,
key
,
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

1622 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

1624 
j
 = 2; j < 
c
->
¬gc
; j++) {

1625 ià(
	`z£tD–
(
zobj
,
c
->
¬gv
[
j
]->
±r
)è
d–‘ed
++;

1626 ià(
	`z£tL’gth
(
zobj
) == 0) {

1627 
	`dbD–‘e
(
c
->
db
,
key
);

1628 
key»moved
 = 1;

1633 ià(
d–‘ed
) {

1634 
	`nÙifyKey¥aûEv’t
(
NOTIFY_ZSET
,"z»m",
key
,
c
->
db
->
id
);

1635 ià(
key»moved
)

1636 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
key
,
c
->
db
->
id
);

1637 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

1638 
£rv”
.
dœty
 +ğ
d–‘ed
;

1640 
	`addR•lyLÚgLÚg
(
c
,
d–‘ed
);

1641 
	}
}

1644 
	#ZRANGE_RANK
 0

	)

1645 
	#ZRANGE_SCORE
 1

	)

1646 
	#ZRANGE_LEX
 2

	)

1647 
	$z»m¿ngeG’”icCommªd
(
ş›Á
 *
c
, 
¿ng‘y³
) {

1648 
robj
 *
key
 = 
c
->
¬gv
[1];

1649 
robj
 *
zobj
;

1650 
key»moved
 = 0;

1651 
d–‘ed
 = 0;

1652 
z¿nge¥ec
 
¿nge
;

1653 
zËx¿nge¥ec
 
Ëx¿nge
;

1654 
¡¬t
, 
’d
, 
Î’
;

1657 ià(
¿ng‘y³
 =ğ
ZRANGE_RANK
) {

1658 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[2],&
¡¬t
,
NULL
è!ğ
C_OK
) ||

1659 (
	`g‘LÚgFromObjeùOrR•ly
(
c
,c->
¬gv
[3],&
’d
,
NULL
è!ğ
C_OK
))

1661 } ià(
¿ng‘y³
 =ğ
ZRANGE_SCORE
) {

1662 ià(
	`z¦P¬£Rªge
(
c
->
¬gv
[2],c->¬gv[3],&
¿nge
è!ğ
C_OK
) {

1663 
	`addR•lyE¼Ü
(
c
,"min or max is‚ot‡ float");

1666 } ià(
¿ng‘y³
 =ğ
ZRANGE_LEX
) {

1667 ià(
	`z¦P¬£LexRªge
(
c
->
¬gv
[2],c->¬gv[3],&
Ëx¿nge
è!ğ
C_OK
) {

1668 
	`addR•lyE¼Ü
(
c
,"min or max‚ot valid string„ange item");

1674 ià((
zobj
 = 
	`lookupKeyWr™eOrR•ly
(
c
,
key
,
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

1675 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)è
ş—nup
;

1677 ià(
¿ng‘y³
 =ğ
ZRANGE_RANK
) {

1679 
Î’
 = 
	`z£tL’gth
(
zobj
);

1680 ià(
¡¬t
 < 0è¡¬ˆğ
Î’
+start;

1681 ià(
’d
 < 0è’d = 
Î’
+end;

1682 ià(
¡¬t
 < 0) start = 0;

1686 ià(
¡¬t
 > 
’d
 || s¹ >ğ
Î’
) {

1687 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

1688 
ş—nup
;

1690 ià(
’d
 >ğ
Î’
)ƒnd =†len-1;

1694 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1695 
¿ng‘y³
) {

1696 
ZRANGE_RANK
:

1697 
zobj
->
±r
 = 
	`zzlD–‘eRªgeByRªk
(zobj->±r,
¡¬t
+1,
’d
+1,&
d–‘ed
);

1699 
ZRANGE_SCORE
:

1700 
zobj
->
±r
 = 
	`zzlD–‘eRªgeByScÜe
(zobj->±r,&
¿nge
,&
d–‘ed
);

1702 
ZRANGE_LEX
:

1703 
zobj
->
±r
 = 
	`zzlD–‘eRªgeByLex
(zobj->±r,&
Ëx¿nge
,&
d–‘ed
);

1706 ià(
	`zzlL’gth
(
zobj
->
±r
) == 0) {

1707 
	`dbD–‘e
(
c
->
db
,
key
);

1708 
key»moved
 = 1;

1710 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1711 
z£t
 *
zs
 = 
zobj
->
±r
;

1712 
¿ng‘y³
) {

1713 
ZRANGE_RANK
:

1714 
d–‘ed
 = 
	`z¦D–‘eRªgeByRªk
(
zs
->
z¦
,
¡¬t
+1,
’d
+1,zs->
diù
);

1716 
ZRANGE_SCORE
:

1717 
d–‘ed
 = 
	`z¦D–‘eRªgeByScÜe
(
zs
->
z¦
,&
¿nge
,zs->
diù
);

1719 
ZRANGE_LEX
:

1720 
d–‘ed
 = 
	`z¦D–‘eRªgeByLex
(
zs
->
z¦
,&
Ëx¿nge
,zs->
diù
);

1723 ià(
	`htN“dsResize
(
zs
->
diù
)è
	`diùResize
(zs->dict);

1724 ià(
	`diùSize
(
zs
->
diù
) == 0) {

1725 
	`dbD–‘e
(
c
->
db
,
key
);

1726 
key»moved
 = 1;

1729 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1733 ià(
d–‘ed
) {

1734 *
ev’t
[3] = {"zremrangebyrank","zremrangebyscore","zremrangebylex"};

1735 
	`sigÇlModif›dKey
(
c
->
db
,
key
);

1736 
	`nÙifyKey¥aûEv’t
(
NOTIFY_ZSET
,
ev’t
[
¿ng‘y³
],
key
,
c
->
db
->
id
);

1737 ià(
key»moved
)

1738 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
key
,
c
->
db
->
id
);

1740 
£rv”
.
dœty
 +ğ
d–‘ed
;

1741 
	`addR•lyLÚgLÚg
(
c
,
d–‘ed
);

1743 
ş—nup
:

1744 ià(
¿ng‘y³
 =ğ
ZRANGE_LEX
è
	`z¦F»eLexRªge
(&
Ëx¿nge
);

1745 
	}
}

1747 
	$z»m¿ngeby¿nkCommªd
(
ş›Á
 *
c
) {

1748 
	`z»m¿ngeG’”icCommªd
(
c
,
ZRANGE_RANK
);

1749 
	}
}

1751 
	$z»m¿ngebyscÜeCommªd
(
ş›Á
 *
c
) {

1752 
	`z»m¿ngeG’”icCommªd
(
c
,
ZRANGE_SCORE
);

1753 
	}
}

1755 
	$z»m¿ngebyËxCommªd
(
ş›Á
 *
c
) {

1756 
	`z»m¿ngeG’”icCommªd
(
c
,
ZRANGE_LEX
);

1757 
	}
}

1760 
robj
 *
	msubjeù
;

1761 
	mty³
;

1762 
	m’codšg
;

1763 
	mweight
;

1767 
	u_™”£t
 {

1769 
št£t
 *
	mis
;

1770 
	mii
;

1771 } 
	mis
;

1773 
diù
 *
	mdiù
;

1774 
diùI‹¿tÜ
 *
	mdi
;

1775 
diùEÁry
 *
	mde
;

1776 } 
	mht
;

1777 } 
	m£t
;

1780 
	u_™”z£t
 {

1782 *
	mzl
;

1783 *
	m•Œ
, *
	m¥Œ
;

1784 } 
	mzl
;

1786 
z£t
 *
	mzs
;

1787 
zskli¡Node
 *
	mnode
;

1788 } 
	m¦
;

1789 } 
	mz£t
;

1790 } 
	m™”
;

1791 } 
	tz£tİ¤c
;

1800 
	#OPVAL_DIRTY_SDS
 1

	)

1801 
	#OPVAL_DIRTY_LL
 2

	)

1802 
	#OPVAL_VALID_LL
 4

	)

1806 
	mæags
;

1807 
	m_buf
[32];

1808 
sds
 
	m–e
;

1809 *
	me¡r
;

1810 
	m–’
;

1811 
	m–l
;

1812 
	mscÜe
;

1813 } 
	tz£tİv®
;

1815 
_™”£t
 
	t™”£t
;

1816 
_™”z£t
 
	t™”z£t
;

1818 
	$zuiIn™I‹¿tÜ
(
z£tİ¤c
 *
İ
) {

1819 ià(
İ
->
subjeù
 =ğ
NULL
)

1822 ià(
İ
->
ty³
 =ğ
OBJ_SET
) {

1823 
™”£t
 *
™
 = &
İ
->
™”
.
£t
;

1824 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

1825 
™
->
is
.i ğ
İ
->
subjeù
->
±r
;

1826 
™
->
is
.
ii
 = 0;

1827 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

1828 
™
->
ht
.
diù
 = 
İ
->
subjeù
->
±r
;

1829 
™
->
ht
.
di
 = 
	`diùG‘I‹¿tÜ
(
İ
->
subjeù
->
±r
);

1830 
™
->
ht
.
de
 = 
	`diùNext
(™->ht.
di
);

1832 
	`£rv”Pªic
("Unknown setƒncoding");

1834 } ià(
İ
->
ty³
 =ğ
OBJ_ZSET
) {

1835 
™”z£t
 *
™
 = &
İ
->
™”
.
z£t
;

1836 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1837 
™
->
zl
.zÈğ
İ
->
subjeù
->
±r
;

1838 
™
->
zl
.
•Œ
 = 
	`zli¡Index
(it->zl.zl,0);

1839 ià(
™
->
zl
.
•Œ
 !ğ
NULL
) {

1840 
™
->
zl
.
¥Œ
 = 
	`zli¡Next
(™->zl.zl,™->zl.
•Œ
);

1841 
	`£rv”As£¹
(
™
->
zl
.
¥Œ
 !ğ
NULL
);

1843 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1844 
™
->
¦
.
zs
 = 
İ
->
subjeù
->
±r
;

1845 
™
->
¦
.
node
 = it->¦.
zs
->
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

1847 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1850 
	`£rv”Pªic
("Unsupportedype");

1852 
	}
}

1854 
	$zuiCË¬I‹¿tÜ
(
z£tİ¤c
 *
İ
) {

1855 ià(
İ
->
subjeù
 =ğ
NULL
)

1858 ià(
İ
->
ty³
 =ğ
OBJ_SET
) {

1859 
™”£t
 *
™
 = &
İ
->
™”
.
£t
;

1860 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

1861 
	`UNUSED
(
™
);

1862 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

1863 
	`diùR–—£I‹¿tÜ
(
™
->
ht
.
di
);

1865 
	`£rv”Pªic
("Unknown setƒncoding");

1867 } ià(
İ
->
ty³
 =ğ
OBJ_ZSET
) {

1868 
™”z£t
 *
™
 = &
İ
->
™”
.
z£t
;

1869 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1870 
	`UNUSED
(
™
);

1871 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1872 
	`UNUSED
(
™
);

1874 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1877 
	`£rv”Pªic
("Unsupportedype");

1879 
	}
}

1881 
	$zuiL’gth
(
z£tİ¤c
 *
İ
) {

1882 ià(
İ
->
subjeù
 =ğ
NULL
)

1885 ià(
İ
->
ty³
 =ğ
OBJ_SET
) {

1886 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

1887  
	`št£tL’
(
İ
->
subjeù
->
±r
);

1888 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

1889 
diù
 *
ht
 = 
İ
->
subjeù
->
±r
;

1890  
	`diùSize
(
ht
);

1892 
	`£rv”Pªic
("Unknown setƒncoding");

1894 } ià(
İ
->
ty³
 =ğ
OBJ_ZSET
) {

1895 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1896  
	`zzlL’gth
(
İ
->
subjeù
->
±r
);

1897 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1898 
z£t
 *
zs
 = 
İ
->
subjeù
->
±r
;

1899  
zs
->
z¦
->
Ëngth
;

1901 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1904 
	`£rv”Pªic
("Unsupportedype");

1906 
	}
}

1911 
	$zuiNext
(
z£tİ¤c
 *
İ
, 
z£tİv®
 *
v®
) {

1912 ià(
İ
->
subjeù
 =ğ
NULL
)

1915 ià(
v®
->
æags
 & 
OPVAL_DIRTY_SDS
)

1916 
	`sdsä“
(
v®
->
–e
);

1918 
	`mem£t
(
v®
,0,(
z£tİv®
));

1920 ià(
İ
->
ty³
 =ğ
OBJ_SET
) {

1921 
™”£t
 *
™
 = &
İ
->
™”
.
£t
;

1922 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

1923 
št64_t
 
–l
;

1925 ià(!
	`št£tG‘
(
™
->
is
.is,™->is.
ii
,&
–l
))

1927 
v®
->
–l
 =ƒll;

1928 
v®
->
scÜe
 = 1.0;

1931 
™
->
is
.
ii
++;

1932 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

1933 ià(
™
->
ht
.
de
 =ğ
NULL
)

1935 
v®
->
–e
 = 
	`diùG‘Key
(
™
->
ht
.
de
);

1936 
v®
->
scÜe
 = 1.0;

1939 
™
->
ht
.
de
 = 
	`diùNext
(™->ht.
di
);

1941 
	`£rv”Pªic
("Unknown setƒncoding");

1943 } ià(
İ
->
ty³
 =ğ
OBJ_ZSET
) {

1944 
™”z£t
 *
™
 = &
İ
->
™”
.
z£t
;

1945 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

1947 ià(
™
->
zl
.
•Œ
 =ğ
NULL
 || it->zl.
¥Œ
 == NULL)

1949 
	`£rv”As£¹
(
	`zli¡G‘
(
™
->
zl
.
•Œ
,&
v®
->
e¡r
,&v®->
–’
,&v®->
–l
));

1950 
v®
->
scÜe
 = 
	`zzlG‘ScÜe
(
™
->
zl
.
¥Œ
);

1953 
	`zzlNext
(
™
->
zl
.zl,&™->zl.
•Œ
,&™->zl.
¥Œ
);

1954 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

1955 ià(
™
->
¦
.
node
 =ğ
NULL
)

1957 
v®
->
–e
 = 
™
->
¦
.
node
->ele;

1958 
v®
->
scÜe
 = 
™
->
¦
.
node
->score;

1961 
™
->
¦
.
node
 = it->¦.node->
Ëv–
[0].
fÜw¬d
;

1963 
	`£rv”Pªic
("Unknown sorted setƒncoding");

1966 
	`£rv”Pªic
("Unsupportedype");

1969 
	}
}

1971 
	$zuiLÚgLÚgFromV®ue
(
z£tİv®
 *
v®
) {

1972 ià(!(
v®
->
æags
 & 
OPVAL_DIRTY_LL
)) {

1973 
v®
->
æags
 |ğ
OPVAL_DIRTY_LL
;

1975 ià(
v®
->
–e
 !ğ
NULL
) {

1976 ià(
	`¡ršg2Î
(
v®
->
–e
,
	`sd¦’
(v®->–e),&v®->
–l
))

1977 
v®
->
æags
 |ğ
OPVAL_VALID_LL
;

1978 } ià(
v®
->
e¡r
 !ğ
NULL
) {

1979 ià(
	`¡ršg2Î
((*)
v®
->
e¡r
,v®->
–’
,&v®->
–l
))

1980 
v®
->
æags
 |ğ
OPVAL_VALID_LL
;

1983 
v®
->
æags
 |ğ
OPVAL_VALID_LL
;

1986  
v®
->
æags
 & 
OPVAL_VALID_LL
;

1987 
	}
}

1989 
sds
 
	$zuiSdsFromV®ue
(
z£tİv®
 *
v®
) {

1990 ià(
v®
->
–e
 =ğ
NULL
) {

1991 ià(
v®
->
e¡r
 !ğ
NULL
) {

1992 
v®
->
–e
 = 
	`sd¢ewËn
((*)v®->
e¡r
,v®->
–’
);

1994 
v®
->
–e
 = 
	`sdsäomlÚglÚg
(v®->
–l
);

1996 
v®
->
æags
 |ğ
OPVAL_DIRTY_SDS
;

1998  
v®
->
–e
;

1999 
	}
}

2003 
sds
 
	$zuiNewSdsFromV®ue
(
z£tİv®
 *
v®
) {

2004 ià(
v®
->
æags
 & 
OPVAL_DIRTY_SDS
) {

2006 
sds
 
–e
 = 
v®
->ele;

2007 
v®
->
æags
 &ğ~
OPVAL_DIRTY_SDS
;

2008 
v®
->
–e
 = 
NULL
;

2009  
–e
;

2010 } ià(
v®
->
–e
) {

2011  
	`sdsdup
(
v®
->
–e
);

2012 } ià(
v®
->
e¡r
) {

2013  
	`sd¢ewËn
((*)
v®
->
e¡r
,v®->
–’
);

2015  
	`sdsäomlÚglÚg
(
v®
->
–l
);

2017 
	}
}

2019 
	$zuiBufãrFromV®ue
(
z£tİv®
 *
v®
) {

2020 ià(
v®
->
e¡r
 =ğ
NULL
) {

2021 ià(
v®
->
–e
 !ğ
NULL
) {

2022 
v®
->
–’
 = 
	`sd¦’
(v®->
–e
);

2023 
v®
->
e¡r
 = (*)v®->
–e
;

2025 
v®
->
–’
 = 
	`Î2¡ršg
((*)v®->
_buf
,(v®->_buf),v®->
–l
);

2026 
v®
->
e¡r
 = v®->
_buf
;

2030 
	}
}

2034 
	$zuiFšd
(
z£tİ¤c
 *
İ
, 
z£tİv®
 *
v®
, *
scÜe
) {

2035 ià(
İ
->
subjeù
 =ğ
NULL
)

2038 ià(
İ
->
ty³
 =ğ
OBJ_SET
) {

2039 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_INTSET
) {

2040 ià(
	`zuiLÚgLÚgFromV®ue
(
v®
) &&

2041 
	`št£tFšd
(
İ
->
subjeù
->
±r
,
v®
->
–l
))

2043 *
scÜe
 = 1.0;

2048 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_HT
) {

2049 
diù
 *
ht
 = 
İ
->
subjeù
->
±r
;

2050 
	`zuiSdsFromV®ue
(
v®
);

2051 ià(
	`diùFšd
(
ht
,
v®
->
–e
è!ğ
NULL
) {

2052 *
scÜe
 = 1.0;

2058 
	`£rv”Pªic
("Unknown setƒncoding");

2060 } ià(
İ
->
ty³
 =ğ
OBJ_ZSET
) {

2061 
	`zuiSdsFromV®ue
(
v®
);

2063 ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2064 ià(
	`zzlFšd
(
İ
->
subjeù
->
±r
,
v®
->
–e
,
scÜe
è!ğ
NULL
) {

2070 } ià(
İ
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2071 
z£t
 *
zs
 = 
İ
->
subjeù
->
±r
;

2072 
diùEÁry
 *
de
;

2073 ià((
de
 = 
	`diùFšd
(
zs
->
diù
,
v®
->
–e
)è!ğ
NULL
) {

2074 *
scÜe
 = *(*)
	`diùG‘V®
(
de
);

2080 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2083 
	`£rv”Pªic
("Unsupportedype");

2085 
	}
}

2087 
	$zuiCom·»ByC¬dš®™y
(cÚ¡ *
s1
, cÚ¡ *
s2
) {

2088  
	`zuiL’gth
((
z£tİ¤c
*)
s1
è- zuiL’gth((z£tİ¤c*)
s2
);

2089 
	}
}

2091 
	#REDIS_AGGR_SUM
 1

	)

2092 
	#REDIS_AGGR_MIN
 2

	)

2093 
	#REDIS_AGGR_MAX
 3

	)

2094 
	#zuniÚIÁ”DiùV®ue
(
_e
è(
	`diùG‘V®
(_eè=ğ
NULL
 ? 1.0 : *(*)diùG‘V®(_e))

	)

2096 
šlše
 
	$zuniÚIÁ”Agg»g©e
(*
rg‘
, 
v®
, 
agg»g©e
) {

2097 ià(
agg»g©e
 =ğ
REDIS_AGGR_SUM
) {

2098 *
rg‘
 = *rg‘ + 
v®
;

2102 ià(
	`i¢ª
(*
rg‘
)) *target = 0.0;

2103 } ià(
agg»g©e
 =ğ
REDIS_AGGR_MIN
) {

2104 *
rg‘
 = 
v®
 < *target ? val : *target;

2105 } ià(
agg»g©e
 =ğ
REDIS_AGGR_MAX
) {

2106 *
rg‘
 = 
v®
 > *target ? val : *target;

2109 
	`£rv”Pªic
("Unknown ZUNION/INTER‡ggregateype");

2111 
	}
}

2113 
diùSdsHash
(cÚ¡ *
key
);

2114 
diùSdsKeyCom·»
(*
´ivd©a
, cÚ¡ *
key1
, cÚ¡ *
key2
);

2116 
diùTy³
 
	g£tAccumuÏtÜDiùTy³
 = {

2117 
diùSdsHash
,

2118 
NULL
,

2119 
NULL
,

2120 
diùSdsKeyCom·»
,

2121 
NULL
,

2122 
NULL


2125 
	$zuniÚIÁ”G’”icCommªd
(
ş›Á
 *
c
, 
robj
 *
d¡key
, 
İ
) {

2126 
i
, 
j
;

2127 
£Šum
;

2128 
agg»g©e
 = 
REDIS_AGGR_SUM
;

2129 
z£tİ¤c
 *
¤c
;

2130 
z£tİv®
 
zv®
;

2131 
sds
 
tmp
;

2132 
max––’
 = 0;

2133 
robj
 *
d¡obj
;

2134 
z£t
 *
d¡z£t
;

2135 
zskli¡Node
 *
znode
;

2136 
touched
 = 0;

2139 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
£Šum
, 
NULL
è!ğ
C_OK
))

2142 ià(
£Šum
 < 1) {

2143 
	`addR•lyE¼Ü
(
c
,

2149 ià(
£Šum
 > 
c
->
¬gc
-3) {

2150 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2155 
¤c
 = 
	`zÿÎoc
((
z£tİ¤c
è* 
£Šum
);

2156 
i
 = 0, 
j
 = 3; i < 
£Šum
; i++, j++) {

2157 
robj
 *
obj
 = 
	`lookupKeyWr™e
(
c
->
db
,c->
¬gv
[
j
]);

2158 ià(
obj
 !ğ
NULL
) {

2159 ià(
obj
->
ty³
 !ğ
OBJ_ZSET
 && obj->ty³ !ğ
OBJ_SET
) {

2160 
	`zä“
(
¤c
);

2161 
	`addR•ly
(
c
,
sh¬ed
.
wrÚgty³”r
);

2165 
¤c
[
i
].
subjeù
 = 
obj
;

2166 
¤c
[
i
].
ty³
 = 
obj
->type;

2167 
¤c
[
i
].
’codšg
 = 
obj
->encoding;

2169 
¤c
[
i
].
subjeù
 = 
NULL
;

2173 
¤c
[
i
].
weight
 = 1.0;

2177 ià(
j
 < 
c
->
¬gc
) {

2178 
»maššg
 = 
c
->
¬gc
 - 
j
;

2180 
»maššg
) {

2181 ià(
»maššg
 >ğ(
£Šum
 + 1) &&

2182 !
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"weights"))

2184 
j
++; 
»maššg
--;

2185 
i
 = 0; i < 
£Šum
; i++, 
j
++, 
»maššg
--) {

2186 ià(
	`g‘DoubËFromObjeùOrR•ly
(
c
,c->
¬gv
[
j
],&
¤c
[
i
].
weight
,

2187 "weighˆv®ui nÙ‡ flßt"è!ğ
C_OK
)

2189 
	`zä“
(
¤c
);

2193 } ià(
»maššg
 >= 2 &&

2194 !
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"aggregate"))

2196 
j
++; 
»maššg
--;

2197 ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"sum")) {

2198 
agg»g©e
 = 
REDIS_AGGR_SUM
;

2199 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"min")) {

2200 
agg»g©e
 = 
REDIS_AGGR_MIN
;

2201 } ià(!
	`¡rÿ£cmp
(
c
->
¬gv
[
j
]->
±r
,"max")) {

2202 
agg»g©e
 = 
REDIS_AGGR_MAX
;

2204 
	`zä“
(
¤c
);

2205 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2208 
j
++; 
»maššg
--;

2210 
	`zä“
(
¤c
);

2211 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2219 
	`qsÜt
(
¤c
,
£Šum
,(
z£tİ¤c
),
zuiCom·»ByC¬dš®™y
);

2221 
d¡obj
 = 
	`ü—‹Z£tObjeù
();

2222 
d¡z£t
 = 
d¡obj
->
±r
;

2223 
	`mem£t
(&
zv®
, 0, (zval));

2225 ià(
İ
 =ğ
SET_OP_INTER
) {

2227 ià(
	`zuiL’gth
(&
¤c
[0]) > 0) {

2230 
	`zuiIn™I‹¿tÜ
(&
¤c
[0]);

2231 
	`zuiNext
(&
¤c
[0],&
zv®
)) {

2232 
scÜe
, 
v®ue
;

2234 
scÜe
 = 
¤c
[0].
weight
 * 
zv®
.score;

2235 ià(
	`i¢ª
(
scÜe
)) score = 0;

2237 
j
 = 1; j < 
£Šum
; j++) {

2240 ià(
¤c
[
j
].
subjeù
 == src[0].subject) {

2241 
v®ue
 = 
zv®
.
scÜe
*
¤c
[
j
].
weight
;

2242 
	`zuniÚIÁ”Agg»g©e
(&
scÜe
,
v®ue
,
agg»g©e
);

2243 } ià(
	`zuiFšd
(&
¤c
[
j
],&
zv®
,&
v®ue
)) {

2244 
v®ue
 *ğ
¤c
[
j
].
weight
;

2245 
	`zuniÚIÁ”Agg»g©e
(&
scÜe
,
v®ue
,
agg»g©e
);

2252 ià(
j
 =ğ
£Šum
) {

2253 
tmp
 = 
	`zuiNewSdsFromV®ue
(&
zv®
);

2254 
znode
 = 
	`z¦In£¹
(
d¡z£t
->
z¦
,
scÜe
,
tmp
);

2255 
	`diùAdd
(
d¡z£t
->
diù
,
tmp
,&
znode
->
scÜe
);

2256 ià(
	`sd¦’
(
tmp
è> 
max––’
) maxelelen = sdslen(tmp);

2259 
	`zuiCË¬I‹¿tÜ
(&
¤c
[0]);

2261 } ià(
İ
 =ğ
SET_OP_UNION
) {

2262 
diù
 *
accumuÏtÜ
 = 
	`diùC»©e
(&
£tAccumuÏtÜDiùTy³
,
NULL
);

2263 
diùI‹¿tÜ
 *
di
;

2264 
diùEÁry
 *
de
, *
exi¡šg
;

2265 
scÜe
;

2267 ià(
£Šum
) {

2270 
	`diùEx·nd
(
accumuÏtÜ
,
	`zuiL’gth
(&
¤c
[
£Šum
-1]));

2275 
i
 = 0; i < 
£Šum
; i++) {

2276 ià(
	`zuiL’gth
(&
¤c
[
i
]) == 0) ;

2278 
	`zuiIn™I‹¿tÜ
(&
¤c
[
i
]);

2279 
	`zuiNext
(&
¤c
[
i
],&
zv®
)) {

2281 
scÜe
 = 
¤c
[
i
].
weight
 * 
zv®
.score;

2282 ià(
	`i¢ª
(
scÜe
)) score = 0;

2285 
de
 = 
	`diùAddRaw
(
accumuÏtÜ
,
	`zuiSdsFromV®ue
(&
zv®
),&
exi¡šg
);

2287 ià(!
exi¡šg
) {

2288 
tmp
 = 
	`zuiNewSdsFromV®ue
(&
zv®
);

2292 ià(
	`sd¦’
(
tmp
è> 
max––’
) maxelelen = sdslen(tmp);

2294 
	`diùS‘Key
(
accumuÏtÜ
, 
de
, 
tmp
);

2295 
	`diùS‘DoubËV®
(
de
,
scÜe
);

2303 
	`zuniÚIÁ”Agg»g©e
(&
exi¡šg
->
v
.
d
,
scÜe
,
agg»g©e
);

2306 
	`zuiCË¬I‹¿tÜ
(&
¤c
[
i
]);

2310 
di
 = 
	`diùG‘I‹¿tÜ
(
accumuÏtÜ
);

2315 
	`diùEx·nd
(
d¡z£t
->
diù
,
	`diùSize
(
accumuÏtÜ
));

2317 (
de
 = 
	`diùNext
(
di
)è!ğ
NULL
) {

2318 
sds
 
–e
 = 
	`diùG‘Key
(
de
);

2319 
scÜe
 = 
	`diùG‘DoubËV®
(
de
);

2320 
znode
 = 
	`z¦In£¹
(
d¡z£t
->
z¦
,
scÜe
,
–e
);

2321 
	`diùAdd
(
d¡z£t
->
diù
,
–e
,&
znode
->
scÜe
);

2323 
	`diùR–—£I‹¿tÜ
(
di
);

2324 
	`diùR–—£
(
accumuÏtÜ
);

2326 
	`£rv”Pªic
("Unknown operator");

2329 ià(
	`dbD–‘e
(
c
->
db
,
d¡key
))

2330 
touched
 = 1;

2331 ià(
d¡z£t
->
z¦
->
Ëngth
) {

2332 
	`z£tCÚv”tToZli¡IfN“ded
(
d¡obj
,
max––’
);

2333 
	`dbAdd
(
c
->
db
,
d¡key
,
d¡obj
);

2334 
	`addR•lyLÚgLÚg
(
c
,
	`z£tL’gth
(
d¡obj
));

2335 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

2336 
	`nÙifyKey¥aûEv’t
(
NOTIFY_ZSET
,

2337 (
İ
 =ğ
SET_OP_UNION
) ? "zunionstore" : "zinterstore",

2338 
d¡key
,
c
->
db
->
id
);

2339 
£rv”
.
dœty
++;

2341 
	`deüRefCouÁ
(
d¡obj
);

2342 
	`addR•ly
(
c
,
sh¬ed
.
cz”o
);

2343 ià(
touched
) {

2344 
	`sigÇlModif›dKey
(
c
->
db
,
d¡key
);

2345 
	`nÙifyKey¥aûEv’t
(
NOTIFY_GENERIC
,"d–",
d¡key
,
c
->
db
->
id
);

2346 
£rv”
.
dœty
++;

2349 
	`zä“
(
¤c
);

2350 
	}
}

2352 
	$zuniÚ¡ÜeCommªd
(
ş›Á
 *
c
) {

2353 
	`zuniÚIÁ”G’”icCommªd
(
c
,c->
¬gv
[1], 
SET_OP_UNION
);

2354 
	}
}

2356 
	$zš‹r¡ÜeCommªd
(
ş›Á
 *
c
) {

2357 
	`zuniÚIÁ”G’”icCommªd
(
c
,c->
¬gv
[1], 
SET_OP_INTER
);

2358 
	}
}

2360 
	$z¿ngeG’”icCommªd
(
ş›Á
 *
c
, 
»v”£
) {

2361 
robj
 *
key
 = 
c
->
¬gv
[1];

2362 
robj
 *
zobj
;

2363 
w™hscÜes
 = 0;

2364 
¡¬t
;

2365 
’d
;

2366 
Î’
;

2367 
¿ng–’
;

2369 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[2], &
¡¬t
, 
NULL
è!ğ
C_OK
) ||

2370 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[3], &
’d
, 
NULL
è!ğ
C_OK
)) ;

2372 ià(
c
->
¬gc
 =ğ5 && !
	`¡rÿ£cmp
(c->
¬gv
[4]->
±r
,"withscores")) {

2373 
w™hscÜes
 = 1;

2374 } ià(
c
->
¬gc
 >= 5) {

2375 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2379 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL


2380 || 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

2383 
Î’
 = 
	`z£tL’gth
(
zobj
);

2384 ià(
¡¬t
 < 0è¡¬ˆğ
Î’
+start;

2385 ià(
’d
 < 0è’d = 
Î’
+end;

2386 ià(
¡¬t
 < 0) start = 0;

2390 ià(
¡¬t
 > 
’d
 || s¹ >ğ
Î’
) {

2391 
	`addR•ly
(
c
,
sh¬ed
.
em±ymuÉibulk
);

2394 ià(
’d
 >ğ
Î’
)ƒnd =†len-1;

2395 
¿ng–’
 = (
’d
-
¡¬t
)+1;

2398 
	`addR•lyMuÉiBulkL’
(
c
, 
w™hscÜes
 ? (
¿ng–’
*2) :„angelen);

2400 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2401 *
zl
 = 
zobj
->
±r
;

2402 *
•Œ
, *
¥Œ
;

2403 *
v¡r
;

2404 
vËn
;

2405 
vlÚg
;

2407 ià(
»v”£
)

2408 
•Œ
 = 
	`zli¡Index
(
zl
,-2-(2*
¡¬t
));

2410 
•Œ
 = 
	`zli¡Index
(
zl
,2*
¡¬t
);

2412 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
•Œ
 !ğ
NULL
);

2413 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

2415 
¿ng–’
--) {

2416 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
•Œ
 !ğ
NULL
 && 
¥Œ
 != NULL);

2417 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

2418 ià(
v¡r
 =ğ
NULL
)

2419 
	`addR•lyBulkLÚgLÚg
(
c
,
vlÚg
);

2421 
	`addR•lyBulkCBufãr
(
c
,
v¡r
,
vËn
);

2423 ià(
w™hscÜes
)

2424 
	`addR•lyDoubË
(
c
,
	`zzlG‘ScÜe
(
¥Œ
));

2426 ià(
»v”£
)

2427 
	`zzlP»v
(
zl
,&
•Œ
,&
¥Œ
);

2429 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2432 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2433 
z£t
 *
zs
 = 
zobj
->
±r
;

2434 
zskli¡
 *
z¦
 = 
zs
->zsl;

2435 
zskli¡Node
 *
Ê
;

2436 
sds
 
–e
;

2439 ià(
»v”£
) {

2440 
Ê
 = 
z¦
->

;

2441 ià(
¡¬t
 > 0)

2442 
Ê
 = 
	`z¦G‘EËm’tByRªk
(
z¦
,
Î’
-
¡¬t
);

2444 
Ê
 = 
z¦
->
h—d”
->
Ëv–
[0].
fÜw¬d
;

2445 ià(
¡¬t
 > 0)

2446 
Ê
 = 
	`z¦G‘EËm’tByRªk
(
z¦
,
¡¬t
+1);

2449 
¿ng–’
--) {

2450 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
Ê
 !ğ
NULL
);

2451 
–e
 = 
Ê
->ele;

2452 
	`addR•lyBulkCBufãr
(
c
,
–e
,
	`sd¦’
(ele));

2453 ià(
w™hscÜes
)

2454 
	`addR•lyDoubË
(
c
,
Ê
->
scÜe
);

2455 
Ê
 = 
»v”£
 ?†n->
backw¬d
 :†n->
Ëv–
[0].
fÜw¬d
;

2458 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2460 
	}
}

2462 
	$z¿ngeCommªd
(
ş›Á
 *
c
) {

2463 
	`z¿ngeG’”icCommªd
(
c
,0);

2464 
	}
}

2466 
	$z»v¿ngeCommªd
(
ş›Á
 *
c
) {

2467 
	`z¿ngeG’”icCommªd
(
c
,1);

2468 
	}
}

2471 
	$g’”icZ¿ngebyscÜeCommªd
(
ş›Á
 *
c
, 
»v”£
) {

2472 
z¿nge¥ec
 
¿nge
;

2473 
robj
 *
key
 = 
c
->
¬gv
[1];

2474 
robj
 *
zobj
;

2475 
off£t
 = 0, 
lim™
 = -1;

2476 
w™hscÜes
 = 0;

2477 
¿ng–’
 = 0;

2478 *
»¶yËn
 = 
NULL
;

2479 
mšidx
, 
maxidx
;

2482 ià(
»v”£
) {

2484 
maxidx
 = 2; 
mšidx
 = 3;

2487 
mšidx
 = 2; 
maxidx
 = 3;

2490 ià(
	`z¦P¬£Rªge
(
c
->
¬gv
[
mšidx
],c->¬gv[
maxidx
],&
¿nge
è!ğ
C_OK
) {

2491 
	`addR•lyE¼Ü
(
c
,"min or max is‚ot‡ float");

2497 ià(
c
->
¬gc
 > 4) {

2498 
»maššg
 = 
c
->
¬gc
 - 4;

2499 
pos
 = 4;

2501 
»maššg
) {

2502 ià(
»maššg
 >ğ1 && !
	`¡rÿ£cmp
(
c
->
¬gv
[
pos
]->
±r
,"withscores")) {

2503 
pos
++; 
»maššg
--;

2504 
w™hscÜes
 = 1;

2505 } ià(
»maššg
 >ğ3 && !
	`¡rÿ£cmp
(
c
->
¬gv
[
pos
]->
±r
,"limit")) {

2506 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
pos
+1], &
off£t
, 
NULL
)

2507 !ğ
C_OK
) ||

2508 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
pos
+2], &
lim™
, 
NULL
)

2509 !ğ
C_OK
))

2513 
pos
 +ğ3; 
»maššg
 -= 3;

2515 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2522 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL
 ||

2523 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

2525 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2526 *
zl
 = 
zobj
->
±r
;

2527 *
•Œ
, *
¥Œ
;

2528 *
v¡r
;

2529 
vËn
;

2530 
vlÚg
;

2531 
scÜe
;

2534 ià(
»v”£
) {

2535 
•Œ
 = 
	`zzlLa¡InRªge
(
zl
,&
¿nge
);

2537 
•Œ
 = 
	`zzlFœ¡InRªge
(
zl
,&
¿nge
);

2541 ià(
•Œ
 =ğ
NULL
) {

2542 
	`addR•ly
(
c
, 
sh¬ed
.
em±ymuÉibulk
);

2547 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
•Œ
 !ğ
NULL
);

2548 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

2553 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2557 
•Œ
 && 
off£t
--) {

2558 ià(
»v”£
) {

2559 
	`zzlP»v
(
zl
,&
•Œ
,&
¥Œ
);

2561 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2565 
•Œ
 && 
lim™
--) {

2566 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

2569 ià(
»v”£
) {

2570 ià(!
	`z¦V®ueG‹Mš
(
scÜe
,&
¿nge
)) ;

2572 ià(!
	`z¦V®ueL‹Max
(
scÜe
,&
¿nge
)) ;

2576 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

2578 
¿ng–’
++;

2579 ià(
v¡r
 =ğ
NULL
) {

2580 
	`addR•lyBulkLÚgLÚg
(
c
,
vlÚg
);

2582 
	`addR•lyBulkCBufãr
(
c
,
v¡r
,
vËn
);

2585 ià(
w™hscÜes
) {

2586 
	`addR•lyDoubË
(
c
,
scÜe
);

2590 ià(
»v”£
) {

2591 
	`zzlP»v
(
zl
,&
•Œ
,&
¥Œ
);

2593 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2596 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2597 
z£t
 *
zs
 = 
zobj
->
±r
;

2598 
zskli¡
 *
z¦
 = 
zs
->zsl;

2599 
zskli¡Node
 *
Ê
;

2602 ià(
»v”£
) {

2603 
Ê
 = 
	`z¦La¡InRªge
(
z¦
,&
¿nge
);

2605 
Ê
 = 
	`z¦Fœ¡InRªge
(
z¦
,&
¿nge
);

2609 ià(
Ê
 =ğ
NULL
) {

2610 
	`addR•ly
(
c
, 
sh¬ed
.
em±ymuÉibulk
);

2617 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2621 
Ê
 && 
off£t
--) {

2622 ià(
»v”£
) {

2623 
Ê
 =†n->
backw¬d
;

2625 
Ê
 =†n->
Ëv–
[0].
fÜw¬d
;

2629 
Ê
 && 
lim™
--) {

2631 ià(
»v”£
) {

2632 ià(!
	`z¦V®ueG‹Mš
(
Ê
->
scÜe
,&
¿nge
)) ;

2634 ià(!
	`z¦V®ueL‹Max
(
Ê
->
scÜe
,&
¿nge
)) ;

2637 
¿ng–’
++;

2638 
	`addR•lyBulkCBufãr
(
c
,
Ê
->
–e
,
	`sd¦’
(ln->ele));

2640 ià(
w™hscÜes
) {

2641 
	`addR•lyDoubË
(
c
,
Ê
->
scÜe
);

2645 ià(
»v”£
) {

2646 
Ê
 =†n->
backw¬d
;

2648 
Ê
 =†n->
Ëv–
[0].
fÜw¬d
;

2652 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2655 ià(
w™hscÜes
) {

2656 
¿ng–’
 *= 2;

2659 
	`£tDeã¼edMuÉiBulkL’gth
(
c
, 
»¶yËn
, 
¿ng–’
);

2660 
	}
}

2662 
	$z¿ngebyscÜeCommªd
(
ş›Á
 *
c
) {

2663 
	`g’”icZ¿ngebyscÜeCommªd
(
c
,0);

2664 
	}
}

2666 
	$z»v¿ngebyscÜeCommªd
(
ş›Á
 *
c
) {

2667 
	`g’”icZ¿ngebyscÜeCommªd
(
c
,1);

2668 
	}
}

2670 
	$zcouÁCommªd
(
ş›Á
 *
c
) {

2671 
robj
 *
key
 = 
c
->
¬gv
[1];

2672 
robj
 *
zobj
;

2673 
z¿nge¥ec
 
¿nge
;

2674 
couÁ
 = 0;

2677 ià(
	`z¦P¬£Rªge
(
c
->
¬gv
[2],c->¬gv[3],&
¿nge
è!ğ
C_OK
) {

2678 
	`addR•lyE¼Ü
(
c
,"min or max is‚ot‡ float");

2683 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, 
key
, 
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

2684 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
)) ;

2686 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2687 *
zl
 = 
zobj
->
±r
;

2688 *
•Œ
, *
¥Œ
;

2689 
scÜe
;

2692 
•Œ
 = 
	`zzlFœ¡InRªge
(
zl
,&
¿nge
);

2695 ià(
•Œ
 =ğ
NULL
) {

2696 
	`addR•ly
(
c
, 
sh¬ed
.
cz”o
);

2701 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

2702 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

2703 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
	`z¦V®ueL‹Max
(
scÜe
,&
¿nge
));

2706 
•Œ
) {

2707 
scÜe
 = 
	`zzlG‘ScÜe
(
¥Œ
);

2710 ià(!
	`z¦V®ueL‹Max
(
scÜe
,&
¿nge
)) {

2713 
couÁ
++;

2714 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2717 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2718 
z£t
 *
zs
 = 
zobj
->
±r
;

2719 
zskli¡
 *
z¦
 = 
zs
->zsl;

2720 
zskli¡Node
 *
zn
;

2721 
¿nk
;

2724 
zn
 = 
	`z¦Fœ¡InRªge
(
z¦
, &
¿nge
);

2727 ià(
zn
 !ğ
NULL
) {

2728 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

2729 
couÁ
 = (
z¦
->
Ëngth
 - (
¿nk
 - 1));

2732 
zn
 = 
	`z¦La¡InRªge
(
z¦
, &
¿nge
);

2735 ià(
zn
 !ğ
NULL
) {

2736 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

2737 
couÁ
 -ğ(
z¦
->
Ëngth
 - 
¿nk
);

2741 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2744 
	`addR•lyLÚgLÚg
(
c
, 
couÁ
);

2745 
	}
}

2747 
	$zËxcouÁCommªd
(
ş›Á
 *
c
) {

2748 
robj
 *
key
 = 
c
->
¬gv
[1];

2749 
robj
 *
zobj
;

2750 
zËx¿nge¥ec
 
¿nge
;

2751 
couÁ
 = 0;

2754 ià(
	`z¦P¬£LexRªge
(
c
->
¬gv
[2],c->¬gv[3],&
¿nge
è!ğ
C_OK
) {

2755 
	`addR•lyE¼Ü
(
c
,"min or max‚ot valid string„ange item");

2760 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
, 
key
, 
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

2761 
	`checkTy³
(
c
, 
zobj
, 
OBJ_ZSET
))

2763 
	`z¦F»eLexRªge
(&
¿nge
);

2767 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2768 *
zl
 = 
zobj
->
±r
;

2769 *
•Œ
, *
¥Œ
;

2772 
•Œ
 = 
	`zzlFœ¡InLexRªge
(
zl
,&
¿nge
);

2775 ià(
•Œ
 =ğ
NULL
) {

2776 
	`z¦F»eLexRªge
(&
¿nge
);

2777 
	`addR•ly
(
c
, 
sh¬ed
.
cz”o
);

2782 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

2783 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
	`zzlLexV®ueL‹Max
(
•Œ
,&
¿nge
));

2786 
•Œ
) {

2788 ià(!
	`zzlLexV®ueL‹Max
(
•Œ
,&
¿nge
)) {

2791 
couÁ
++;

2792 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2795 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2796 
z£t
 *
zs
 = 
zobj
->
±r
;

2797 
zskli¡
 *
z¦
 = 
zs
->zsl;

2798 
zskli¡Node
 *
zn
;

2799 
¿nk
;

2802 
zn
 = 
	`z¦Fœ¡InLexRªge
(
z¦
, &
¿nge
);

2805 ià(
zn
 !ğ
NULL
) {

2806 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

2807 
couÁ
 = (
z¦
->
Ëngth
 - (
¿nk
 - 1));

2810 
zn
 = 
	`z¦La¡InLexRªge
(
z¦
, &
¿nge
);

2813 ià(
zn
 !ğ
NULL
) {

2814 
¿nk
 = 
	`z¦G‘Rªk
(
z¦
, 
zn
->
scÜe
, zn->
–e
);

2815 
couÁ
 -ğ(
z¦
->
Ëngth
 - 
¿nk
);

2819 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2822 
	`z¦F»eLexRªge
(&
¿nge
);

2823 
	`addR•lyLÚgLÚg
(
c
, 
couÁ
);

2824 
	}
}

2827 
	$g’”icZ¿ngebyËxCommªd
(
ş›Á
 *
c
, 
»v”£
) {

2828 
zËx¿nge¥ec
 
¿nge
;

2829 
robj
 *
key
 = 
c
->
¬gv
[1];

2830 
robj
 *
zobj
;

2831 
off£t
 = 0, 
lim™
 = -1;

2832 
¿ng–’
 = 0;

2833 *
»¶yËn
 = 
NULL
;

2834 
mšidx
, 
maxidx
;

2837 ià(
»v”£
) {

2839 
maxidx
 = 2; 
mšidx
 = 3;

2842 
mšidx
 = 2; 
maxidx
 = 3;

2845 ià(
	`z¦P¬£LexRªge
(
c
->
¬gv
[
mšidx
],c->¬gv[
maxidx
],&
¿nge
è!ğ
C_OK
) {

2846 
	`addR•lyE¼Ü
(
c
,"min or max‚ot valid string„ange item");

2852 ià(
c
->
¬gc
 > 4) {

2853 
»maššg
 = 
c
->
¬gc
 - 4;

2854 
pos
 = 4;

2856 
»maššg
) {

2857 ià(
»maššg
 >ğ3 && !
	`¡rÿ£cmp
(
c
->
¬gv
[
pos
]->
±r
,"limit")) {

2858 ià((
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
pos
+1], &
off£t
, 
NULL
è!ğ
C_OK
) ||

2859 (
	`g‘LÚgFromObjeùOrR•ly
(
c
, c->
¬gv
[
pos
+2], &
lim™
, 
NULL
è!ğ
C_OK
)) ;

2860 
pos
 +ğ3; 
»maššg
 -= 3;

2862 
	`z¦F»eLexRªge
(&
¿nge
);

2863 
	`addR•ly
(
c
,
sh¬ed
.
syÁax”r
);

2870 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
em±ymuÉibulk
)è=ğ
NULL
 ||

2871 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
))

2873 
	`z¦F»eLexRªge
(&
¿nge
);

2877 ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_ZIPLIST
) {

2878 *
zl
 = 
zobj
->
±r
;

2879 *
•Œ
, *
¥Œ
;

2880 *
v¡r
;

2881 
vËn
;

2882 
vlÚg
;

2885 ià(
»v”£
) {

2886 
•Œ
 = 
	`zzlLa¡InLexRªge
(
zl
,&
¿nge
);

2888 
•Œ
 = 
	`zzlFœ¡InLexRªge
(
zl
,&
¿nge
);

2892 ià(
•Œ
 =ğ
NULL
) {

2893 
	`addR•ly
(
c
, 
sh¬ed
.
em±ymuÉibulk
);

2894 
	`z¦F»eLexRªge
(&
¿nge
);

2899 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
•Œ
 !ğ
NULL
);

2900 
¥Œ
 = 
	`zli¡Next
(
zl
,
•Œ
);

2905 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2909 
•Œ
 && 
off£t
--) {

2910 ià(
»v”£
) {

2911 
	`zzlP»v
(
zl
,&
•Œ
,&
¥Œ
);

2913 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2917 
•Œ
 && 
lim™
--) {

2919 ià(
»v”£
) {

2920 ià(!
	`zzlLexV®ueG‹Mš
(
•Œ
,&
¿nge
)) ;

2922 ià(!
	`zzlLexV®ueL‹Max
(
•Œ
,&
¿nge
)) ;

2927 
	`£rv”As£¹W™hInfo
(
c
,
zobj
,
	`zli¡G‘
(
•Œ
,&
v¡r
,&
vËn
,&
vlÚg
));

2929 
¿ng–’
++;

2930 ià(
v¡r
 =ğ
NULL
) {

2931 
	`addR•lyBulkLÚgLÚg
(
c
,
vlÚg
);

2933 
	`addR•lyBulkCBufãr
(
c
,
v¡r
,
vËn
);

2937 ià(
»v”£
) {

2938 
	`zzlP»v
(
zl
,&
•Œ
,&
¥Œ
);

2940 
	`zzlNext
(
zl
,&
•Œ
,&
¥Œ
);

2943 } ià(
zobj
->
’codšg
 =ğ
OBJ_ENCODING_SKIPLIST
) {

2944 
z£t
 *
zs
 = 
zobj
->
±r
;

2945 
zskli¡
 *
z¦
 = 
zs
->zsl;

2946 
zskli¡Node
 *
Ê
;

2949 ià(
»v”£
) {

2950 
Ê
 = 
	`z¦La¡InLexRªge
(
z¦
,&
¿nge
);

2952 
Ê
 = 
	`z¦Fœ¡InLexRªge
(
z¦
,&
¿nge
);

2956 ià(
Ê
 =ğ
NULL
) {

2957 
	`addR•ly
(
c
, 
sh¬ed
.
em±ymuÉibulk
);

2958 
	`z¦F»eLexRªge
(&
¿nge
);

2965 
»¶yËn
 = 
	`addDeã¼edMuÉiBulkL’gth
(
c
);

2969 
Ê
 && 
off£t
--) {

2970 ià(
»v”£
) {

2971 
Ê
 =†n->
backw¬d
;

2973 
Ê
 =†n->
Ëv–
[0].
fÜw¬d
;

2977 
Ê
 && 
lim™
--) {

2979 ià(
»v”£
) {

2980 ià(!
	`z¦LexV®ueG‹Mš
(
Ê
->
–e
,&
¿nge
)) ;

2982 ià(!
	`z¦LexV®ueL‹Max
(
Ê
->
–e
,&
¿nge
)) ;

2985 
¿ng–’
++;

2986 
	`addR•lyBulkCBufãr
(
c
,
Ê
->
–e
,
	`sd¦’
(ln->ele));

2989 ià(
»v”£
) {

2990 
Ê
 =†n->
backw¬d
;

2992 
Ê
 =†n->
Ëv–
[0].
fÜw¬d
;

2996 
	`£rv”Pªic
("Unknown sorted setƒncoding");

2999 
	`z¦F»eLexRªge
(&
¿nge
);

3000 
	`£tDeã¼edMuÉiBulkL’gth
(
c
, 
»¶yËn
, 
¿ng–’
);

3001 
	}
}

3003 
	$z¿ngebyËxCommªd
(
ş›Á
 *
c
) {

3004 
	`g’”icZ¿ngebyËxCommªd
(
c
,0);

3005 
	}
}

3007 
	$z»v¿ngebyËxCommªd
(
ş›Á
 *
c
) {

3008 
	`g’”icZ¿ngebyËxCommªd
(
c
,1);

3009 
	}
}

3011 
	$zÿrdCommªd
(
ş›Á
 *
c
) {

3012 
robj
 *
key
 = 
c
->
¬gv
[1];

3013 
robj
 *
zobj
;

3015 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
cz”o
)è=ğ
NULL
 ||

3016 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

3018 
	`addR•lyLÚgLÚg
(
c
,
	`z£tL’gth
(
zobj
));

3019 
	}
}

3021 
	$zscÜeCommªd
(
ş›Á
 *
c
) {

3022 
robj
 *
key
 = 
c
->
¬gv
[1];

3023 
robj
 *
zobj
;

3024 
scÜe
;

3026 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

3027 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

3029 ià(
	`z£tScÜe
(
zobj
,
c
->
¬gv
[2]->
±r
,&
scÜe
è=ğ
C_ERR
) {

3030 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

3032 
	`addR•lyDoubË
(
c
,
scÜe
);

3034 
	}
}

3036 
	$z¿nkG’”icCommªd
(
ş›Á
 *
c
, 
»v”£
) {

3037 
robj
 *
key
 = 
c
->
¬gv
[1];

3038 
robj
 *
–e
 = 
c
->
¬gv
[2];

3039 
robj
 *
zobj
;

3040 
¿nk
;

3042 ià((
zobj
 = 
	`lookupKeyR—dOrR•ly
(
c
,
key
,
sh¬ed
.
nuÎbulk
)è=ğ
NULL
 ||

3043 
	`checkTy³
(
c
,
zobj
,
OBJ_ZSET
)) ;

3045 
	`£rv”As£¹W™hInfo
(
c
,
–e
,
	`sdsEncodedObjeù
(ele));

3046 
¿nk
 = 
	`z£tRªk
(
zobj
,
–e
->
±r
,
»v”£
);

3047 ià(
¿nk
 >= 0) {

3048 
	`addR•lyLÚgLÚg
(
c
,
¿nk
);

3050 
	`addR•ly
(
c
,
sh¬ed
.
nuÎbulk
);

3052 
	}
}

3054 
	$z¿nkCommªd
(
ş›Á
 *
c
) {

3055 
	`z¿nkG’”icCommªd
(
c
, 0);

3056 
	}
}

3058 
	$z»v¿nkCommªd
(
ş›Á
 *
c
) {

3059 
	`z¿nkG’”icCommªd
(
c
, 1);

3060 
	}
}

3062 
	$zsÿnCommªd
(
ş›Á
 *
c
) {

3063 
robj
 *
o
;

3064 
cursÜ
;

3066 ià(
	`·r£SÿnCursÜOrR•ly
(
c
,c->
¬gv
[2],&
cursÜ
è=ğ
C_ERR
) ;

3067 ià((
o
 = 
	`lookupKeyR—dOrR•ly
(
c
,c->
¬gv
[1],
sh¬ed
.
em±ysÿn
)è=ğ
NULL
 ||

3068 
	`checkTy³
(
c
,
o
,
OBJ_ZSET
)) ;

3069 
	`sÿnG’”icCommªd
(
c
,
o
,
cursÜ
);

3070 
	}
}

	@testhelp.h

39 #iâdeà
__TESTHELP_H


40 
	#__TESTHELP_H


	)

42 
	g__çed_‹¡s
 = 0;

43 
	g__‹¡_num
 = 0;

44 
	#‹¡_cÚd
(
desü
,
_c
) do { \

45 
__‹¡_num
++; 
	`´štf
("%d - %s: ", __‹¡_num, 
desü
); \

46 if(
_c
è
	`´štf
("PASSED\n"); {´štf("FAILED\n"); 
__çed_‹¡s
++;} \

47 } 0);

	)

48 
	#‹¡_»pÜt
() do { \

49 
	`´štf
("%de¡s, %d…as£d, %d faed\n", 
__‹¡_num
, \

50 
__‹¡_num
-
__çed_‹¡s
, __failed_tests); \

51 ià(
__çed_‹¡s
) { \

52 
	`´štf
("=== WARNING === We have failedests here...\n"); \

53 
	`ex™
(1); \

55 } 0);

	)

	@util.c

30 
	~"fmaüos.h
"

31 
	~<¡dlib.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

34 
	~<ùy³.h
>

35 
	~<lim™s.h
>

36 
	~<m©h.h
>

37 
	~<uni¡d.h
>

38 
	~<sys/time.h
>

39 
	~<æßt.h
>

40 
	~<¡dšt.h
>

41 
	~<”ºo.h
>

43 
	~"ut.h
"

44 
	~"sha1.h
"

47 
	$¡ršgm©chËn
(cÚ¡ *
·‰”n
, 
·‰”nL’
,

48 cÚ¡ *
¡ršg
, 
¡ršgL’
, 
noÿ£
)

50 
·‰”nL’
) {

51 
·‰”n
[0]) {

53 
·‰”n
[1] == '*') {

54 
·‰”n
++;

55 
·‰”nL’
--;

57 ià(
·‰”nL’
 == 1)

59 
¡ršgL’
) {

60 ià(
	`¡ršgm©chËn
(
·‰”n
+1, 
·‰”nL’
-1,

61 
¡ršg
, 
¡ršgL’
, 
noÿ£
))

63 
¡ršg
++;

64 
¡ršgL’
--;

69 ià(
¡ršgL’
 == 0)

71 
¡ršg
++;

72 
¡ršgL’
--;

76 
nÙ
, 
m©ch
;

78 
·‰”n
++;

79 
·‰”nL’
--;

80 
nÙ
 = 
·‰”n
[0] == '^';

81 ià(
nÙ
) {

82 
·‰”n
++;

83 
·‰”nL’
--;

85 
m©ch
 = 0;

87 ià(
·‰”n
[0] == '\\') {

88 
·‰”n
++;

89 
·‰”nL’
--;

90 ià(
·‰”n
[0] =ğ
¡ršg
[0])

91 
m©ch
 = 1;

92 } ià(
·‰”n
[0] == ']') {

94 } ià(
·‰”nL’
 == 0) {

95 
·‰”n
--;

96 
·‰”nL’
++;

98 } ià(
·‰”n
[1] =ğ'-' && 
·‰”nL’
 >= 3) {

99 
¡¬t
 = 
·‰”n
[0];

100 
’d
 = 
·‰”n
[2];

101 
c
 = 
¡ršg
[0];

102 ià(
¡¬t
 > 
’d
) {

103 
t
 = 
¡¬t
;

104 
¡¬t
 = 
’d
;

105 
’d
 = 
t
;

107 ià(
noÿ£
) {

108 
¡¬t
 = 
	`tŞow”
(start);

109 
’d
 = 
	`tŞow”
(end);

110 
c
 = 
	`tŞow”
(c);

112 
·‰”n
 += 2;

113 
·‰”nL’
 -= 2;

114 ià(
c
 >ğ
¡¬t
 && c <ğ
’d
)

115 
m©ch
 = 1;

117 ià(!
noÿ£
) {

118 ià(
·‰”n
[0] =ğ
¡ršg
[0])

119 
m©ch
 = 1;

121 ià(
	`tŞow”
(()
·‰”n
[0]è=ğtŞow”(()
¡ršg
[0]))

122 
m©ch
 = 1;

125 
·‰”n
++;

126 
·‰”nL’
--;

128 ià(
nÙ
)

129 
m©ch
 = !match;

130 ià(!
m©ch
)

132 
¡ršg
++;

133 
¡ršgL’
--;

137 ià(
·‰”nL’
 >= 2) {

138 
·‰”n
++;

139 
·‰”nL’
--;

143 ià(!
noÿ£
) {

144 ià(
·‰”n
[0] !ğ
¡ršg
[0])

147 ià(
	`tŞow”
(()
·‰”n
[0]è!ğtŞow”(()
¡ršg
[0]))

150 
¡ršg
++;

151 
¡ršgL’
--;

154 
·‰”n
++;

155 
·‰”nL’
--;

156 ià(
¡ršgL’
 == 0) {

157 *
·‰”n
 == '*') {

158 
·‰”n
++;

159 
·‰”nL’
--;

164 ià(
·‰”nL’
 =ğ0 && 
¡ršgL’
 == 0)

167 
	}
}

169 
	$¡ršgm©ch
(cÚ¡ *
·‰”n
, cÚ¡ *
¡ršg
, 
noÿ£
) {

170  
	`¡ršgm©chËn
(
·‰”n
,
	`¡¾’
Õ©‹º),
¡ršg
,¡¾’(¡ršg),
noÿ£
);

171 
	}
}

180 
	$memtŞl
(cÚ¡ *
p
, *
”r
) {

181 cÚ¡ *
u
;

182 
buf
[128];

183 
mul
;

184 
v®
;

185 
dig™s
;

187 ià(
”r
) *err = 0;

190 
u
 = 
p
;

191 ià(*
u
 == '-') u++;

192 *
u
 && 
	`isdig™
(*u)) u++;

193 ià(*
u
 =ğ'\0' || !
	`¡rÿ£cmp
(u,"b")) {

194 
mul
 = 1;

195 } ià(!
	`¡rÿ£cmp
(
u
,"k")) {

196 
mul
 = 1000;

197 } ià(!
	`¡rÿ£cmp
(
u
,"kb")) {

198 
mul
 = 1024;

199 } ià(!
	`¡rÿ£cmp
(
u
,"m")) {

200 
mul
 = 1000*1000;

201 } ià(!
	`¡rÿ£cmp
(
u
,"mb")) {

202 
mul
 = 1024*1024;

203 } ià(!
	`¡rÿ£cmp
(
u
,"g")) {

204 
mul
 = 1000L*1000*1000;

205 } ià(!
	`¡rÿ£cmp
(
u
,"gb")) {

206 
mul
 = 1024L*1024*1024;

208 ià(
”r
) *err = 1;

214 
dig™s
 = 
u
-
p
;

215 ià(
dig™s
 >ğ(
buf
)) {

216 ià(
”r
) *err = 1;

219 
	`memıy
(
buf
,
p
,
dig™s
);

220 
buf
[
dig™s
] = '\0';

222 *
’d±r
;

223 
”ºo
 = 0;

224 
v®
 = 
	`¡¹Şl
(
buf
,&
’d±r
,10);

225 ià((
v®
 =ğ0 && 
”ºo
 =ğ
EINVAL
è|| *
’d±r
 != '\0') {

226 ià(
”r
) *err = 1;

229  
v®
*
mul
;

230 
	}
}

234 
ušt32_t
 
	$dig™s10
(
ušt64_t
 
v
) {

235 ià(
v
 < 10)  1;

236 ià(
v
 < 100)  2;

237 ià(
v
 < 1000)  3;

238 ià(
v
 < 1000000000000UL) {

239 ià(
v
 < 100000000UL) {

240 ià(
v
 < 1000000) {

241 ià(
v
 < 10000)  4;

242  5 + (
v
 >= 100000);

244  7 + (
v
 >= 10000000UL);

246 ià(
v
 < 10000000000UL) {

247  9 + (
v
 >= 1000000000UL);

249  11 + (
v
 >= 100000000000UL);

251  12 + 
	`dig™s10
(
v
 / 1000000000000UL);

252 
	}
}

255 
ušt32_t
 
	$sdig™s10
(
št64_t
 
v
) {

256 ià(
v
 < 0) {

258 
ušt64_t
 
uv
 = (
v
 !ğ
LLONG_MIN
) ?

259 (
ušt64_t
)-
v
 : ((ušt64_tè
LLONG_MAX
)+1;

260  
	`dig™s10
(
uv
)+1;

262  
	`dig™s10
(
v
);

264 
	}
}

277 
	$Î2¡ršg
(*
d¡
, 
size_t
 
d¡Ën
, 
sv®ue
) {

278 cÚ¡ 
dig™s
[201] =

284 
Ãg©ive
;

285 
v®ue
;

289 ià(
sv®ue
 < 0) {

290 ià(
sv®ue
 !ğ
LLONG_MIN
) {

291 
v®ue
 = -
sv®ue
;

293 
v®ue
 = ((è
LLONG_MAX
)+1;

295 
Ãg©ive
 = 1;

297 
v®ue
 = 
sv®ue
;

298 
Ãg©ive
 = 0;

302 
ušt32_t
 cÚ¡ 
Ëngth
 = 
	`dig™s10
(
v®ue
)+
Ãg©ive
;

303 ià(
Ëngth
 >ğ
d¡Ën
)  0;

306 
ušt32_t
 
Ãxt
 = 
Ëngth
;

307 
d¡
[
Ãxt
] = '\0';

308 
Ãxt
--;

309 
v®ue
 >= 100) {

310 cÚ¡ 
i
 = (
v®ue
 % 100) * 2;

311 
v®ue
 /= 100;

312 
d¡
[
Ãxt
] = 
dig™s
[
i
 + 1];

313 
d¡
[
Ãxt
 - 1] = 
dig™s
[
i
];

314 
Ãxt
 -= 2;

318 ià(
v®ue
 < 10) {

319 
d¡
[
Ãxt
] = '0' + (
ušt32_t
è
v®ue
;

321 
i
 = (
ušt32_t
è
v®ue
 * 2;

322 
d¡
[
Ãxt
] = 
dig™s
[
i
 + 1];

323 
d¡
[
Ãxt
 - 1] = 
dig™s
[
i
];

327 ià(
Ãg©ive
è
d¡
[0] = '-';

328  
Ëngth
;

329 
	}
}

343 
	$¡ršg2Î
(cÚ¡ *
s
, 
size_t
 
¦’
, *
v®ue
) {

344 cÚ¡ *
p
 = 
s
;

345 
size_t
 
¶’
 = 0;

346 
Ãg©ive
 = 0;

347 
v
;

349 ià(
¶’
 =ğ
¦’
)

353 ià(
¦’
 =ğ1 && 
p
[0] == '0') {

354 ià(
v®ue
 !ğ
NULL
) *value = 0;

358 ià(
p
[0] == '-') {

359 
Ãg©ive
 = 1;

360 
p
++; 
¶’
++;

363 ià(
¶’
 =ğ
¦’
)

368 ià(
p
[0] >= '1' &&…[0] <= '9') {

369 
v
 = 
p
[0]-'0';

370 
p
++; 
¶’
++;

371 } ià(
p
[0] =ğ'0' && 
¦’
 == 1) {

372 *
v®ue
 = 0;

378 
¶’
 < 
¦’
 && 
p
[0] >= '0' &&…[0] <= '9') {

379 ià(
v
 > (
ULLONG_MAX
 / 10))

381 
v
 *= 10;

383 ià(
v
 > (
ULLONG_MAX
 - (
p
[0]-'0')))

385 
v
 +ğ
p
[0]-'0';

387 
p
++; 
¶’
++;

391 ià(
¶’
 < 
¦’
)

394 ià(
Ãg©ive
) {

395 ià(
v
 > (()(-(
LLONG_MIN
+1))+1))

397 ià(
v®ue
 !ğ
NULL
è*v®uğ-
v
;

399 ià(
v
 > 
LLONG_MAX
)

401 ià(
v®ue
 !ğ
NULL
è*v®uğ
v
;

404 
	}
}

409 
	$¡ršg2l
(cÚ¡ *
s
, 
size_t
 
¦’
, *
lv®
) {

410 
Îv®
;

412 ià(!
	`¡ršg2Î
(
s
,
¦’
,&
Îv®
))

415 ià(
Îv®
 < 
LONG_MIN
 ||†lv® > 
LONG_MAX
)

418 *
lv®
 = ()
Îv®
;

420 
	}
}

429 
	$¡ršg2ld
(cÚ¡ *
s
, 
size_t
 
¦’
, *
dp
) {

430 
buf
[256];

431 
v®ue
;

432 *
•Œ
;

434 ià(
¦’
 >ğ(
buf
))  0;

435 
	`memıy
(
buf
,
s
,
¦’
);

436 
buf
[
¦’
] = '\0';

438 
”ºo
 = 0;

439 
v®ue
 = 
	`¡¹Şd
(
buf
, &
•Œ
);

440 ià(
	`is¥aû
(
buf
[0]è|| 
•Œ
[0] != '\0' ||

441 (
”ºo
 =ğ
ERANGE
 &&

442 (
v®ue
 =ğ
HUGE_VAL
 || value == -HUGE_VAL || value == 0)) ||

443 
”ºo
 =ğ
EINVAL
 ||

444 
	`i¢ª
(
v®ue
))

447 ià(
dp
è*d°ğ
v®ue
;

449 
	}
}

456 
	$d2¡ršg
(*
buf
, 
size_t
 
Ën
, 
v®ue
) {

457 ià(
	`i¢ª
(
v®ue
)) {

458 
Ën
 = 
	`¢´štf
(
buf
,len,"nan");

459 } ià(
	`isšf
(
v®ue
)) {

460 ià(
v®ue
 < 0)

461 
Ën
 = 
	`¢´štf
(
buf
,len,"-inf");

463 
Ën
 = 
	`¢´štf
(
buf
,len,"inf");

464 } ià(
v®ue
 == 0) {

466 ià(1.0/
v®ue
 < 0)

467 
Ën
 = 
	`¢´štf
(
buf
,len,"-0");

469 
Ën
 = 
	`¢´štf
(
buf
,len,"0");

471 #ià(
DBL_MANT_DIG
 >ğ52è&& (
LLONG_MAX
 == 0x7fffffffffffffffLL)

481 
mš
 = -4503599627370495;

482 
max
 = 4503599627370496;

483 ià(
v®ue
 > 
mš
 && v®u< 
max
 && value == (()(()value)))

484 
Ën
 = 
	`Î2¡ršg
(
buf
,Ën,()
v®ue
);

487 
Ën
 = 
	`¢´štf
(
buf
,Ën,"%.17g",
v®ue
);

490  
Ën
;

491 
	}
}

500 
	$ld2¡ršg
(*
buf
, 
size_t
 
Ën
, 
v®ue
, 
humªä›ndly
) {

501 
size_t
 
l
;

503 ià(
	`isšf
(
v®ue
)) {

506 ià(
Ën
 < 5)  0;

507 ià(
v®ue
 > 0) {

508 
	`memıy
(
buf
,"inf",3);

509 
l
 = 3;

511 
	`memıy
(
buf
,"-inf",4);

512 
l
 = 4;

514 } ià(
humªä›ndly
) {

520 
l
 = 
	`¢´štf
(
buf
,
Ën
,"%.17Lf", 
v®ue
);

521 ià(
l
+1 > 
Ën
)  0;

523 ià(
	`¡rchr
(
buf
,'.'è!ğ
NULL
) {

524 *
p
 = 
buf
+
l
-1;

525 *
p
 == '0') {

526 
p
--;

527 
l
--;

529 ià(*
p
 =ğ'.'è
l
--;

532 
l
 = 
	`¢´štf
(
buf
,
Ën
,"%.17Lg", 
v®ue
);

533 ià(
l
+1 > 
Ën
)  0;

535 
buf
[
l
] = '\0';

536  
l
;

537 
	}
}

543 
	$g‘RªdomHexCh¬s
(*
p
, 
Ën
) {

544 *
ch¬£t
 = "0123456789abcdef";

545 
j
;

548 
£ed_š™Ÿlized
 = 0;

549 
£ed
[20];

550 
ušt64_t
 
couÁ”
 = 0;

552 ià(!
£ed_š™Ÿlized
) {

557 
FILE
 *
å
 = 
	`fİ’
("/dev/urandom","r");

558 ià(
å
 && 
	`ä—d
(
£ed
,(seed),1,fp) == 1)

559 
£ed_š™Ÿlized
 = 1;

560 ià(
å
è
	`fşo£
(fp);

563 ià(
£ed_š™Ÿlized
) {

564 
Ën
) {

565 
dige¡
[20];

566 
SHA1_CTX
 
ùx
;

567 
cİyËn
 = 
Ën
 > 20 ? 20 :†en;

569 
	`SHA1In™
(&
ùx
);

570 
	`SHA1Upd©e
(&
ùx
, 
£ed
, (seed));

571 
	`SHA1Upd©e
(&
ùx
, (*)&
couÁ”
,(counter));

572 
	`SHA1Fš®
(
dige¡
, &
ùx
);

573 
couÁ”
++;

575 
	`memıy
(
p
,
dige¡
,
cİyËn
);

577 
j
 = 0; j < 
cİyËn
; j++è
p
[j] = 
ch¬£t
[p[j] & 0x0F];

578 
Ën
 -ğ
cİyËn
;

579 
p
 +ğ
cİyËn
;

585 *
x
 = 
p
;

586 
l
 = 
Ën
;

587 
timev®
 
tv
;

588 
pid_t
 
pid
 = 
	`g‘pid
();

591 
	`g‘timeofday
(&
tv
,
NULL
);

592 ià(
l
 >ğ(
tv
.
tv_u£c
)) {

593 
	`memıy
(
x
,&
tv
.
tv_u£c
,(tv.tv_usec));

594 
l
 -ğ(
tv
.
tv_u£c
);

595 
x
 +ğ(
tv
.
tv_u£c
);

597 ià(
l
 >ğ(
tv
.
tv_£c
)) {

598 
	`memıy
(
x
,&
tv
.
tv_£c
,(tv.tv_sec));

599 
l
 -ğ(
tv
.
tv_£c
);

600 
x
 +ğ(
tv
.
tv_£c
);

602 ià(
l
 >ğ(
pid
)) {

603 
	`memıy
(
x
,&
pid
,(pid));

604 
l
 -ğ(
pid
);

605 
x
 +ğ(
pid
);

609 
j
 = 0; j < 
Ën
; j++) {

610 
p
[
j
] ^ğ
	`¿nd
();

611 
p
[
j
] = 
ch¬£t
[p[j] & 0x0F];

614 
	}
}

623 
sds
 
	$g‘AbsŞu‹P©h
(*
f’ame
) {

624 
cwd
[1024];

625 
sds
 
ab¥©h
;

626 
sds
 
»Í©h
 = 
	`sd¢ew
(
f’ame
);

628 
»Í©h
 = 
	`sd¡rim
(relpath," \r\n\t");

629 ià(
»Í©h
[0] == '/') „elpath;

632 ià(
	`g‘cwd
(
cwd
,(cwd)è=ğ
NULL
) {

633 
	`sdsä“
(
»Í©h
);

634  
NULL
;

636 
ab¥©h
 = 
	`sd¢ew
(
cwd
);

637 ià(
	`sd¦’
(
ab¥©h
) &&‡bspath[sdslen(abspath)-1] != '/')

638 
ab¥©h
 = 
	`sdsÿt
(abspath,"/");

646 
	`sd¦’
(
»Í©h
) >= 3 &&

647 
»Í©h
[0] == '.' &&„elpath[1] == '.' &&„elpath[2] == '/')

649 
	`sd¤ªge
(
»Í©h
,3,-1);

650 ià(
	`sd¦’
(
ab¥©h
) > 1) {

651 *
p
 = 
ab¥©h
 + 
	`sd¦’
(abspath)-2;

652 
ŒimËn
 = 1;

654 *
p
 != '/') {

655 
p
--;

656 
ŒimËn
++;

658 
	`sd¤ªge
(
ab¥©h
,0,-(
ŒimËn
+1));

663 
ab¥©h
 = 
	`sdsÿtsds
×b¥©h,
»Í©h
);

664 
	`sdsä“
(
»Í©h
);

665  
ab¥©h
;

666 
	}
}

672 
	$·thIsBa£Name
(*
·th
) {

673  
	`¡rchr
(
·th
,'/'è=ğ
NULL
 && strchr(path,'\\') == NULL;

674 
	}
}

676 #ifdeà
REDIS_TEST


677 
	~<as£¹.h
>

679 
	$‹¡_¡ršg2Î
() {

680 
buf
[32];

681 
v
;

684 
	`¡rıy
(
buf
,"+1");

685 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

688 
	`¡rıy
(
buf
," 1");

689 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

692 
	`¡rıy
(
buf
,"1 ");

693 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

696 
	`¡rıy
(
buf
,"01");

697 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

699 
	`¡rıy
(
buf
,"-1");

700 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

701 
	`as£¹
(
v
 == -1);

703 
	`¡rıy
(
buf
,"0");

704 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

705 
	`as£¹
(
v
 == 0);

707 
	`¡rıy
(
buf
,"1");

708 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

709 
	`as£¹
(
v
 == 1);

711 
	`¡rıy
(
buf
,"99");

712 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

713 
	`as£¹
(
v
 == 99);

715 
	`¡rıy
(
buf
,"-99");

716 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

717 
	`as£¹
(
v
 == -99);

719 
	`¡rıy
(
buf
,"-9223372036854775808");

720 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

721 
	`as£¹
(
v
 =ğ
LLONG_MIN
);

723 
	`¡rıy
(
buf
,"-9223372036854775809");

724 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

726 
	`¡rıy
(
buf
,"9223372036854775807");

727 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

728 
	`as£¹
(
v
 =ğ
LLONG_MAX
);

730 
	`¡rıy
(
buf
,"9223372036854775808");

731 
	`as£¹
(
	`¡ršg2Î
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

732 
	}
}

734 
	$‹¡_¡ršg2l
() {

735 
buf
[32];

736 
v
;

739 
	`¡rıy
(
buf
,"+1");

740 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

743 
	`¡rıy
(
buf
,"01");

744 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

746 
	`¡rıy
(
buf
,"-1");

747 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

748 
	`as£¹
(
v
 == -1);

750 
	`¡rıy
(
buf
,"0");

751 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

752 
	`as£¹
(
v
 == 0);

754 
	`¡rıy
(
buf
,"1");

755 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

756 
	`as£¹
(
v
 == 1);

758 
	`¡rıy
(
buf
,"99");

759 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

760 
	`as£¹
(
v
 == 99);

762 
	`¡rıy
(
buf
,"-99");

763 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

764 
	`as£¹
(
v
 == -99);

766 #ià
LONG_MAX
 !ğ
LLONG_MAX


767 
	`¡rıy
(
buf
,"-2147483648");

768 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

769 
	`as£¹
(
v
 =ğ
LONG_MIN
);

771 
	`¡rıy
(
buf
,"-2147483649");

772 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

774 
	`¡rıy
(
buf
,"2147483647");

775 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 1);

776 
	`as£¹
(
v
 =ğ
LONG_MAX
);

778 
	`¡rıy
(
buf
,"2147483648");

779 
	`as£¹
(
	`¡ršg2l
(
buf
,
	`¡¾’
(buf),&
v
) == 0);

781 
	}
}

783 
	$‹¡_Î2¡ršg
() {

784 
buf
[32];

785 
v
;

786 
sz
;

788 
v
 = 0;

789 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

790 
	`as£¹
(
sz
 == 1);

791 
	`as£¹
(!
	`¡rcmp
(
buf
, "0"));

793 
v
 = -1;

794 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

795 
	`as£¹
(
sz
 == 2);

796 
	`as£¹
(!
	`¡rcmp
(
buf
, "-1"));

798 
v
 = 99;

799 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

800 
	`as£¹
(
sz
 == 2);

801 
	`as£¹
(!
	`¡rcmp
(
buf
, "99"));

803 
v
 = -99;

804 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

805 
	`as£¹
(
sz
 == 3);

806 
	`as£¹
(!
	`¡rcmp
(
buf
, "-99"));

808 
v
 = -2147483648;

809 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

810 
	`as£¹
(
sz
 == 11);

811 
	`as£¹
(!
	`¡rcmp
(
buf
, "-2147483648"));

813 
v
 = 
LLONG_MIN
;

814 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

815 
	`as£¹
(
sz
 == 20);

816 
	`as£¹
(!
	`¡rcmp
(
buf
, "-9223372036854775808"));

818 
v
 = 
LLONG_MAX
;

819 
sz
 = 
	`Î2¡ršg
(
buf
,  buf, 
v
);

820 
	`as£¹
(
sz
 == 19);

821 
	`as£¹
(!
	`¡rcmp
(
buf
, "9223372036854775807"));

822 
	}
}

824 
	#UNUSED
(
x
è()(x)

	)

825 
	$utTe¡
(
¬gc
, **
¬gv
) {

826 
	`UNUSED
(
¬gc
);

827 
	`UNUSED
(
¬gv
);

829 
	`‹¡_¡ršg2Î
();

830 
	`‹¡_¡ršg2l
();

831 
	`‹¡_Î2¡ršg
();

833 
	}
}

	@util.h

30 #iâdeà
__REDIS_UTIL_H


31 
	#__REDIS_UTIL_H


	)

33 
	~<¡dšt.h
>

34 
	~"sds.h
"

36 
¡ršgm©chËn
(cÚ¡ *
p
, 
¶’
, cÚ¡ *
s
, 
¦’
, 
noÿ£
);

37 
¡ršgm©ch
(cÚ¡ *
p
, cÚ¡ *
s
, 
noÿ£
);

38 
memtŞl
(cÚ¡ *
p
, *
”r
);

39 
ušt32_t
 
dig™s10
(
ušt64_t
 
v
);

40 
ušt32_t
 
sdig™s10
(
št64_t
 
v
);

41 
Î2¡ršg
(*
s
, 
size_t
 
Ën
, 
v®ue
);

42 
¡ršg2Î
(cÚ¡ *
s
, 
size_t
 
¦’
, *
v®ue
);

43 
¡ršg2l
(cÚ¡ *
s
, 
size_t
 
¦’
, *
v®ue
);

44 
¡ršg2ld
(cÚ¡ *
s
, 
size_t
 
¦’
, *
dp
);

45 
d2¡ršg
(*
buf
, 
size_t
 
Ën
, 
v®ue
);

46 
ld2¡ršg
(*
buf
, 
size_t
 
Ën
, 
v®ue
, 
humªä›ndly
);

47 
sds
 
g‘AbsŞu‹P©h
(*
f’ame
);

48 
·thIsBa£Name
(*
·th
);

50 #ifdeà
REDIS_TEST


51 
utTe¡
(
¬gc
, **
¬gv
);

	@version.h

1 
	#REDIS_VERSION
 "999.999.999"

	)

	@ziplist.c

104 
	~<¡dio.h
>

105 
	~<¡dlib.h
>

106 
	~<¡ršg.h
>

107 
	~<¡dšt.h
>

108 
	~<lim™s.h
>

109 
	~"zm®loc.h
"

110 
	~"ut.h
"

111 
	~"zli¡.h
"

112 
	~"’dŸncÚv.h
"

113 
	~"»di§s£¹.h
"

115 
	#ZIP_END
 255

	)

116 
	#ZIP_BIGLEN
 254

	)

119 
	#ZIP_STR_MASK
 0xc0

	)

120 
	#ZIP_INT_MASK
 0x30

	)

121 
	#ZIP_STR_06B
 (0 << 6)

	)

122 
	#ZIP_STR_14B
 (1 << 6)

	)

123 
	#ZIP_STR_32B
 (2 << 6)

	)

124 
	#ZIP_INT_16B
 (0xc0 | 0<<4)

	)

125 
	#ZIP_INT_32B
 (0xc0 | 1<<4)

	)

126 
	#ZIP_INT_64B
 (0xc0 | 2<<4)

	)

127 
	#ZIP_INT_24B
 (0xc0 | 3<<4)

	)

128 
	#ZIP_INT_8B
 0xã

	)

130 
	#ZIP_INT_IMM_MASK
 0x0f

	)

131 
	#ZIP_INT_IMM_MIN
 0xf1

	)

132 
	#ZIP_INT_IMM_MAX
 0xfd

	)

133 
	#ZIP_INT_IMM_VAL
(
v
è(v & 
ZIP_INT_IMM_MASK
)

	)

135 
	#INT24_MAX
 0x7fffff

	)

136 
	#INT24_MIN
 (-
INT24_MAX
 - 1)

	)

139 
	#ZIP_IS_STR
(
’c
è((Óncè& 
ZIP_STR_MASK
è< ZIP_STR_MASK)

	)

142 
	#ZIPLIST_BYTES
(
zl
è(*((
ušt32_t
*)(zl)))

	)

143 
	#ZIPLIST_TAIL_OFFSET
(
zl
è(*((
ušt32_t
*)((zl)+(ušt32_t))))

	)

144 
	#ZIPLIST_LENGTH
(
zl
è(*((
ušt16_t
*)((zl)+(
ušt32_t
)*2)))

	)

145 
	#ZIPLIST_HEADER_SIZE
 ((
ušt32_t
)*2+(
ušt16_t
))

	)

146 
	#ZIPLIST_END_SIZE
 ((
ušt8_t
))

	)

147 
	#ZIPLIST_ENTRY_HEAD
(
zl
è((zl)+
ZIPLIST_HEADER_SIZE
)

	)

148 
	#ZIPLIST_ENTRY_TAIL
(
zl
è((zl)+
	`šŒev32ifbe
(
	`ZIPLIST_TAIL_OFFSET
(zl)))

	)

149 
	#ZIPLIST_ENTRY_END
(
zl
è((zl)+
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(zl))-1)

	)

153 
	#ZIPLIST_INCR_LENGTH
(
zl
,
šü
) { \

154 ià(
	`ZIPLIST_LENGTH
(
zl
è< 
UINT16_MAX
) \

155 
	`ZIPLIST_LENGTH
(
zl
èğ
	`šŒev16ifbe
(šŒev16ifbe(ZIPLIST_LENGTH(zl))+
šü
); \

156 }

	)

158 
	szËÁry
 {

159 
	m´ev¿wËnsize
, 
	m´ev¿wËn
;

160 
	mËnsize
, 
	mËn
;

161 
	mh—d”size
;

162 
	m’codšg
;

163 *
	mp
;

164 } 
	tzËÁry
;

166 
	#ZIPLIST_ENTRY_ZERO
(
zË
) { \

167 (
zË
)->
´ev¿wËnsize
 = (zË)->
´ev¿wËn
 = 0; \

168 (
zË
)->
Ënsize
 = (zË)->
Ën
 = (zË)->
h—d”size
 = 0; \

169 (
zË
)->
’codšg
 = 0; \

170 (
zË
)->
p
 = 
NULL
; \

171 }

	)

175 
	#ZIP_ENTRY_ENCODING
(
±r
, 
’codšg
) do { \

176 (
’codšg
èğ(
±r
[0]); \

177 ià((
’codšg
è< 
ZIP_STR_MASK
) (encoding) &= ZIP_STR_MASK; \

178 } 0)

	)

180 
zli¡R•r
(*
zl
);

183 
	$zIÁSize
(
’codšg
) {

184 
’codšg
) {

185 
ZIP_INT_8B
:  1;

186 
ZIP_INT_16B
:  2;

187 
ZIP_INT_24B
:  3;

188 
ZIP_INT_32B
:  4;

189 
ZIP_INT_64B
:  8;

192 
	`as£¹
(
NULL
);

194 
	}
}

198 
	$zEncodeL’gth
(*
p
, 
’codšg
, 
¿wËn
) {

199 
Ën
 = 1, 
buf
[5];

201 ià(
	`ZIP_IS_STR
(
’codšg
)) {

204 ià(
¿wËn
 <= 0x3f) {

205 ià(!
p
è 
Ën
;

206 
buf
[0] = 
ZIP_STR_06B
 | 
¿wËn
;

207 } ià(
¿wËn
 <= 0x3fff) {

208 
Ën
 += 1;

209 ià(!
p
è 
Ën
;

210 
buf
[0] = 
ZIP_STR_14B
 | ((
¿wËn
 >> 8) & 0x3f);

211 
buf
[1] = 
¿wËn
 & 0xff;

213 
Ën
 += 4;

214 ià(!
p
è 
Ën
;

215 
buf
[0] = 
ZIP_STR_32B
;

216 
buf
[1] = (
¿wËn
 >> 24) & 0xff;

217 
buf
[2] = (
¿wËn
 >> 16) & 0xff;

218 
buf
[3] = (
¿wËn
 >> 8) & 0xff;

219 
buf
[4] = 
¿wËn
 & 0xff;

223 ià(!
p
è 
Ën
;

224 
buf
[0] = 
’codšg
;

228 
	`memıy
(
p
,
buf
,
Ën
);

229  
Ën
;

230 
	}
}

236 
	#ZIP_DECODE_LENGTH
(
±r
, 
’codšg
, 
Ënsize
, 
Ën
) do { \

237 
	`ZIP_ENTRY_ENCODING
((
±r
), (
’codšg
)); \

238 ià((
’codšg
è< 
ZIP_STR_MASK
) { \

239 ià((
’codšg
è=ğ
ZIP_STR_06B
) { \

240 (
Ënsize
) = 1; \

241 (
Ën
èğ(
±r
)[0] & 0x3f; \

242 } ià((
’codšg
è=ğ
ZIP_STR_14B
) { \

243 (
Ënsize
) = 2; \

244 (
Ën
èğ(((
±r
)[0] & 0x3f) << 8) | (ptr)[1]; \

245 } ià(
’codšg
 =ğ
ZIP_STR_32B
) { \

246 (
Ënsize
) = 5; \

247 (
Ën
èğ((
±r
)[1] << 24) | \

248 ((
±r
)[2] << 16) | \

249 ((
±r
)[3] << 8) | \

250 ((
±r
)[4]); \

252 
	`as£¹
(
NULL
); \

255 (
Ënsize
) = 1; \

256 (
Ën
èğ
	`zIÁSize
(
’codšg
); \

258 } 0);

	)

262 
	$zP»vEncodeL’gth
(*
p
, 
Ën
) {

263 ià(
p
 =ğ
NULL
) {

264  (
Ën
 < 
ZIP_BIGLEN
) ? 1 : (len)+1;

266 ià(
Ën
 < 
ZIP_BIGLEN
) {

267 
p
[0] = 
Ën
;

270 
p
[0] = 
ZIP_BIGLEN
;

271 
	`memıy
(
p
+1,&
Ën
,(len));

272 
	`mem»v32ifbe
(
p
+1);

273  1+(
Ën
);

276 
	}
}

280 
	$zP»vEncodeL’gthFÜûL¬ge
(*
p
, 
Ën
) {

281 ià(
p
 =ğ
NULL
) ;

282 
p
[0] = 
ZIP_BIGLEN
;

283 
	`memıy
(
p
+1,&
Ën
,(len));

284 
	`mem»v32ifbe
(
p
+1);

285 
	}
}

289 
	#ZIP_DECODE_PREVLENSIZE
(
±r
, 
´evËnsize
) do { \

290 ià((
±r
)[0] < 
ZIP_BIGLEN
) { \

291 (
´evËnsize
) = 1; \

293 (
´evËnsize
) = 5; \

295 } 0);

	)

299 
	#ZIP_DECODE_PREVLEN
(
±r
, 
´evËnsize
, 
´evËn
) do { \

300 
	`ZIP_DECODE_PREVLENSIZE
(
±r
, 
´evËnsize
); \

301 ià((
´evËnsize
) == 1) { \

302 (
´evËn
èğ(
±r
)[0]; \

303 } ià((
´evËnsize
) == 5) { \

304 
	`as£¹
(((
´evËnsize
)) == 4); \

305 
	`memıy
(&(
´evËn
), ((*)(
±r
)) + 1, 4); \

306 
	`mem»v32ifbe
(&
´evËn
); \

308 } 0);

	)

312 
	$zP»vL’By‹Diff
(*
p
, 
Ën
) {

313 
´evËnsize
;

314 
	`ZIP_DECODE_PREVLENSIZE
(
p
, 
´evËnsize
);

315  
	`zP»vEncodeL’gth
(
NULL
, 
Ën
è- 
´evËnsize
;

316 
	}
}

319 
	$zRawEÁryL’gth
(*
p
) {

320 
´evËnsize
, 
’codšg
, 
Ënsize
, 
Ën
;

321 
	`ZIP_DECODE_PREVLENSIZE
(
p
, 
´evËnsize
);

322 
	`ZIP_DECODE_LENGTH
(
p
 + 
´evËnsize
, 
’codšg
, 
Ënsize
, 
Ën
);

323  
´evËnsize
 + 
Ënsize
 + 
Ën
;

324 
	}
}

328 
	$zTryEncodšg
(*
’Œy
, 
’ŒyËn
, *
v
, *
’codšg
) {

329 
v®ue
;

331 ià(
’ŒyËn
 >= 32 ||ƒntrylen == 0)  0;

332 ià(
	`¡ršg2Î
((*)
’Œy
,
’ŒyËn
,&
v®ue
)) {

335 ià(
v®ue
 >= 0 && value <= 12) {

336 *
’codšg
 = 
ZIP_INT_IMM_MIN
+
v®ue
;

337 } ià(
v®ue
 >ğ
INT8_MIN
 && v®u<ğ
INT8_MAX
) {

338 *
’codšg
 = 
ZIP_INT_8B
;

339 } ià(
v®ue
 >ğ
INT16_MIN
 && v®u<ğ
INT16_MAX
) {

340 *
’codšg
 = 
ZIP_INT_16B
;

341 } ià(
v®ue
 >ğ
INT24_MIN
 && v®u<ğ
INT24_MAX
) {

342 *
’codšg
 = 
ZIP_INT_24B
;

343 } ià(
v®ue
 >ğ
INT32_MIN
 && v®u<ğ
INT32_MAX
) {

344 *
’codšg
 = 
ZIP_INT_32B
;

346 *
’codšg
 = 
ZIP_INT_64B
;

348 *
v
 = 
v®ue
;

352 
	}
}

355 
	$zSaveIÁeg”
(*
p
, 
št64_t
 
v®ue
, 
’codšg
) {

356 
št16_t
 
i16
;

357 
št32_t
 
i32
;

358 
št64_t
 
i64
;

359 ià(
’codšg
 =ğ
ZIP_INT_8B
) {

360 ((
št8_t
*)
p
)[0] = (št8_t)
v®ue
;

361 } ià(
’codšg
 =ğ
ZIP_INT_16B
) {

362 
i16
 = 
v®ue
;

363 
	`memıy
(
p
,&
i16
,(i16));

364 
	`mem»v16ifbe
(
p
);

365 } ià(
’codšg
 =ğ
ZIP_INT_24B
) {

366 
i32
 = 
v®ue
<<8;

367 
	`mem»v32ifbe
(&
i32
);

368 
	`memıy
(
p
,((
ušt8_t
*)&
i32
)+1,(i32)-(uint8_t));

369 } ià(
’codšg
 =ğ
ZIP_INT_32B
) {

370 
i32
 = 
v®ue
;

371 
	`memıy
(
p
,&
i32
,(i32));

372 
	`mem»v32ifbe
(
p
);

373 } ià(
’codšg
 =ğ
ZIP_INT_64B
) {

374 
i64
 = 
v®ue
;

375 
	`memıy
(
p
,&
i64
,(i64));

376 
	`mem»v64ifbe
(
p
);

377 } ià(
’codšg
 >ğ
ZIP_INT_IMM_MIN
 &&ƒncodšg <ğ
ZIP_INT_IMM_MAX
) {

380 
	`as£¹
(
NULL
);

382 
	}
}

385 
št64_t
 
	$zLßdIÁeg”
(*
p
, 
’codšg
) {

386 
št16_t
 
i16
;

387 
št32_t
 
i32
;

388 
št64_t
 
i64
, 
»t
 = 0;

389 ià(
’codšg
 =ğ
ZIP_INT_8B
) {

390 
»t
 = ((
št8_t
*)
p
)[0];

391 } ià(
’codšg
 =ğ
ZIP_INT_16B
) {

392 
	`memıy
(&
i16
,
p
,(i16));

393 
	`mem»v16ifbe
(&
i16
);

394 
»t
 = 
i16
;

395 } ià(
’codšg
 =ğ
ZIP_INT_32B
) {

396 
	`memıy
(&
i32
,
p
,(i32));

397 
	`mem»v32ifbe
(&
i32
);

398 
»t
 = 
i32
;

399 } ià(
’codšg
 =ğ
ZIP_INT_24B
) {

400 
i32
 = 0;

401 
	`memıy
(((
ušt8_t
*)&
i32
)+1,
p
,(i32)-(uint8_t));

402 
	`mem»v32ifbe
(&
i32
);

403 
»t
 = 
i32
>>8;

404 } ià(
’codšg
 =ğ
ZIP_INT_64B
) {

405 
	`memıy
(&
i64
,
p
,(i64));

406 
	`mem»v64ifbe
(&
i64
);

407 
»t
 = 
i64
;

408 } ià(
’codšg
 >ğ
ZIP_INT_IMM_MIN
 &&ƒncodšg <ğ
ZIP_INT_IMM_MAX
) {

409 
»t
 = (
’codšg
 & 
ZIP_INT_IMM_MASK
)-1;

411 
	`as£¹
(
NULL
);

413  
»t
;

414 
	}
}

417 
	$zEÁry
(*
p
, 
zËÁry
 *
e
) {

419 
	`ZIP_DECODE_PREVLEN
(
p
, 
e
->
´ev¿wËnsize
,ƒ->
´ev¿wËn
);

420 
	`ZIP_DECODE_LENGTH
(
p
 + 
e
->
´ev¿wËnsize
,ƒ->
’codšg
,ƒ->
Ënsize
,ƒ->
Ën
);

421 
e
->
h—d”size
 =ƒ->
´ev¿wËnsize
 +ƒ->
Ënsize
;

422 
e
->
p
 =…;

423 
	}
}

426 *
	$zli¡New
() {

427 
by‹s
 = 
ZIPLIST_HEADER_SIZE
+1;

428 *
zl
 = 
	`zm®loc
(
by‹s
);

429 
	`ZIPLIST_BYTES
(
zl
èğ
	`šŒev32ifbe
(
by‹s
);

430 
	`ZIPLIST_TAIL_OFFSET
(
zl
èğ
	`šŒev32ifbe
(
ZIPLIST_HEADER_SIZE
);

431 
	`ZIPLIST_LENGTH
(
zl
) = 0;

432 
zl
[
by‹s
-1] = 
ZIP_END
;

433  
zl
;

434 
	}
}

437 *
	$zli¡Resize
(*
zl
, 
Ën
) {

438 
zl
 = 
	`z»®loc
(zl,
Ën
);

439 
	`ZIPLIST_BYTES
(
zl
èğ
	`šŒev32ifbe
(
Ën
);

440 
zl
[
Ën
-1] = 
ZIP_END
;

441  
zl
;

442 
	}
}

464 *
	$__zli¡CasÿdeUpd©e
(*
zl
, *
p
) {

465 
size_t
 
cu¾’
 = 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
)), 
¿wËn
, 
¿wËnsize
;

466 
size_t
 
off£t
, 
noff£t
, 
exŒa
;

467 *
Å
;

468 
zËÁry
 
cur
, 
Ãxt
;

470 
p
[0] !ğ
ZIP_END
) {

471 
	`zEÁry
(
p
, &
cur
);

472 
¿wËn
 = 
cur
.
h—d”size
 + cur.
Ën
;

473 
¿wËnsize
 = 
	`zP»vEncodeL’gth
(
NULL
,
¿wËn
);

476 ià(
p
[
¿wËn
] =ğ
ZIP_END
) ;

477 
	`zEÁry
(
p
+
¿wËn
, &
Ãxt
);

480 ià(
Ãxt
.
´ev¿wËn
 =ğ
¿wËn
) ;

482 ià(
Ãxt
.
´ev¿wËnsize
 < 
¿wËnsize
) {

485 
off£t
 = 
p
-
zl
;

486 
exŒa
 = 
¿wËnsize
-
Ãxt
.
´ev¿wËnsize
;

487 
zl
 = 
	`zli¡Resize
(zl,
cu¾’
+
exŒa
);

488 
p
 = 
zl
+
off£t
;

491 
Å
 = 
p
+
¿wËn
;

492 
noff£t
 = 
Å
-
zl
;

495 ià((
zl
+
	`šŒev32ifbe
(
	`ZIPLIST_TAIL_OFFSET
(zl))è!ğ
Å
) {

496 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

497 
	`šŒev32ifbe
(šŒev32ifbe(
	`ZIPLIST_TAIL_OFFSET
(
zl
))+
exŒa
);

501 
	`memmove
(
Å
+
¿wËnsize
,

502 
Å
+
Ãxt
.
´ev¿wËnsize
,

503 
cu¾’
-
noff£t
-
Ãxt
.
´ev¿wËnsize
-1);

504 
	`zP»vEncodeL’gth
(
Å
,
¿wËn
);

507 
p
 +ğ
¿wËn
;

508 
cu¾’
 +ğ
exŒa
;

510 ià(
Ãxt
.
´ev¿wËnsize
 > 
¿wËnsize
) {

513 
	`zP»vEncodeL’gthFÜûL¬ge
(
p
+
¿wËn
,rawlen);

515 
	`zP»vEncodeL’gth
(
p
+
¿wËn
,rawlen);

522  
zl
;

523 
	}
}

526 *
	$__zli¡D–‘e
(*
zl
, *
p
, 
num
) {

527 
i
, 
tÙËn
, 
d–‘ed
 = 0;

528 
size_t
 
off£t
;

529 
Ãxtdiff
 = 0;

530 
zËÁry
 
fœ¡
, 

;

532 
	`zEÁry
(
p
, &
fœ¡
);

533 
i
 = 0; 
p
[0] !ğ
ZIP_END
 && i < 
num
; i++) {

534 
p
 +ğ
	`zRawEÁryL’gth
(p);

535 
d–‘ed
++;

538 
tÙËn
 = 
p
-
fœ¡
.p;

539 ià(
tÙËn
 > 0) {

540 ià(
p
[0] !ğ
ZIP_END
) {

545 
Ãxtdiff
 = 
	`zP»vL’By‹Diff
(
p
,
fœ¡
.
´ev¿wËn
);

546 
p
 -ğ
Ãxtdiff
;

547 
	`zP»vEncodeL’gth
(
p
,
fœ¡
.
´ev¿wËn
);

550 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

551 
	`šŒev32ifbe
(šŒev32ifbe(
	`ZIPLIST_TAIL_OFFSET
(
zl
))-
tÙËn
);

556 
	`zEÁry
(
p
, &

);

557 ià(
p
[

.
h—d”size
+.
Ën
] !ğ
ZIP_END
) {

558 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

559 
	`šŒev32ifbe
(šŒev32ifbe(
	`ZIPLIST_TAIL_OFFSET
(
zl
))+
Ãxtdiff
);

563 
	`memmove
(
fœ¡
.
p
,p,

564 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
))-(
p
-zl)-1);

567 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

568 
	`šŒev32ifbe
((
fœ¡
.
p
-
zl
)-fœ¡.
´ev¿wËn
);

572 
off£t
 = 
fœ¡
.
p
-
zl
;

573 
zl
 = 
	`zli¡Resize
(zl, 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(zl))-
tÙËn
+
Ãxtdiff
);

574 
	`ZIPLIST_INCR_LENGTH
(
zl
,-
d–‘ed
);

575 
p
 = 
zl
+
off£t
;

579 ià(
Ãxtdiff
 != 0)

580 
zl
 = 
	`__zli¡CasÿdeUpd©e
(zl,
p
);

582  
zl
;

583 
	}
}

586 *
	$__zli¡In£¹
(*
zl
, *
p
, *
s
, 
¦’
) {

587 
size_t
 
cu¾’
 = 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
)), 
»qËn
;

588 
´evËnsize
, 
´evËn
 = 0;

589 
size_t
 
off£t
;

590 
Ãxtdiff
 = 0;

591 
’codšg
 = 0;

592 
v®ue
 = 123456789;

595 
zËÁry
 

;

598 ià(
p
[0] !ğ
ZIP_END
) {

599 
	`ZIP_DECODE_PREVLEN
(
p
, 
´evËnsize
, 
´evËn
);

601 *
±a
 = 
	`ZIPLIST_ENTRY_TAIL
(
zl
);

602 ià(
±a
[0] !ğ
ZIP_END
) {

603 
´evËn
 = 
	`zRawEÁryL’gth
(
±a
);

608 ià(
	`zTryEncodšg
(
s
,
¦’
,&
v®ue
,&
’codšg
)) {

610 
»qËn
 = 
	`zIÁSize
(
’codšg
);

614 
»qËn
 = 
¦’
;

618 
»qËn
 +ğ
	`zP»vEncodeL’gth
(
NULL
,
´evËn
);

619 
»qËn
 +ğ
	`zEncodeL’gth
(
NULL
,
’codšg
,
¦’
);

624 
Ãxtdiff
 = (
p
[0] !ğ
ZIP_END
è? 
	`zP»vL’By‹Diff
Õ,
»qËn
) : 0;

627 
off£t
 = 
p
-
zl
;

628 
zl
 = 
	`zli¡Resize
(zl,
cu¾’
+
»qËn
+
Ãxtdiff
);

629 
p
 = 
zl
+
off£t
;

632 ià(
p
[0] !ğ
ZIP_END
) {

634 
	`memmove
(
p
+
»qËn
,p-
Ãxtdiff
,
cu¾’
-
off£t
-1+nextdiff);

637 
	`zP»vEncodeL’gth
(
p
+
»qËn
,reqlen);

640 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

641 
	`šŒev32ifbe
(šŒev32ifbe(
	`ZIPLIST_TAIL_OFFSET
(
zl
))+
»qËn
);

646 
	`zEÁry
(
p
+
»qËn
, &

);

647 ià(
p
[
»qËn
+

.
h—d”size
+.
Ën
] !ğ
ZIP_END
) {

648 
	`ZIPLIST_TAIL_OFFSET
(
zl
) =

649 
	`šŒev32ifbe
(šŒev32ifbe(
	`ZIPLIST_TAIL_OFFSET
(
zl
))+
Ãxtdiff
);

653 
	`ZIPLIST_TAIL_OFFSET
(
zl
èğ
	`šŒev32ifbe
(
p
-zl);

658 ià(
Ãxtdiff
 != 0) {

659 
off£t
 = 
p
-
zl
;

660 
zl
 = 
	`__zli¡CasÿdeUpd©e
(zl,
p
+
»qËn
);

661 
p
 = 
zl
+
off£t
;

665 
p
 +ğ
	`zP»vEncodeL’gth
Õ,
´evËn
);

666 
p
 +ğ
	`zEncodeL’gth
Õ,
’codšg
,
¦’
);

667 ià(
	`ZIP_IS_STR
(
’codšg
)) {

668 
	`memıy
(
p
,
s
,
¦’
);

670 
	`zSaveIÁeg”
(
p
,
v®ue
,
’codšg
);

672 
	`ZIPLIST_INCR_LENGTH
(
zl
,1);

673  
zl
;

674 
	}
}

691 *
	$zli¡M”ge
(**
fœ¡
, **
£cÚd
) {

693 ià(
fœ¡
 =ğ
NULL
 || *fœ¡ =ğNULL || 
£cÚd
 == NULL || *second == NULL)

694  
NULL
;

697 ià(*
fœ¡
 =ğ*
£cÚd
)

698  
NULL
;

700 
size_t
 
fœ¡_by‹s
 = 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(*
fœ¡
));

701 
size_t
 
fœ¡_Ën
 = 
	`šŒev16ifbe
(
	`ZIPLIST_LENGTH
(*
fœ¡
));

703 
size_t
 
£cÚd_by‹s
 = 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(*
£cÚd
));

704 
size_t
 
£cÚd_Ën
 = 
	`šŒev16ifbe
(
	`ZIPLIST_LENGTH
(*
£cÚd
));

706 
­³nd
;

707 *
sourû
, *
rg‘
;

708 
size_t
 
rg‘_by‹s
, 
sourû_by‹s
;

712 ià(
fœ¡_Ën
 >ğ
£cÚd_Ën
) {

714 
rg‘
 = *
fœ¡
;

715 
rg‘_by‹s
 = 
fœ¡_by‹s
;

716 
sourû
 = *
£cÚd
;

717 
sourû_by‹s
 = 
£cÚd_by‹s
;

718 
­³nd
 = 1;

721 
rg‘
 = *
£cÚd
;

722 
rg‘_by‹s
 = 
£cÚd_by‹s
;

723 
sourû
 = *
fœ¡
;

724 
sourû_by‹s
 = 
fœ¡_by‹s
;

725 
­³nd
 = 0;

729 
size_t
 
zlby‹s
 = 
fœ¡_by‹s
 + 
£cÚd_by‹s
 -

730 
ZIPLIST_HEADER_SIZE
 - 
ZIPLIST_END_SIZE
;

731 
size_t
 
zÎ’gth
 = 
fœ¡_Ën
 + 
£cÚd_Ën
;

734 
zÎ’gth
 = zÎ’gth < 
UINT16_MAX
 ? zllength : UINT16_MAX;

737 
size_t
 
fœ¡_off£t
 = 
	`šŒev32ifbe
(
	`ZIPLIST_TAIL_OFFSET
(*
fœ¡
));

738 
size_t
 
£cÚd_off£t
 = 
	`šŒev32ifbe
(
	`ZIPLIST_TAIL_OFFSET
(*
£cÚd
));

741 
rg‘
 = 
	`z»®loc
Ñ¬g‘, 
zlby‹s
);

742 ià(
­³nd
) {

746 
	`memıy
(
rg‘
 + 
rg‘_by‹s
 - 
ZIPLIST_END_SIZE
,

747 
sourû
 + 
ZIPLIST_HEADER_SIZE
,

748 
sourû_by‹s
 - 
ZIPLIST_HEADER_SIZE
);

754 
	`memmove
(
rg‘
 + 
sourû_by‹s
 - 
ZIPLIST_END_SIZE
,

755 
rg‘
 + 
ZIPLIST_HEADER_SIZE
,

756 
rg‘_by‹s
 - 
ZIPLIST_HEADER_SIZE
);

757 
	`memıy
(
rg‘
, 
sourû
, 
sourû_by‹s
 - 
ZIPLIST_END_SIZE
);

761 
	`ZIPLIST_BYTES
(
rg‘
èğ
	`šŒev32ifbe
(
zlby‹s
);

762 
	`ZIPLIST_LENGTH
(
rg‘
èğ
	`šŒev16ifbe
(
zÎ’gth
);

768 
	`ZIPLIST_TAIL_OFFSET
(
rg‘
èğ
	`šŒev32ifbe
(

769 (
fœ¡_by‹s
 - 
ZIPLIST_END_SIZE
) +

770 (
£cÚd_off£t
 - 
ZIPLIST_HEADER_SIZE
));

776 
rg‘
 = 
	`__zli¡CasÿdeUpd©e
Ñ¬g‘,¬g‘+
fœ¡_off£t
);

779 ià(
­³nd
) {

780 
	`zä“
(*
£cÚd
);

781 *
£cÚd
 = 
NULL
;

782 *
fœ¡
 = 
rg‘
;

784 
	`zä“
(*
fœ¡
);

785 *
fœ¡
 = 
NULL
;

786 *
£cÚd
 = 
rg‘
;

788  
rg‘
;

789 
	}
}

791 *
	$zli¡Push
(*
zl
, *
s
, 
¦’
, 
wh”e
) {

792 *
p
;

793 
p
 = (
wh”e
 =ğ
ZIPLIST_HEAD
è? 
	`ZIPLIST_ENTRY_HEAD
(
zl
è: 
	`ZIPLIST_ENTRY_END
(zl);

794  
	`__zli¡In£¹
(
zl
,
p
,
s
,
¦’
);

795 
	}
}

800 *
	$zli¡Index
(*
zl
, 
šdex
) {

801 *
p
;

802 
´evËnsize
, 
´evËn
 = 0;

803 ià(
šdex
 < 0) {

804 
šdex
 = (-index)-1;

805 
p
 = 
	`ZIPLIST_ENTRY_TAIL
(
zl
);

806 ià(
p
[0] !ğ
ZIP_END
) {

807 
	`ZIP_DECODE_PREVLEN
(
p
, 
´evËnsize
, 
´evËn
);

808 
´evËn
 > 0 && 
šdex
--) {

809 
p
 -ğ
´evËn
;

810 
	`ZIP_DECODE_PREVLEN
(
p
, 
´evËnsize
, 
´evËn
);

814 
p
 = 
	`ZIPLIST_ENTRY_HEAD
(
zl
);

815 
p
[0] !ğ
ZIP_END
 && 
šdex
--) {

816 
p
 +ğ
	`zRawEÁryL’gth
(p);

819  (
p
[0] =ğ
ZIP_END
 || 
šdex
 > 0è? 
NULL
 :…;

820 
	}
}

828 *
	$zli¡Next
(*
zl
, *
p
) {

829 ((è
zl
);

834 ià(
p
[0] =ğ
ZIP_END
) {

835  
NULL
;

838 
p
 +ğ
	`zRawEÁryL’gth
(p);

839 ià(
p
[0] =ğ
ZIP_END
) {

840  
NULL
;

843  
p
;

844 
	}
}

847 *
	$zli¡P»v
(*
zl
, *
p
) {

848 
´evËnsize
, 
´evËn
 = 0;

853 ià(
p
[0] =ğ
ZIP_END
) {

854 
p
 = 
	`ZIPLIST_ENTRY_TAIL
(
zl
);

855  (
p
[0] =ğ
ZIP_END
è? 
NULL
 :…;

856 } ià(
p
 =ğ
	`ZIPLIST_ENTRY_HEAD
(
zl
)) {

857  
NULL
;

859 
	`ZIP_DECODE_PREVLEN
(
p
, 
´evËnsize
, 
´evËn
);

860 
	`as£¹
(
´evËn
 > 0);

861  
p
-
´evËn
;

863 
	}
}

869 
	$zli¡G‘
(*
p
, **
s¡r
, *
¦’
, *
sv®
) {

870 
zËÁry
 
’Œy
;

871 ià(
p
 =ğ
NULL
 ||…[0] =ğ
ZIP_END
)  0;

872 ià(
s¡r
è*s¡¸ğ
NULL
;

874 
	`zEÁry
(
p
, &
’Œy
);

875 ià(
	`ZIP_IS_STR
(
’Œy
.
’codšg
)) {

876 ià(
s¡r
) {

877 *
¦’
 = 
’Œy
.
Ën
;

878 *
s¡r
 = 
p
+
’Œy
.
h—d”size
;

881 ià(
sv®
) {

882 *
sv®
 = 
	`zLßdIÁeg”
(
p
+
’Œy
.
h—d”size
,’Œy.
’codšg
);

886 
	}
}

889 *
	$zli¡In£¹
(*
zl
, *
p
, *
s
, 
¦’
) {

890  
	`__zli¡In£¹
(
zl
,
p
,
s
,
¦’
);

891 
	}
}

896 *
	$zli¡D–‘e
(*
zl
, **
p
) {

897 
size_t
 
off£t
 = *
p
-
zl
;

898 
zl
 = 
	`__zli¡D–‘e
(zl,*
p
,1);

904 *
p
 = 
zl
+
off£t
;

905  
zl
;

906 
	}
}

909 *
	$zli¡D–‘eRªge
(*
zl
, 
šdex
, 
num
) {

910 *
p
 = 
	`zli¡Index
(
zl
,
šdex
);

911  (
p
 =ğ
NULL
è? 
zl
 : 
	`__zli¡D–‘e
(zl,p,
num
);

912 
	}
}

916 
	$zli¡Com·»
(*
p
, *
s¡r
, 
¦’
) {

917 
zËÁry
 
’Œy
;

918 
£ncodšg
;

919 
zv®
, 
sv®
;

920 ià(
p
[0] =ğ
ZIP_END
)  0;

922 
	`zEÁry
(
p
, &
’Œy
);

923 ià(
	`ZIP_IS_STR
(
’Œy
.
’codšg
)) {

925 ià(
’Œy
.
Ën
 =ğ
¦’
) {

926  
	`memcmp
(
p
+
’Œy
.
h—d”size
,
s¡r
,
¦’
) == 0;

933 ià(
	`zTryEncodšg
(
s¡r
,
¦’
,&
sv®
,&
£ncodšg
)) {

934 
zv®
 = 
	`zLßdIÁeg”
(
p
+
’Œy
.
h—d”size
,’Œy.
’codšg
);

935  
zv®
 =ğ
sv®
;

939 
	}
}

943 *
	$zli¡Fšd
(*
p
, *
v¡r
, 
vËn
, 
sk
) {

944 
skút
 = 0;

945 
v’codšg
 = 0;

946 
vÎ
 = 0;

948 
p
[0] !ğ
ZIP_END
) {

949 
´evËnsize
, 
’codšg
, 
Ënsize
, 
Ën
;

950 *
q
;

952 
	`ZIP_DECODE_PREVLENSIZE
(
p
, 
´evËnsize
);

953 
	`ZIP_DECODE_LENGTH
(
p
 + 
´evËnsize
, 
’codšg
, 
Ënsize
, 
Ën
);

954 
q
 = 
p
 + 
´evËnsize
 + 
Ënsize
;

956 ià(
skút
 == 0) {

958 ià(
	`ZIP_IS_STR
(
’codšg
)) {

959 ià(
Ën
 =ğ
vËn
 && 
	`memcmp
(
q
, 
v¡r
, vlen) == 0) {

960  
p
;

966 ià(
v’codšg
 == 0) {

967 ià(!
	`zTryEncodšg
(
v¡r
, 
vËn
, &
vÎ
, &
v’codšg
)) {

971 
v’codšg
 = 
UCHAR_MAX
;

974 
	`as£¹
(
v’codšg
);

980 ià(
v’codšg
 !ğ
UCHAR_MAX
) {

981 
Î
 = 
	`zLßdIÁeg”
(
q
, 
’codšg
);

982 ià(
Î
 =ğ
vÎ
) {

983  
p
;

989 
skút
 = 
sk
;

992 
skút
--;

996 
p
 = 
q
 + 
Ën
;

999  
NULL
;

1000 
	}
}

1003 
	$zli¡L’
(*
zl
) {

1004 
Ën
 = 0;

1005 ià(
	`šŒev16ifbe
(
	`ZIPLIST_LENGTH
(
zl
)è< 
UINT16_MAX
) {

1006 
Ën
 = 
	`šŒev16ifbe
(
	`ZIPLIST_LENGTH
(
zl
));

1008 *
p
 = 
zl
+
ZIPLIST_HEADER_SIZE
;

1009 *
p
 !ğ
ZIP_END
) {

1010 
p
 +ğ
	`zRawEÁryL’gth
(p);

1011 
Ën
++;

1015 ià(
Ën
 < 
UINT16_MAX
è
	`ZIPLIST_LENGTH
(
zl
èğ
	`šŒev16ifbe
(len);

1017  
Ën
;

1018 
	}
}

1021 
size_t
 
	$zli¡BlobL’
(*
zl
) {

1022  
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
));

1023 
	}
}

1025 
	$zli¡R•r
(*
zl
) {

1026 *
p
;

1027 
šdex
 = 0;

1028 
zËÁry
 
’Œy
;

1030 
	`´štf
(

1034 
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
)),

1035 
	`šŒev16ifbe
(
	`ZIPLIST_LENGTH
(
zl
)),

1036 
	`šŒev32ifbe
(
	`ZIPLIST_TAIL_OFFSET
(
zl
)));

1037 
p
 = 
	`ZIPLIST_ENTRY_HEAD
(
zl
);

1038 *
p
 !ğ
ZIP_END
) {

1039 
	`zEÁry
(
p
, &
’Œy
);

1040 
	`´štf
(

1051 ()
p
,

1052 
šdex
,

1053 (è(
p
-
zl
),

1054 
’Œy
.
h—d”size
+’Œy.
Ën
,

1055 
’Œy
.
h—d”size
,

1056 
’Œy
.
´ev¿wËn
,

1057 
’Œy
.
´ev¿wËnsize
,

1058 
’Œy
.
Ën
);

1059 
p
 +ğ
’Œy
.
h—d”size
;

1060 ià(
	`ZIP_IS_STR
(
’Œy
.
’codšg
)) {

1061 ià(
’Œy
.
Ën
 > 40) {

1062 ià(
	`fwr™e
(
p
,40,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1063 
	`´štf
("...");

1065 ià(
’Œy
.
Ën
 &&

1066 
	`fwr™e
(
p
,
’Œy
.
Ën
,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1069 
	`´štf
("%Îd", (è
	`zLßdIÁeg”
(
p
,
’Œy
.
’codšg
));

1071 
	`´štf
("\n");

1072 
p
 +ğ
’Œy
.
Ën
;

1073 
šdex
++;

1075 
	`´štf
("{end}\n\n");

1076 
	}
}

1078 #ifdeà
REDIS_TEST


1079 
	~<sys/time.h
>

1080 
	~"adli¡.h
"

1081 
	~"sds.h
"

1083 
	#debug
(
f
, ...è{ ià(
DEBUG
è
	`´štf
(f, 
__VA_ARGS__
); }

	)

1085 *
	$ü—‹Li¡
() {

1086 *
zl
 = 
	`zli¡New
();

1087 
zl
 = 
	`zli¡Push
(zl, (*)"foo", 3, 
ZIPLIST_TAIL
);

1088 
zl
 = 
	`zli¡Push
(zl, (*)"quux", 4, 
ZIPLIST_TAIL
);

1089 
zl
 = 
	`zli¡Push
(zl, (*)"h–lo", 5, 
ZIPLIST_HEAD
);

1090 
zl
 = 
	`zli¡Push
(zl, (*)"1024", 4, 
ZIPLIST_TAIL
);

1091  
zl
;

1092 
	}
}

1094 *
	$ü—‹IÁLi¡
() {

1095 *
zl
 = 
	`zli¡New
();

1096 
buf
[32];

1098 
	`¥rštf
(
buf
, "100");

1099 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_TAIL
);

1100 
	`¥rštf
(
buf
, "128000");

1101 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_TAIL
);

1102 
	`¥rštf
(
buf
, "-100");

1103 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_HEAD
);

1104 
	`¥rštf
(
buf
, "4294967296");

1105 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_HEAD
);

1106 
	`¥rštf
(
buf
, "non integer");

1107 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_TAIL
);

1108 
	`¥rštf
(
buf
, "much much†onger‚on integer");

1109 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
	`¡¾’
(buf), 
ZIPLIST_TAIL
);

1110  
zl
;

1111 
	}
}

1113 
	$u£c
() {

1114 
timev®
 
tv
;

1115 
	`g‘timeofday
(&
tv
,
NULL
);

1116  ((()
tv
.
tv_£c
)*1000000)+tv.
tv_u£c
;

1117 
	}
}

1119 
	$¡»ss
(
pos
, 
num
, 
maxsize
, 
dnum
) {

1120 
i
,
j
,
k
;

1121 *
zl
;

1122 
pos¡r
[2][5] = { "HEAD", "TAIL" };

1123 
¡¬t
;

1124 
i
 = 0; i < 
maxsize
; i+=
dnum
) {

1125 
zl
 = 
	`zli¡New
();

1126 
j
 = 0; j < 
i
; j++) {

1127 
zl
 = 
	`zli¡Push
(zl,(*)"quux",4,
ZIPLIST_TAIL
);

1131 
¡¬t
 = 
	`u£c
();

1132 
k
 = 0; k < 
num
; k++) {

1133 
zl
 = 
	`zli¡Push
(zl,(*)"quux",4,
pos
);

1134 
zl
 = 
	`zli¡D–‘eRªge
(zl,0,1);

1136 
	`´štf
("List size: %8d, bytes: %8d, %dx…ush+pop (%s): %6lld usec\n",

1137 
i
,
	`šŒev32ifbe
(
	`ZIPLIST_BYTES
(
zl
)),
num
,
pos¡r
[
pos
],
	`u£c
()-
¡¬t
);

1138 
	`zä“
(
zl
);

1140 
	}
}

1142 *
	$pİ
(*
zl
, 
wh”e
) {

1143 *
p
, *
v¡r
;

1144 
vËn
;

1145 
vlÚg
;

1147 
p
 = 
	`zli¡Index
(
zl
,
wh”e
 =ğ
ZIPLIST_HEAD
 ? 0 : -1);

1148 ià(
	`zli¡G‘
(
p
,&
v¡r
,&
vËn
,&
vlÚg
)) {

1149 ià(
wh”e
 =ğ
ZIPLIST_HEAD
)

1150 
	`´štf
("Pop head: ");

1152 
	`´štf
("Popail: ");

1154 ià(
v¡r
) {

1155 ià(
vËn
 && 
	`fwr™e
(
v¡r
,vËn,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1158 
	`´štf
("%Îd", 
vlÚg
);

1161 
	`´štf
("\n");

1162  
	`zli¡D–‘e
(
zl
,&
p
);

1164 
	`´štf
("ERROR: Could‚ot…op\n");

1165 
	`ex™
(1);

1167 
	}
}

1169 
	$¿nd¡ršg
(*
rg‘
, 
mš
, 
max
) {

1170 
p
 = 0;

1171 
Ën
 = 
mš
+
	`¿nd
()%(
max
-min+1);

1172 
mšv®
, 
maxv®
;

1173 
	`¿nd
() % 3) {

1175 
mšv®
 = 0;

1176 
maxv®
 = 255;

1179 
mšv®
 = 48;

1180 
maxv®
 = 122;

1183 
mšv®
 = 48;

1184 
maxv®
 = 52;

1187 
	`as£¹
(
NULL
);

1190 
p
 < 
Ën
)

1191 
rg‘
[
p
++] = 
mšv®
+
	`¿nd
()%(
maxv®
-minval+1);

1192  
Ën
;

1193 
	}
}

1195 
	$v”ify
(*
zl
, 
zËÁry
 *
e
) {

1196 
Ën
 = 
	`zli¡L’
(
zl
);

1197 
zËÁry
 
_e
;

1199 
	`ZIPLIST_ENTRY_ZERO
(&
_e
);

1201 
i
 = 0; i < 
Ën
; i++) {

1202 
	`mem£t
(&
e
[
i
], 0, (
zËÁry
));

1203 
	`zEÁry
(
	`zli¡Index
(
zl
, 
i
), &
e
[i]);

1205 
	`mem£t
(&
_e
, 0, (
zËÁry
));

1206 
	`zEÁry
(
	`zli¡Index
(
zl
, -
Ën
+
i
), &
_e
);

1208 
	`as£¹
(
	`memcmp
(&
e
[
i
], &
_e
, (
zËÁry
)) == 0);

1210 
	}
}

1212 
	$zli¡Te¡
(
¬gc
, **
¬gv
) {

1213 *
zl
, *
p
;

1214 *
’Œy
;

1215 
–’
;

1216 
v®ue
;

1219 ià(
¬gc
 == 2)

1220 
	`¤ªd
(
	`©oi
(
¬gv
[1]));

1222 
zl
 = 
	`ü—‹IÁLi¡
();

1223 
	`zli¡R•r
(
zl
);

1225 
	`zä“
(
zl
);

1227 
zl
 = 
	`ü—‹Li¡
();

1228 
	`zli¡R•r
(
zl
);

1230 
zl
 = 
	`pİ
(zl,
ZIPLIST_TAIL
);

1231 
	`zli¡R•r
(
zl
);

1233 
zl
 = 
	`pİ
(zl,
ZIPLIST_HEAD
);

1234 
	`zli¡R•r
(
zl
);

1236 
zl
 = 
	`pİ
(zl,
ZIPLIST_TAIL
);

1237 
	`zli¡R•r
(
zl
);

1239 
zl
 = 
	`pİ
(zl,
ZIPLIST_TAIL
);

1240 
	`zli¡R•r
(
zl
);

1242 
	`zä“
(
zl
);

1244 
	`´štf
("Getƒlement‡t index 3:\n");

1246 
zl
 = 
	`ü—‹Li¡
();

1247 
p
 = 
	`zli¡Index
(
zl
, 3);

1248 ià(!
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1249 
	`´štf
("ERROR: Could‚ot‡ccess index 3\n");

1252 ià(
’Œy
) {

1253 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1254 
	`´štf
("\n");

1256 
	`´štf
("%Îd\n", 
v®ue
);

1258 
	`´štf
("\n");

1259 
	`zä“
(
zl
);

1262 
	`´štf
("Getƒlement‡t index 4 (out of„ange):\n");

1264 
zl
 = 
	`ü—‹Li¡
();

1265 
p
 = 
	`zli¡Index
(
zl
, 4);

1266 ià(
p
 =ğ
NULL
) {

1267 
	`´štf
("Noƒntry\n");

1269 
	`´štf
("ERROR: Ouˆoà¿ngšdex should„‘uº NULL,„‘uºed off£t: %ld\n", 
p
-
zl
);

1272 
	`´štf
("\n");

1273 
	`zä“
(
zl
);

1276 
	`´štf
("Getƒlement‡t index -1 (lastƒlement):\n");

1278 
zl
 = 
	`ü—‹Li¡
();

1279 
p
 = 
	`zli¡Index
(
zl
, -1);

1280 ià(!
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1281 
	`´štf
("ERROR: Could‚ot‡ccess index -1\n");

1284 ià(
’Œy
) {

1285 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1286 
	`´štf
("\n");

1288 
	`´štf
("%Îd\n", 
v®ue
);

1290 
	`´štf
("\n");

1291 
	`zä“
(
zl
);

1294 
	`´štf
("Getƒlement‡t index -4 (firstƒlement):\n");

1296 
zl
 = 
	`ü—‹Li¡
();

1297 
p
 = 
	`zli¡Index
(
zl
, -4);

1298 ià(!
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1299 
	`´štf
("ERROR: Could‚ot‡ccess index -4\n");

1302 ià(
’Œy
) {

1303 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1304 
	`´štf
("\n");

1306 
	`´štf
("%Îd\n", 
v®ue
);

1308 
	`´štf
("\n");

1309 
	`zä“
(
zl
);

1312 
	`´štf
("Getƒlement‡t index -5 (reverse out of„ange):\n");

1314 
zl
 = 
	`ü—‹Li¡
();

1315 
p
 = 
	`zli¡Index
(
zl
, -5);

1316 ià(
p
 =ğ
NULL
) {

1317 
	`´štf
("Noƒntry\n");

1319 
	`´štf
("ERROR: Ouˆoà¿ngšdex should„‘uº NULL,„‘uºed off£t: %ld\n", 
p
-
zl
);

1322 
	`´štf
("\n");

1323 
	`zä“
(
zl
);

1326 
	`´štf
("Iterate†ist from 0oƒnd:\n");

1328 
zl
 = 
	`ü—‹Li¡
();

1329 
p
 = 
	`zli¡Index
(
zl
, 0);

1330 
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1331 
	`´štf
("Entry: ");

1332 ià(
’Œy
) {

1333 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1335 
	`´štf
("%Îd", 
v®ue
);

1337 
p
 = 
	`zli¡Next
(
zl
,p);

1338 
	`´štf
("\n");

1340 
	`´štf
("\n");

1341 
	`zä“
(
zl
);

1344 
	`´štf
("Iterate†ist from 1oƒnd:\n");

1346 
zl
 = 
	`ü—‹Li¡
();

1347 
p
 = 
	`zli¡Index
(
zl
, 1);

1348 
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1349 
	`´štf
("Entry: ");

1350 ià(
’Œy
) {

1351 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1353 
	`´štf
("%Îd", 
v®ue
);

1355 
p
 = 
	`zli¡Next
(
zl
,p);

1356 
	`´štf
("\n");

1358 
	`´štf
("\n");

1359 
	`zä“
(
zl
);

1362 
	`´štf
("Iterate†ist from 2oƒnd:\n");

1364 
zl
 = 
	`ü—‹Li¡
();

1365 
p
 = 
	`zli¡Index
(
zl
, 2);

1366 
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1367 
	`´štf
("Entry: ");

1368 ià(
’Œy
) {

1369 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1371 
	`´štf
("%Îd", 
v®ue
);

1373 
p
 = 
	`zli¡Next
(
zl
,p);

1374 
	`´štf
("\n");

1376 
	`´štf
("\n");

1377 
	`zä“
(
zl
);

1380 
	`´štf
("Iterate starting out of„ange:\n");

1382 
zl
 = 
	`ü—‹Li¡
();

1383 
p
 = 
	`zli¡Index
(
zl
, 4);

1384 ià(!
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1385 
	`´štf
("Noƒntry\n");

1387 
	`´štf
("ERROR\n");

1389 
	`´štf
("\n");

1390 
	`zä“
(
zl
);

1393 
	`´štf
("Iterate from backo front:\n");

1395 
zl
 = 
	`ü—‹Li¡
();

1396 
p
 = 
	`zli¡Index
(
zl
, -1);

1397 
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1398 
	`´štf
("Entry: ");

1399 ià(
’Œy
) {

1400 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1402 
	`´štf
("%Îd", 
v®ue
);

1404 
p
 = 
	`zli¡P»v
(
zl
,p);

1405 
	`´štf
("\n");

1407 
	`´štf
("\n");

1408 
	`zä“
(
zl
);

1411 
	`´štf
("Iterate from backo front, deleting‡ll items:\n");

1413 
zl
 = 
	`ü—‹Li¡
();

1414 
p
 = 
	`zli¡Index
(
zl
, -1);

1415 
	`zli¡G‘
(
p
, &
’Œy
, &
–’
, &
v®ue
)) {

1416 
	`´štf
("Entry: ");

1417 ià(
’Œy
) {

1418 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

1420 
	`´štf
("%Îd", 
v®ue
);

1422 
zl
 = 
	`zli¡D–‘e
(zl,&
p
);

1423 
p
 = 
	`zli¡P»v
(
zl
,p);

1424 
	`´štf
("\n");

1426 
	`´štf
("\n");

1427 
	`zä“
(
zl
);

1430 
	`´štf
("Delete inclusive„ange 0,0:\n");

1432 
zl
 = 
	`ü—‹Li¡
();

1433 
zl
 = 
	`zli¡D–‘eRªge
(zl, 0, 1);

1434 
	`zli¡R•r
(
zl
);

1435 
	`zä“
(
zl
);

1438 
	`´štf
("Delete inclusive„ange 0,1:\n");

1440 
zl
 = 
	`ü—‹Li¡
();

1441 
zl
 = 
	`zli¡D–‘eRªge
(zl, 0, 2);

1442 
	`zli¡R•r
(
zl
);

1443 
	`zä“
(
zl
);

1446 
	`´štf
("Delete inclusive„ange 1,2:\n");

1448 
zl
 = 
	`ü—‹Li¡
();

1449 
zl
 = 
	`zli¡D–‘eRªge
(zl, 1, 2);

1450 
	`zli¡R•r
(
zl
);

1451 
	`zä“
(
zl
);

1454 
	`´štf
("Delete with start index out of„ange:\n");

1456 
zl
 = 
	`ü—‹Li¡
();

1457 
zl
 = 
	`zli¡D–‘eRªge
(zl, 5, 1);

1458 
	`zli¡R•r
(
zl
);

1459 
	`zä“
(
zl
);

1462 
	`´štf
("Delete with‚um overflow:\n");

1464 
zl
 = 
	`ü—‹Li¡
();

1465 
zl
 = 
	`zli¡D–‘eRªge
(zl, 1, 5);

1466 
	`zli¡R•r
(
zl
);

1467 
	`zä“
(
zl
);

1470 
	`´štf
("Delete foo while iterating:\n");

1472 
zl
 = 
	`ü—‹Li¡
();

1473 
p
 = 
	`zli¡Index
(
zl
,0);

1474 
	`zli¡G‘
(
p
,&
’Œy
,&
–’
,&
v®ue
)) {

1475 ià(
’Œy
 && 
	`¡ºcmp
("foo",(*ëÁry,
–’
) == 0) {

1476 
	`´štf
("Delete foo\n");

1477 
zl
 = 
	`zli¡D–‘e
(zl,&
p
);

1479 
	`´štf
("Entry: ");

1480 ià(
’Œy
) {

1481 ià(
–’
 && 
	`fwr™e
(
’Œy
,–’,1,
¡dout
) == 0)

1482 
	`³¼Ü
("fwrite");

1484 
	`´štf
("%Îd",
v®ue
);

1486 
p
 = 
	`zli¡Next
(
zl
,p);

1487 
	`´štf
("\n");

1490 
	`´štf
("\n");

1491 
	`zli¡R•r
(
zl
);

1492 
	`zä“
(
zl
);

1495 
	`´štf
("Regressionest for >255 byte strings:\n");

1497 
v1
[257] = {0}, 
v2
[257] = {0};

1498 
	`mem£t
(
v1
,'x',256);

1499 
	`mem£t
(
v2
,'y',256);

1500 
zl
 = 
	`zli¡New
();

1501 
zl
 = 
	`zli¡Push
(zl,(*)
v1
,
	`¡¾’
(v1),
ZIPLIST_TAIL
);

1502 
zl
 = 
	`zli¡Push
(zl,(*)
v2
,
	`¡¾’
(v2),
ZIPLIST_TAIL
);

1505 
p
 = 
	`zli¡Index
(
zl
,0);

1506 
	`as£¹
(
	`zli¡G‘
(
p
,&
’Œy
,&
–’
,&
v®ue
));

1507 
	`as£¹
(
	`¡ºcmp
(
v1
,(*)
’Œy
,
–’
) == 0);

1508 
p
 = 
	`zli¡Index
(
zl
,1);

1509 
	`as£¹
(
	`zli¡G‘
(
p
,&
’Œy
,&
–’
,&
v®ue
));

1510 
	`as£¹
(
	`¡ºcmp
(
v2
,(*)
’Œy
,
–’
) == 0);

1511 
	`´štf
("SUCCESS\n\n");

1512 
	`zä“
(
zl
);

1515 
	`´štf
("Regressionest deleting‚exto†astƒntries:\n");

1517 
v
[3][257] = {{0}};

1518 
zËÁry
 
e
[3] = {{.
´ev¿wËnsize
 = 0, .
´ev¿wËn
 = 0, .
Ënsize
 = 0,

1519 .
Ën
 = 0, .
h—d”size
 = 0, .
’codšg
 = 0, .
p
 = 
NULL
}};

1520 
size_t
 
i
;

1522 
i
 = 0; i < ((
v
)/(v[0])); i++) {

1523 
	`mem£t
(
v
[
i
], 'a' + i, (v[0]));

1526 
v
[0][256] = '\0';

1527 
v
[1][ 1] = '\0';

1528 
v
[2][256] = '\0';

1530 
zl
 = 
	`zli¡New
();

1531 
i
 = 0; i < ((
v
)/(v[0])); i++) {

1532 
zl
 = 
	`zli¡Push
(zl, (*è
v
[
i
], 
	`¡¾’
(v[i]), 
ZIPLIST_TAIL
);

1535 
	`v”ify
(
zl
, 
e
);

1537 
	`as£¹
(
e
[0].
´ev¿wËnsize
 == 1);

1538 
	`as£¹
(
e
[1].
´ev¿wËnsize
 == 5);

1539 
	`as£¹
(
e
[2].
´ev¿wËnsize
 == 1);

1542 *
p
 = 
e
[1].p;

1543 
zl
 = 
	`zli¡D–‘e
(zl, &
p
);

1545 
	`v”ify
(
zl
, 
e
);

1547 
	`as£¹
(
e
[0].
´ev¿wËnsize
 == 1);

1548 
	`as£¹
(
e
[1].
´ev¿wËnsize
 == 5);

1550 
	`´štf
("SUCCESS\n\n");

1551 
	`zä“
(
zl
);

1554 
	`´štf
("Create†ong†ist‡nd check indices:\n");

1556 
zl
 = 
	`zli¡New
();

1557 
buf
[32];

1558 
i
,
Ën
;

1559 
i
 = 0; i < 1000; i++) {

1560 
Ën
 = 
	`¥rštf
(
buf
,"%d",
i
);

1561 
zl
 = 
	`zli¡Push
(zl,(*)
buf
,
Ën
,
ZIPLIST_TAIL
);

1563 
i
 = 0; i < 1000; i++) {

1564 
p
 = 
	`zli¡Index
(
zl
,
i
);

1565 
	`as£¹
(
	`zli¡G‘
(
p
,
NULL
,NULL,&
v®ue
));

1566 
	`as£¹
(
i
 =ğ
v®ue
);

1568 
p
 = 
	`zli¡Index
(
zl
,-
i
-1);

1569 
	`as£¹
(
	`zli¡G‘
(
p
,
NULL
,NULL,&
v®ue
));

1570 
	`as£¹
(999-
i
 =ğ
v®ue
);

1572 
	`´štf
("SUCCESS\n\n");

1573 
	`zä“
(
zl
);

1576 
	`´štf
("Compare strings with ziplistƒntries:\n");

1578 
zl
 = 
	`ü—‹Li¡
();

1579 
p
 = 
	`zli¡Index
(
zl
,0);

1580 ià(!
	`zli¡Com·»
(
p
,(*)"hello",5)) {

1581 
	`´štf
("ERROR:‚ot \"hello\"\n");

1584 ià(
	`zli¡Com·»
(
p
,(*)"hella",5)) {

1585 
	`´štf
("ERROR: \"hella\"\n");

1589 
p
 = 
	`zli¡Index
(
zl
,3);

1590 ià(!
	`zli¡Com·»
(
p
,(*)"1024",4)) {

1591 
	`´štf
("ERROR:‚ot \"1024\"\n");

1594 ià(
	`zli¡Com·»
(
p
,(*)"1025",4)) {

1595 
	`´štf
("ERROR: \"1025\"\n");

1598 
	`´štf
("SUCCESS\n\n");

1599 
	`zä“
(
zl
);

1602 
	`´štf
("Mergeest:\n");

1605 
zl
 = 
	`ü—‹Li¡
();

1606 *
zl2
 = 
	`ü—‹Li¡
();

1608 *
zl3
 = 
	`zli¡New
();

1609 *
zl4
 = 
	`zli¡New
();

1611 ià(
	`zli¡M”ge
(&
zl4
, &zl4)) {

1612 
	`´štf
("ERROR: Allowed merging of one ziplist into itself.\n");

1617 
zl4
 = 
	`zli¡M”ge
(&
zl3
, &zl4);

1618 
	`zli¡R•r
(
zl4
);

1619 ià(
	`zli¡L’
(
zl4
)) {

1620 
	`´štf
("ERROR: Mergingwoƒmpty ziplists createdƒntries.\n");

1623 
	`zä“
(
zl4
);

1625 
zl2
 = 
	`zli¡M”ge
(&
zl
, &zl2);

1627 
	`zli¡R•r
(
zl2
);

1629 ià(
	`zli¡L’
(
zl2
) != 8) {

1630 
	`´štf
("ERROR: M”ged†’gth‚Ù 8, but: %u\n", 
	`zli¡L’
(
zl2
));

1634 
p
 = 
	`zli¡Index
(
zl2
,0);

1635 ià(!
	`zli¡Com·»
(
p
,(*)"hello",5)) {

1636 
	`´štf
("ERROR:‚ot \"hello\"\n");

1639 ià(
	`zli¡Com·»
(
p
,(*)"hella",5)) {

1640 
	`´štf
("ERROR: \"hella\"\n");

1644 
p
 = 
	`zli¡Index
(
zl2
,3);

1645 ià(!
	`zli¡Com·»
(
p
,(*)"1024",4)) {

1646 
	`´štf
("ERROR:‚ot \"1024\"\n");

1649 ià(
	`zli¡Com·»
(
p
,(*)"1025",4)) {

1650 
	`´štf
("ERROR: \"1025\"\n");

1654 
p
 = 
	`zli¡Index
(
zl2
,4);

1655 ià(!
	`zli¡Com·»
(
p
,(*)"hello",5)) {

1656 
	`´štf
("ERROR:‚ot \"hello\"\n");

1659 ià(
	`zli¡Com·»
(
p
,(*)"hella",5)) {

1660 
	`´štf
("ERROR: \"hella\"\n");

1664 
p
 = 
	`zli¡Index
(
zl2
,7);

1665 ià(!
	`zli¡Com·»
(
p
,(*)"1024",4)) {

1666 
	`´štf
("ERROR:‚ot \"1024\"\n");

1669 ià(
	`zli¡Com·»
(
p
,(*)"1025",4)) {

1670 
	`´štf
("ERROR: \"1025\"\n");

1673 
	`´štf
("SUCCESS\n\n");

1674 
	`zä“
(
zl
);

1677 
	`´štf
("Stress with„andom…ayloads of differentƒncoding:\n");

1679 
i
,
j
,
Ën
,
wh”e
;

1680 *
p
;

1681 
buf
[1024];

1682 
buæ’
;

1683 
li¡
 *
»f
;

1684 
li¡Node
 *
»âode
;

1687 *
s¡r
;

1688 
¦’
;

1689 
sv®
;

1691 
i
 = 0; i < 20000; i++) {

1692 
zl
 = 
	`zli¡New
();

1693 
»f
 = 
	`li¡C»©e
();

1694 
	`li¡S‘F»eM‘hod
(
»f
,((*)(*))
sdsä“
);

1695 
Ën
 = 
	`¿nd
() % 256;

1698 
j
 = 0; j < 
Ën
; j++) {

1699 
wh”e
 = (
	`¿nd
(è& 1è? 
ZIPLIST_HEAD
 : 
ZIPLIST_TAIL
;

1700 ià(
	`¿nd
() % 2) {

1701 
buæ’
 = 
	`¿nd¡ršg
(
buf
,1,(buf)-1);

1703 
	`¿nd
() % 3) {

1705 
buæ’
 = 
	`¥rštf
(
buf
,"%Îd",(0LL + 
	`¿nd
()) >> 20);

1708 
buæ’
 = 
	`¥rštf
(
buf
,"%Îd",(0LL + 
	`¿nd
()));

1711 
buæ’
 = 
	`¥rštf
(
buf
,"%Îd",(0LL + 
	`¿nd
()) << 20);

1714 
	`as£¹
(
NULL
);

1719 
zl
 = 
	`zli¡Push
(zl, (*)
buf
, 
buæ’
, 
wh”e
);

1722 ià(
wh”e
 =ğ
ZIPLIST_HEAD
) {

1723 
	`li¡AddNodeH—d
(
»f
,
	`sd¢ewËn
(
buf
, 
buæ’
));

1724 } ià(
wh”e
 =ğ
ZIPLIST_TAIL
) {

1725 
	`li¡AddNodeTa
(
»f
,
	`sd¢ewËn
(
buf
, 
buæ’
));

1727 
	`as£¹
(
NULL
);

1731 
	`as£¹
(
	`li¡L’gth
(
»f
è=ğ
	`zli¡L’
(
zl
));

1732 
j
 = 0; j < 
Ën
; j++) {

1735 
p
 = 
	`zli¡Index
(
zl
,
j
);

1736 
»âode
 = 
	`li¡Index
(
»f
,
j
);

1738 
	`as£¹
(
	`zli¡G‘
(
p
,&
s¡r
,&
¦’
,&
sv®
));

1739 ià(
s¡r
 =ğ
NULL
) {

1740 
buæ’
 = 
	`¥rštf
(
buf
,"%Îd",
sv®
);

1742 
buæ’
 = 
¦’
;

1743 
	`memıy
(
buf
,
s¡r
,
buæ’
);

1744 
buf
[
buæ’
] = '\0';

1746 
	`as£¹
(
	`memcmp
(
buf
,
	`li¡NodeV®ue
(
»âode
),
buæ’
) == 0);

1748 
	`zä“
(
zl
);

1749 
	`li¡R–—£
(
»f
);

1751 
	`´štf
("SUCCESS\n\n");

1754 
	`´štf
("Stress with variable ziplist size:\n");

1756 
	`¡»ss
(
ZIPLIST_HEAD
,100000,16384,256);

1757 
	`¡»ss
(
ZIPLIST_TAIL
,100000,16384,256);

1761 
	}
}

	@ziplist.h

31 #iâdeà
_ZIPLIST_H


32 
	#_ZIPLIST_H


	)

34 
	#ZIPLIST_HEAD
 0

	)

35 
	#ZIPLIST_TAIL
 1

	)

37 *
zli¡New
();

38 *
zli¡M”ge
(**
fœ¡
, **
£cÚd
);

39 *
zli¡Push
(*
zl
, *
s
, 
¦’
, 
wh”e
);

40 *
zli¡Index
(*
zl
, 
šdex
);

41 *
zli¡Next
(*
zl
, *
p
);

42 *
zli¡P»v
(*
zl
, *
p
);

43 
zli¡G‘
(*
p
, **
sv®
, *
¦’
, *
lv®
);

44 *
zli¡In£¹
(*
zl
, *
p
, *
s
, 
¦’
);

45 *
zli¡D–‘e
(*
zl
, **
p
);

46 *
zli¡D–‘eRªge
(*
zl
, 
šdex
, 
num
);

47 
zli¡Com·»
(*
p
, *
s
, 
¦’
);

48 *
zli¡Fšd
(*
p
, *
v¡r
, 
vËn
, 
sk
);

49 
zli¡L’
(*
zl
);

50 
size_t
 
zli¡BlobL’
(*
zl
);

52 #ifdeà
REDIS_TEST


53 
zli¡Te¡
(
¬gc
, *
¬gv
[]);

	@zipmap.c

78 
	~<¡dio.h
>

79 
	~<¡ršg.h
>

80 
	~"zm®loc.h
"

81 
	~"’dŸncÚv.h
"

83 
	#ZIPMAP_BIGLEN
 254

	)

84 
	#ZIPMAP_END
 255

	)

88 
	#ZIPMAP_VALUE_MAX_FREE
 4

	)

93 
	#ZIPMAP_LEN_BYTES
(
_l
è(((_lè< 
ZIPMAP_BIGLEN
è? 1 : ()+1)

	)

96 *
	$zm­New
() {

97 *
zm
 = 
	`zm®loc
(2);

99 
zm
[0] = 0;

100 
zm
[1] = 
ZIPMAP_END
;

101  
zm
;

102 
	}
}

105 
	$zm­DecodeL’gth
(*
p
) {

106 
Ën
 = *
p
;

108 ià(
Ën
 < 
ZIPMAP_BIGLEN
) †en;

109 
	`memıy
(&
Ën
,
p
+1,());

110 
	`mem»v32ifbe
(&
Ën
);

111  
Ën
;

112 
	}
}

116 
	$zm­EncodeL’gth
(*
p
, 
Ën
) {

117 ià(
p
 =ğ
NULL
) {

118  
	`ZIPMAP_LEN_BYTES
(
Ën
);

120 ià(
Ën
 < 
ZIPMAP_BIGLEN
) {

121 
p
[0] = 
Ën
;

124 
p
[0] = 
ZIPMAP_BIGLEN
;

125 
	`memıy
(
p
+1,&
Ën
,(len));

126 
	`mem»v32ifbe
(
p
+1);

127  1+(
Ën
);

130 
	}
}

138 *
	$zm­LookupRaw
(*
zm
, *
key
, 
kËn
, *
tÙËn
) {

139 *
p
 = 
zm
+1, *
k
 = 
NULL
;

140 
l
,
Î’
;

142 *
p
 !ğ
ZIPMAP_END
) {

143 
ä“
;

146 
l
 = 
	`zm­DecodeL’gth
(
p
);

147 
Î’
 = 
	`zm­EncodeL’gth
(
NULL
,
l
);

148 ià(
key
 !ğ
NULL
 && 
k
 =ğNULL && 
l
 =ğ
kËn
 && !
	`memcmp
(
p
+
Î’
,key,l)) {

151 ià(
tÙËn
 !ğ
NULL
) {

152 
k
 = 
p
;

154  
p
;

157 
p
 +ğ
Î’
+
l
;

159 
l
 = 
	`zm­DecodeL’gth
(
p
);

160 
p
 +ğ
	`zm­EncodeL’gth
(
NULL
,
l
);

161 
ä“
 = 
p
[0];

162 
p
 +ğ
l
+1+
ä“
;

164 ià(
tÙËn
 !ğ
NULL
è*tÙËÀğ()(
p
-
zm
)+1;

165  
k
;

166 
	}
}

168 
	$zm­RequœedL’gth
(
kËn
, 
vËn
) {

169 
l
;

171 
l
 = 
kËn
+
vËn
+3;

172 ià(
kËn
 >ğ
ZIPMAP_BIGLEN
è
l
 += 4;

173 ià(
vËn
 >ğ
ZIPMAP_BIGLEN
è
l
 += 4;

174  
l
;

175 
	}
}

178 
	$zm­RawKeyL’gth
(*
p
) {

179 
l
 = 
	`zm­DecodeL’gth
(
p
);

180  
	`zm­EncodeL’gth
(
NULL
,
l
) +†;

181 
	}
}

185 
	$zm­RawV®ueL’gth
(*
p
) {

186 
l
 = 
	`zm­DecodeL’gth
(
p
);

187 
u£d
;

189 
u£d
 = 
	`zm­EncodeL’gth
(
NULL
,
l
);

190 
u£d
 +ğ
p
[u£d] + 1 + 
l
;

191  
u£d
;

192 
	}
}

197 
	$zm­RawEÁryL’gth
(*
p
) {

198 
l
 = 
	`zm­RawKeyL’gth
(
p
);

199  
l
 + 
	`zm­RawV®ueL’gth
(
p
+l);

200 
	}
}

202 
šlše
 *
	$zm­Resize
(*
zm
, 
Ën
) {

203 
zm
 = 
	`z»®loc
(zm, 
Ën
);

204 
zm
[
Ën
-1] = 
ZIPMAP_END
;

205  
zm
;

206 
	}
}

211 *
	$zm­S‘
(*
zm
, *
key
, 
kËn
, *
v®
, 
vËn
, *
upd©e
) {

212 
zmËn
, 
off£t
;

213 
ä“Ën
, 
»qËn
 = 
	`zm­RequœedL’gth
(
kËn
,
vËn
);

214 
em±y
, 
vem±y
;

215 *
p
;

217 
ä“Ën
 = 
»qËn
;

218 ià(
upd©e
) *update = 0;

219 
p
 = 
	`zm­LookupRaw
(
zm
,
key
,
kËn
,&
zmËn
);

220 ià(
p
 =ğ
NULL
) {

222 
zm
 = 
	`zm­Resize
(zm, 
zmËn
+
»qËn
);

223 
p
 = 
zm
+
zmËn
-1;

224 
zmËn
 = zmËn+
»qËn
;

227 ià(
zm
[0] < 
ZIPMAP_BIGLEN
) zm[0]++;

231 ià(
upd©e
) *update = 1;

232 
ä“Ën
 = 
	`zm­RawEÁryL’gth
(
p
);

233 ià(
ä“Ën
 < 
»qËn
) {

237 
off£t
 = 
p
-
zm
;

238 
zm
 = 
	`zm­Resize
(zm, 
zmËn
-
ä“Ën
+
»qËn
);

239 
p
 = 
zm
+
off£t
;

243 
	`memmove
(
p
+
»qËn
,…+
ä“Ën
, 
zmËn
-(
off£t
+freelen+1));

244 
zmËn
 = zmËn-
ä“Ën
+
»qËn
;

245 
ä“Ën
 = 
»qËn
;

253 
em±y
 = 
ä“Ën
-
»qËn
;

254 ià(
em±y
 >ğ
ZIPMAP_VALUE_MAX_FREE
) {

257 
off£t
 = 
p
-
zm
;

258 
	`memmove
(
p
+
»qËn
,…+
ä“Ën
, 
zmËn
-(
off£t
+freelen+1));

259 
zmËn
 -ğ
em±y
;

260 
zm
 = 
	`zm­Resize
(zm, 
zmËn
);

261 
p
 = 
zm
+
off£t
;

262 
vem±y
 = 0;

264 
vem±y
 = 
em±y
;

269 
p
 +ğ
	`zm­EncodeL’gth
Õ,
kËn
);

270 
	`memıy
(
p
,
key
,
kËn
);

271 
p
 +ğ
kËn
;

273 
p
 +ğ
	`zm­EncodeL’gth
Õ,
vËn
);

274 *
p
++ = 
vem±y
;

275 
	`memıy
(
p
,
v®
,
vËn
);

276  
zm
;

277 
	}
}

281 *
	$zm­D–
(*
zm
, *
key
, 
kËn
, *
d–‘ed
) {

282 
zmËn
, 
ä“Ën
;

283 *
p
 = 
	`zm­LookupRaw
(
zm
,
key
,
kËn
,&
zmËn
);

284 ià(
p
) {

285 
ä“Ën
 = 
	`zm­RawEÁryL’gth
(
p
);

286 
	`memmove
(
p
,…+
ä“Ën
, 
zmËn
-(Õ-
zm
)+freelen+1));

287 
zm
 = 
	`zm­Resize
(zm, 
zmËn
-
ä“Ën
);

290 ià(
zm
[0] < 
ZIPMAP_BIGLEN
) zm[0]--;

292 ià(
d–‘ed
) *deleted = 1;

294 ià(
d–‘ed
) *deleted = 0;

296  
zm
;

297 
	}
}

300 *
	$zm­Rewšd
(*
zm
) {

301  
zm
+1;

302 
	}
}

315 *
	$zm­Next
(*
zm
, **
key
, *
kËn
, **
v®ue
, *
vËn
) {

316 ià(
zm
[0] =ğ
ZIPMAP_END
è 
NULL
;

317 ià(
key
) {

318 *
key
 = 
zm
;

319 *
kËn
 = 
	`zm­DecodeL’gth
(
zm
);

320 *
key
 +ğ
	`ZIPMAP_LEN_BYTES
(*
kËn
);

322 
zm
 +ğ
	`zm­RawKeyL’gth
(zm);

323 ià(
v®ue
) {

324 *
v®ue
 = 
zm
+1;

325 *
vËn
 = 
	`zm­DecodeL’gth
(
zm
);

326 *
v®ue
 +ğ
	`ZIPMAP_LEN_BYTES
(*
vËn
);

328 
zm
 +ğ
	`zm­RawV®ueL’gth
(zm);

329  
zm
;

330 
	}
}

334 
	$zm­G‘
(*
zm
, *
key
, 
kËn
, **
v®ue
, *
vËn
) {

335 *
p
;

337 ià((
p
 = 
	`zm­LookupRaw
(
zm
,
key
,
kËn
,
NULL
)) == NULL)  0;

338 
p
 +ğ
	`zm­RawKeyL’gth
(p);

339 *
vËn
 = 
	`zm­DecodeL’gth
(
p
);

340 *
v®ue
 = 
p
 + 
	`ZIPMAP_LEN_BYTES
(*
vËn
) + 1;

342 
	}
}

345 
	$zm­Exi¡s
(*
zm
, *
key
, 
kËn
) {

346  
	`zm­LookupRaw
(
zm
,
key
,
kËn
,
NULL
) != NULL;

347 
	}
}

350 
	$zm­L’
(*
zm
) {

351 
Ën
 = 0;

352 ià(
zm
[0] < 
ZIPMAP_BIGLEN
) {

353 
Ën
 = 
zm
[0];

355 *
p
 = 
	`zm­Rewšd
(
zm
);

356 (
p
 = 
	`zm­Next
Õ,
NULL
,NULL,NULL,NULL)è!ğNULLè
Ën
++;

359 ià(
Ën
 < 
ZIPMAP_BIGLEN
è
zm
[0] =†en;

361  
Ën
;

362 
	}
}

367 
size_t
 
	$zm­BlobL’
(*
zm
) {

368 
tÙËn
;

369 
	`zm­LookupRaw
(
zm
,
NULL
,0,&
tÙËn
);

370  
tÙËn
;

371 
	}
}

373 #ifdeà
REDIS_TEST


374 
	$zm­R•r
(*
p
) {

375 
l
;

377 
	`´štf
("{¡©u %u}",*
p
++);

379 ià(
p
[0] =ğ
ZIPMAP_END
) {

380 
	`´štf
("{end}");

383 
e
;

385 
l
 = 
	`zm­DecodeL’gth
(
p
);

386 
	`´štf
("{key %u}",
l
);

387 
p
 +ğ
	`zm­EncodeL’gth
(
NULL
,
l
);

388 ià(
l
 !ğ0 && 
	`fwr™e
(
p
,l,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

389 
p
 +ğ
l
;

391 
l
 = 
	`zm­DecodeL’gth
(
p
);

392 
	`´štf
("{v®u%u}",
l
);

393 
p
 +ğ
	`zm­EncodeL’gth
(
NULL
,
l
);

394 
e
 = *
p
++;

395 ià(
l
 !ğ0 && 
	`fwr™e
(
p
,l,1,
¡dout
è=ğ0è
	`³¼Ü
("fwrite");

396 
p
 +ğ
l
+
e
;

397 ià(
e
) {

398 
	`´štf
("[");

399 
e
--è
	`´štf
(".");

400 
	`´štf
("]");

404 
	`´štf
("\n");

405 
	}
}

407 
	#UNUSED
(
x
è()(x)

	)

408 
	$zm­Te¡
(
¬gc
, *
¬gv
[]) {

409 *
zm
;

411 
	`UNUSED
(
¬gc
);

412 
	`UNUSED
(
¬gv
);

414 
zm
 = 
	`zm­New
();

416 
zm
 = 
	`zm­S‘
(zm,(*è"Çme",4, (*è"foo",3,
NULL
);

417 
zm
 = 
	`zm­S‘
(zm,(*è"suºame",7, (*è"foo",3,
NULL
);

418 
zm
 = 
	`zm­S‘
(zm,(*è"age",3, (*è"foo",3,
NULL
);

419 
	`zm­R•r
(
zm
);

421 
zm
 = 
	`zm­S‘
(zm,(*è"h–lo",5, (*è"wÜld!",6,
NULL
);

422 
zm
 = 
	`zm­S‘
(zm,(*è"foo",3, (*è"b¬",3,
NULL
);

423 
zm
 = 
	`zm­S‘
(zm,(*è"foo",3, (*è"!",1,
NULL
);

424 
	`zm­R•r
(
zm
);

425 
zm
 = 
	`zm­S‘
(zm,(*è"foo",3, (*è"12345",5,
NULL
);

426 
	`zm­R•r
(
zm
);

427 
zm
 = 
	`zm­S‘
(zm,(*è"Ãw",3, (*è"xx",2,
NULL
);

428 
zm
 = 
	`zm­S‘
(zm,(*è"nov®",5, (*è"",0,
NULL
);

429 
	`zm­R•r
(
zm
);

430 
zm
 = 
	`zm­D–
(zm,(*è"Ãw",3,
NULL
);

431 
	`zm­R•r
(
zm
);

433 
	`´štf
("\nLook up†arge key:\n");

435 
buf
[512];

436 *
v®ue
;

437 
vËn
, 
i
;

438 
i
 = 0; i < 512; i++è
buf
[i] = 'a';

440 
zm
 = 
	`zm­S‘
(zm,
buf
,512,(*è"lÚg",4,
NULL
);

441 ià(
	`zm­G‘
(
zm
,
buf
,512,&
v®ue
,&
vËn
)) {

442 
	`´štf
(" <long key> is‡ssociatedohe %d bytes value: %.*s\n",

443 
vËn
, vËn, 
v®ue
);

447 
	`´štf
("\nPerform‡ direct†ookup:\n");

449 *
v®ue
;

450 
vËn
;

452 ià(
	`zm­G‘
(
zm
,(*è"foo",3,&
v®ue
,&
vËn
)) {

453 
	`´štf
(" foo is‡ssociatedohe %d bytes value: %.*s\n",

454 
vËn
, vËn, 
v®ue
);

457 
	`´štf
("\nIteratehroughƒlements:\n");

459 *
i
 = 
	`zm­Rewšd
(
zm
);

460 *
key
, *
v®ue
;

461 
kËn
, 
vËn
;

463 (
i
 = 
	`zm­Next
(i,&
key
,&
kËn
,&
v®ue
,&
vËn
)è!ğ
NULL
) {

464 
	`´štf
(" %d:%.* => %d:%.*s\n", 
kËn
, kËn, 
key
, 
vËn
, vËn, 
v®ue
);

468 
	}
}

	@zipmap.h

35 #iâdeà
_ZIPMAP_H


36 
	#_ZIPMAP_H


	)

38 *
zm­New
();

39 *
zm­S‘
(*
zm
, *
key
, 
kËn
, *
v®
, 
vËn
, *
upd©e
);

40 *
zm­D–
(*
zm
, *
key
, 
kËn
, *
d–‘ed
);

41 *
zm­Rewšd
(*
zm
);

42 *
zm­Next
(*
zm
, **
key
, *
kËn
, **
v®ue
, *
vËn
);

43 
zm­G‘
(*
zm
, *
key
, 
kËn
, **
v®ue
, *
vËn
);

44 
zm­Exi¡s
(*
zm
, *
key
, 
kËn
);

45 
zm­L’
(*
zm
);

46 
size_t
 
zm­BlobL’
(*
zm
);

47 
zm­R•r
(*
p
);

49 #ifdeà
REDIS_TEST


50 
zm­Te¡
(
¬gc
, *
¬gv
[]);

	@zmalloc.c

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

38 
	$zlibc_ä“
(*
±r
) {

39 
	`ä“
(
±r
);

40 
	}
}

42 
	~<¡ršg.h
>

43 
	~<±h»ad.h
>

44 
	~"cÚfig.h
"

45 
	~"zm®loc.h
"

46 
	~"©omicv¬.h
"

48 #ifdeà
HAVE_MALLOC_SIZE


49 
	#PREFIX_SIZE
 (0)

	)

51 #ià
defšed
(
__sun
è|| defšed(
__¥¬c
è|| defšed(
__¥¬c__
)

52 
	#PREFIX_SIZE
 (())

	)

54 
	#PREFIX_SIZE
 ((
size_t
))

	)

59 #ià
defšed
(
USE_TCMALLOC
)

60 
	#m®loc
(
size
è
	`tc_m®loc
(size)

	)

61 
	#ÿÎoc
(
couÁ
,
size
è
	`tc_ÿÎoc
(couÁ,size)

	)

62 
	#»®loc
(
±r
,
size
è
	`tc_»®loc
ÕŒ,size)

	)

63 
	#ä“
(
±r
è
	`tc_ä“
ÕŒ)

	)

64 #–ià
defšed
(
USE_JEMALLOC
)

65 
	#m®loc
(
size
è
	`je_m®loc
(size)

	)

66 
	#ÿÎoc
(
couÁ
,
size
è
	`je_ÿÎoc
(couÁ,size)

	)

67 
	#»®loc
(
±r
,
size
è
	`je_»®loc
ÕŒ,size)

	)

68 
	#ä“
(
±r
è
	`je_ä“
ÕŒ)

	)

71 
	#upd©e_zm®loc_¡©_®loc
(
__n
) do { \

72 
size_t
 
_n
 = (
__n
); \

73 ià(
_n
&(()-1)) _n += ()-(_n&(()-1)); \

74 ià(
zm®loc_th»ad_§ã
) { \

75 
	`©omicInü
(
u£d_memÜy
,
__n
,
u£d_memÜy_mu‹x
); \

77 
u£d_memÜy
 +ğ
_n
; \

79 } 0)

	)

81 
	#upd©e_zm®loc_¡©_ä“
(
__n
) do { \

82 
size_t
 
_n
 = (
__n
); \

83 ià(
_n
&(()-1)) _n += ()-(_n&(()-1)); \

84 ià(
zm®loc_th»ad_§ã
) { \

85 
	`©omicDeü
(
u£d_memÜy
,
__n
,
u£d_memÜy_mu‹x
); \

87 
u£d_memÜy
 -ğ
_n
; \

89 } 0)

	)

91 
size_t
 
	gu£d_memÜy
 = 0;

92 
	gzm®loc_th»ad_§ã
 = 0;

93 
±h»ad_mu‹x_t
 
	gu£d_memÜy_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

95 
	$zm®loc_deçuÉ_oom
(
size_t
 
size
) {

96 
	`årštf
(
¡d”r
, "zmalloc: Out of memoryryingo‡llocate %zu bytes\n",

97 
size
);

98 
	`fæush
(
¡d”r
);

99 
	`abÜt
();

100 
	}
}

102 (*
zm®loc_oom_hªdËr
)(
size_t
èğ
zm®loc_deçuÉ_oom
;

104 *
	$zm®loc
(
size_t
 
size
) {

105 *
±r
 = 
	`m®loc
(
size
+
PREFIX_SIZE
);

107 ià(!
±r
è
	`zm®loc_oom_hªdËr
(
size
);

108 #ifdeà
HAVE_MALLOC_SIZE


109 
	`upd©e_zm®loc_¡©_®loc
(
	`zm®loc_size
(
±r
));

110  
±r
;

112 *((
size_t
*)
±r
èğ
size
;

113 
	`upd©e_zm®loc_¡©_®loc
(
size
+
PREFIX_SIZE
);

114  (*)
±r
+
PREFIX_SIZE
;

116 
	}
}

118 *
	$zÿÎoc
(
size_t
 
size
) {

119 *
±r
 = 
	`ÿÎoc
(1, 
size
+
PREFIX_SIZE
);

121 ià(!
±r
è
	`zm®loc_oom_hªdËr
(
size
);

122 #ifdeà
HAVE_MALLOC_SIZE


123 
	`upd©e_zm®loc_¡©_®loc
(
	`zm®loc_size
(
±r
));

124  
±r
;

126 *((
size_t
*)
±r
èğ
size
;

127 
	`upd©e_zm®loc_¡©_®loc
(
size
+
PREFIX_SIZE
);

128  (*)
±r
+
PREFIX_SIZE
;

130 
	}
}

132 *
	$z»®loc
(*
±r
, 
size_t
 
size
) {

133 #iâdeà
HAVE_MALLOC_SIZE


134 *
»®±r
;

136 
size_t
 
Şdsize
;

137 *
Ãw±r
;

139 ià(
±r
 =ğ
NULL
è 
	`zm®loc
(
size
);

140 #ifdeà
HAVE_MALLOC_SIZE


141 
Şdsize
 = 
	`zm®loc_size
(
±r
);

142 
Ãw±r
 = 
	`»®loc
(
±r
,
size
);

143 ià(!
Ãw±r
è
	`zm®loc_oom_hªdËr
(
size
);

145 
	`upd©e_zm®loc_¡©_ä“
(
Şdsize
);

146 
	`upd©e_zm®loc_¡©_®loc
(
	`zm®loc_size
(
Ãw±r
));

147  
Ãw±r
;

149 
»®±r
 = (*)
±r
-
PREFIX_SIZE
;

150 
Şdsize
 = *((
size_t
*)
»®±r
);

151 
Ãw±r
 = 
	`»®loc
(
»®±r
,
size
+
PREFIX_SIZE
);

152 ià(!
Ãw±r
è
	`zm®loc_oom_hªdËr
(
size
);

154 *((
size_t
*)
Ãw±r
èğ
size
;

155 
	`upd©e_zm®loc_¡©_ä“
(
Şdsize
);

156 
	`upd©e_zm®loc_¡©_®loc
(
size
);

157  (*)
Ãw±r
+
PREFIX_SIZE
;

159 
	}
}

164 #iâdeà
HAVE_MALLOC_SIZE


165 
size_t
 
	$zm®loc_size
(*
±r
) {

166 *
»®±r
 = (*)
±r
-
PREFIX_SIZE
;

167 
size_t
 
size
 = *((size_t*)
»®±r
);

170 ià(
size
&(()-1)) size += ()-(size&(()-1));

171  
size
+
PREFIX_SIZE
;

172 
	}
}

175 
	$zä“
(*
±r
) {

176 #iâdeà
HAVE_MALLOC_SIZE


177 *
»®±r
;

178 
size_t
 
Şdsize
;

181 ià(
±r
 =ğ
NULL
) ;

182 #ifdeà
HAVE_MALLOC_SIZE


183 
	`upd©e_zm®loc_¡©_ä“
(
	`zm®loc_size
(
±r
));

184 
	`ä“
(
±r
);

186 
»®±r
 = (*)
±r
-
PREFIX_SIZE
;

187 
Şdsize
 = *((
size_t
*)
»®±r
);

188 
	`upd©e_zm®loc_¡©_ä“
(
Şdsize
+
PREFIX_SIZE
);

189 
	`ä“
(
»®±r
);

191 
	}
}

193 *
	$z¡rdup
(cÚ¡ *
s
) {

194 
size_t
 
l
 = 
	`¡¾’
(
s
)+1;

195 *
p
 = 
	`zm®loc
(
l
);

197 
	`memıy
(
p
,
s
,
l
);

198  
p
;

199 
	}
}

201 
size_t
 
	$zm®loc_u£d_memÜy
() {

202 
size_t
 
um
;

204 ià(
zm®loc_th»ad_§ã
) {

205 
	`©omicG‘
(
u£d_memÜy
,
um
,
u£d_memÜy_mu‹x
);

207 
um
 = 
u£d_memÜy
;

209  
um
;

210 
	}
}

212 
	$zm®loc_’abË_th»ad_§ãÃss
() {

213 
zm®loc_th»ad_§ã
 = 1;

214 
	}
}

216 
zm®loc_£t_oom_hªdËr
((*
oom_hªdËr
)(
size_t
)) {

217 
zm®loc_oom_hªdËr
 = 
oom_hªdËr
;

218 
	}
}

230 #ià
defšed
(
HAVE_PROC_STAT
)

231 
	~<uni¡d.h
>

232 
	~<sys/ty³s.h
>

233 
	~<sys/¡©.h
>

234 
	~<fú.h
>

236 
size_t
 
	$zm®loc_g‘_rss
() {

237 
·ge
 = 
	`syscÚf
(
_SC_PAGESIZE
);

238 
size_t
 
rss
;

239 
buf
[4096];

240 
f’ame
[256];

241 
fd
, 
couÁ
;

242 *
p
, *
x
;

244 
	`¢´štf
(
f’ame
,256,"/´oc/%d/¡©",
	`g‘pid
());

245 ià((
fd
 = 
	`İ’
(
f’ame
,
O_RDONLY
)) == -1)  0;

246 ià(
	`»ad
(
fd
,
buf
,4096) <= 0) {

247 
	`şo£
(
fd
);

250 
	`şo£
(
fd
);

252 
p
 = 
buf
;

253 
couÁ
 = 23;

254 
p
 && 
couÁ
--) {

255 
p
 = 
	`¡rchr
(p,' ');

256 ià(
p
)…++;

258 ià(!
p
)  0;

259 
x
 = 
	`¡rchr
(
p
,' ');

260 ià(!
x
)  0;

261 *
x
 = '\0';

263 
rss
 = 
	`¡¹Şl
(
p
,
NULL
,10);

264 
rss
 *ğ
·ge
;

265  
rss
;

266 
	}
}

267 #–ià
defšed
(
HAVE_TASKINFO
)

268 
	~<uni¡d.h
>

269 
	~<¡dio.h
>

270 
	~<¡dlib.h
>

271 
	~<sys/ty³s.h
>

272 
	~<sys/sysùl.h
>

273 
	~<mach/sk.h
>

274 
	~<mach/mach_š™.h
>

276 
size_t
 
	$zm®loc_g‘_rss
() {

277 
sk_t
 
sk
 = 
MACH_PORT_NULL
;

278 
sk_basic_šfo
 
t_šfo
;

279 
mach_msg_ty³_numb”_t
 
t_šfo_couÁ
 = 
TASK_BASIC_INFO_COUNT
;

281 ià(
	`sk_fÜ_pid
(
	`cu¼’t_sk
(), 
	`g‘pid
(), &
sk
è!ğ
KERN_SUCCESS
)

283 
	`sk_šfo
(
sk
, 
TASK_BASIC_INFO
, (
sk_šfo_t
)&
t_šfo
, &
t_šfo_couÁ
);

285  
t_šfo
.
»sid’t_size
;

286 
	}
}

288 
size_t
 
	$zm®loc_g‘_rss
() {

294  
	`zm®loc_u£d_memÜy
();

295 
	}
}

299 
	$zm®loc_g‘_äagm’tiÚ_¿tio
(
size_t
 
rss
) {

300  ()
rss
/
	`zm®loc_u£d_memÜy
();

301 
	}
}

313 #ià
defšed
(
HAVE_PROC_SMAPS
)

314 
size_t
 
	$zm®loc_g‘_sm­_by‹s_by_f›ld
(*
f›ld
, 
pid
) {

315 
lše
[1024];

316 
size_t
 
by‹s
 = 0;

317 
æ’
 = 
	`¡¾’
(
f›ld
);

318 
FILE
 *
å
;

320 ià(
pid
 == -1) {

321 
å
 = 
	`fİ’
("/proc/self/smaps","r");

323 
f’ame
[128];

324 
	`¢´štf
(
f’ame
,(f’ame),"/´oc/%ld/sm­s",
pid
);

325 
å
 = 
	`fİ’
(
f’ame
,"r");

328 ià(!
å
)  0;

329 
	`fg‘s
(
lše
,Öše),
å
è!ğ
NULL
) {

330 ià(
	`¡ºcmp
(
lše
,
f›ld
,
æ’
) == 0) {

331 *
p
 = 
	`¡rchr
(
lše
,'k');

332 ià(
p
) {

333 *
p
 = '\0';

334 
by‹s
 +ğ
	`¡¹Ş
(
lše
+
æ’
,
NULL
,10) * 1024;

338 
	`fşo£
(
å
);

339  
by‹s
;

340 
	}
}

342 
size_t
 
	$zm®loc_g‘_sm­_by‹s_by_f›ld
(*
f›ld
, 
pid
) {

343 ((è
f›ld
);

344 ((è
pid
);

346 
	}
}

349 
size_t
 
	$zm®loc_g‘_´iv©e_dœty
(
pid
) {

350  
	`zm®loc_g‘_sm­_by‹s_by_f›ld
("Priv©e_Dœty:",
pid
);

351 
	}
}

366 
size_t
 
	$zm®loc_g‘_memÜy_size
() {

367 #ià
	`defšed
(
__unix__
è|| defšed(
__unix
è|| defšed(
unix
) || \

368 (
	`defšed
(
__APPLE__
è&& defšed(
__MACH__
))

369 #ià
	`defšed
(
CTL_HW
è&& (defšed(
HW_MEMSIZE
è|| defšed(
HW_PHYSMEM64
))

370 
mib
[2];

371 
mib
[0] = 
CTL_HW
;

372 #ià
	`defšed
(
HW_MEMSIZE
)

373 
mib
[1] = 
HW_MEMSIZE
;

374 #–ià
	`defšed
(
HW_PHYSMEM64
)

375 
mib
[1] = 
HW_PHYSMEM64
;

377 
št64_t
 
size
 = 0;

378 
size_t
 
Ën
 = (
size
);

379 ià(
	`sysùl
Ğ
mib
, 2, &
size
, &
Ën
, 
NULL
, 0) == 0)

380  (
size_t
)
size
;

383 #–ià
	`defšed
(
_SC_PHYS_PAGES
è&& defšed(
_SC_PAGESIZE
)

385  (
size_t
)
	`syscÚf
(
_SC_PHYS_PAGES
è* (size_t)syscÚf(
_SC_PAGESIZE
);

387 #–ià
	`defšed
(
CTL_HW
è&& (defšed(
HW_PHYSMEM
è|| defšed(
HW_REALMEM
))

389 
mib
[2];

390 
mib
[0] = 
CTL_HW
;

391 #ià
	`defšed
(
HW_REALMEM
)

392 
mib
[1] = 
HW_REALMEM
;

393 #–ià
	`defšed
(
HW_PYSMEM
)

394 
mib
[1] = 
HW_PHYSMEM
;

396 
size
 = 0;

397 
size_t
 
Ën
 = (
size
);

398 ià(
	`sysùl
(
mib
, 2, &
size
, &
Ën
, 
NULL
, 0) == 0)

399  (
size_t
)
size
;

406 
	}
}

	@zmalloc.h

31 #iâdeà
__ZMALLOC_H


32 
	#__ZMALLOC_H


	)

35 
	#__x¡r
(
s
è
	`__¡r
(s)

	)

36 
	#__¡r
(
s
è#s

	)

38 #ià
defšed
(
USE_TCMALLOC
)

39 
	#ZMALLOC_LIB
 ("tcm®loc-" 
	`__x¡r
(
TC_VERSION_MAJOR
è"." __x¡r(
TC_VERSION_MINOR
))

	)

40 
	~<googË/tcm®loc.h
>

41 #ià(
TC_VERSION_MAJOR
 =ğ1 && 
TC_VERSION_MINOR
 >= 6) || (TC_VERSION_MAJOR > 1)

42 
	#HAVE_MALLOC_SIZE
 1

	)

43 
	#zm®loc_size
(
p
è
	`tc_m®loc_size
Õ)

	)

48 #–ià
defšed
(
USE_JEMALLOC
)

49 
	#ZMALLOC_LIB
 ("jem®loc-" 
	`__x¡r
(
JEMALLOC_VERSION_MAJOR
è"." __x¡r(
JEMALLOC_VERSION_MINOR
è"." __x¡r(
JEMALLOC_VERSION_BUGFIX
))

	)

50 
	~<jem®loc/jem®loc.h
>

51 #ià(
JEMALLOC_VERSION_MAJOR
 =ğ2 && 
JEMALLOC_VERSION_MINOR
 >= 1) || (JEMALLOC_VERSION_MAJOR > 2)

52 
	#HAVE_MALLOC_SIZE
 1

	)

53 
	#zm®loc_size
(
p
è
	`je_m®loc_u§bË_size
Õ)

	)

58 #–ià
defšed
(
__APPLE__
)

59 
	~<m®loc/m®loc.h
>

60 
	#HAVE_MALLOC_SIZE
 1

	)

61 
	#zm®loc_size
(
p
è
	`m®loc_size
Õ)

	)

64 #iâdeà
ZMALLOC_LIB


65 
	#ZMALLOC_LIB
 "libc"

	)

68 *
zm®loc
(
size_t
 
size
);

69 *
zÿÎoc
(
size_t
 
size
);

70 *
z»®loc
(*
±r
, 
size_t
 
size
);

71 
zä“
(*
±r
);

72 *
z¡rdup
(cÚ¡ *
s
);

73 
size_t
 
zm®loc_u£d_memÜy
();

74 
zm®loc_’abË_th»ad_§ãÃss
();

75 
zm®loc_£t_oom_hªdËr
((*
oom_hªdËr
)(
size_t
));

76 
	`zm®loc_g‘_äagm’tiÚ_¿tio
(
size_t
 
rss
);

77 
size_t
 
	`zm®loc_g‘_rss
();

78 
size_t
 
	`zm®loc_g‘_´iv©e_dœty
(
pid
);

79 
size_t
 
	`zm®loc_g‘_sm­_by‹s_by_f›ld
(*
f›ld
, 
pid
);

80 
size_t
 
	`zm®loc_g‘_memÜy_size
();

81 
	`zlibc_ä“
(*
±r
);

83 #iâdeà
HAVE_MALLOC_SIZE


84 
size_t
 
	`zm®loc_size
(*
±r
);

	@/usr/include/arpa/inet.h

18 #iâdeà
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<Ãtš‘/š.h
>

25 #iâdeà
__sockËn_t_defšed


26 
__sockËn_t
 
	tsockËn_t
;

27 
	#__sockËn_t_defšed


	)

30 
__BEGIN_DECLS


34 
š_addr_t
 
	$š‘_addr
 (cÚ¡ *
__ı
è
__THROW
;

37 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

41 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

42 
__THROW
;

45 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

49 
š_addr_t
 
	$š‘_ÃtwÜk
 (cÚ¡ *
__ı
è
__THROW
;

53 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

58 
	$š‘_±Ú
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

59 *
__»¡riù
 
__buf
è
__THROW
;

64 cÚ¡ *
	$š‘_Áİ
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

65 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

66 
__THROW
;

70 #ifdeà
__USE_MISC


73 
	$š‘_©Ú
 (cÚ¡ *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

77 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

82 *
	$š‘_Ãt_Áİ
 (
__af
, cÚ¡ *
__ı
, 
__b™s
,

83 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

88 
	$š‘_Ãt_±Ú
 (
__af
, cÚ¡ *
__ı
,

89 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

94 
	$š‘_n§p_addr
 (cÚ¡ *
__ı
,

95 *
__buf
, 
__Ën
è
__THROW
;

99 *
	$š‘_n§p_Áß
 (
__Ën
, cÚ¡ *
__ı
,

100 *
__buf
è
__THROW
;

103 
__END_DECLS


	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 
__BEGIN_DECLS


67 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

68 
__lše
, cÚ¡ *
__funùiÚ
)

69 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

72 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

73 
__lše
, cÚ¡ *
__funùiÚ
)

74 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

79 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

80 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

83 
__END_DECLS


85 
	#as£¹
(
ex´
) \

86 ((
ex´
) \

87 ? 
	`__ASSERT_VOID_CAST
 (0) \

88 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

90 #ifdef 
__USE_GNU


91 
	#as£¹_³¼Ü
(
”ºum
) \

92 (!(
”ºum
) \

93 ? 
	`__ASSERT_VOID_CAST
 (0) \

94 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

102 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

103 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

105 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

106 
	#__ASSERT_FUNCTION
 
__func__


	)

108 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

115 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


116 #undeà
¡©ic_as£¹


117 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tŞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tŞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tŞow”
 (
__c
))

217  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


228 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


295 
	#__tŞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ifdeà
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ifdeà
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/dlfcn.h

19 #iâdef 
_DLFCN_H


20 
	#_DLFCN_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

27 
	~<b™s/dlfú.h
>

30 #ifdeà
__USE_GNU


35 
	#RTLD_NEXT
 ((*è-1l)

	)

40 
	#RTLD_DEFAULT
 ((*è0)

	)

44 
	tLmid_t
;

47 
	#LM_ID_BASE
 0

	)

48 
	#LM_ID_NEWLM
 -1

	)

52 
__BEGIN_DECLS


56 *
	$dlİ’
 (cÚ¡ *
__fe
, 
__mode
è
__THROWNL
;

60 
	$dlşo£
 (*
__hªdË
è
__THROWNL
 
	`__nÚnuÎ
 ((1));

64 *
	$dlsym
 (*
__»¡riù
 
__hªdË
,

65 cÚ¡ *
__»¡riù
 
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((2));

67 #ifdeà
__USE_GNU


69 *
	$dlmİ’
 (
Lmid_t
 
__nsid
, cÚ¡ *
__fe
, 
__mode
è
__THROWNL
;

73 *
	$dlvsym
 (*
__»¡riù
 
__hªdË
,

74 cÚ¡ *
__»¡riù
 
__Çme
,

75 cÚ¡ *
__»¡riù
 
__v”siÚ
)

76 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

82 *
	$dË¼Ü
 (è
__THROW
;

85 #ifdeà
__USE_GNU


90 cÚ¡ *
dli_âame
;

91 *
dli_fba£
;

92 cÚ¡ *
dli_¢ame
;

93 *
dli_§ddr
;

94 } 
	tDl_šfo
;

98 
	$dÏddr
 (cÚ¡ *
__add»ss
, 
Dl_šfo
 *
__šfo
)

99 
__THROW
 
	`__nÚnuÎ
 ((2));

102 
	$dÏddr1
 (cÚ¡ *
__add»ss
, 
Dl_šfo
 *
__šfo
,

103 **
__exŒa_šfo
, 
__æags
è
__THROW
 
	`__nÚnuÎ
 ((2));

111 
RTLD_DL_SYMENT
 = 1,

114 
RTLD_DL_LINKMAP
 = 2

123 
	$dlšfo
 (*
__»¡riù
 
__hªdË
,

124 
__»que¡
, *
__»¡riù
 
__¬g
)

125 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

131 
RTLD_DI_LMID
 = 1,

135 
RTLD_DI_LINKMAP
 = 2,

137 
RTLD_DI_CONFIGADDR
 = 3,

144 
RTLD_DI_SERINFO
 = 4,

145 
RTLD_DI_SERINFOSIZE
 = 5,

149 
RTLD_DI_ORIGIN
 = 6,

151 
RTLD_DI_PROFILENAME
 = 7,

152 
RTLD_DI_PROFILEOUT
 = 8,

157 
RTLD_DI_TLS_MODID
 = 9,

163 
RTLD_DI_TLS_DATA
 = 10,

165 
RTLD_DI_MAX
 = 10

173 *
dls_Çme
;

174 
dls_æags
;

175 } 
	tDl_£½©h
;

181 
size_t
 
dls_size
;

182 
dls_út
;

183 
Dl_£½©h
 
dls_£½©h
[1];

184 } 
	tDl_£ršfo
;

188 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htŞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/errno.h

22 #iâdef 
_ERRNO_H


26 #iâdef 
__Ãed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


35 
	~<b™s/”ºo.h
>

36 #undeà
__Ãed_Em©h


38 #ifdef 
_ERRNO_H


45 #iâdef 
”ºo


46 
”ºo
;

49 #ifdeà
__USE_GNU


54 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

58 
	g__END_DECLS


66 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


67 #iâdeà
__”rÜ_t_defšed


68 
	t”rÜ_t
;

69 
	#__”rÜ_t_defšed
 1

	)

71 #undeà
__Ãed_”rÜ_t


	@/usr/include/execinfo.h

18 #iâdeà
_EXECINFO_H


19 
	#_EXECINFO_H
 1

	)

21 
	~<ã©u»s.h
>

23 
__BEGIN_DECLS


27 
	$backŒaû
 (**
__¬¿y
, 
__size
è
	`__nÚnuÎ
 ((1));

32 **
	$backŒaû_symbŞs
 (*cÚ¡ *
__¬¿y
, 
__size
)

33 
__THROW
 
	`__nÚnuÎ
 ((1));

38 
	$backŒaû_symbŞs_fd
 (*cÚ¡ *
__¬¿y
, 
__size
, 
__fd
)

39 
__THROW
 
	`__nÚnuÎ
 ((1));

41 
__END_DECLS


	@/usr/include/fcntl.h

22 #iâdef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

35 
	~<b™s/fú.h
>

39 #ifdeà
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oæag
) \

41 (((
oæag
è& 
O_CREAT
è!ğ0 || ((oæagè& 
__O_TMPFILE
è=ğ__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oæag
è(((oæagè& 
O_CREAT
è!ğ0)

	)

49 #iâdeà
__mode_t_defšed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_defšed


	)

54 #iâdeà
__off_t_defšed


55 #iâdeà
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

68 #iâdeà
__pid_t_defšed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_defšed


	)

74 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


75 
	#__Ãed_time¥ec


	)

76 
	~<time.h
>

77 
	~<b™s/¡©.h
>

79 
	#S_IFMT
 
__S_IFMT


	)

80 
	#S_IFDIR
 
__S_IFDIR


	)

81 
	#S_IFCHR
 
__S_IFCHR


	)

82 
	#S_IFBLK
 
__S_IFBLK


	)

83 
	#S_IFREG
 
__S_IFREG


	)

84 #ifdeà
__S_IFIFO


85 
	#S_IFIFO
 
__S_IFIFO


	)

87 #ifdeà
__S_IFLNK


88 
	#S_IFLNK
 
__S_IFLNK


	)

90 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


91 
	#S_IFSOCK
 
__S_IFSOCK


	)

96 
	#S_ISUID
 
__S_ISUID


	)

97 
	#S_ISGID
 
__S_ISGID


	)

99 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


101 
	#S_ISVTX
 
__S_ISVTX


	)

104 
	#S_IRUSR
 
__S_IREAD


	)

105 
	#S_IWUSR
 
__S_IWRITE


	)

106 
	#S_IXUSR
 
__S_IEXEC


	)

108 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

110 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

111 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

112 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

114 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

116 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

117 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

118 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

120 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

123 #ifdef 
__USE_MISC


124 #iâdeà
R_OK


127 
	#R_OK
 4

	)

128 
	#W_OK
 2

	)

129 
	#X_OK
 1

	)

130 
	#F_OK
 0

	)

135 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


136 
	#SEEK_SET
 0

	)

137 
	#SEEK_CUR
 1

	)

138 
	#SEEK_END
 2

	)

147 #ifdeà
__USE_ATFILE


148 
	#AT_FDCWD
 -100

	)

151 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

152 
	#AT_REMOVEDIR
 0x200

	)

154 
	#AT_SYMLINK_FOLLOW
 0x400

	)

155 #ifdeà
__USE_GNU


156 
	#AT_NO_AUTOMOUNT
 0x800

	)

158 
	#AT_EMPTY_PATH
 0x1000

	)

160 
	#AT_EACCESS
 0x200

	)

169 
fú
 (
__fd
, 
__cmd
, ...);

178 #iâdeà
__USE_FILE_OFFSET64


179 
	$İ’
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

181 #ifdeà
__REDIRECT


182 
	`__REDIRECT
 (
İ’
, (cÚ¡ *
__fe
, 
__oæag
, ...), 
İ’64
)

183 
	`__nÚnuÎ
 ((1));

185 
	#İ’
 
İ’64


	)

188 #ifdeà
__USE_LARGEFILE64


189 
	$İ’64
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

192 #ifdeà
__USE_ATFILE


202 #iâdeà
__USE_FILE_OFFSET64


203 
	$İ’©
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

204 
	`__nÚnuÎ
 ((2));

206 #ifdeà
__REDIRECT


207 
	`__REDIRECT
 (
İ’©
, (
__fd
, cÚ¡ *
__fe
, 
__oæag
,

208 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

210 
	#İ’©
 
İ’©64


	)

213 #ifdeà
__USE_LARGEFILE64


214 
	$İ’©64
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

215 
	`__nÚnuÎ
 ((2));

224 #iâdeà
__USE_FILE_OFFSET64


225 
	$ü—t
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

227 #ifdeà
__REDIRECT


228 
	`__REDIRECT
 (
ü—t
, (cÚ¡ *
__fe
, 
mode_t
 
__mode
),

229 
ü—t64
è
	`__nÚnuÎ
 ((1));

231 
	#ü—t
 
ü—t64


	)

234 #ifdeà
__USE_LARGEFILE64


235 
	$ü—t64
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

238 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

239 && !
defšed
 
__USE_POSIX
))

248 
	#F_ULOCK
 0

	)

249 
	#F_LOCK
 1

	)

250 
	#F_TLOCK
 2

	)

251 
	#F_TEST
 3

	)

253 #iâdeà
__USE_FILE_OFFSET64


254 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Ën
);

256 #ifdeà
__REDIRECT


257 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

259 
	#lockf
 
lockf64


	)

262 #ifdeà
__USE_LARGEFILE64


263 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Ën
);

267 #ifdeà
__USE_XOPEN2K


270 #iâdeà
__USE_FILE_OFFSET64


271 
	$posix_çdvi£
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
,

272 
__advi£
è
__THROW
;

274 #ifdeà
__REDIRECT_NTH


275 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

276 
__off64_t
 
__Ën
, 
__advi£
),

277 
posix_çdvi£64
);

279 
	#posix_çdvi£
 
posix_çdvi£64


	)

282 #ifdeà
__USE_LARGEFILE64


283 
	$posix_çdvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
,

284 
__advi£
è
__THROW
;

292 #iâdeà
__USE_FILE_OFFSET64


293 
	`posix_çÎoÿ‹
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
);

295 #ifdeà
__REDIRECT


296 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

297 
__off64_t
 
__Ën
),

298 
posix_çÎoÿ‹64
);

300 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

303 #ifdeà
__USE_LARGEFILE64


304 
	`posix_çÎoÿ‹64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
);

310 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
 \

311 && 
defšed
 
__va_¬g_·ck_Ën


312 
	~<b™s/fú2.h
>

315 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #undeà
__USE_ISOC11


98 #undeà
__USE_ISOC99


99 #undeà
__USE_ISOC95


100 #undeà
__USE_ISOCXX11


101 #undeà
__USE_POSIX


102 #undeà
__USE_POSIX2


103 #undeà
__USE_POSIX199309


104 #undeà
__USE_POSIX199506


105 #undeà
__USE_XOPEN


106 #undeà
__USE_XOPEN_EXTENDED


107 #undeà
__USE_UNIX98


108 #undeà
__USE_XOPEN2K


109 #undeà
__USE_XOPEN2KXSI


110 #undeà
__USE_XOPEN2K8


111 #undeà
__USE_XOPEN2K8XSI


112 #undeà
__USE_LARGEFILE


113 #undeà
__USE_LARGEFILE64


114 #undeà
__USE_FILE_OFFSET64


115 #undeà
__USE_MISC


116 #undeà
__USE_ATFILE


117 #undeà
__USE_GNU


118 #undeà
__USE_REENTRANT


119 #undeà
__USE_FORTIFY_LEVEL


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

137 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

146 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

147 && !
defšed
 
	g_DEFAULT_SOURCE


149 #undeà
_DEFAULT_SOURCE


150 
	#_DEFAULT_SOURCE
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_ISOC11_SOURCE


160 
	#_ISOC11_SOURCE
 1

	)

161 #undeà
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #undeà
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #undeà
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #undeà
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #undeà
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #undeà
_DEFAULT_SOURCE


172 
	#_DEFAULT_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
))

184 #undeà
_DEFAULT_SOURCE


185 
	#_DEFAULT_SOURCE
 1

	)

189 #ià(
defšed
 
_ISOC11_SOURCE
 \

190 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

191 
	#__USE_ISOC11
 1

	)

195 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

196 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

197 
	#__USE_ISOC99
 1

	)

201 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

202 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

203 
	#__USE_ISOC95
 1

	)

210 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

211 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

212 
	#__USE_ISOCXX11
 1

	)

218 #ifdeà
_DEFAULT_SOURCE


219 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


220 
	#__USE_POSIX_IMPLICITLY
 1

	)

222 #undeà
_POSIX_SOURCE


223 
	#_POSIX_SOURCE
 1

	)

224 #undeà
_POSIX_C_SOURCE


225 
	#_POSIX_C_SOURCE
 200809L

	)

227 #ià((!
defšed
 
__STRICT_ANSI__
 \

228 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

229 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

230 
	#_POSIX_SOURCE
 1

	)

231 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

232 
	#_POSIX_C_SOURCE
 2

	)

233 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

234 
	#_POSIX_C_SOURCE
 199506L

	)

235 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

236 
	#_POSIX_C_SOURCE
 200112L

	)

238 
	#_POSIX_C_SOURCE
 200809L

	)

240 
	#__USE_POSIX_IMPLICITLY
 1

	)

243 #ià(
defšed
 
_POSIX_SOURCE
 \

244 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

245 || 
defšed
 
_XOPEN_SOURCE
)

246 
	#__USE_POSIX
 1

	)

249 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


250 
	#__USE_POSIX2
 1

	)

253 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

254 
	#__USE_POSIX199309
 1

	)

257 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

258 
	#__USE_POSIX199506
 1

	)

261 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

262 
	#__USE_XOPEN2K
 1

	)

263 #undeà
__USE_ISOC95


264 
	#__USE_ISOC95
 1

	)

265 #undeà
__USE_ISOC99


266 
	#__USE_ISOC99
 1

	)

269 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

270 
	#__USE_XOPEN2K8
 1

	)

271 #undeà
_ATFILE_SOURCE


272 
	#_ATFILE_SOURCE
 1

	)

275 #ifdef 
_XOPEN_SOURCE


276 
	#__USE_XOPEN
 1

	)

277 #ià(
_XOPEN_SOURCE
 - 0) >= 500

278 
	#__USE_XOPEN_EXTENDED
 1

	)

279 
	#__USE_UNIX98
 1

	)

280 #undeà
_LARGEFILE_SOURCE


281 
	#_LARGEFILE_SOURCE
 1

	)

282 #ià(
_XOPEN_SOURCE
 - 0) >= 600

283 #ià(
_XOPEN_SOURCE
 - 0) >= 700

284 
	#__USE_XOPEN2K8
 1

	)

285 
	#__USE_XOPEN2K8XSI
 1

	)

287 
	#__USE_XOPEN2K
 1

	)

288 
	#__USE_XOPEN2KXSI
 1

	)

289 #undeà
__USE_ISOC95


290 
	#__USE_ISOC95
 1

	)

291 #undeà
__USE_ISOC99


292 
	#__USE_ISOC99
 1

	)

295 #ifdeà
_XOPEN_SOURCE_EXTENDED


296 
	#__USE_XOPEN_EXTENDED
 1

	)

301 #ifdeà
_LARGEFILE_SOURCE


302 
	#__USE_LARGEFILE
 1

	)

305 #ifdeà
_LARGEFILE64_SOURCE


306 
	#__USE_LARGEFILE64
 1

	)

309 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

310 
	#__USE_FILE_OFFSET64
 1

	)

313 #ià
defšed
 
_DEFAULT_SOURCE


314 
	#__USE_MISC
 1

	)

317 #ifdef 
_ATFILE_SOURCE


318 
	#__USE_ATFILE
 1

	)

321 #ifdef 
_GNU_SOURCE


322 
	#__USE_GNU
 1

	)

325 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


326 
	#__USE_REENTRANT
 1

	)

329 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

330 #ià!
defšed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

331 #w¬nšg 
_FORTIFY_SOURCE
 
»quœes
 
compšg
 
w™h
 
İtimiz©iÚ
 (-
O
)

332 #–ià!
__GNUC_PREREQ
 (4, 1)

333 #w¬nšg 
_FORTIFY_SOURCE
 
»quœes
 
GCC
 4.1 
Ü
 
Ï‹r


334 #–ià
_FORTIFY_SOURCE
 > 1

335 
	#__USE_FORTIFY_LEVEL
 2

	)

337 
	#__USE_FORTIFY_LEVEL
 1

	)

340 #iâdeà
__USE_FORTIFY_LEVEL


341 
	#__USE_FORTIFY_LEVEL
 0

	)

346 
	~<¡dc-´edef.h
>

354 #undeà
__GNU_LIBRARY__


355 
	#__GNU_LIBRARY__
 6

	)

359 
	#__GLIBC__
 2

	)

360 
	#__GLIBC_MINOR__
 23

	)

362 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

363 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

366 #iâdeà
__ASSEMBLER__


367 #iâdeà
_SYS_CDEFS_H


368 
	~<sys/cdefs.h
>

373 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


374 
	#__USE_LARGEFILE
 1

	)

375 
	#__USE_LARGEFILE64
 1

	)

381 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

382 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

383 && 
defšed
 
	g__ex‹º_šlše


384 
	#__USE_EXTERN_INLINES
 1

	)

392 
	~<gnu/¡ubs.h
>

	@/usr/include/inttypes.h

22 #iâdeà
_INTTYPES_H


23 
	#_INTTYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<¡dšt.h
>

30 #iâdeà
____gwch¬_t_defšed


31 #ifdeà
__ılu¥lus


32 
	#__gwch¬_t
 
wch¬_t


	)

33 #–ià
defšed
 
__WCHAR_TYPE__


34 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

36 
	#__Ãed_wch¬_t


	)

37 
	~<¡ddef.h
>

38 
wch¬_t
 
	t__gwch¬_t
;

40 
	#____gwch¬_t_defšed
 1

	)

43 #ià
__WORDSIZE
 == 64

44 
	#__PRI64_PREFIX
 "l"

	)

45 
	#__PRIPTR_PREFIX
 "l"

	)

47 
	#__PRI64_PREFIX
 "Î"

	)

48 
	#__PRIPTR_PREFIX


	)

54 
	#PRId8
 "d"

	)

55 
	#PRId16
 "d"

	)

56 
	#PRId32
 "d"

	)

57 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

59 
	#PRIdLEAST8
 "d"

	)

60 
	#PRIdLEAST16
 "d"

	)

61 
	#PRIdLEAST32
 "d"

	)

62 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

64 
	#PRIdFAST8
 "d"

	)

65 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

66 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

67 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIi8
 "i"

	)

71 
	#PRIi16
 "i"

	)

72 
	#PRIi32
 "i"

	)

73 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

75 
	#PRIiLEAST8
 "i"

	)

76 
	#PRIiLEAST16
 "i"

	)

77 
	#PRIiLEAST32
 "i"

	)

78 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

80 
	#PRIiFAST8
 "i"

	)

81 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

82 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

83 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIo8
 "o"

	)

87 
	#PRIo16
 "o"

	)

88 
	#PRIo32
 "o"

	)

89 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

91 
	#PRIoLEAST8
 "o"

	)

92 
	#PRIoLEAST16
 "o"

	)

93 
	#PRIoLEAST32
 "o"

	)

94 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

96 
	#PRIoFAST8
 "o"

	)

97 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

98 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

99 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIu8
 "u"

	)

103 
	#PRIu16
 "u"

	)

104 
	#PRIu32
 "u"

	)

105 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

107 
	#PRIuLEAST8
 "u"

	)

108 
	#PRIuLEAST16
 "u"

	)

109 
	#PRIuLEAST32
 "u"

	)

110 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

112 
	#PRIuFAST8
 "u"

	)

113 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

114 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

115 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIx8
 "x"

	)

119 
	#PRIx16
 "x"

	)

120 
	#PRIx32
 "x"

	)

121 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

123 
	#PRIxLEAST8
 "x"

	)

124 
	#PRIxLEAST16
 "x"

	)

125 
	#PRIxLEAST32
 "x"

	)

126 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

128 
	#PRIxFAST8
 "x"

	)

129 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

130 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

131 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIX8
 "X"

	)

135 
	#PRIX16
 "X"

	)

136 
	#PRIX32
 "X"

	)

137 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

139 
	#PRIXLEAST8
 "X"

	)

140 
	#PRIXLEAST16
 "X"

	)

141 
	#PRIXLEAST32
 "X"

	)

142 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

144 
	#PRIXFAST8
 "X"

	)

145 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

146 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

147 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

151 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

152 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

153 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

154 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

155 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

156 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

160 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

161 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

162 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

163 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

164 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

165 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

171 
	#SCNd8
 "hhd"

	)

172 
	#SCNd16
 "hd"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

176 
	#SCNdLEAST8
 "hhd"

	)

177 
	#SCNdLEAST16
 "hd"

	)

178 
	#SCNdLEAST32
 "d"

	)

179 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

181 
	#SCNdFAST8
 "hhd"

	)

182 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

183 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

184 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNi8
 "hhi"

	)

188 
	#SCNi16
 "hi"

	)

189 
	#SCNi32
 "i"

	)

190 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

192 
	#SCNiLEAST8
 "hhi"

	)

193 
	#SCNiLEAST16
 "hi"

	)

194 
	#SCNiLEAST32
 "i"

	)

195 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

197 
	#SCNiFAST8
 "hhi"

	)

198 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

199 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

200 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNu8
 "hhu"

	)

204 
	#SCNu16
 "hu"

	)

205 
	#SCNu32
 "u"

	)

206 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

208 
	#SCNuLEAST8
 "hhu"

	)

209 
	#SCNuLEAST16
 "hu"

	)

210 
	#SCNuLEAST32
 "u"

	)

211 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

213 
	#SCNuFAST8
 "hhu"

	)

214 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

215 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

216 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNo8
 "hho"

	)

220 
	#SCNo16
 "ho"

	)

221 
	#SCNo32
 "o"

	)

222 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

224 
	#SCNoLEAST8
 "hho"

	)

225 
	#SCNoLEAST16
 "ho"

	)

226 
	#SCNoLEAST32
 "o"

	)

227 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

229 
	#SCNoFAST8
 "hho"

	)

230 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

231 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

232 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNx8
 "hhx"

	)

236 
	#SCNx16
 "hx"

	)

237 
	#SCNx32
 "x"

	)

238 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

240 
	#SCNxLEAST8
 "hhx"

	)

241 
	#SCNxLEAST16
 "hx"

	)

242 
	#SCNxLEAST32
 "x"

	)

243 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

245 
	#SCNxFAST8
 "hhx"

	)

246 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

247 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

248 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

252 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

253 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

254 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

255 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

256 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

259 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

260 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

261 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

262 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

263 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

266 
	g__BEGIN_DECLS


268 #ià
__WORDSIZE
 == 64

273 
	mquÙ
;

274 
	m»m
;

275 } 
	timaxdiv_t
;

282 
__ex‹nsiÚ__
 
	mquÙ
;

283 
__ex‹nsiÚ__
 
	m»m
;

284 } 
	timaxdiv_t
;

290 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

293 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

294 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

297 
štmax_t
 
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

298 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

301 
uštmax_t
 
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

302 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

305 
štmax_t
 
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

306 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

307 
__THROW
;

310 
uštmax_t
 
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

311 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

312 
__THROW
;

314 #ifdeà
__USE_EXTERN_INLINES


316 #ià
__WORDSIZE
 == 64

318 
	$__¡¹Ş_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

319 **
__»¡riù
 
__’d±r
,

320 
__ba£
, 
__group
)

321 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

323 
__ex‹º_šlše
 
štmax_t


324 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

325 
ba£
))

327  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

328 
	}
}

330 
	$__¡¹oul_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

331 ** 
__»¡riù
 
__’d±r
,

332 
__ba£
, 
__group
)

333 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

335 
__ex‹º_šlše
 
uštmax_t


336 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

337 
ba£
))

339  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

340 
	}
}

342 
	$__wc¡Ş_š‹º®
 (cÚ¡ 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

343 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

344 
__ba£
, 
__group
)

345 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

347 
__ex‹º_šlše
 
štmax_t


348 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

349 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

351  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

352 
	}
}

354 
	$__wc¡oul_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

355 
__»¡riù
 
__ÅŒ
,

356 
__gwch¬_t
 **

357 
__»¡riù
 
__’d±r
,

358 
__ba£
, 
__group
)

359 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

361 
__ex‹º_šlše
 
uštmax_t


362 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

363 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

365  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

366 
	}
}

370 
__ex‹nsiÚ__


371 
	$__¡¹Şl_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

372 **
__»¡riù
 
__’d±r
,

373 
__ba£
, 
__group
)

374 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

376 
__ex‹º_šlše
 
štmax_t


377 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

378 
ba£
))

380  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

381 
	}
}

383 
__ex‹nsiÚ__


384 
	$__¡¹ouÎ_š‹º®
 (const *

385 
__»¡riù
 
__ÅŒ
,

387 
__»¡riù
 
__’d±r
,

388 
__ba£
,

389 
__group
)

390 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

392 
__ex‹º_šlše
 
uštmax_t


393 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

394 
ba£
))

396  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

397 
	}
}

399 
__ex‹nsiÚ__


400 
	$__wc¡Şl_š‹º®
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

401 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

402 
__ba£
, 
__group
)

403 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

405 
__ex‹º_šlše
 
štmax_t


406 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

407 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

409  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

410 
	}
}

413 
__ex‹nsiÚ__


414 
	$__wc¡ouÎ_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

415 
__»¡riù
 
__ÅŒ
,

416 
__gwch¬_t
 **

417 
__»¡riù
 
__’d±r
,

418 
__ba£
,

419 
__group
)

420 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

422 
__ex‹º_šlše
 
uštmax_t


423 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

424 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

426  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

427 
	}
}

432 
	g__END_DECLS


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 263938

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
è((×è<< 16è+ ((bè<< 8è+ (c))

	)

	@/usr/include/locale.h

22 #iâdef 
_LOCALE_H


23 
	#_LOCALE_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	#__Ãed_NULL


	)

28 
	~<¡ddef.h
>

29 
	~<b™s/loÿË.h
>

31 
	g__BEGIN_DECLS


35 
	#LC_CTYPE
 
__LC_CTYPE


	)

36 
	#LC_NUMERIC
 
__LC_NUMERIC


	)

37 
	#LC_TIME
 
__LC_TIME


	)

38 
	#LC_COLLATE
 
__LC_COLLATE


	)

39 
	#LC_MONETARY
 
__LC_MONETARY


	)

40 
	#LC_MESSAGES
 
__LC_MESSAGES


	)

41 
	#LC_ALL
 
__LC_ALL


	)

42 
	#LC_PAPER
 
__LC_PAPER


	)

43 
	#LC_NAME
 
__LC_NAME


	)

44 
	#LC_ADDRESS
 
__LC_ADDRESS


	)

45 
	#LC_TELEPHONE
 
__LC_TELEPHONE


	)

46 
	#LC_MEASUREMENT
 
__LC_MEASUREMENT


	)

47 
	#LC_IDENTIFICATION
 
__LC_IDENTIFICATION


	)

50 
__BEGIN_NAMESPACE_STD


53 
	slcÚv


57 *
	mdecim®_pošt
;

58 *
	mthou§nds_£p
;

64 *
	mgroupšg
;

70 *
	mšt_cu¼_symbŞ
;

71 *
	mcu¼’cy_symbŞ
;

72 *
	mmÚ_decim®_pošt
;

73 *
	mmÚ_thou§nds_£p
;

74 *
	mmÚ_groupšg
;

75 *
	mpos™ive_sign
;

76 *
	mÃg©ive_sign
;

77 
	mšt_äac_dig™s
;

78 
	mäac_dig™s
;

80 
	mp_cs_´eûdes
;

82 
	mp_£p_by_¥aû
;

84 
	mn_cs_´eûdes
;

86 
	mn_£p_by_¥aû
;

93 
	mp_sign_po¢
;

94 
	mn_sign_po¢
;

95 #ifdeà
__USE_ISOC99


97 
	mšt_p_cs_´eûdes
;

99 
	mšt_p_£p_by_¥aû
;

101 
	mšt_n_cs_´eûdes
;

103 
	mšt_n_£p_by_¥aû
;

110 
	mšt_p_sign_po¢
;

111 
	mšt_n_sign_po¢
;

113 
	m__št_p_cs_´eûdes
;

114 
	m__št_p_£p_by_¥aû
;

115 
	m__št_n_cs_´eûdes
;

116 
	m__št_n_£p_by_¥aû
;

117 
	m__št_p_sign_po¢
;

118 
	m__št_n_sign_po¢
;

124 *
	$£oÿË
 (
__ÿ‹gÜy
, cÚ¡ *
__loÿË
è
__THROW
;

127 
lcÚv
 *
	$loÿËcÚv
 (è
__THROW
;

129 
__END_NAMESPACE_STD


132 #ifdef 
__USE_XOPEN2K8


145 
	~<xloÿË.h
>

151 
__loÿË_t
 
	$ÃwloÿË
 (
__ÿ‹gÜy_mask
, cÚ¡ *
__loÿË
,

152 
__loÿË_t
 
__ba£
è
__THROW
;

158 
	#LC_CTYPE_MASK
 (1 << 
__LC_CTYPE
)

	)

159 
	#LC_NUMERIC_MASK
 (1 << 
__LC_NUMERIC
)

	)

160 
	#LC_TIME_MASK
 (1 << 
__LC_TIME
)

	)

161 
	#LC_COLLATE_MASK
 (1 << 
__LC_COLLATE
)

	)

162 
	#LC_MONETARY_MASK
 (1 << 
__LC_MONETARY
)

	)

163 
	#LC_MESSAGES_MASK
 (1 << 
__LC_MESSAGES
)

	)

164 
	#LC_PAPER_MASK
 (1 << 
__LC_PAPER
)

	)

165 
	#LC_NAME_MASK
 (1 << 
__LC_NAME
)

	)

166 
	#LC_ADDRESS_MASK
 (1 << 
__LC_ADDRESS
)

	)

167 
	#LC_TELEPHONE_MASK
 (1 << 
__LC_TELEPHONE
)

	)

168 
	#LC_MEASUREMENT_MASK
 (1 << 
__LC_MEASUREMENT
)

	)

169 
	#LC_IDENTIFICATION_MASK
 (1 << 
__LC_IDENTIFICATION
)

	)

170 
	#LC_ALL_MASK
 (
LC_CTYPE_MASK
 \

171 | 
LC_NUMERIC_MASK
 \

172 | 
LC_TIME_MASK
 \

173 | 
LC_COLLATE_MASK
 \

174 | 
LC_MONETARY_MASK
 \

175 | 
LC_MESSAGES_MASK
 \

176 | 
LC_PAPER_MASK
 \

177 | 
LC_NAME_MASK
 \

178 | 
LC_ADDRESS_MASK
 \

179 | 
LC_TELEPHONE_MASK
 \

180 | 
LC_MEASUREMENT_MASK
 \

181 | 
LC_IDENTIFICATION_MASK
 \

182 )

	)

186 
__loÿË_t
 
	$du¶oÿË
 (
__loÿË_t
 
__d©a£t
è
__THROW
;

190 
	$ä“loÿË
 (
__loÿË_t
 
__d©a£t
è
__THROW
;

197 
__loÿË_t
 
	$u£loÿË
 (
__loÿË_t
 
__d©a£t
è
__THROW
;

201 
	#LC_GLOBAL_LOCALE
 ((
__loÿË_t
è-1L)

	)

205 
__END_DECLS


	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/m©h-veùÜ.h
>

35 
	~<b™s/huge_v®.h
>

36 #ifdeà
__USE_ISOC99


37 
	~<b™s/huge_v®f.h
>

38 
	~<b™s/huge_v®l.h
>

41 
	~<b™s/šf.h
>

44 
	~<b™s/Çn.h
>

48 
	~<b™s/m©hdef.h
>

55 
	#__SIMD_DECL
(
funùiÚ
è
	`__CONCAT
 (
__DECL_SIMD_
, funùiÚ)

	)

57 
	#__MATHCALL_VEC
(
funùiÚ
, 
suffix
, 
¬gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

59 
	`__MATHCALL
 (
funùiÚ
, 
suffix
, 
¬gs
)

	)

61 
	#__MATHDECL_VEC
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

63 
	`__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
)

	)

65 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

66 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

67 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

68 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

69 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

70 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

71 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

72 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

73 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

74 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

75 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

76 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

78 
	#_MdoubË_
 

	)

79 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<b™s/m©hÿÎs.h
>

84 #undeà
_MdoubË_


85 #undeà
_MdoubË_BEGIN_NAMESPACE


86 #undeà
_MdoubË_END_NAMESPACE


87 #undeà
__MATH_PRECNAME


88 #undeà
__MATH_DECLARING_DOUBLE


90 #ifdeà
__USE_ISOC99


96 #iâdeà
_Mæßt_


97 
	#_Mæßt_
 

	)

99 
	#_MdoubË_
 
_Mæßt_


	)

100 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<b™s/m©hÿÎs.h
>

105 #undeà
_MdoubË_


106 #undeà
_MdoubË_BEGIN_NAMESPACE


107 #undeà
_MdoubË_END_NAMESPACE


108 #undeà
__MATH_PRECNAME


109 #undeà
__MATH_DECLARING_DOUBLE


111 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

112 || 
defšed
 
__LDBL_COMPAT
 \

113 || 
defšed
 
_LIBC_TEST


114 #ifdeà
__LDBL_COMPAT


116 #ifdeà
__USE_ISOC99


117 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

119 #ifdeà
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

121 
__Ædbl_Ãx‰ow¬df
)

122 
	`__©Œibu‹__
 ((
__cÚ¡__
));

123 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

124 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

125 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

126 (
__x
, 
__y
),

127 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

131 #undeà
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

133 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

134 
¬gs
, 
®Ÿs
)

	)

135 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

136 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

142 #iâdeà
_MlÚg_doubË_


143 
	#_MlÚg_doubË_
 

	)

145 
	#_MdoubË_
 
_MlÚg_doubË_


	)

146 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<b™s/m©hÿÎs.h
>

152 #undeà
_MdoubË_


153 #undeà
_MdoubË_BEGIN_NAMESPACE


154 #undeà
_MdoubË_END_NAMESPACE


155 #undeà
__MATH_PRECNAME


156 #undeà
__MATH_DECLARING_DOUBLE


161 #undeà
__MATHDECL_1


162 #undeà
__MATHDECL


163 #undeà
__MATHCALL


166 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


168 
signgam
;

173 #ifdeà
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__
 \

234 && !
defšed
 
__OPTIMIZE_SIZE__


235 
	#åşassify
(
x
è
	`__butš_åşassify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


238 
	#åşassify
(
x
) \

239 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

241 
	#åşassify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__åşassifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

249 #ià
	`__GNUC_PREREQ
 (4,0)

250 
	#signb™
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__butš_signb™f
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__butš_signb™
 (
x
è: 
	`__butš_signb™l
 (x))

	)

256 #ifdeà
__NO_LONG_DOUBLE_MATH


257 
	#signb™
(
x
) \

258 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

260 
	#signb™
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signb™f
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

269 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


270 
	#isfš™e
(
x
è
	`__butš_isfš™e
 (x)

	)

271 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


272 
	#isfš™e
(
x
) \

273 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

275 
	#isfš™e
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__fš™ef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

283 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


284 
	#i¢Üm®
(
x
è
	`__butš_i¢Üm®
 (x)

	)

286 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

291 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


292 
	#i¢ª
(
x
è
	`__butš_i¢ª
 (x)

	)

293 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢ª
(
x
) \

295 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

297 
	#i¢ª
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢ªf
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

305 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


306 
	#isšf
(
x
è
	`__butš_isšf_sign
 (x)

	)

307 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


308 
	#isšf
(
x
) \

309 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

311 
	#isšf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isšff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #iâdeà
__FAST_MATH__


326 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifdeà
__USE_GNU


333 #ifdeà
__NO_LONG_DOUBLE_MATH


334 
	#issigÇlšg
(
x
) \

335 ( (
x
è=ğ (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

337 
	#issigÇlšg
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issigÇlšgf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifdeà
__USE_MISC


369 #ifdeà
__ılu¥lus


370 
__exû±iÚ


372 
exû±iÚ


375 
ty³
;

376 *
Çme
;

377 
¬g1
;

378 
¬g2
;

379 
»tv®
;

380 
	}
};

382 #ifdeà
__ılu¥lus


383 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

385 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifdeà
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifdeà
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

463 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

464 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

465 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

466 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

467 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

471 #ifdeà
__USE_EXTERN_INLINES


472 
	~<b™s/m©hšlše.h
>

477 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<b™s/m©h-fš™e.h
>

481 #ifdeà
__USE_ISOC99


485 #iâdeà
isg»©”


486 
	#isg»©”
(
x
, 
y
) \

487 (
__ex‹nsiÚ__
 \

488 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

489 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

493 #iâdeà
isg»©”equ®


494 
	#isg»©”equ®
(
x
, 
y
) \

495 (
__ex‹nsiÚ__
 \

496 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

497 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

501 #iâdeà
i¦ess


502 
	#i¦ess
(
x
, 
y
) \

503 (
__ex‹nsiÚ__
 \

504 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

505 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

509 #iâdeà
i¦es£qu®


510 
	#i¦es£qu®
(
x
, 
y
) \

511 (
__ex‹nsiÚ__
 \

512 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

513 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

517 #iâdeà
i¦essg»©”


518 
	#i¦essg»©”
(
x
, 
y
) \

519 (
__ex‹nsiÚ__
 \

520 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

521 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

525 #iâdeà
isunÜd”ed


526 
	#isunÜd”ed
(
u
, 
v
) \

527 (
__ex‹nsiÚ__
 \

528 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

529 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/netdb.h

22 #iâdef 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<¡dšt.h
>

29 #ifdeà
__USE_MISC


32 
	~<½c/Ãtdb.h
>

35 #ifdeà
__USE_GNU


36 
	#__Ãed_sigev’t_t


	)

37 
	~<b™s/sigšfo.h
>

38 
	#__Ãed_time¥ec


	)

39 
	~<time.h
>

42 
	~<b™s/Ãtdb.h
>

45 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

46 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

47 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

48 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

49 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

50 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

53 
	g__BEGIN_DECLS


55 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


58 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

61 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

65 
	#HOST_NOT_FOUND
 1

	)

66 
	#TRY_AGAIN
 2

	)

68 
	#NO_RECOVERY
 3

	)

70 
	#NO_DATA
 4

	)

73 #ifdeà
__USE_MISC


74 
	#NETDB_INTERNAL
 -1

	)

75 
	#NETDB_SUCCESS
 0

	)

76 
	#NO_ADDRESS
 
NO_DATA


	)

79 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_XOPEN_EXTENDED


81 
	#IPPORT_RESERVED
 1024

	)

84 #ifdeà
__USE_GNU


86 
	#SCOPE_DELIMITER
 '%'

	)

89 #ifdeà
__USE_MISC


92 
	$h”rÜ
 (cÚ¡ *
__¡r
è
__THROW
;

95 cÚ¡ *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

100 
	sho¡’t


102 *
h_Çme
;

103 **
h_®Ÿ£s
;

104 
h_add¹y³
;

105 
h_Ëngth
;

106 **
h_addr_li¡
;

107 #ifdeà
__USE_MISC


108 
	#h_addr
 
h_addr_li¡
[0]

	)

117 
	`£tho¡’t
 (
__¡ay_İ’
);

123 
	`’dho¡’t
 ();

130 
ho¡’t
 *
	`g‘ho¡’t
 ();

137 
ho¡’t
 *
	`g‘ho¡byaddr
 (cÚ¡ *
__addr
, 
__sockËn_t
 
__Ën
,

138 
__ty³
);

144 
ho¡’t
 *
	`g‘ho¡byÇme
 (cÚ¡ *
__Çme
);

146 #ifdeà
__USE_MISC


155 
ho¡’t
 *
	`g‘ho¡byÇme2
 (cÚ¡ *
__Çme
, 
__af
);

167 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

168 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

169 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

170 *
__»¡riù
 
__h_”ºİ
);

172 
	`g‘ho¡byaddr_r
 (cÚ¡ *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

173 
__ty³
,

174 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

175 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

176 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

177 *
__»¡riù
 
__h_”ºİ
);

179 
	`g‘ho¡byÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

180 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

181 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

182 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

183 *
__»¡riù
 
__h_”ºİ
);

185 
	`g‘ho¡byÇme2_r
 (cÚ¡ *
__»¡riù
 
__Çme
, 
__af
,

186 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

187 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

188 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

189 *
__»¡riù
 
__h_”ºİ
);

198 
	`£Š‘’t
 (
__¡ay_İ’
);

204 
	`’dÃ‹Á
 ();

211 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

218 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

224 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (cÚ¡ *
__Çme
);

226 #ifdef 
__USE_MISC


237 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

238 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

239 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

240 *
__»¡riù
 
__h_”ºİ
);

242 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

243 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

244 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

245 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

246 *
__»¡riù
 
__h_”ºİ
);

248 
	`g‘ÃtbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

249 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

250 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

251 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

252 *
__»¡riù
 
__h_”ºİ
);

257 
	s£rv’t


259 *
s_Çme
;

260 **
s_®Ÿ£s
;

261 
s_pÜt
;

262 *
s_´Ùo
;

270 
	`£t£rv’t
 (
__¡ay_İ’
);

276 
	`’d£rv’t
 ();

283 
£rv’t
 *
	`g‘£rv’t
 ();

290 
£rv’t
 *
	`g‘£rvbyÇme
 (cÚ¡ *
__Çme
, cÚ¡ *
__´Ùo
);

297 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, cÚ¡ *
__´Ùo
);

300 #ifdef 
__USE_MISC


308 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

309 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

310 
£rv’t
 **
__»¡riù
 
__»suÉ
);

312 
	`g‘£rvbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

313 cÚ¡ *
__»¡riù
 
__´Ùo
,

314 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

315 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

316 
£rv’t
 **
__»¡riù
 
__»suÉ
);

318 
	`g‘£rvbypÜt_r
 (
__pÜt
, cÚ¡ *
__»¡riù
 
__´Ùo
,

319 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

320 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

321 
£rv’t
 **
__»¡riù
 
__»suÉ
);

326 
	s´ÙÛÁ


328 *
p_Çme
;

329 **
p_®Ÿ£s
;

330 
p_´Ùo
;

338 
	`£rÙÛÁ
 (
__¡ay_İ’
);

344 
	`’d´ÙÛÁ
 ();

351 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

357 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (cÚ¡ *
__Çme
);

363 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

366 #ifdef 
__USE_MISC


374 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

375 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

376 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

378 
	`g‘´ÙobyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

379 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

380 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

381 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

383 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

384 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

385 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

386 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

395 
	`£Š‘g»Á
 (cÚ¡ *
__Ãtgroup
);

403 
	`’dÃtg»Á
 ();

412 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

413 **
__»¡riù
 
__u£½
,

414 **
__»¡riù
 
__domašp
);

423 
	`šÃtgr
 (cÚ¡ *
__Ãtgroup
, cÚ¡ *
__ho¡
,

424 cÚ¡ *
__u£r
, cÚ¡ *
__domaš
);

432 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

433 **
__»¡riù
 
__u£½
,

434 **
__»¡riù
 
__domašp
,

435 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

439 #ifdeà
__USE_MISC


451 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

452 cÚ¡ *
__»¡riù
 
__locu£r
,

453 cÚ¡ *
__»¡riù
 
__»mu£r
,

454 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

463 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

464 cÚ¡ *
__»¡riù
 
__locu£r
,

465 cÚ¡ *
__»¡riù
 
__»mu£r
,

466 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

467 
§_çmy_t
 
__af
);

479 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

480 cÚ¡ *
__»¡riù
 
__Çme
,

481 cÚ¡ *
__»¡riù
 
__·ss
,

482 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

491 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

492 cÚ¡ *
__»¡riù
 
__Çme
,

493 cÚ¡ *
__»¡riù
 
__·ss
,

494 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

495 
§_çmy_t
 
__af
);

505 
	`ru£rok
 (cÚ¡ *
__rho¡
, 
__su£r
,

506 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

515 
	`ru£rok_af
 (cÚ¡ *
__rho¡
, 
__su£r
,

516 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

517 
§_çmy_t
 
__af
);

528 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

529 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

539 
	`œu£rok_af
 (cÚ¡ *
__¿ddr
, 
__su£r
,

540 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

541 
§_çmy_t
 
__af
);

551 
	`¼esvpÜt
 (*
__®pÜt
);

560 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

565 #ifdeà
__USE_XOPEN2K


567 
	saddršfo


569 
ai_æags
;

570 
ai_çmy
;

571 
ai_sockty³
;

572 
ai_´ÙocŞ
;

573 
sockËn_t
 
ai_add¾’
;

574 
sockaddr
 *
ai_addr
;

575 *
ai_ÿnÚÇme
;

576 
addršfo
 *
ai_Ãxt
;

579 #ifdeà
__USE_GNU


581 
	sgaicb


583 cÚ¡ *
¬_Çme
;

584 cÚ¡ *
¬_£rviû
;

585 cÚ¡ 
addršfo
 *
¬_»que¡
;

586 
addršfo
 *
¬_»suÉ
;

588 
__»tuº
;

589 
__glibc_»£rved
[5];

593 
	#GAI_WAIT
 0

	)

594 
	#GAI_NOWAIT
 1

	)

598 
	#AI_PASSIVE
 0x0001

	)

599 
	#AI_CANONNAME
 0x0002

	)

600 
	#AI_NUMERICHOST
 0x0004

	)

601 
	#AI_V4MAPPED
 0x0008

	)

602 
	#AI_ALL
 0x0010

	)

603 
	#AI_ADDRCONFIG
 0x0020

	)

605 #ifdeà
__USE_GNU


606 
	#AI_IDN
 0x0040

	)

609 
	#AI_CANONIDN
 0x0080

	)

610 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

612 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

615 
	#AI_NUMERICSERV
 0x0400

	)

618 
	#EAI_BADFLAGS
 -1

	)

619 
	#EAI_NONAME
 -2

	)

620 
	#EAI_AGAIN
 -3

	)

621 
	#EAI_FAIL
 -4

	)

622 
	#EAI_FAMILY
 -6

	)

623 
	#EAI_SOCKTYPE
 -7

	)

624 
	#EAI_SERVICE
 -8

	)

625 
	#EAI_MEMORY
 -10

	)

626 
	#EAI_SYSTEM
 -11

	)

627 
	#EAI_OVERFLOW
 -12

	)

628 #ifdeà
__USE_GNU


629 
	#EAI_NODATA
 -5

	)

630 
	#EAI_ADDRFAMILY
 -9

	)

631 
	#EAI_INPROGRESS
 -100

	)

632 
	#EAI_CANCELED
 -101

	)

633 
	#EAI_NOTCANCELED
 -102

	)

634 
	#EAI_ALLDONE
 -103

	)

635 
	#EAI_INTR
 -104

	)

636 
	#EAI_IDN_ENCODE
 -105

	)

639 #ifdeà
__USE_MISC


640 
	#NI_MAXHOST
 1025

	)

641 
	#NI_MAXSERV
 32

	)

644 
	#NI_NUMERICHOST
 1

	)

645 
	#NI_NUMERICSERV
 2

	)

646 
	#NI_NOFQDN
 4

	)

647 
	#NI_NAMEREQD
 8

	)

648 
	#NI_DGRAM
 16

	)

649 #ifdeà
__USE_GNU


650 
	#NI_IDN
 32

	)

651 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

653 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

662 
	`g‘addršfo
 (cÚ¡ *
__»¡riù
 
__Çme
,

663 cÚ¡ *
__»¡riù
 
__£rviû
,

664 cÚ¡ 
addršfo
 *
__»¡riù
 
__»q
,

665 
addršfo
 **
__»¡riù
 
__·i
);

668 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

671 cÚ¡ *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

677 
	`g‘Çmešfo
 (cÚ¡ 
sockaddr
 *
__»¡riù
 
__§
,

678 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

679 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

680 
sockËn_t
 
__£rvËn
, 
__æags
);

683 #ifdeà
__USE_GNU


692 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

693 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

703 
	`gai_su¥’d
 (cÚ¡ 
gaicb
 *cÚ¡ 
__li¡
[], 
__’t
,

704 cÚ¡ 
time¥ec
 *
__timeout
);

707 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

710 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

713 
__END_DECLS


	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<¡dšt.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #iâdeà
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
ušt16_t
 
	tš_pÜt_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

186 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

190 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

194 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #iâdeà
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

209 #iâdeà
__USE_KERNEL_IPV6_DEFS


211 
	sš6_addr


215 
ušt8_t
 
	m__u6_addr8
[16];

216 #ifdeà
__USE_MISC


217 
ušt16_t
 
	m__u6_addr16
[8];

218 
ušt32_t
 
	m__u6_addr32
[4];

220 } 
	m__š6_u
;

221 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

222 #ifdeà
__USE_MISC


223 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

224 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

229 cÚ¡ 
š6_addr
 
š6addr_ªy
;

230 cÚ¡ 
š6_addr
 
š6addr_loİback
;

231 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

232 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

234 
	#INET_ADDRSTRLEN
 16

	)

235 
	#INET6_ADDRSTRLEN
 46

	)

239 
	ssockaddr_š


241 
__SOCKADDR_COMMON
 (
sš_
);

242 
š_pÜt_t
 
	msš_pÜt
;

243 
š_addr
 
	msš_addr
;

246 
	msš_z”o
[ (
sockaddr
) -

247 
__SOCKADDR_COMMON_SIZE
 -

248  (
š_pÜt_t
) -

249  (
š_addr
)];

252 #iâdeà
__USE_KERNEL_IPV6_DEFS


254 
	ssockaddr_š6


256 
__SOCKADDR_COMMON
 (
sš6_
);

257 
š_pÜt_t
 
	msš6_pÜt
;

258 
ušt32_t
 
	msš6_æowšfo
;

259 
š6_addr
 
	msš6_addr
;

260 
ušt32_t
 
	msš6_scİe_id
;

264 #ifdeà
__USE_MISC


266 
	s_m»q


269 
š_addr
 
	mimr_muÉŸddr
;

272 
š_addr
 
	mimr_š‹rçû
;

275 
	s_m»q_sourû


278 
š_addr
 
	mimr_muÉŸddr
;

281 
š_addr
 
	mimr_š‹rçû
;

284 
š_addr
 
	mimr_sourûaddr
;

288 #iâdeà
__USE_KERNEL_IPV6_DEFS


290 
	sv6_m»q


293 
š6_addr
 
	mv6mr_muÉŸddr
;

296 
	mv6mr_š‹rçû
;

300 #ifdeà
__USE_MISC


302 
	sgroup_»q


305 
ušt32_t
 
	mgr_š‹rçû
;

308 
sockaddr_¡Üage
 
	mgr_group
;

311 
	sgroup_sourû_»q


314 
ušt32_t
 
	mg¤_š‹rçû
;

317 
sockaddr_¡Üage
 
	mg¤_group
;

320 
sockaddr_¡Üage
 
	mg¤_sourû
;

325 
	s_msf‹r


328 
š_addr
 
	mimsf_muÉŸddr
;

331 
š_addr
 
	mimsf_š‹rçû
;

334 
ušt32_t
 
	mimsf_fmode
;

337 
ušt32_t
 
	mimsf_num¤c
;

339 
š_addr
 
	mimsf_¦i¡
[1];

342 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

343 -  (
š_addr
) \

344 + (
num¤c
è*  (
š_addr
))

	)

346 
	sgroup_f‹r


349 
ušt32_t
 
	mgf_š‹rçû
;

352 
sockaddr_¡Üage
 
	mgf_group
;

355 
ušt32_t
 
	mgf_fmode
;

358 
ušt32_t
 
	mgf_num¤c
;

360 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

363 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

364 -  (
sockaddr_¡Üage
) \

365 + ((
num¤c
) \

366 *  (
sockaddr_¡Üage
)))

	)

376 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

381 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

382 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

384 
	~<’dŸn.h
>

387 
	~<b™s/by‹sw­.h
>

389 #ifdeà
__OPTIMIZE__


393 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


396 
	#Áohl
(
x
è(x)

	)

397 
	#Áohs
(
x
è(x)

	)

398 
	#htÚl
(
x
è(x)

	)

399 
	#htÚs
(
x
è(x)

	)

401 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


402 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

403 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

404 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

405 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

410 #ifdeà
__GNUC__


411 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

412 (
__ex‹nsiÚ__
 \

413 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

414 
__a
->
s6_addr32
[0] == 0 \

415 && 
__a
->
s6_addr32
[1] == 0 \

416 && 
__a
->
s6_addr32
[2] == 0 \

417 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

419 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

420 (
__ex‹nsiÚ__
 \

421 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

422 
__a
->
s6_addr32
[0] == 0 \

423 && 
__a
->
s6_addr32
[1] == 0 \

424 && 
__a
->
s6_addr32
[2] == 0 \

425 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

427 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

428 (
__ex‹nsiÚ__
 \

429 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

430 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

432 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

433 (
__ex‹nsiÚ__
 \

434 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

435 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

437 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

438 (
__ex‹nsiÚ__
 \

439 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

440 
__a
->
s6_addr32
[0] == 0 \

441 && 
__a
->
s6_addr32
[1] == 0 \

442 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

444 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

445 (
__ex‹nsiÚ__
 \

446 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

447 
__a
->
s6_addr32
[0] == 0 \

448 && 
__a
->
s6_addr32
[1] == 0 \

449 && 
__a
->
s6_addr32
[2] == 0 \

450 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

452 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

453 (
__ex‹nsiÚ__
 \

454 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

455 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

456 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

457 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

458 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

459 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

461 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

462 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

464 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

465 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

467 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

468 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

470 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

471 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

473 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

474 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

475 =ğ
	`htÚl
 (0xã800000))

	)

477 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

478 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

479 =ğ
	`htÚl
 (0xãc00000))

	)

481 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

482 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

483 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

484 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

486 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

487 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

488 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

489 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

490 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

492 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

493 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

495 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

496 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

499 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

501 #ifdeà
__USE_MISC


503 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

506 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

507 
__THROW
;

511 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

512 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

513 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

515 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

516 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

517 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

519 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

520 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

521 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

523 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

524 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

525 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

527 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

528 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

529 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

532 #ifdeà
__USE_GNU


533 
cmsghdr
;

535 #iâdeà
__USE_KERNEL_IPV6_DEFS


537 
	sš6_pktšfo


539 
š6_addr
 
i6_addr
;

540 
i6_ifšdex
;

544 
	s6_mtušfo


546 
sockaddr_š6
 
6m_addr
;

547 
ušt32_t
 
6m_mtu
;

552 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

553 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

554 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

555 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

556 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

557 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

558 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

559 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

560 
__muÉx
, 
__¶usy
)

561 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

562 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

563 
ušt8_t
 **
__Œp
)

564 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

565 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

566 
ušt8_t
 **
__Œp
, 
__ty³
)

567 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

571 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

572 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

573 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

574 **
__d©abuå
è
__THROW
;

575 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

576 
__THROW
;

577 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

578 
sockËn_t
 
__v®Ën
è
__THROW
;

579 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

580 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

581 **
__d©abuå
è
__THROW
;

582 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

583 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

584 **
__d©abuå
è
__THROW
;

585 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

586 
sockËn_t
 
__v®Ën
è
__THROW
;

590 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

591 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

592 
__£gm’ts
è
__THROW
;

593 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

594 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

595 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

596 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

597 
__THROW
;

603 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

604 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

605 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

606 
__THROW
;

609 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

610 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

611 
ušt32_t
 
__num¤c
,

612 cÚ¡ 
š_addr
 *
__¦i¡
)

613 
__THROW
;

617 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

618 cÚ¡ 
sockaddr
 *
__group
,

619 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

620 
ušt32_t
 *
__num¤c
,

621 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

624 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

625 cÚ¡ 
sockaddr
 *
__group
,

626 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

627 
ušt32_t
 
__num¤c
,

628 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

631 
__END_DECLS


	@/usr/include/netinet/tcp.h

32 #iâdeà
_NETINET_TCP_H


33 
	#_NETINET_TCP_H
 1

	)

35 
	~<ã©u»s.h
>

40 
	#TCP_NODELAY
 1

	)

41 
	#TCP_MAXSEG
 2

	)

42 
	#TCP_CORK
 3

	)

43 
	#TCP_KEEPIDLE
 4

	)

44 
	#TCP_KEEPINTVL
 5

	)

45 
	#TCP_KEEPCNT
 6

	)

46 
	#TCP_SYNCNT
 7

	)

47 
	#TCP_LINGER2
 8

	)

48 
	#TCP_DEFER_ACCEPT
 9

	)

49 
	#TCP_WINDOW_CLAMP
 10

	)

50 
	#TCP_INFO
 11

	)

51 
	#TCP_QUICKACK
 12

	)

52 
	#TCP_CONGESTION
 13

	)

53 
	#TCP_MD5SIG
 14

	)

54 
	#TCP_COOKIE_TRANSACTIONS
 15

	)

55 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

56 
	#TCP_THIN_DUPACK
 17

	)

57 
	#TCP_USER_TIMEOUT
 18

	)

58 
	#TCP_REPAIR
 19

	)

59 
	#TCP_REPAIR_QUEUE
 20

	)

60 
	#TCP_QUEUE_SEQ
 21

	)

61 
	#TCP_REPAIR_OPTIONS
 22

	)

62 
	#TCP_FASTOPEN
 23

	)

63 
	#TCP_TIMESTAMP
 24

	)

64 
	#TCP_NOTSENT_LOWAT
 25

	)

66 
	#TCP_CC_INFO
 26

	)

68 
	#TCP_SAVE_SYN
 27

	)

70 
	#TCP_SAVED_SYN
 28

	)

73 #ifdeà
__USE_MISC


74 
	~<sys/ty³s.h
>

75 
	~<sys/sock‘.h
>

77 
u_št32_t
 
	ttı_£q
;

82 
	stıhdr


84 
__ex‹nsiÚ__
 union

88 
u_št16_t
 
	mth_¥Üt
;

89 
u_št16_t
 
	mth_dpÜt
;

90 
tı_£q
 
	mth_£q
;

91 
tı_£q
 
	mth_ack
;

92 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


93 
u_št8_t
 
	mth_x2
:4;

94 
u_št8_t
 
	mth_off
:4;

96 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


97 
u_št8_t
 
	mth_off
:4;

98 
u_št8_t
 
	mth_x2
:4;

100 
u_št8_t
 
	mth_æags
;

101 
	#TH_FIN
 0x01

	)

102 
	#TH_SYN
 0x02

	)

103 
	#TH_RST
 0x04

	)

104 
	#TH_PUSH
 0x08

	)

105 
	#TH_ACK
 0x10

	)

106 
	#TH_URG
 0x20

	)

107 
u_št16_t
 
	mth_wš
;

108 
u_št16_t
 
	mth_sum
;

109 
u_št16_t
 
	mth_u½
;

113 
u_št16_t
 
	msourû
;

114 
u_št16_t
 
	mde¡
;

115 
u_št32_t
 
	m£q
;

116 
u_št32_t
 
	mack_£q
;

117 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


118 
u_št16_t
 
	m»s1
:4;

119 
u_št16_t
 
	mdoff
:4;

120 
u_št16_t
 
	mfš
:1;

121 
u_št16_t
 
	msyn
:1;

122 
u_št16_t
 
	mr¡
:1;

123 
u_št16_t
 
	mpsh
:1;

124 
u_št16_t
 
	mack
:1;

125 
u_št16_t
 
	murg
:1;

126 
u_št16_t
 
	m»s2
:2;

127 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


128 
u_št16_t
 
	mdoff
:4;

129 
u_št16_t
 
	m»s1
:4;

130 
u_št16_t
 
	m»s2
:2;

131 
u_št16_t
 
	murg
:1;

132 
u_št16_t
 
	mack
:1;

133 
u_št16_t
 
	mpsh
:1;

134 
u_št16_t
 
	mr¡
:1;

135 
u_št16_t
 
	msyn
:1;

136 
u_št16_t
 
	mfš
:1;

140 
u_št16_t
 
	mwšdow
;

141 
u_št16_t
 
	mcheck
;

142 
u_št16_t
 
	murg_±r
;

149 
	mTCP_ESTABLISHED
 = 1,

150 
	mTCP_SYN_SENT
,

151 
	mTCP_SYN_RECV
,

152 
	mTCP_FIN_WAIT1
,

153 
	mTCP_FIN_WAIT2
,

154 
	mTCP_TIME_WAIT
,

155 
	mTCP_CLOSE
,

156 
	mTCP_CLOSE_WAIT
,

157 
	mTCP_LAST_ACK
,

158 
	mTCP_LISTEN
,

159 
	mTCP_CLOSING


162 
	#TCPOPT_EOL
 0

	)

163 
	#TCPOPT_NOP
 1

	)

164 
	#TCPOPT_MAXSEG
 2

	)

165 
	#TCPOLEN_MAXSEG
 4

	)

166 
	#TCPOPT_WINDOW
 3

	)

167 
	#TCPOLEN_WINDOW
 3

	)

168 
	#TCPOPT_SACK_PERMITTED
 4

	)

169 
	#TCPOLEN_SACK_PERMITTED
 2

	)

170 
	#TCPOPT_SACK
 5

	)

171 
	#TCPOPT_TIMESTAMP
 8

	)

172 
	#TCPOLEN_TIMESTAMP
 10

	)

173 
	#TCPOLEN_TSTAMP_APPA
 (
TCPOLEN_TIMESTAMP
+2è

	)

175 
	#TCPOPT_TSTAMP_HDR
 \

176 (
TCPOPT_NOP
<<24|TCPOPT_NOP<<16|
TCPOPT_TIMESTAMP
<<8|
TCPOLEN_TIMESTAMP
)

	)

184 
	#TCP_MSS
 512

	)

186 
	#TCP_MAXWIN
 65535

	)

188 
	#TCP_MAX_WINSHIFT
 14

	)

190 
	#SOL_TCP
 6

	)

193 
	#TCPI_OPT_TIMESTAMPS
 1

	)

194 
	#TCPI_OPT_SACK
 2

	)

195 
	#TCPI_OPT_WSCALE
 4

	)

196 
	#TCPI_OPT_ECN
 8

	)

197 
	#TCPI_OPT_ECN_SEEN
 16

	)

198 
	#TCPI_OPT_SYN_DATA
 32

	)

201 
	etı_ÿ_¡©e


203 
	mTCP_CA_O³n
 = 0,

204 
	mTCP_CA_DisÜd”
 = 1,

205 
	mTCP_CA_CWR
 = 2,

206 
	mTCP_CA_Recov”y
 = 3,

207 
	mTCP_CA_Loss
 = 4

210 
	stı_šfo


212 
u_št8_t
 
	mtıi_¡©e
;

213 
u_št8_t
 
	mtıi_ÿ_¡©e
;

214 
u_št8_t
 
	mtıi_»Œªsm™s
;

215 
u_št8_t
 
	mtıi_´obes
;

216 
u_št8_t
 
	mtıi_backoff
;

217 
u_št8_t
 
	mtıi_İtiÚs
;

218 
u_št8_t
 
	mtıi_¢d_wsÿË
 : 4, 
	mtıi_rcv_wsÿË
 : 4;

220 
u_št32_t
 
	mtıi_¹o
;

221 
u_št32_t
 
	mtıi_©o
;

222 
u_št32_t
 
	mtıi_¢d_mss
;

223 
u_št32_t
 
	mtıi_rcv_mss
;

225 
u_št32_t
 
	mtıi_uÇcked
;

226 
u_št32_t
 
	mtıi_§cked
;

227 
u_št32_t
 
	mtıi_lo¡
;

228 
u_št32_t
 
	mtıi_»Œªs
;

229 
u_št32_t
 
	mtıi_çck‘s
;

232 
u_št32_t
 
	mtıi_Ï¡_d©a_£Á
;

233 
u_št32_t
 
	mtıi_Ï¡_ack_£Á
;

234 
u_št32_t
 
	mtıi_Ï¡_d©a_»cv
;

235 
u_št32_t
 
	mtıi_Ï¡_ack_»cv
;

238 
u_št32_t
 
	mtıi_pmtu
;

239 
u_št32_t
 
	mtıi_rcv_s¡h»sh
;

240 
u_št32_t
 
	mtıi_¹t
;

241 
u_št32_t
 
	mtıi_¹tv¬
;

242 
u_št32_t
 
	mtıi_¢d_s¡h»sh
;

243 
u_št32_t
 
	mtıi_¢d_cwnd
;

244 
u_št32_t
 
	mtıi_advmss
;

245 
u_št32_t
 
	mtıi_»Üd”šg
;

247 
u_št32_t
 
	mtıi_rcv_¹t
;

248 
u_št32_t
 
	mtıi_rcv_¥aû
;

250 
u_št32_t
 
	mtıi_tÙ®_»Œªs
;

255 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

257 
	stı_md5sig


259 
sockaddr_¡Üage
 
	mtım_addr
;

260 
u_št16_t
 
	m__tım_·d1
;

261 
u_št16_t
 
	mtım_keyËn
;

262 
u_št32_t
 
	m__tım_·d2
;

263 
u_št8_t
 
	mtım_key
[
TCP_MD5SIG_MAXKEYLEN
];

267 
	stı_»·œ_İt


269 
u_št32_t
 
	mİt_code
;

270 
u_št32_t
 
	mİt_v®
;

276 
	mTCP_NO_QUEUE
,

277 
	mTCP_RECV_QUEUE
,

278 
	mTCP_SEND_QUEUE
,

279 
	mTCP_QUEUES_NR
,

283 
	#TCP_COOKIE_MIN
 8

	)

284 
	#TCP_COOKIE_MAX
 16

	)

285 
	#TCP_COOKIE_PAIR_SIZE
 (2*
TCP_COOKIE_MAX
)

	)

288 
	#TCP_COOKIE_IN_ALWAYS
 (1 << 0è

	)

289 
	#TCP_COOKIE_OUT_NEVER
 (1 << 1è

	)

293 
	#TCP_S_DATA_IN
 (1 << 2è

	)

294 
	#TCP_S_DATA_OUT
 (1 << 3è

	)

296 
	#TCP_MSS_DEFAULT
 536U

	)

297 
	#TCP_MSS_DESIRED
 1220U

	)

299 
	stı_cook›_Œª§ùiÚs


301 
u_št16_t
 
	mtıù_æags
;

302 
u_št8_t
 
	m__tıù_·d1
;

303 
u_št8_t
 
	mtıù_cook›_desœed
;

304 
u_št16_t
 
	mtıù_s_d©a_desœed
;

305 
u_št16_t
 
	mtıù_u£d
;

306 
u_št8_t
 
	mtıù_v®ue
[
TCP_MSS_DEFAULT
];

	@/usr/include/poll.h

1 
	~<sys/pŞl.h
>

	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifdeà
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifdeà
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


85 #ifdeà
__PTHREAD_MUTEX_HAVE_PREV


86 
	#PTHREAD_MUTEX_INITIALIZER
 \

87 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

88 #ifdeà
__USE_GNU


89 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

90 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

91 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

92 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

93 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

94 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

98 
	#PTHREAD_MUTEX_INITIALIZER
 \

99 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

100 #ifdeà
__USE_GNU


101 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

102 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

103 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

105 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

113 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


116 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

117 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

119 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


125 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


126 #ià
__WORDSIZE
 == 64

127 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

132 
	#PTHREAD_RWLOCK_INITIALIZER
 \

133 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

134 #ifdeà
__USE_GNU


135 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


136 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

137 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

138 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

140 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


141 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

142 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

143 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

145 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

146 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

147 0 } }

	)

157 
	mPTHREAD_INHERIT_SCHED
,

158 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

159 
	mPTHREAD_EXPLICIT_SCHED


160 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

167 
	mPTHREAD_SCOPE_SYSTEM
,

168 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

169 
	mPTHREAD_SCOPE_PROCESS


170 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

177 
	mPTHREAD_PROCESS_PRIVATE
,

178 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

179 
	mPTHREAD_PROCESS_SHARED


180 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

186 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

190 
	s_±h»ad_ş—nup_bufãr


192 (*
	m__routše
) (*);

193 *
	m__¬g
;

194 
	m__ÿnûÉy³
;

195 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

201 
	mPTHREAD_CANCEL_ENABLE
,

202 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

203 
	mPTHREAD_CANCEL_DISABLE


204 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

208 
	mPTHREAD_CANCEL_DEFERRED
,

209 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

210 
	mPTHREAD_CANCEL_ASYNCHRONOUS


211 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

213 
	#PTHREAD_CANCELED
 ((*è-1)

	)

217 
	#PTHREAD_ONCE_INIT
 0

	)

220 #ifdeà
__USE_XOPEN2K


224 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

228 
__BEGIN_DECLS


233 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

234 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

235 *(*
__¡¬t_routše
) (*),

236 *
__»¡riù
 
__¬g
è
__THROWNL
 
__nÚnuÎ
 ((1, 3));

242 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

250 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

252 #ifdeà
__USE_GNU


255 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

263 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

264 cÚ¡ 
time¥ec
 *
__ab¡ime
);

271 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

275 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

278 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

279 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

287 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

291 
__THROW
 
	`__nÚnuÎ
 ((1));

294 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

295 *
__d‘ach¡©e
)

296 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

299 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

300 
__d‘ach¡©e
)

301 
__THROW
 
	`__nÚnuÎ
 ((1));

305 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

306 
size_t
 *
__gu¬dsize
)

307 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

310 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

311 
size_t
 
__gu¬dsize
)

312 
__THROW
 
	`__nÚnuÎ
 ((1));

316 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

317 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

318 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

321 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

322 cÚ¡ 
sched_·¿m
 *
__»¡riù


323 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

326 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


327 
__©Œ
, *
__»¡riù
 
__pŞicy
)

328 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

331 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

332 
__THROW
 
	`__nÚnuÎ
 ((1));

335 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


336 
__©Œ
, *
__»¡riù
 
__šh”™
)

337 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

340 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

341 
__šh”™
)

342 
__THROW
 
	`__nÚnuÎ
 ((1));

346 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

347 *
__»¡riù
 
__scİe
)

348 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

351 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

352 
__THROW
 
	`__nÚnuÎ
 ((1));

355 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


356 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

357 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

363 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

364 *
__¡ackaddr
)

365 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

368 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


369 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

370 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

375 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

376 
size_t
 
__¡acksize
)

377 
__THROW
 
	`__nÚnuÎ
 ((1));

379 #ifdeà
__USE_XOPEN2K


381 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

382 **
__»¡riù
 
__¡ackaddr
,

383 
size_t
 *
__»¡riù
 
__¡acksize
)

384 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

389 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

390 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

393 #ifdeà
__USE_GNU


396 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

397 
size_t
 
__ıu£tsize
,

398 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

399 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

403 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

404 
size_t
 
__ıu£tsize
,

405 
ıu_£t_t
 *
__ıu£t
)

406 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

409 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

410 
__THROW
 
	`__nÚnuÎ
 ((1));

414 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

415 
__THROW
 
	`__nÚnuÎ
 ((1));

420 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

421 
__THROW
 
	`__nÚnuÎ
 ((2));

429 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

430 cÚ¡ 
sched_·¿m
 *
__·¿m
)

431 
__THROW
 
	`__nÚnuÎ
 ((3));

434 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

435 *
__»¡riù
 
__pŞicy
,

436 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

437 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

440 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

441 
__THROW
;

444 #ifdeà
__USE_GNU


446 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

447 
size_t
 
__buæ’
)

448 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

452 
__THROW
 
	`__nÚnuÎ
 ((2));

456 #ifdeà
__USE_UNIX98


458 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

461 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

464 #ifdeà
__USE_GNU


469 
	$±h»ad_y›ld
 (è
__THROW
;

474 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

475 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

476 
__THROW
 
	`__nÚnuÎ
 ((3));

479 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

480 
ıu_£t_t
 *
__ıu£t
)

481 
__THROW
 
	`__nÚnuÎ
 ((3));

494 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

495 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

506 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

510 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

513 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

518 
	`±h»ad_‹¡ÿnûl
 ();

527 
__jmp_buf
 
__ÿnûl_jmp_buf
;

528 
__mask_was_§ved
;

529 } 
__ÿnûl_jmp_buf
[1];

530 *
__·d
[4];

531 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

534 #iâdeà
__ş—nup_fù_©Œibu‹


535 
	#__ş—nup_fù_©Œibu‹


	)

540 
	s__±h»ad_ş—nup_äame


542 (*
__ÿnûl_routše
) (*);

543 *
__ÿnûl_¬g
;

544 
__do_™
;

545 
__ÿnûl_ty³
;

548 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


549 #ifdeà
__ılu¥lus


551 şas 
	c__±h»ad_ş—nup_şass


553 (*
__ÿnûl_routše
) (*);

554 *
__ÿnûl_¬g
;

555 
__do_™
;

556 
__ÿnûl_ty³
;

558 
public
:

559 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

560 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

561 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

562 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

563 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

564 &
__ÿnûl_ty³
); 
	}
}

565 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

575 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

577 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

581 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

582 
__şäame
.
	`__£tdo™
 (
execu‹
); \

583 } 0)

	)

585 #ifdeà
__USE_GNU


589 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

591 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

592 
__şäame
.
	`__deãr
 ()

	)

597 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

598 
__şäame
.
	`__»¡Üe
 (); \

599 
__şäame
.
	`__£tdo™
 (
execu‹
); \

600 } 0)

	)

607 
__ex‹º_šlše
 

608 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

610 ià(
__äame
->
__do_™
)

611 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

612 
	}
}

621 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

623 
__±h»ad_ş—nup_äame
 
__şäame
 \

624 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

625 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

626 .
__do_™
 = 1 };

	)

630 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

631 
__şäame
.
__do_™
 = (
execu‹
); \

632 } 0)

	)

634 #ifdeà
__USE_GNU


638 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

640 
__±h»ad_ş—nup_äame
 
__şäame
 \

641 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

642 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

643 .
__do_™
 = 1 }; \

644 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

645 &
__şäame
.
__ÿnûl_ty³
)

	)

650 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

651 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

652 
__şäame
.
__do_™
 = (
execu‹
); \

653 } 0)

	)

664 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

666 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

667 (*
__ÿnûl_routše
è(*èğ(
routše
); \

668 *
__ÿnûl_¬g
 = (
¬g
); \

669 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

670 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

671 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

673 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

674 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

678 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

679 dØ{

	)

680 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

681 
__ş—nup_fù_©Œibu‹
;

685 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

688 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

689 ià(
execu‹
) \

690 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

691 } 0)

	)

692 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

693 
__ş—nup_fù_©Œibu‹
;

695 #ifdeà
__USE_GNU


699 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

701 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

702 (*
__ÿnûl_routše
è(*èğ(
routše
); \

703 *
__ÿnûl_¬g
 = (
¬g
); \

704 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

705 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

706 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

708 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

709 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

713 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

714 dØ{

	)

715 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

716 
__ş—nup_fù_©Œibu‹
;

721 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

724 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

725 ià(
execu‹
) \

726 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

727 
	}
} 0)

	)

728 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

729 
__ş—nup_fù_©Œibu‹
;

733 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

734 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

735 #iâdeà
SHARED


736 
	`__©Œibu‹__
 ((
__w—k__
))

742 
__jmp_buf_g
;

743 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

749 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

750 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

751 
__THROW
 
	`__nÚnuÎ
 ((1));

754 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

755 
__THROW
 
	`__nÚnuÎ
 ((1));

758 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

759 
__THROWNL
 
	`__nÚnuÎ
 ((1));

762 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

763 
__THROWNL
 
	`__nÚnuÎ
 ((1));

765 #ifdeà
__USE_XOPEN2K


767 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

768 cÚ¡ 
time¥ec
 *
__»¡riù


769 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

773 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

774 
__THROWNL
 
	`__nÚnuÎ
 ((1));

778 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

779 
__»¡riù
 
__mu‹x
,

780 *
__»¡riù
 
__´ioûšg
)

781 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

785 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

786 
__´ioûšg
,

787 *
__»¡riù
 
__Şd_ûšg
)

788 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

791 #ifdeà
__USE_XOPEN2K8


793 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

794 
__THROW
 
	`__nÚnuÎ
 ((1));

795 #ifdeà
__USE_GNU


796 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

797 
__THROW
 
	`__nÚnuÎ
 ((1));

806 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

807 
__THROW
 
	`__nÚnuÎ
 ((1));

810 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

811 
__THROW
 
	`__nÚnuÎ
 ((1));

814 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

815 
__»¡riù
 
__©Œ
,

816 *
__»¡riù
 
__psh¬ed
)

817 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

820 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

821 
__psh¬ed
)

822 
__THROW
 
	`__nÚnuÎ
 ((1));

824 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


826 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


827 
__©Œ
, *
__»¡riù
 
__kšd
)

828 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

833 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

834 
__THROW
 
	`__nÚnuÎ
 ((1));

838 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

839 
__»¡riù
 
__©Œ
,

840 *
__»¡riù
 
__´ÙocŞ
)

841 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

845 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

846 
__´ÙocŞ
)

847 
__THROW
 
	`__nÚnuÎ
 ((1));

850 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

851 
__»¡riù
 
__©Œ
,

852 *
__»¡riù
 
__´ioûšg
)

853 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__´ioûšg
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

860 #ifdeà
__USE_XOPEN2K


862 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

863 *
__robu¡Ãss
)

864 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

865 #ifdeà
__USE_GNU


866 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

867 *
__robu¡Ãss
)

868 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

872 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

873 
__robu¡Ãss
)

874 
__THROW
 
	`__nÚnuÎ
 ((1));

875 #ifdeà
__USE_GNU


876 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

877 
__robu¡Ãss
)

878 
__THROW
 
	`__nÚnuÎ
 ((1));

883 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


888 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

889 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


890 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

893 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

894 
__THROW
 
	`__nÚnuÎ
 ((1));

897 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

898 
__THROWNL
 
	`__nÚnuÎ
 ((1));

901 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

902 
__THROWNL
 
	`__nÚnuÎ
 ((1));

904 #ifdeà
__USE_XOPEN2K


906 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

907 cÚ¡ 
time¥ec
 *
__»¡riù


908 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

912 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__nÚnuÎ
 ((1));

916 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

917 
__THROWNL
 
	`__nÚnuÎ
 ((1));

919 #ifdeà
__USE_XOPEN2K


921 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

922 cÚ¡ 
time¥ec
 *
__»¡riù


923 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

927 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__nÚnuÎ
 ((1));

934 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

935 
__THROW
 
	`__nÚnuÎ
 ((1));

938 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

939 
__THROW
 
	`__nÚnuÎ
 ((1));

942 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

943 
__»¡riù
 
__©Œ
,

944 *
__»¡riù
 
__psh¬ed
)

945 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

948 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

949 
__psh¬ed
)

950 
__THROW
 
	`__nÚnuÎ
 ((1));

953 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

954 
__»¡riù
 
__©Œ
,

955 *
__»¡riù
 
__´ef
)

956 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

959 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

960 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

968 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

969 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

970 
__THROW
 
	`__nÚnuÎ
 ((1));

973 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

974 
__THROW
 
	`__nÚnuÎ
 ((1));

977 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

978 
__THROWNL
 
	`__nÚnuÎ
 ((1));

981 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

982 
__THROWNL
 
	`__nÚnuÎ
 ((1));

989 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

990 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

991 
	`__nÚnuÎ
 ((1, 2));

1000 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1001 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1002 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1003 
	`__nÚnuÎ
 ((1, 2, 3));

1008 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1009 
__THROW
 
	`__nÚnuÎ
 ((1));

1012 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1013 
__THROW
 
	`__nÚnuÎ
 ((1));

1016 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1017 
__»¡riù
 
__©Œ
,

1018 *
__»¡riù
 
__psh¬ed
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1022 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1023 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1025 #ifdeà
__USE_XOPEN2K


1027 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1028 
__»¡riù
 
__©Œ
,

1029 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1030 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1033 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1034 
__şockid_t
 
__şock_id
)

1035 
__THROW
 
	`__nÚnuÎ
 ((1));

1039 #ifdeà
__USE_XOPEN2K


1044 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1045 
__THROW
 
	`__nÚnuÎ
 ((1));

1048 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1049 
__THROW
 
	`__nÚnuÎ
 ((1));

1052 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1053 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1056 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1057 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1060 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1061 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1068 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1069 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1070 
__©Œ
, 
__couÁ
)

1071 
__THROW
 
	`__nÚnuÎ
 ((1));

1074 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1075 
__THROW
 
	`__nÚnuÎ
 ((1));

1078 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1079 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1083 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1084 
__THROW
 
	`__nÚnuÎ
 ((1));

1087 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1088 
__THROW
 
	`__nÚnuÎ
 ((1));

1091 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1092 
__»¡riù
 
__©Œ
,

1093 *
__»¡riù
 
__psh¬ed
)

1094 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1097 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1098 
__psh¬ed
)

1099 
__THROW
 
	`__nÚnuÎ
 ((1));

1111 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1112 (*
__de¡r_funùiÚ
) (*))

1113 
__THROW
 
	`__nÚnuÎ
 ((1));

1116 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1119 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1122 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1123 cÚ¡ *
__poš‹r
è
__THROW
 ;

1126 #ifdeà
__USE_XOPEN2K


1128 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1129 
__şockid_t
 *
__şock_id
)

1130 
__THROW
 
	`__nÚnuÎ
 ((2));

1145 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1146 (*
__·»Á
) (),

1147 (*
__chd
è()è
__THROW
;

1150 #ifdeà
__USE_EXTERN_INLINES


1152 
__ex‹º_šlše
 

1153 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1155  
__th»ad1
 =ğ
__th»ad2
;

1156 
	}
}

1159 
	g__END_DECLS


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


24 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	~<b™s/sig£t.h
>

36 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


37 #iâdeà
__sig_©omic_t_defšed


38 
	#__sig_©omic_t_defšed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #undeà
__Ãed_sig_©omic_t


46 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

47 #iâdeà
__sig£t_t_defšed


48 
	#__sig£t_t_defšed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #undeà
__Ãed_sig£t_t


54 #ifdeà
_SIGNAL_H


56 
	~<b™s/ty³s.h
>

57 
	~<b™s/signum.h
>

59 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


60 #iâdeà
__pid_t_defšed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defšed


	)

64 #ifdeà
__USE_XOPEN


66 #iâdeà
__uid_t_defšed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defšed


	)

72 #ifdeà
__USE_POSIX199309


74 
	#__Ãed_time¥ec


	)

75 
	~<time.h
>

78 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


80 
	~<b™s/sigšfo.h
>

85 (*
	t__sighªdËr_t
) ();

90 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

91 
__THROW
;

92 #ifdeà
__USE_GNU


93 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifdeà
__USE_MISC


102 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

103 
__THROW
;

106 #ifdeà
__REDIRECT_NTH


107 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

108 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

109 
__sysv_sigÇl
);

111 
	#sigÇl
 
__sysv_sigÇl


	)

114 
__END_NAMESPACE_STD


116 #ifdeà
__USE_XOPEN


119 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

120 
__THROW
;

126 #ifdeà
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

130 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


134 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$¿i£
 (
__sig
è
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifdeà
__USE_MISC


144 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

145 
__THROW
;

146 
	$gsigÇl
 (
__sig
è
__THROW
;

149 #ifdeà
__USE_XOPEN2K8


151 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

154 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

166 #ifdeà
__USE_XOPEN


167 #ifdeà
__GNUC__


168 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

170 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

172 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

177 #ifdeà
__USE_MISC


184 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

187 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

190 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

193 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

197 #ifdeà
__USE_MISC


198 
	#NSIG
 
_NSIG


	)

201 #ifdeà
__USE_GNU


202 
__sighªdËr_t
 
	tsighªdËr_t
;

206 #ifdeà
__USE_MISC


207 
__sighªdËr_t
 
	tsig_t
;

210 #ifdeà
__USE_POSIX


213 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

216 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

219 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

222 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

225 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

226 
__THROW
 
	`__nÚnuÎ
 ((1));

228 #ifdeà
__USE_GNU


230 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

233 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

234 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

237 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

238 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

243 
	~<b™s/sigaùiÚ.h
>

246 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

247 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

254 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

257 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

258 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

261 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

268 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

269 
	`__nÚnuÎ
 ((1, 2));

271 #ifdeà
__USE_POSIX199309


276 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

277 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

284 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

285 
sigšfo_t
 *
__»¡riù
 
__šfo
,

286 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

287 
	`__nÚnuÎ
 ((1));

291 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

292 
__THROW
;

297 #ifdeà
__USE_MISC


301 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

302 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

306 
	~<b™s/sigcÚ‹xt.h
>

309 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

314 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


315 
	#__Ãed_size_t


	)

316 
	~<¡ddef.h
>

321 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

323 
	~<b™s/sig¡ack.h
>

324 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


326 
	~<sys/ucÚ‹xt.h
>

332 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

333 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

337 
	$sig®t¡ack
 (cÚ¡ 
sig®t¡ack
 *
__»¡riù
 
__ss
,

338 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

342 #ifdeà
__USE_XOPEN_EXTENDED


346 
	$sighŞd
 (
__sig
è
__THROW
;

349 
	$sig»l£
 (
__sig
è
__THROW
;

352 
	$sigignÜe
 (
__sig
è
__THROW
;

355 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

358 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


361 
	~<b™s/±h»adty³s.h
>

362 
	~<b™s/sigth»ad.h
>

369 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

371 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

375 
__END_DECLS


	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/wch¬.h
>

27 
	~<b™s/wÜdsize.h
>

34 #iâdeà
__št8_t_defšed


35 
	#__št8_t_defšed


	)

36 sigÃd 
	tšt8_t
;

37 
	tšt16_t
;

38 
	tšt32_t
;

39 #ià
__WORDSIZE
 == 64

40 
	tšt64_t
;

42 
__ex‹nsiÚ__


43 
	tšt64_t
;

48 
	tušt8_t
;

49 
	tušt16_t
;

50 #iâdeà
__ušt32_t_defšed


51 
	tušt32_t
;

52 
	#__ušt32_t_defšed


	)

54 #ià
__WORDSIZE
 == 64

55 
	tušt64_t
;

57 
__ex‹nsiÚ__


58 
	tušt64_t
;

65 sigÃd 
	tšt_Ëa¡8_t
;

66 
	tšt_Ëa¡16_t
;

67 
	tšt_Ëa¡32_t
;

68 #ià
__WORDSIZE
 == 64

69 
	tšt_Ëa¡64_t
;

71 
__ex‹nsiÚ__


72 
	tšt_Ëa¡64_t
;

76 
	tušt_Ëa¡8_t
;

77 
	tušt_Ëa¡16_t
;

78 
	tušt_Ëa¡32_t
;

79 #ià
__WORDSIZE
 == 64

80 
	tušt_Ëa¡64_t
;

82 
__ex‹nsiÚ__


83 
	tušt_Ëa¡64_t
;

90 sigÃd 
	tšt_ç¡8_t
;

91 #ià
__WORDSIZE
 == 64

92 
	tšt_ç¡16_t
;

93 
	tšt_ç¡32_t
;

94 
	tšt_ç¡64_t
;

96 
	tšt_ç¡16_t
;

97 
	tšt_ç¡32_t
;

98 
__ex‹nsiÚ__


99 
	tšt_ç¡64_t
;

103 
	tušt_ç¡8_t
;

104 #ià
__WORDSIZE
 == 64

105 
	tušt_ç¡16_t
;

106 
	tušt_ç¡32_t
;

107 
	tušt_ç¡64_t
;

109 
	tušt_ç¡16_t
;

110 
	tušt_ç¡32_t
;

111 
__ex‹nsiÚ__


112 
	tušt_ç¡64_t
;

117 #ià
__WORDSIZE
 == 64

118 #iâdeà
__šŒ_t_defšed


119 
	tšŒ_t
;

120 
	#__šŒ_t_defšed


	)

122 
	tušŒ_t
;

124 #iâdeà
__šŒ_t_defšed


125 
	tšŒ_t
;

126 
	#__šŒ_t_defšed


	)

128 
	tušŒ_t
;

133 #ià
__WORDSIZE
 == 64

134 
	tštmax_t
;

135 
	tuštmax_t
;

137 
__ex‹nsiÚ__


138 
	tštmax_t
;

139 
__ex‹nsiÚ__


140 
	tuštmax_t
;

144 #ià
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
èø## 
L


	)

146 
	#__UINT64_C
(
c
èø## 
UL


	)

148 
	#__INT64_C
(
c
èø## 
LL


	)

149 
	#__UINT64_C
(
c
èø## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #ià
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #ià
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #ià
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #ià
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #ià
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #ià
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 #ifdeà
__WORDSIZE32_SIZE_ULONG


264 
	#SIZE_MAX
 (4294967295UL)

	)

266 
	#SIZE_MAX
 (4294967295U)

	)

271 #iâdeà
WCHAR_MIN


273 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

274 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

278 
	#WINT_MIN
 (0u)

	)

279 
	#WINT_MAX
 (4294967295u)

	)

282 
	#INT8_C
(
c
è
	)
c

283 
	#INT16_C
(
c
è
	)
c

284 
	#INT32_C
(
c
è
	)
c

285 #ià
__WORDSIZE
 == 64

286 
	#INT64_C
(
c
èø## 
L


	)

288 
	#INT64_C
(
c
èø## 
LL


	)

292 
	#UINT8_C
(
c
è
	)
c

293 
	#UINT16_C
(
c
è
	)
c

294 
	#UINT32_C
(
c
èø## 
U


	)

295 #ià
__WORDSIZE
 == 64

296 
	#UINT64_C
(
c
èø## 
UL


	)

298 
	#UINT64_C
(
c
èø## 
ULL


	)

302 #ià
__WORDSIZE
 == 64

303 
	#INTMAX_C
(
c
èø## 
L


	)

304 
	#UINTMAX_C
(
c
èø## 
UL


	)

306 
	#INTMAX_C
(
c
èø## 
LL


	)

307 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ifdeà
__USE_XOPEN2K8


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

101 #iâdeà
__ssize_t_defšed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defšed


	)

108 
__BEGIN_NAMESPACE_STD


109 #iâdeà
__USE_FILE_OFFSET64


110 
_G_åos_t
 
	tåos_t
;

112 
_G_åos64_t
 
	tåos_t
;

114 
__END_NAMESPACE_STD


115 #ifdeà
__USE_LARGEFILE64


116 
_G_åos64_t
 
	tåos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #iâdeà
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #iâdeà
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifdeà
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


151 
	#P_tmpdœ
 "/tmp"

	)

164 
	~<b™s/¡dio_lim.h
>

168 
_IO_FILE
 *
¡dš
;

169 
_IO_FILE
 *
¡dout
;

170 
_IO_FILE
 *
¡d”r
;

172 
	#¡dš
 
¡dš


	)

173 
	#¡dout
 
¡dout


	)

174 
	#¡d”r
 
¡d”r


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

180 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifdeà
__USE_ATFILE


185 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

186 cÚ¡ *
__Ãw
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #iâdeà
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfe
 (è
__wur
;

197 #ifdeà
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

200 
	#tmpfe
 
tmpfe64


	)

204 #ifdeà
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfe64
 (è
__wur
;

209 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifdeà
__USE_MISC


215 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

219 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


227 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

228 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fşo£
 (
FILE
 *
__¡»am
);

242 
	`fæush
 (
FILE
 *
__¡»am
);

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_MISC


252 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

255 #ifdeà
__USE_GNU


262 
	`fşo£®l
 ();

266 
__BEGIN_NAMESPACE_STD


267 #iâdeà
__USE_FILE_OFFSET64


272 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

273 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

278 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

279 cÚ¡ *
__»¡riù
 
__modes
,

280 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

282 #ifdeà
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

284 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

287 cÚ¡ *
__»¡riù
 
__modes
,

288 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

289 
__wur
;

291 
	#fİ’
 
fİ’64


	)

292 
	#äeİ’
 
äeİ’64


	)

295 
__END_NAMESPACE_STD


296 #ifdeà
__USE_LARGEFILE64


297 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

298 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

299 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
,

301 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

313 cÚ¡ *
__»¡riù
 
__modes
,

314 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

317 #ifdeà
__USE_XOPEN2K8


319 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

337 
__modes
, 
size_t
 
__n
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_MISC


343 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

344 
size_t
 
__size
è
__THROW
;

347 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

357 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

362 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	$¥rštf
 (*
__»¡riù
 
__s
,

365 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

371 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

372 
_G_va_li¡
 
__¬g
);

377 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

379 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

380 
_G_va_li¡
 
__¬g
è
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

387 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

388 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

390 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

391 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

392 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifdeà
__USE_GNU


399 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

400 
_G_va_li¡
 
__¬g
)

401 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

402 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

403 cÚ¡ *
__»¡riù
 
__fmt
, ...)

404 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

405 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

406 cÚ¡ *
__»¡riù
 
__fmt
, ...)

407 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

410 #ifdeà
__USE_XOPEN2K8


412 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

413 
_G_va_li¡
 
__¬g
)

414 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

415 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

426 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

431 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

434 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

436 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

444 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

445 
__isoc99_fsÿnf
è
__wur
;

446 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_sÿnf
è
__wur
;

448 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

449 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

450 
__isoc99_ssÿnf
);

452 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

454 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

455 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

456 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

457 
	#fsÿnf
 
__isoc99_fsÿnf


	)

458 
	#sÿnf
 
__isoc99_sÿnf


	)

459 
	#ssÿnf
 
__isoc99_ssÿnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

472 
_G_va_li¡
 
__¬g
)

473 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

479 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

480 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

483 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

484 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

485 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

487 #ià!
defšed
 
__USE_GNU
 \

488 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

489 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

490 #ifdeà
__REDIRECT


494 
	`__REDIRECT
 (
vfsÿnf
,

495 (
FILE
 *
__»¡riù
 
__s
,

496 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

497 
__isoc99_vfsÿnf
)

498 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

499 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

500 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

501 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

502 
	`__REDIRECT_NTH
 (
vssÿnf
,

503 (cÚ¡ *
__»¡riù
 
__s
,

504 cÚ¡ *
__»¡riù
 
__fÜm©
,

505 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

506 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

508 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

509 cÚ¡ *
__»¡riù
 
__fÜm©
,

510 
_G_va_li¡
 
__¬g
è
__wur
;

511 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

514 cÚ¡ *
__»¡riù
 
__fÜm©
,

515 
_G_va_li¡
 
__¬g
è
__THROW
;

516 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

517 
	#vsÿnf
 
__isoc99_vsÿnf


	)

518 
	#vssÿnf
 
__isoc99_vssÿnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fg‘c
 (
FILE
 *
__¡»am
);

532 
	`g‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘ch¬
 ();

539 
__END_NAMESPACE_STD


543 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

545 #ifdeà
__USE_POSIX


550 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

551 
	`g‘ch¬_uÆocked
 ();

554 #ifdeà
__USE_MISC


561 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

574 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putch¬
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

587 #ifdeà
__USE_MISC


594 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

597 #ifdeà
__USE_POSIX


602 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 
	`putch¬_uÆocked
 (
__c
);

607 #ià
defšed
 
__USE_MISC
 \

608 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

610 
	`g‘w
 (
FILE
 *
__¡»am
);

613 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

623 
__wur
;

625 #ià!
defšed
 
__USE_ISOC11
 \

626 || (
defšed
 
__ılu¥lus
 && __cplusplus <= 201103L)

638 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

640 
__END_NAMESPACE_STD


642 #ifdeà
__USE_GNU


649 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

650 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

668 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

669 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

670 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

678 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

679 
size_t
 *
__»¡riù
 
__n
,

680 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

695 
	`puts
 (cÚ¡ *
__s
);

702 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

709 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

715 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

716 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifdeà
__USE_GNU


726 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

727 
FILE
 *
__»¡riù
 
__¡»am
);

730 #ifdeà
__USE_MISC


737 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

754 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

759 
	`»wšd
 (
FILE
 *
__¡»am
);

760 
__END_NAMESPACE_STD


767 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


768 #iâdeà
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

778 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

780 #ifdeà
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#á–lo
 
á–lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #iâdeà
__USE_FILE_OFFSET64


798 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

803 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

805 #ifdeà
__REDIRECT


806 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

807 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

808 
	`__REDIRECT
 (
f£os
,

809 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

811 
	#fg‘pos
 
fg‘pos64


	)

812 
	#f£os
 
f£os64


	)

815 
__END_NAMESPACE_STD


817 #ifdeà
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

819 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

820 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

821 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

828 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifdeà
__USE_MISC


835 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

836 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

837 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`³¼Ü
 (cÚ¡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<b™s/sys_”¾i¡.h
>

856 #ifdef 
__USE_POSIX


858 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

861 #ifdeà
__USE_MISC


863 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

867 #ifdeà
__USE_POSIX2


872 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

878 
	`pşo£
 (
FILE
 *
__¡»am
);

882 #ifdef 
__USE_POSIX


884 *
	$ù”mid
 (*
__s
è
__THROW
;

888 #ifdeà
__USE_XOPEN


890 *
	`cu£rid
 (*
__s
);

894 #ifdef 
__USE_GNU


895 
ob¡ack
;

898 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

899 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

900 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

901 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

902 cÚ¡ *
__»¡riù
 
__fÜm©
,

903 
_G_va_li¡
 
__¬gs
)

904 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

908 #ifdeà
__USE_POSIX


912 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

916 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

919 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

922 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


926 
	#__Ãed_g‘İt


	)

927 
	~<g‘İt.h
>

932 #ifdeà
__USE_EXTERN_INLINES


933 
	~<b™s/¡dio.h
>

935 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


936 
	~<b™s/¡dio2.h
>

938 #ifdeà
__LDBL_COMPAT


939 
	~<b™s/¡dio-ldbl.h
>

942 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_MISC


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ifdeà
__USE_ISOC99


155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifdeà
__USE_MISC


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ifdeà
__USE_ISOC99


206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ifdeà
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Şd_x
[3];

416 
__c
;

417 
__š™
;

418 
__ex‹nsiÚ__
 
__a
;

423 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

424 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

425 
	$”ªd48_r
 (
__xsubi
[3],

426 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

427 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

431 *
__»¡riù
 
__»suÉ
)

432 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

433 
	$Äªd48_r
 (
__xsubi
[3],

434 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

435 *
__»¡riù
 
__»suÉ
)

436 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

439 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

442 
	$j¿nd48_r
 (
__xsubi
[3],

443 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

444 *
__»¡riù
 
__»suÉ
)

445 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

448 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$lcÚg48_r
 (
__·¿m
[7],

455 
d¿nd48_d©a
 *
__bufãr
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

462 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


463 
	#__m®loc_ªd_ÿÎoc_defšed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

468 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

469 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

483 
	$ä“
 (*
__±r
è
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$cä“
 (*
__±r
è
__THROW
;

491 #ifdeà
__USE_MISC


492 
	~<®loÿ.h
>

495 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

496 || 
defšed
 
__USE_MISC


498 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

501 #ifdeà
__USE_XOPEN2K


503 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

504 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

507 #ifdeà
__USE_ISOC11


509 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

510 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

521 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


523 #ifdeà
__ılu¥lus


524 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

527 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

536 
__THROW
 
	`__nÚnuÎ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

545 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


549 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

551 
__END_NAMESPACE_STD


553 #ifdeà
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

565 
__END_NAMESPACE_STD


567 #ifdeà
__USE_GNU


570 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

571 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

574 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


578 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

581 #ifdeà
__USE_XOPEN2K


584 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

585 
__THROW
 
	`__nÚnuÎ
 ((2));

588 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$ş—»nv
 (è
__THROW
;

599 #ià
defšed
 
__USE_MISC
 \

600 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

609 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


618 #iâdeà
__USE_FILE_OFFSET64


619 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

621 #ifdeà
__REDIRECT


622 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

623 
	`__nÚnuÎ
 ((1)è
__wur
;

625 
	#mk¡emp
 
mk¡emp64


	)

628 #ifdeà
__USE_LARGEFILE64


629 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

633 #ifdeà
__USE_MISC


640 #iâdeà
__USE_FILE_OFFSET64


641 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

643 #ifdeà
__REDIRECT


644 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

645 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

647 
	#mk¡emps
 
mk¡emps64


	)

650 #ifdeà
__USE_LARGEFILE64


651 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

652 
	`__nÚnuÎ
 ((1)è
__wur
;

656 #ifdeà
__USE_XOPEN2K8


662 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

665 #ifdeà
__USE_GNU


672 #iâdeà
__USE_FILE_OFFSET64


673 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

675 #ifdeà
__REDIRECT


676 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

677 
	`__nÚnuÎ
 ((1)è
__wur
;

679 
	#mko¡emp
 
mko¡emp64


	)

682 #ifdeà
__USE_LARGEFILE64


683 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

692 #iâdeà
__USE_FILE_OFFSET64


693 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

694 
	`__nÚnuÎ
 ((1)è
__wur
;

696 #ifdeà
__REDIRECT


697 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

698 
__æags
), 
mko¡emps64
)

699 
	`__nÚnuÎ
 ((1)è
__wur
;

701 
	#mko¡emps
 
mko¡emps64


	)

704 #ifdeà
__USE_LARGEFILE64


705 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

706 
	`__nÚnuÎ
 ((1)è
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

724 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

727 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


733 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

734 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

739 #iâdeà
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com·r_â_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com·r_â_t
 
	tcom·risÚ_â_t
;

747 #ifdeà
__USE_GNU


748 (*
	t__com·r_d_â_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

755 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

756 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

758 #ifdeà
__USE_EXTERN_INLINES


759 
	~<b™s/¡dlib-b£¬ch.h
>

764 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

766 #ifdeà
__USE_GNU


767 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

768 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

769 
	`__nÚnuÎ
 ((1, 4));

774 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

775 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

776 
__END_NAMESPACE_STD


778 #ifdeà
__USE_ISOC99


779 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

780 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

784 
__BEGIN_NAMESPACE_STD


788 
div_t
 
	$div
 (
__num”
, 
__d’om
)

789 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

790 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

791 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

792 
__END_NAMESPACE_STD


794 #ifdeà
__USE_ISOC99


795 
__BEGIN_NAMESPACE_C99


796 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

797 
__d’om
)

798 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

799 
__END_NAMESPACE_C99


803 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

804 || 
defšed
 
__USE_MISC


811 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

812 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

817 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

818 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

823 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

824 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

827 #ifdeà
__USE_MISC


829 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

833 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

834 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

835 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

836 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

841 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

844 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

845 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

846 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

848 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

849 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

850 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

851 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

852 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

853 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

854 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

855 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

859 
__BEGIN_NAMESPACE_STD


862 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

865 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

866 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

869 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

873 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

874 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

876 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

877 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

878 
__THROW
;

879 
__END_NAMESPACE_STD


882 #ifdeà
__USE_MISC


887 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

891 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


898 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

899 *cÚ¡ *
__»¡riù
 
__tok’s
,

900 **
__»¡riù
 
__v®u•
)

901 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

905 #ifdeà
__USE_XOPEN


907 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

913 #ifdeà
__USE_XOPEN2KXSI


915 
	$posix_İ’±
 (
__oæag
è
__wur
;

918 #ifdeà
__USE_XOPEN


923 
	$g¿Á±
 (
__fd
è
__THROW
;

927 
	$uÆock±
 (
__fd
è
__THROW
;

932 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

935 #ifdeà
__USE_GNU


939 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

940 
__THROW
 
	`__nÚnuÎ
 ((2));

943 
	`g‘±
 ();

946 #ifdeà
__USE_MISC


950 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

951 
__THROW
 
	`__nÚnuÎ
 ((1));

954 
	~<b™s/¡dlib-æßt.h
>

957 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


958 
	~<b™s/¡dlib.h
>

960 #ifdeà
__LDBL_COMPAT


961 
	~<b™s/¡dlib-ldbl.h
>

965 #undeà
__Ãed_m®loc_ªd_ÿÎoc


967 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

35 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


54 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

65 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

69 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

74 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 #ifdeà
__OPTIMIZE__


78 
__ex‹º_®ways_šlše
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


81  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

84 
__ex‹º_®ways_šlše
 const *

85 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


87  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifdeà
__USE_GNU


100 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

107 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

128 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

129 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

133 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

137 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

141 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

151 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
 
	`__nÚnuÎ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifdeà
__USE_XOPEN2K8


159 
	~<xloÿË.h
>

162 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

163 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

165 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

166 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

169 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


171 *
	$¡rdup
 (cÚ¡ *
__s
)

172 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_XOPEN2K8


179 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

180 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


185 
	#¡rdu·
(
s
) \

186 (
__ex‹nsiÚ__
 \

188 cÚ¡ *
__Şd
 = (
s
); \

189 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

190 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

191 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

192 
	}
}))

	)

195 
	#¡ºdu·
(
s
, 
n
) \

196 (
__ex‹nsiÚ__
 \

198 cÚ¡ *
__Şd
 = (
s
); \

199 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

200 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

201 
__Ãw
[
__Ën
] = '\0'; \

202 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

203 }))

	)

206 
	g__BEGIN_NAMESPACE_STD


208 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


211 *
¡rchr
 (*
__s
, 
__c
)

212 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

213 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

214 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

216 #ifdeà
__OPTIMIZE__


217 
__ex‹º_®ways_šlše
 *

218 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


220  
__butš_¡rchr
 (
__s
, 
__c
);

223 
__ex‹º_®ways_šlše
 const *

224 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


226  
__butš_¡rchr
 (
__s
, 
__c
);

231 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

232 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

235 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


238 *
	`¡¼chr
 (*
__s
, 
__c
)

239 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

241 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

243 #ifdeà
__OPTIMIZE__


244 
__ex‹º_®ways_šlše
 *

245 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


247  
	`__butš_¡¼chr
 (
__s
, 
__c
);

250 
__ex‹º_®ways_šlše
 const *

251 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


253  
	`__butš_¡¼chr
 (
__s
, 
__c
);

256 
	}
}

258 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

259 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

261 
__END_NAMESPACE_STD


263 #ifdeà
__USE_GNU


266 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


267 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

268 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

269 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

270 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

272 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

273 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 
__BEGIN_NAMESPACE_STD


280 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

281 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

284 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


290 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

291 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

293 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

295 #ifdeà
__OPTIMIZE__


296 
__ex‹º_®ways_šlše
 *

297 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


299  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

302 
__ex‹º_®ways_šlše
 const *

303 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


305  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

308 
	}
}

310 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

311 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

314 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


317 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

318 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

320 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

322 #ifdeà
__OPTIMIZE__


323 
__ex‹º_®ways_šlše
 *

324 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


326  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

329 
__ex‹º_®ways_šlše
 const *

330 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


332  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

335 
	}
}

337 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

338 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

343 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

344 
__THROW
 
	`__nÚnuÎ
 ((2));

345 
__END_NAMESPACE_STD


349 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

350 cÚ¡ *
__»¡riù
 
__d–im
,

351 **
__»¡riù
 
__§ve_±r
)

352 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

353 #ifdeà
__USE_POSIX


354 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

355 **
__»¡riù
 
__§ve_±r
)

356 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

359 #ifdeà
__USE_GNU


361 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


362 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

363 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

364 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

365 cÚ¡ *
__ÃedË
)

366 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

368 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

369 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 #ifdeà
__USE_GNU


377 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

378 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

379 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

383 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

384 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

385 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

387 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

388 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

392 
__BEGIN_NAMESPACE_STD


394 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

395 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

396 
__END_NAMESPACE_STD


398 #ifdef 
__USE_XOPEN2K8


401 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

402 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

406 
__BEGIN_NAMESPACE_STD


408 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

409 
__END_NAMESPACE_STD


410 #ifdeà
__USE_XOPEN2K


418 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


421 #ifdeà
__REDIRECT_NTH


422 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

423 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

424 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

426 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

427 
__THROW
 
	`__nÚnuÎ
 ((2));

428 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

433 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

434 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

438 #ifdeà
__USE_XOPEN2K8


440 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

446 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

448 #ifdeà
__USE_MISC


450 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

451 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

457 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

458 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

461 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


464 *
	`šdex
 (*
__s
, 
__c
)

465 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

466 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

467 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

469 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


470 
__ex‹º_®ways_šlše
 *

471 
	`šdex
 (*
__s
, 
__c
è
__THROW


473  
	`__butš_šdex
 (
__s
, 
__c
);

476 
__ex‹º_®ways_šlše
 const *

477 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


479  
	`__butš_šdex
 (
__s
, 
__c
);

482 
	}
}

484 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

485 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

489 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


492 *
	`ršdex
 (*
__s
, 
__c
)

493 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

495 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

497 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


498 
__ex‹º_®ways_šlše
 *

499 
	`ršdex
 (*
__s
, 
__c
è
__THROW


501  
	`__butš_ršdex
 (
__s
, 
__c
);

504 
__ex‹º_®ways_šlše
 const *

505 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


507  
	`__butš_ršdex
 (
__s
, 
__c
);

510 
	}
}

512 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

513 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

518 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

522 #ifdef 
__USE_GNU


523 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

524 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

525 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

530 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

533 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

534 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

537 #ifdef 
__USE_GNU


540 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

541 
__loÿË_t
 
__loc
)

542 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

544 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

545 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

546 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

549 #ifdef 
__USE_MISC


552 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

553 cÚ¡ *
__»¡riù
 
__d–im
)

554 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdef 
__USE_XOPEN2K8


559 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

562 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

563 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

565 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

570 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

571 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

572 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

573 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 #ifdef 
__USE_GNU


579 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

580 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

583 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

586 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

588 #iâdeà
ba£Çme


593 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


594 "C++" *
	$ba£Çme
 (*
__f’ame
)

595 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

596 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

597 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

599 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

605 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

606 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

607 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


627 
	~<b™s/¡ršg.h
>

630 
	~<b™s/¡ršg2.h
>

633 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


635 
	~<b™s/¡ršg3.h
>

639 #ià
defšed
 
__USE_GNU
 && defšed 
__OPTIMIZE__
 \

640 && 
defšed
 
__ex‹º_®ways_šlše
 && 
	$__GNUC_PREREQ
 (3,2)

641 #ià!
defšed
 
_FORCE_INLINES
 && !defšed 
_HAVE_STRING_ARCH_mempıy


643 #undeà
mempıy


644 #undeà
__mempıy


645 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy_šlše
 (de¡, src,‚)

	)

646 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy_šlše
 (de¡, src,‚)

	)

648 
__ex‹º_®ways_šlše
 *

649 
	$__mempıy_šlše
 (*
__»¡riù
 
__de¡
,

650 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

652  (*è
	`memıy
 (
__de¡
, 
__¤c
, 
__n
) + __n;

653 
	}
}

658 
	g__END_DECLS


	@/usr/include/sys/epoll.h

18 #iâdef 
_SYS_EPOLL_H


19 
	#_SYS_EPOLL_H
 1

	)

21 
	~<¡dšt.h
>

22 
	~<sys/ty³s.h
>

25 
	~<b™s/sig£t.h
>

27 #iâdeà
__sig£t_t_defšed


28 
	#__sig£t_t_defšed


	)

29 
__sig£t_t
 
	tsig£t_t
;

33 
	~<b™s/•Şl.h
>

35 #iâdeà
__EPOLL_PACKED


36 
	#__EPOLL_PACKED


	)

40 
	eEPOLL_EVENTS


42 
	mEPOLLIN
 = 0x001,

43 
	#EPOLLIN
 
EPOLLIN


	)

44 
	mEPOLLPRI
 = 0x002,

45 
	#EPOLLPRI
 
EPOLLPRI


	)

46 
	mEPOLLOUT
 = 0x004,

47 
	#EPOLLOUT
 
EPOLLOUT


	)

48 
	mEPOLLRDNORM
 = 0x040,

49 
	#EPOLLRDNORM
 
EPOLLRDNORM


	)

50 
	mEPOLLRDBAND
 = 0x080,

51 
	#EPOLLRDBAND
 
EPOLLRDBAND


	)

52 
	mEPOLLWRNORM
 = 0x100,

53 
	#EPOLLWRNORM
 
EPOLLWRNORM


	)

54 
	mEPOLLWRBAND
 = 0x200,

55 
	#EPOLLWRBAND
 
EPOLLWRBAND


	)

56 
	mEPOLLMSG
 = 0x400,

57 
	#EPOLLMSG
 
EPOLLMSG


	)

58 
	mEPOLLERR
 = 0x008,

59 
	#EPOLLERR
 
EPOLLERR


	)

60 
	mEPOLLHUP
 = 0x010,

61 
	#EPOLLHUP
 
EPOLLHUP


	)

62 
	mEPOLLRDHUP
 = 0x2000,

63 
	#EPOLLRDHUP
 
EPOLLRDHUP


	)

64 
	mEPOLLWAKEUP
 = 1u << 29,

65 
	#EPOLLWAKEUP
 
EPOLLWAKEUP


	)

66 
	mEPOLLONESHOT
 = 1u << 30,

67 
	#EPOLLONESHOT
 
EPOLLONESHOT


	)

68 
	mEPOLLET
 = 1u << 31

69 
	#EPOLLET
 
EPOLLET


	)

74 
	#EPOLL_CTL_ADD
 1

	)

75 
	#EPOLL_CTL_DEL
 2

	)

76 
	#EPOLL_CTL_MOD
 3

	)

79 
	u•Şl_d©a


81 *
	m±r
;

82 
	mfd
;

83 
ušt32_t
 
	mu32
;

84 
ušt64_t
 
	mu64
;

85 } 
	t•Şl_d©a_t
;

87 
	s•Şl_ev’t


89 
ušt32_t
 
	mev’ts
;

90 
•Şl_d©a_t
 
	md©a
;

91 } 
	g__EPOLL_PACKED
;

94 
__BEGIN_DECLS


100 
	$•Şl_ü—‹
 (
__size
è
__THROW
;

104 
	$•Şl_ü—‹1
 (
__æags
è
__THROW
;

113 
	$•Şl_ùl
 (
__•fd
, 
__İ
, 
__fd
,

114 
•Şl_ev’t
 *
__ev’t
è
__THROW
;

127 
	`•Şl_wa™
 (
__•fd
, 
•Şl_ev’t
 *
__ev’ts
,

128 
__maxev’ts
, 
__timeout
);

136 
	`•Şl_pwa™
 (
__•fd
, 
•Şl_ev’t
 *
__ev’ts
,

137 
__maxev’ts
, 
__timeout
,

138 cÚ¡ 
__sig£t_t
 *
__ss
);

140 
__END_DECLS


	@/usr/include/sys/file.h

18 #iâdef 
_SYS_FILE_H


19 
	#_SYS_FILE_H
 1

	)

21 
	~<ã©u»s.h
>

23 #iâdef 
_FCNTL_H


24 
	~<fú.h
>

27 
	g__BEGIN_DECLS


32 #iâdeà
L_SET


33 
	#L_SET
 0

	)

34 
	#L_INCR
 1

	)

35 
	#L_XTND
 2

	)

40 
	#LOCK_SH
 1

	)

41 
	#LOCK_EX
 2

	)

42 
	#LOCK_UN
 8

	)

45 
	#LOCK_NB
 4

	)

50 
	$æock
 (
__fd
, 
__İ”©iÚ
è
__THROW
;

53 
__END_DECLS


	@/usr/include/sys/ioctl.h

18 #iâdef 
_SYS_IOCTL_H


19 
	#_SYS_IOCTL_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	g__BEGIN_DECLS


26 
	~<b™s/ioùls.h
>

29 
	~<b™s/ioùl-ty³s.h
>

36 
	~<sys/‰ydeçuÉs.h
>

41 
	$ioùl
 (
__fd
, 
__»que¡
, ...è
__THROW
;

43 
__END_DECLS


	@/usr/include/sys/param.h

19 #iâdeà
_SYS_PARAM_H


20 
	#_SYS_PARAM_H
 1

	)

22 
	#__Ãed_NULL


	)

23 
	~<¡ddef.h
>

25 
	~<sys/ty³s.h
>

26 
	~<lim™s.h
>

27 
	~<’dŸn.h
>

28 
	~<sigÇl.h
>

31 
	~<b™s/·¿m.h
>

36 
	#NBBY
 
CHAR_BIT


	)

38 #ià!
defšed
 
NGROUPS
 && defšed 
NGROUPS_MAX


39 
	#NGROUPS
 
NGROUPS_MAX


	)

41 #ià!
defšed
 
MAXSYMLINKS
 && defšed 
SYMLOOP_MAX


42 
	#MAXSYMLINKS
 
SYMLOOP_MAX


	)

44 #ià!
defšed
 
CANBSIZ
 && defšed 
MAX_CANON


45 
	#CANBSIZ
 
MAX_CANON


	)

47 #ià!
defšed
 
MAXPATHLEN
 && defšed 
PATH_MAX


48 
	#MAXPATHLEN
 
PATH_MAX


	)

50 #ià!
defšed
 
NOFILE
 && defšed 
OPEN_MAX


51 
	#NOFILE
 
OPEN_MAX


	)

53 #ià!
defšed
 
MAXHOSTNAMELEN
 && defšed 
HOST_NAME_MAX


54 
	#MAXHOSTNAMELEN
 
HOST_NAME_MAX


	)

56 #iâdeà
NCARGS


57 #ifdeà
ARG_MAX


58 
	#NCARGS
 
ARG_MAX


	)

62 
	#NCARGS
 
INT_MAX


	)

68 #iâdeà
NOGROUP


69 
	#NOGROUP
 65535

	)

71 #iâdeà
NODEV


72 
	#NODEV
 ((
dev_t
è-1è

	)

77 #iâdeà
DEV_BSIZE


78 
	#DEV_BSIZE
 512

	)

83 
	#£tb™
(
a
,
i
è(×)[(i)/
NBBY
] |ğ1<<((i)%NBBY))

	)

84 
	#şrb™
(
a
,
i
è(×)[(i)/
NBBY
] &ğ~(1<<((i)%NBBY)))

	)

85 
	#is£t
(
a
,
i
è(×)[(i)/
NBBY
] & (1<<((i)%NBBY)))

	)

86 
	#isşr
(
a
,
i
è((×)[(i)/
NBBY
] & (1<<((i)%NBBY))è=ğ0)

	)

89 #iâdeà
howmªy


90 
	#howmªy
(
x
, 
y
è(((xè+ ((yè- 1)è/ (y))

	)

92 #ifdeà
__GNUC__


93 
	#roundup
(
x
, 
y
è(
	`__butš_cÚ¡ªt_p
 (yè&& 
	`pow”of2
 (y) \

94 ? (((
x
è+ (
y
) - 1) & ~((y) - 1)) \

95 : ((((
x
è+ ((
y
è- 1)è/ (y)è* (y)))

	)

97 
	#roundup
(
x
, 
y
è((((xè+ ((yè- 1)è/ (y)è* (y))

	)

99 
	#pow”of2
(
x
è((((xè- 1è& (x)è=ğ0)

	)

102 
	#MIN
(
a
,
b
è((×)<(b))?×):(b))

	)

103 
	#MAX
(
a
,
b
è((×)>(b))?×):(b))

	)

	@/usr/include/sys/resource.h

18 #iâdef 
_SYS_RESOURCE_H


19 
	#_SYS_RESOURCE_H
 1

	)

21 
	~<ã©u»s.h
>

24 
	~<b™s/»sourû.h
>

26 #iâdeà
__id_t_defšed


27 
__id_t
 
	tid_t
;

28 
	#__id_t_defšed


	)

31 
	g__BEGIN_DECLS


37 #ià
defšed
 
__USE_GNU
 && !defšed 
__ılu¥lus


38 
__¾im™_»sourû
 
	t__¾im™_»sourû_t
;

39 
__ru§ge_who
 
	t__ru§ge_who_t
;

40 
__´iÜ™y_which
 
	t__´iÜ™y_which_t
;

42 
	t__¾im™_»sourû_t
;

43 
	t__ru§ge_who_t
;

44 
	t__´iÜ™y_which_t
;

49 #iâdeà
__USE_FILE_OFFSET64


50 
	$g‘¾im™
 (
__¾im™_»sourû_t
 
__»sourû
,

51 
¾im™
 *
__¾im™s
è
__THROW
;

53 #ifdeà
__REDIRECT_NTH


54 
	`__REDIRECT_NTH
 (
g‘¾im™
, (
__¾im™_»sourû_t
 
__»sourû
,

55 
¾im™
 *
__¾im™s
), 
g‘¾im™64
);

57 
	#g‘¾im™
 
g‘¾im™64


	)

60 #ifdeà
__USE_LARGEFILE64


61 
	$g‘¾im™64
 (
__¾im™_»sourû_t
 
__»sourû
,

62 
¾im™64
 *
__¾im™s
è
__THROW
;

68 #iâdeà
__USE_FILE_OFFSET64


69 
	$£Œlim™
 (
__¾im™_»sourû_t
 
__»sourû
,

70 cÚ¡ 
¾im™
 *
__¾im™s
è
__THROW
;

72 #ifdeà
__REDIRECT_NTH


73 
	`__REDIRECT_NTH
 (
£Œlim™
, (
__¾im™_»sourû_t
 
__»sourû
,

74 cÚ¡ 
¾im™
 *
__¾im™s
),

75 
£Œlim™64
);

77 
	#£Œlim™
 
£Œlim™64


	)

80 #ifdeà
__USE_LARGEFILE64


81 
	$£Œlim™64
 (
__¾im™_»sourû_t
 
__»sourû
,

82 cÚ¡ 
¾im™64
 *
__¾im™s
è
__THROW
;

87 
	$g‘ru§ge
 (
__ru§ge_who_t
 
__who
, 
ru§ge
 *
__u§ge
è
__THROW
;

93 
	$g‘´iÜ™y
 (
__´iÜ™y_which_t
 
__which
, 
id_t
 
__who
è
__THROW
;

97 
	$£riÜ™y
 (
__´iÜ™y_which_t
 
__which
, 
id_t
 
__who
, 
__´io
)

98 
__THROW
;

100 
__END_DECLS


	@/usr/include/sys/select.h

21 #iâdeà
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	~<b™s/£Ëù.h
>

33 
	~<b™s/sig£t.h
>

35 #iâdeà
__sig£t_t_defšed


36 
	#__sig£t_t_defšed


	)

37 
__sig£t_t
 
	tsig£t_t
;

41 
	#__Ãed_time_t


	)

42 
	#__Ãed_time¥ec


	)

43 
	~<time.h
>

44 
	#__Ãed_timev®


	)

45 
	~<b™s/time.h
>

47 #iâdeà
__su£cÚds_t_defšed


48 
__su£cÚds_t
 
	tsu£cÚds_t
;

49 
	#__su£cÚds_t_defšed


	)

54 
	t__fd_mask
;

57 #undeà
__NFDBITS


59 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

60 
	#__FD_ELT
(
d
è((dè/ 
__NFDBITS
)

	)

61 
	#__FD_MASK
(
d
è((
__fd_mask
è(1UL << ((dè% 
__NFDBITS
)))

	)

68 #ifdeà
__USE_XOPEN


69 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

70 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

72 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

75 } 
	tfd_£t
;

78 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

80 #ifdeà
__USE_MISC


82 
__fd_mask
 
	tfd_mask
;

85 
	#NFDBITS
 
__NFDBITS


	)

90 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

91 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

92 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

93 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

96 
__BEGIN_DECLS


106 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

107 
fd_£t
 *
__»¡riù
 
__wr™efds
,

108 
fd_£t
 *
__»¡riù
 
__exû±fds
,

109 
timev®
 *
__»¡riù
 
__timeout
);

111 #ifdeà
__USE_XOPEN2K


118 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

119 
fd_£t
 *
__»¡riù
 
__wr™efds
,

120 
fd_£t
 *
__»¡riù
 
__exû±fds
,

121 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

122 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

127 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__GNUC__


128 
	~<b™s/£Ëù2.h
>

131 
	g__END_DECLS


	@/usr/include/sys/socket.h

19 #iâdef 
_SYS_SOCKET_H


20 
	#_SYS_SOCKET_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	g__BEGIN_DECLS


26 
	~<sys/uio.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

29 #ifdeà
__USE_GNU


31 
	~<b™s/sig£t.h
>

38 
	~<b™s/sock‘.h
>

40 #ifdeà
__USE_MISC


43 
	sosockaddr


45 
	m§_çmy
;

46 
	m§_d©a
[14];

54 
	mSHUT_RD
 = 0,

55 
	#SHUT_RD
 
SHUT_RD


	)

56 
	mSHUT_WR
,

57 
	#SHUT_WR
 
SHUT_WR


	)

58 
	mSHUT_RDWR


59 
	#SHUT_RDWR
 
SHUT_RDWR


	)

68 #ià
defšed
 
__ılu¥lus
 || !
__GNUC_PREREQ
 (2, 7è|| !defšed 
__USE_GNU


69 
	#__SOCKADDR_ARG
 
sockaddr
 *
__»¡riù


	)

70 
	#__CONST_SOCKADDR_ARG
 cÚ¡ 
sockaddr
 *

	)

74 
	#__SOCKADDR_ALLTYPES
 \

75 
	`__SOCKADDR_ONETYPE
 (
sockaddr
) \

76 
	`__SOCKADDR_ONETYPE
 (
sockaddr_©
) \

77 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ax25
) \

78 
	`__SOCKADDR_ONETYPE
 (
sockaddr_dl
) \

79 
	`__SOCKADDR_ONETYPE
 (
sockaddr_eÚ
) \

80 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š
) \

81 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š6
) \

82 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š¬p
) \

83 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x
) \

84 
	`__SOCKADDR_ONETYPE
 (
sockaddr_iso
) \

85 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ns
) \

86 
	`__SOCKADDR_ONETYPE
 (
sockaddr_un
) \

87 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x25
)

	)

89 
	#__SOCKADDR_ONETYPE
(
ty³
èty³ *
__»¡riù
 
__
##ty³##__;

	)

90 uniÚ { 
	m__SOCKADDR_ALLTYPES


91 } 
	t__SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

92 #undeà
__SOCKADDR_ONETYPE


93 
	#__SOCKADDR_ONETYPE
(
ty³
ècÚ¡ ty³ *
__»¡riù
 
__
##ty³##__;

	)

94 uniÚ { 
	m__SOCKADDR_ALLTYPES


95 } 
	t__CONST_SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

96 #undeà
__SOCKADDR_ONETYPE


99 #ifdeà
__USE_GNU


101 
	smmsghdr


103 
msghdr
 
	mmsg_hdr
;

104 
	mmsg_Ën
;

113 
	$sock‘
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
è
__THROW
;

119 
	$sock‘·œ
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
,

120 
__fds
[2]è
__THROW
;

123 
	$bšd
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
)

124 
__THROW
;

127 
	$g‘sockÇme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

128 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

137 
	`cÚÃù
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
);

141 
	$g‘³”Çme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

142 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

149 
ssize_t
 
	`£nd
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
, 
__æags
);

156 
ssize_t
 
	`»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
);

163 
ssize_t
 
	`£ndto
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

164 
__æags
, 
__CONST_SOCKADDR_ARG
 
__addr
,

165 
sockËn_t
 
__addr_Ën
);

174 
ssize_t
 
	`»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

175 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

176 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

184 
ssize_t
 
	`£ndmsg
 (
__fd
, cÚ¡ 
msghdr
 *
__mes§ge
,

185 
__æags
);

187 #ifdeà
__USE_GNU


193 
	`£ndmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

194 
__vËn
, 
__æags
);

202 
ssize_t
 
	`»cvmsg
 (
__fd
, 
msghdr
 *
__mes§ge
, 
__æags
);

204 #ifdeà
__USE_GNU


210 
	`»cvmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

211 
__vËn
, 
__æags
,

212 
time¥ec
 *
__tmo
);

219 
	$g‘sockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

220 *
__»¡riù
 
__İtv®
,

221 
sockËn_t
 *
__»¡riù
 
__İ’
è
__THROW
;

226 
	$£tsockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

227 cÚ¡ *
__İtv®
, 
sockËn_t
 
__İ’
è
__THROW
;

233 
	$li¡’
 (
__fd
, 
__n
è
__THROW
;

243 
	`acû±
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

244 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

246 #ifdeà
__USE_GNU


251 
	`acû±4
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

252 
sockËn_t
 *
__»¡riù
 
__addr_Ën
, 
__æags
);

261 
	$shutdown
 (
__fd
, 
__how
è
__THROW
;

264 #ifdeà
__USE_XOPEN2K


266 
	$sock©m¬k
 (
__fd
è
__THROW
;

270 #ifdeà
__USE_MISC


274 
	$isfdty³
 (
__fd
, 
__fdty³
è
__THROW
;

279 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


280 
	~<b™s/sock‘2.h
>

283 
__END_DECLS


	@/usr/include/sys/stat.h

22 #iâdef 
_SYS_STAT_H


23 
	#_SYS_STAT_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K
 || defšed 
__USE_ATFILE


30 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


31 
	#__Ãed_time_t


	)

33 #ifdeà
__USE_ATFILE


34 
	#__Ãed_time¥ec


	)

36 
	~<time.h
>

39 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


42 #iâdeà
__dev_t_defšed


43 
__dev_t
 
	tdev_t
;

44 
	#__dev_t_defšed


	)

47 #iâdeà
__gid_t_defšed


48 
__gid_t
 
	tgid_t
;

49 
	#__gid_t_defšed


	)

52 #iâdeà
__šo_t_defšed


53 #iâdeà
__USE_FILE_OFFSET64


54 
__šo_t
 
	tšo_t
;

56 
__šo64_t
 
	tšo_t
;

58 
	#__šo_t_defšed


	)

61 #iâdeà
__mode_t_defšed


62 
__mode_t
 
	tmode_t
;

63 
	#__mode_t_defšed


	)

66 #iâdeà
__Æšk_t_defšed


67 
__Æšk_t
 
	tÆšk_t
;

68 
	#__Æšk_t_defšed


	)

71 #iâdeà
__off_t_defšed


72 #iâdeà
__USE_FILE_OFFSET64


73 
__off_t
 
	toff_t
;

75 
__off64_t
 
	toff_t
;

77 
	#__off_t_defšed


	)

80 #iâdeà
__uid_t_defšed


81 
__uid_t
 
	tuid_t
;

82 
	#__uid_t_defšed


	)

86 #ifdeà
__USE_UNIX98


87 #iâdeà
__blkút_t_defšed


88 #iâdeà
__USE_FILE_OFFSET64


89 
__blkút_t
 
	tblkút_t
;

91 
__blkút64_t
 
	tblkút_t
;

93 
	#__blkút_t_defšed


	)

96 #iâdeà
__blksize_t_defšed


97 
__blksize_t
 
	tblksize_t
;

98 
	#__blksize_t_defšed


	)

102 
	g__BEGIN_DECLS


104 
	~<b™s/¡©.h
>

106 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


107 
	#S_IFMT
 
__S_IFMT


	)

108 
	#S_IFDIR
 
__S_IFDIR


	)

109 
	#S_IFCHR
 
__S_IFCHR


	)

110 
	#S_IFBLK
 
__S_IFBLK


	)

111 
	#S_IFREG
 
__S_IFREG


	)

112 #ifdeà
__S_IFIFO


113 
	#S_IFIFO
 
__S_IFIFO


	)

115 #ifdeà
__S_IFLNK


116 
	#S_IFLNK
 
__S_IFLNK


	)

118 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_UNIX98
) \

119 && 
defšed
 
	g__S_IFSOCK


120 
	#S_IFSOCK
 
__S_IFSOCK


	)

126 
	#__S_ISTYPE
(
mode
, 
mask
è(((modeè& 
__S_IFMT
è=ğ(mask))

	)

128 
	#S_ISDIR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFDIR
)

	)

129 
	#S_ISCHR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFCHR
)

	)

130 
	#S_ISBLK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFBLK
)

	)

131 
	#S_ISREG
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFREG
)

	)

132 #ifdeà
__S_IFIFO


133 
	#S_ISFIFO
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFIFO
)

	)

135 #ifdeà
__S_IFLNK


136 
	#S_ISLNK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFLNK
)

	)

139 #ià
defšed
 
__USE_MISC
 && !defšed 
__S_IFLNK


140 
	#S_ISLNK
(
mode
è0

	)

143 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K
) \

144 && 
defšed
 
	g__S_IFSOCK


145 
	#S_ISSOCK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFSOCK
)

	)

146 #–ià
defšed
 
__USE_XOPEN2K


147 
	#S_ISSOCK
(
mode
è0

	)

154 #ifdef 
__USE_POSIX199309


155 
	#S_TYPEISMQ
(
buf
è
	`__S_TYPEISMQ
(buf)

	)

156 
	#S_TYPEISSEM
(
buf
è
	`__S_TYPEISSEM
(buf)

	)

157 
	#S_TYPEISSHM
(
buf
è
	`__S_TYPEISSHM
(buf)

	)

163 
	#S_ISUID
 
__S_ISUID


	)

164 
	#S_ISGID
 
__S_ISGID


	)

166 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


168 
	#S_ISVTX
 
__S_ISVTX


	)

171 
	#S_IRUSR
 
__S_IREAD


	)

172 
	#S_IWUSR
 
__S_IWRITE


	)

173 
	#S_IXUSR
 
__S_IEXEC


	)

175 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

177 #ifdeà
__USE_MISC


178 
	#S_IREAD
 
S_IRUSR


	)

179 
	#S_IWRITE
 
S_IWUSR


	)

180 
	#S_IEXEC
 
S_IXUSR


	)

183 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

184 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

185 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

187 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

189 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

190 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

191 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

193 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

196 #ifdef 
__USE_MISC


198 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
è

	)

199 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISVTX
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

200 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

202 
	#S_BLKSIZE
 512

	)

206 #iâdeà
__USE_FILE_OFFSET64


208 
	$¡©
 (cÚ¡ *
__»¡riù
 
__fe
,

209 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

213 
	$f¡©
 (
__fd
, 
¡©
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

215 #ifdeà
__REDIRECT_NTH


216 
	`__REDIRECT_NTH
 (
¡©
, (cÚ¡ *
__»¡riù
 
__fe
,

217 
¡©
 *
__»¡riù
 
__buf
), 
¡©64
)

218 
	`__nÚnuÎ
 ((1, 2));

219 
	`__REDIRECT_NTH
 (
f¡©
, (
__fd
, 
¡©
 *
__buf
), 
f¡©64
)

220 
	`__nÚnuÎ
 ((2));

222 
	#¡©
 
¡©64


	)

223 
	#f¡©
 
f¡©64


	)

226 #ifdeà
__USE_LARGEFILE64


227 
	$¡©64
 (cÚ¡ *
__»¡riù
 
__fe
,

228 
¡©64
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

229 
	$f¡©64
 (
__fd
, 
¡©64
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

232 #ifdeà
__USE_ATFILE


236 #iâdeà
__USE_FILE_OFFSET64


237 
	$f¡©©
 (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

238 
¡©
 *
__»¡riù
 
__buf
, 
__æag
)

239 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

241 #ifdeà
__REDIRECT_NTH


242 
	`__REDIRECT_NTH
 (
f¡©©
, (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

243 
¡©
 *
__»¡riù
 
__buf
,

244 
__æag
),

245 
f¡©©64
è
	`__nÚnuÎ
 ((2, 3));

247 
	#f¡©©
 
f¡©©64


	)

251 #ifdeà
__USE_LARGEFILE64


252 
	$f¡©©64
 (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

253 
¡©64
 *
__»¡riù
 
__buf
, 
__æag
)

254 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

258 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


259 #iâdeà
__USE_FILE_OFFSET64


262 
	$l¡©
 (cÚ¡ *
__»¡riù
 
__fe
,

263 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

265 #ifdeà
__REDIRECT_NTH


266 
	`__REDIRECT_NTH
 (
l¡©
,

267 (cÚ¡ *
__»¡riù
 
__fe
,

268 
¡©
 *
__»¡riù
 
__buf
), 
l¡©64
)

269 
	`__nÚnuÎ
 ((1, 2));

271 
	#l¡©
 
l¡©64


	)

274 #ifdeà
__USE_LARGEFILE64


275 
	$l¡©64
 (cÚ¡ *
__»¡riù
 
__fe
,

276 
¡©64
 *
__»¡riù
 
__buf
)

277 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

283 
	$chmod
 (cÚ¡ *
__fe
, 
__mode_t
 
__mode
)

284 
__THROW
 
	`__nÚnuÎ
 ((1));

286 #ifdeà
__USE_MISC


290 
	$lchmod
 (cÚ¡ *
__fe
, 
__mode_t
 
__mode
)

291 
__THROW
 
	`__nÚnuÎ
 ((1));

295 #ifdeà
__USE_POSIX


296 
	$fchmod
 (
__fd
, 
__mode_t
 
__mode
è
__THROW
;

299 #ifdeà
__USE_ATFILE


302 
	$fchmod©
 (
__fd
, cÚ¡ *
__fe
, 
__mode_t
 
__mode
,

303 
__æag
)

304 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 
__mode_t
 
	$umask
 (
__mode_t
 
__mask
è
__THROW
;

313 #ifdef 
__USE_GNU


316 
__mode_t
 
	$g‘umask
 (è
__THROW
;

320 
	$mkdœ
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

321 
__THROW
 
	`__nÚnuÎ
 ((1));

323 #ifdeà
__USE_ATFILE


327 
	$mkdœ©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

328 
__THROW
 
	`__nÚnuÎ
 ((2));

334 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


335 
	$mknod
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
)

336 
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_ATFILE


342 
	$mknod©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

343 
__dev_t
 
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2));

349 
	$mkfifo
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

350 
__THROW
 
	`__nÚnuÎ
 ((1));

352 #ifdeà
__USE_ATFILE


356 
	$mkfifßt
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

357 
__THROW
 
	`__nÚnuÎ
 ((2));

360 #ifdeà
__USE_ATFILE


363 
	$utim’§t
 (
__fd
, cÚ¡ *
__·th
,

364 cÚ¡ 
time¥ec
 
__times
[2],

365 
__æags
)

366 
__THROW
 
	`__nÚnuÎ
 ((2));

369 #ifdeà
__USE_XOPEN2K8


371 
	$futim’s
 (
__fd
, cÚ¡ 
time¥ec
 
__times
[2]è
__THROW
;

389 #iâdeà
_STAT_VER


390 
	#_STAT_VER
 0

	)

392 #iâdeà
_MKNOD_VER


393 
	#_MKNOD_VER
 0

	)

397 #iâdeà
__USE_FILE_OFFSET64


398 
	$__fx¡©
 (
__v”
, 
__fdes
, 
¡©
 *
__¡©_buf
)

399 
__THROW
 
	`__nÚnuÎ
 ((3));

400 
	$__x¡©
 (
__v”
, cÚ¡ *
__f’ame
,

401 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

402 
	$__lx¡©
 (
__v”
, cÚ¡ *
__f’ame
,

403 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

404 
	$__fx¡©©
 (
__v”
, 
__fdes
, cÚ¡ *
__f’ame
,

405 
¡©
 *
__¡©_buf
, 
__æag
)

406 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

408 #ifdeà
__REDIRECT_NTH


409 
	`__REDIRECT_NTH
 (
__fx¡©
, (
__v”
, 
__fdes
,

410 
¡©
 *
__¡©_buf
), 
__fx¡©64
)

411 
	`__nÚnuÎ
 ((3));

412 
	`__REDIRECT_NTH
 (
__x¡©
, (
__v”
, cÚ¡ *
__f’ame
,

413 
¡©
 *
__¡©_buf
), 
__x¡©64
)

414 
	`__nÚnuÎ
 ((2, 3));

415 
	`__REDIRECT_NTH
 (
__lx¡©
, (
__v”
, cÚ¡ *
__f’ame
,

416 
¡©
 *
__¡©_buf
), 
__lx¡©64
)

417 
	`__nÚnuÎ
 ((2, 3));

418 
	`__REDIRECT_NTH
 (
__fx¡©©
, (
__v”
, 
__fdes
,

419 cÚ¡ *
__f’ame
,

420 
¡©
 *
__¡©_buf
, 
__æag
),

421 
__fx¡©©64
è
	`__nÚnuÎ
 ((3, 4));

424 
	#__fx¡©
 
__fx¡©64


	)

425 
	#__x¡©
 
__x¡©64


	)

426 
	#__lx¡©
 
__lx¡©64


	)

430 #ifdeà
__USE_LARGEFILE64


431 
	$__fx¡©64
 (
__v”
, 
__fdes
, 
¡©64
 *
__¡©_buf
)

432 
__THROW
 
	`__nÚnuÎ
 ((3));

433 
	$__x¡©64
 (
__v”
, cÚ¡ *
__f’ame
,

434 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

435 
	$__lx¡©64
 (
__v”
, cÚ¡ *
__f’ame
,

436 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

437 
	$__fx¡©©64
 (
__v”
, 
__fdes
, cÚ¡ *
__f’ame
,

438 
¡©64
 *
__¡©_buf
, 
__æag
)

439 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

441 
	$__xmknod
 (
__v”
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

442 
__dev_t
 *
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

444 
	$__xmknod©
 (
__v”
, 
__fd
, cÚ¡ *
__·th
,

445 
__mode_t
 
__mode
, 
__dev_t
 *
__dev
)

446 
__THROW
 
	`__nÚnuÎ
 ((3, 5));

448 #ifdeà
__USE_EXTERN_INLINES


451 
__ex‹º_šlše
 

452 
	`__NTH
 (
	$¡©
 (cÚ¡ *
__·th
, 
¡©
 *
__¡©buf
))

454  
	`__x¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

455 
	}
}

457 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


458 
__ex‹º_šlše
 

459 
__NTH
 (
	$l¡©
 (cÚ¡ *
__·th
, 
¡©
 *
__¡©buf
))

461  
	`__lx¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

462 
	}
}

465 
__ex‹º_šlše
 

466 
__NTH
 (
	$f¡©
 (
__fd
, 
¡©
 *
__¡©buf
))

468  
	`__fx¡©
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

469 
	}
}

471 #ifdeà
__USE_ATFILE


472 
__ex‹º_šlše
 

473 
__NTH
 (
	$f¡©©
 (
__fd
, cÚ¡ *
__f’ame
, 
¡©
 *
__¡©buf
,

474 
__æag
))

476  
	`__fx¡©©
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

477 
	}
}

480 #ifdeà
__USE_MISC


481 
__ex‹º_šlše
 

482 
__NTH
 (
	$mknod
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
))

484  
	`__xmknod
 (
_MKNOD_VER
, 
__·th
, 
__mode
, &
__dev
);

485 
	}
}

488 #ifdeà
__USE_ATFILE


489 
__ex‹º_šlše
 

490 
__NTH
 (
	$mknod©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

491 
__dev_t
 
__dev
))

493  
	`__xmknod©
 (
_MKNOD_VER
, 
__fd
, 
__·th
, 
__mode
, &
__dev
);

494 
	}
}

497 #ià
defšed
 
__USE_LARGEFILE64
 \

498 && (! 
defšed
 
	g__USE_FILE_OFFSET64
 \

499 || (
defšed
 
	g__REDIRECT_NTH
 && defšed 
	g__OPTIMIZE__
))

500 
__ex‹º_šlše
 

501 
__NTH
 (
	$¡©64
 (cÚ¡ *
__·th
, 
¡©64
 *
__¡©buf
))

503  
	`__x¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

504 
	}
}

506 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


507 
__ex‹º_šlše
 

508 
__NTH
 (
	$l¡©64
 (cÚ¡ *
__·th
, 
¡©64
 *
__¡©buf
))

510  
	`__lx¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

511 
	}
}

514 
__ex‹º_šlše
 

515 
__NTH
 (
	$f¡©64
 (
__fd
, 
¡©64
 *
__¡©buf
))

517  
	`__fx¡©64
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

518 
	}
}

520 #ifdeà
__USE_ATFILE


521 
__ex‹º_šlše
 

522 
__NTH
 (
	$f¡©©64
 (
__fd
, cÚ¡ *
__f’ame
, 
¡©64
 *
__¡©buf
,

523 
__æag
))

525  
	`__fx¡©©64
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

526 
	}
}

533 
	g__END_DECLS


	@/usr/include/sys/sysctl.h

18 #iâdef 
_SYS_SYSCTL_H


19 
	#_SYS_SYSCTL_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

25 #iâdeà
_LINUX_KERNEL_H


26 
	#_LINUX_KERNEL_H
 1

	)

27 
	#__undef_LINUX_KERNEL_H


	)

29 #iâdeà
_LINUX_TYPES_H


30 
	#_LINUX_TYPES_H
 1

	)

31 
	#__undef_LINUX_TYPES_H


	)

33 #iâdeà
_LINUX_LIST_H


34 
	#_LINUX_LIST_H
 1

	)

35 
	#__undef_LINUX_LIST_H


	)

37 #iâdeà
__LINUX_COMPILER_H


38 
	#__LINUX_COMPILER_H
 1

	)

39 
	#__u£r


	)

40 
	#__undef__LINUX_COMPILER_H


	)

43 
	~<lšux/sysùl.h
>

45 #ifdeà
__undef_LINUX_KERNEL_H


46 #undeà
_LINUX_KERNEL_H


47 #undeà
__undef_LINUX_KERNEL_H


49 #ifdeà
__undef_LINUX_TYPES_H


50 #undeà
_LINUX_TYPES_H


51 #undeà
__undef_LINUX_TYPES_H


53 #ifdeà
__undef_LINUX_LIST_H


54 #undeà
_LINUX_LIST_H


55 #undeà
__undef_LINUX_LIST_H


57 #ifdeà
__undef__LINUX_COMPILER_H


58 #undeà
__LINUX_COMPILER_H


59 #undeà
__u£r


60 #undeà
__undef__LINUX_COMPILER_H


63 
	~<b™s/sysùl.h
>

65 
__BEGIN_DECLS


68 
	$sysùl
 (*
__Çme
, 
__Æ’
, *
__Şdv®
,

69 
size_t
 *
__ŞdËÅ
, *
__Ãwv®
, size_ˆ
__ÃwËn
è
__THROW
;

71 
__END_DECLS


	@/usr/include/sys/time.h

18 #iâdeà
_SYS_TIME_H


19 
	#_SYS_TIME_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	~<b™s/ty³s.h
>

24 
	#__Ãed_time_t


	)

25 
	~<time.h
>

26 
	#__Ãed_timev®


	)

27 
	~<b™s/time.h
>

29 
	~<sys/£Ëù.h
>

31 #iâdeà
__su£cÚds_t_defšed


32 
__su£cÚds_t
 
	tsu£cÚds_t
;

33 
	#__su£cÚds_t_defšed


	)

37 
	g__BEGIN_DECLS


39 #ifdeà
__USE_GNU


41 
	#TIMEVAL_TO_TIMESPEC
(
tv
, 
ts
) { \

42 (
ts
)->
tv_£c
 = (
tv
)->tv_sec; \

43 (
ts
)->
tv_n£c
 = (
tv
)->
tv_u£c
 * 1000; \

44 }

	)

45 
	#TIMESPEC_TO_TIMEVAL
(
tv
, 
ts
) { \

46 (
tv
)->
tv_£c
 = (
ts
)->tv_sec; \

47 (
tv
)->
tv_u£c
 = (
ts
)->
tv_n£c
 / 1000; \

48 }

	)

52 #ifdeà
__USE_MISC


55 
	stimezÚe


57 
	mtz_mšu‹swe¡
;

58 
	mtz_d¡time
;

61 
timezÚe
 *
	t__»¡riù
 
	t__timezÚe_±r_t
;

63 *
	t__»¡riù
 
	t__timezÚe_±r_t
;

71 
	$g‘timeofday
 (
timev®
 *
__»¡riù
 
__tv
,

72 
__timezÚe_±r_t
 
__tz
è
__THROW
 
	`__nÚnuÎ
 ((1));

74 #ifdeà
__USE_MISC


77 
	$£‰imeofday
 (cÚ¡ 
timev®
 *
__tv
,

78 cÚ¡ 
timezÚe
 *
__tz
)

79 
__THROW
;

85 
	$adjtime
 (cÚ¡ 
timev®
 *
__d–
,

86 
timev®
 *
__Şdd–
è
__THROW
;

91 
	e__™im”_which


94 
ITIMER_REAL
 = 0,

95 
	#ITIMER_REAL
 
ITIMER_REAL


	)

97 
ITIMER_VIRTUAL
 = 1,

98 
	#ITIMER_VIRTUAL
 
ITIMER_VIRTUAL


	)

101 
ITIMER_PROF
 = 2

102 
	#ITIMER_PROF
 
ITIMER_PROF


	)

107 
	s™im”v®


110 
timev®
 
™_š‹rv®
;

112 
timev®
 
™_v®ue
;

115 #ià
defšed
 
__USE_GNU
 && !defšed 
__ılu¥lus


118 
__™im”_which
 
	t__™im”_which_t
;

120 
	t__™im”_which_t
;

125 
	$g‘™im”
 (
__™im”_which_t
 
__which
,

126 
™im”v®
 *
__v®ue
è
__THROW
;

131 
	$£t™im”
 (
__™im”_which_t
 
__which
,

132 cÚ¡ 
™im”v®
 *
__»¡riù
 
__Ãw
,

133 
™im”v®
 *
__»¡riù
 
__Şd
è
__THROW
;

138 
	$utimes
 (cÚ¡ *
__fe
, cÚ¡ 
timev®
 
__tvp
[2])

139 
__THROW
 
	`__nÚnuÎ
 ((1));

141 #ifdeà
__USE_MISC


143 
	$lutimes
 (cÚ¡ *
__fe
, cÚ¡ 
timev®
 
__tvp
[2])

144 
__THROW
 
	`__nÚnuÎ
 ((1));

147 
	$futimes
 (
__fd
, cÚ¡ 
timev®
 
__tvp
[2]è
__THROW
;

150 #ifdeà
__USE_GNU


154 
	$futime§t
 (
__fd
, cÚ¡ *
__fe
,

155 cÚ¡ 
timev®
 
__tvp
[2]è
__THROW
;

159 #ifdeà
__USE_MISC


162 
	#tim”is£t
(
tvp
è(Ñvp)->
tv_£c
 || (tvp)->
tv_u£c
)

	)

163 
	#tim”ş—r
(
tvp
è(Ñvp)->
tv_£c
 = (tvp)->
tv_u£c
 = 0)

	)

164 
	#tim”cmp
(
a
, 
b
, 
CMP
) \

165 (((
a
)->
tv_£c
 =ğ(
b
)->tv_sec) ? \

166 ((
a
)->
tv_u£c
 
	`CMP
 (
b
)->tv_usec) : \

167 ((
a
)->
tv_£c
 
	`CMP
 (
b
)->tv_£c))

	)

168 
	#tim”add
(
a
, 
b
, 
»suÉ
) \

170 (
»suÉ
)->
tv_£c
 = (
a
)->tv_£ø+ (
b
)->tv_sec; \

171 (
»suÉ
)->
tv_u£c
 = (
a
)->tv_u£ø+ (
b
)->tv_usec; \

172 ià((
»suÉ
)->
tv_u£c
 >= 1000000) \

174 ++(
»suÉ
)->
tv_£c
; \

175 (
»suÉ
)->
tv_u£c
 -= 1000000; \

177 
	}
} 0)

	)

178 
	#tim”sub
(
a
, 
b
, 
»suÉ
) \

180 (
»suÉ
)->
tv_£c
 = (
a
)->tv_£ø- (
b
)->tv_sec; \

181 (
»suÉ
)->
tv_u£c
 = (
a
)->tv_u£ø- (
b
)->tv_usec; \

182 ià((
»suÉ
)->
tv_u£c
 < 0) { \

183 --(
»suÉ
)->
tv_£c
; \

184 (
»suÉ
)->
tv_u£c
 += 1000000; \

186 } 0)

	)

189 
	g__END_DECLS


	@/usr/include/sys/types.h

22 #iâdef 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 #ifdef 
__USE_MISC


32 #iâdeà
__u_ch¬_defšed


33 
__u_ch¬
 
	tu_ch¬
;

34 
__u_shÜt
 
	tu_shÜt
;

35 
__u_št
 
	tu_št
;

36 
__u_lÚg
 
	tu_lÚg
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¬_defšed


	)

44 
__loff_t
 
	tloff_t
;

46 #iâdeà
__šo_t_defšed


47 #iâdeà
__USE_FILE_OFFSET64


48 
__šo_t
 
	tšo_t
;

50 
__šo64_t
 
	tšo_t
;

52 
	#__šo_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


55 
__šo64_t
 
	tšo64_t
;

56 
	#__šo64_t_defšed


	)

59 #iâdeà
__dev_t_defšed


60 
__dev_t
 
	tdev_t
;

61 
	#__dev_t_defšed


	)

64 #iâdeà
__gid_t_defšed


65 
__gid_t
 
	tgid_t
;

66 
	#__gid_t_defšed


	)

69 #iâdeà
__mode_t_defšed


70 
__mode_t
 
	tmode_t
;

71 
	#__mode_t_defšed


	)

74 #iâdeà
__Æšk_t_defšed


75 
__Æšk_t
 
	tÆšk_t
;

76 
	#__Æšk_t_defšed


	)

79 #iâdeà
__uid_t_defšed


80 
__uid_t
 
	tuid_t
;

81 
	#__uid_t_defšed


	)

84 #iâdeà
__off_t_defšed


85 #iâdeà
__USE_FILE_OFFSET64


86 
__off_t
 
	toff_t
;

88 
__off64_t
 
	toff_t
;

90 
	#__off_t_defšed


	)

92 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


93 
__off64_t
 
	toff64_t
;

94 
	#__off64_t_defšed


	)

97 #iâdeà
__pid_t_defšed


98 
__pid_t
 
	tpid_t
;

99 
	#__pid_t_defšed


	)

102 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

103 && !
defšed
 
__id_t_defšed


104 
__id_t
 
	tid_t
;

105 
	#__id_t_defšed


	)

108 #iâdeà
__ssize_t_defšed


109 
__ssize_t
 
	tssize_t
;

110 
	#__ssize_t_defšed


	)

113 #ifdef 
__USE_MISC


114 #iâdeà
__daddr_t_defšed


115 
__daddr_t
 
	tdaddr_t
;

116 
__ÿddr_t
 
	tÿddr_t
;

117 
	#__daddr_t_defšed


	)

121 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


122 
__key_t
 
	tkey_t
;

123 
	#__key_t_defšed


	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#__Ãed_şock_t


	)

129 
	#__Ãed_time_t


	)

130 
	#__Ãed_tim”_t


	)

131 
	#__Ãed_şockid_t


	)

132 
	~<time.h
>

134 #ifdeà
__USE_XOPEN


135 #iâdeà
__u£cÚds_t_defšed


136 
__u£cÚds_t
 
	tu£cÚds_t
;

137 
	#__u£cÚds_t_defšed


	)

139 #iâdeà
__su£cÚds_t_defšed


140 
__su£cÚds_t
 
	tsu£cÚds_t
;

141 
	#__su£cÚds_t_defšed


	)

145 
	#__Ãed_size_t


	)

146 
	~<¡ddef.h
>

148 #ifdeà
__USE_MISC


150 
	tulÚg
;

151 
	tushÜt
;

152 
	tušt
;

157 #ià!
__GNUC_PREREQ
 (2, 7)

160 #iâdeà
__št8_t_defšed


161 
	#__št8_t_defšed


	)

162 
	tšt8_t
;

163 
	tšt16_t
;

164 
	tšt32_t
;

165 #ià
__WORDSIZE
 == 64

166 
	tšt64_t
;

168 
__ex‹nsiÚ__
 
	tšt64_t
;

173 
	tu_št8_t
;

174 
	tu_št16_t
;

175 
	tu_št32_t
;

176 #ià
__WORDSIZE
 == 64

177 
	tu_št64_t
;

179 
__ex‹nsiÚ__
 
	tu_št64_t
;

182 
	t»gi¡”_t
;

187 
	#__štN_t
(
N
, 
MODE
) \

188 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

189 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

190 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

192 #iâdeà
	t__št8_t_defšed


193 
	t__št8_t_defšed


	)

194 
	t__štN_t
 (8, 
	t__QI__
);

195 
__štN_t
 (16, 
__HI__
);

196 
__štN_t
 (32, 
__SI__
);

197 
__štN_t
 (64, 
__DI__
);

200 
__u_štN_t
 (8, 
__QI__
);

201 
__u_štN_t
 (16, 
__HI__
);

202 
__u_štN_t
 (32, 
__SI__
);

203 
__u_štN_t
 (64, 
__DI__
);

205 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

211 
	#__BIT_TYPES_DEFINED__
 1

	)

214 #ifdef 
__USE_MISC


216 
	~<’dŸn.h
>

219 
	~<sys/£Ëù.h
>

222 
	~<sys/sysmaüos.h
>

226 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

227 && !
defšed
 
__blksize_t_defšed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_defšed


	)

233 #iâdeà
__USE_FILE_OFFSET64


234 #iâdeà
__blkút_t_defšed


235 
__blkút_t
 
	tblkút_t
;

236 
	#__blkút_t_defšed


	)

238 #iâdeà
__fsblkút_t_defšed


239 
__fsblkút_t
 
	tfsblkút_t
;

240 
	#__fsblkút_t_defšed


	)

242 #iâdeà
__fsfút_t_defšed


243 
__fsfút_t
 
	tfsfút_t
;

244 
	#__fsfút_t_defšed


	)

247 #iâdeà
__blkút_t_defšed


248 
__blkút64_t
 
	tblkút_t
;

249 
	#__blkút_t_defšed


	)

251 #iâdeà
__fsblkút_t_defšed


252 
__fsblkút64_t
 
	tfsblkút_t
;

253 
	#__fsblkút_t_defšed


	)

255 #iâdeà
__fsfút_t_defšed


256 
__fsfút64_t
 
	tfsfút_t
;

257 
	#__fsfút_t_defšed


	)

261 #ifdeà
__USE_LARGEFILE64


262 
__blkút64_t
 
	tblkút64_t
;

263 
__fsblkút64_t
 
	tfsblkút64_t
;

264 
__fsfút64_t
 
	tfsfút64_t
;

269 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


270 
	~<b™s/±h»adty³s.h
>

273 
	g__END_DECLS


	@/usr/include/sys/uio.h

18 #iâdeà
_SYS_UIO_H


19 
	#_SYS_UIO_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	~<sys/ty³s.h
>

25 
	g__BEGIN_DECLS


28 
	~<b™s/uio.h
>

39 
ssize_t
 
	$»adv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

40 
__wur
;

50 
ssize_t
 
	$wr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

51 
__wur
;

54 #ifdeà
__USE_MISC


55 #iâdeà
__USE_FILE_OFFSET64


65 
ssize_t
 
	$´—dv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

66 
__off_t
 
__off£t
è
__wur
;

77 
ssize_t
 
	$pwr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

78 
__off_t
 
__off£t
è
__wur
;

80 #ifdeà
__REDIRECT


81 
ssize_t
 
	`__REDIRECT
 (
´—dv
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

82 
__couÁ
, 
__off64_t
 
__off£t
),

83 
´—dv64
è
__wur
;

84 
ssize_t
 
	`__REDIRECT
 (
pwr™ev
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

85 
__couÁ
, 
__off64_t
 
__off£t
),

86 
pwr™ev64
è
__wur
;

88 
	#´—dv
 
´—dv64


	)

89 
	#pwr™ev
 
pwr™ev64


	)

93 #ifdeà
__USE_LARGEFILE64


103 
ssize_t
 
	$´—dv64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

104 
__off64_t
 
__off£t
è
__wur
;

115 
ssize_t
 
	$pwr™ev64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

116 
__off64_t
 
__off£t
è
__wur
;

120 
__END_DECLS


	@/usr/include/sys/un.h

18 #iâdef 
_SYS_UN_H


19 
	#_SYS_UN_H
 1

	)

21 
	~<sys/cdefs.h
>

24 
	~<b™s/sockaddr.h
>

26 
__BEGIN_DECLS


29 
	ssockaddr_un


31 
__SOCKADDR_COMMON
 (
sun_
);

32 
	msun_·th
[108];

36 #ifdeà
__USE_MISC


37 
	~<¡ršg.h
>

40 
	#SUN_LEN
(
±r
è((
size_t
è(((
sockaddr_un
 *è0)->
sun_·th
) \

41 + 
	`¡¾’
 ((
±r
)->
sun_·th
))

	)

44 
	g__END_DECLS


	@/usr/include/sys/utsname.h

22 #iâdef 
_SYS_UTSNAME_H


23 
	#_SYS_UTSNAME_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ut¢ame.h
>

31 #iâdeà
_UTSNAME_SYSNAME_LENGTH


32 
	#_UTSNAME_SYSNAME_LENGTH
 
_UTSNAME_LENGTH


	)

34 #iâdeà
_UTSNAME_NODENAME_LENGTH


35 
	#_UTSNAME_NODENAME_LENGTH
 
_UTSNAME_LENGTH


	)

37 #iâdeà
_UTSNAME_RELEASE_LENGTH


38 
	#_UTSNAME_RELEASE_LENGTH
 
_UTSNAME_LENGTH


	)

40 #iâdeà
_UTSNAME_VERSION_LENGTH


41 
	#_UTSNAME_VERSION_LENGTH
 
_UTSNAME_LENGTH


	)

43 #iâdeà
_UTSNAME_MACHINE_LENGTH


44 
	#_UTSNAME_MACHINE_LENGTH
 
_UTSNAME_LENGTH


	)

48 
	sut¢ame


51 
	msy¢ame
[
_UTSNAME_SYSNAME_LENGTH
];

54 
	mnod’ame
[
_UTSNAME_NODENAME_LENGTH
];

57 
	m»Ëa£
[
_UTSNAME_RELEASE_LENGTH
];

59 
	mv”siÚ
[
_UTSNAME_VERSION_LENGTH
];

62 
	mmachše
[
_UTSNAME_MACHINE_LENGTH
];

64 #ià
_UTSNAME_DOMAIN_LENGTH
 - 0

66 #ifdeà
__USE_GNU


67 
	mdomašÇme
[
_UTSNAME_DOMAIN_LENGTH
];

69 
	m__domašÇme
[
_UTSNAME_DOMAIN_LENGTH
];

74 #ifdeà
__USE_MISC


76 
	#SYS_NMLN
 
_UTSNAME_LENGTH


	)

81 
	$uÇme
 (
ut¢ame
 *
__Çme
è
__THROW
;

84 
__END_DECLS


	@/usr/include/sys/wait.h

22 #iâdef 
_SYS_WAIT_H


23 
	#_SYS_WAIT_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<sigÇl.h
>

32 #ià!
defšed
 
_STDLIB_H
 || (!defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K8
)

35 
	~<b™s/wa™æags.h
>

37 #ifdef 
__USE_MISC


42 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


43 
	#__WAIT_INT
(
¡©us
) \

44 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

45 { .
__š
 = (
¡©us
è}).
__i
))

	)

47 
	#__WAIT_INT
(
¡©us
è(*(cÚ¡ *è&(¡©us))

	)

55 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


56 
	#__WAIT_STATUS
 *

	)

57 
	#__WAIT_STATUS_DEFN
 *

	)

62 
wa™
 *
	m__u±r
;

63 *
	m__Œ
;

64 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

71 
	#__WAIT_STATUS
 *

	)

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	~<b™s/wa™¡©us.h
>

79 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

80 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

81 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

82 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

83 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

84 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

85 #ifdeà
__WIFCONTINUED


86 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdef 
__USE_MISC


91 
	#WCOREFLAG
 
__WCOREFLAG


	)

92 
	#WCOREDUMP
(
¡©us
è
	`__WCOREDUMP
 (
	`__WAIT_INT
 (¡©us))

	)

93 
	#W_EXITCODE
(
»t
, 
sig
è
	`__W_EXITCODE
 (»t, sig)

	)

94 
	#W_STOPCODE
(
sig
è
	`__W_STOPCODE
 (sig)

	)

98 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


101 
	mP_ALL
,

102 
	mP_PID
,

103 
	mP_PGID


104 } 
	tidty³_t
;

113 
__pid_t
 
wa™
 (
__WAIT_STATUS
 
__¡©_loc
);

115 #ifdef 
__USE_MISC


117 
	#WAIT_ANY
 (-1è

	)

118 
	#WAIT_MYPGRP
 0

	)

136 
__pid_t
 
wa™pid
 (__pid_ˆ
__pid
, *
__¡©_loc
, 
__İtiÚs
);

138 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


139 #iâdeà
__id_t_defšed


140 
	~<b™s/ty³s.h
>

141 
__id_t
 
	tid_t
;

142 
	#__id_t_defšed


	)

145 
	#__Ãed_sigšfo_t


	)

146 
	~<b™s/sigšfo.h
>

159 
wa™id
 (
idty³_t
 
__idty³
, 
__id_t
 
__id
, 
sigšfo_t
 *
__šfİ
,

160 
__İtiÚs
);

163 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


166 
	gru§ge
;

173 
__pid_t
 
	$wa™3
 (
__WAIT_STATUS
 
__¡©_loc
, 
__İtiÚs
,

174 
ru§ge
 * 
__u§ge
è
__THROWNL
;

177 #ifdeà
__USE_MISC


179 
__pid_t
 
	$wa™4
 (
__pid_t
 
__pid
, 
__WAIT_STATUS
 
__¡©_loc
, 
__İtiÚs
,

180 
ru§ge
 *
__u§ge
è
__THROWNL
;

184 
__END_DECLS


	@/usr/include/syslog.h

1 
	~<sys/sy¦og.h
>

	@/usr/include/termios.h

22 #iâdef 
_TERMIOS_H


23 
	#_TERMIOS_H
 1

	)

25 
	~<ã©u»s.h
>

26 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


28 
	~<b™s/ty³s.h
>

29 #iâdeà
__pid_t_defšed


30 
__pid_t
 
	tpid_t
;

31 
	#__pid_t_defšed


	)

35 
	g__BEGIN_DECLS


39 
	~<b™s/‹rmios.h
>

41 #ifdeà
__USE_MISC


44 
	#CCEQ
(
v®
, 
c
è((cè=ğ(v®è&& (v®è!ğ
_POSIX_VDISABLE
)

	)

48 
¥“d_t
 
	$cfg‘o¥“d
 (cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

51 
¥“d_t
 
	$cfg‘i¥“d
 (cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

54 
	$cf£to¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

57 
	$cf£ti¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

59 #ifdef 
__USE_MISC


61 
	$cf£t¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

66 
	$tcg‘©Œ
 (
__fd
, 
‹rmios
 *
__‹rmios_p
è
__THROW
;

70 
	$tc£‰r
 (
__fd
, 
__İtiÚ®_aùiÚs
,

71 cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

74 #ifdef 
__USE_MISC


76 
	$cfmak”aw
 (
‹rmios
 *
__‹rmios_p
è
__THROW
;

80 
	$tc£ndb»ak
 (
__fd
, 
__du¿tiÚ
è
__THROW
;

86 
	`tcd¿š
 (
__fd
);

90 
	$tcæush
 (
__fd
, 
__queue_£ËùÜ
è
__THROW
;

94 
	$tcæow
 (
__fd
, 
__aùiÚ
è
__THROW
;

97 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


99 
__pid_t
 
	$tcg‘sid
 (
__fd
è
__THROW
;

103 #ifdeà
__USE_MISC


104 
	~<sys/‰ydeçuÉs.h
>

107 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ifdeà
__USE_POSIX


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_MISC


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ifdeà
__USE_POSIX


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_POSIX


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_MISC


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/ucontext.h

20 #iâdeà
_UCONTEXT_H


21 
	#_UCONTEXT_H
 1

	)

23 
	~<ã©u»s.h
>

26 
	~<sys/ucÚ‹xt.h
>

28 
__BEGIN_DECLS


31 
	$g‘cÚ‹xt
 (
ucÚ‹xt_t
 *
__uı
è
__THROWNL
;

34 
	$£tcÚ‹xt
 (cÚ¡ 
ucÚ‹xt_t
 *
__uı
è
__THROWNL
;

38 
	$sw­cÚ‹xt
 (
ucÚ‹xt_t
 *
__»¡riù
 
__ouı
,

39 cÚ¡ 
ucÚ‹xt_t
 *
__»¡riù
 
__uı
è
__THROWNL
;

47 
	`makecÚ‹xt
 (
ucÚ‹xt_t
 *
__uı
, (*
__func
) (),

48 
__¬gc
, ...è
__THROW
;

50 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifdeà
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #–ià
defšed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #–ià
defšed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<b™s/posix_İt.h
>

208 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


209 
	~<b™s/’vœÚm’ts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<b™s/ty³s.h
>

222 #iâdef 
__ssize_t_defšed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_defšed


	)

227 
	#__Ãed_size_t


	)

228 
	#__Ãed_NULL


	)

229 
	~<¡ddef.h
>

231 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


234 #iâdeà
__gid_t_defšed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_defšed


	)

239 #iâdeà
__uid_t_defšed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_defšed


	)

244 #iâdeà
__off_t_defšed


245 #iâdeà
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_defšed


	)

252 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_defšed


	)

257 #iâdeà
__u£cÚds_t_defšed


258 
__u£cÚds_t
 
	tu£cÚds_t
;

259 
	#__u£cÚds_t_defšed


	)

262 #iâdeà
__pid_t_defšed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_defšed


	)

268 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


269 #iâdeà
__šŒ_t_defšed


270 
__šŒ_t
 
	tšŒ_t
;

271 
	#__šŒ_t_defšed


	)

275 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


276 #iâdeà
__sockËn_t_defšed


277 
__sockËn_t
 
	tsockËn_t
;

278 
	#__sockËn_t_defšed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

292 #ifdeà
__USE_GNU


295 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

296 
__THROW
 
	`__nÚnuÎ
 ((1));

299 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

300 
__THROW
 
	`__nÚnuÎ
 ((1));

303 #ifdeà
__USE_ATFILE


307 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

308 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

313 #iâdef 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifdeà
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #ià
defšed
 
__USE_MISC
 && !defšed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #iâdeà
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

339 #ifdeà
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifdeà
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

349 
__THROW
;

356 
	`şo£
 (
__fd
);

363 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

369 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

371 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


372 #iâdeà
__USE_FILE_OFFSET64


379 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

380 
__off_t
 
__off£t
è
__wur
;

387 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
è
__wur
;

390 #ifdeà
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

392 
__off64_t
 
__off£t
),

393 
´—d64
è
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

395 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

396 
pwr™e64
è
__wur
;

398 
	#´—d
 
´—d64


	)

399 
	#pwr™e
 
pwr™e64


	)

403 #ifdeà
__USE_LARGEFILE64


407 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

408 
__off64_t
 
__off£t
è
__wur
;

411 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
è
__wur
;

420 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

422 #ifdeà
__USE_GNU


425 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

435 
	$®¬m
 (
__£cÚds
è
__THROW
;

447 
	`¦“p
 (
__£cÚds
);

449 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

450 || 
defšed
 
__USE_MISC


455 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

456 
__THROW
;

463 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

472 
	`·u£
 ();

476 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

479 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

486 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

491 #ifdeà
__USE_ATFILE


494 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

495 
__gid_t
 
__group
, 
__æag
)

496 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

500 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

502 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


504 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

514 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

523 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

524 || 
defšed
 
__USE_MISC


528 *
	$g‘wd
 (*
__buf
)

529 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

534 
	$dup
 (
__fd
è
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

539 #ifdeà
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

546 **
__’vœÚ
;

547 #ifdeà
__USE_GNU


548 **
’vœÚ
;

554 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

555 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdeà
__USE_XOPEN2K8


560 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

561 
__THROW
 
	`__nÚnuÎ
 ((2));

566 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

567 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

577 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

588 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

590 #ifdeà
__USE_GNU


593 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

594 *cÚ¡ 
__’vp
[])

595 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

599 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


601 
	$niû
 (
__šc
è
__THROW
 
__wur
;

606 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

612 
	~<b™s/cÚâame.h
>

615 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

616 
__THROW
 
	`__nÚnuÎ
 ((1));

619 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

622 
	$syscÚf
 (
__Çme
è
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

631 
__pid_t
 
	$g‘pid
 (è
__THROW
;

634 
__pid_t
 
	$g‘µid
 (è
__THROW
;

637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

640 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

641 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


642 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

649 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

651 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


663 
	$£g½
 (è
__THROW
;

670 
__pid_t
 
	$£tsid
 (è
__THROW
;

672 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


674 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

678 
__uid_t
 
	$g‘uid
 (è
__THROW
;

681 
__uid_t
 
	$g‘euid
 (è
__THROW
;

684 
__gid_t
 
	$g‘gid
 (è
__THROW
;

687 
__gid_t
 
	$g‘egid
 (è
__THROW
;

692 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

705 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


708 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

711 #ifdeà
__USE_XOPEN2K


713 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

722 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


725 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

728 #ifdeà
__USE_XOPEN2K


730 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

733 #ifdeà
__USE_GNU


736 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

737 
__THROW
;

741 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

742 
__THROW
;

746 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

747 
__THROW
 
__wur
;

751 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

761 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

762 || 
defšed
 
__USE_MISC


767 
__pid_t
 
	$vfÜk
 (è
__THROW
;

773 *
	$‰yÇme
 (
__fd
è
__THROW
;

777 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

778 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

782 
	$i§‰y
 (
__fd
è
__THROW
;

784 #ià
defšed
 
__USE_MISC
 \

785 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

788 
	$‰y¦Ù
 (è
__THROW
;

793 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

794 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

796 #ifdeà
__USE_ATFILE


799 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

800 cÚ¡ *
__to
, 
__æags
)

801 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

804 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


806 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

807 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

812 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

813 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

814 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

817 #ifdeà
__USE_ATFILE


819 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

820 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

823 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

824 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

825 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

829 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

831 #ifdeà
__USE_ATFILE


833 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

834 
__THROW
 
	`__nÚnuÎ
 ((2));

838 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

842 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

845 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

852 *
	`g‘logš
 ();

853 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


860 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

863 #ifdef 
__USE_MISC


865 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

869 #ifdef 
__USE_POSIX2


873 
	#__Ãed_g‘İt


	)

874 
	~<g‘İt.h
>

878 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


882 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

886 #ià
defšed
 
__USE_MISC


889 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

890 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

894 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

900 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

901 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

902 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

903 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

909 
	$vhªgup
 (è
__THROW
;

912 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

920 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

921 
size_t
 
__off£t
, 
__sÿË
)

922 
__THROW
 
	`__nÚnuÎ
 ((1));

928 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

932 *
	$g‘u£rsh–l
 (è
__THROW
;

933 
	$’du£rsh–l
 (è
__THROW
;

934 
	$£tu£rsh–l
 (è
__THROW
;

940 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

944 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

947 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

951 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

959 
	`fsync
 (
__fd
);

962 #ifdeà
__USE_GNU


965 
	$syncfs
 (
__fd
è
__THROW
;

969 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


972 
	`g‘ho¡id
 ();

975 
	$sync
 (è
__THROW
;

978 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K


981 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

986 
	$g‘dbËsize
 (è
__THROW
;

992 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


995 #iâdeà
__USE_FILE_OFFSET64


996 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

997 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

999 #ifdeà
__REDIRECT_NTH


1000 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1001 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

1002 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1004 
	#Œunÿ‹
 
Œunÿ‹64


	)

1007 #ifdeà
__USE_LARGEFILE64


1008 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1009 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1014 #ià
defšed
 
__USE_POSIX199309
 \

1015 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1018 #iâdeà
__USE_FILE_OFFSET64


1019 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1021 #ifdeà
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1023 
árunÿ‹64
è
__wur
;

1025 
	#árunÿ‹
 
árunÿ‹64


	)

1028 #ifdeà
__USE_LARGEFILE64


1029 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1035 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1036 || 
defšed
 
__USE_MISC


1040 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1046 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1050 #ifdeà
__USE_MISC


1061 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1066 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #iâdeà
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1086 #ifdeà
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1088 
lockf64
è
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifdeà
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1099 #ifdeà
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1105 (
__ex‹nsiÚ__
 \

1106 ({ 
__»suÉ
; \

1107 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1108 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1109 
__»suÉ
; 
	}
}))

	)

1112 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1115 
fd©async
 (
__fdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1124 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1128 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1129 
__THROW
 
	`__nÚnuÎ
 ((1));

1136 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1137 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1143 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1145 *
	$ù”mid
 (*
__s
è
__THROW
;

1150 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1151 
	~<b™s/uni¡d.h
>

1154 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/bits/byteswap.h

19 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

35 
	~<b™s/by‹sw­-16.h
>

38 
	#__bsw­_cÚ¡ªt_32
(
x
) \

39 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

40 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

42 #ifdeà
__GNUC__


43 #ià
__GNUC_PREREQ
 (4, 3)

44 
__šlše
 

45 
	$__bsw­_32
 (
__bsx
)

47  
	`__butš_bsw­32
 (
__bsx
);

48 
	}
}

49 #–ià
__GNUC__
 >= 2

50 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

51 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

52 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

53 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

54 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

55 || 
defšed
 
	g__amdçm10__
)

58 
	#__bsw­_32
(
x
) \

59 (
__ex‹nsiÚ__
 \

60 ({ 
__v
, 
__x
 = (
x
); \

61 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

62 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

64 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

65 
__v
; }))

	)

67 
	#__bsw­_32
(
x
) \

68 (
__ex‹nsiÚ__
 \

69 ({ 
__v
, 
__x
 = (
x
); \

70 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

71 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

73 
	`__asm__
 ("rorw $8, %w0;" \

76 : "ô" (
__v
) \

77 : "0" (
__x
) \

79 
__v
; }))

	)

82 
	#__bsw­_32
(
x
) \

83 (
__ex‹nsiÚ__
 \

84 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

87 
__šlše
 

88 
	$__bsw­_32
 (
__bsx
)

90  
	`__bsw­_cÚ¡ªt_32
 (
__bsx
);

91 
	}
}

95 #ià
__GNUC_PREREQ
 (2, 0)

97 
	#__bsw­_cÚ¡ªt_64
(
x
) \

98 (
	`__ex‹nsiÚ__
 ((((
x
) & 0xff00000000000000ull) >> 56) \

99 | (((
x
) & 0x00ff000000000000ull) >> 40) \

100 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

101 | (((
x
) & 0x000000ff00000000ull) >> 8) \

102 | (((
x
) & 0x00000000ff000000ull) << 8) \

103 | (((
x
) & 0x0000000000ff0000ull) << 24) \

104 | (((
x
) & 0x000000000000ff00ull) << 40) \

105 | (((
x
è& 0x00000000000000ffuÎè<< 56)))

	)

107 #ià
__GNUC_PREREQ
 (4, 3)

108 
__šlše
 
__ušt64_t


109 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

111  
	`__butš_bsw­64
 (
__bsx
);

112 
	}
}

113 #–ià
__WORDSIZE
 == 64

114 
	#__bsw­_64
(
x
) \

115 (
__ex‹nsiÚ__
 \

116 ({ 
__ušt64_t
 
__v
, 
__x
 = (
x
); \

117 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

118 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

120 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

121 
__v
; }))

	)

123 
	#__bsw­_64
(
x
) \

124 (
__ex‹nsiÚ__
 \

125 ({ uniÚ { 
__ex‹nsiÚ__
 
__ušt64_t
 
__Î
; \

126 
__l
[2]; } 
__w
, 
__r
; \

127 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

128 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

131 
__w
.
__Î
 = (
x
); \

132 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

133 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

135 
__r
.
__Î
; }))

	)

138 
	#__bsw­_cÚ¡ªt_64
(
x
) \

139 ((((
x
) & 0xff00000000000000ull) >> 56) \

140 | (((
x
) & 0x00ff000000000000ull) >> 40) \

141 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

142 | (((
x
) & 0x000000ff00000000ull) >> 8) \

143 | (((
x
) & 0x00000000ff000000ull) << 8) \

144 | (((
x
) & 0x0000000000ff0000ull) << 24) \

145 | (((
x
) & 0x000000000000ff00ull) << 40) \

146 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

148 
__šlše
 
__ušt64_t


149 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

151  
	`__bsw­_cÚ¡ªt_64
 (
__bsx
);

152 
	}
}

	@/usr/include/bits/confname.h

19 #iâdeà
_UNISTD_H


26 
	m_PC_LINK_MAX
,

27 
	#_PC_LINK_MAX
 
_PC_LINK_MAX


	)

28 
	m_PC_MAX_CANON
,

29 
	#_PC_MAX_CANON
 
_PC_MAX_CANON


	)

30 
	m_PC_MAX_INPUT
,

31 
	#_PC_MAX_INPUT
 
_PC_MAX_INPUT


	)

32 
	m_PC_NAME_MAX
,

33 
	#_PC_NAME_MAX
 
_PC_NAME_MAX


	)

34 
	m_PC_PATH_MAX
,

35 
	#_PC_PATH_MAX
 
_PC_PATH_MAX


	)

36 
	m_PC_PIPE_BUF
,

37 
	#_PC_PIPE_BUF
 
_PC_PIPE_BUF


	)

38 
	m_PC_CHOWN_RESTRICTED
,

39 
	#_PC_CHOWN_RESTRICTED
 
_PC_CHOWN_RESTRICTED


	)

40 
	m_PC_NO_TRUNC
,

41 
	#_PC_NO_TRUNC
 
_PC_NO_TRUNC


	)

42 
	m_PC_VDISABLE
,

43 
	#_PC_VDISABLE
 
_PC_VDISABLE


	)

44 
	m_PC_SYNC_IO
,

45 
	#_PC_SYNC_IO
 
_PC_SYNC_IO


	)

46 
	m_PC_ASYNC_IO
,

47 
	#_PC_ASYNC_IO
 
_PC_ASYNC_IO


	)

48 
	m_PC_PRIO_IO
,

49 
	#_PC_PRIO_IO
 
_PC_PRIO_IO


	)

50 
	m_PC_SOCK_MAXBUF
,

51 
	#_PC_SOCK_MAXBUF
 
_PC_SOCK_MAXBUF


	)

52 
	m_PC_FILESIZEBITS
,

53 
	#_PC_FILESIZEBITS
 
_PC_FILESIZEBITS


	)

54 
	m_PC_REC_INCR_XFER_SIZE
,

55 
	#_PC_REC_INCR_XFER_SIZE
 
_PC_REC_INCR_XFER_SIZE


	)

56 
	m_PC_REC_MAX_XFER_SIZE
,

57 
	#_PC_REC_MAX_XFER_SIZE
 
_PC_REC_MAX_XFER_SIZE


	)

58 
	m_PC_REC_MIN_XFER_SIZE
,

59 
	#_PC_REC_MIN_XFER_SIZE
 
_PC_REC_MIN_XFER_SIZE


	)

60 
	m_PC_REC_XFER_ALIGN
,

61 
	#_PC_REC_XFER_ALIGN
 
_PC_REC_XFER_ALIGN


	)

62 
	m_PC_ALLOC_SIZE_MIN
,

63 
	#_PC_ALLOC_SIZE_MIN
 
_PC_ALLOC_SIZE_MIN


	)

64 
	m_PC_SYMLINK_MAX
,

65 
	#_PC_SYMLINK_MAX
 
_PC_SYMLINK_MAX


	)

66 
	m_PC_2_SYMLINKS


67 
	#_PC_2_SYMLINKS
 
_PC_2_SYMLINKS


	)

73 
	m_SC_ARG_MAX
,

74 
	#_SC_ARG_MAX
 
_SC_ARG_MAX


	)

75 
	m_SC_CHILD_MAX
,

76 
	#_SC_CHILD_MAX
 
_SC_CHILD_MAX


	)

77 
	m_SC_CLK_TCK
,

78 
	#_SC_CLK_TCK
 
_SC_CLK_TCK


	)

79 
	m_SC_NGROUPS_MAX
,

80 
	#_SC_NGROUPS_MAX
 
_SC_NGROUPS_MAX


	)

81 
	m_SC_OPEN_MAX
,

82 
	#_SC_OPEN_MAX
 
_SC_OPEN_MAX


	)

83 
	m_SC_STREAM_MAX
,

84 
	#_SC_STREAM_MAX
 
_SC_STREAM_MAX


	)

85 
	m_SC_TZNAME_MAX
,

86 
	#_SC_TZNAME_MAX
 
_SC_TZNAME_MAX


	)

87 
	m_SC_JOB_CONTROL
,

88 
	#_SC_JOB_CONTROL
 
_SC_JOB_CONTROL


	)

89 
	m_SC_SAVED_IDS
,

90 
	#_SC_SAVED_IDS
 
_SC_SAVED_IDS


	)

91 
	m_SC_REALTIME_SIGNALS
,

92 
	#_SC_REALTIME_SIGNALS
 
_SC_REALTIME_SIGNALS


	)

93 
	m_SC_PRIORITY_SCHEDULING
,

94 
	#_SC_PRIORITY_SCHEDULING
 
_SC_PRIORITY_SCHEDULING


	)

95 
	m_SC_TIMERS
,

96 
	#_SC_TIMERS
 
_SC_TIMERS


	)

97 
	m_SC_ASYNCHRONOUS_IO
,

98 
	#_SC_ASYNCHRONOUS_IO
 
_SC_ASYNCHRONOUS_IO


	)

99 
	m_SC_PRIORITIZED_IO
,

100 
	#_SC_PRIORITIZED_IO
 
_SC_PRIORITIZED_IO


	)

101 
	m_SC_SYNCHRONIZED_IO
,

102 
	#_SC_SYNCHRONIZED_IO
 
_SC_SYNCHRONIZED_IO


	)

103 
	m_SC_FSYNC
,

104 
	#_SC_FSYNC
 
_SC_FSYNC


	)

105 
	m_SC_MAPPED_FILES
,

106 
	#_SC_MAPPED_FILES
 
_SC_MAPPED_FILES


	)

107 
	m_SC_MEMLOCK
,

108 
	#_SC_MEMLOCK
 
_SC_MEMLOCK


	)

109 
	m_SC_MEMLOCK_RANGE
,

110 
	#_SC_MEMLOCK_RANGE
 
_SC_MEMLOCK_RANGE


	)

111 
	m_SC_MEMORY_PROTECTION
,

112 
	#_SC_MEMORY_PROTECTION
 
_SC_MEMORY_PROTECTION


	)

113 
	m_SC_MESSAGE_PASSING
,

114 
	#_SC_MESSAGE_PASSING
 
_SC_MESSAGE_PASSING


	)

115 
	m_SC_SEMAPHORES
,

116 
	#_SC_SEMAPHORES
 
_SC_SEMAPHORES


	)

117 
	m_SC_SHARED_MEMORY_OBJECTS
,

118 
	#_SC_SHARED_MEMORY_OBJECTS
 
_SC_SHARED_MEMORY_OBJECTS


	)

119 
	m_SC_AIO_LISTIO_MAX
,

120 
	#_SC_AIO_LISTIO_MAX
 
_SC_AIO_LISTIO_MAX


	)

121 
	m_SC_AIO_MAX
,

122 
	#_SC_AIO_MAX
 
_SC_AIO_MAX


	)

123 
	m_SC_AIO_PRIO_DELTA_MAX
,

124 
	#_SC_AIO_PRIO_DELTA_MAX
 
_SC_AIO_PRIO_DELTA_MAX


	)

125 
	m_SC_DELAYTIMER_MAX
,

126 
	#_SC_DELAYTIMER_MAX
 
_SC_DELAYTIMER_MAX


	)

127 
	m_SC_MQ_OPEN_MAX
,

128 
	#_SC_MQ_OPEN_MAX
 
_SC_MQ_OPEN_MAX


	)

129 
	m_SC_MQ_PRIO_MAX
,

130 
	#_SC_MQ_PRIO_MAX
 
_SC_MQ_PRIO_MAX


	)

131 
	m_SC_VERSION
,

132 
	#_SC_VERSION
 
_SC_VERSION


	)

133 
	m_SC_PAGESIZE
,

134 
	#_SC_PAGESIZE
 
_SC_PAGESIZE


	)

135 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

136 
	m_SC_RTSIG_MAX
,

137 
	#_SC_RTSIG_MAX
 
_SC_RTSIG_MAX


	)

138 
	m_SC_SEM_NSEMS_MAX
,

139 
	#_SC_SEM_NSEMS_MAX
 
_SC_SEM_NSEMS_MAX


	)

140 
	m_SC_SEM_VALUE_MAX
,

141 
	#_SC_SEM_VALUE_MAX
 
_SC_SEM_VALUE_MAX


	)

142 
	m_SC_SIGQUEUE_MAX
,

143 
	#_SC_SIGQUEUE_MAX
 
_SC_SIGQUEUE_MAX


	)

144 
	m_SC_TIMER_MAX
,

145 
	#_SC_TIMER_MAX
 
_SC_TIMER_MAX


	)

149 
	m_SC_BC_BASE_MAX
,

150 
	#_SC_BC_BASE_MAX
 
_SC_BC_BASE_MAX


	)

151 
	m_SC_BC_DIM_MAX
,

152 
	#_SC_BC_DIM_MAX
 
_SC_BC_DIM_MAX


	)

153 
	m_SC_BC_SCALE_MAX
,

154 
	#_SC_BC_SCALE_MAX
 
_SC_BC_SCALE_MAX


	)

155 
	m_SC_BC_STRING_MAX
,

156 
	#_SC_BC_STRING_MAX
 
_SC_BC_STRING_MAX


	)

157 
	m_SC_COLL_WEIGHTS_MAX
,

158 
	#_SC_COLL_WEIGHTS_MAX
 
_SC_COLL_WEIGHTS_MAX


	)

159 
	m_SC_EQUIV_CLASS_MAX
,

160 
	#_SC_EQUIV_CLASS_MAX
 
_SC_EQUIV_CLASS_MAX


	)

161 
	m_SC_EXPR_NEST_MAX
,

162 
	#_SC_EXPR_NEST_MAX
 
_SC_EXPR_NEST_MAX


	)

163 
	m_SC_LINE_MAX
,

164 
	#_SC_LINE_MAX
 
_SC_LINE_MAX


	)

165 
	m_SC_RE_DUP_MAX
,

166 
	#_SC_RE_DUP_MAX
 
_SC_RE_DUP_MAX


	)

167 
	m_SC_CHARCLASS_NAME_MAX
,

168 
	#_SC_CHARCLASS_NAME_MAX
 
_SC_CHARCLASS_NAME_MAX


	)

170 
	m_SC_2_VERSION
,

171 
	#_SC_2_VERSION
 
_SC_2_VERSION


	)

172 
	m_SC_2_C_BIND
,

173 
	#_SC_2_C_BIND
 
_SC_2_C_BIND


	)

174 
	m_SC_2_C_DEV
,

175 
	#_SC_2_C_DEV
 
_SC_2_C_DEV


	)

176 
	m_SC_2_FORT_DEV
,

177 
	#_SC_2_FORT_DEV
 
_SC_2_FORT_DEV


	)

178 
	m_SC_2_FORT_RUN
,

179 
	#_SC_2_FORT_RUN
 
_SC_2_FORT_RUN


	)

180 
	m_SC_2_SW_DEV
,

181 
	#_SC_2_SW_DEV
 
_SC_2_SW_DEV


	)

182 
	m_SC_2_LOCALEDEF
,

183 
	#_SC_2_LOCALEDEF
 
_SC_2_LOCALEDEF


	)

185 
	m_SC_PII
,

186 
	#_SC_PII
 
_SC_PII


	)

187 
	m_SC_PII_XTI
,

188 
	#_SC_PII_XTI
 
_SC_PII_XTI


	)

189 
	m_SC_PII_SOCKET
,

190 
	#_SC_PII_SOCKET
 
_SC_PII_SOCKET


	)

191 
	m_SC_PII_INTERNET
,

192 
	#_SC_PII_INTERNET
 
_SC_PII_INTERNET


	)

193 
	m_SC_PII_OSI
,

194 
	#_SC_PII_OSI
 
_SC_PII_OSI


	)

195 
	m_SC_POLL
,

196 
	#_SC_POLL
 
_SC_POLL


	)

197 
	m_SC_SELECT
,

198 
	#_SC_SELECT
 
_SC_SELECT


	)

199 
	m_SC_UIO_MAXIOV
,

200 
	#_SC_UIO_MAXIOV
 
_SC_UIO_MAXIOV


	)

201 
	m_SC_IOV_MAX
 = 
_SC_UIO_MAXIOV
,

202 
	#_SC_IOV_MAX
 
_SC_IOV_MAX


	)

203 
	m_SC_PII_INTERNET_STREAM
,

204 
	#_SC_PII_INTERNET_STREAM
 
_SC_PII_INTERNET_STREAM


	)

205 
	m_SC_PII_INTERNET_DGRAM
,

206 
	#_SC_PII_INTERNET_DGRAM
 
_SC_PII_INTERNET_DGRAM


	)

207 
	m_SC_PII_OSI_COTS
,

208 
	#_SC_PII_OSI_COTS
 
_SC_PII_OSI_COTS


	)

209 
	m_SC_PII_OSI_CLTS
,

210 
	#_SC_PII_OSI_CLTS
 
_SC_PII_OSI_CLTS


	)

211 
	m_SC_PII_OSI_M
,

212 
	#_SC_PII_OSI_M
 
_SC_PII_OSI_M


	)

213 
	m_SC_T_IOV_MAX
,

214 
	#_SC_T_IOV_MAX
 
_SC_T_IOV_MAX


	)

217 
	m_SC_THREADS
,

218 
	#_SC_THREADS
 
_SC_THREADS


	)

219 
	m_SC_THREAD_SAFE_FUNCTIONS
,

220 
	#_SC_THREAD_SAFE_FUNCTIONS
 
_SC_THREAD_SAFE_FUNCTIONS


	)

221 
	m_SC_GETGR_R_SIZE_MAX
,

222 
	#_SC_GETGR_R_SIZE_MAX
 
_SC_GETGR_R_SIZE_MAX


	)

223 
	m_SC_GETPW_R_SIZE_MAX
,

224 
	#_SC_GETPW_R_SIZE_MAX
 
_SC_GETPW_R_SIZE_MAX


	)

225 
	m_SC_LOGIN_NAME_MAX
,

226 
	#_SC_LOGIN_NAME_MAX
 
_SC_LOGIN_NAME_MAX


	)

227 
	m_SC_TTY_NAME_MAX
,

228 
	#_SC_TTY_NAME_MAX
 
_SC_TTY_NAME_MAX


	)

229 
	m_SC_THREAD_DESTRUCTOR_ITERATIONS
,

230 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 
_SC_THREAD_DESTRUCTOR_ITERATIONS


	)

231 
	m_SC_THREAD_KEYS_MAX
,

232 
	#_SC_THREAD_KEYS_MAX
 
_SC_THREAD_KEYS_MAX


	)

233 
	m_SC_THREAD_STACK_MIN
,

234 
	#_SC_THREAD_STACK_MIN
 
_SC_THREAD_STACK_MIN


	)

235 
	m_SC_THREAD_THREADS_MAX
,

236 
	#_SC_THREAD_THREADS_MAX
 
_SC_THREAD_THREADS_MAX


	)

237 
	m_SC_THREAD_ATTR_STACKADDR
,

238 
	#_SC_THREAD_ATTR_STACKADDR
 
_SC_THREAD_ATTR_STACKADDR


	)

239 
	m_SC_THREAD_ATTR_STACKSIZE
,

240 
	#_SC_THREAD_ATTR_STACKSIZE
 
_SC_THREAD_ATTR_STACKSIZE


	)

241 
	m_SC_THREAD_PRIORITY_SCHEDULING
,

242 
	#_SC_THREAD_PRIORITY_SCHEDULING
 
_SC_THREAD_PRIORITY_SCHEDULING


	)

243 
	m_SC_THREAD_PRIO_INHERIT
,

244 
	#_SC_THREAD_PRIO_INHERIT
 
_SC_THREAD_PRIO_INHERIT


	)

245 
	m_SC_THREAD_PRIO_PROTECT
,

246 
	#_SC_THREAD_PRIO_PROTECT
 
_SC_THREAD_PRIO_PROTECT


	)

247 
	m_SC_THREAD_PROCESS_SHARED
,

248 
	#_SC_THREAD_PROCESS_SHARED
 
_SC_THREAD_PROCESS_SHARED


	)

250 
	m_SC_NPROCESSORS_CONF
,

251 
	#_SC_NPROCESSORS_CONF
 
_SC_NPROCESSORS_CONF


	)

252 
	m_SC_NPROCESSORS_ONLN
,

253 
	#_SC_NPROCESSORS_ONLN
 
_SC_NPROCESSORS_ONLN


	)

254 
	m_SC_PHYS_PAGES
,

255 
	#_SC_PHYS_PAGES
 
_SC_PHYS_PAGES


	)

256 
	m_SC_AVPHYS_PAGES
,

257 
	#_SC_AVPHYS_PAGES
 
_SC_AVPHYS_PAGES


	)

258 
	m_SC_ATEXIT_MAX
,

259 
	#_SC_ATEXIT_MAX
 
_SC_ATEXIT_MAX


	)

260 
	m_SC_PASS_MAX
,

261 
	#_SC_PASS_MAX
 
_SC_PASS_MAX


	)

263 
	m_SC_XOPEN_VERSION
,

264 
	#_SC_XOPEN_VERSION
 
_SC_XOPEN_VERSION


	)

265 
	m_SC_XOPEN_XCU_VERSION
,

266 
	#_SC_XOPEN_XCU_VERSION
 
_SC_XOPEN_XCU_VERSION


	)

267 
	m_SC_XOPEN_UNIX
,

268 
	#_SC_XOPEN_UNIX
 
_SC_XOPEN_UNIX


	)

269 
	m_SC_XOPEN_CRYPT
,

270 
	#_SC_XOPEN_CRYPT
 
_SC_XOPEN_CRYPT


	)

271 
	m_SC_XOPEN_ENH_I18N
,

272 
	#_SC_XOPEN_ENH_I18N
 
_SC_XOPEN_ENH_I18N


	)

273 
	m_SC_XOPEN_SHM
,

274 
	#_SC_XOPEN_SHM
 
_SC_XOPEN_SHM


	)

276 
	m_SC_2_CHAR_TERM
,

277 
	#_SC_2_CHAR_TERM
 
_SC_2_CHAR_TERM


	)

278 
	m_SC_2_C_VERSION
,

279 
	#_SC_2_C_VERSION
 
_SC_2_C_VERSION


	)

280 
	m_SC_2_UPE
,

281 
	#_SC_2_UPE
 
_SC_2_UPE


	)

283 
	m_SC_XOPEN_XPG2
,

284 
	#_SC_XOPEN_XPG2
 
_SC_XOPEN_XPG2


	)

285 
	m_SC_XOPEN_XPG3
,

286 
	#_SC_XOPEN_XPG3
 
_SC_XOPEN_XPG3


	)

287 
	m_SC_XOPEN_XPG4
,

288 
	#_SC_XOPEN_XPG4
 
_SC_XOPEN_XPG4


	)

290 
	m_SC_CHAR_BIT
,

291 
	#_SC_CHAR_BIT
 
_SC_CHAR_BIT


	)

292 
	m_SC_CHAR_MAX
,

293 
	#_SC_CHAR_MAX
 
_SC_CHAR_MAX


	)

294 
	m_SC_CHAR_MIN
,

295 
	#_SC_CHAR_MIN
 
_SC_CHAR_MIN


	)

296 
	m_SC_INT_MAX
,

297 
	#_SC_INT_MAX
 
_SC_INT_MAX


	)

298 
	m_SC_INT_MIN
,

299 
	#_SC_INT_MIN
 
_SC_INT_MIN


	)

300 
	m_SC_LONG_BIT
,

301 
	#_SC_LONG_BIT
 
_SC_LONG_BIT


	)

302 
	m_SC_WORD_BIT
,

303 
	#_SC_WORD_BIT
 
_SC_WORD_BIT


	)

304 
	m_SC_MB_LEN_MAX
,

305 
	#_SC_MB_LEN_MAX
 
_SC_MB_LEN_MAX


	)

306 
	m_SC_NZERO
,

307 
	#_SC_NZERO
 
_SC_NZERO


	)

308 
	m_SC_SSIZE_MAX
,

309 
	#_SC_SSIZE_MAX
 
_SC_SSIZE_MAX


	)

310 
	m_SC_SCHAR_MAX
,

311 
	#_SC_SCHAR_MAX
 
_SC_SCHAR_MAX


	)

312 
	m_SC_SCHAR_MIN
,

313 
	#_SC_SCHAR_MIN
 
_SC_SCHAR_MIN


	)

314 
	m_SC_SHRT_MAX
,

315 
	#_SC_SHRT_MAX
 
_SC_SHRT_MAX


	)

316 
	m_SC_SHRT_MIN
,

317 
	#_SC_SHRT_MIN
 
_SC_SHRT_MIN


	)

318 
	m_SC_UCHAR_MAX
,

319 
	#_SC_UCHAR_MAX
 
_SC_UCHAR_MAX


	)

320 
	m_SC_UINT_MAX
,

321 
	#_SC_UINT_MAX
 
_SC_UINT_MAX


	)

322 
	m_SC_ULONG_MAX
,

323 
	#_SC_ULONG_MAX
 
_SC_ULONG_MAX


	)

324 
	m_SC_USHRT_MAX
,

325 
	#_SC_USHRT_MAX
 
_SC_USHRT_MAX


	)

327 
	m_SC_NL_ARGMAX
,

328 
	#_SC_NL_ARGMAX
 
_SC_NL_ARGMAX


	)

329 
	m_SC_NL_LANGMAX
,

330 
	#_SC_NL_LANGMAX
 
_SC_NL_LANGMAX


	)

331 
	m_SC_NL_MSGMAX
,

332 
	#_SC_NL_MSGMAX
 
_SC_NL_MSGMAX


	)

333 
	m_SC_NL_NMAX
,

334 
	#_SC_NL_NMAX
 
_SC_NL_NMAX


	)

335 
	m_SC_NL_SETMAX
,

336 
	#_SC_NL_SETMAX
 
_SC_NL_SETMAX


	)

337 
	m_SC_NL_TEXTMAX
,

338 
	#_SC_NL_TEXTMAX
 
_SC_NL_TEXTMAX


	)

340 
	m_SC_XBS5_ILP32_OFF32
,

341 
	#_SC_XBS5_ILP32_OFF32
 
_SC_XBS5_ILP32_OFF32


	)

342 
	m_SC_XBS5_ILP32_OFFBIG
,

343 
	#_SC_XBS5_ILP32_OFFBIG
 
_SC_XBS5_ILP32_OFFBIG


	)

344 
	m_SC_XBS5_LP64_OFF64
,

345 
	#_SC_XBS5_LP64_OFF64
 
_SC_XBS5_LP64_OFF64


	)

346 
	m_SC_XBS5_LPBIG_OFFBIG
,

347 
	#_SC_XBS5_LPBIG_OFFBIG
 
_SC_XBS5_LPBIG_OFFBIG


	)

349 
	m_SC_XOPEN_LEGACY
,

350 
	#_SC_XOPEN_LEGACY
 
_SC_XOPEN_LEGACY


	)

351 
	m_SC_XOPEN_REALTIME
,

352 
	#_SC_XOPEN_REALTIME
 
_SC_XOPEN_REALTIME


	)

353 
	m_SC_XOPEN_REALTIME_THREADS
,

354 
	#_SC_XOPEN_REALTIME_THREADS
 
_SC_XOPEN_REALTIME_THREADS


	)

356 
	m_SC_ADVISORY_INFO
,

357 
	#_SC_ADVISORY_INFO
 
_SC_ADVISORY_INFO


	)

358 
	m_SC_BARRIERS
,

359 
	#_SC_BARRIERS
 
_SC_BARRIERS


	)

360 
	m_SC_BASE
,

361 
	#_SC_BASE
 
_SC_BASE


	)

362 
	m_SC_C_LANG_SUPPORT
,

363 
	#_SC_C_LANG_SUPPORT
 
_SC_C_LANG_SUPPORT


	)

364 
	m_SC_C_LANG_SUPPORT_R
,

365 
	#_SC_C_LANG_SUPPORT_R
 
_SC_C_LANG_SUPPORT_R


	)

366 
	m_SC_CLOCK_SELECTION
,

367 
	#_SC_CLOCK_SELECTION
 
_SC_CLOCK_SELECTION


	)

368 
	m_SC_CPUTIME
,

369 
	#_SC_CPUTIME
 
_SC_CPUTIME


	)

370 
	m_SC_THREAD_CPUTIME
,

371 
	#_SC_THREAD_CPUTIME
 
_SC_THREAD_CPUTIME


	)

372 
	m_SC_DEVICE_IO
,

373 
	#_SC_DEVICE_IO
 
_SC_DEVICE_IO


	)

374 
	m_SC_DEVICE_SPECIFIC
,

375 
	#_SC_DEVICE_SPECIFIC
 
_SC_DEVICE_SPECIFIC


	)

376 
	m_SC_DEVICE_SPECIFIC_R
,

377 
	#_SC_DEVICE_SPECIFIC_R
 
_SC_DEVICE_SPECIFIC_R


	)

378 
	m_SC_FD_MGMT
,

379 
	#_SC_FD_MGMT
 
_SC_FD_MGMT


	)

380 
	m_SC_FIFO
,

381 
	#_SC_FIFO
 
_SC_FIFO


	)

382 
	m_SC_PIPE
,

383 
	#_SC_PIPE
 
_SC_PIPE


	)

384 
	m_SC_FILE_ATTRIBUTES
,

385 
	#_SC_FILE_ATTRIBUTES
 
_SC_FILE_ATTRIBUTES


	)

386 
	m_SC_FILE_LOCKING
,

387 
	#_SC_FILE_LOCKING
 
_SC_FILE_LOCKING


	)

388 
	m_SC_FILE_SYSTEM
,

389 
	#_SC_FILE_SYSTEM
 
_SC_FILE_SYSTEM


	)

390 
	m_SC_MONOTONIC_CLOCK
,

391 
	#_SC_MONOTONIC_CLOCK
 
_SC_MONOTONIC_CLOCK


	)

392 
	m_SC_MULTI_PROCESS
,

393 
	#_SC_MULTI_PROCESS
 
_SC_MULTI_PROCESS


	)

394 
	m_SC_SINGLE_PROCESS
,

395 
	#_SC_SINGLE_PROCESS
 
_SC_SINGLE_PROCESS


	)

396 
	m_SC_NETWORKING
,

397 
	#_SC_NETWORKING
 
_SC_NETWORKING


	)

398 
	m_SC_READER_WRITER_LOCKS
,

399 
	#_SC_READER_WRITER_LOCKS
 
_SC_READER_WRITER_LOCKS


	)

400 
	m_SC_SPIN_LOCKS
,

401 
	#_SC_SPIN_LOCKS
 
_SC_SPIN_LOCKS


	)

402 
	m_SC_REGEXP
,

403 
	#_SC_REGEXP
 
_SC_REGEXP


	)

404 
	m_SC_REGEX_VERSION
,

405 
	#_SC_REGEX_VERSION
 
_SC_REGEX_VERSION


	)

406 
	m_SC_SHELL
,

407 
	#_SC_SHELL
 
_SC_SHELL


	)

408 
	m_SC_SIGNALS
,

409 
	#_SC_SIGNALS
 
_SC_SIGNALS


	)

410 
	m_SC_SPAWN
,

411 
	#_SC_SPAWN
 
_SC_SPAWN


	)

412 
	m_SC_SPORADIC_SERVER
,

413 
	#_SC_SPORADIC_SERVER
 
_SC_SPORADIC_SERVER


	)

414 
	m_SC_THREAD_SPORADIC_SERVER
,

415 
	#_SC_THREAD_SPORADIC_SERVER
 
_SC_THREAD_SPORADIC_SERVER


	)

416 
	m_SC_SYSTEM_DATABASE
,

417 
	#_SC_SYSTEM_DATABASE
 
_SC_SYSTEM_DATABASE


	)

418 
	m_SC_SYSTEM_DATABASE_R
,

419 
	#_SC_SYSTEM_DATABASE_R
 
_SC_SYSTEM_DATABASE_R


	)

420 
	m_SC_TIMEOUTS
,

421 
	#_SC_TIMEOUTS
 
_SC_TIMEOUTS


	)

422 
	m_SC_TYPED_MEMORY_OBJECTS
,

423 
	#_SC_TYPED_MEMORY_OBJECTS
 
_SC_TYPED_MEMORY_OBJECTS


	)

424 
	m_SC_USER_GROUPS
,

425 
	#_SC_USER_GROUPS
 
_SC_USER_GROUPS


	)

426 
	m_SC_USER_GROUPS_R
,

427 
	#_SC_USER_GROUPS_R
 
_SC_USER_GROUPS_R


	)

428 
	m_SC_2_PBS
,

429 
	#_SC_2_PBS
 
_SC_2_PBS


	)

430 
	m_SC_2_PBS_ACCOUNTING
,

431 
	#_SC_2_PBS_ACCOUNTING
 
_SC_2_PBS_ACCOUNTING


	)

432 
	m_SC_2_PBS_LOCATE
,

433 
	#_SC_2_PBS_LOCATE
 
_SC_2_PBS_LOCATE


	)

434 
	m_SC_2_PBS_MESSAGE
,

435 
	#_SC_2_PBS_MESSAGE
 
_SC_2_PBS_MESSAGE


	)

436 
	m_SC_2_PBS_TRACK
,

437 
	#_SC_2_PBS_TRACK
 
_SC_2_PBS_TRACK


	)

438 
	m_SC_SYMLOOP_MAX
,

439 
	#_SC_SYMLOOP_MAX
 
_SC_SYMLOOP_MAX


	)

440 
	m_SC_STREAMS
,

441 
	#_SC_STREAMS
 
_SC_STREAMS


	)

442 
	m_SC_2_PBS_CHECKPOINT
,

443 
	#_SC_2_PBS_CHECKPOINT
 
_SC_2_PBS_CHECKPOINT


	)

445 
	m_SC_V6_ILP32_OFF32
,

446 
	#_SC_V6_ILP32_OFF32
 
_SC_V6_ILP32_OFF32


	)

447 
	m_SC_V6_ILP32_OFFBIG
,

448 
	#_SC_V6_ILP32_OFFBIG
 
_SC_V6_ILP32_OFFBIG


	)

449 
	m_SC_V6_LP64_OFF64
,

450 
	#_SC_V6_LP64_OFF64
 
_SC_V6_LP64_OFF64


	)

451 
	m_SC_V6_LPBIG_OFFBIG
,

452 
	#_SC_V6_LPBIG_OFFBIG
 
_SC_V6_LPBIG_OFFBIG


	)

454 
	m_SC_HOST_NAME_MAX
,

455 
	#_SC_HOST_NAME_MAX
 
_SC_HOST_NAME_MAX


	)

456 
	m_SC_TRACE
,

457 
	#_SC_TRACE
 
_SC_TRACE


	)

458 
	m_SC_TRACE_EVENT_FILTER
,

459 
	#_SC_TRACE_EVENT_FILTER
 
_SC_TRACE_EVENT_FILTER


	)

460 
	m_SC_TRACE_INHERIT
,

461 
	#_SC_TRACE_INHERIT
 
_SC_TRACE_INHERIT


	)

462 
	m_SC_TRACE_LOG
,

463 
	#_SC_TRACE_LOG
 
_SC_TRACE_LOG


	)

465 
	m_SC_LEVEL1_ICACHE_SIZE
,

466 
	#_SC_LEVEL1_ICACHE_SIZE
 
_SC_LEVEL1_ICACHE_SIZE


	)

467 
	m_SC_LEVEL1_ICACHE_ASSOC
,

468 
	#_SC_LEVEL1_ICACHE_ASSOC
 
_SC_LEVEL1_ICACHE_ASSOC


	)

469 
	m_SC_LEVEL1_ICACHE_LINESIZE
,

470 
	#_SC_LEVEL1_ICACHE_LINESIZE
 
_SC_LEVEL1_ICACHE_LINESIZE


	)

471 
	m_SC_LEVEL1_DCACHE_SIZE
,

472 
	#_SC_LEVEL1_DCACHE_SIZE
 
_SC_LEVEL1_DCACHE_SIZE


	)

473 
	m_SC_LEVEL1_DCACHE_ASSOC
,

474 
	#_SC_LEVEL1_DCACHE_ASSOC
 
_SC_LEVEL1_DCACHE_ASSOC


	)

475 
	m_SC_LEVEL1_DCACHE_LINESIZE
,

476 
	#_SC_LEVEL1_DCACHE_LINESIZE
 
_SC_LEVEL1_DCACHE_LINESIZE


	)

477 
	m_SC_LEVEL2_CACHE_SIZE
,

478 
	#_SC_LEVEL2_CACHE_SIZE
 
_SC_LEVEL2_CACHE_SIZE


	)

479 
	m_SC_LEVEL2_CACHE_ASSOC
,

480 
	#_SC_LEVEL2_CACHE_ASSOC
 
_SC_LEVEL2_CACHE_ASSOC


	)

481 
	m_SC_LEVEL2_CACHE_LINESIZE
,

482 
	#_SC_LEVEL2_CACHE_LINESIZE
 
_SC_LEVEL2_CACHE_LINESIZE


	)

483 
	m_SC_LEVEL3_CACHE_SIZE
,

484 
	#_SC_LEVEL3_CACHE_SIZE
 
_SC_LEVEL3_CACHE_SIZE


	)

485 
	m_SC_LEVEL3_CACHE_ASSOC
,

486 
	#_SC_LEVEL3_CACHE_ASSOC
 
_SC_LEVEL3_CACHE_ASSOC


	)

487 
	m_SC_LEVEL3_CACHE_LINESIZE
,

488 
	#_SC_LEVEL3_CACHE_LINESIZE
 
_SC_LEVEL3_CACHE_LINESIZE


	)

489 
	m_SC_LEVEL4_CACHE_SIZE
,

490 
	#_SC_LEVEL4_CACHE_SIZE
 
_SC_LEVEL4_CACHE_SIZE


	)

491 
	m_SC_LEVEL4_CACHE_ASSOC
,

492 
	#_SC_LEVEL4_CACHE_ASSOC
 
_SC_LEVEL4_CACHE_ASSOC


	)

493 
	m_SC_LEVEL4_CACHE_LINESIZE
,

494 
	#_SC_LEVEL4_CACHE_LINESIZE
 
_SC_LEVEL4_CACHE_LINESIZE


	)

497 
	m_SC_IPV6
 = 
_SC_LEVEL1_ICACHE_SIZE
 + 50,

498 
	#_SC_IPV6
 
_SC_IPV6


	)

499 
	m_SC_RAW_SOCKETS
,

500 
	#_SC_RAW_SOCKETS
 
_SC_RAW_SOCKETS


	)

502 
	m_SC_V7_ILP32_OFF32
,

503 
	#_SC_V7_ILP32_OFF32
 
_SC_V7_ILP32_OFF32


	)

504 
	m_SC_V7_ILP32_OFFBIG
,

505 
	#_SC_V7_ILP32_OFFBIG
 
_SC_V7_ILP32_OFFBIG


	)

506 
	m_SC_V7_LP64_OFF64
,

507 
	#_SC_V7_LP64_OFF64
 
_SC_V7_LP64_OFF64


	)

508 
	m_SC_V7_LPBIG_OFFBIG
,

509 
	#_SC_V7_LPBIG_OFFBIG
 
_SC_V7_LPBIG_OFFBIG


	)

511 
	m_SC_SS_REPL_MAX
,

512 
	#_SC_SS_REPL_MAX
 
_SC_SS_REPL_MAX


	)

514 
	m_SC_TRACE_EVENT_NAME_MAX
,

515 
	#_SC_TRACE_EVENT_NAME_MAX
 
_SC_TRACE_EVENT_NAME_MAX


	)

516 
	m_SC_TRACE_NAME_MAX
,

517 
	#_SC_TRACE_NAME_MAX
 
_SC_TRACE_NAME_MAX


	)

518 
	m_SC_TRACE_SYS_MAX
,

519 
	#_SC_TRACE_SYS_MAX
 
_SC_TRACE_SYS_MAX


	)

520 
	m_SC_TRACE_USER_EVENT_MAX
,

521 
	#_SC_TRACE_USER_EVENT_MAX
 
_SC_TRACE_USER_EVENT_MAX


	)

523 
	m_SC_XOPEN_STREAMS
,

524 
	#_SC_XOPEN_STREAMS
 
_SC_XOPEN_STREAMS


	)

526 
	m_SC_THREAD_ROBUST_PRIO_INHERIT
,

527 
	#_SC_THREAD_ROBUST_PRIO_INHERIT
 
_SC_THREAD_ROBUST_PRIO_INHERIT


	)

528 
	m_SC_THREAD_ROBUST_PRIO_PROTECT


529 
	#_SC_THREAD_ROBUST_PRIO_PROTECT
 
_SC_THREAD_ROBUST_PRIO_PROTECT


	)

535 
	m_CS_PATH
,

536 
	#_CS_PATH
 
_CS_PATH


	)

538 
	m_CS_V6_WIDTH_RESTRICTED_ENVS
,

539 
	#_CS_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

540 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

542 
	m_CS_GNU_LIBC_VERSION
,

543 
	#_CS_GNU_LIBC_VERSION
 
_CS_GNU_LIBC_VERSION


	)

544 
	m_CS_GNU_LIBPTHREAD_VERSION
,

545 
	#_CS_GNU_LIBPTHREAD_VERSION
 
_CS_GNU_LIBPTHREAD_VERSION


	)

547 
	m_CS_V5_WIDTH_RESTRICTED_ENVS
,

548 
	#_CS_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

549 
	#_CS_POSIX_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

551 
	m_CS_V7_WIDTH_RESTRICTED_ENVS
,

552 
	#_CS_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

553 
	#_CS_POSIX_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

555 
	m_CS_LFS_CFLAGS
 = 1000,

556 
	#_CS_LFS_CFLAGS
 
_CS_LFS_CFLAGS


	)

557 
	m_CS_LFS_LDFLAGS
,

558 
	#_CS_LFS_LDFLAGS
 
_CS_LFS_LDFLAGS


	)

559 
	m_CS_LFS_LIBS
,

560 
	#_CS_LFS_LIBS
 
_CS_LFS_LIBS


	)

561 
	m_CS_LFS_LINTFLAGS
,

562 
	#_CS_LFS_LINTFLAGS
 
_CS_LFS_LINTFLAGS


	)

563 
	m_CS_LFS64_CFLAGS
,

564 
	#_CS_LFS64_CFLAGS
 
_CS_LFS64_CFLAGS


	)

565 
	m_CS_LFS64_LDFLAGS
,

566 
	#_CS_LFS64_LDFLAGS
 
_CS_LFS64_LDFLAGS


	)

567 
	m_CS_LFS64_LIBS
,

568 
	#_CS_LFS64_LIBS
 
_CS_LFS64_LIBS


	)

569 
	m_CS_LFS64_LINTFLAGS
,

570 
	#_CS_LFS64_LINTFLAGS
 
_CS_LFS64_LINTFLAGS


	)

572 
	m_CS_XBS5_ILP32_OFF32_CFLAGS
 = 1100,

573 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 
_CS_XBS5_ILP32_OFF32_CFLAGS


	)

574 
	m_CS_XBS5_ILP32_OFF32_LDFLAGS
,

575 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 
_CS_XBS5_ILP32_OFF32_LDFLAGS


	)

576 
	m_CS_XBS5_ILP32_OFF32_LIBS
,

577 
	#_CS_XBS5_ILP32_OFF32_LIBS
 
_CS_XBS5_ILP32_OFF32_LIBS


	)

578 
	m_CS_XBS5_ILP32_OFF32_LINTFLAGS
,

579 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 
_CS_XBS5_ILP32_OFF32_LINTFLAGS


	)

580 
	m_CS_XBS5_ILP32_OFFBIG_CFLAGS
,

581 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 
_CS_XBS5_ILP32_OFFBIG_CFLAGS


	)

582 
	m_CS_XBS5_ILP32_OFFBIG_LDFLAGS
,

583 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LDFLAGS


	)

584 
	m_CS_XBS5_ILP32_OFFBIG_LIBS
,

585 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 
_CS_XBS5_ILP32_OFFBIG_LIBS


	)

586 
	m_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
,

587 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LINTFLAGS


	)

588 
	m_CS_XBS5_LP64_OFF64_CFLAGS
,

589 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 
_CS_XBS5_LP64_OFF64_CFLAGS


	)

590 
	m_CS_XBS5_LP64_OFF64_LDFLAGS
,

591 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 
_CS_XBS5_LP64_OFF64_LDFLAGS


	)

592 
	m_CS_XBS5_LP64_OFF64_LIBS
,

593 
	#_CS_XBS5_LP64_OFF64_LIBS
 
_CS_XBS5_LP64_OFF64_LIBS


	)

594 
	m_CS_XBS5_LP64_OFF64_LINTFLAGS
,

595 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 
_CS_XBS5_LP64_OFF64_LINTFLAGS


	)

596 
	m_CS_XBS5_LPBIG_OFFBIG_CFLAGS
,

597 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_CFLAGS


	)

598 
	m_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
,

599 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LDFLAGS


	)

600 
	m_CS_XBS5_LPBIG_OFFBIG_LIBS
,

601 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 
_CS_XBS5_LPBIG_OFFBIG_LIBS


	)

602 
	m_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
,

603 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS


	)

605 
	m_CS_POSIX_V6_ILP32_OFF32_CFLAGS
,

606 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_CFLAGS


	)

607 
	m_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
,

608 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LDFLAGS


	)

609 
	m_CS_POSIX_V6_ILP32_OFF32_LIBS
,

610 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 
_CS_POSIX_V6_ILP32_OFF32_LIBS


	)

611 
	m_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
,

612 
	#_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS


	)

613 
	m_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
,

614 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS


	)

615 
	m_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
,

616 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS


	)

617 
	m_CS_POSIX_V6_ILP32_OFFBIG_LIBS
,

618 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V6_ILP32_OFFBIG_LIBS


	)

619 
	m_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
,

620 
	#_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS


	)

621 
	m_CS_POSIX_V6_LP64_OFF64_CFLAGS
,

622 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 
_CS_POSIX_V6_LP64_OFF64_CFLAGS


	)

623 
	m_CS_POSIX_V6_LP64_OFF64_LDFLAGS
,

624 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LDFLAGS


	)

625 
	m_CS_POSIX_V6_LP64_OFF64_LIBS
,

626 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 
_CS_POSIX_V6_LP64_OFF64_LIBS


	)

627 
	m_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
,

628 
	#_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LINTFLAGS


	)

629 
	m_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
,

630 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS


	)

631 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
,

632 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS


	)

633 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
,

634 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LIBS


	)

635 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
,

636 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


	)

638 
	m_CS_POSIX_V7_ILP32_OFF32_CFLAGS
,

639 
	#_CS_POSIX_V7_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_CFLAGS


	)

640 
	m_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
,

641 
	#_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LDFLAGS


	)

642 
	m_CS_POSIX_V7_ILP32_OFF32_LIBS
,

643 
	#_CS_POSIX_V7_ILP32_OFF32_LIBS
 
_CS_POSIX_V7_ILP32_OFF32_LIBS


	)

644 
	m_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
,

645 
	#_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS


	)

646 
	m_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
,

647 
	#_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS


	)

648 
	m_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
,

649 
	#_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS


	)

650 
	m_CS_POSIX_V7_ILP32_OFFBIG_LIBS
,

651 
	#_CS_POSIX_V7_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V7_ILP32_OFFBIG_LIBS


	)

652 
	m_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
,

653 
	#_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS


	)

654 
	m_CS_POSIX_V7_LP64_OFF64_CFLAGS
,

655 
	#_CS_POSIX_V7_LP64_OFF64_CFLAGS
 
_CS_POSIX_V7_LP64_OFF64_CFLAGS


	)

656 
	m_CS_POSIX_V7_LP64_OFF64_LDFLAGS
,

657 
	#_CS_POSIX_V7_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LDFLAGS


	)

658 
	m_CS_POSIX_V7_LP64_OFF64_LIBS
,

659 
	#_CS_POSIX_V7_LP64_OFF64_LIBS
 
_CS_POSIX_V7_LP64_OFF64_LIBS


	)

660 
	m_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
,

661 
	#_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LINTFLAGS


	)

662 
	m_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
,

663 
	#_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS


	)

664 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
,

665 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS


	)

666 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
,

667 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LIBS


	)

668 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
,

669 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS


	)

671 
	m_CS_V6_ENV
,

672 
	#_CS_V6_ENV
 
_CS_V6_ENV


	)

673 
	m_CS_V7_ENV


674 
	#_CS_V7_ENV
 
_CS_V7_ENV


	)

	@/usr/include/bits/dlfcn.h

19 #iâdeà
_DLFCN_H


24 
	#RTLD_LAZY
 0x00001

	)

25 
	#RTLD_NOW
 0x00002

	)

26 
	#RTLD_BINDING_MASK
 0x3

	)

27 
	#RTLD_NOLOAD
 0x00004

	)

28 
	#RTLD_DEEPBIND
 0x00008

	)

33 
	#RTLD_GLOBAL
 0x00100

	)

38 
	#RTLD_LOCAL
 0

	)

41 
	#RTLD_NODELETE
 0x01000

	)

43 #ifdeà
__USE_GNU


54 
	#DL_CALL_FCT
(
fùp
, 
¬gs
) \

55 (
	`_dl_mcouÁ_w¿µ”_check
 ((*è(
fùp
)), (*(fùp)è
¬gs
)

	)

57 
__BEGIN_DECLS


60 
	$_dl_mcouÁ_w¿µ”_check
 (*
__£låc
è
__THROW
;

62 
__END_DECLS


	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/environments.h

18 #iâdeà
_UNISTD_H


22 
	~<b™s/wÜdsize.h
>

42 #ià
__WORDSIZE
 == 64

56 
	#_POSIX_V7_LPBIG_OFFBIG
 -1

	)

57 
	#_POSIX_V6_LPBIG_OFFBIG
 -1

	)

58 
	#_XBS5_LPBIG_OFFBIG
 -1

	)

61 
	#_POSIX_V7_LP64_OFF64
 1

	)

62 
	#_POSIX_V6_LP64_OFF64
 1

	)

63 
	#_XBS5_LP64_OFF64
 1

	)

69 
	#_POSIX_V7_ILP32_OFFBIG
 1

	)

70 
	#_POSIX_V6_ILP32_OFFBIG
 1

	)

71 
	#_XBS5_ILP32_OFFBIG
 1

	)

73 #iâdeà
__x86_64__


75 
	#_POSIX_V7_ILP32_OFF32
 1

	)

76 
	#_POSIX_V6_ILP32_OFF32
 1

	)

77 
	#_XBS5_ILP32_OFF32
 1

	)

95 
	#__ILP32_OFF32_CFLAGS
 "-m32"

	)

96 
	#__ILP32_OFF32_LDFLAGS
 "-m32"

	)

97 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


98 
	#__ILP32_OFFBIG_CFLAGS
 "-mx32"

	)

99 
	#__ILP32_OFFBIG_LDFLAGS
 "-mx32"

	)

101 
	#__ILP32_OFFBIG_CFLAGS
 "-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

	)

102 
	#__ILP32_OFFBIG_LDFLAGS
 "-m32"

	)

104 
	#__LP64_OFF64_CFLAGS
 "-m64"

	)

105 
	#__LP64_OFF64_LDFLAGS
 "-m64"

	)

	@/usr/include/bits/epoll.h

18 #iâdef 
_SYS_EPOLL_H


25 
	mEPOLL_CLOEXEC
 = 02000000

26 
	#EPOLL_CLOEXEC
 
EPOLL_CLOEXEC


	)

29 
	#__EPOLL_PACKED
 
	`__©Œibu‹__
 ((
__·cked__
))

	)

	@/usr/include/bits/errno.h

19 #ifdeà
_ERRNO_H


21 #undeà
EDOM


22 #undeà
EILSEQ


23 #undeà
ERANGE


24 
	~<lšux/”ºo.h
>

27 
	#ENOTSUP
 
EOPNOTSUPP


	)

30 #iâdeà
ECANCELED


31 
	#ECANCELED
 125

	)

35 #iâdeà
EOWNERDEAD


36 
	#EOWNERDEAD
 130

	)

37 
	#ENOTRECOVERABLE
 131

	)

40 #iâdeà
ERFKILL


41 
	#ERFKILL
 132

	)

44 #iâdeà
EHWPOISON


45 
	#EHWPOISON
 133

	)

48 #iâdeà
__ASSEMBLER__


50 *
	$__”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

52 #ià!
defšed
 
_LIBC
 || defšed 
_LIBC_REENTRANT


54 
	#”ºo
 (*
	`__”ºo_loÿtiÚ
 ())

	)

59 #ià!
defšed
 
_ERRNO_H
 && defšed 
__Ãed_Em©h


63 
	#EDOM
 33

	)

64 
	#EILSEQ
 84

	)

65 
	#ERANGE
 34

	)

	@/usr/include/bits/fcntl.h

19 #iâdeà
_FCNTL_H


23 #ifdeà
__x86_64__


24 
	#__O_LARGEFILE
 0

	)

27 #ifdeà
__x86_64__


29 
	#F_GETLK64
 5

	)

30 
	#F_SETLK64
 6

	)

31 
	#F_SETLKW64
 7

	)

35 
	sæock


37 
	ml_ty³
;

38 
	ml_wh’û
;

39 #iâdeà
__USE_FILE_OFFSET64


40 
__off_t
 
	ml_¡¬t
;

41 
__off_t
 
	ml_Ën
;

43 
__off64_t
 
	ml_¡¬t
;

44 
__off64_t
 
	ml_Ën
;

46 
__pid_t
 
	ml_pid
;

49 #ifdeà
__USE_LARGEFILE64


50 
	sæock64


52 
	ml_ty³
;

53 
	ml_wh’û
;

54 
__off64_t
 
	ml_¡¬t
;

55 
__off64_t
 
	ml_Ën
;

56 
__pid_t
 
	ml_pid
;

61 
	~<b™s/fú-lšux.h
>

	@/usr/include/bits/fcntl2.h

19 #iâdef 
_FCNTL_H


25 #iâdeà
__USE_FILE_OFFSET64


26 
	$__İ’_2
 (cÚ¡ *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

27 
	`__REDIRECT
 (
__İ’_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
, ...),

28 
İ’
è
	`__nÚnuÎ
 ((1));

30 
	`__REDIRECT
 (
__İ’_2
, (cÚ¡ *
__·th
, 
__oæag
),

31 
__İ’64_2
è
	`__nÚnuÎ
 ((1));

32 
	`__REDIRECT
 (
__İ’_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
, ...),

33 
İ’64
è
	`__nÚnuÎ
 ((1));

35 
	`__”rÜdeş
 (
__İ’_too_mªy_¬gs
,

37 
	`__”rÜdeş
 (
__İ’_missšg_mode
,

40 
__fÜtify_funùiÚ
 

41 
	$İ’
 (cÚ¡ *
__·th
, 
__oæag
, ...)

43 ià(
	`__va_¬g_·ck_Ën
 () > 1)

44 
	`__İ’_too_mªy_¬gs
 ();

46 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

48 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

50 
	`__İ’_missšg_mode
 ();

51  
	`__İ’_2
 (
__·th
, 
__oæag
);

53  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

56 ià(
	`__va_¬g_·ck_Ën
 () < 1)

57  
	`__İ’_2
 (
__·th
, 
__oæag
);

59  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

60 
	}
}

63 #ifdeà
__USE_LARGEFILE64


64 
	$__İ’64_2
 (cÚ¡ *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

65 
	`__REDIRECT
 (
__İ’64_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
,

66 ...), 
İ’64
è
	`__nÚnuÎ
 ((1));

67 
	`__”rÜdeş
 (
__İ’64_too_mªy_¬gs
,

69 
	`__”rÜdeş
 (
__İ’64_missšg_mode
,

72 
__fÜtify_funùiÚ
 

73 
	$İ’64
 (cÚ¡ *
__·th
, 
__oæag
, ...)

75 ià(
	`__va_¬g_·ck_Ën
 () > 1)

76 
	`__İ’64_too_mªy_¬gs
 ();

78 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

80 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

82 
	`__İ’64_missšg_mode
 ();

83  
	`__İ’64_2
 (
__·th
, 
__oæag
);

85  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

88 ià(
	`__va_¬g_·ck_Ën
 () < 1)

89  
	`__İ’64_2
 (
__·th
, 
__oæag
);

91  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

92 
	}
}

96 #ifdeà
__USE_ATFILE


97 #iâdeà
__USE_FILE_OFFSET64


98 
	$__İ’©_2
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
)

99 
	`__nÚnuÎ
 ((2));

100 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

101 
__oæag
, ...), 
İ’©
)

102 
	`__nÚnuÎ
 ((2));

104 
	`__REDIRECT
 (
__İ’©_2
, (
__fd
, cÚ¡ *
__·th
,

105 
__oæag
), 
__İ’©64_2
)

106 
	`__nÚnuÎ
 ((2));

107 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

108 
__oæag
, ...), 
İ’©64
)

109 
	`__nÚnuÎ
 ((2));

111 
	`__”rÜdeş
 (
__İ’©_too_mªy_¬gs
,

113 
	`__”rÜdeş
 (
__İ’©_missšg_mode
,

116 
__fÜtify_funùiÚ
 

117 
	$İ’©
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
, ...)

119 ià(
	`__va_¬g_·ck_Ën
 () > 1)

120 
	`__İ’©_too_mªy_¬gs
 ();

122 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

124 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

126 
	`__İ’©_missšg_mode
 ();

127  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

129  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

132 ià(
	`__va_¬g_·ck_Ën
 () < 1)

133  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

135  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

136 
	}
}

139 #ifdeà
__USE_LARGEFILE64


140 
	$__İ’©64_2
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
)

141 
	`__nÚnuÎ
 ((2));

142 
	`__REDIRECT
 (
__İ’©64_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

143 
__oæag
, ...), 
İ’©64
)

144 
	`__nÚnuÎ
 ((2));

145 
	`__”rÜdeş
 (
__İ’©64_too_mªy_¬gs
,

147 
	`__”rÜdeş
 (
__İ’©64_missšg_mode
,

150 
__fÜtify_funùiÚ
 

151 
	$İ’©64
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
, ...)

153 ià(
	`__va_¬g_·ck_Ën
 () > 1)

154 
	`__İ’©64_too_mªy_¬gs
 ();

156 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

158 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

160 
	`__İ’©64_missšg_mode
 ();

161  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

163  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

166 ià(
	`__va_¬g_·ck_Ën
 () < 1)

167  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

169  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

170 
	}
}

	@/usr/include/bits/huge_val.h

20 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

27 
	#HUGE_VAL
 (
	`__butš_huge_v®
())

	)

28 #–ià
__GNUC_PREREQ
(2,96)

29 
	#HUGE_VAL
 (
__ex‹nsiÚ__
 0x1.0
p2047
)

	)

30 #–ià
defšed
 
__GNUC__


32 
	#HUGE_VAL
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
((
	`__mode__
(
__DI__
))); 
__d
; }) \

35 { 
__l
: 0x7ff0000000000000ULL }).
__d
)

	)

39 
	~<’dŸn.h
>

41 uniÚ { 
	m__c
[8]; 
	m__d
; } 
	t__huge_v®_t
;

43 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


44 
	#__HUGE_VAL_by‹s
 { 0x7f, 0xf0, 0, 0, 0, 0, 0, 0 }

	)

46 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


47 
	#__HUGE_VAL_by‹s
 { 0, 0, 0, 0, 0, 0, 0xf0, 0x7à}

	)

50 
__huge_v®_t
 
	g__huge_v®
 = { 
__HUGE_VAL_by‹s
 };

51 
	#HUGE_VAL
 (
__huge_v®
.
__d
)

	)

	@/usr/include/bits/huge_valf.h

20 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

27 
	#HUGE_VALF
 (
	`__butš_huge_v®f
())

	)

28 #–ià
__GNUC_PREREQ
(2,96)

29 
	#HUGE_VALF
 (
__ex‹nsiÚ__
 0x1.0
p255f
)

	)

30 #–ià
defšed
 
__GNUC__


32 
	#HUGE_VALF
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
((
	`__mode__
(
__SI__
))); 
__d
; }) \

35 { 
__l
: 0x7f800000UL }).
__d
)

	)

39 uniÚ { 
	m__c
[4]; 
	m__f
; } 
	t__huge_v®f_t
;

41 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


42 
	#__HUGE_VALF_by‹s
 { 0x7f, 0x80, 0, 0 }

	)

44 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


45 
	#__HUGE_VALF_by‹s
 { 0, 0, 0x80, 0x7à}

	)

48 
__huge_v®f_t
 
	g__huge_v®f
 = { 
__HUGE_VALF_by‹s
 };

49 
	#HUGE_VALF
 (
__huge_v®f
.
__f
)

	)

	@/usr/include/bits/huge_vall.h

20 #iâdeà
_MATH_H


24 #ià
__GNUC_PREREQ
(3,3)

25 
	#HUGE_VALL
 (
	`__butš_huge_v®l
())

	)

26 #–ià
__GNUC_PREREQ
(2,96)

27 
	#HUGE_VALL
 (
__ex‹nsiÚ__
 0x1.0
p32767L
)

	)

30 
	#__HUGE_VALL_by‹s
 { 0, 0, 0, 0, 0, 0, 0, 0x80, 0xff, 0x7f, 0, 0 }

	)

32 
	#__huge_v®l_t
 uniÚ { 
__c
[12]; 
__ld
; }

	)

33 #ifdeà
__GNUC__


34 
	#HUGE_VALL
 (
__ex‹nsiÚ__
 \

35 ((
__huge_v®l_t
è{ 
__c
: 
__HUGE_VALL_by‹s
 }).
__ld
)

	)

37 
__huge_v®l_t
 
	g__huge_v®l
 = { 
__HUGE_VALL_by‹s
 };

38 
	#HUGE_VALL
 (
__huge_v®l
.
__ld
)

	)

	@/usr/include/bits/in.h

20 #iâdeà
_NETINET_IN_H


29 #ià
defšed
 
_UAPI_LINUX_IN6_H
 || defšed 
_UAPI_IPV6_H


33 
	#__USE_KERNEL_IPV6_DEFS


	)

39 
	#IP_OPTIONS
 4

	)

40 
	#IP_HDRINCL
 3

	)

41 
	#IP_TOS
 1

	)

42 
	#IP_TTL
 2

	)

43 
	#IP_RECVOPTS
 6

	)

45 
	#IP_RECVRETOPTS
 
IP_RETOPTS


	)

46 
	#IP_RETOPTS
 7

	)

47 
	#IP_MULTICAST_IF
 32

	)

48 
	#IP_MULTICAST_TTL
 33

	)

49 
	#IP_MULTICAST_LOOP
 34

	)

50 
	#IP_ADD_MEMBERSHIP
 35

	)

51 
	#IP_DROP_MEMBERSHIP
 36

	)

52 
	#IP_UNBLOCK_SOURCE
 37

	)

53 
	#IP_BLOCK_SOURCE
 38

	)

54 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

55 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

56 
	#IP_MSFILTER
 41

	)

57 #ifdeà
__USE_MISC


58 
	#MCAST_JOIN_GROUP
 42

	)

59 
	#MCAST_BLOCK_SOURCE
 43

	)

60 
	#MCAST_UNBLOCK_SOURCE
 44

	)

61 
	#MCAST_LEAVE_GROUP
 45

	)

62 
	#MCAST_JOIN_SOURCE_GROUP
 46

	)

63 
	#MCAST_LEAVE_SOURCE_GROUP
 47

	)

64 
	#MCAST_MSFILTER
 48

	)

65 
	#IP_MULTICAST_ALL
 49

	)

66 
	#IP_UNICAST_IF
 50

	)

68 
	#MCAST_EXCLUDE
 0

	)

69 
	#MCAST_INCLUDE
 1

	)

72 
	#IP_ROUTER_ALERT
 5

	)

73 
	#IP_PKTINFO
 8

	)

74 
	#IP_PKTOPTIONS
 9

	)

75 
	#IP_PMTUDISC
 10

	)

76 
	#IP_MTU_DISCOVER
 10

	)

77 
	#IP_RECVERR
 11

	)

78 
	#IP_RECVTTL
 12

	)

79 
	#IP_RECVTOS
 13

	)

80 
	#IP_MTU
 14

	)

81 
	#IP_FREEBIND
 15

	)

82 
	#IP_IPSEC_POLICY
 16

	)

83 
	#IP_XFRM_POLICY
 17

	)

84 
	#IP_PASSSEC
 18

	)

85 
	#IP_TRANSPARENT
 19

	)

86 
	#IP_MULTICAST_ALL
 49

	)

89 
	#IP_ORIGDSTADDR
 20

	)

90 
	#IP_RECVORIGDSTADDR
 
IP_ORIGDSTADDR


	)

92 
	#IP_MINTTL
 21

	)

93 
	#IP_NODEFRAG
 22

	)

94 
	#IP_CHECKSUM
 23

	)

95 
	#IP_BIND_ADDRESS_NO_PORT
 24

	)

98 
	#IP_PMTUDISC_DONT
 0

	)

99 
	#IP_PMTUDISC_WANT
 1

	)

100 
	#IP_PMTUDISC_DO
 2

	)

101 
	#IP_PMTUDISC_PROBE
 3

	)

105 
	#IP_PMTUDISC_INTERFACE
 4

	)

107 
	#IP_PMTUDISC_OMIT
 5

	)

109 
	#IP_MULTICAST_IF
 32

	)

110 
	#IP_MULTICAST_TTL
 33

	)

111 
	#IP_MULTICAST_LOOP
 34

	)

112 
	#IP_ADD_MEMBERSHIP
 35

	)

113 
	#IP_DROP_MEMBERSHIP
 36

	)

114 
	#IP_UNBLOCK_SOURCE
 37

	)

115 
	#IP_BLOCK_SOURCE
 38

	)

116 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

117 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

118 
	#IP_MSFILTER
 41

	)

119 
	#IP_MULTICAST_ALL
 49

	)

120 
	#IP_UNICAST_IF
 50

	)

123 
	#SOL_IP
 0

	)

125 
	#IP_DEFAULT_MULTICAST_TTL
 1

	)

126 
	#IP_DEFAULT_MULTICAST_LOOP
 1

	)

127 
	#IP_MAX_MEMBERSHIPS
 20

	)

129 #ifdeà
__USE_MISC


133 
	s_İts


135 
š_addr
 
	m_d¡
;

136 
	m_İts
[40];

140 
	s_m»qn


142 
š_addr
 
	mimr_muÉŸddr
;

143 
š_addr
 
	mimr_add»ss
;

144 
	mimr_ifšdex
;

148 
	sš_pktšfo


150 
	mi_ifšdex
;

151 
š_addr
 
	mi_¥ec_d¡
;

152 
š_addr
 
	mi_addr
;

159 
	#IPV6_ADDRFORM
 1

	)

160 
	#IPV6_2292PKTINFO
 2

	)

161 
	#IPV6_2292HOPOPTS
 3

	)

162 
	#IPV6_2292DSTOPTS
 4

	)

163 
	#IPV6_2292RTHDR
 5

	)

164 
	#IPV6_2292PKTOPTIONS
 6

	)

165 
	#IPV6_CHECKSUM
 7

	)

166 
	#IPV6_2292HOPLIMIT
 8

	)

168 
	#SCM_SRCRT
 
IPV6_RXSRCRT


	)

170 
	#IPV6_NEXTHOP
 9

	)

171 
	#IPV6_AUTHHDR
 10

	)

172 
	#IPV6_UNICAST_HOPS
 16

	)

173 
	#IPV6_MULTICAST_IF
 17

	)

174 
	#IPV6_MULTICAST_HOPS
 18

	)

175 
	#IPV6_MULTICAST_LOOP
 19

	)

176 
	#IPV6_JOIN_GROUP
 20

	)

177 
	#IPV6_LEAVE_GROUP
 21

	)

178 
	#IPV6_ROUTER_ALERT
 22

	)

179 
	#IPV6_MTU_DISCOVER
 23

	)

180 
	#IPV6_MTU
 24

	)

181 
	#IPV6_RECVERR
 25

	)

182 
	#IPV6_V6ONLY
 26

	)

183 
	#IPV6_JOIN_ANYCAST
 27

	)

184 
	#IPV6_LEAVE_ANYCAST
 28

	)

185 
	#IPV6_IPSEC_POLICY
 34

	)

186 
	#IPV6_XFRM_POLICY
 35

	)

189 
	#IPV6_RECVPKTINFO
 49

	)

190 
	#IPV6_PKTINFO
 50

	)

191 
	#IPV6_RECVHOPLIMIT
 51

	)

192 
	#IPV6_HOPLIMIT
 52

	)

193 
	#IPV6_RECVHOPOPTS
 53

	)

194 
	#IPV6_HOPOPTS
 54

	)

195 
	#IPV6_RTHDRDSTOPTS
 55

	)

196 
	#IPV6_RECVRTHDR
 56

	)

197 
	#IPV6_RTHDR
 57

	)

198 
	#IPV6_RECVDSTOPTS
 58

	)

199 
	#IPV6_DSTOPTS
 59

	)

200 
	#IPV6_RECVPATHMTU
 60

	)

201 
	#IPV6_PATHMTU
 61

	)

202 
	#IPV6_DONTFRAG
 62

	)

205 
	#IPV6_RECVTCLASS
 66

	)

206 
	#IPV6_TCLASS
 67

	)

209 
	#IPV6_ADD_MEMBERSHIP
 
IPV6_JOIN_GROUP


	)

210 
	#IPV6_DROP_MEMBERSHIP
 
IPV6_LEAVE_GROUP


	)

211 
	#IPV6_RXHOPOPTS
 
IPV6_HOPOPTS


	)

212 
	#IPV6_RXDSTOPTS
 
IPV6_DSTOPTS


	)

215 
	#IPV6_PMTUDISC_DONT
 0

	)

216 
	#IPV6_PMTUDISC_WANT
 1

	)

217 
	#IPV6_PMTUDISC_DO
 2

	)

218 
	#IPV6_PMTUDISC_PROBE
 3

	)

219 
	#IPV6_PMTUDISC_INTERFACE
 4

	)

220 
	#IPV6_PMTUDISC_OMIT
 5

	)

223 
	#SOL_IPV6
 41

	)

224 
	#SOL_ICMPV6
 58

	)

227 
	#IPV6_RTHDR_LOOSE
 0

	)

228 
	#IPV6_RTHDR_STRICT
 1

	)

230 
	#IPV6_RTHDR_TYPE_0
 0

	)

	@/usr/include/bits/inf.h

19 #iâdeà
_MATH_H


25 #ià
__GNUC_PREREQ
(3,3)

26 
	#INFINITY
 (
	`__butš_šff
())

	)

28 
	#INFINITY
 
HUGE_VALF


	)

	@/usr/include/bits/ioctl-types.h

19 #iâdeà
_SYS_IOCTL_H


24 
	~<asm/ioùls.h
>

27 
	swšsize


29 
	mws_row
;

30 
	mws_cŞ
;

31 
	mws_xpix–
;

32 
	mws_ypix–
;

35 
	#NCC
 8

	)

36 
	s‹rmio


38 
	mc_iæag
;

39 
	mc_oæag
;

40 
	mc_cæag
;

41 
	mc_læag
;

42 
	mc_lše
;

43 
	mc_cc
[
NCC
];

47 
	#TIOCM_LE
 0x001

	)

48 
	#TIOCM_DTR
 0x002

	)

49 
	#TIOCM_RTS
 0x004

	)

50 
	#TIOCM_ST
 0x008

	)

51 
	#TIOCM_SR
 0x010

	)

52 
	#TIOCM_CTS
 0x020

	)

53 
	#TIOCM_CAR
 0x040

	)

54 
	#TIOCM_RNG
 0x080

	)

55 
	#TIOCM_DSR
 0x100

	)

56 
	#TIOCM_CD
 
TIOCM_CAR


	)

57 
	#TIOCM_RI
 
TIOCM_RNG


	)

62 
	#N_TTY
 0

	)

63 
	#N_SLIP
 1

	)

64 
	#N_MOUSE
 2

	)

65 
	#N_PPP
 3

	)

66 
	#N_STRIP
 4

	)

67 
	#N_AX25
 5

	)

68 
	#N_X25
 6

	)

69 
	#N_6PACK
 7

	)

70 
	#N_MASC
 8

	)

71 
	#N_R3964
 9

	)

72 
	#N_PROFIBUS_FDL
 10

	)

73 
	#N_IRDA
 11

	)

74 
	#N_SMSBLOCK
 12

	)

75 
	#N_HDLC
 13

	)

76 
	#N_SYNC_PPP
 14

	)

77 
	#N_HCI
 15

	)

	@/usr/include/bits/ioctls.h

18 #iâdeà
_SYS_IOCTL_H


23 
	~<asm/ioùls.h
>

26 
	#SIOCADDRT
 0x890B

	)

27 
	#SIOCDELRT
 0x890C

	)

28 
	#SIOCRTMSG
 0x890D

	)

31 
	#SIOCGIFNAME
 0x8910

	)

32 
	#SIOCSIFLINK
 0x8911

	)

33 
	#SIOCGIFCONF
 0x8912

	)

34 
	#SIOCGIFFLAGS
 0x8913

	)

35 
	#SIOCSIFFLAGS
 0x8914

	)

36 
	#SIOCGIFADDR
 0x8915

	)

37 
	#SIOCSIFADDR
 0x8916

	)

38 
	#SIOCGIFDSTADDR
 0x8917

	)

39 
	#SIOCSIFDSTADDR
 0x8918

	)

40 
	#SIOCGIFBRDADDR
 0x8919

	)

41 
	#SIOCSIFBRDADDR
 0x891¨

	)

42 
	#SIOCGIFNETMASK
 0x891b

	)

43 
	#SIOCSIFNETMASK
 0x891ø

	)

44 
	#SIOCGIFMETRIC
 0x891d

	)

45 
	#SIOCSIFMETRIC
 0x891

	)

46 
	#SIOCGIFMEM
 0x891à

	)

47 
	#SIOCSIFMEM
 0x8920

	)

48 
	#SIOCGIFMTU
 0x8921

	)

49 
	#SIOCSIFMTU
 0x8922

	)

50 
	#SIOCSIFNAME
 0x8923

	)

51 
	#SIOCSIFHWADDR
 0x8924

	)

52 
	#SIOCGIFENCAP
 0x8925

	)

53 
	#SIOCSIFENCAP
 0x8926

	)

54 
	#SIOCGIFHWADDR
 0x8927

	)

55 
	#SIOCGIFSLAVE
 0x8929

	)

56 
	#SIOCSIFSLAVE
 0x8930

	)

57 
	#SIOCADDMULTI
 0x8931

	)

58 
	#SIOCDELMULTI
 0x8932

	)

59 
	#SIOCGIFINDEX
 0x8933

	)

60 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

61 
	#SIOCSIFPFLAGS
 0x8934

	)

62 
	#SIOCGIFPFLAGS
 0x8935

	)

63 
	#SIOCDIFADDR
 0x8936

	)

64 
	#SIOCSIFHWBROADCAST
 0x8937

	)

65 
	#SIOCGIFCOUNT
 0x8938

	)

67 
	#SIOCGIFBR
 0x8940

	)

68 
	#SIOCSIFBR
 0x8941

	)

70 
	#SIOCGIFTXQLEN
 0x8942

	)

71 
	#SIOCSIFTXQLEN
 0x8943

	)

76 
	#SIOCDARP
 0x8953

	)

77 
	#SIOCGARP
 0x8954

	)

78 
	#SIOCSARP
 0x8955

	)

81 
	#SIOCDRARP
 0x8960

	)

82 
	#SIOCGRARP
 0x8961

	)

83 
	#SIOCSRARP
 0x8962

	)

87 
	#SIOCGIFMAP
 0x8970

	)

88 
	#SIOCSIFMAP
 0x8971

	)

92 
	#SIOCADDDLCI
 0x8980

	)

93 
	#SIOCDELDLCI
 0x8981

	)

102 
	#SIOCDEVPRIVATE
 0x89F0

	)

108 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/bits/locale.h

19 #ià!
defšed
 
_LOCALE_H
 && !defšed 
_LANGINFO_H


23 #iâdeà
_BITS_LOCALE_H


24 
	#_BITS_LOCALE_H
 1

	)

26 
	#__LC_CTYPE
 0

	)

27 
	#__LC_NUMERIC
 1

	)

28 
	#__LC_TIME
 2

	)

29 
	#__LC_COLLATE
 3

	)

30 
	#__LC_MONETARY
 4

	)

31 
	#__LC_MESSAGES
 5

	)

32 
	#__LC_ALL
 6

	)

33 
	#__LC_PAPER
 7

	)

34 
	#__LC_NAME
 8

	)

35 
	#__LC_ADDRESS
 9

	)

36 
	#__LC_TELEPHONE
 10

	)

37 
	#__LC_MEASUREMENT
 11

	)

38 
	#__LC_IDENTIFICATION
 12

	)

	@/usr/include/bits/math-finite.h

19 #iâdeà
_MATH_H


24 
__REDIRECT_NTH
 (
acos
, (), 
__acos_fš™e
);

25 #ifdeà
__USE_ISOC99


26 
__REDIRECT_NTH
 (
acosf
, (), 
__acosf_fš™e
);

27 #ifdeà
__MATH_DECLARE_LDOUBLE


28 #ifdeà
__NO_LONG_DOUBLE_MATH


29 
__REDIRECT_NTH
 (
aco¦
, (), 
__acos_fš™e
);

31 
__REDIRECT_NTH
 (
aco¦
, (), 
__aco¦_fš™e
);

36 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


38 
__REDIRECT_NTH
 (
acosh
, (), 
__acosh_fš™e
);

40 #ifdeà
__USE_ISOC99


41 
__REDIRECT_NTH
 (
acoshf
, (), 
__acoshf_fš™e
);

42 #ifdeà
__MATH_DECLARE_LDOUBLE


43 #ifdeà
__NO_LONG_DOUBLE_MATH


44 
__REDIRECT_NTH
 (
acoshl
, (), 
__acosh_fš™e
);

46 
__REDIRECT_NTH
 (
acoshl
, (), 
__acoshl_fš™e
);

52 
__REDIRECT_NTH
 (
asš
, (), 
__asš_fš™e
);

53 #ifdeà
__USE_ISOC99


54 
__REDIRECT_NTH
 (
asšf
, (), 
__asšf_fš™e
);

55 #ifdeà
__MATH_DECLARE_LDOUBLE


56 #ifdeà
__NO_LONG_DOUBLE_MATH


57 
__REDIRECT_NTH
 (
asšl
, (), 
__asš_fš™e
);

59 
__REDIRECT_NTH
 (
asšl
, (), 
__asšl_fš™e
);

65 
__REDIRECT_NTH
 (
©ª2
, (, ), 
__©ª2_fš™e
);

66 #ifdeà
__USE_ISOC99


67 
__REDIRECT_NTH
 (
©ª2f
, (, ), 
__©ª2f_fš™e
);

68 #ifdeà
__MATH_DECLARE_LDOUBLE


69 #ifdeà
__NO_LONG_DOUBLE_MATH


70 
__REDIRECT_NTH
 (
©ª2l
, (, ),

71 
__©ª2_fš™e
);

73 
__REDIRECT_NTH
 (
©ª2l
, (, ),

74 
__©ª2l_fš™e
);

79 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


81 
__REDIRECT_NTH
 (
©ªh
, (), 
__©ªh_fš™e
);

83 #ifdeà
__USE_ISOC99


84 
__REDIRECT_NTH
 (
©ªhf
, (), 
__©ªhf_fš™e
);

85 #ifdeà
__MATH_DECLARE_LDOUBLE


86 #ifdeà
__NO_LONG_DOUBLE_MATH


87 
__REDIRECT_NTH
 (
©ªhl
, (), 
__©ªh_fš™e
);

89 
__REDIRECT_NTH
 (
©ªhl
, (), 
__©ªhl_fš™e
);

95 
__REDIRECT_NTH
 (
cosh
, (), 
__cosh_fš™e
);

96 #ifdeà
__USE_ISOC99


97 
__REDIRECT_NTH
 (
coshf
, (), 
__coshf_fš™e
);

98 #ifdeà
__MATH_DECLARE_LDOUBLE


99 #ifdeà
__NO_LONG_DOUBLE_MATH


100 
__REDIRECT_NTH
 (
coshl
, (), 
__cosh_fš™e
);

102 
__REDIRECT_NTH
 (
coshl
, (), 
__coshl_fš™e
);

108 
__REDIRECT_NTH
 (
exp
, (), 
__exp_fš™e
);

109 #ifdeà
__USE_ISOC99


110 
__REDIRECT_NTH
 (
expf
, (), 
__expf_fš™e
);

111 #ifdeà
__MATH_DECLARE_LDOUBLE


112 #ifdeà
__NO_LONG_DOUBLE_MATH


113 
__REDIRECT_NTH
 (
ex¶
, (), 
__exp_fš™e
);

115 
__REDIRECT_NTH
 (
ex¶
, (), 
__ex¶_fš™e
);

120 #ifdeà
__USE_GNU


122 
__REDIRECT_NTH
 (
exp10
, (), 
__exp10_fš™e
);

123 
__REDIRECT_NTH
 (
exp10f
, (), 
__exp10f_fš™e
);

124 #ifdeà
__MATH_DECLARE_LDOUBLE


125 #ifdeà
__NO_LONG_DOUBLE_MATH


126 
__REDIRECT_NTH
 (
exp10l
, (), 
__exp10_fš™e
);

128 
__REDIRECT_NTH
 (
exp10l
, (), 
__exp10l_fš™e
);

133 
__REDIRECT_NTH
 (
pow10
, (), 
__exp10_fš™e
);

134 
__REDIRECT_NTH
 (
pow10f
, (), 
__exp10f_fš™e
);

135 #ifdeà
__MATH_DECLARE_LDOUBLE


136 #ifdeà
__NO_LONG_DOUBLE_MATH


137 
__REDIRECT_NTH
 (
pow10l
, (), 
__exp10_fš™e
);

139 
__REDIRECT_NTH
 (
pow10l
, (), 
__exp10l_fš™e
);

144 #ifdeà
__USE_ISOC99


146 
__REDIRECT_NTH
 (
exp2
, (), 
__exp2_fš™e
);

147 
__REDIRECT_NTH
 (
exp2f
, (), 
__exp2f_fš™e
);

148 #ifdeà
__MATH_DECLARE_LDOUBLE


149 #ifdeà
__NO_LONG_DOUBLE_MATH


150 
__REDIRECT_NTH
 (
exp2l
, (), 
__exp2_fš™e
);

152 
__REDIRECT_NTH
 (
exp2l
, (), 
__exp2l_fš™e
);

158 
__REDIRECT_NTH
 (
fmod
, (, ), 
__fmod_fš™e
);

159 #ifdeà
__USE_ISOC99


160 
__REDIRECT_NTH
 (
fmodf
, (, ), 
__fmodf_fš™e
);

161 #ifdeà
__MATH_DECLARE_LDOUBLE


162 #ifdeà
__NO_LONG_DOUBLE_MATH


163 
__REDIRECT_NTH
 (
fmodl
, (, ),

164 
__fmod_fš™e
);

166 
__REDIRECT_NTH
 (
fmodl
, (, ),

167 
__fmodl_fš™e
);

172 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


174 
__REDIRECT_NTH
 (
hypÙ
, (, ), 
__hypÙ_fš™e
);

176 #ifdeà
__USE_ISOC99


177 
__REDIRECT_NTH
 (
hypÙf
, (, ), 
__hypÙf_fš™e
);

178 #ifdeà
__MATH_DECLARE_LDOUBLE


179 #ifdeà
__NO_LONG_DOUBLE_MATH


180 
__REDIRECT_NTH
 (
hypÙl
, (, ),

181 
__hypÙ_fš™e
);

183 
__REDIRECT_NTH
 (
hypÙl
, (, ),

184 
__hypÙl_fš™e
);

189 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


191 
__REDIRECT_NTH
 (
j0
, (), 
__j0_fš™e
);

193 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


194 
__REDIRECT_NTH
 (
j0f
, (), 
__j0f_fš™e
);

195 #ifdeà
__MATH_DECLARE_LDOUBLE


196 #ifdeà
__NO_LONG_DOUBLE_MATH


197 
__REDIRECT_NTH
 (
j0l
, (), 
__j0_fš™e
);

199 
__REDIRECT_NTH
 (
j0l
, (), 
__j0l_fš™e
);

204 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


206 
__REDIRECT_NTH
 (
y0
, (), 
__y0_fš™e
);

208 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


209 
__REDIRECT_NTH
 (
y0f
, (), 
__y0f_fš™e
);

210 #ifdeà
__MATH_DECLARE_LDOUBLE


211 #ifdeà
__NO_LONG_DOUBLE_MATH


212 
__REDIRECT_NTH
 (
y0l
, (), 
__y0_fš™e
);

214 
__REDIRECT_NTH
 (
y0l
, (), 
__y0l_fš™e
);

219 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


221 
__REDIRECT_NTH
 (
j1
, (), 
__j1_fš™e
);

223 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


224 
__REDIRECT_NTH
 (
j1f
, (), 
__j1f_fš™e
);

225 #ifdeà
__MATH_DECLARE_LDOUBLE


226 #ifdeà
__NO_LONG_DOUBLE_MATH


227 
__REDIRECT_NTH
 (
j1l
, (), 
__j1_fš™e
);

229 
__REDIRECT_NTH
 (
j1l
, (), 
__j1l_fš™e
);

234 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


236 
__REDIRECT_NTH
 (
y1
, (), 
__y1_fš™e
);

238 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


239 
__REDIRECT_NTH
 (
y1f
, (), 
__y1f_fš™e
);

240 #ifdeà
__MATH_DECLARE_LDOUBLE


241 #ifdeà
__NO_LONG_DOUBLE_MATH


242 
__REDIRECT_NTH
 (
y1l
, (), 
__y1_fš™e
);

244 
__REDIRECT_NTH
 (
y1l
, (), 
__y1l_fš™e
);

249 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


251 
__REDIRECT_NTH
 (
jn
, (, ), 
__jn_fš™e
);

253 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


254 
__REDIRECT_NTH
 (
jnf
, (, ), 
__jnf_fš™e
);

255 #ifdeà
__MATH_DECLARE_LDOUBLE


256 #ifdeà
__NO_LONG_DOUBLE_MATH


257 
__REDIRECT_NTH
 (
jÆ
, (, ), 
__jn_fš™e
);

259 
__REDIRECT_NTH
 (
jÆ
, (, ), 
__jÆ_fš™e
);

264 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


266 
__REDIRECT_NTH
 (
yn
, (, ), 
__yn_fš™e
);

268 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


269 
__REDIRECT_NTH
 (
ynf
, (, ), 
__ynf_fš™e
);

270 #ifdeà
__MATH_DECLARE_LDOUBLE


271 #ifdeà
__NO_LONG_DOUBLE_MATH


272 
__REDIRECT_NTH
 (
yÆ
, (, ), 
__yn_fš™e
);

274 
__REDIRECT_NTH
 (
yÆ
, (, ), 
__yÆ_fš™e
);

279 #ifdeà
__USE_MISC


281 
__REDIRECT_NTH
 (
lgamma_r
, (, *), 
__lgamma_r_fš™e
);

282 #ifdeà
__USE_ISOC99


283 
__REDIRECT_NTH
 (
lgammaf_r
, (, *), 
__lgammaf_r_fš™e
);

284 #ifdeà
__MATH_DECLARE_LDOUBLE


285 #ifdeà
__NO_LONG_DOUBLE_MATH


286 
__REDIRECT_NTH
 (
lgamm®_r
, (, *),

287 
__lgamma_r_fš™e
);

289 
__REDIRECT_NTH
 (
lgamm®_r
, (, *),

290 
__lgamm®_r_fš™e
);

296 
__lgamma_r_fš™e
 (, *);

297 
__lgammaf_r_fš™e
 (, *);

298 #ifdeà
__NO_LONG_DOUBLE_MATH


299 
__REDIRECT_NTH
 (
__lgamm®_r_fš™e
, (, *),

300 
__lgamma_r_fš™e
);

302 
__lgamm®_r_fš™e
 (, *);

305 #ià((
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99
) \

306 && 
defšed
 
	g__ex‹º_®ways_šlše
)

308 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgamma
 (
__d
))

310 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


311  
	`__lgamma_r_fš™e
 (
__d
, &
signgam
);

313 
__loÿl_signgam
 = 0;

314  
	`__lgamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

316 
	}
}

318 #ià
defšed
 
__USE_ISOC99
 && defšed 
__ex‹º_®ways_šlše


319 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgammaf
 (
__d
))

321 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


322  
	`__lgammaf_r_fš™e
 (
__d
, &
signgam
);

324 
__loÿl_signgam
 = 0;

325  
	`__lgammaf_r_fš™e
 (
__d
, &
__loÿl_signgam
);

327 
	}
}

328 #ifdeà
__MATH_DECLARE_LDOUBLE


329 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgamm®
 (
__d
))

331 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


332  
	`__lgamm®_r_fš™e
 (
__d
, &
signgam
);

334 
__loÿl_signgam
 = 0;

335  
	`__lgamm®_r_fš™e
 (
__d
, &
__loÿl_signgam
);

337 
	}
}

341 #ià((
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)) \

342 && 
defšed
 
	g__ex‹º_®ways_šlše
)

344 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gamma
 (
__d
))

346  
	`__lgamma_r_fš™e
 (
__d
, &
signgam
);

347 
	}
}

348 #ifdeà
__USE_ISOC99


349 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gammaf
 (
__d
))

351  
	`__lgammaf_r_fš™e
 (
__d
, &
signgam
);

352 
	}
}

353 #ifdeà
__MATH_DECLARE_LDOUBLE


354 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gamm®
 (
__d
))

356  
	`__lgamm®_r_fš™e
 (
__d
, &
signgam
);

357 
	}
}

363 
__REDIRECT_NTH
 (
log
, (), 
__log_fš™e
);

364 #ifdeà
__USE_ISOC99


365 
__REDIRECT_NTH
 (
logf
, (), 
__logf_fš™e
);

366 #ifdeà
__MATH_DECLARE_LDOUBLE


367 #ifdeà
__NO_LONG_DOUBLE_MATH


368 
__REDIRECT_NTH
 (
logl
, (), 
__log_fš™e
);

370 
__REDIRECT_NTH
 (
logl
, (), 
__logl_fš™e
);

376 
__REDIRECT_NTH
 (
log10
, (), 
__log10_fš™e
);

377 #ifdeà
__USE_ISOC99


378 
__REDIRECT_NTH
 (
log10f
, (), 
__log10f_fš™e
);

379 #ifdeà
__MATH_DECLARE_LDOUBLE


380 #ifdeà
__NO_LONG_DOUBLE_MATH


381 
__REDIRECT_NTH
 (
log10l
, (), 
__log10_fš™e
);

383 
__REDIRECT_NTH
 (
log10l
, (), 
__log10l_fš™e
);

388 #ifdeà
__USE_ISOC99


390 
__REDIRECT_NTH
 (
log2
, (), 
__log2_fš™e
);

391 
__REDIRECT_NTH
 (
log2f
, (), 
__log2f_fš™e
);

392 #ifdeà
__MATH_DECLARE_LDOUBLE


393 #ifdeà
__NO_LONG_DOUBLE_MATH


394 
__REDIRECT_NTH
 (
log2l
, (), 
__log2_fš™e
);

396 
__REDIRECT_NTH
 (
log2l
, (), 
__log2l_fš™e
);

402 
__REDIRECT_NTH
 (
pow
, (, ), 
__pow_fš™e
);

403 #ifdeà
__USE_ISOC99


404 
__REDIRECT_NTH
 (
powf
, (, ), 
__powf_fš™e
);

405 #ifdeà
__MATH_DECLARE_LDOUBLE


406 #ifdeà
__NO_LONG_DOUBLE_MATH


407 
__REDIRECT_NTH
 (
powl
, (, ),

408 
__pow_fš™e
);

410 
__REDIRECT_NTH
 (
powl
, (, ),

411 
__powl_fš™e
);

416 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


418 
__REDIRECT_NTH
 (
»mašd”
, (, ), 
__»mašd”_fš™e
);

420 #ifdeà
__USE_ISOC99


421 
__REDIRECT_NTH
 (
»mašd”f
, (, ), 
__»mašd”f_fš™e
);

422 #ifdeà
__MATH_DECLARE_LDOUBLE


423 #ifdeà
__NO_LONG_DOUBLE_MATH


424 
__REDIRECT_NTH
 (
»mašd”l
, (, ),

425 
__»mašd”_fš™e
);

427 
__REDIRECT_NTH
 (
»mašd”l
, (, ),

428 
__»mašd”l_fš™e
);

433 #ià(
defšed
 
__USE_MISC
 \

434 || (
defšed
 
	g__USE_XOPEN_EXTENDED
 && !defšed 
	g__USE_XOPEN2K8
))

436 
__REDIRECT_NTH
 (
sÿlb
, (, ), 
__sÿlb_fš™e
);

438 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


439 
__REDIRECT_NTH
 (
sÿlbf
, (, ), 
__sÿlbf_fš™e
);

440 #ifdeà
__MATH_DECLARE_LDOUBLE


441 #ifdeà
__NO_LONG_DOUBLE_MATH


442 
__REDIRECT_NTH
 (
sÿlbl
, (, ),

443 
__sÿlb_fš™e
);

445 
__REDIRECT_NTH
 (
sÿlbl
, (, ),

446 
__sÿlbl_fš™e
);

452 
__REDIRECT_NTH
 (
sšh
, (), 
__sšh_fš™e
);

453 #ifdeà
__USE_ISOC99


454 
__REDIRECT_NTH
 (
sšhf
, (), 
__sšhf_fš™e
);

455 #ifdeà
__MATH_DECLARE_LDOUBLE


456 #ifdeà
__NO_LONG_DOUBLE_MATH


457 
__REDIRECT_NTH
 (
sšhl
, (), 
__sšh_fš™e
);

459 
__REDIRECT_NTH
 (
sšhl
, (), 
__sšhl_fš™e
);

465 
__REDIRECT_NTH
 (
sq¹
, (), 
__sq¹_fš™e
);

466 #ifdeà
__USE_ISOC99


467 
__REDIRECT_NTH
 (
sq¹f
, (), 
__sq¹f_fš™e
);

468 #ifdeà
__MATH_DECLARE_LDOUBLE


469 #ifdeà
__NO_LONG_DOUBLE_MATH


470 
__REDIRECT_NTH
 (
sq¹l
, (), 
__sq¹_fš™e
);

472 
__REDIRECT_NTH
 (
sq¹l
, (), 
__sq¹l_fš™e
);

477 #ià
defšed
 
__USE_ISOC99
 && defšed 
__ex‹º_®ways_šlše


479 
__gamma_r_fš™e
 (, *);

480 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgamma
 (
__d
))

482 
__loÿl_signgam
 = 0;

483 
__»s
 = 
	`__gamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

484  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

485 
	}
}

486 
__gammaf_r_fš™e
 (, *);

487 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgammaf
 (
__d
))

489 
__loÿl_signgam
 = 0;

490 
__»s
 = 
	`__gammaf_r_fš™e
 (
__d
, &
__loÿl_signgam
);

491  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

492 
	}
}

493 #ifdeà
__MATH_DECLARE_LDOUBLE


494 
__gamm®_r_fš™e
 (, *);

495 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgamm®
 (
__d
))

497 
__loÿl_signgam
 = 0;

498 #ifdeà
__NO_LONG_DOUBLE_MATH


499 
__»s
 = 
	`__gamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

501 
__»s
 = 
	`__gamm®_r_fš™e
 (
__d
, &
__loÿl_signgam
);

503  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

504 
	}
}

	@/usr/include/bits/math-vector.h

19 #iâdeà
_MATH_H


25 
	~<b™s/libm-simd-deş-¡ubs.h
>

27 #ià
defšed
 
__x86_64__
 && defšed 
__FAST_MATH__


28 #ià
defšed
 
_OPENMP
 && _OPENMP >= 201307

30 
	#__DECL_SIMD_x86_64
 
	`_P¿gma
 ("om°deş¬simd‚Ùšb¿nch")

	)

31 #–ià
__GNUC_PREREQ
 (6,0)

33 
	#__DECL_SIMD_x86_64
 
	`__©Œibu‹__
 ((
	`__simd__
 ("nÙšb¿nch")))

	)

36 #ifdeà
__DECL_SIMD_x86_64


37 #undeà
__DECL_SIMD_cos


38 
	#__DECL_SIMD_cos
 
__DECL_SIMD_x86_64


	)

39 #undeà
__DECL_SIMD_cosf


40 
	#__DECL_SIMD_cosf
 
__DECL_SIMD_x86_64


	)

41 #undeà
__DECL_SIMD_sš


42 
	#__DECL_SIMD_sš
 
__DECL_SIMD_x86_64


	)

43 #undeà
__DECL_SIMD_sšf


44 
	#__DECL_SIMD_sšf
 
__DECL_SIMD_x86_64


	)

45 #undeà
__DECL_SIMD_sšcos


46 
	#__DECL_SIMD_sšcos
 
__DECL_SIMD_x86_64


	)

47 #undeà
__DECL_SIMD_sšcosf


48 
	#__DECL_SIMD_sšcosf
 
__DECL_SIMD_x86_64


	)

49 #undeà
__DECL_SIMD_log


50 
	#__DECL_SIMD_log
 
__DECL_SIMD_x86_64


	)

51 #undeà
__DECL_SIMD_logf


52 
	#__DECL_SIMD_logf
 
__DECL_SIMD_x86_64


	)

53 #undeà
__DECL_SIMD_exp


54 
	#__DECL_SIMD_exp
 
__DECL_SIMD_x86_64


	)

55 #undeà
__DECL_SIMD_expf


56 
	#__DECL_SIMD_expf
 
__DECL_SIMD_x86_64


	)

57 #undeà
__DECL_SIMD_pow


58 
	#__DECL_SIMD_pow
 
__DECL_SIMD_x86_64


	)

59 #undeà
__DECL_SIMD_powf


60 
	#__DECL_SIMD_powf
 
__DECL_SIMD_x86_64


	)

	@/usr/include/bits/mathcalls.h

45 #iâdeà
_MATH_H


52 
_MdoubË_BEGIN_NAMESPACE


54 
__MATHCALL
 (
acos
,, (
_MdoubË_
 
__x
));

56 
__MATHCALL
 (
asš
,, (
_MdoubË_
 
__x
));

58 
__MATHCALL
 (
©ª
,, (
_MdoubË_
 
__x
));

60 
__MATHCALL
 (
©ª2
,, (
_MdoubË_
 
__y
, _MdoubË_ 
__x
));

63 
__MATHCALL_VEC
 (
cos
,, (
_MdoubË_
 
__x
));

65 
__MATHCALL_VEC
 (
sš
,, (
_MdoubË_
 
__x
));

67 
__MATHCALL
 (
n
,, (
_MdoubË_
 
__x
));

72 
__MATHCALL
 (
cosh
,, (
_MdoubË_
 
__x
));

74 
__MATHCALL
 (
sšh
,, (
_MdoubË_
 
__x
));

76 
__MATHCALL
 (
nh
,, (
_MdoubË_
 
__x
));

77 
	g_MdoubË_END_NAMESPACE


79 #ifdeà
__USE_GNU


81 
__MATHDECL_VEC
 (,
sšcos
,,

82 (
_MdoubË_
 
__x
, _MdoubË_ *
__sšx
, _MdoubË_ *
__cosx
));

85 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


86 
__BEGIN_NAMESPACE_C99


88 
__MATHCALL
 (
acosh
,, (
_MdoubË_
 
__x
));

90 
__MATHCALL
 (
asšh
,, (
_MdoubË_
 
__x
));

92 
__MATHCALL
 (
©ªh
,, (
_MdoubË_
 
__x
));

93 
	g__END_NAMESPACE_C99


98 
_MdoubË_BEGIN_NAMESPACE


100 
__MATHCALL_VEC
 (
exp
,, (
_MdoubË_
 
__x
));

103 
__MATHCALL
 (
äexp
,, (
_MdoubË_
 
__x
, *
__expÚ’t
));

106 
__MATHCALL
 (
ldexp
,, (
_MdoubË_
 
__x
, 
__expÚ’t
));

109 
__MATHCALL_VEC
 (
log
,, (
_MdoubË_
 
__x
));

112 
__MATHCALL
 (
log10
,, (
_MdoubË_
 
__x
));

115 
__MATHCALL
 (
modf
,, (
_MdoubË_
 
__x
, _MdoubË_ *
__Œ
)è
__nÚnuÎ
 ((2));

116 
	g_MdoubË_END_NAMESPACE


118 #ifdeà
__USE_GNU


120 
__MATHCALL
 (
exp10
,, (
_MdoubË_
 
__x
));

122 
__MATHCALL
 (
pow10
,, (
_MdoubË_
 
__x
));

125 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
__MATHCALL
 (
expm1
,, (
_MdoubË_
 
__x
));

131 
__MATHCALL
 (
log1p
,, (
_MdoubË_
 
__x
));

134 
__MATHCALL
 (
logb
,, (
_MdoubË_
 
__x
));

135 
	g__END_NAMESPACE_C99


138 #ifdeà
__USE_ISOC99


139 
__BEGIN_NAMESPACE_C99


141 
__MATHCALL
 (
exp2
,, (
_MdoubË_
 
__x
));

144 
__MATHCALL
 (
log2
,, (
_MdoubË_
 
__x
));

145 
	g__END_NAMESPACE_C99


151 
_MdoubË_BEGIN_NAMESPACE


153 
__MATHCALL_VEC
 (
pow
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

156 
__MATHCALL
 (
sq¹
,, (
_MdoubË_
 
__x
));

157 
	g_MdoubË_END_NAMESPACE


159 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


160 
__BEGIN_NAMESPACE_C99


162 
__MATHCALL
 (
hypÙ
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

163 
	g__END_NAMESPACE_C99


166 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


167 
__BEGIN_NAMESPACE_C99


169 
__MATHCALL
 (
cb¹
,, (
_MdoubË_
 
__x
));

170 
	g__END_NAMESPACE_C99


176 
_MdoubË_BEGIN_NAMESPACE


178 
__MATHCALLX
 (
û
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

181 
__MATHCALLX
 (
çbs
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

184 
__MATHCALLX
 (
æoÜ
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

187 
__MATHCALL
 (
fmod
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

192 
__MATHDECL_1
 (,
__isšf
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

195 
__MATHDECL_1
 (,
__fš™e
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

196 
	g_MdoubË_END_NAMESPACE


198 #ifdeà
__USE_MISC


199 #ià(!
defšed
 
__ılu¥lus
 \

200 || 
	g__ılu¥lus
 < 201103L \

201 || 
	g__MATH_DECLARING_DOUBLE
 == 0)

204 
__MATHDECL_1
 (,
isšf
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

208 
__MATHDECL_1
 (,
fš™e
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

211 
__MATHCALL
 (
d»m
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

215 
__MATHCALL
 (
signifiÿnd
,, (
_MdoubË_
 
__x
));

218 #ifdeà
__USE_ISOC99


219 
__BEGIN_NAMESPACE_C99


221 
__MATHCALLX
 (
cİysign
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

222 
	g__END_NAMESPACE_C99


225 #ifdeà
__USE_ISOC99


226 
__BEGIN_NAMESPACE_C99


228 
__MATHCALLX
 (
Çn
,, (cÚ¡ *
__gb
), (
__cÚ¡__
));

229 
	g__END_NAMESPACE_C99


234 
__MATHDECL_1
 (,
__i¢ª
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

236 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

237 #ià(!
defšed
 
__ılu¥lus
 \

238 || 
	g__ılu¥lus
 < 201103L \

239 || 
	g__MATH_DECLARING_DOUBLE
 == 0)

241 
__MATHDECL_1
 (,
i¢ª
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

245 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && 
__MATH_DECLARING_DOUBLE
)

247 
__MATHCALL
 (
j0
,, (
_MdoubË_
));

248 
__MATHCALL
 (
j1
,, (
_MdoubË_
));

249 
__MATHCALL
 (
jn
,, (, 
_MdoubË_
));

250 
__MATHCALL
 (
y0
,, (
_MdoubË_
));

251 
__MATHCALL
 (
y1
,, (
_MdoubË_
));

252 
__MATHCALL
 (
yn
,, (, 
_MdoubË_
));

256 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


257 
__BEGIN_NAMESPACE_C99


259 
__MATHCALL
 (
”f
,, (
_MdoubË_
));

260 
__MATHCALL
 (
”fc
,, (
_MdoubË_
));

261 
__MATHCALL
 (
lgamma
,, (
_MdoubË_
));

262 
	g__END_NAMESPACE_C99


265 #ifdeà
__USE_ISOC99


266 
__BEGIN_NAMESPACE_C99


268 
__MATHCALL
 (
tgamma
,, (
_MdoubË_
));

269 
	g__END_NAMESPACE_C99


272 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

274 
__MATHCALL
 (
gamma
,, (
_MdoubË_
));

277 #ifdeà
__USE_MISC


281 
__MATHCALL
 (
lgamma
,
_r
, (
_MdoubË_
, *
__signgamp
));

285 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


286 
__BEGIN_NAMESPACE_C99


289 
__MATHCALL
 (
ršt
,, (
_MdoubË_
 
__x
));

292 
__MATHCALLX
 (
Ãxá”
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

293 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__LDBL_COMPAT


294 
__MATHCALLX
 (
Ãx‰ow¬d
,, (
_MdoubË_
 
__x
, 
__y
), (
__cÚ¡__
));

298 
__MATHCALL
 (
»mašd”
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

300 #ifdeà
__USE_ISOC99


302 
__MATHCALL
 (
sÿlbn
,, (
_MdoubË_
 
__x
, 
__n
));

306 
__MATHDECL
 (,
ogb
,, (
_MdoubË_
 
__x
));

309 #ifdeà
__USE_ISOC99


311 
__MATHCALL
 (
sÿlbÊ
,, (
_MdoubË_
 
__x
, 
__n
));

315 
__MATHCALL
 (
Ã¬byšt
,, (
_MdoubË_
 
__x
));

319 
__MATHCALLX
 (
round
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

323 
__MATHCALLX
 (
Œunc
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

328 
__MATHCALL
 (
»mquo
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
, *
__quo
));

335 
__MATHDECL
 (,
Ìšt
,, (
_MdoubË_
 
__x
));

336 
__ex‹nsiÚ__


337 
__MATHDECL
 (,
Îršt
,, (
_MdoubË_
 
__x
));

341 
__MATHDECL
 (,
Ìound
,, (
_MdoubË_
 
__x
));

342 
__ex‹nsiÚ__


343 
__MATHDECL
 (,
Îround
,, (
_MdoubË_
 
__x
));

347 
__MATHCALL
 (
fdim
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

350 
__MATHCALLX
 (
fmax
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

353 
__MATHCALLX
 (
fmš
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

357 
__MATHDECL_1
 (, 
__åşassify
,, (
_MdoubË_
 
__v®ue
))

358 
__©Œibu‹__
 ((
__cÚ¡__
));

361 
__MATHDECL_1
 (, 
__signb™
,, (
_MdoubË_
 
__v®ue
))

362 
__©Œibu‹__
 ((
__cÚ¡__
));

366 
__MATHCALL
 (
fma
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
, _MdoubË_ 
__z
));

369 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


370 
	g__END_NAMESPACE_C99


373 #ifdeà
__USE_GNU


375 
__MATHDECL_1
 (, 
__issigÇlšg
,, (
_MdoubË_
 
__v®ue
))

376 
__©Œibu‹__
 ((
__cÚ¡__
));

379 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

380 && 
	g__MATH_DECLARING_DOUBLE
 \

381 && !
defšed
 
	g__USE_XOPEN2K8
)

383 
__MATHCALL
 (
sÿlb
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__n
));

	@/usr/include/bits/mathdef.h

18 #ià!
defšed
 
_MATH_H
 && !defšed 
_COMPLEX_H


22 #ià
defšed
 
__USE_ISOC99
 && defšed 
_MATH_H
 && !defšed 
_MATH_H_MATHDEF


23 
	#_MATH_H_MATHDEF
 1

	)

25 #ià
defšed
 
__x86_64__
 || (defšed 
__FLT_EVAL_METHOD__
 && __FLT_EVAL_METHOD__ == 0)

28 
	tæßt_t
;

29 
	tdoubË_t
;

35 
	tæßt_t
;

37 
	tdoubË_t
;

42 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

43 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

47 #ifdeà
__FP_FAST_FMA


48 
	#FP_FAST_FMA
 1

	)

51 #ifdeà
__FP_FAST_FMAF


52 
	#FP_FAST_FMAF
 1

	)

55 #ifdeà
__FP_FAST_FMAL


56 
	#FP_FAST_FMAL
 1

	)

	@/usr/include/bits/mathinline.h

19 #iâdeà
_MATH_H


23 #iâdeà
__ex‹º_®ways_šlše


24 
	#__MATH_INLINE
 
__šlše


	)

26 
	#__MATH_INLINE
 
__ex‹º_®ways_šlše


	)

30 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__
 && __GNUC__ >= 2

32 #ià!
__GNUC_PREREQ
 (2,97)

37 #undeà
isg»©”


38 #undeà
isg»©”equ®


39 #undeà
i¦ess


40 #undeà
i¦es£qu®


41 #undeà
i¦essg»©”


42 #undeà
isunÜd”ed


43 #ifdeà
__i686__


46 
	#isg»©”
(
x
, 
y
) \

47 ({ 
__»suÉ
; \

48 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

49 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

50 
__»suÉ
; })

	)

51 
	#isg»©”equ®
(
x
, 
y
) \

52 ({ 
__»suÉ
; \

53 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

54 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

55 
__»suÉ
; })

	)

57 
	#i¦ess
(
x
, 
y
) \

58 ({ 
__»suÉ
; \

59 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

60 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st"); \

61 
__»suÉ
; })

	)

63 
	#i¦es£qu®
(
x
, 
y
) \

64 ({ 
__»suÉ
; \

65 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

66 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st"); \

67 
__»suÉ
; })

	)

69 
	#i¦essg»©”
(
x
, 
y
) \

70 ({ 
__»suÉ
; \

71 
	`__asm__
 ("fucomip %%st(1), %%st; setne %%al" \

72 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

73 
__»suÉ
; })

	)

75 
	#isunÜd”ed
(
x
, 
y
) \

76 ({ 
__»suÉ
; \

77 
	`__asm__
 ("fucomip %%st(1), %%st; setp %%al" \

78 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

79 
__»suÉ
; })

	)

82 
	#isg»©”
(
x
, 
y
) \

83 ({ 
__»suÉ
; \

84 
	`__asm__
 ("fucompp; fnstsw;estb $0x45, %%ah; setz %%al" \

85 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

86 
__»suÉ
; })

	)

88 
	#isg»©”equ®
(
x
, 
y
) \

89 ({ 
__»suÉ
; \

90 
	`__asm__
 ("fucompp; fnstsw;estb $0x05, %%ah; setz %%al" \

91 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

92 
__»suÉ
; })

	)

94 
	#i¦ess
(
x
, 
y
) \

95 ({ 
__»suÉ
; \

96 
	`__asm__
 ("fucompp; fnstsw;estb $0x45, %%ah; setz %%al" \

97 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

98 
__»suÉ
; })

	)

100 
	#i¦es£qu®
(
x
, 
y
) \

101 ({ 
__»suÉ
; \

102 
	`__asm__
 ("fucompp; fnstsw;estb $0x05, %%ah; setz %%al" \

103 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

104 
__»suÉ
; })

	)

106 
	#i¦essg»©”
(
x
, 
y
) \

107 ({ 
__»suÉ
; \

108 
	`__asm__
 ("fucompp; fnstsw;estb $0x44, %%ah; setz %%al" \

109 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

110 
__»suÉ
; })

	)

112 
	#isunÜd”ed
(
x
, 
y
) \

113 ({ 
__»suÉ
; \

114 
	`__asm__
 ("fucompp; fnstsw; sahf; setp %%al" \

115 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

116 
__»suÉ
; })

	)

122 #ià
__GNUC_PREREQ
 (2, 8)

123 
__BEGIN_NAMESPACE_C99


126 
__MATH_INLINE
 

127 
__NTH
 (
	$__signb™f
 (
__x
))

129 #ifdeà
__SSE2_MATH__


130 
__m
;

131 
	`__asm
 ("pmovmskb %1, %0" : "ô" (
__m
è: "x" (
__x
));

132  (
__m
 & 0x8) != 0;

134 
__ex‹nsiÚ__
 uniÚ { 
__f
; 
__i
; } 
__u
 = { __f: 
__x
 };

135  
__u
.
__i
 < 0;

137 
	}
}

138 
__MATH_INLINE
 

139 
__NTH
 (
	$__signb™
 (
__x
))

141 #ifdeà
__SSE2_MATH__


142 
__m
;

143 
	`__asm
 ("pmovmskb %1, %0" : "ô" (
__m
è: "x" (
__x
));

144  (
__m
 & 0x80) != 0;

146 
__ex‹nsiÚ__
 uniÚ { 
__d
; 
__i
[2]; } 
__u
 = { __d: 
__x
 };

147  
__u
.
__i
[1] < 0;

149 
	}
}

150 
__MATH_INLINE
 

151 
__NTH
 (
	$__signb™l
 (
__x
))

153 
__ex‹nsiÚ__
 uniÚ { 
__l
; 
__i
[3]; } 
__u
 = { __l: 
__x
 };

154  (
__u
.
__i
[2] & 0x8000) != 0;

155 
	}
}

157 
	g__END_NAMESPACE_C99


164 #ià
__GNUC_PREREQ
 (2, 8)

165 #ià!
__GNUC_PREREQ
 (3, 4è&& !
defšed
 
__NO_MATH_INLINES
 \

166 && 
defšed
 
	g__OPTIMIZE__


170 #ifdeà
__USE_ISOC99


171 
	g__BEGIN_NAMESPACE_C99


174 #ifdeà
__SSE_MATH__


175 
__MATH_INLINE
 

176 
__NTH
 (
	$Ìštf
 (
__x
))

178 
__»s
;

183 
__asm
 
	`__vŞ©e__
 ("cvtss2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

184  
__»s
;

185 
	}
}

187 #ifdeà
__SSE2_MATH__


188 
__MATH_INLINE
 

189 
__NTH
 (
	$Ìšt
 (
__x
))

191 
__»s
;

196 
__asm
 
	`__vŞ©e__
 ("cvtsd2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

197  
__»s
;

198 
	}
}

200 #ifdeà
__x86_64__


201 
__ex‹nsiÚ__


202 
__MATH_INLINE
 

203 
__NTH
 (
	$Îrštf
 (
__x
))

205 
__»s
;

210 
__asm
 
	`__vŞ©e__
 ("cvtss2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

211  
__»s
;

212 
	}
}

213 
__ex‹nsiÚ__


214 
__MATH_INLINE
 

215 
__NTH
 (
	$Îršt
 (
__x
))

217 
__»s
;

222 
__asm
 
	`__vŞ©e__
 ("cvtsd2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

223  
__»s
;

224 
	}
}

227 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0 \

228 && 
defšed
 
__SSE2_MATH__


230 
__MATH_INLINE
 

231 
__NTH
 (
	$fmaxf
 (
__x
, 
__y
))

233 #ifdeà
__AVX__


234 
__»s
;

235 
	`__asm
 ("vmaxs %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

236  
__»s
;

238 
	`__asm
 ("maxs %1, %0" : "+x" (
__x
è: "xm" (
__y
));

239  
__x
;

241 
	}
}

242 
__MATH_INLINE
 

243 
__NTH
 (
	$fmax
 (
__x
, 
__y
))

245 #ifdeà
__AVX__


246 
__»s
;

247 
	`__asm
 ("vmaxsd %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

248  
__»s
;

250 
	`__asm
 ("maxsd %1, %0" : "+x" (
__x
è: "xm" (
__y
));

251  
__x
;

253 
	}
}

256 
__MATH_INLINE
 

257 
__NTH
 (
	$fmšf
 (
__x
, 
__y
))

259 #ifdeà
__AVX__


260 
__»s
;

261 
	`__asm
 ("vmšs %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

262  
__»s
;

264 
	`__asm
 ("mšs %1, %0" : "+x" (
__x
è: "xm" (
__y
));

265  
__x
;

267 
	}
}

268 
__MATH_INLINE
 

269 
__NTH
 (
	$fmš
 (
__x
, 
__y
))

271 #ifdeà
__AVX__


272 
__»s
;

273 
	`__asm
 ("vmšsd %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

274  
__»s
;

276 
	`__asm
 ("mšsd %1, %0" : "+x" (
__x
è: "xm" (
__y
));

277  
__x
;

279 
	}
}

282 
	g__END_NAMESPACE_C99


285 #ià
defšed
 
__SSE4_1__
 && defšed 
__SSE2_MATH__


286 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


287 
__BEGIN_NAMESPACE_C99


290 
__MATH_INLINE
 

291 
__NTH
 (
	$ršt
 (
__x
))

293 
__»s
;

298 
__asm
 
	`__vŞ©e__
 ("roundsd $4, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

299  
__»s
;

300 
	}
}

301 
__MATH_INLINE
 

302 
__NTH
 (
	$rštf
 (
__x
))

304 
__»s
;

309 
__asm
 
	`__vŞ©e__
 ("rounds $4, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

310  
__»s
;

311 
	}
}

313 #ifdeà
__USE_ISOC99


315 
__MATH_INLINE
 

316 
__NTH
 (
	$Ã¬byšt
 (
__x
))

318 
__»s
;

323 
__asm
 
	`__vŞ©e__
 ("roundsd $0xc, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

324  
__»s
;

325 
	}
}

326 
__MATH_INLINE
 

327 
__NTH
 (
	$Ã¬byštf
 (
__x
))

329 
__»s
;

334 
__asm
 
	`__vŞ©e__
 ("rounds $0xc, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

335  
__»s
;

336 
	}
}

339 
	g__END_NAMESPACE_C99


342 
__BEGIN_NAMESPACE_STD


344 
__MATH_INLINE
 

345 
__NTH
 (
	$û
 (
__x
))

347 
__»s
;

348 
	`__asm
 ("roundsd $2, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

349  
__»s
;

350 
	}
}

351 
__END_NAMESPACE_STD


353 
__BEGIN_NAMESPACE_C99


354 
__MATH_INLINE
 

355 
__NTH
 (
	$ûf
 (
__x
))

357 
__»s
;

358 
	`__asm
 ("rounds $2, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

359  
__»s
;

360 
	}
}

361 
__END_NAMESPACE_C99


363 
__BEGIN_NAMESPACE_STD


365 
__MATH_INLINE
 

366 
__NTH
 (
	$æoÜ
 (
__x
))

368 
__»s
;

369 
	`__asm
 ("roundsd $1, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

370  
__»s
;

371 
	}
}

372 
__END_NAMESPACE_STD


374 
__BEGIN_NAMESPACE_C99


375 
__MATH_INLINE
 

376 
__NTH
 (
	$æoÜf
 (
__x
))

378 
__»s
;

379 
	`__asm
 ("rounds $1, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

380  
__»s
;

381 
	}
}

382 
	g__END_NAMESPACE_C99


390 #ià!
defšed
 
__SSE2_MATH__
 && !defšed 
__x86_64__


391 #ià((!
defšed
 
__NO_MATH_INLINES
 || defšed 
__LIBC_INTERNAL_MATH_INLINES
) \

392 && 
defšed
 
	g__OPTIMIZE__
)

396 #undeà
m©h_”rhªdlšg


405 #ifdeà
__USE_ISOC99


406 
	#__šlše_m©hİ
(
func
, 
İ
) \

407 
	`__šlše_m©hİ_
 (, 
func
, 
İ
) \

408 
	`__šlše_m©hİ_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
) \

409 
	`__šlše_m©hİ_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
)

	)

410 
	#__šlše_m©hİNP
(
func
, 
İ
) \

411 
	`__šlše_m©hİNP_
 (, 
func
, 
İ
) \

412 
	`__šlše_m©hİNP_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
) \

413 
	`__šlše_m©hİNP_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
)

	)

415 
	#__šlše_m©hİ
(
func
, 
İ
) \

416 
	`__šlše_m©hİ_
 (, 
func
, 
İ
)

	)

417 
	#__šlše_m©hİNP
(
func
, 
İ
) \

418 
	`__šlše_m©hİNP_
 (, 
func
, 
İ
)

	)

421 
	#__šlše_m©hİ_
(
æßt_ty³
, 
func
, 
İ
) \

422 
	`__šlše_m©hİ_deş_
 (
æßt_ty³
, 
func
, 
İ
, "0" (
__x
))

	)

423 
	#__šlše_m©hİNP_
(
æßt_ty³
, 
func
, 
İ
) \

424 
	`__šlše_m©hİ_deşNP_
 (
æßt_ty³
, 
func
, 
İ
, "0" (
__x
))

	)

427 #ifdeà
__USE_ISOC99


428 
	#__šlše_m©hİ_deş
(
func
, 
İ
, 
·¿ms
...) \

429 
	`__šlše_m©hİ_deş_
 (, 
func
, 
İ
, 
·¿ms
) \

430 
	`__šlše_m©hİ_deş_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
, 
·¿ms
) \

431 
	`__šlše_m©hİ_deş_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
, 
·¿ms
)

	)

432 
	#__šlše_m©hİ_deşNP
(
func
, 
İ
, 
·¿ms
...) \

433 
	`__šlše_m©hİ_deşNP_
 (, 
func
, 
İ
, 
·¿ms
) \

434 
	`__šlše_m©hİ_deşNP_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
, 
·¿ms
) \

435 
	`__šlše_m©hİ_deşNP_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
, 
·¿ms
)

	)

437 
	#__šlše_m©hİ_deş
(
func
, 
İ
, 
·¿ms
...) \

438 
	`__šlše_m©hİ_deş_
 (, 
func
, 
İ
, 
·¿ms
)

	)

439 
	#__šlše_m©hİ_deşNP
(
func
, 
İ
, 
·¿ms
...) \

440 
	`__šlše_m©hİ_deşNP_
 (, 
func
, 
İ
, 
·¿ms
)

	)

443 
	#__šlše_m©hİ_deş_
(
æßt_ty³
, 
func
, 
İ
, 
·¿ms
...) \

444 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³è
__THROW
; \

445 
	`__šlše_m©hİ_deşNP_
 (
æßt_ty³
, 
func
, 
İ
, 
·¿ms
)

	)

447 
	#__šlše_m©hİ_deşNP_
(
æßt_ty³
, 
func
, 
İ
, 
·¿ms
...) \

448 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
__x
)) \

450 
æßt_ty³
 
__»suÉ
; \

451 
__asm
 
	`__vŞ©e__
 (
İ
 : "ñ" (
__»suÉ
è: 
·¿ms
); \

452  
__»suÉ
; \

453 }

	)

456 #ifdeà
__USE_ISOC99


457 
	#__šlše_m©hcode
(
func
, 
¬g
, 
code
) \

458 
	`__šlše_m©hcode_
 (, 
func
, 
¬g
, 
code
) \

459 
	`__šlše_m©hcode_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g
, 
code
) \

460 
	`__šlše_m©hcode_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g
, 
code
)

	)

461 
	#__šlše_m©hcodeNP
(
func
, 
¬g
, 
code
) \

462 
	`__šlše_m©hcodeNP_
 (, 
func
, 
¬g
, 
code
) \

463 
	`__šlše_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g
, 
code
) \

464 
	`__šlše_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g
, 
code
)

	)

465 
	#__šlše_m©hcode2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

466 
	`__šlše_m©hcode2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
) \

467 
	`__šlše_m©hcode2_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
code
) \

468 
	`__šlše_m©hcode2_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
code
)

	)

469 
	#__šlše_m©hcodeNP2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

470 
	`__šlše_m©hcodeNP2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
) \

471 
	`__šlše_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
code
) \

472 
	`__šlše_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
code
)

	)

473 
	#__šlše_m©hcode3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

474 
	`__šlše_m©hcode3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

475 
	`__šlše_m©hcode3_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

476 
	`__šlše_m©hcode3_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

477 
	#__šlše_m©hcodeNP3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

478 
	`__šlše_m©hcodeNP3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

479 
	`__šlše_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

480 
	`__šlše_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

482 
	#__šlše_m©hcode
(
func
, 
¬g
, 
code
) \

483 
	`__šlše_m©hcode_
 (, 
func
, (
¬g
), 
code
)

	)

484 
	#__šlše_m©hcodeNP
(
func
, 
¬g
, 
code
) \

485 
	`__šlše_m©hcodeNP_
 (, 
func
, (
¬g
), 
code
)

	)

486 
	#__šlše_m©hcode2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

487 
	`__šlše_m©hcode2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

488 
	#__šlše_m©hcodeNP2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

489 
	`__šlše_m©hcodeNP2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

490 
	#__šlše_m©hcode3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

491 
	`__šlše_m©hcode3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

492 
	#__šlše_m©hcodeNP3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

493 
	`__šlše_m©hcodeNP3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

496 
	#__šlše_m©hcode_
(
æßt_ty³
, 
func
, 
¬g
, 
code
) \

497 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³è
__THROW
; \

498 
	`__šlše_m©hcodeNP_
(
æßt_ty³
, 
func
, 
¬g
, 
code
)

	)

500 
	#__šlše_m©hcodeNP_
(
æßt_ty³
, 
func
, 
¬g
, 
code
) \

501 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g
)) \

503 
code
; \

504 }

	)

507 
	#__šlše_m©hcode2_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
) \

508 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³, flßt_ty³è
__THROW
; \

509 
	`__šlše_m©hcodeNP2_
 (
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

511 
	#__šlše_m©hcodeNP2_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
) \

512 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g1
, flßt_ty³ 
¬g2
)) \

514 
code
; \

515 }

	)

517 
	#__šlše_m©hcode3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

518 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³, flßt_ty³, flßt_ty³è
__THROW
; \

519 
	`__šlše_m©hcodeNP3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

521 
	#__šlše_m©hcodeNP3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

522 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g1
, flßt_ty³ 
¬g2
, \

523 
æßt_ty³
 
¬g3
)) \

525 
code
; \

526 }

	)

530 #ià!
defšed
 
__NO_MATH_INLINES
 && defšed 
__OPTIMIZE__


534 #ifdeà
__FAST_MATH__


535 #ifdeà
__USE_GNU


536 
	#__sšcos_code
 \

537 
__co¤
; \

538 
__sšr
; \

539 
__swtmp
; \

540 
__asm
 
__vŞ©e__
 \

555 : "ñ" (
__co¤
), "=u" (
__sšr
), "÷" (
__swtmp
è: "0" (
__x
)); \

556 *
__sšx
 = 
__sšr
; \

557 *
__cosx
 = 
__co¤


	)

559 
__MATH_INLINE
 

560 
__NTH
 (
	$__sšcos
 (
__x
, *
__sšx
, *
__cosx
))

562 
__sšcos_code
;

563 
	}
}

565 
__MATH_INLINE
 

566 
__NTH
 (
	$__sšcosf
 (
__x
, *
__sšx
, *
__cosx
))

568 
__sšcos_code
;

569 
	}
}

571 
__MATH_INLINE
 

572 
__NTH
 (
	$__sšco¦
 (
__x
, *
__sšx
, *
__cosx
))

574 
__sšcos_code
;

575 
	}
}

582 #ià
__GNUC_PREREQ
 (3, 5)

583 
	#__expm1_code
 \

584 
__‹mp
; \

585 
__‹mp
 = 
	`__butš_expm1l
 (
__x
); \

586  
__‹mp
 ? __‹m°: 
__x


	)

588 
	#__expm1_code
 \

589 
__v®ue
; \

590 
__expÚ’t
; \

591 
__‹mp
; \

592 
__asm
 
__vŞ©e__
 \

601 : "ñ" (
__v®ue
), "=u" (
__expÚ’t
è: "0" (
__x
)); \

602 
__asm
 
__vŞ©e__
 \

604 : "ñ" (
__‹mp
è: "0" (1.0), "u" (
__expÚ’t
)); \

605 
__‹mp
 -= 1.0; \

606 
__‹mp
 +ğ
__v®ue
; \

607  
__‹mp
 ? __‹m°: 
__x


	)

609 
	$__šlše_m©hcodeNP_
 (, 
__expm1l
, 
__x
, 
__expm1_code
)

611 #ià
	`__GNUC_PREREQ
 (3, 4)

612 
	`__šlše_m©hcodeNP_
 (, 
__ex¶
, 
__x
,  
	$__butš_ex¶
 (
__x
))

614 
	#__exp_code
 \

615 
__v®ue
; \

616 
__expÚ’t
; \

617 
__asm
 
__vŞ©e__
 \

625 : "ñ" (
__v®ue
), "=u" (
__expÚ’t
è: "0" (
__x
)); \

626 
__v®ue
 += 1.0; \

627 
__asm
 
__vŞ©e__
 \

629 : "ñ" (
__v®ue
è: "0" (__v®ue), "u" (
__expÚ’t
)); \

630  
__v®ue


	)

631 
	$__šlše_m©hcodeNP
 (
exp
, 
__x
, 
__exp_code
)

632 
	$__šlše_m©hcodeNP_
 (, 
__ex¶
, 
__x
, 
__exp_code
)

636 #ià!
	`__GNUC_PREREQ
 (3, 5)

637 
	`__šlše_m©hcodeNP
 (
n
, 
__x
, \

638 
__v®ue
; \

639 
__v®ue2
 
	`__©Œibu‹__
 ((
__unu£d__
)); \

640 
__asm
 
__vŞ©e__
 \

642 : "ñ" (
__v®ue2
), "=u" (
__v®ue
è: "0" (
__x
)); \

643  
__v®ue
)

648 #ià
	`__GNUC_PREREQ
 (3, 4)

649 
	`__šlše_m©hcodeNP2_
 (, 
__©ª2l
, 
__y
, 
__x
,

650  
	$__butš_©ª2l
 (
__y
, 
__x
))

652 
	#__©ª2_code
 \

653 
__v®ue
; \

654 
__asm
 
__vŞ©e__
 \

656 : "ñ" (
__v®ue
è: "0" (
__x
), "u" (
__y
) : "st(1)"); \

657  
__v®ue


	)

658 #ifdeà
__FAST_MATH__


659 
	$__šlše_m©hcodeNP2
 (
©ª2
, 
__y
, 
__x
, 
__©ª2_code
)

661 
	$__šlše_m©hcodeNP2_
 (, 
__©ª2l
, 
__y
, 
__x
, 
__©ª2_code
)

665 #ià
defšed
 
__FAST_MATH__
 && !
	`__GNUC_PREREQ
 (3, 5)

666 
	`__šlše_m©hcodeNP2
 (
fmod
, 
__x
, 
__y
, \

667 
__v®ue
; \

668 
__asm
 
__vŞ©e__
 \

673 : "ñ" (
__v®ue
è: "0" (
__x
), "u" (
__y
) : "ax", "cc"); \

674  
__v®ue
)

678 #ifdeà
__FAST_MATH__


679 #ià!
	`__GNUC_PREREQ
 (3,3)

680 
	`__šlše_m©hİNP
 (
sq¹
, "fsqrt")

681 
	`__šlše_m©hİNP_
 (, 
__sq¹l
, "fsqrt")

682 
	#__libc_sq¹l
(
n
è
	`__sq¹l
 (n)

	)

684 
	#__libc_sq¹l
(
n
è
	`__butš_sq¹l
 (n)

	)

688 #ià
	`__GNUC_PREREQ
 (2, 8)

689 
	`__šlše_m©hcodeNP_
 (, 
çbs
, 
__x
,  
	$__butš_çbs
 (
__x
))

690 #ifdeà
__USE_ISOC99


691 
	`__šlše_m©hcodeNP_
 (, 
çbsf
, 
__x
,  
	$__butš_çbsf
 (
__x
))

692 
	`__šlše_m©hcodeNP_
 (, 
çb¦
, 
__x
,  
	$__butš_çb¦
 (
__x
))

694 
	`__šlše_m©hcodeNP_
 (, 
__çb¦
, 
__x
,  
	$__butš_çb¦
 (
__x
))

696 
	`__šlše_m©hİ
 (
çbs
, "fabs")

697 
	`__šlše_m©hİ_
 (, 
__çb¦
, "fabs")

700 #ifdeà
__FAST_MATH__


701 #ià!
	`__GNUC_PREREQ
 (3, 4)

703 
	`__šlše_m©hİNP
 (
sš
, "fsin")

705 
	`__šlše_m©hİNP
 (
cos
, "fcos")

707 
	`__šlše_m©hİ_deşNP
 (
log
, "ædÊ2; fxch; fyl2x", "0" (
__x
) : "st(1)")

710 #ià!
	`__GNUC_PREREQ
 (3, 5)

711 
	`__šlše_m©hİ_deşNP
 (
log10
, "ædlg2; fxch; fyl2x", "0" (
__x
) : "st(1)")

713 
	`__šlše_m©hcodeNP
 (
asš
, 
__x
,  
	`__©ª2l
 (__x, 
	`__libc_sq¹l
 (1.0 - __x * __x)))

714 
	`__šlše_m©hcodeNP
 (
acos
, 
__x
,  
	`__©ª2l
 (
	`__libc_sq¹l
 (1.0 - __x * __x), __x))

717 #ià!
	`__GNUC_PREREQ
 (3, 4)

718 
	`__šlše_m©hİ_deşNP
 (
©ª
, "æd1; f·n", "0" (
__x
) : "st(1)")

722 
	`__šlše_m©hcode_
 (, 
__sgn1l
, 
__x
, \

723 
__ex‹nsiÚ__
 uniÚ { 
__xld
; 
__xi
[3]; } 
__n
 = \

724 { 
__xld
: 
__x
 
	}
}; \

725 
	g__n
.
	g__xi
[2] = (
__n
.
__xi
[2] & 0x8000) | 0x3fff; \

726 
	g__n
.
	g__xi
[1] = 0x80000000; \

727 
	g__n
.
	g__xi
[0] = 0; \

728  
	g__n
.
	g__xld
)

731 #ifdeà
__FAST_MATH__


733 
__šlše_m©hcodeNP
 (
sšh
, 
__x
, \

734 
__exm1
 = 
__expm1l
 (
__çb¦
 (
__x
)); \

735  0.5 * (
__exm1
 / (__exm1 + 1.0è+ __exm1è* 
	$__sgn1l
 (
__x
))

737 
	`__šlše_m©hcodeNP
 (
cosh
, 
__x
, \

738 
__ex
 = 
	`__ex¶
 (
__x
); \

739  0.5 * (
__ex
 + 1.0 / __ex))

741 
	`__šlše_m©hcodeNP
 (
nh
, 
__x
, \

742 
__exm1
 = 
	`__expm1l
 (-
	`__çb¦
 (
__x
 + __x)); \

743  
__exm1
 / (__exm1 + 2.0è* 
	`__sgn1l
 (-
__x
))

746 
	`__šlše_m©hcodeNP
 (
æoÜ
, 
__x
, \

747 
__v®ue
; \

748 
__ignÜe
; \

749 
__cw
; \

750 
__cwtmp
; \

751 
__asm
 
	`__vŞ©e
 ("fnstcw %3\n\t" \

759 : "ñ" (
__v®ue
), "=&q" (
__ignÜe
), "=m" (
__cwtmp
), \

760 "=m" (
__cw
) \

761 : "0" (
__x
)); \

762  
__v®ue
)

764 
	`__šlše_m©hcodeNP
 (
û
, 
__x
, \

765 
__v®ue
; \

766 
__ignÜe
; \

767 
__cw
; \

768 
__cwtmp
; \

769 
__asm
 
	`__vŞ©e
 ("fnstcw %3\n\t" \

777 : "ñ" (
__v®ue
), "=&q" (
__ignÜe
), "=m" (
__cwtmp
), \

778 "=m" (
__cw
) \

779 : "0" (
__x
)); \

780  
__v®ue
)

782 #ifdeà
__FAST_MATH__


783 
	#__ldexp_code
 \

784 
__v®ue
; \

785 
__asm
 
__vŞ©e__
 \

787 : "ñ" (
__v®ue
è: "0" (
__x
), "u" ((è
__y
)); \

788  
__v®ue


	)

790 
__MATH_INLINE
 

791 
	`__NTH
 (
	$ldexp
 (
__x
, 
__y
))

793 
__ldexp_code
;

794 
	}
}

799 #ifdeà
__USE_ISOC99


801 #ifdeà
__FAST_MATH__


802 
	$__šlše_m©hcodeNP
 (
expm1
, 
__x
, 
__expm1_code
)

806 
	#__M_SQRT2
 1.41421356237309504880L

	)

808 #ià!
	`__GNUC_PREREQ
 (3, 5)

809 
	`__šlše_m©hcodeNP
 (
log1p
, 
__x
, \

810 
__v®ue
; \

811 ià(
	`__çb¦
 (
__x
è>ğ1.0 - 0.5 * 
__M_SQRT2
) \

812 
__v®ue
 = 
	`logl
 (1.0 + 
__x
); \

814 
__asm
 
__vŞ©e__
 \

818 : "ñ" (
__v®ue
è: "0" (
__x
) : "st(1)"); \

819  
__v®ue
)

824 
	`__šlše_m©hcodeNP
 (
asšh
, 
__x
, \

825 
__y
 = 
	`__çb¦
 (
__x
); \

826  (
	`log1¶
 (
__y
 * __y / (
	`__libc_sq¹l
 (__y * __y + 1.0) + 1.0) + __y) \

827 * 
	$__sgn1l
 (
__x
)))

829 
	`__šlše_m©hcodeNP
 (
acosh
, 
__x
, \

830  
	`logl
 (
__x
 + 
	`__libc_sq¹l
 (__x - 1.0) * __libc_sqrtl (__x + 1.0)))

832 
	`__šlše_m©hcodeNP
 (
©ªh
, 
__x
, \

833 
__y
 = 
	`__çb¦
 (
__x
); \

834  -0.5 * 
	`log1¶
 (-(
__y
 + __yè/ (1.0 + __y)è* 
	$__sgn1l
 (
__x
))

837 
	`__šlše_m©hcodeNP2
 (
hypÙ
, 
__x
, 
__y
,

838  
	`__libc_sq¹l
 (
__x
 * __x + 
__y
 * __y))

840 #ià!
	`__GNUC_PREREQ
 (3, 5)

841 
	`__šlše_m©hcodeNP
(
logb
, 
__x
, \

842 
__v®ue
; \

843 
__junk
; \

844 
__asm
 
__vŞ©e__
 \

846 : "ñ" (
__junk
), "=u" (
__v®ue
è: "0" (
__x
)); \

847  
__v®ue
)

853 #ifdeà
__USE_ISOC99


854 #ifdeà
__FAST_MATH__


856 #ià!
	`__GNUC_PREREQ
 (3, 5)

857 
	`__šlše_m©hİ_deşNP
 (
log2
, "æd1; fxch; fyl2x", "0" (
__x
) : "st(1)")

860 
__MATH_INLINE
 

861 
	`__NTH
 (
	$ldexpf
 (
__x
, 
__y
))

863 
__ldexp_code
;

864 
	}
}

866 
__MATH_INLINE
 

867 
__NTH
 (
	$ldex¶
 (
__x
, 
__y
))

869 
__ldexp_code
;

870 
	}
}

872 
__šlše_m©hİNP
 (
ršt
, "frndint")

875 
	#__Ìšt_code
 \

876 
__ÌšŒes
; \

877 
__asm__
 
__vŞ©e__
 \

879 : "=m" (
__ÌšŒes
è: "t" (
__x
) : "st"); \

880  
__ÌšŒes


	)

881 
__MATH_INLINE
 

882 
__NTH
 (
	$Ìštf
 (
__x
))

884 
__Ìšt_code
;

885 
	}
}

886 
__MATH_INLINE
 

887 
__NTH
 (
	$Ìšt
 (
__x
))

889 
__Ìšt_code
;

890 
	}
}

891 
__MATH_INLINE
 

892 
__NTH
 (
	$Ìš
 (
__x
))

894 
__Ìšt_code
;

895 
	}
}

896 #undeà
__Ìšt_code


898 
	#__Îršt_code
 \

899 
__ÎršŒes
; \

900 
__asm__
 
__vŞ©e__
 \

902 : "=m" (
__ÎršŒes
è: "t" (
__x
) : "st"); \

903  
__ÎršŒes


	)

904 
__ex‹nsiÚ__


905 
__MATH_INLINE
 

906 
__NTH
 (
	$Îrštf
 (
__x
))

908 
__Îršt_code
;

909 
	}
}

910 
__ex‹nsiÚ__


911 
__MATH_INLINE
 

912 
__NTH
 (
	$Îršt
 (
__x
))

914 
__Îršt_code
;

915 
	}
}

916 
__ex‹nsiÚ__


917 
__MATH_INLINE
 

918 
__NTH
 (
	$Îrš
 (
__x
))

920 
__Îršt_code
;

921 
	}
}

922 #undeà
__Îršt_code


927 #ifdeà
__USE_MISC


929 #ià
defšed
 
__FAST_MATH__
 && !
__GNUC_PREREQ
 (3, 5)

930 
__šlše_m©hcodeNP2
 (
d»m
, 
__x
, 
__y
, \

931 
__v®ue
; \

932 
__şobb”ed
; \

933 
__asm
 
__vŞ©e__
 \

938 : "ñ" (
__v®ue
), "=&a" (
__şobb”ed
è: "0" (
__x
), "u" (
__y
) : "cc"); \

939  
__v®ue
)

944 
__MATH_INLINE
 

945 
__NTH
 (
	$__fš™e
 (
__x
))

947  (
__ex‹nsiÚ__


948 (((((uniÚ { 
__d
; 
__i
[2]; }è{__d: 
__x
}).__i[1]

950 
	}
}

955 #undeà
__©ª2_code


956 #ifdeà
__FAST_MATH__


957 #undeà
__expm1_code


958 #undeà
__exp_code


959 #undeà
__sšcos_code


966 #ifdeà
__LIBC_INTERNAL_MATH_INLINES


967 
__šlše_m©hİ
 (
__›“754_sq¹
, "fsqrt")

968 
__šlše_m©hcode2_
 (, 
__›“754_©ª2l
, 
__y
, 
__x
,

969 
__v®ue
;

970 
__asm
 
__vŞ©e__
 ("fpatan\n\t"

971 : "ñ" (
__v®ue
)

972 : "0" (
__x
), "u" (
__y
) : "st(1)");

973  
__v®ue
;)

	@/usr/include/bits/nan.h

19 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

28 
	#NAN
 (
	`__butš_Çnf
 (""))

	)

30 #–ià
defšed
 
__GNUC__


32 
	#NAN
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
 ((
	`__mode__
 (
__SI__
))); 
__d
; }) \

35 { 
__l
: 0x7fc00000UL }).
__d
)

	)

39 
	~<’dŸn.h
>

41 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


42 
	#__qÇn_by‹s
 { 0x7f, 0xc0, 0, 0 }

	)

44 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


45 
	#__qÇn_by‹s
 { 0, 0, 0xc0, 0x7à}

	)

48 uniÚ { 
	m__c
[4]; 
	m__d
; } 
__qÇn_uniÚ


49 
__©Œibu‹__
 ((
__unu£d__
)èğ{ 
__qÇn_by‹s
 };

50 
	#NAN
 (
__qÇn_uniÚ
.
__d
)

	)

	@/usr/include/bits/netdb.h

18 #iâdeà
_NETDB_H


26 
	sÃ‹Á


28 *
	mn_Çme
;

29 **
	mn_®Ÿ£s
;

30 
	mn_add¹y³
;

31 
ušt32_t
 
	mn_Ãt
;

	@/usr/include/bits/param.h

19 #iâdeà
_SYS_PARAM_H


23 #iâdeà
ARG_MAX


24 
	#__undef_ARG_MAX


	)

27 
	~<lšux/lim™s.h
>

28 
	~<lšux/·¿m.h
>

31 #ifdeà
__undef_ARG_MAX


32 #undeà
ARG_MAX


33 #undeà
__undef_ARG_MAX


36 
	#MAXSYMLINKS
 20

	)

41 
	#NOFILE
 256

	)

42 
	#NCARGS
 131072

	)

	@/usr/include/bits/posix1_lim.h

24 #iâdef 
_BITS_POSIX1_LIM_H


25 
	#_BITS_POSIX1_LIM_H
 1

	)

31 
	#_POSIX_AIO_LISTIO_MAX
 2

	)

34 
	#_POSIX_AIO_MAX
 1

	)

37 
	#_POSIX_ARG_MAX
 4096

	)

40 #ifdeà
__USE_XOPEN2K


41 
	#_POSIX_CHILD_MAX
 25

	)

43 
	#_POSIX_CHILD_MAX
 6

	)

47 
	#_POSIX_DELAYTIMER_MAX
 32

	)

51 
	#_POSIX_HOST_NAME_MAX
 255

	)

54 
	#_POSIX_LINK_MAX
 8

	)

57 
	#_POSIX_LOGIN_NAME_MAX
 9

	)

60 
	#_POSIX_MAX_CANON
 255

	)

64 
	#_POSIX_MAX_INPUT
 255

	)

67 
	#_POSIX_MQ_OPEN_MAX
 8

	)

70 
	#_POSIX_MQ_PRIO_MAX
 32

	)

73 
	#_POSIX_NAME_MAX
 14

	)

76 #ifdeà
__USE_XOPEN2K


77 
	#_POSIX_NGROUPS_MAX
 8

	)

79 
	#_POSIX_NGROUPS_MAX
 0

	)

83 #ifdeà
__USE_XOPEN2K


84 
	#_POSIX_OPEN_MAX
 20

	)

86 
	#_POSIX_OPEN_MAX
 16

	)

89 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


92 
	#_POSIX_FD_SETSIZE
 
_POSIX_OPEN_MAX


	)

96 
	#_POSIX_PATH_MAX
 256

	)

99 
	#_POSIX_PIPE_BUF
 512

	)

103 
	#_POSIX_RE_DUP_MAX
 255

	)

106 
	#_POSIX_RTSIG_MAX
 8

	)

109 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

112 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

115 
	#_POSIX_SIGQUEUE_MAX
 32

	)

118 
	#_POSIX_SSIZE_MAX
 32767

	)

121 
	#_POSIX_STREAM_MAX
 8

	)

124 
	#_POSIX_SYMLINK_MAX
 255

	)

128 
	#_POSIX_SYMLOOP_MAX
 8

	)

131 
	#_POSIX_TIMER_MAX
 32

	)

134 
	#_POSIX_TTY_NAME_MAX
 9

	)

137 #ifdeà
__USE_XOPEN2K


138 
	#_POSIX_TZNAME_MAX
 6

	)

140 
	#_POSIX_TZNAME_MAX
 3

	)

143 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


145 
	#_POSIX_QLIMIT
 1

	)

149 
	#_POSIX_HIWAT
 
_POSIX_PIPE_BUF


	)

152 
	#_POSIX_UIO_MAXIOV
 16

	)

156 
	#_POSIX_CLOCKRES_MIN
 20000000

	)

160 
	~<b™s/loÿl_lim.h
>

163 #iâdef 
SSIZE_MAX


164 
	#SSIZE_MAX
 
LONG_MAX


	)

171 #iâdef 
NGROUPS_MAX


172 
	#NGROUPS_MAX
 8

	)

	@/usr/include/bits/posix2_lim.h

22 #iâdef 
_BITS_POSIX2_LIM_H


23 
	#_BITS_POSIX2_LIM_H
 1

	)

27 
	#_POSIX2_BC_BASE_MAX
 99

	)

30 
	#_POSIX2_BC_DIM_MAX
 2048

	)

33 
	#_POSIX2_BC_SCALE_MAX
 99

	)

36 
	#_POSIX2_BC_STRING_MAX
 1000

	)

40 
	#_POSIX2_COLL_WEIGHTS_MAX
 2

	)

44 
	#_POSIX2_EXPR_NEST_MAX
 32

	)

47 
	#_POSIX2_LINE_MAX
 2048

	)

51 
	#_POSIX2_RE_DUP_MAX
 255

	)

55 
	#_POSIX2_CHARCLASS_NAME_MAX
 14

	)

62 #iâdef 
BC_BASE_MAX


63 
	#BC_BASE_MAX
 
_POSIX2_BC_BASE_MAX


	)

65 #iâdef 
BC_DIM_MAX


66 
	#BC_DIM_MAX
 
_POSIX2_BC_DIM_MAX


	)

68 #iâdef 
BC_SCALE_MAX


69 
	#BC_SCALE_MAX
 
_POSIX2_BC_SCALE_MAX


	)

71 #iâdef 
BC_STRING_MAX


72 
	#BC_STRING_MAX
 
_POSIX2_BC_STRING_MAX


	)

74 #iâdef 
COLL_WEIGHTS_MAX


75 
	#COLL_WEIGHTS_MAX
 255

	)

77 #iâdef 
EXPR_NEST_MAX


78 
	#EXPR_NEST_MAX
 
_POSIX2_EXPR_NEST_MAX


	)

80 #iâdef 
LINE_MAX


81 
	#LINE_MAX
 
_POSIX2_LINE_MAX


	)

83 #iâdef 
CHARCLASS_NAME_MAX


84 
	#CHARCLASS_NAME_MAX
 2048

	)

88 
	#RE_DUP_MAX
 (0x7fff)

	)

	@/usr/include/bits/posix_opt.h

19 #iâdef 
_BITS_POSIX_OPT_H


20 
	#_BITS_POSIX_OPT_H
 1

	)

23 
	#_POSIX_JOB_CONTROL
 1

	)

26 
	#_POSIX_SAVED_IDS
 1

	)

29 
	#_POSIX_PRIORITY_SCHEDULING
 200809L

	)

32 
	#_POSIX_SYNCHRONIZED_IO
 200809L

	)

35 
	#_POSIX_FSYNC
 200809L

	)

38 
	#_POSIX_MAPPED_FILES
 200809L

	)

41 
	#_POSIX_MEMLOCK
 200809L

	)

44 
	#_POSIX_MEMLOCK_RANGE
 200809L

	)

47 
	#_POSIX_MEMORY_PROTECTION
 200809L

	)

50 
	#_POSIX_CHOWN_RESTRICTED
 0

	)

54 
	#_POSIX_VDISABLE
 '\0'

	)

57 
	#_POSIX_NO_TRUNC
 1

	)

60 
	#_XOPEN_REALTIME
 1

	)

63 
	#_XOPEN_REALTIME_THREADS
 1

	)

66 
	#_XOPEN_SHM
 1

	)

69 
	#_POSIX_THREADS
 200809L

	)

72 
	#_POSIX_REENTRANT_FUNCTIONS
 1

	)

73 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200809L

	)

76 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 200809L

	)

79 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200809L

	)

82 
	#_POSIX_THREAD_ATTR_STACKADDR
 200809L

	)

85 
	#_POSIX_THREAD_PRIO_INHERIT
 200809L

	)

89 
	#_POSIX_THREAD_PRIO_PROTECT
 200809L

	)

91 #ifdeà
__USE_XOPEN2K8


93 
	#_POSIX_THREAD_ROBUST_PRIO_INHERIT
 200809L

	)

96 
	#_POSIX_THREAD_ROBUST_PRIO_PROTECT
 -1

	)

100 
	#_POSIX_SEMAPHORES
 200809L

	)

103 
	#_POSIX_REALTIME_SIGNALS
 200809L

	)

106 
	#_POSIX_ASYNCHRONOUS_IO
 200809L

	)

107 
	#_POSIX_ASYNC_IO
 1

	)

109 
	#_LFS_ASYNCHRONOUS_IO
 1

	)

111 
	#_POSIX_PRIORITIZED_IO
 200809L

	)

114 
	#_LFS64_ASYNCHRONOUS_IO
 1

	)

117 
	#_LFS_LARGEFILE
 1

	)

118 
	#_LFS64_LARGEFILE
 1

	)

119 
	#_LFS64_STDIO
 1

	)

122 
	#_POSIX_SHARED_MEMORY_OBJECTS
 200809L

	)

125 
	#_POSIX_CPUTIME
 0

	)

128 
	#_POSIX_THREAD_CPUTIME
 0

	)

131 
	#_POSIX_REGEXP
 1

	)

134 
	#_POSIX_READER_WRITER_LOCKS
 200809L

	)

137 
	#_POSIX_SHELL
 1

	)

140 
	#_POSIX_TIMEOUTS
 200809L

	)

143 
	#_POSIX_SPIN_LOCKS
 200809L

	)

146 
	#_POSIX_SPAWN
 200809L

	)

149 
	#_POSIX_TIMERS
 200809L

	)

152 
	#_POSIX_BARRIERS
 200809L

	)

155 
	#_POSIX_MESSAGE_PASSING
 200809L

	)

158 
	#_POSIX_THREAD_PROCESS_SHARED
 200809L

	)

161 
	#_POSIX_MONOTONIC_CLOCK
 0

	)

164 
	#_POSIX_CLOCK_SELECTION
 200809L

	)

167 
	#_POSIX_ADVISORY_INFO
 200809L

	)

170 
	#_POSIX_IPV6
 200809L

	)

173 
	#_POSIX_RAW_SOCKETS
 200809L

	)

176 
	#_POSIX2_CHAR_TERM
 200809L

	)

179 
	#_POSIX_SPORADIC_SERVER
 -1

	)

180 
	#_POSIX_THREAD_SPORADIC_SERVER
 -1

	)

183 
	#_POSIX_TRACE
 -1

	)

184 
	#_POSIX_TRACE_EVENT_FILTER
 -1

	)

185 
	#_POSIX_TRACE_INHERIT
 -1

	)

186 
	#_POSIX_TRACE_LOG
 -1

	)

189 
	#_POSIX_TYPED_MEMORY_OBJECTS
 -1

	)

192 
	#_XOPEN_STREAMS
 -1

	)

	@/usr/include/bits/pthreadtypes.h

18 #iâdeà
_BITS_PTHREADTYPES_H


19 
	#_BITS_PTHREADTYPES_H
 1

	)

21 
	~<b™s/wÜdsize.h
>

23 #ifdeà
__x86_64__


24 #ià
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

26 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

27 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

29 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

30 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

31 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

32 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

33 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

35 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

37 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

38 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

39 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

40 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

41 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

42 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

43 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

46 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

47 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

48 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

49 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

50 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

51 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

52 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

53 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

54 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

60 
	t±h»ad_t
;

63 
	u±h»ad_©Œ_t


65 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

66 
	m__®ign
;

68 #iâdeà
__have_±h»ad_©Œ_t


69 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

70 
	#__have_±h»ad_©Œ_t
 1

	)

74 #ifdeà
__x86_64__


75 
	s__±h»ad_š‹º®_li¡


77 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

78 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

79 } 
	t__±h»ad_li¡_t
;

81 
	s__±h»ad_š‹º®_¦i¡


83 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

84 } 
	t__±h»ad_¦i¡_t
;

92 
	s__±h»ad_mu‹x_s


94 
	m__lock
;

95 
	m__couÁ
;

96 
	m__owÃr
;

97 #ifdeà
__x86_64__


98 
	m__nu£rs
;

102 
	m__kšd
;

103 #ifdeà
__x86_64__


104 
	m__¥šs
;

105 
	m__–isiÚ
;

106 
__±h»ad_li¡_t
 
	m__li¡
;

107 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

109 
	#__PTHREAD_SPINS
 0, 0

	)

111 
	m__nu£rs
;

112 
__ex‹nsiÚ__
 union

116 
	m__e¥šs
;

117 
	m__–isiÚ
;

118 
	#__¥šs
 
__–isiÚ_d©a
.
__e¥šs


	)

119 
	#__–isiÚ
 
__–isiÚ_d©a
.
__–isiÚ


	)

120 
	#__PTHREAD_SPINS
 { 0, 0 }

	)

121 } 
	m__–isiÚ_d©a
;

122 
__±h»ad_¦i¡_t
 
	m__li¡
;

125 } 
	m__d©a
;

126 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

127 
	m__®ign
;

128 } 
	t±h»ad_mu‹x_t
;

132 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

133 
	m__®ign
;

134 } 
	t±h»ad_mu‹x©Œ_t
;

143 
	m__lock
;

144 
	m__fu‹x
;

145 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

146 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

147 
__ex‹nsiÚ__
 
	m__wok’_£q
;

148 *
	m__mu‹x
;

149 
	m__nwa™”s
;

150 
	m__brßdÿ¡_£q
;

151 } 
	m__d©a
;

152 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

153 
__ex‹nsiÚ__
 
	m__®ign
;

154 } 
	t±h»ad_cÚd_t
;

158 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

159 
	m__®ign
;

160 } 
	t±h»ad_cÚd©Œ_t
;

164 
	t±h»ad_key_t
;

168 
	t±h»ad_Úû_t
;

171 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


176 #ifdeà
__x86_64__


179 
	m__lock
;

180 
	m__Ä_»ad”s
;

181 
	m__»ad”s_wakeup
;

182 
	m__wr™”_wakeup
;

183 
	m__Ä_»ad”s_queued
;

184 
	m__Ä_wr™”s_queued
;

185 
	m__wr™”
;

186 
	m__sh¬ed
;

187 sigÃd 
	m__rw–isiÚ
;

188 #ifdeà 
__ILP32__


189 
	m__·d1
[3];

190 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0 }

	)

192 
	m__·d1
[7];

193 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0, 0, 0, 0, 0 }

	)

195 
	m__·d2
;

198 
	m__æags
;

199 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

200 } 
	m__d©a
;

204 
	m__lock
;

205 
	m__Ä_»ad”s
;

206 
	m__»ad”s_wakeup
;

207 
	m__wr™”_wakeup
;

208 
	m__Ä_»ad”s_queued
;

209 
	m__Ä_wr™”s_queued
;

212 
	m__æags
;

213 
	m__sh¬ed
;

214 sigÃd 
	m__rw–isiÚ
;

215 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0

	)

216 
	m__·d2
;

217 
	m__wr™”
;

218 } 
	m__d©a
;

220 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

221 
	m__®ign
;

222 } 
	t±h»ad_rwlock_t
;

226 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

227 
	m__®ign
;

228 } 
	t±h»ad_rwlock©Œ_t
;

232 #ifdeà
__USE_XOPEN2K


234 vŞ©
	t±h»ad_¥šlock_t
;

241 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

242 
	m__®ign
;

243 } 
	t±h»ad_b¬r›r_t
;

247 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

248 
	m__®ign
;

249 } 
	t±h»ad_b¬r›¿‰r_t
;

253 #iâdeà
__x86_64__


255 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/resource.h

19 #iâdeà
_SYS_RESOURCE_H


23 
	~<b™s/ty³s.h
>

31 
	e__¾im™_»sourû


34 
	mRLIMIT_CPU
 = 0,

35 
	#RLIMIT_CPU
 
RLIMIT_CPU


	)

38 
	mRLIMIT_FSIZE
 = 1,

39 
	#RLIMIT_FSIZE
 
RLIMIT_FSIZE


	)

42 
	mRLIMIT_DATA
 = 2,

43 
	#RLIMIT_DATA
 
RLIMIT_DATA


	)

46 
	mRLIMIT_STACK
 = 3,

47 
	#RLIMIT_STACK
 
RLIMIT_STACK


	)

50 
	mRLIMIT_CORE
 = 4,

51 
	#RLIMIT_CORE
 
RLIMIT_CORE


	)

57 
	m__RLIMIT_RSS
 = 5,

58 
	#RLIMIT_RSS
 
__RLIMIT_RSS


	)

61 
	mRLIMIT_NOFILE
 = 7,

62 
	m__RLIMIT_OFILE
 = 
RLIMIT_NOFILE
,

63 
	#RLIMIT_NOFILE
 
RLIMIT_NOFILE


	)

64 
	#RLIMIT_OFILE
 
__RLIMIT_OFILE


	)

67 
	mRLIMIT_AS
 = 9,

68 
	#RLIMIT_AS
 
RLIMIT_AS


	)

71 
	m__RLIMIT_NPROC
 = 6,

72 
	#RLIMIT_NPROC
 
__RLIMIT_NPROC


	)

75 
	m__RLIMIT_MEMLOCK
 = 8,

76 
	#RLIMIT_MEMLOCK
 
__RLIMIT_MEMLOCK


	)

79 
	m__RLIMIT_LOCKS
 = 10,

80 
	#RLIMIT_LOCKS
 
__RLIMIT_LOCKS


	)

83 
	m__RLIMIT_SIGPENDING
 = 11,

84 
	#RLIMIT_SIGPENDING
 
__RLIMIT_SIGPENDING


	)

87 
	m__RLIMIT_MSGQUEUE
 = 12,

88 
	#RLIMIT_MSGQUEUE
 
__RLIMIT_MSGQUEUE


	)

93 
	m__RLIMIT_NICE
 = 13,

94 
	#RLIMIT_NICE
 
__RLIMIT_NICE


	)

98 
	m__RLIMIT_RTPRIO
 = 14,

99 
	#RLIMIT_RTPRIO
 
__RLIMIT_RTPRIO


	)

104 
	m__RLIMIT_RTTIME
 = 15,

105 
	#RLIMIT_RTTIME
 
__RLIMIT_RTTIME


	)

107 
	m__RLIMIT_NLIMITS
 = 16,

108 
	m__RLIM_NLIMITS
 = 
__RLIMIT_NLIMITS


109 
	#RLIMIT_NLIMITS
 
__RLIMIT_NLIMITS


	)

110 
	#RLIM_NLIMITS
 
__RLIM_NLIMITS


	)

114 #iâdeà
__USE_FILE_OFFSET64


115 
	#RLIM_INFINITY
 ((
__¾im_t
è-1)

	)

117 
	#RLIM_INFINITY
 0xffffffffffffffffuLL

	)

120 #ifdeà
__USE_LARGEFILE64


121 
	#RLIM64_INFINITY
 0xffffffffffffffffuLL

	)

125 
	#RLIM_SAVED_MAX
 
RLIM_INFINITY


	)

126 
	#RLIM_SAVED_CUR
 
RLIM_INFINITY


	)

130 #iâdeà
__USE_FILE_OFFSET64


131 
__¾im_t
 
	t¾im_t
;

133 
__¾im64_t
 
	t¾im_t
;

135 #ifdeà
__USE_LARGEFILE64


136 
__¾im64_t
 
	t¾im64_t
;

139 
	s¾im™


142 
¾im_t
 
	m¾im_cur
;

144 
¾im_t
 
	m¾im_max
;

147 #ifdeà
__USE_LARGEFILE64


148 
	s¾im™64


151 
¾im64_t
 
	m¾im_cur
;

153 
¾im64_t
 
	m¾im_max
;

158 
	e__ru§ge_who


161 
	mRUSAGE_SELF
 = 0,

162 
	#RUSAGE_SELF
 
RUSAGE_SELF


	)

165 
	mRUSAGE_CHILDREN
 = -1

166 
	#RUSAGE_CHILDREN
 
RUSAGE_CHILDREN


	)

168 #ifdeà
__USE_GNU


171 
	mRUSAGE_THREAD
 = 1

172 
	#RUSAGE_THREAD
 
RUSAGE_THREAD


	)

174 
	#RUSAGE_LWP
 
RUSAGE_THREAD


	)

178 
	#__Ãed_timev®


	)

179 
	~<b™s/time.h
>

187 
	sru§ge


190 
timev®
 
	mru_utime
;

192 
timev®
 
	mru_¡ime
;

194 
__ex‹nsiÚ__
 union

196 
	mru_maxrss
;

197 
__sysÿÎ_¦Úg_t
 
	m__ru_maxrss_wÜd
;

202 
__ex‹nsiÚ__
 union

204 
	mru_ixrss
;

205 
__sysÿÎ_¦Úg_t
 
	m__ru_ixrss_wÜd
;

208 
__ex‹nsiÚ__
 union

210 
	mru_idrss
;

211 
__sysÿÎ_¦Úg_t
 
	m__ru_idrss_wÜd
;

214 
__ex‹nsiÚ__
 union

216 
	mru_i¤ss
;

217 
__sysÿÎ_¦Úg_t
 
	m__ru_i¤ss_wÜd
;

221 
__ex‹nsiÚ__
 union

223 
	mru_mšæt
;

224 
__sysÿÎ_¦Úg_t
 
	m__ru_mšæt_wÜd
;

227 
__ex‹nsiÚ__
 union

229 
	mru_majæt
;

230 
__sysÿÎ_¦Úg_t
 
	m__ru_majæt_wÜd
;

233 
__ex‹nsiÚ__
 union

235 
	mru_nsw­
;

236 
__sysÿÎ_¦Úg_t
 
	m__ru_nsw­_wÜd
;

240 
__ex‹nsiÚ__
 union

242 
	mru_šblock
;

243 
__sysÿÎ_¦Úg_t
 
	m__ru_šblock_wÜd
;

246 
__ex‹nsiÚ__
 union

248 
	mru_oublock
;

249 
__sysÿÎ_¦Úg_t
 
	m__ru_oublock_wÜd
;

252 
__ex‹nsiÚ__
 union

254 
	mru_msg¢d
;

255 
__sysÿÎ_¦Úg_t
 
	m__ru_msg¢d_wÜd
;

258 
__ex‹nsiÚ__
 union

260 
	mru_msgrcv
;

261 
__sysÿÎ_¦Úg_t
 
	m__ru_msgrcv_wÜd
;

264 
__ex‹nsiÚ__
 union

266 
	mru_nsigÇls
;

267 
__sysÿÎ_¦Úg_t
 
	m__ru_nsigÇls_wÜd
;

272 
__ex‹nsiÚ__
 union

274 
	mru_nvcsw
;

275 
__sysÿÎ_¦Úg_t
 
	m__ru_nvcsw_wÜd
;

279 
__ex‹nsiÚ__
 union

281 
	mru_nivcsw
;

282 
__sysÿÎ_¦Úg_t
 
	m__ru_nivcsw_wÜd
;

287 
	#PRIO_MIN
 -20

	)

288 
	#PRIO_MAX
 20

	)

292 
	e__´iÜ™y_which


294 
	mPRIO_PROCESS
 = 0,

295 
	#PRIO_PROCESS
 
PRIO_PROCESS


	)

296 
	mPRIO_PGRP
 = 1,

297 
	#PRIO_PGRP
 
PRIO_PGRP


	)

298 
	mPRIO_USER
 = 2

299 
	#PRIO_USER
 
PRIO_USER


	)

303 
	g__BEGIN_DECLS


305 #ifdeà
__USE_GNU


307 #iâdeà
__USE_FILE_OFFSET64


308 
	$´lim™
 (
__pid_t
 
__pid
, 
__¾im™_»sourû
 
__»sourû
,

309 cÚ¡ 
¾im™
 *
__Ãw_lim™
,

310 
¾im™
 *
__Şd_lim™
è
__THROW
;

312 #ifdeà
__REDIRECT_NTH


313 
	`__REDIRECT_NTH
 (
´lim™
, (
__pid_t
 
__pid
,

314 
__¾im™_»sourû
 
__»sourû
,

315 cÚ¡ 
¾im™
 *
__Ãw_lim™
,

316 
¾im™
 *
__Şd_lim™
), 
´lim™64
);

318 
	#´lim™
 
´lim™64


	)

321 #ifdeà
__USE_LARGEFILE64


322 
	$´lim™64
 (
__pid_t
 
__pid
, 
__¾im™_»sourû
 
__»sourû
,

323 cÚ¡ 
¾im™64
 *
__Ãw_lim™
,

324 
¾im™64
 *
__Şd_lim™
è
__THROW
;

328 
__END_DECLS


	@/usr/include/bits/select.h

18 #iâdeà
_SYS_SELECT_H


22 
	~<b™s/wÜdsize.h
>

25 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

27 #ià
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "¡osq"

	)

30 
	#__FD_ZERO_STOS
 "¡o¦"

	)

33 
	#__FD_ZERO
(
fd¥
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¬r
 = (
£t
); \

52 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |ğ
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &ğ~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)è!ğ0)

	)

	@/usr/include/bits/select2.h

19 #iâdeà
_SYS_SELECT_H


24 
__fd–t_chk
 (
__d
);

25 
	$__fd–t_w¬n
 (
__d
)

26 
	`__w¬Ç‰r
 ("bit outside of fd_set selected");

27 #undeà
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__ex‹nsiÚ__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__butš_cÚ¡ªt_p
 (
__d
) \

32 ? (0 <ğ
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fd–t_w¬n
 (
__d
)) \

35 : 
	`__fd–t_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/setjmp.h

19 #iâdeà
_BITS_SETJMP_H


20 
	#_BITS_SETJMP_H
 1

	)

22 #ià!
defšed
 
_SETJMP_H
 && !defšed 
_PTHREAD_H


26 
	~<b™s/wÜdsize.h
>

28 #iâdeà
_ASM


30 #ià
__WORDSIZE
 == 64

31 
	t__jmp_buf
[8];

32 #–ià
defšed
 
__x86_64__


33 
__ex‹nsiÚ__
 
	t__jmp_buf
[8];

35 
	t__jmp_buf
[6];

	@/usr/include/bits/sigaction.h

19 #iâdeà
_SIGNAL_H


24 
	ssigaùiÚ


27 #ifdeà
__USE_POSIX199309


31 
__sighªdËr_t
 
	m§_hªdËr
;

33 (*
	m§_sigaùiÚ
è(, 
	msigšfo_t
 *, *);

35 
	m__sigaùiÚ_hªdËr
;

36 
	#§_hªdËr
 
__sigaùiÚ_hªdËr
.
§_hªdËr


	)

37 
	#§_sigaùiÚ
 
__sigaùiÚ_hªdËr
.
§_sigaùiÚ


	)

39 
__sighªdËr_t
 
	m§_hªdËr
;

43 
__sig£t_t
 
	m§_mask
;

46 
	m§_æags
;

49 (*
	m§_»¡Ü”
) ();

53 
	#SA_NOCLDSTOP
 1

	)

54 
	#SA_NOCLDWAIT
 2

	)

55 
	#SA_SIGINFO
 4

	)

57 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_MISC


58 
	#SA_ONSTACK
 0x08000000

	)

60 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


61 
	#SA_RESTART
 0x10000000

	)

62 
	#SA_NODEFER
 0x40000000

	)

64 
	#SA_RESETHAND
 0x80000000

	)

66 #ifdeà
__USE_MISC


67 
	#SA_INTERRUPT
 0x20000000

	)

70 
	#SA_NOMASK
 
SA_NODEFER


	)

71 
	#SA_ONESHOT
 
SA_RESETHAND


	)

72 
	#SA_STACK
 
SA_ONSTACK


	)

76 
	#SIG_BLOCK
 0

	)

77 
	#SIG_UNBLOCK
 1

	)

78 
	#SIG_SETMASK
 2

	)

	@/usr/include/bits/sigcontext.h

18 #iâdeà
_BITS_SIGCONTEXT_H


19 
	#_BITS_SIGCONTEXT_H
 1

	)

21 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_SYS_UCONTEXT_H


25 
	#FP_XSTATE_MAGIC1
 0x46505853U

	)

26 
	#FP_XSTATE_MAGIC2
 0x46505845U

	)

27 
	#FP_XSTATE_MAGIC2_SIZE
 (
FP_XSTATE_MAGIC2
)

	)

29 
	s_åx_sw_by‹s


31 
__ušt32_t
 
	mmagic1
;

32 
__ušt32_t
 
	mex‹nded_size
;

33 
__ušt64_t
 
	mx¡©e_bv
;

34 
__ušt32_t
 
	mx¡©e_size
;

35 
__ušt32_t
 
	m·ddšg
[7];

38 
	s_å»g


40 
	msignifiÿnd
[4];

41 
	mexpÚ’t
;

44 
	s_åx»g


46 
	msignifiÿnd
[4];

47 
	mexpÚ’t
;

48 
	m·ddšg
[3];

51 
	s_xmm»g


53 
__ušt32_t
 
	m–em’t
[4];

58 #iâdeà
__x86_64__


60 
	s_å¡©e


63 
__ušt32_t
 
	mcw
;

64 
__ušt32_t
 
	msw
;

65 
__ušt32_t
 
	mg
;

66 
__ušt32_t
 
	moff
;

67 
__ušt32_t
 
	mcs£l
;

68 
__ušt32_t
 
	md©aoff
;

69 
__ušt32_t
 
	md©a£l
;

70 
_å»g
 
	m_¡
[8];

71 
	m¡©us
;

72 
	mmagic
;

75 
__ušt32_t
 
	m_fx¤_’v
[6];

76 
__ušt32_t
 
	mmxc¤
;

77 
__ušt32_t
 
	m»£rved
;

78 
_åx»g
 
	m_fx¤_¡
[8];

79 
_xmm»g
 
	m_xmm
[8];

80 
__ušt32_t
 
	m·ddšg
[56];

83 #iâdeà
sigcÚ‹xt_¡ruù


88 
	#sigcÚ‹xt_¡ruù
 
sigcÚ‹xt


	)

91 
	#X86_FXSR_MAGIC
 0x0000

	)

93 
	ssigcÚ‹xt


95 
	mgs
, 
	m__gsh
;

96 
	mfs
, 
	m__fsh
;

97 
	mes
, 
	m__esh
;

98 
	mds
, 
	m__dsh
;

99 
	medi
;

100 
	mesi
;

101 
	mebp
;

102 
	me¥
;

103 
	mebx
;

104 
	medx
;

105 
	mecx
;

106 
	m—x
;

107 
	mŒ­no
;

108 
	m”r
;

109 
	me
;

110 
	mcs
, 
	m__csh
;

111 
	meæags
;

112 
	me¥_©_sigÇl
;

113 
	mss
, 
	m__ssh
;

114 
_å¡©e
 * 
	må¡©e
;

115 
	mŞdmask
;

116 
	mü2
;

121 
	s_å¡©e


124 
__ušt16_t
 
	mcwd
;

125 
__ušt16_t
 
	mswd
;

126 
__ušt16_t
 
	máw
;

127 
__ušt16_t
 
	mfİ
;

128 
__ušt64_t
 
	mr
;

129 
__ušt64_t
 
	mrdp
;

130 
__ušt32_t
 
	mmxc¤
;

131 
__ušt32_t
 
	mmxü_mask
;

132 
_åx»g
 
	m_¡
[8];

133 
_xmm»g
 
	m_xmm
[16];

134 
__ušt32_t
 
	m·ddšg
[24];

137 
	ssigcÚ‹xt


139 
__ušt64_t
 
	mr8
;

140 
__ušt64_t
 
	mr9
;

141 
__ušt64_t
 
	mr10
;

142 
__ušt64_t
 
	mr11
;

143 
__ušt64_t
 
	mr12
;

144 
__ušt64_t
 
	mr13
;

145 
__ušt64_t
 
	mr14
;

146 
__ušt64_t
 
	mr15
;

147 
__ušt64_t
 
	mrdi
;

148 
__ušt64_t
 
	mrsi
;

149 
__ušt64_t
 
	mrbp
;

150 
__ušt64_t
 
	mrbx
;

151 
__ušt64_t
 
	mrdx
;

152 
__ušt64_t
 
	m¿x
;

153 
__ušt64_t
 
	mrcx
;

154 
__ušt64_t
 
	mr¥
;

155 
__ušt64_t
 
	mr
;

156 
__ušt64_t
 
	meæags
;

157 
	mcs
;

158 
	mgs
;

159 
	mfs
;

160 
	m__·d0
;

161 
__ušt64_t
 
	m”r
;

162 
__ušt64_t
 
	mŒ­no
;

163 
__ušt64_t
 
	mŞdmask
;

164 
__ušt64_t
 
	mü2
;

165 
__ex‹nsiÚ__
 union

167 
_å¡©e
 * 
	må¡©e
;

168 
__ušt64_t
 
	m__å¡©e_wÜd
;

170 
__ušt64_t
 
	m__»£rved1
 [8];

175 
	s_x§ve_hdr


177 
__ušt64_t
 
	mx¡©e_bv
;

178 
__ušt64_t
 
	m»£rved1
[2];

179 
__ušt64_t
 
	m»£rved2
[5];

182 
	s_ymmh_¡©e


184 
__ušt32_t
 
	mymmh_¥aû
[64];

187 
	s_x¡©e


189 
_å¡©e
 
	må¡©e
;

190 
_x§ve_hdr
 
	mx¡©e_hdr
;

191 
_ymmh_¡©e
 
	mymmh
;

	@/usr/include/bits/siginfo.h

19 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
__Ãed_sigšfo_t
 \

20 && !
defšed
 
	g__Ãed_sigev’t_t


24 
	~<b™s/wÜdsize.h
>

26 #ià(!
defšed
 
__have_sigv®_t
 \

27 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
 \

28 || 
defšed
 
	g__Ãed_sigev’t_t
))

29 
	#__have_sigv®_t
 1

	)

32 
	usigv®


34 
	msiv®_št
;

35 *
	msiv®_±r
;

36 } 
	tsigv®_t
;

39 #ià(!
defšed
 
__have_sigšfo_t
 \

40 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
))

41 
	#__have_sigšfo_t
 1

	)

43 
	#__SI_MAX_SIZE
 128

	)

44 #ià
__WORDSIZE
 == 64

45 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 4)

	)

47 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 3)

	)

50 #ià
defšed
 
__x86_64__
 && 
__WORDSIZE
 == 32

55 
__şock_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
 (4))è
	t__sigchld_şock_t
;

56 
	#__SI_ALIGNMENT
 
	`__©Œibu‹__
 ((
	`__®igÃd__
 (8)))

	)

58 
__şock_t
 
	t__sigchld_şock_t
;

59 
	#__SI_ALIGNMENT


	)

64 
si_signo
;

65 
si_”ºo
;

67 
si_code
;

71 
_·d
[
__SI_PAD_SIZE
];

76 
__pid_t
 
si_pid
;

77 
__uid_t
 
si_uid
;

78 } 
_kl
;

83 
si_tid
;

84 
si_ov”run
;

85 
sigv®_t
 
si_sigv®
;

86 } 
_tim”
;

91 
__pid_t
 
si_pid
;

92 
__uid_t
 
si_uid
;

93 
sigv®_t
 
si_sigv®
;

94 } 
_¹
;

99 
__pid_t
 
si_pid
;

100 
__uid_t
 
si_uid
;

101 
si_¡©us
;

102 
__sigchld_şock_t
 
si_utime
;

103 
__sigchld_şock_t
 
si_¡ime
;

104 } 
_sigchld
;

109 *
si_addr
;

110 
si_addr_lsb
;

113 *
_low”
;

114 *
_uµ”
;

115 } 
si_addr_bnd
;

116 } 
_sigçuÉ
;

121 
si_bªd
;

122 
si_fd
;

123 } 
_sigpŞl
;

128 *
_ÿÎ_addr
;

129 
_sysÿÎ
;

130 
_¬ch
;

131 } 
_sigsys
;

132 } 
_sif›lds
;

133 } 
	tsigšfo_t
 
	t__SI_ALIGNMENT
;

137 
	#si_pid
 
_sif›lds
.
_kl
.
si_pid


	)

138 
	#si_uid
 
_sif›lds
.
_kl
.
si_uid


	)

139 
	#si_tim”id
 
_sif›lds
.
_tim”
.
si_tid


	)

140 
	#si_ov”run
 
_sif›lds
.
_tim”
.
si_ov”run


	)

141 
	#si_¡©us
 
_sif›lds
.
_sigchld
.
si_¡©us


	)

142 
	#si_utime
 
_sif›lds
.
_sigchld
.
si_utime


	)

143 
	#si_¡ime
 
_sif›lds
.
_sigchld
.
si_¡ime


	)

144 
	#si_v®ue
 
_sif›lds
.
_¹
.
si_sigv®


	)

145 
	#si_št
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_št


	)

146 
	#si_±r
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_±r


	)

147 
	#si_addr
 
_sif›lds
.
_sigçuÉ
.
si_addr


	)

148 
	#si_addr_lsb
 
_sif›lds
.
_sigçuÉ
.
si_addr_lsb


	)

149 
	#si_low”
 
_sif›lds
.
_sigçuÉ
.
si_addr_bnd
.
_low”


	)

150 
	#si_uµ”
 
_sif›lds
.
_sigçuÉ
.
si_addr_bnd
.
_uµ”


	)

151 
	#si_bªd
 
_sif›lds
.
_sigpŞl
.
si_bªd


	)

152 
	#si_fd
 
_sif›lds
.
_sigpŞl
.
si_fd


	)

153 
	#si_ÿÎ_addr
 
_sif›lds
.
_sigsys
.
_ÿÎ_addr


	)

154 
	#si_sysÿÎ
 
_sif›lds
.
_sigsys
.
_sysÿÎ


	)

155 
	#si_¬ch
 
_sif›lds
.
_sigsys
.
_¬ch


	)

162 
SI_ASYNCNL
 = -60,

163 
	#SI_ASYNCNL
 
SI_ASYNCNL


	)

164 
SI_TKILL
 = -6,

165 
	#SI_TKILL
 
SI_TKILL


	)

166 
SI_SIGIO
,

167 
	#SI_SIGIO
 
SI_SIGIO


	)

168 
SI_ASYNCIO
,

169 
	#SI_ASYNCIO
 
SI_ASYNCIO


	)

170 
SI_MESGQ
,

171 
	#SI_MESGQ
 
SI_MESGQ


	)

172 
SI_TIMER
,

173 
	#SI_TIMER
 
SI_TIMER


	)

174 
SI_QUEUE
,

175 
	#SI_QUEUE
 
SI_QUEUE


	)

176 
SI_USER
,

177 
	#SI_USER
 
SI_USER


	)

178 
SI_KERNEL
 = 0x80

179 
	#SI_KERNEL
 
SI_KERNEL


	)

183 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


187 
ILL_ILLOPC
 = 1,

188 
	#ILL_ILLOPC
 
ILL_ILLOPC


	)

189 
ILL_ILLOPN
,

190 
	#ILL_ILLOPN
 
ILL_ILLOPN


	)

191 
ILL_ILLADR
,

192 
	#ILL_ILLADR
 
ILL_ILLADR


	)

193 
ILL_ILLTRP
,

194 
	#ILL_ILLTRP
 
ILL_ILLTRP


	)

195 
ILL_PRVOPC
,

196 
	#ILL_PRVOPC
 
ILL_PRVOPC


	)

197 
ILL_PRVREG
,

198 
	#ILL_PRVREG
 
ILL_PRVREG


	)

199 
ILL_COPROC
,

200 
	#ILL_COPROC
 
ILL_COPROC


	)

201 
ILL_BADSTK


202 
	#ILL_BADSTK
 
ILL_BADSTK


	)

208 
FPE_INTDIV
 = 1,

209 
	#FPE_INTDIV
 
FPE_INTDIV


	)

210 
FPE_INTOVF
,

211 
	#FPE_INTOVF
 
FPE_INTOVF


	)

212 
FPE_FLTDIV
,

213 
	#FPE_FLTDIV
 
FPE_FLTDIV


	)

214 
FPE_FLTOVF
,

215 
	#FPE_FLTOVF
 
FPE_FLTOVF


	)

216 
FPE_FLTUND
,

217 
	#FPE_FLTUND
 
FPE_FLTUND


	)

218 
FPE_FLTRES
,

219 
	#FPE_FLTRES
 
FPE_FLTRES


	)

220 
FPE_FLTINV
,

221 
	#FPE_FLTINV
 
FPE_FLTINV


	)

222 
FPE_FLTSUB


223 
	#FPE_FLTSUB
 
FPE_FLTSUB


	)

229 
SEGV_MAPERR
 = 1,

230 
	#SEGV_MAPERR
 
SEGV_MAPERR


	)

231 
SEGV_ACCERR


232 
	#SEGV_ACCERR
 
SEGV_ACCERR


	)

238 
BUS_ADRALN
 = 1,

239 
	#BUS_ADRALN
 
BUS_ADRALN


	)

240 
BUS_ADRERR
,

241 
	#BUS_ADRERR
 
BUS_ADRERR


	)

242 
BUS_OBJERR
,

243 
	#BUS_OBJERR
 
BUS_OBJERR


	)

244 
BUS_MCEERR_AR
,

245 
	#BUS_MCEERR_AR
 
BUS_MCEERR_AR


	)

246 
BUS_MCEERR_AO


247 
	#BUS_MCEERR_AO
 
BUS_MCEERR_AO


	)

251 #ifdeà
__USE_XOPEN_EXTENDED


255 
TRAP_BRKPT
 = 1,

256 
	#TRAP_BRKPT
 
TRAP_BRKPT


	)

257 
TRAP_TRACE


258 
	#TRAP_TRACE
 
TRAP_TRACE


	)

262 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


266 
CLD_EXITED
 = 1,

267 
	#CLD_EXITED
 
CLD_EXITED


	)

268 
CLD_KILLED
,

269 
	#CLD_KILLED
 
CLD_KILLED


	)

270 
CLD_DUMPED
,

271 
	#CLD_DUMPED
 
CLD_DUMPED


	)

272 
CLD_TRAPPED
,

273 
	#CLD_TRAPPED
 
CLD_TRAPPED


	)

274 
CLD_STOPPED
,

275 
	#CLD_STOPPED
 
CLD_STOPPED


	)

276 
CLD_CONTINUED


277 
	#CLD_CONTINUED
 
CLD_CONTINUED


	)

283 
POLL_IN
 = 1,

284 
	#POLL_IN
 
POLL_IN


	)

285 
POLL_OUT
,

286 
	#POLL_OUT
 
POLL_OUT


	)

287 
POLL_MSG
,

288 
	#POLL_MSG
 
POLL_MSG


	)

289 
POLL_ERR
,

290 
	#POLL_ERR
 
POLL_ERR


	)

291 
POLL_PRI
,

292 
	#POLL_PRI
 
POLL_PRI


	)

293 
POLL_HUP


294 
	#POLL_HUP
 
POLL_HUP


	)

298 #undeà
__Ãed_sigšfo_t


302 #ià(
defšed
 
_SIGNAL_H
 || defšed 
__Ãed_sigev’t_t
) \

303 && !
defšed
 
__have_sigev’t_t


304 
	#__have_sigev’t_t
 1

	)

307 
	#__SIGEV_MAX_SIZE
 64

	)

308 #ià
__WORDSIZE
 == 64

309 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 4)

	)

311 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 3)

	)

315 #iâdeà
__have_±h»ad_©Œ_t


316 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

317 
	#__have_±h»ad_©Œ_t
 1

	)

320 
	ssigev’t


322 
sigv®_t
 
sigev_v®ue
;

323 
sigev_signo
;

324 
sigev_nÙify
;

328 
_·d
[
__SIGEV_PAD_SIZE
];

332 
__pid_t
 
_tid
;

336 (*
_funùiÚ
è(
sigv®_t
);

337 
±h»ad_©Œ_t
 *
_©Œibu‹
;

338 } 
_sigev_th»ad
;

339 } 
_sigev_un
;

340 } 
	tsigev’t_t
;

343 
	#sigev_nÙify_funùiÚ
 
_sigev_un
.
_sigev_th»ad
.
_funùiÚ


	)

344 
	#sigev_nÙify_©Œibu‹s
 
_sigev_un
.
_sigev_th»ad
.
_©Œibu‹


	)

349 
SIGEV_SIGNAL
 = 0,

350 
	#SIGEV_SIGNAL
 
SIGEV_SIGNAL


	)

351 
SIGEV_NONE
,

352 
	#SIGEV_NONE
 
SIGEV_NONE


	)

353 
SIGEV_THREAD
,

354 
	#SIGEV_THREAD
 
SIGEV_THREAD


	)

356 
SIGEV_THREAD_ID
 = 4

357 
	#SIGEV_THREAD_ID
 
SIGEV_THREAD_ID


	)

	@/usr/include/bits/signum.h

19 #ifdef 
_SIGNAL_H


22 
	#SIG_ERR
 ((
__sighªdËr_t
è-1è

	)

23 
	#SIG_DFL
 ((
__sighªdËr_t
è0è

	)

24 
	#SIG_IGN
 ((
__sighªdËr_t
è1è

	)

26 #ifdeà
__USE_UNIX98


27 
	#SIG_HOLD
 ((
__sighªdËr_t
è2è

	)

32 
	#SIGHUP
 1

	)

33 
	#SIGINT
 2

	)

34 
	#SIGQUIT
 3

	)

35 
	#SIGILL
 4

	)

36 
	#SIGTRAP
 5

	)

37 
	#SIGABRT
 6

	)

38 
	#SIGIOT
 6

	)

39 
	#SIGBUS
 7

	)

40 
	#SIGFPE
 8

	)

41 
	#SIGKILL
 9

	)

42 
	#SIGUSR1
 10

	)

43 
	#SIGSEGV
 11

	)

44 
	#SIGUSR2
 12

	)

45 
	#SIGPIPE
 13

	)

46 
	#SIGALRM
 14

	)

47 
	#SIGTERM
 15

	)

48 
	#SIGSTKFLT
 16

	)

49 
	#SIGCLD
 
SIGCHLD


	)

50 
	#SIGCHLD
 17

	)

51 
	#SIGCONT
 18

	)

52 
	#SIGSTOP
 19

	)

53 
	#SIGTSTP
 20

	)

54 
	#SIGTTIN
 21

	)

55 
	#SIGTTOU
 22

	)

56 
	#SIGURG
 23

	)

57 
	#SIGXCPU
 24

	)

58 
	#SIGXFSZ
 25

	)

59 
	#SIGVTALRM
 26

	)

60 
	#SIGPROF
 27

	)

61 
	#SIGWINCH
 28

	)

62 
	#SIGPOLL
 
SIGIO


	)

63 
	#SIGIO
 29

	)

64 
	#SIGPWR
 30

	)

65 
	#SIGSYS
 31

	)

66 
	#SIGUNUSED
 31

	)

68 
	#_NSIG
 65

	)

71 
	#SIGRTMIN
 (
	`__libc_cu¼’t_sig¹mš
 ())

	)

72 
	#SIGRTMAX
 (
	`__libc_cu¼’t_sig¹max
 ())

	)

76 
	#__SIGRTMIN
 32

	)

77 
	#__SIGRTMAX
 (
_NSIG
 - 1)

	)

	@/usr/include/bits/sigset.h

19 #iâdef 
_SIGSET_H_ty³s


20 
	#_SIGSET_H_ty³s
 1

	)

22 
	t__sig_©omic_t
;

26 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

29 
	m__v®
[
_SIGSET_NWORDS
];

30 } 
	t__sig£t_t
;

41 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


42 
	#_SIGSET_H_âs
 1

	)

44 #iâdeà
_EXTERN_INLINE


45 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

49 
	#__sigmask
(
sig
) \

50 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

53 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

55 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

56 
	#__sigem±y£t
(
£t
) \

57 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

58 
sig£t_t
 *
__£t
 = (
£t
); \

59 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

60 0; }))

	)

61 
	#__sigfl£t
(
£t
) \

62 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

63 
sig£t_t
 *
__£t
 = (
£t
); \

64 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

65 0; }))

	)

67 #ifdeà
__USE_GNU


71 
	#__sigi£m±y£t
(
£t
) \

72 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

73 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

74 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

75 !
__»t
 && --
__út
 >= 0) \

76 
__»t
 = 
__£t
->
__v®
[
__út
]; \

77 
__»t
 =ğ0; }))

	)

78 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

79 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

80 
sig£t_t
 *
__de¡
 = (
de¡
); \

81 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

82 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

83 --
__út
 >= 0) \

84 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

85 & 
__right
->
__v®
[
__út
]); \

86 0; }))

	)

87 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

88 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

89 
sig£t_t
 *
__de¡
 = (
de¡
); \

90 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

91 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

92 --
__út
 >= 0) \

93 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

94 | 
__right
->
__v®
[
__út
]); \

95 0; }))

	)

102 
__sigismemb”
 (cÚ¡ 
__sig£t_t
 *, );

103 
__sigadd£t
 (
__sig£t_t
 *, );

104 
__sigd–£t
 (
__sig£t_t
 *, );

106 #ifdeà
__USE_EXTERN_INLINES


107 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

108 
_EXTERN_INLINE
 \

109 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

111 
__mask
 = 
	`__sigmask
 (
__sig
); \

112 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

113  
BODY
; \

114 }

	)

116 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
) ? 1 : 0, const)

117 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

118 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

120 #undeà
__SIGSETFN


	@/usr/include/bits/sigstack.h

19 #iâdeà
_SIGNAL_H


25 
	ssig¡ack


27 *
	mss_¥
;

28 
	mss_Ú¡ack
;

35 
	mSS_ONSTACK
 = 1,

36 
	#SS_ONSTACK
 
SS_ONSTACK


	)

37 
	mSS_DISABLE


38 
	#SS_DISABLE
 
SS_DISABLE


	)

42 
	#MINSIGSTKSZ
 2048

	)

45 
	#SIGSTKSZ
 8192

	)

49 
	ssig®t¡ack


51 *
	mss_¥
;

52 
	mss_æags
;

53 
size_t
 
	mss_size
;

54 } 
	t¡ack_t
;

	@/usr/include/bits/sigthread.h

19 #iâdeà
_BITS_SIGTHREAD_H


20 
	#_BITS_SIGTHREAD_H
 1

	)

22 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_PTHREAD_H


30 
	$±h»ad_sigmask
 (
__how
,

31 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__Ãwmask
,

32 
__sig£t_t
 *
__»¡riù
 
__Şdmask
)
__THROW
;

35 
	$±h»ad_kl
 (
±h»ad_t
 
__th»adid
, 
__signo
è
__THROW
;

37 #ifdeà
__USE_GNU


39 
	$±h»ad_sigqueue
 (
±h»ad_t
 
__th»adid
, 
__signo
,

40 cÚ¡ 
sigv®
 
__v®ue
è
__THROW
;

	@/usr/include/bits/sockaddr.h

23 #iâdeà
_BITS_SOCKADDR_H


24 
	#_BITS_SOCKADDR_H
 1

	)

28 
	t§_çmy_t
;

34 
	#__SOCKADDR_COMMON
(
§_´efix
) \

35 
§_çmy_t
 
§_´efix
##
çmy


	)

37 
	#__SOCKADDR_COMMON_SIZE
 ( ())

	)

40 
	#_SS_SIZE
 128

	)

	@/usr/include/bits/socket.h

19 #iâdeà
__BITS_SOCKET_H


20 
	#__BITS_SOCKET_H


	)

22 #iâdeà
_SYS_SOCKET_H


26 
	#__Ãed_size_t


	)

27 
	~<¡ddef.h
>

29 
	~<sys/ty³s.h
>

32 #iâdeà
__sockËn_t_defšed


33 
__sockËn_t
 
	tsockËn_t
;

34 
	#__sockËn_t_defšed


	)

38 
	~<b™s/sock‘_ty³.h
>

41 
	#PF_UNSPEC
 0

	)

42 
	#PF_LOCAL
 1

	)

43 
	#PF_UNIX
 
PF_LOCAL


	)

44 
	#PF_FILE
 
PF_LOCAL


	)

45 
	#PF_INET
 2

	)

46 
	#PF_AX25
 3

	)

47 
	#PF_IPX
 4

	)

48 
	#PF_APPLETALK
 5

	)

49 
	#PF_NETROM
 6

	)

50 
	#PF_BRIDGE
 7

	)

51 
	#PF_ATMPVC
 8

	)

52 
	#PF_X25
 9

	)

53 
	#PF_INET6
 10

	)

54 
	#PF_ROSE
 11

	)

55 
	#PF_DECÃt
 12

	)

56 
	#PF_NETBEUI
 13

	)

57 
	#PF_SECURITY
 14

	)

58 
	#PF_KEY
 15

	)

59 
	#PF_NETLINK
 16

	)

60 
	#PF_ROUTE
 
PF_NETLINK


	)

61 
	#PF_PACKET
 17

	)

62 
	#PF_ASH
 18

	)

63 
	#PF_ECONET
 19

	)

64 
	#PF_ATMSVC
 20

	)

65 
	#PF_RDS
 21

	)

66 
	#PF_SNA
 22

	)

67 
	#PF_IRDA
 23

	)

68 
	#PF_PPPOX
 24

	)

69 
	#PF_WANPIPE
 25

	)

70 
	#PF_LLC
 26

	)

71 
	#PF_IB
 27

	)

72 
	#PF_MPLS
 28

	)

73 
	#PF_CAN
 29

	)

74 
	#PF_TIPC
 30

	)

75 
	#PF_BLUETOOTH
 31

	)

76 
	#PF_IUCV
 32

	)

77 
	#PF_RXRPC
 33

	)

78 
	#PF_ISDN
 34

	)

79 
	#PF_PHONET
 35

	)

80 
	#PF_IEEE802154
 36

	)

81 
	#PF_CAIF
 37

	)

82 
	#PF_ALG
 38

	)

83 
	#PF_NFC
 39

	)

84 
	#PF_VSOCK
 40

	)

85 
	#PF_MAX
 41

	)

88 
	#AF_UNSPEC
 
PF_UNSPEC


	)

89 
	#AF_LOCAL
 
PF_LOCAL


	)

90 
	#AF_UNIX
 
PF_UNIX


	)

91 
	#AF_FILE
 
PF_FILE


	)

92 
	#AF_INET
 
PF_INET


	)

93 
	#AF_AX25
 
PF_AX25


	)

94 
	#AF_IPX
 
PF_IPX


	)

95 
	#AF_APPLETALK
 
PF_APPLETALK


	)

96 
	#AF_NETROM
 
PF_NETROM


	)

97 
	#AF_BRIDGE
 
PF_BRIDGE


	)

98 
	#AF_ATMPVC
 
PF_ATMPVC


	)

99 
	#AF_X25
 
PF_X25


	)

100 
	#AF_INET6
 
PF_INET6


	)

101 
	#AF_ROSE
 
PF_ROSE


	)

102 
	#AF_DECÃt
 
PF_DECÃt


	)

103 
	#AF_NETBEUI
 
PF_NETBEUI


	)

104 
	#AF_SECURITY
 
PF_SECURITY


	)

105 
	#AF_KEY
 
PF_KEY


	)

106 
	#AF_NETLINK
 
PF_NETLINK


	)

107 
	#AF_ROUTE
 
PF_ROUTE


	)

108 
	#AF_PACKET
 
PF_PACKET


	)

109 
	#AF_ASH
 
PF_ASH


	)

110 
	#AF_ECONET
 
PF_ECONET


	)

111 
	#AF_ATMSVC
 
PF_ATMSVC


	)

112 
	#AF_RDS
 
PF_RDS


	)

113 
	#AF_SNA
 
PF_SNA


	)

114 
	#AF_IRDA
 
PF_IRDA


	)

115 
	#AF_PPPOX
 
PF_PPPOX


	)

116 
	#AF_WANPIPE
 
PF_WANPIPE


	)

117 
	#AF_LLC
 
PF_LLC


	)

118 
	#AF_IB
 
PF_IB


	)

119 
	#AF_MPLS
 
PF_MPLS


	)

120 
	#AF_CAN
 
PF_CAN


	)

121 
	#AF_TIPC
 
PF_TIPC


	)

122 
	#AF_BLUETOOTH
 
PF_BLUETOOTH


	)

123 
	#AF_IUCV
 
PF_IUCV


	)

124 
	#AF_RXRPC
 
PF_RXRPC


	)

125 
	#AF_ISDN
 
PF_ISDN


	)

126 
	#AF_PHONET
 
PF_PHONET


	)

127 
	#AF_IEEE802154
 
PF_IEEE802154


	)

128 
	#AF_CAIF
 
PF_CAIF


	)

129 
	#AF_ALG
 
PF_ALG


	)

130 
	#AF_NFC
 
PF_NFC


	)

131 
	#AF_VSOCK
 
PF_VSOCK


	)

132 
	#AF_MAX
 
PF_MAX


	)

138 
	#SOL_RAW
 255

	)

139 
	#SOL_DECNET
 261

	)

140 
	#SOL_X25
 262

	)

141 
	#SOL_PACKET
 263

	)

142 
	#SOL_ATM
 264

	)

143 
	#SOL_AAL
 265

	)

144 
	#SOL_IRDA
 266

	)

147 
	#SOMAXCONN
 128

	)

150 
	~<b™s/sockaddr.h
>

153 
	ssockaddr


155 
__SOCKADDR_COMMON
 (
§_
);

156 
	m§_d©a
[14];

162 
	#__ss_®igÁy³
 

	)

163 
	#_SS_PADSIZE
 \

164 (
_SS_SIZE
 - 
__SOCKADDR_COMMON_SIZE
 -  (
__ss_®igÁy³
))

	)

166 
	ssockaddr_¡Üage


168 
__SOCKADDR_COMMON
 (
ss_
);

169 
	m__ss_·ddšg
[
_SS_PADSIZE
];

170 
__ss_®igÁy³
 
	m__ss_®ign
;

177 
	mMSG_OOB
 = 0x01,

178 
	#MSG_OOB
 
MSG_OOB


	)

179 
	mMSG_PEEK
 = 0x02,

180 
	#MSG_PEEK
 
MSG_PEEK


	)

181 
	mMSG_DONTROUTE
 = 0x04,

182 
	#MSG_DONTROUTE
 
MSG_DONTROUTE


	)

183 #ifdeà
__USE_GNU


185 
	mMSG_TRYHARD
 = 
MSG_DONTROUTE
,

186 
	#MSG_TRYHARD
 
MSG_DONTROUTE


	)

188 
	mMSG_CTRUNC
 = 0x08,

189 
	#MSG_CTRUNC
 
MSG_CTRUNC


	)

190 
	mMSG_PROXY
 = 0x10,

191 
	#MSG_PROXY
 
MSG_PROXY


	)

192 
	mMSG_TRUNC
 = 0x20,

193 
	#MSG_TRUNC
 
MSG_TRUNC


	)

194 
	mMSG_DONTWAIT
 = 0x40,

195 
	#MSG_DONTWAIT
 
MSG_DONTWAIT


	)

196 
	mMSG_EOR
 = 0x80,

197 
	#MSG_EOR
 
MSG_EOR


	)

198 
	mMSG_WAITALL
 = 0x100,

199 
	#MSG_WAITALL
 
MSG_WAITALL


	)

200 
	mMSG_FIN
 = 0x200,

201 
	#MSG_FIN
 
MSG_FIN


	)

202 
	mMSG_SYN
 = 0x400,

203 
	#MSG_SYN
 
MSG_SYN


	)

204 
	mMSG_CONFIRM
 = 0x800,

205 
	#MSG_CONFIRM
 
MSG_CONFIRM


	)

206 
	mMSG_RST
 = 0x1000,

207 
	#MSG_RST
 
MSG_RST


	)

208 
	mMSG_ERRQUEUE
 = 0x2000,

209 
	#MSG_ERRQUEUE
 
MSG_ERRQUEUE


	)

210 
	mMSG_NOSIGNAL
 = 0x4000,

211 
	#MSG_NOSIGNAL
 
MSG_NOSIGNAL


	)

212 
	mMSG_MORE
 = 0x8000,

213 
	#MSG_MORE
 
MSG_MORE


	)

214 
	mMSG_WAITFORONE
 = 0x10000,

215 
	#MSG_WAITFORONE
 
MSG_WAITFORONE


	)

216 
	mMSG_FASTOPEN
 = 0x20000000,

217 
	#MSG_FASTOPEN
 
MSG_FASTOPEN


	)

219 
	mMSG_CMSG_CLOEXEC
 = 0x40000000

222 
	#MSG_CMSG_CLOEXEC
 
MSG_CMSG_CLOEXEC


	)

228 
	smsghdr


230 *
	mmsg_Çme
;

231 
sockËn_t
 
	mmsg_Çm–’
;

233 
iovec
 *
	mmsg_iov
;

234 
size_t
 
	mmsg_iovËn
;

236 *
	mmsg_cÚŒŞ
;

237 
size_t
 
	mmsg_cÚŒŞËn
;

242 
	mmsg_æags
;

246 
	scmsghdr


248 
size_t
 
	mcmsg_Ën
;

253 
	mcmsg_Ëv–
;

254 
	mcmsg_ty³
;

255 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

256 
__ex‹nsiÚ__
 
__cmsg_d©a
 
	m__æex¬r
;

261 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

262 
	#CMSG_DATA
(
cmsg
è((cmsg)->
__cmsg_d©a
)

	)

264 
	#CMSG_DATA
(
cmsg
è((*è((
cmsghdr
 *è(cmsgè+ 1))

	)

266 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`__cmsg_nxthdr
 (mhdr, cmsg)

	)

267 
	#CMSG_FIRSTHDR
(
mhdr
) \

268 ((
size_t
è(
mhdr
)->
msg_cÚŒŞËn
 >ğ (
cmsghdr
) \

269 ? (
cmsghdr
 *è(
mhdr
)->
msg_cÚŒŞ
 : (cmsghd¸*è0)

	)

270 
	#CMSG_ALIGN
(
Ën
è((Ö’è+  (
size_t
) - 1) \

271 & (
size_t
è~( (size_tè- 1))

	)

272 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
 (len) \

273 + 
	`CMSG_ALIGN
 ( (
cmsghdr
)))

	)

274 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
 ( (
cmsghdr
)è+ (Ën))

	)

276 
cmsghdr
 *
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
,

277 
cmsghdr
 *
__cmsg
è
__THROW
;

278 #ifdeà
__USE_EXTERN_INLINES


279 #iâdeà
_EXTERN_INLINE


280 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

282 
_EXTERN_INLINE
 
cmsghdr
 *

283 
	`__NTH
 (
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
, 
cmsghdr
 *
__cmsg
))

285 ià((
size_t
è
__cmsg
->
cmsg_Ën
 <  (
cmsghdr
))

287  (
cmsghdr
 *) 0;

289 
__cmsg
 = (
cmsghdr
 *) ((*) __cmsg

290 + 
	`CMSG_ALIGN
 (
__cmsg
->
cmsg_Ën
));

291 ià((*è(
__cmsg
 + 1è> ((*è
__mhdr
->
msg_cÚŒŞ


292 + 
__mhdr
->
msg_cÚŒŞËn
)

293 || ((*è
__cmsg
 + 
	`CMSG_ALIGN
 (__cmsg->
cmsg_Ën
)

294 > ((*è
__mhdr
->
msg_cÚŒŞ
 + __mhdr->
msg_cÚŒŞËn
)))

296  (
cmsghdr
 *) 0;

297  
__cmsg
;

298 
	}
}

305 
	mSCM_RIGHTS
 = 0x01

306 
	#SCM_RIGHTS
 
SCM_RIGHTS


	)

307 #ifdeà
__USE_GNU


308 , 
	mSCM_CREDENTIALS
 = 0x02

309 
	#SCM_CREDENTIALS
 
SCM_CREDENTIALS


	)

313 #ifdeà
__USE_GNU


315 
	suüed


317 
pid_t
 
	mpid
;

318 
uid_t
 
	muid
;

319 
gid_t
 
	mgid
;

324 #iâdeà
__USE_MISC


325 #iâdeà
FIOGETOWN


326 
	#__SYS_SOCKET_H_undef_FIOGETOWN


	)

328 #iâdeà
FIOSETOWN


329 
	#__SYS_SOCKET_H_undef_FIOSETOWN


	)

331 #iâdeà
SIOCATMARK


332 
	#__SYS_SOCKET_H_undef_SIOCATMARK


	)

334 #iâdeà
SIOCGPGRP


335 
	#__SYS_SOCKET_H_undef_SIOCGPGRP


	)

337 #iâdeà
SIOCGSTAMP


338 
	#__SYS_SOCKET_H_undef_SIOCGSTAMP


	)

340 #iâdeà
SIOCGSTAMPNS


341 
	#__SYS_SOCKET_H_undef_SIOCGSTAMPNS


	)

343 #iâdeà
SIOCSPGRP


344 
	#__SYS_SOCKET_H_undef_SIOCSPGRP


	)

349 
	~<asm/sock‘.h
>

351 #iâdeà
__USE_MISC


352 #ifdeà
__SYS_SOCKET_H_undef_FIOGETOWN


353 #undeà
__SYS_SOCKET_H_undef_FIOGETOWN


354 #undeà
FIOGETOWN


356 #ifdeà
__SYS_SOCKET_H_undef_FIOSETOWN


357 #undeà
__SYS_SOCKET_H_undef_FIOSETOWN


358 #undeà
FIOSETOWN


360 #ifdeà
__SYS_SOCKET_H_undef_SIOCATMARK


361 #undeà
__SYS_SOCKET_H_undef_SIOCATMARK


362 #undeà
SIOCATMARK


364 #ifdeà
__SYS_SOCKET_H_undef_SIOCGPGRP


365 #undeà
__SYS_SOCKET_H_undef_SIOCGPGRP


366 #undeà
SIOCGPGRP


368 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


369 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


370 #undeà
SIOCGSTAMP


372 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


373 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


374 #undeà
SIOCGSTAMPNS


376 #ifdeà
__SYS_SOCKET_H_undef_SIOCSPGRP


377 #undeà
__SYS_SOCKET_H_undef_SIOCSPGRP


378 #undeà
SIOCSPGRP


383 
	slšg”


385 
	ml_Úoff
;

386 
	ml_lšg”
;

	@/usr/include/bits/socket2.h

19 #iâdeà
_SYS_SOCKET_H


23 
ssize_t
 
__»cv_chk
 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

24 
__æags
);

25 
ssize_t
 
__REDIRECT
 (
__»cv_®Ÿs
, (
__fd
, *
__buf
, 
size_t
 
__n
,

26 
__æags
), 
»cv
);

27 
ssize_t
 
__REDIRECT
 (
__»cv_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

29 
__æags
), 
__»cv_chk
)

30 
__w¬Ç‰r
 ("recv called with bigger†engthhan size of destination "

33 
__fÜtify_funùiÚ
 
ssize_t


34 
	$»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

39  
	`__»cv_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

41 ià(
__n
 > 
	`__bos0
 (
__buf
))

42  
	`__»cv_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

44  
	`__»cv_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
);

45 
	}
}

47 
ssize_t
 
__»cväom_chk
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

48 
size_t
 
__buæ’
, 
__æags
,

49 
__SOCKADDR_ARG
 
__addr
,

50 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

51 
ssize_t
 
__REDIRECT
 (
__»cväom_®Ÿs
,

52 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

53 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

54 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
»cväom
);

55 
ssize_t
 
__REDIRECT
 (
__»cväom_chk_w¬n
,

56 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

57 
size_t
 
__buæ’
, 
__æags
,

58 
__SOCKADDR_ARG
 
__addr
,

59 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
__»cväom_chk
)

60 
__w¬Ç‰r
 ("recvfrom called with bigger†engthhan size of "

63 
__fÜtify_funùiÚ
 
ssize_t


64 
	$»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
, 
__æags
,

65 
__SOCKADDR_ARG
 
__addr
, 
sockËn_t
 *
__»¡riù
 
__addr_Ën
)

67 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

70  
	`__»cväom_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

71 
__addr
, 
__addr_Ën
);

72 ià(
__n
 > 
	`__bos0
 (
__buf
))

73  
	`__»cväom_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

74 
__addr
, 
__addr_Ën
);

76  
	`__»cväom_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
, 
__addr
, 
__addr_Ën
);

77 
	}
}

	@/usr/include/bits/stat.h

18 #ià!
defšed
 
_SYS_STAT_H
 && !defšed 
_FCNTL_H


22 #iâdeà
_BITS_STAT_H


23 
	#_BITS_STAT_H
 1

	)

26 #iâdeà
__x86_64__


27 
	#_STAT_VER_LINUX_OLD
 1

	)

28 
	#_STAT_VER_KERNEL
 1

	)

29 
	#_STAT_VER_SVR4
 2

	)

30 
	#_STAT_VER_LINUX
 3

	)

33 
	#_MKNOD_VER_LINUX
 1

	)

34 
	#_MKNOD_VER_SVR4
 2

	)

35 
	#_MKNOD_VER
 
_MKNOD_VER_LINUX


	)

37 
	#_STAT_VER_KERNEL
 0

	)

38 
	#_STAT_VER_LINUX
 1

	)

41 
	#_MKNOD_VER_LINUX
 0

	)

44 
	#_STAT_VER
 
_STAT_VER_LINUX


	)

46 
	s¡©


48 
__dev_t
 
	m¡_dev
;

49 #iâdeà
__x86_64__


50 
	m__·d1
;

52 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


53 
__šo_t
 
	m¡_šo
;

55 
__šo_t
 
	m__¡_šo
;

57 #iâdeà
__x86_64__


58 
__mode_t
 
	m¡_mode
;

59 
__Æšk_t
 
	m¡_Æšk
;

61 
__Æšk_t
 
	m¡_Æšk
;

62 
__mode_t
 
	m¡_mode
;

64 
__uid_t
 
	m¡_uid
;

65 
__gid_t
 
	m¡_gid
;

66 #ifdeà
__x86_64__


67 
	m__·d0
;

69 
__dev_t
 
	m¡_rdev
;

70 #iâdeà
__x86_64__


71 
	m__·d2
;

73 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


74 
__off_t
 
	m¡_size
;

76 
__off64_t
 
	m¡_size
;

78 
__blksize_t
 
	m¡_blksize
;

79 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


80 
__blkút_t
 
	m¡_blocks
;

82 
__blkút64_t
 
	m¡_blocks
;

84 #ifdeà
__USE_XOPEN2K8


91 
time¥ec
 
	m¡_©im
;

92 
time¥ec
 
	m¡_mtim
;

93 
time¥ec
 
	m¡_ùim
;

94 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

95 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

96 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

98 
__time_t
 
	m¡_©ime
;

99 
__sysÿÎ_ulÚg_t
 
	m¡_©im’£c
;

100 
__time_t
 
	m¡_mtime
;

101 
__sysÿÎ_ulÚg_t
 
	m¡_mtim’£c
;

102 
__time_t
 
	m¡_ùime
;

103 
__sysÿÎ_ulÚg_t
 
	m¡_ùim’£c
;

105 #ifdeà
__x86_64__


106 
__sysÿÎ_¦Úg_t
 
	m__glibc_»£rved
[3];

108 #iâdeà
__USE_FILE_OFFSET64


109 
	m__glibc_»£rved4
;

110 
	m__glibc_»£rved5
;

112 
__šo64_t
 
	m¡_šo
;

117 #ifdeà
__USE_LARGEFILE64


119 
	s¡©64


121 
__dev_t
 
	m¡_dev
;

122 #ifdeà
__x86_64__


123 
__šo64_t
 
	m¡_šo
;

124 
__Æšk_t
 
	m¡_Æšk
;

125 
__mode_t
 
	m¡_mode
;

127 
	m__·d1
;

128 
__šo_t
 
	m__¡_šo
;

129 
__mode_t
 
	m¡_mode
;

130 
__Æšk_t
 
	m¡_Æšk
;

132 
__uid_t
 
	m¡_uid
;

133 
__gid_t
 
	m¡_gid
;

134 #ifdeà
__x86_64__


135 
	m__·d0
;

136 
__dev_t
 
	m¡_rdev
;

137 
__off_t
 
	m¡_size
;

139 
__dev_t
 
	m¡_rdev
;

140 
	m__·d2
;

141 
__off64_t
 
	m¡_size
;

143 
__blksize_t
 
	m¡_blksize
;

144 
__blkút64_t
 
	m¡_blocks
;

145 #ifdeà
__USE_XOPEN2K8


152 
time¥ec
 
	m¡_©im
;

153 
time¥ec
 
	m¡_mtim
;

154 
time¥ec
 
	m¡_ùim
;

156 
__time_t
 
	m¡_©ime
;

157 
__sysÿÎ_ulÚg_t
 
	m¡_©im’£c
;

158 
__time_t
 
	m¡_mtime
;

159 
__sysÿÎ_ulÚg_t
 
	m¡_mtim’£c
;

160 
__time_t
 
	m¡_ùime
;

161 
__sysÿÎ_ulÚg_t
 
	m¡_ùim’£c
;

163 #ifdeà
__x86_64__


164 
__sysÿÎ_¦Úg_t
 
	m__glibc_»£rved
[3];

166 
__šo64_t
 
	m¡_šo
;

172 
	#_STATBUF_ST_BLKSIZE


	)

173 
	#_STATBUF_ST_RDEV


	)

175 
	#_STATBUF_ST_NSEC


	)

179 
	#__S_IFMT
 0170000

	)

182 
	#__S_IFDIR
 0040000

	)

183 
	#__S_IFCHR
 0020000

	)

184 
	#__S_IFBLK
 0060000

	)

185 
	#__S_IFREG
 0100000

	)

186 
	#__S_IFIFO
 0010000

	)

187 
	#__S_IFLNK
 0120000

	)

188 
	#__S_IFSOCK
 0140000

	)

192 
	#__S_TYPEISMQ
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

193 
	#__S_TYPEISSEM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

194 
	#__S_TYPEISSHM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

198 
	#__S_ISUID
 04000

	)

199 
	#__S_ISGID
 02000

	)

200 
	#__S_ISVTX
 01000

	)

201 
	#__S_IREAD
 0400

	)

202 
	#__S_IWRITE
 0200

	)

203 
	#__S_IEXEC
 0100

	)

205 #ifdeà
__USE_ATFILE


206 
	#UTIME_NOW
 ((1È<< 30è- 1l)

	)

207 
	#UTIME_OMIT
 ((1È<< 30è- 2l)

	)

	@/usr/include/bits/stdio-ldbl.h

19 #iâdeà
_STDIO_H


23 
__BEGIN_NAMESPACE_STD


24 
	$__LDBL_REDIR_DECL
 (
årštf
)

25 
	$__LDBL_REDIR_DECL
 (
´štf
)

26 
	$__LDBL_REDIR_DECL
 (
¥rštf
)

27 
	$__LDBL_REDIR_DECL
 (
vårštf
)

28 
	$__LDBL_REDIR_DECL
 (
v´štf
)

29 
	$__LDBL_REDIR_DECL
 (
v¥rštf
)

30 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

31 && !
defšed
 
__REDIRECT
 \

32 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

33 
	$__LDBL_REDIR1_DECL
 (
fsÿnf
, 
__Ædbl___isoc99_fsÿnf
)

34 
	$__LDBL_REDIR1_DECL
 (
sÿnf
, 
__Ædbl___isoc99_sÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
ssÿnf
, 
__Ædbl___isoc99_ssÿnf
)

37 
	$__LDBL_REDIR_DECL
 (
fsÿnf
)

38 
	$__LDBL_REDIR_DECL
 (
sÿnf
)

39 
	$__LDBL_REDIR_DECL
 (
ssÿnf
)

41 
__END_NAMESPACE_STD


43 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


44 
__BEGIN_NAMESPACE_C99


45 
	$__LDBL_REDIR_DECL
 (
¢´štf
)

46 
	$__LDBL_REDIR_DECL
 (
v¢´štf
)

47 
__END_NAMESPACE_C99


50 #ifdef 
__USE_ISOC99


51 
__BEGIN_NAMESPACE_C99


52 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

53 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

54 
	$__LDBL_REDIR1_DECL
 (
vfsÿnf
, 
__Ædbl___isoc99_vfsÿnf
)

55 
	$__LDBL_REDIR1_DECL
 (
vsÿnf
, 
__Ædbl___isoc99_vsÿnf
)

56 
	$__LDBL_REDIR1_DECL
 (
vssÿnf
, 
__Ædbl___isoc99_vssÿnf
)

58 
	$__LDBL_REDIR_DECL
 (
vfsÿnf
)

59 
	$__LDBL_REDIR_DECL
 (
vssÿnf
)

60 
	$__LDBL_REDIR_DECL
 (
vsÿnf
)

62 
__END_NAMESPACE_C99


65 #ifdeà
__USE_XOPEN2K8


66 
	$__LDBL_REDIR_DECL
 (
vd´štf
)

67 
	$__LDBL_REDIR_DECL
 (
d´štf
)

70 #ifdeà
__USE_GNU


71 
	$__LDBL_REDIR_DECL
 (
va¥rštf
)

72 
	$__LDBL_REDIR_DECL
 (
__a¥rštf
)

73 
	$__LDBL_REDIR_DECL
 (
a¥rštf
)

74 
	$__LDBL_REDIR_DECL
 (
ob¡ack_´štf
)

75 
	$__LDBL_REDIR_DECL
 (
ob¡ack_v´štf
)

78 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


79 
	$__LDBL_REDIR_DECL
 (
__¥rštf_chk
)

80 
	$__LDBL_REDIR_DECL
 (
__v¥rštf_chk
)

81 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


82 
	$__LDBL_REDIR_DECL
 (
__¢´štf_chk
)

83 
	$__LDBL_REDIR_DECL
 (
__v¢´štf_chk
)

85 #ià
__USE_FORTIFY_LEVEL
 > 1

86 
	$__LDBL_REDIR_DECL
 (
__årštf_chk
)

87 
	$__LDBL_REDIR_DECL
 (
__´štf_chk
)

88 
	$__LDBL_REDIR_DECL
 (
__vårštf_chk
)

89 
	$__LDBL_REDIR_DECL
 (
__v´štf_chk
)

90 #ifdeà
__USE_XOPEN2K8


91 
	$__LDBL_REDIR_DECL
 (
__d´štf_chk
)

92 
	$__LDBL_REDIR_DECL
 (
__vd´štf_chk
)

94 #ifdeà
__USE_GNU


95 
	$__LDBL_REDIR_DECL
 (
__a¥rštf_chk
)

96 
	$__LDBL_REDIR_DECL
 (
__va¥rštf_chk
)

97 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_´štf_chk
)

98 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_v´štf_chk
)

	@/usr/include/bits/stdio.h

19 #iâdeà
_STDIO_H


23 #iâdeà
__ex‹º_šlše


24 
	#__STDIO_INLINE
 
šlše


	)

26 
	#__STDIO_INLINE
 
__ex‹º_šlše


	)

30 #ifdeà
__USE_EXTERN_INLINES


33 #ià!(
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
)

35 
__STDIO_INLINE
 

36 
	$v´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

38  
	`vårštf
 (
¡dout
, 
__fmt
, 
__¬g
);

39 
	}
}

43 
__STDIO_INLINE
 

44 
	$g‘ch¬
 ()

46  
	`_IO_g‘c
 (
¡dš
);

47 
	}
}

50 #ifdeà
__USE_MISC


52 
__STDIO_INLINE
 

53 
	$fg‘c_uÆocked
 (
FILE
 *
__å
)

55  
	`_IO_g‘c_uÆocked
 (
__å
);

56 
	}
}

60 #ifdeà
__USE_POSIX


62 
__STDIO_INLINE
 

63 
	$g‘c_uÆocked
 (
FILE
 *
__å
)

65  
	`_IO_g‘c_uÆocked
 (
__å
);

66 
	}
}

69 
__STDIO_INLINE
 

70 
	$g‘ch¬_uÆocked
 ()

72  
	`_IO_g‘c_uÆocked
 (
¡dš
);

73 
	}
}

78 
__STDIO_INLINE
 

79 
	$putch¬
 (
__c
)

81  
	`_IO_putc
 (
__c
, 
¡dout
);

82 
	}
}

85 #ifdeà
__USE_MISC


87 
__STDIO_INLINE
 

88 
	$åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

90  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

91 
	}
}

95 #ifdeà
__USE_POSIX


97 
__STDIO_INLINE
 

98 
	$putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

100  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

101 
	}
}

104 
__STDIO_INLINE
 

105 
	$putch¬_uÆocked
 (
__c
)

107  
	`_IO_putc_uÆocked
 (
__c
, 
¡dout
);

108 
	}
}

112 #ifdef 
__USE_GNU


114 
__STDIO_INLINE
 
_IO_ssize_t


115 
	$g‘lše
 (**
__lš•Œ
, 
size_t
 *
__n
, 
FILE
 *
__¡»am
)

117  
	`__g‘d–im
 (
__lš•Œ
, 
__n
, '\n', 
__¡»am
);

118 
	}
}

122 #ifdeà
__USE_MISC


124 
__STDIO_INLINE
 

125 
__NTH
 (
	$ãof_uÆocked
 (
FILE
 *
__¡»am
))

127  
	`_IO_ãof_uÆocked
 (
__¡»am
);

128 
	}
}

131 
__STDIO_INLINE
 

132 
__NTH
 (
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
))

134  
	`_IO_ã¼Ü_uÆocked
 (
__¡»am
);

135 
	}
}

141 #ià
defšed
 
__USE_MISC
 && defšed 
__GNUC__
 && defšed 
__OPTIMIZE__
 \

142 && !
defšed
 
	g__ılu¥lus


144 
	#ä—d_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

145 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

146 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

147 && (
size_t
è(
size
) != 0) \

148 ? ({ *
__±r
 = (*è(
±r
); \

149 
FILE
 *
__¡»am
 = (
¡»am
); \

150 
size_t
 
__út
; \

151 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

152 
__út
 > 0; --__cnt) \

154 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
); \

155 ià(
__c
 =ğ
EOF
) \

157 *
__±r
++ = 
__c
; \

159 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

160 / (
size_t
è(
size
); }) \

161 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

162 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

164 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

165 (è(
n
), (
size_t
) 0) \

166 : 
	`ä—d_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

168 
	#fwr™e_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

169 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

170 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

171 && (
size_t
è(
size
) != 0) \

172 ? ({ cÚ¡ *
__±r
 = (cÚ¡ *è(
±r
); \

173 
FILE
 *
__¡»am
 = (
¡»am
); \

174 
size_t
 
__út
; \

175 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

176 
__út
 > 0; --__cnt) \

177 ià(
	`_IO_putc_uÆocked
 (*
__±r
++, 
__¡»am
è=ğ
EOF
) \

179 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

180 / (
size_t
è(
size
); }) \

181 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

182 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

184 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

185 (è(
n
), (
size_t
) 0) \

186 : 
	`fwr™e_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

190 #undeà
__STDIO_INLINE


	@/usr/include/bits/stdio2.h

19 #iâdeà
_STDIO_H


23 
	$__¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

24 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

25 
	$__v¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

26 cÚ¡ *
__»¡riù
 
__fÜm©
,

27 
_G_va_li¡
 
__­
è
__THROW
;

29 #ifdeà
__va_¬g_·ck


30 
__fÜtify_funùiÚ
 

31 
	`__NTH
 (
	$¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fmt
, ...))

33  
	`__butš___¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

34 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

35 
	}
}

36 #–ià!
defšed
 
__ılu¥lus


37 
	#¥rštf
(
¡r
, ...) \

38 
	`__butš___¥rštf_chk
 (
¡r
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

39 
__VA_ARGS__
)

	)

42 
__fÜtify_funùiÚ
 

43 
__NTH
 (
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fmt
,

44 
_G_va_li¡
 
__­
))

46  
	`__butš___v¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

47 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

48 
	}
}

50 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


52 
	$__¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

53 
size_t
 
__¦’
, cÚ¡ *
__»¡riù
 
__fÜm©
,

54 ...è
__THROW
;

55 
	$__v¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

56 
size_t
 
__¦’
, cÚ¡ *
__»¡riù
 
__fÜm©
,

57 
_G_va_li¡
 
__­
è
__THROW
;

59 #ifdeà
__va_¬g_·ck


60 
__fÜtify_funùiÚ
 

61 
	`__NTH
 (
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

62 cÚ¡ *
__»¡riù
 
__fmt
, ...))

64  
	`__butš___¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

65 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

66 
	}
}

67 #–ià!
defšed
 
__ılu¥lus


68 
	#¢´štf
(
¡r
, 
Ën
, ...) \

69 
	`__butš___¢´štf_chk
 (
¡r
, 
Ën
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

70 
__VA_ARGS__
)

	)

73 
__fÜtify_funùiÚ
 

74 
__NTH
 (
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

75 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

77  
	`__butš___v¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

78 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

79 
	}
}

83 #ià
__USE_FORTIFY_LEVEL
 > 1

85 
__årštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

86 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

87 
__´štf_chk
 (
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

88 
__vårštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

89 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__­
);

90 
__v´štf_chk
 (
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
,

91 
_G_va_li¡
 
__­
);

93 #ifdeà
__va_¬g_·ck


94 
__fÜtify_funùiÚ
 

95 
	$årštf
 (
FILE
 *
__»¡riù
 
__¡»am
, cÚ¡ *__»¡riù 
__fmt
, ...)

97  
	`__årštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

98 
	`__va_¬g_·ck
 ());

99 
	}
}

101 
__fÜtify_funùiÚ
 

102 
	$´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, ...)

104  
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

105 
	}
}

106 #–ià!
defšed
 
__ılu¥lus


107 
	#´štf
(...) \

108 
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

109 
	#årštf
(
¡»am
, ...) \

110 
	`__årštf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

113 
__fÜtify_funùiÚ
 

114 
	$v´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

116 #ifdeà
__USE_EXTERN_INLINES


117  
	`__vårštf_chk
 (
¡dout
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

119  
	`__v´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

121 
	}
}

123 
__fÜtify_funùiÚ
 

124 
	$vårštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

125 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

127  
	`__vårštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

128 
	}
}

130 #ifdeà
__USE_XOPEN2K8


131 
	$__d´štf_chk
 (
__fd
, 
__æag
, cÚ¡ *
__»¡riù
 
__fmt
,

132 ...è
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

133 
	$__vd´štf_chk
 (
__fd
, 
__æag
,

134 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

135 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

137 #ifdeà
__va_¬g_·ck


138 
__fÜtify_funùiÚ
 

139 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

141  
	`__d´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

142 
	`__va_¬g_·ck
 ());

143 
	}
}

144 #–ià!
defšed
 
__ılu¥lus


145 
	#d´štf
(
fd
, ...) \

146 
	`__d´štf_chk
 (
fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

149 
__fÜtify_funùiÚ
 

150 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

152  
	`__vd´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

153 
	}
}

156 #ifdeà
__USE_GNU


158 
	$__a¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

159 cÚ¡ *
__»¡riù
 
__fmt
, ...)

160 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 4))è
__wur
;

161 
	$__va¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

162 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

163 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 0))è
__wur
;

164 
	$__ob¡ack_´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

165 
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
,

167 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

168 
	$__ob¡ack_v´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

169 
__æag
,

170 cÚ¡ *
__»¡riù
 
__fÜm©
,

171 
_G_va_li¡
 
__¬gs
)

172 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

174 #ifdeà
__va_¬g_·ck


175 
__fÜtify_funùiÚ
 

176 
	`__NTH
 (
	$a¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
, ...))

178  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

179 
	`__va_¬g_·ck
 ());

180 
	}
}

182 
__fÜtify_funùiÚ
 

183 
__NTH
 (
	$__a¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
,

186  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

187 
	`__va_¬g_·ck
 ());

188 
	}
}

190 
__fÜtify_funùiÚ
 

191 
__NTH
 (
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

192 cÚ¡ *
__»¡riù
 
__fmt
, ...))

194  
	`__ob¡ack_´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

195 
	`__va_¬g_·ck
 ());

196 
	}
}

197 #–ià!
defšed
 
__ılu¥lus


198 
	#a¥rštf
(
±r
, ...) \

199 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

200 
	#__a¥rštf
(
±r
, ...) \

201 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

202 
	#ob¡ack_´štf
(
ob¡ack
, ...) \

203 
	`__ob¡ack_´štf_chk
 (
ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

206 
__fÜtify_funùiÚ
 

207 
__NTH
 (
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
,

208 
_G_va_li¡
 
__­
))

210  
	`__va¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

211 
	}
}

213 
__fÜtify_funùiÚ
 

214 
__NTH
 (
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

215 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

217  
	`__ob¡ack_v´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

218 
__­
);

219 
	}
}

225 #ià!
defšed
 
__USE_ISOC11
 \

226 || (
defšed
 
	g__ılu¥lus
 && __ılu¥lu <ğ201103L && !defšed 
__USE_GNU
)

227 *
	$__g‘s_chk
 (*
__¡r
, 
size_t
è
__wur
;

228 *
	`__REDIRECT
 (
__g‘s_w¬n
, (*
__¡r
), 
g‘s
)

229 
__wur
 
	`__w¬Ç‰r
 ("please use fgets or getline instead, gets can't "

232 
__fÜtify_funùiÚ
 
__wur
 *

233 
	$g‘s
 (*
__¡r
)

235 ià(
	`__bos
 (
__¡r
è!ğ(
size_t
) -1)

236  
	`__g‘s_chk
 (
__¡r
, 
	`__bos
 (__str));

237  
	`__g‘s_w¬n
 (
__¡r
);

238 
	}
}

241 *
	$__fg‘s_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

242 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

243 *
	`__REDIRECT
 (
__fg‘s_®Ÿs
,

244 (*
__»¡riù
 
__s
, 
__n
,

245 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s
è
__wur
;

246 *
	`__REDIRECT
 (
__fg‘s_chk_w¬n
,

247 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_chk
)

249 
__wur
 
	`__w¬Ç‰r
 ("fgets called with bigger sizehan†ength "

252 
__fÜtify_funùiÚ
 
__wur
 *

253 
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

255 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

257 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

258  
	`__fg‘s_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

260 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

261  
	`__fg‘s_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

263  
	`__fg‘s_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

264 
	}
}

266 
size_t
 
	$__ä—d_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

267 
size_t
 
__size
, size_ˆ
__n
,

268 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

269 
size_t
 
	`__REDIRECT
 (
__ä—d_®Ÿs
,

270 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

271 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

272 
ä—d
è
__wur
;

273 
size_t
 
	`__REDIRECT
 (
__ä—d_chk_w¬n
,

274 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

275 
size_t
 
__size
, size_ˆ
__n
,

276 
FILE
 *
__»¡riù
 
__¡»am
),

277 
__ä—d_chk
)

278 
__wur
 
	`__w¬Ç‰r
 ("fread called with bigger size *‚membhan†ength "

281 
__fÜtify_funùiÚ
 
__wur
 
size_t


282 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

283 
FILE
 *
__»¡riù
 
__¡»am
)

285 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

287 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

288 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

289 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

290  
	`__ä—d_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

292 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

293  
	`__ä—d_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

295  
	`__ä—d_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

296 
	}
}

298 #ifdeà
__USE_GNU


299 *
	$__fg‘s_uÆocked_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
,

300 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

301 *
	`__REDIRECT
 (
__fg‘s_uÆocked_®Ÿs
,

302 (*
__»¡riù
 
__s
, 
__n
,

303 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s_uÆocked
è
__wur
;

304 *
	`__REDIRECT
 (
__fg‘s_uÆocked_chk_w¬n
,

305 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

306 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_uÆocked_chk
)

307 
__wur
 
	`__w¬Ç‰r
 ("fgets_unlocked called with bigger sizehan†ength "

310 
__fÜtify_funùiÚ
 
__wur
 *

311 
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

313 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

315 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

316  
	`__fg‘s_uÆocked_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

318 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

319  
	`__fg‘s_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

321  
	`__fg‘s_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

322 
	}
}

325 #ifdeà
__USE_MISC


326 #undeà
ä—d_uÆocked


327 
size_t
 
	$__ä—d_uÆocked_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

328 
size_t
 
__size
, size_ˆ
__n
,

329 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

330 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_®Ÿs
,

331 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

332 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

333 
ä—d_uÆocked
è
__wur
;

334 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_chk_w¬n
,

335 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

336 
size_t
 
__size
, size_ˆ
__n
,

337 
FILE
 *
__»¡riù
 
__¡»am
),

338 
__ä—d_uÆocked_chk
)

339 
__wur
 
	`__w¬Ç‰r
 ("fread_unlocked called with bigger size *‚membhan "

342 
__fÜtify_funùiÚ
 
__wur
 
size_t


343 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

344 
FILE
 *
__»¡riù
 
__¡»am
)

346 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

348 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

349 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

350 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

351  
	`__ä—d_uÆocked_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

352 
__¡»am
);

354 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

355  
	`__ä—d_uÆocked_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

356 
__¡»am
);

359 #ifdeà
__USE_EXTERN_INLINES


360 ià(
	`__butš_cÚ¡ªt_p
 (
__size
)

361 && 
	`__butš_cÚ¡ªt_p
 (
__n
)

362 && (
__size
 | 
__n
è< (((
size_t
) 1) << (8 *  (size_t) / 2))

363 && 
__size
 * 
__n
 <= 8)

365 
size_t
 
__út
 = 
__size
 * 
__n
;

366 *
__ıŒ
 = (*è
__±r
;

367 ià(
__út
 == 0)

370 ; 
__út
 > 0; --__cnt)

372 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
);

373 ià(
__c
 =ğ
EOF
)

375 *
__ıŒ
++ = 
__c
;

377  (
__ıŒ
 - (*è
__±r
è/ 
__size
;

380  
	`__ä—d_uÆocked_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

381 
	}
}

	@/usr/include/bits/stdio_lim.h

18 #ià!
defšed
 
_STDIO_H
 && !defšed 
__Ãed_FOPEN_MAX
 && !defšed 
__Ãed_IOV_MAX


22 #ifdeà
_STDIO_H


23 
	#L_tm²am
 20

	)

24 
	#TMP_MAX
 238328

	)

25 
	#FILENAME_MAX
 4096

	)

27 #ifdeà
__USE_POSIX


28 
	#L_ù”mid
 9

	)

29 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


30 
	#L_cu£rid
 9

	)

35 #ià
defšed
 
__Ãed_FOPEN_MAX
 || defšed 
_STDIO_H


36 #undeà
FOPEN_MAX


37 
	#FOPEN_MAX
 16

	)

40 #ià
defšed
 
__Ãed_IOV_MAX
 && !defšed 
IOV_MAX


41 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/stdlib-bsearch.h

19 
__ex‹º_šlše
 *

20 
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

21 
__com·r_â_t
 
__com·r
)

23 
size_t
 
__l
, 
__u
, 
__idx
;

24 cÚ¡ *
__p
;

25 
__com·risÚ
;

27 
__l
 = 0;

28 
__u
 = 
__nmemb
;

29 
__l
 < 
__u
)

31 
__idx
 = (
__l
 + 
__u
) / 2;

32 
__p
 = (*è(((cÚ¡ *è
__ba£
è+ (
__idx
 * 
__size
));

33 
__com·risÚ
 = (*
__com·r
è(
__key
, 
__p
);

34 ià(
__com·risÚ
 < 0)

35 
__u
 = 
__idx
;

36 ià(
__com·risÚ
 > 0)

37 
__l
 = 
__idx
 + 1;

39  (*è
__p
;

42  
NULL
;

43 
	}
}

	@/usr/include/bits/stdlib-float.h

19 #iâdeà
_STDLIB_H


23 #ifdeà
__USE_EXTERN_INLINES


24 
__BEGIN_NAMESPACE_STD


25 
__ex‹º_šlše
 

26 
__NTH
 (
	$©of
 (cÚ¡ *
__ÅŒ
))

28  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

29 
	}
}

30 
	g__END_NAMESPACE_STD


	@/usr/include/bits/stdlib-ldbl.h

19 #iâdeà
_STDLIB_H


23 #ifdef 
__USE_ISOC99


24 
__BEGIN_NAMESPACE_C99


25 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd
, 
¡¹od
)

26 
__END_NAMESPACE_C99


29 #ifdeà
__USE_GNU


30 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd_l
, 
¡¹od_l
)

33 #ifdeà
__USE_MISC


34 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

35 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

36 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

38 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

19 #iâdeà
_STDLIB_H


23 *
	$__»®·th_chk
 (cÚ¡ *
__»¡riù
 
__Çme
,

24 *
__»¡riù
 
__»sŞved
,

25 
size_t
 
__»sŞvedËn
è
__THROW
 
__wur
;

26 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

27 (cÚ¡ *
__»¡riù
 
__Çme
,

28 *
__»¡riù
 
__»sŞved
), 
»®·th
è
__wur
;

29 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

30 (cÚ¡ *
__»¡riù
 
__Çme
,

31 *
__»¡riù
 
__»sŞved
,

32 
size_t
 
__»sŞvedËn
), 
__»®·th_chk
è
__wur


33 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

36 
__fÜtify_funùiÚ
 
__wur
 *

37 
	`__NTH
 (
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
, *__»¡riù 
__»sŞved
))

39 ià(
	`__bos
 (
__»sŞved
è!ğ(
size_t
) -1)

41 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


42 ià(
	`__bos
 (
__»sŞved
è< 
PATH_MAX
)

43  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

45  
	`__»®·th_chk
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

48  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sŞved
);

49 
	}
}

52 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

53 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

54 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

55 
size_t
 
__buæ’
), 
±¢ame_r
)

56 
	`__nÚnuÎ
 ((2));

57 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

58 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

59 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

60 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

63 
__fÜtify_funùiÚ
 

64 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

66 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

68 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

69  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

70 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

71  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

73  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

74 
	}
}

77 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

78 
__THROW
 
__wur
;

79 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

80 
wùomb
è
__wur
;

82 
__fÜtify_funùiÚ
 
__wur
 

83 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

88 
	#__STDLIB_MB_LEN_MAX
 16

	)

89 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__STDLIB_MB_LEN_MAX


92 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

93  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

94  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

95 
	}
}

98 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

99 cÚ¡ *
__»¡riù
 
__¤c
,

100 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

101 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

102 (
wch¬_t
 *
__»¡riù
 
__d¡
,

103 cÚ¡ *
__»¡riù
 
__¤c
,

104 
size_t
 
__Ën
), 
mb¡owcs
);

105 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

106 (
wch¬_t
 *
__»¡riù
 
__d¡
,

107 cÚ¡ *
__»¡riù
 
__¤c
,

108 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

109 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

112 
__fÜtify_funùiÚ
 
size_t


113 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ *__»¡riù 
__¤c
,

114 
size_t
 
__Ën
))

116 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

118 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

119  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

120 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

122 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

123  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

124 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

126  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

127 
	}
}

130 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

131 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

132 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

133 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

134 (*
__»¡riù
 
__d¡
,

135 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

136 
size_t
 
__Ën
), 
wc¡ombs
);

137 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

138 (*
__»¡riù
 
__d¡
,

139 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

140 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

141 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

143 
__fÜtify_funùiÚ
 
size_t


144 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 *__»¡riù 
__¤c
,

145 
size_t
 
__Ën
))

147 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

149 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

150  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

151 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

152  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

154  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

155 
	}
}

	@/usr/include/bits/string.h

19 #iâdeà
_STRING_H


24 
	#_STRING_INLINE_uÇligÃd
 1

	)

27 
	#_HAVE_STRING_ARCH_mempıy
 1

	)

31 #ià!
defšed
 
__x86_64__
 && (defšed 
__i486__
 || defšed 
__³Áium__
 \

32 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

33 || 
defšed
 
	g__nocÚa__
 || defšed 
	g__©om__
 \

34 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__cÜei7__
 \

35 || 
defšed
 
	g__§ndybridge__
 || defšed 
	g__hasw–l__
 \

36 || 
defšed
 
	g__bÚÃÎ__
 || defšed 
	g__sv”mÚt__
 \

37 || 
defšed
 
	g__k6__
 || defšed 
	g__geode__
 \

38 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

39 || 
defšed
 
	g__amdçm10__
 || defšed 
	g__bdv”1__
 \

40 || 
defšed
 
	g__bdv”2__
 || defšed 
	g__bdv”3__
 \

41 || 
defšed
 
	g__bdv”4__
 || defšed 
	g__btv”1__
 \

42 || 
defšed
 
	g__btv”2__
)

46 #ià!
defšed
 
__NO_STRING_INLINES
 && defšed 
__USE_STRING_INLINES
 \

47 && 
defšed
 
	g__GNUC__
 && __GNUC__ >= 2

49 #iâdeà
__STRING_INLINE


50 #iâdeà
__ex‹º_šlše


51 
	#__STRING_INLINE
 
šlše


	)

53 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

58 
	#__STRING_SMALL_GET16
(
¤c
, 
idx
) \

59 ((((cÚ¡ *è(
¤c
))[
idx
 + 1] << 8) \

60 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

61 
	#__STRING_SMALL_GET32
(
¤c
, 
idx
) \

62 (((((cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

63 | ((cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

64 | ((cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

65 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

69 
	#_HAVE_STRING_ARCH_memıy
 1

	)

70 
	#memıy
(
de¡
, 
¤c
, 
n
) \

71 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

72 ? 
	`__memıy_c
 ((
de¡
), (
¤c
), (
n
)) \

73 : 
	`__memıy_g
 ((
de¡
), (
¤c
), (
n
))))

	)

74 
	#__memıy_c
(
de¡
, 
¤c
, 
n
) \

75 ((
n
) == 0 \

76 ? (
de¡
) \

77 : (((
n
) % 4 == 0) \

78 ? 
	`__memıy_by4
 (
de¡
, 
¤c
, 
n
) \

79 : (((
n
) % 2 == 0) \

80 ? 
	`__memıy_by2
 (
de¡
, 
¤c
, 
n
) \

81 : 
	`__memıy_g
 (
de¡
, 
¤c
, 
n
))))

	)

83 
__STRING_INLINE
 *
__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

84 
size_t
 
__n
);

86 
__STRING_INLINE
 *

87 
	$__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

89 
__d0
, 
__d1
;

90 *
__tmp
 = 
__de¡
;

91 
__asm__
 
__vŞ©e__


99 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

100 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 4)

102  
__de¡
;

103 
	}
}

105 
__STRING_INLINE
 *
__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

106 
size_t
 
__n
);

108 
__STRING_INLINE
 *

109 
	$__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

111 
__d0
, 
__d1
;

112 *
__tmp
 = 
__de¡
;

113 
__asm__
 
__vŞ©e__


126 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

127 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 2)

129  
__de¡
;

130 
	}
}

132 
__STRING_INLINE
 *
__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
);

134 
__STRING_INLINE
 *

135 
	$__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

137 
__d0
, 
__d1
, 
__d2
;

138 *
__tmp
 = 
__de¡
;

139 
__asm__
 
__vŞ©e__


150 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

151 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

152 : "0" (
__n
), "1" (
__tmp
), "2" (
__¤c
),

153 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
)

155  
__de¡
;

156 
	}
}

158 
	#_HAVE_STRING_ARCH_memmove
 1

	)

159 #iâdeà
_FORCE_INLINES


162 
	#memmove
(
de¡
, 
¤c
, 
n
è
	`__memmove_g
 (de¡, src,‚)

	)

164 
__STRING_INLINE
 *
	$__memmove_g
 (*, cÚ¡ *, 
size_t
)

165 
	`__asm__
 ("memmove");

167 
__STRING_INLINE
 *

168 
	$__memmove_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

170 
__d0
, 
__d1
, 
__d2
;

171 *
__tmp
 = 
__de¡
;

172 ià(
__de¡
 < 
__¤c
)

173 
__asm__
 
__vŞ©e__


176 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

177 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

178 : "0" (
__n
), "1" (
__¤c
), "2" (
__tmp
),

179 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

181 
__asm__
 
__vŞ©e__


187 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

188 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

189 : "0" (
__n
), "1" (__À+ (cÚ¡ *è
__¤c
),

190 "2" (
__n
 + (*è
__tmp
),

191 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

192  
__de¡
;

193 
	}
}

197 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

198 #iâdeà
_FORCE_INLINES


199 #iâdeà
__PIC__


201 
__STRING_INLINE
 

202 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

204 
__d0
, 
__d1
, 
__d2
;

205 
__»s
;

206 
__asm__
 
__vŞ©e__


214 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

215 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

216 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

217 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

219  
__»s
;

220 
	}
}

225 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

226 
	#_USE_STRING_ARCH_mem£t
 1

	)

227 
	#mem£t
(
s
, 
c
, 
n
) \

228 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

229 ? ((
n
) == 1 \

230 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

231 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

232 : (
	`__butš_cÚ¡ªt_p
 (
c
) \

233 ? (
	`__butš_cÚ¡ªt_p
 (
n
) \

234 ? 
	`__mem£t_cú
 ((
s
), (
c
), (
n
)) \

235 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

236 : (
	`__butš_cÚ¡ªt_p
 (
n
) \

237 ? 
	`__mem£t_gú
 ((
s
), (
c
), (
n
)) \

238 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

240 
	#__mem£t_c1
(
s
, 
c
è({ *
__s
 = (s); \

241 *((*è
__s
èğ(è(
c
); \

242 
__s
; })

	)

244 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

245 ({ *
__s
 = (
s
); \

247 
__ui
; \

248 
__usi
; \

249 
__uc
; \

250 } *
__u
 = 
__s
; \

251 
__c
 = ((è((è(
c
))) * 0x01010101; \

257 ià((
n
) == 3 || (n) >= 5) \

258 
__asm__
 
	`__vŞ©e__
 ("" : "ô" (
__c
) : "0" (__c)); \

261 
n
) \

264 
__u
->
__ui
 = 
__c
; \

265 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

267 
__u
->
__ui
 = 
__c
; \

268 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

270 
__u
->
__ui
 = 
__c
; \

271 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

273 
__u
->
__usi
 = (è
__c
; \

274 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

275 
__u
->
__uc
 = (è
__c
; \

279 
__u
->
__ui
 = 
__c
; \

280 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

285 
__u
->
__ui
 = 
__c
; \

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

288 
__u
->
__usi
 = (è
__c
; \

292 
__u
->
__ui
 = 
__c
; \

293 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

299 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

301 
__u
->
__uc
 = (è
__c
; \

305 
__u
->
__ui
 = 
__c
; \

306 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

308 
__u
->
__ui
 = 
__c
; \

309 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

311 
__u
->
__ui
 = 
__c
; \

312 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

314 
__u
->
__ui
 = 
__c
; \

319 
__s
; })

	)

321 
	#__mem£t_cú
(
s
, 
c
, 
n
) \

322 (((
n
) % 4 == 0) \

323 ? 
	`__mem£t_cú_by4
 (
s
, ((è((è(
c
))) * 0x01010101,\

324 
n
) \

325 : (((
n
) % 2 == 0) \

326 ? 
	`__mem£t_cú_by2
 (
s
, \

327 ((è((è(
c
))) * 0x01010101,\

328 
n
) \

329 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

331 
__STRING_INLINE
 *
__mem£t_cú_by4
 (*
__s
, 
__c
,

332 
size_t
 
__n
);

334 
__STRING_INLINE
 *

335 
	$__mem£t_cú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

337 *
__tmp
 = 
__s
;

338 
__d0
;

339 #ifdeà
__i686__


340 
__asm__
 
__vŞ©e__


343 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

344 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

345 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

348 
__asm__
 
__vŞ©e__


354 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

355 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

356 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

359  
__s
;

360 
	}
}

362 
__STRING_INLINE
 *
__mem£t_cú_by2
 (*
__s
, 
__c
,

363 
size_t
 
__n
);

365 
__STRING_INLINE
 *

366 
	$__mem£t_cú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

368 
__d0
, 
__d1
;

369 *
__tmp
 = 
__s
;

370 #ifdeà
__i686__


371 
__asm__
 
__vŞ©e__


375 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

376 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

377 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

380 
__asm__
 
__vŞ©e__


386 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

387 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

388 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

391  
__s
;

392 
	}
}

394 
	#__mem£t_gú
(
s
, 
c
, 
n
) \

395 (((
n
) % 4 == 0) \

396 ? 
	`__mem£t_gú_by4
 (
s
, 
c
, 
n
) \

397 : (((
n
) % 2 == 0) \

398 ? 
	`__mem£t_gú_by2
 (
s
, 
c
, 
n
) \

399 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

401 
__STRING_INLINE
 *
__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

403 
__STRING_INLINE
 *

404 
	$__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

406 *
__tmp
 = 
__s
;

407 
__d0
;

408 
__asm__
 
__vŞ©e__


418 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

419 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

420 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

422  
__s
;

423 
	}
}

425 
__STRING_INLINE
 *
__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

427 
__STRING_INLINE
 *

428 
	$__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

430 
__d0
, 
__d1
;

431 *
__tmp
 = 
__s
;

432 
__asm__
 
__vŞ©e__


443 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

444 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

445 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

447  
__s
;

448 
	}
}

452 
	#_HAVE_STRING_ARCH_memchr
 1

	)

453 #iâdeà
_FORCE_INLINES


454 
__STRING_INLINE
 *

455 
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

457 
__d0
;

458 #ifdeà
__i686__


459 
__d1
;

461 *
__»s
;

462 ià(
__n
 == 0)

463  
NULL
;

464 #ifdeà
__i686__


465 
__asm__
 
__vŞ©e__


469 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

470 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

471 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

474 
__asm__
 
__vŞ©e__


480 : "=D" (
__»s
), "=&c" (
__d0
)

481 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

482 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

485  
__»s
 - 1;

486 
	}
}

489 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

490 #iâdeà
_FORCE_INLINES


491 
__STRING_INLINE
 *
__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
);

493 
__STRING_INLINE
 *

494 
	$__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

496 
__d0
;

497 #ifdeà
__i686__


498 
__d1
;

500 *
__»s
;

501 ià(
__n
 == 0)

502  
NULL
;

503 #ifdeà
__i686__


504 
__asm__
 
__vŞ©e__


510 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

511 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

512 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

515 
__asm__
 
__vŞ©e__


522 : "=D" (
__»s
), "=&c" (
__d0
)

523 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

524 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

527  
__»s
;

528 
	}
}

529 #ifdeà
__USE_GNU


530 
	#memrchr
(
s
, 
c
, 
n
è
	`__memrchr
 ((s), (c), (n))

	)

535 
	#_HAVE_STRING_ARCH_¿wmemchr
 1

	)

536 
__STRING_INLINE
 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

538 #iâdeà
_FORCE_INLINES


539 
__STRING_INLINE
 *

540 
	$__¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

542 
__d0
;

543 *
__»s
;

544 
__asm__
 
__vŞ©e__


547 : "=D" (
__»s
), "=&c" (
__d0
)

548 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

549 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

551  
__»s
 - 1;

552 
	}
}

553 #ifdeà
__USE_GNU


554 
__STRING_INLINE
 *

555 
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

557  
	`__¿wmemchr
 (
__s
, 
__c
);

558 
	}
}

564 
	#_HAVE_STRING_ARCH_¡¾’
 1

	)

565 
	#¡¾’
(
¡r
) \

566 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¡r
) \

567 ? 
	`__butš_¡¾’
 (
¡r
) \

568 : 
	`__¡¾’_g
 (
¡r
)))

	)

569 
__STRING_INLINE
 
size_t
 
__¡¾’_g
 (cÚ¡ *
__¡r
);

571 
__STRING_INLINE
 
size_t


572 
	$__¡¾’_g
 (cÚ¡ *
__¡r
)

574 
__dummy
;

575 cÚ¡ *
__tmp
 = 
__¡r
;

576 
__asm__
 
__vŞ©e__


582 : "ô" (
__tmp
), "=&q" (
__dummy
)

583 : "0" (
__¡r
),

584 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¡r
)

586  
__tmp
 - 
__¡r
 - 1;

587 
	}
}

591 
	#_HAVE_STRING_ARCH_¡rıy
 1

	)

592 
	#¡rıy
(
de¡
, 
¤c
) \

593 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

594 ? ( ((
¤c
)[0]è=ğ1 && 
	`¡¾’
 (src) + 1 <= 8 \

595 ? 
	`__¡rıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

596 : (*è
	`memıy
 ((*è(
de¡
), \

597 (cÚ¡ *è(
¤c
), \

598 
	`¡¾’
 (
¤c
) + 1)) \

599 : 
	`__¡rıy_g
 ((
de¡
), (
¤c
))))

	)

601 
	#__¡rıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

602 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

604 
__ui
; \

605 
__usi
; \

606 
__uc
; \

607 
__c
; \

608 } *
__u
 = (*è
__de¡
; \

609 
¤ş’
) \

612 
__u
->
__uc
 = '\0'; \

615 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

618 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

619 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

620 
__u
->
__uc
 = '\0'; \

623 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

626 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

627 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

628 
__u
->
__uc
 = '\0'; \

631 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

632 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

633 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

636 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

637 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

638 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

639 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

640 
__u
->
__uc
 = '\0'; \

643 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

644 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

645 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

648 (*è
__de¡
; }))

	)

650 
__STRING_INLINE
 *
__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

652 
__STRING_INLINE
 *

653 
	$__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

655 *
__tmp
 = 
__de¡
;

656 
__dummy
;

657 
__asm__
 
__vŞ©e__


666 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

667 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

668 : "0" (
__¤c
), "1" (
__tmp
),

669 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

671  
__de¡
;

672 
	}
}

675 #ifdeà
__USE_GNU


676 
	#_HAVE_STRING_ARCH_¡pıy
 1

	)

678 
	#__¡pıy
(
de¡
, 
¤c
) \

679 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

680 ? (
	`¡¾’
 (
¤c
) + 1 <= 8 \

681 ? 
	`__¡pıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

682 : 
	`__¡pıy_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1)) \

683 : 
	`__¡pıy_g
 ((
de¡
), (
¤c
))))

	)

684 
	#__¡pıy_c
(
de¡
, 
¤c
, 
¤ş’
) \

685 ((
¤ş’
) % 4 == 0 \

686 ? 
	`__mempıy_by4
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

687 : ((
¤ş’
) % 2 == 0 \

688 ? 
	`__mempıy_by2
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

689 : 
	`__mempıy_byn
 (
de¡
, 
¤c
, 
¤ş’
è- 1))

	)

692 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 ((de¡), (¤c))

	)

694 
	#__¡pıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

695 (
	`__ex‹nsiÚ__
 ({ union { \

696 
__ui
; \

697 
__usi
; \

698 
__uc
; \

699 
__c
; \

700 } *
__u
 = (*è(
de¡
); \

701 
¤ş’
) \

704 
__u
->
__uc
 = '\0'; \

707 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

708 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

711 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

712 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

713 
__u
->
__uc
 = '\0'; \

716 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

717 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

720 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

721 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

722 
__u
->
__uc
 = '\0'; \

725 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

726 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

727 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

728 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

731 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

732 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

733 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

734 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

735 
__u
->
__uc
 = '\0'; \

738 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

739 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

740 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

741 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

744 (*è
__u
; }))

	)

746 
__STRING_INLINE
 *
__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

747 
size_t
 
__¤ş’
);

749 
__STRING_INLINE
 *

750 
	$__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

752 *
__tmp
 = 
__de¡
;

753 
__d0
, 
__d1
;

754 
__asm__
 
__vŞ©e__


762 : "=&r" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

763 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4)

765  
__tmp
;

766 
	}
}

768 
__STRING_INLINE
 *
__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

769 
size_t
 
__¤ş’
);

771 
__STRING_INLINE
 *

772 
	$__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

774 *
__tmp
 = 
__de¡
;

775 
__d0
, 
__d1
;

776 
__asm__
 
__vŞ©e__


789 : "=&q" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
),

790 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

791 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

792 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

794  
__tmp
 + 2;

795 
	}
}

797 
__STRING_INLINE
 *
__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
,

798 
size_t
 
__¤ş’
);

800 
__STRING_INLINE
 *

801 
	$__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

803 
__d0
, 
__d1
;

804 *
__tmp
 = 
__de¡
;

805 
__asm__
 
__vŞ©e__


816 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

817 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

818 : "0" (
__tmp
), "1" (
__¤ş’
), "2" (
__¤c
),

819 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

821  
__tmp
;

822 
	}
}

824 
__STRING_INLINE
 *
__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

826 
__STRING_INLINE
 *

827 
	$__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

829 *
__tmp
 = 
__de¡
;

830 
__dummy
;

831 
__asm__
 
__vŞ©e__


840 : "=&r" (
__¤c
), "ô" (
__tmp
), "=&q" (
__dummy
),

841 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

842 : "0" (
__¤c
), "1" (
__tmp
),

843 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

845  
__tmp
 - 1;

846 
	}
}

851 
	#_HAVE_STRING_ARCH_¡ºıy
 1

	)

852 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

853 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

854 ? ((
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

855 ? (*è
	`memıy
 ((*è(
de¡
), \

856 (cÚ¡ *è(
¤c
), 
n
) \

857 : 
	`__¡ºıy_cg
 ((
de¡
), (
¤c
), 
	`¡¾’
 (¤cè+ 1, 
n
))) \

858 : 
	`__¡ºıy_gg
 ((
de¡
), (
¤c
), 
n
)))

	)

859 
	#__¡ºıy_cg
(
de¡
, 
¤c
, 
¤ş’
, 
n
) \

860 (((
¤ş’
) % 4 == 0) \

861 ? 
	`__¡ºıy_by4
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

862 : (((
¤ş’
) % 2 == 0) \

863 ? 
	`__¡ºıy_by2
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

864 : 
	`__¡ºıy_byn
 (
de¡
, 
¤c
, 
¤ş’
, 
n
)))

	)

866 
__STRING_INLINE
 *
__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[],

867 
size_t
 
__¤ş’
, size_ˆ
__n
);

869 
__STRING_INLINE
 *

870 
	$__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

872 *
__tmp
 = 
__de¡
;

873 
__dummy1
, 
__dummy2
;

874 
__asm__
 
__vŞ©e__


882 : "=&r" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

883 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

884 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4),

885 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

887 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

888  
__de¡
;

889 
	}
}

891 
__STRING_INLINE
 *
__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[],

892 
size_t
 
__¤ş’
, size_ˆ
__n
);

894 
__STRING_INLINE
 *

895 
	$__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

897 *
__tmp
 = 
__de¡
;

898 
__dummy1
, 
__dummy2
;

899 
__asm__
 
__vŞ©e__


912 : "=&q" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

913 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

914 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

915 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

917 (è
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__¤ş’
);

918  
__de¡
;

919 
	}
}

921 
__STRING_INLINE
 *
__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[],

922 
size_t
 
__¤ş’
, size_ˆ
__n
);

924 
__STRING_INLINE
 *

925 
	$__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

927 
__d0
, 
__d1
;

928 *
__tmp
 = 
__de¡
;

929 
__asm__
 
__vŞ©e__


940 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

941 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

942 : "1" (
__¤ş’
), "0" (
__tmp
),"2" (
__¤c
),

943 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

945 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

946  
__de¡
;

947 
	}
}

949 
__STRING_INLINE
 *
__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
,

950 
size_t
 
__n
);

952 
__STRING_INLINE
 *

953 
	$__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

955 *
__tmp
 = 
__de¡
;

956 
__dummy
;

957 ià(
__n
 > 0)

958 
__asm__
 
__vŞ©e__


974 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

975 : "0" (
__¤c
), "1" (
__tmp
), "3" (
__n
)

978  
__de¡
;

979 
	}
}

983 
	#_HAVE_STRING_ARCH_¡rÿt
 1

	)

984 
	#¡rÿt
(
de¡
, 
¤c
) \

985 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

986 ? 
	`__¡rÿt_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

987 : 
	`__¡rÿt_g
 ((
de¡
), (
¤c
))))

	)

989 
__STRING_INLINE
 *
__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[],

990 
size_t
 
__¤ş’
);

992 
__STRING_INLINE
 *

993 
	$__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
)

995 #ifdeà
__i686__


996 
__d0
;

997 *
__tmp
;

998 
__asm__
 
__vŞ©e__


1000 : "=D" (
__tmp
), "=&c" (
__d0
),

1001 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1002 : "0" (
__de¡
), "1" (0xffffffff), "a" (0),

1003 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

1005 --
__tmp
;

1007 *
__tmp
 = 
__de¡
;

1008 
__asm__
 
__vŞ©e__


1014 : "ô" (
__tmp
),

1015 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1016 : "0" (
__tmp
),

1017 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

1020 (è
	`memıy
 (
__tmp
, 
__¤c
, 
__¤ş’
);

1021  
__de¡
;

1022 
	}
}

1024 
__STRING_INLINE
 *
__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
);

1026 
__STRING_INLINE
 *

1027 
	$__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
)

1029 *
__tmp
 = 
__de¡
;

1030 
__dummy
;

1031 
__asm__
 
__vŞ©e__


1044 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
),

1045 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1046 : "1" (
__tmp
), "2" (
__¤c
),

1047 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

1049  
__de¡
;

1050 
	}
}

1054 
	#_HAVE_STRING_ARCH_¡ºÿt
 1

	)

1055 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

1056 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

1057 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

1058 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

1059 ? 
	`¡rÿt
 (
__de¡
, (
¤c
)) \

1060 : (*(*)
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

1061 (cÚ¡ *è(
¤c
), \

1062 (
n
)èğ0, 
__de¡
)) \

1063 : 
	`__¡ºÿt_g
 (
__de¡
, (
¤c
), (
n
)); }))

	)

1065 
__STRING_INLINE
 *
__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[],

1066 
size_t
 
__n
);

1068 
__STRING_INLINE
 *

1069 
	$__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__n
)

1071 *
__tmp
 = 
__de¡
;

1072 
__dummy
;

1073 #ifdeà
__i686__


1074 
__asm__
 
__vŞ©e__


1088 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__¤c
), "=&c" (
__n
)

1089 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__¤c
), "3" (0xffffffff)

1092 --
__tmp
;

1093 
__asm__
 
__vŞ©e__


1110 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__n
)

1111 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
)

1114  
__de¡
;

1115 
	}
}

1119 
	#_HAVE_STRING_ARCH_¡rcmp
 1

	)

1120 
	#¡rcmp
(
s1
, 
s2
) \

1121 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

1122 && ( ((
s1
)[0]è!ğ1 || 
	`¡¾’
 (s1) >= 4) \

1123 && ( ((
s2
)[0]è!ğ1 || 
	`¡¾’
 (s2) >= 4) \

1124 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

1125 (
	`¡¾’
 (
s1
è< sŒËÀ(
s2
) \

1126 ? 
	`¡¾’
 (
s1
è: sŒËÀ(
s2
)) + 1) \

1127 : (
	`__butš_cÚ¡ªt_p
 (
s1
) &&  ((s1)[0]) == 1 \

1128 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (
s1
) < 4 \

1129 ? (
	`__butš_cÚ¡ªt_p
 (
s2
) &&  ((s2)[0]) == 1 \

1130 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1131 (cÚ¡ *è(
s2
), \

1132 
	`¡¾’
 (
s1
)) \

1133 : 
	`__¡rcmp_cg
 ((cÚ¡ *è(
s1
), \

1134 (cÚ¡ *è(
s2
), \

1135 
	`¡¾’
 (
s1
))) \

1136 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&&  ((
s1
)[0]) == 1 \

1137 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (s2) < 4 \

1138 ? (
	`__butš_cÚ¡ªt_p
 (
s1
) \

1139 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1140 (cÚ¡ *è(
s2
), \

1141 
	`¡¾’
 (
s2
)) \

1142 : 
	`__¡rcmp_gc
 ((cÚ¡ *è(
s1
), \

1143 (cÚ¡ *è(
s2
), \

1144 
	`¡¾’
 (
s2
))) \

1145 : 
	`__¡rcmp_gg
 ((
s1
), (
s2
))))))

	)

1147 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

1148 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = (
s1
)[0] - (
s2
)[0]; \

1149 ià(
l
 > 0 && 
__»suÉ
 == 0) \

1151 
__»suÉ
 = (
s1
)[1] - (
s2
)[1]; \

1152 ià(
l
 > 1 && 
__»suÉ
 == 0) \

1154 
__»suÉ
 = (
s1
)[2] - (
s2
)[2]; \

1155 ià(
l
 > 2 && 
__»suÉ
 == 0) \

1156 
__»suÉ
 = (
s1
)[3] - (
s2
)[3]; \

1159 
__»suÉ
; }))

	)

1161 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

1162 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = (
s2
); \

1163 
__»suÉ
 = (
s1
)[0] - 
__s2
[0]; \

1164 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

1166 
__»suÉ
 = (
s1
)[1] - 
__s2
[1]; \

1167 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

1169 
__»suÉ
 = (
s1
)[2] - 
__s2
[2]; \

1170 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

1171 
__»suÉ
 = (
s1
)[3] - 
__s2
[3]; \

1174 
__»suÉ
; }))

	)

1176 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

1177 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s1
 = (
s1
); \

1178 
__»suÉ
 = 
__s1
[0] - (
s2
)[0]; \

1179 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

1181 
__»suÉ
 = 
__s1
[1] - (
s2
)[1]; \

1182 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

1184 
__»suÉ
 = 
__s1
[2] - (
s2
)[2]; \

1185 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

1186 
__»suÉ
 = 
__s1
[3] - (
s2
)[3]; \

1189 
__»suÉ
; }))

	)

1191 
__STRING_INLINE
 
__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
);

1193 
__STRING_INLINE
 

1194 
	$__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

1196 
__»s
;

1197 
__asm__
 
__vŞ©e__


1213 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
)

1214 : "1" (
__s1
), "2" (
__s2
),

1215 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s1
),

1216 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s2
)

1218  
__»s
;

1219 
	}
}

1223 
	#_HAVE_STRING_ARCH_¡ºcmp
 1

	)

1224 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

1225 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`¡¾’
 (s1è< ((
size_t
è(
n
)) \

1226 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1227 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`¡¾’
 (s2è< ((
size_t
è(
n
))\

1228 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1229 : 
	`__¡ºcmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1231 
__STRING_INLINE
 
__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

1232 
size_t
 
__n
);

1234 
__STRING_INLINE
 

1235 
	$__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

1237 
__»s
;

1238 
__asm__
 
__vŞ©e__


1257 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1258 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1259 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

1260 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

1262  
__»s
;

1263 
	}
}

1267 
	#_HAVE_STRING_ARCH_¡rchr
 1

	)

1268 
	#_USE_STRING_ARCH_¡rchr
 1

	)

1269 
	#¡rchr
(
s
, 
c
) \

1270 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1271 ? ((
c
) == '\0' \

1272 ? (*è
	`__¿wmemchr
 ((
s
), (
c
)) \

1273 : 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1274 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1276 
__STRING_INLINE
 *
__¡rchr_c
 (cÚ¡ *
__s
, 
__c
);

1278 
__STRING_INLINE
 *

1279 
	$__¡rchr_c
 (cÚ¡ *
__s
, 
__c
)

1281 
__d0
;

1282 *
__»s
;

1283 
__asm__
 
__vŞ©e__


1293 : "ô" (
__»s
), "=&a" (
__d0
)

1294 : "0" (
__s
), "1" (
__c
),

1295 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1297  
__»s
;

1298 
	}
}

1300 
__STRING_INLINE
 *
__¡rchr_g
 (cÚ¡ *
__s
, 
__c
);

1302 
__STRING_INLINE
 *

1303 
	$__¡rchr_g
 (cÚ¡ *
__s
, 
__c
)

1305 
__d0
;

1306 *
__»s
;

1307 
__asm__
 
__vŞ©e__


1318 : "ô" (
__»s
), "=&a" (
__d0
)

1319 : "0" (
__s
), "1" (
__c
),

1320 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1322  
__»s
;

1323 
	}
}

1327 
	#_HAVE_STRING_ARCH_¡rchºul
 1

	)

1328 
	#__¡rchºul
(
s
, 
c
) \

1329 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1330 ? ((
c
) == '\0' \

1331 ? (*è
	`__¿wmemchr
 ((
s
), 
c
) \

1332 : 
	`__¡rchºul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1333 : 
	`__¡rchºul_g
 ((
s
), 
c
)))

	)

1335 
__STRING_INLINE
 *
__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
);

1337 
__STRING_INLINE
 *

1338 
	$__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
)

1340 
__d0
;

1341 *
__»s
;

1342 
__asm__
 
__vŞ©e__


1352 : "ô" (
__»s
), "=&a" (
__d0
)

1353 : "0" (
__s
), "1" (
__c
),

1354 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1356  
__»s
;

1357 
	}
}

1359 
__STRING_INLINE
 *
__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
);

1361 
__STRING_INLINE
 *

1362 
	$__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
)

1364 
__d0
;

1365 *
__»s
;

1366 
__asm__
 
__vŞ©e__


1377 : "ô" (
__»s
), "=&a" (
__d0
)

1378 : "0" (
__s
), "1" (
__c
),

1379 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1381  
__»s
;

1382 
	}
}

1383 #ifdeà
__USE_GNU


1384 
	#¡rchºul
(
s
, 
c
è
	`__¡rchºul
 ((s), (c))

	)

1388 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1390 
	#_HAVE_STRING_ARCH_šdex
 1

	)

1391 
	#šdex
(
s
, 
c
) \

1392 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1393 ? 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1394 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1399 
	#_HAVE_STRING_ARCH_¡¼chr
 1

	)

1400 
	#¡¼chr
(
s
, 
c
) \

1401 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1402 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1403 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1405 #ifdeà
__i686__


1406 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1408 
__STRING_INLINE
 *

1409 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1411 
__d0
, 
__d1
;

1412 *
__»s
;

1413 
__asm__
 
__vŞ©e__


1421 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1422 : "0" (1), "1" (
__s
), "2" (
__c
),

1423 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1425  
__»s
 - 1;

1426 
	}
}

1428 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1430 
__STRING_INLINE
 *

1431 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1433 
__d0
, 
__d1
;

1434 *
__»s
;

1435 
__asm__
 
__vŞ©e__


1444 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1445 : "0" (1), "1" (
__s
), "2" (
__c
),

1446 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1448  
__»s
 - 1;

1449 
	}
}

1451 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1453 
__STRING_INLINE
 *

1454 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1456 
__d0
, 
__d1
;

1457 *
__»s
;

1458 
__asm__
 
__vŞ©e__


1468 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1469 : "0" (0), "1" (
__s
), "2" (
__c
),

1470 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1472  
__»s
;

1473 
	}
}

1475 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1477 
__STRING_INLINE
 *

1478 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1480 
__d0
, 
__d1
;

1481 *
__»s
;

1482 
__asm__
 
__vŞ©e__


1493 : "ô" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1494 : "0" (0), "1" (
__s
), "2" (
__c
),

1495 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1497  
__»s
;

1498 
	}
}

1502 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1504 
	#_HAVE_STRING_ARCH_ršdex
 1

	)

1505 
	#ršdex
(
s
, 
c
) \

1506 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1507 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1508 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1514 
	#_HAVE_STRING_ARCH_¡rc¥n
 1

	)

1515 
	#¡rc¥n
(
s
, 
»jeù
) \

1516 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
»jeù
) &&  ((reject)[0]) == 1 \

1517 ? ((
»jeù
)[0] == '\0' \

1518 ? 
	`¡¾’
 (
s
) \

1519 : ((
»jeù
)[1] == '\0' \

1520 ? 
	`__¡rc¥n_c1
 ((
s
), (((
»jeù
)[0] << 8) & 0xff00)) \

1521 : 
	`__¡rc¥n_cg
 ((
s
), (
»jeù
), 
	`¡¾’
 (reject)))) \

1522 : 
	`__¡rc¥n_g
 ((
s
), (
»jeù
))))

	)

1524 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

1526 #iâdeà
_FORCE_INLINES


1527 
__STRING_INLINE
 
size_t


1528 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

1530 
__d0
;

1531 *
__»s
;

1532 
__asm__
 
__vŞ©e__


1541 : "ô" (
__»s
), "=&a" (
__d0
)

1542 : "0" (
__s
), "1" (
__»jeù
),

1543 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1545  (
__»s
 - 1è- 
__s
;

1546 
	}
}

1549 
__STRING_INLINE
 
size_t
 
__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[],

1550 
size_t
 
__»jeù_Ën
);

1552 
__STRING_INLINE
 
size_t


1553 
	$__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[], 
size_t
 
__»jeù_Ën
)

1555 
__d0
, 
__d1
, 
__d2
;

1556 cÚ¡ *
__»s
;

1557 
__asm__
 
__vŞ©e__


1568 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1569 : "0" (
__s
), "d" (
__»jeù
), "g" (
__»jeù_Ën
)

1571  (
__»s
 - 1è- 
__s
;

1572 
	}
}

1574 
__STRING_INLINE
 
size_t
 
__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
);

1575 #ifdeà
__PIC__


1577 
__STRING_INLINE
 
size_t


1578 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1580 
__d0
, 
__d1
, 
__d2
;

1581 cÚ¡ *
__»s
;

1582 
__asm__
 
__vŞ©e__


1599 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1600 : "r" (
__»jeù
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1602  (
__»s
 - 1è- 
__s
;

1603 
	}
}

1605 
__STRING_INLINE
 
size_t


1606 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1608 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1609 cÚ¡ *
__»s
;

1610 
__asm__
 
__vŞ©e__


1624 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1625 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__»jeù
), "b" (__reject)

1628  (
__»s
 - 1è- 
__s
;

1629 
	}
}

1635 
	#_HAVE_STRING_ARCH_¡r¥n
 1

	)

1636 
	#¡r¥n
(
s
, 
acû±
) \

1637 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1638 ? ((
acû±
)[0] == '\0' \

1639 ? ((è(
s
), 0) \

1640 : ((
acû±
)[1] == '\0' \

1641 ? 
	`__¡r¥n_c1
 ((
s
), (((
acû±
)[0] << 8 ) & 0xff00)) \

1642 : 
	`__¡r¥n_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1643 : 
	`__¡r¥n_g
 ((
s
), (
acû±
))))

	)

1645 #iâdeà
_FORCE_INLINES


1646 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1648 
__STRING_INLINE
 
size_t


1649 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1651 
__d0
;

1652 *
__»s
;

1654 
__asm__
 
__vŞ©e__


1660 : "ô" (
__»s
), "=&q" (
__d0
)

1661 : "0" (
__s
), "1" (
__acû±
),

1662 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1664  (
__»s
 - 1è- 
__s
;

1665 
	}
}

1668 
__STRING_INLINE
 
size_t
 
__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1669 
size_t
 
__acû±_Ën
);

1671 
__STRING_INLINE
 
size_t


1672 
	$__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1674 
__d0
, 
__d1
, 
__d2
;

1675 cÚ¡ *
__»s
;

1676 
__asm__
 
__vŞ©e__


1687 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1688 : "0" (
__s
), "g" (
__acû±
), "g" (
__acû±_Ën
),

1691 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
),

1692 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__acû±_Ën
]; } *)
__acû±
)

1694  (
__»s
 - 1è- 
__s
;

1695 
	}
}

1697 
__STRING_INLINE
 
size_t
 
__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1698 #ifdeà
__PIC__


1700 
__STRING_INLINE
 
size_t


1701 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1703 
__d0
, 
__d1
, 
__d2
;

1704 cÚ¡ *
__»s
;

1705 
__asm__
 
__vŞ©e__


1721 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1722 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1724  (
__»s
 - 1è- 
__s
;

1725 
	}
}

1727 
__STRING_INLINE
 
size_t


1728 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1730 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1731 cÚ¡ *
__»s
;

1732 
__asm__
 
__vŞ©e__


1746 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1747 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__acû±
), "b" (__accept)

1749  (
__»s
 - 1è- 
__s
;

1750 
	}
}

1755 
	#_HAVE_STRING_ARCH_¡½brk
 1

	)

1756 
	#¡½brk
(
s
, 
acû±
) \

1757 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1758 ? ((
acû±
)[0] == '\0' \

1759 ? ((è(
s
), (*) 0) \

1760 : ((
acû±
)[1] == '\0' \

1761 ? 
	`¡rchr
 ((
s
), (
acû±
)[0]) \

1762 : 
	`__¡½brk_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1763 : 
	`__¡½brk_g
 ((
s
), (
acû±
))))

	)

1765 
__STRING_INLINE
 *
__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1766 
size_t
 
__acû±_Ën
);

1768 
__STRING_INLINE
 *

1769 
	$__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1771 
__d0
, 
__d1
, 
__d2
;

1772 *
__»s
;

1773 
__asm__
 
__vŞ©e__


1788 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1789 : "0" (
__s
), "d" (
__acû±
), "g" (
__acû±_Ën
)

1791  
__»s
;

1792 
	}
}

1794 
__STRING_INLINE
 *
__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1795 #ifdeà
__PIC__


1797 
__STRING_INLINE
 *

1798 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1800 
__d0
, 
__d1
, 
__d2
;

1801 *
__»s
;

1802 
__asm__
 
__vŞ©e__


1823 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1824 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1826  
__»s
;

1827 
	}
}

1829 
__STRING_INLINE
 *

1830 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1832 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1833 *
__»s
;

1834 
__asm__
 
__vŞ©e__


1853 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1854 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__acû±
)

1856  
__»s
;

1857 
	}
}

1862 
	#_HAVE_STRING_ARCH_¡r¡r
 1

	)

1863 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1864 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
) &&  ((needle)[0]) == 1 \

1865 ? ((
ÃedË
)[0] == '\0' \

1866 ? (
hay¡ack
) \

1867 : ((
ÃedË
)[1] == '\0' \

1868 ? 
	`¡rchr
 ((
hay¡ack
), (
ÃedË
)[0]) \

1869 : 
	`__¡r¡r_cg
 ((
hay¡ack
), (
ÃedË
), \

1870 
	`¡¾’
 (
ÃedË
)))) \

1871 : 
	`__¡r¡r_g
 ((
hay¡ack
), (
ÃedË
))))

	)

1875 
__STRING_INLINE
 *
__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
,

1876 cÚ¡ 
__ÃedË
[],

1877 
size_t
 
__ÃedË_Ën
);

1879 
__STRING_INLINE
 *

1880 
	$__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
, cÚ¡ 
__ÃedË
[],

1881 
size_t
 
__ÃedË_Ën
)

1883 
__d0
, 
__d1
, 
__d2
;

1884 *
__»s
;

1885 
__asm__
 
__vŞ©e__


1898 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1899 : "g" (
__ÃedË_Ën
), "1" (
__hay¡ack
), "d" (
__ÃedË
)

1901  
__»s
;

1902 
	}
}

1904 
__STRING_INLINE
 *
__¡r¡r_g
 (cÚ¡ *
__hay¡ack
,

1905 cÚ¡ *
__ÃedË
);

1906 #ifdeà
__PIC__


1908 
__STRING_INLINE
 *

1909 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1911 
__d0
, 
__d1
, 
__d2
;

1912 *
__»s
;

1913 
__asm__
 
__vŞ©e__


1932 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1933 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1934 "d" (
__ÃedË
)

1936  
__»s
;

1937 
	}
}

1939 
__STRING_INLINE
 *

1940 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1942 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1943 *
__»s
;

1944 
__asm__
 
__vŞ©e__


1961 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1962 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1963 "b" (
__ÃedË
)

1965  
__»s
;

1966 
	}
}

1972 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1973 #ifdeà
__i686__


1974 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1975 
	#ffs
(
wÜd
è(
	`__butš_cÚ¡ªt_p
 (word) \

1976 ? 
	`__butš_ffs
 (
wÜd
) \

1977 : ({ 
__út
, 
__tmp
; \

1978 
__asm__
 
__vŞ©e__
 \

1981 : "=&r" (
__út
), "ô" (
__tmp
) \

1982 : "rm" (
wÜd
), "1" (-1)); \

1983 
__út
 + 1; }))

	)

1985 #iâdeà
ff¦


1986 
	#ff¦
(
wÜd
è
	`ffs
(wÜd)

	)

1991 #iâdeà
_FORCE_INLINES


1992 #undeà
__STRING_INLINE


	@/usr/include/bits/string2.h

20 #iâdeà
_STRING_H


24 #iâdeà
__NO_STRING_INLINES


41 #iâdeà
__STRING_INLINE


42 #ifdeà
__ılu¥lus


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

49 #ià
_STRING_INLINE_uÇligÃd


51 
	~<’dŸn.h
>

52 
	~<b™s/ty³s.h
>

54 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


55 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

56 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1] << 8 \

57 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

58 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

59 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

60 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

61 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

62 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

64 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

65 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

66 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1])

	)

67 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

68 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

69 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

70 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

71 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3])

	)

76 
	#__STRING2_COPY_TYPE
(
N
) \

77 ¡ruù { 
__¬r
[
N
]; } \

78 
	t__©Œibu‹__
 ((
	t__·cked__
)è
	t__STRING2_COPY_ARR
##
	tN


	)

79 
	t__STRING2_COPY_TYPE
 (2);

80 
__STRING2_COPY_TYPE
 (3);

81 
__STRING2_COPY_TYPE
 (4);

82 
__STRING2_COPY_TYPE
 (5);

83 
__STRING2_COPY_TYPE
 (6);

84 
__STRING2_COPY_TYPE
 (7);

85 
__STRING2_COPY_TYPE
 (8);

86 #undeà
__STRING2_COPY_TYPE


92 
	#__¡ršg2_1b±r_p
(
__x
) \

93 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ğ1)

	)

96 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


97 #ià!
__GNUC_PREREQ
 (3, 0)

98 #ià
_STRING_INLINE_uÇligÃd


99 
	#mem£t
(
s
, 
c
, 
n
) \

100 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

101 ? ((
n
) == 1 \

102 ? 
	`__mem£t_1
 (
s
, 
c
) \

103 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

104 : (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

105 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

106 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

108 
	#__mem£t_1
(
s
, 
c
è({ *
__s
 = (s); \

109 *((
__ušt8_t
 *è
__s
èğ(__ušt8_tè
c
; __s; })

	)

111 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

112 ({ *
__s
 = (
s
); \

114 
__ui
; \

115 
__usi
; \

116 
__uc
; \

117 } *
__u
 = 
__s
; \

118 
__ušt8_t
 
__c
 = (__ušt8_tè(
c
); \

121 (è(
n
)) \

124 
__u
->
__ui
 = 
__c
 * 0x01010101; \

125 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

127 
__u
->
__ui
 = 
__c
 * 0x01010101; \

128 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

130 
__u
->
__ui
 = 
__c
 * 0x01010101; \

131 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

133 
__u
->
__usi
 = (è
__c
 * 0x0101; \

134 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

135 
__u
->
__uc
 = (è
__c
; \

139 
__u
->
__ui
 = 
__c
 * 0x01010101; \

140 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

142 
__u
->
__ui
 = 
__c
 * 0x01010101; \

143 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

145 
__u
->
__ui
 = 
__c
 * 0x01010101; \

146 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

148 
__u
->
__usi
 = (è
__c
 * 0x0101; \

152 
__u
->
__ui
 = 
__c
 * 0x01010101; \

153 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

155 
__u
->
__ui
 = 
__c
 * 0x01010101; \

156 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

158 
__u
->
__ui
 = 
__c
 * 0x01010101; \

159 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

161 
__u
->
__uc
 = (è
__c
; \

165 
__u
->
__ui
 = 
__c
 * 0x01010101; \

166 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

168 
__u
->
__ui
 = 
__c
 * 0x01010101; \

169 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

171 
__u
->
__ui
 = 
__c
 * 0x01010101; \

172 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

174 
__u
->
__ui
 = 
__c
 * 0x01010101; \

179 
__s
; })

	)

181 
	#mem£t
(
s
, 
c
, 
n
) \

182 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

183 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

184 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

193 #ià
__GNUC_PREREQ
 (2, 91)

194 
	#__bz”o
(
s
, 
n
è
	`__butš_mem£t
 (s, '\0',‚)

	)

202 #ifdeà
__USE_GNU


203 #ià!
defšed
 
_HAVE_STRING_ARCH_mempıy
 || defšed 
_FORCE_INLINES


204 #iâdeà
_HAVE_STRING_ARCH_mempıy


205 #ià
__GNUC_PREREQ
 (3, 4)

206 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__butš_mempıy
 (de¡, src,‚)

	)

207 #–ià
__GNUC_PREREQ
 (3, 0)

208 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

209 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

210 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

211 ? 
	`__butš_memıy
 (
de¡
, 
¤c
, 
n
) + (n) \

212 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

214 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

215 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

216 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

217 ? 
	`__mempıy_sm®l
 (
de¡
, 
	`__mempıy_¬gs
 (
¤c
), 
n
) \

218 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

222 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy
 (de¡, src,‚)

	)

225 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


226 #ià
_STRING_INLINE_uÇligÃd


227 #iâdeà
_FORCE_INLINES


228 
	#__mempıy_¬gs
(
¤c
) \

229 ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[2], \

230 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[6], \

231 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

232 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

233 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

234 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

236 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , , , ,

237 
__ušt16_t
, __ušt16_t, 
__ušt32_t
,

238 
__ušt32_t
, 
size_t
);

239 
__STRING_INLINE
 *

240 
	$__mempıy_sm®l
 (*
__de¡1
,

241 
__¤c0_1
, 
__¤c2_1
, 
__¤c4_1
, 
__¤c6_1
,

242 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

243 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

244 
size_t
 
__¤ş’
)

247 
__ušt32_t
 
__ui
;

248 
__ušt16_t
 
__usi
;

249 
__uc
;

250 
__c
;

251 } *
__u
 = 
__de¡1
;

252 (è
__¤ş’
)

255 
__u
->
__c
 = 
__¤c0_1
;

256 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

259 
__u
->
__usi
 = 
__¤c0_2
;

260 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

263 
__u
->
__usi
 = 
__¤c0_2
;

264 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

265 
__u
->
__c
 = 
__¤c2_1
;

266 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

269 
__u
->
__ui
 = 
__¤c0_4
;

270 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

273 
__u
->
__ui
 = 
__¤c0_4
;

274 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

275 
__u
->
__c
 = 
__¤c4_1
;

276 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

279 
__u
->
__ui
 = 
__¤c0_4
;

280 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

281 
__u
->
__usi
 = 
__¤c4_2
;

282 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

285 
__u
->
__ui
 = 
__¤c0_4
;

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

287 
__u
->
__usi
 = 
__¤c4_2
;

288 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

289 
__u
->
__c
 = 
__¤c6_1
;

290 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

293 
__u
->
__ui
 = 
__¤c0_4
;

294 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

295 
__u
->
__ui
 = 
__¤c4_4
;

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

299  (*è
__u
;

300 
	}
}

302 #iâdeà
_FORCE_INLINES


303 
	#__mempıy_¬gs
(
¤c
) \

304 ((cÚ¡ *è(
¤c
))[0], \

305 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

306 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1] } }), \

307 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

308 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

309 ((cÚ¡ *è(
¤c
))[2] } }), \

310 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

311 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

312 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3] } }), \

313 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

314 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

315 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

316 ((cÚ¡ *è(
¤c
))[4] } }), \

317 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

318 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

319 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

320 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5] } }), \

321 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

322 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

323 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

324 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

325 ((cÚ¡ *è(
¤c
))[6] } }), \

326 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

327 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

328 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

329 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

330 ((cÚ¡ *è(
¤c
))[6], ((cÚ¡ *è(¤c))[7] } })

	)

332 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , 
__STRING2_COPY_ARR2
,

333 
__STRING2_COPY_ARR3
,

334 
__STRING2_COPY_ARR4
,

335 
__STRING2_COPY_ARR5
,

336 
__STRING2_COPY_ARR6
,

337 
__STRING2_COPY_ARR7
,

338 
__STRING2_COPY_ARR8
, 
size_t
);

339 
__STRING_INLINE
 *

340 
	$__mempıy_sm®l
 (*
__de¡
, 
__¤c1
,

341 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

342 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

343 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

344 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

347 
__c
;

348 
__STRING2_COPY_ARR2
 
__sÿ2
;

349 
__STRING2_COPY_ARR3
 
__sÿ3
;

350 
__STRING2_COPY_ARR4
 
__sÿ4
;

351 
__STRING2_COPY_ARR5
 
__sÿ5
;

352 
__STRING2_COPY_ARR6
 
__sÿ6
;

353 
__STRING2_COPY_ARR7
 
__sÿ7
;

354 
__STRING2_COPY_ARR8
 
__sÿ8
;

355 } *
__u
 = 
__de¡
;

356 (è
__¤ş’
)

359 
__u
->
__c
 = 
__¤c1
;

362 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

365 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

368 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

371 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

374 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

377 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

380 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

383  
	`__ex‹nsiÚ__
 ((*è
__u
 + 
__¤ş’
);

384 
	}
}

392 #iâdeà
_HAVE_STRING_ARCH_¡rchr


393 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

394 #ià
__GNUC_PREREQ
 (3, 2)

395 
	#¡rchr
(
s
, 
c
) \

396 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
è&& !__butš_cÚ¡ªt_°(
s
) \

397 && (
c
) == '\0' \

398 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

399 : 
	`__butš_¡rchr
 (
s
, 
c
)))

	)

401 
	#¡rchr
(
s
, 
c
) \

402 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

403 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

404 : 
	`¡rchr
 (
s
, 
c
)))

	)

410 #ià(!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)) \

411 || 
defšed
 
	g_FORCE_INLINES


412 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)

413 
	#¡rıy
(
de¡
, 
¤c
) \

414 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

415 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

416 ? 
	`__¡rıy_sm®l
 (
de¡
, 
	`__¡rıy_¬gs
 (
¤c
), \

417 
	`¡¾’
 (
¤c
) + 1) \

418 : (*è
	`memıy
 (
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1)) \

419 : 
	`¡rıy
 (
de¡
, 
¤c
)))

	)

422 #ià
_STRING_INLINE_uÇligÃd


423 #iâdeà
_FORCE_INLINES


424 
	#__¡rıy_¬gs
(
¤c
) \

425 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

426 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

427 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

428 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

430 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

431 
__ušt32_t
, __ušt32_t, 
size_t
);

432 
__STRING_INLINE
 *

433 
	$__¡rıy_sm®l
 (*
__de¡
,

434 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

435 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

436 
size_t
 
__¤ş’
)

439 
__ušt32_t
 
__ui
;

440 
__ušt16_t
 
__usi
;

441 
__uc
;

442 } *
__u
 = (*è
__de¡
;

443 (è
__¤ş’
)

446 
__u
->
__uc
 = '\0';

449 
__u
->
__usi
 = 
__¤c0_2
;

452 
__u
->
__usi
 = 
__¤c0_2
;

453 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

454 
__u
->
__uc
 = '\0';

457 
__u
->
__ui
 = 
__¤c0_4
;

460 
__u
->
__ui
 = 
__¤c0_4
;

461 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

462 
__u
->
__uc
 = '\0';

465 
__u
->
__ui
 = 
__¤c0_4
;

466 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

467 
__u
->
__usi
 = 
__¤c4_2
;

470 
__u
->
__ui
 = 
__¤c0_4
;

471 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

472 
__u
->
__usi
 = 
__¤c4_2
;

473 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

474 
__u
->
__uc
 = '\0';

477 
__u
->
__ui
 = 
__¤c0_4
;

478 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

479 
__u
->
__ui
 = 
__¤c4_4
;

482  
__de¡
;

483 
	}
}

485 #iâdeà
_FORCE_INLINES


486 
	#__¡rıy_¬gs
(
¤c
) \

487 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

488 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

489 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

490 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

492 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

493 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

494 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

495 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

496 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

497 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

499 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

500 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

501 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

502 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

503 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

504 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

505 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

506 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

508 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

509 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

510 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

511 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

512 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

514 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

515 
__STRING2_COPY_ARR3
,

516 
__STRING2_COPY_ARR4
,

517 
__STRING2_COPY_ARR5
,

518 
__STRING2_COPY_ARR6
,

519 
__STRING2_COPY_ARR7
,

520 
__STRING2_COPY_ARR8
, 
size_t
);

521 
__STRING_INLINE
 *

522 
	$__¡rıy_sm®l
 (*
__de¡
,

523 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

524 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

525 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

526 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

529 
__c
;

530 
__STRING2_COPY_ARR2
 
__sÿ2
;

531 
__STRING2_COPY_ARR3
 
__sÿ3
;

532 
__STRING2_COPY_ARR4
 
__sÿ4
;

533 
__STRING2_COPY_ARR5
 
__sÿ5
;

534 
__STRING2_COPY_ARR6
 
__sÿ6
;

535 
__STRING2_COPY_ARR7
 
__sÿ7
;

536 
__STRING2_COPY_ARR8
 
__sÿ8
;

537 } *
__u
 = (*è
__de¡
;

538 (è
__¤ş’
)

541 
__u
->
__c
 = '\0';

544 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

547 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

550 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

553 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

556 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

559 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

562 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

565  
__de¡
;

566 
	}
}

572 #ifdeà
__USE_GNU


573 #ià!
defšed
 
_HAVE_STRING_ARCH_¡pıy
 || defšed 
_FORCE_INLINES


574 #iâdeà
_HAVE_STRING_ARCH_¡pıy


575 #ià
__GNUC_PREREQ
 (3, 4)

576 
	#__¡pıy
(
de¡
, 
¤c
è
	`__butš_¡pıy
 (de¡, src)

	)

577 #–ià
__GNUC_PREREQ
 (3, 0)

578 
	#__¡pıy
(
de¡
, 
¤c
) \

579 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

580 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

581 ? 
	`__butš_¡rıy
 (
de¡
, 
¤c
è+ 
	`¡¾’
 (src) \

582 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

584 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

586 
	#__¡pıy
(
de¡
, 
¤c
) \

587 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

588 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

589 ? 
	`__¡pıy_sm®l
 (
de¡
, 
	`__¡pıy_¬gs
 (
¤c
), \

590 
	`¡¾’
 (
¤c
) + 1) \

591 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

593 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

597 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 (de¡, src)

	)

600 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


601 #ià
_STRING_INLINE_uÇligÃd


602 #iâdeà
_FORCE_INLINES


603 
	#__¡pıy_¬gs
(
¤c
) \

604 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

605 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

606 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

607 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

609 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

610 
__ušt32_t
, __ušt32_t, 
size_t
);

611 
__STRING_INLINE
 *

612 
	$__¡pıy_sm®l
 (*
__de¡
,

613 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

614 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

615 
size_t
 
__¤ş’
)

618 
__ui
;

619 
__usi
;

620 
__uc
;

621 
__c
;

622 } *
__u
 = (*è
__de¡
;

623 (è
__¤ş’
)

626 
__u
->
__uc
 = '\0';

629 
__u
->
__usi
 = 
__¤c0_2
;

630 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

633 
__u
->
__usi
 = 
__¤c0_2
;

634 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

635 
__u
->
__uc
 = '\0';

638 
__u
->
__ui
 = 
__¤c0_4
;

639 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

642 
__u
->
__ui
 = 
__¤c0_4
;

643 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

644 
__u
->
__uc
 = '\0';

647 
__u
->
__ui
 = 
__¤c0_4
;

648 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

649 
__u
->
__usi
 = 
__¤c4_2
;

650 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

653 
__u
->
__ui
 = 
__¤c0_4
;

654 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

655 
__u
->
__usi
 = 
__¤c4_2
;

656 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

657 
__u
->
__uc
 = '\0';

660 
__u
->
__ui
 = 
__¤c0_4
;

661 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

662 
__u
->
__ui
 = 
__¤c4_4
;

663 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

666  &
__u
->
__c
;

667 
	}
}

669 #iâdeà
_FORCE_INLINES


670 
	#__¡pıy_¬gs
(
¤c
) \

671 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

672 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

673 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

674 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

676 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

677 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

678 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

679 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

680 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

681 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

683 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

684 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

685 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

686 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

687 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

688 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

689 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

690 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

692 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

693 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

694 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

695 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

696 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

698 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

699 
__STRING2_COPY_ARR3
,

700 
__STRING2_COPY_ARR4
,

701 
__STRING2_COPY_ARR5
,

702 
__STRING2_COPY_ARR6
,

703 
__STRING2_COPY_ARR7
,

704 
__STRING2_COPY_ARR8
, 
size_t
);

705 
__STRING_INLINE
 *

706 
	$__¡pıy_sm®l
 (*
__de¡
,

707 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

708 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

709 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

710 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

713 
__c
;

714 
__STRING2_COPY_ARR2
 
__sÿ2
;

715 
__STRING2_COPY_ARR3
 
__sÿ3
;

716 
__STRING2_COPY_ARR4
 
__sÿ4
;

717 
__STRING2_COPY_ARR5
 
__sÿ5
;

718 
__STRING2_COPY_ARR6
 
__sÿ6
;

719 
__STRING2_COPY_ARR7
 
__sÿ7
;

720 
__STRING2_COPY_ARR8
 
__sÿ8
;

721 } *
__u
 = (*è
__de¡
;

722 (è
__¤ş’
)

725 
__u
->
__c
 = '\0';

728 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

731 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

734 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

737 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

740 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

743 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

746 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

749  
__de¡
 + 
__¤ş’
 - 1;

750 
	}
}

758 #iâdeà
_HAVE_STRING_ARCH_¡ºıy


759 #ià
__GNUC_PREREQ
 (3, 2)

760 
	#¡ºıy
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºıy
 (de¡, src,‚)

	)

762 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

763 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

764 ? (
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

765 ? (*è
	`memıy
 (
de¡
, 
¤c
, 
n
) \

766 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)) \

767 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)))

	)

773 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


774 #ifdeà
_USE_STRING_ARCH_¡rchr


775 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

776 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

777 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

778 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

779 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

780 : (*((*è
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

781 
¤c
, 
n
)èğ'\0', 
__de¡
)) \

782 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

783 #–ià
__GNUC_PREREQ
 (3, 2)

784 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºÿt
 (de¡, src,‚)

	)

786 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

787 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

788 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

789 ? 
	`¡rÿt
 (
de¡
, 
¤c
) \

790 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)) \

791 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)))

	)

797 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


798 #ià
__GNUC_PREREQ
 (3, 2)

799 
	#¡rcmp
(
s1
, 
s2
) \

800 
__ex‹nsiÚ__
 \

801 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

802 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

803 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

804 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

805 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

806 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

807 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

808 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

809 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

810 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

811 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

812 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

813 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

814 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

815 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

816 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

817 : 
	`__butš_¡rcmp
 (
s1
, 
s2
)))); })

	)

819 
	#¡rcmp
(
s1
, 
s2
) \

820 
__ex‹nsiÚ__
 \

821 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

822 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

823 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

824 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

825 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

826 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

827 (
__s1_Ën
 < 
__s2_Ën
 ? __s1_len : __s2_len) + 1) \

828 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

829 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

830 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

831 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s1_Ën
) \

832 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

833 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

834 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

835 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

836 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s2_Ën
) \

837 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

838 : 
	`¡rcmp
 (
s1
, 
s2
)))); })

	)

841 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

842 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = \

843 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

844 - ((cÚ¡ *è(cÚ¡ *)(
s2
))[0]); \

845 ià(
l
 > 0 && 
__»suÉ
 == 0) \

847 
__»suÉ
 = (((const *) \

848 (cÚ¡ *è(
s1
))[1] \

850 (cÚ¡ *è(
s2
))[1]); \

851 ià(
l
 > 1 && 
__»suÉ
 == 0) \

853 
__»suÉ
 = \

855 (cÚ¡ *è(
s1
))[2] \

857 (cÚ¡ *è(
s2
))[2]); \

858 ià(
l
 > 2 && 
__»suÉ
 == 0) \

859 
__»suÉ
 = \

861 (cÚ¡ *è(
s1
))[3] \

863 (cÚ¡ *è(
s2
))[3]); \

866 
__»suÉ
; }))

	)

868 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

869 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = \

870 (cÚ¡ *è(cÚ¡ *è(
s2
); \

871 
__»suÉ
 = \

872 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

873 - 
__s2
[0]); \

874 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

876 
__»suÉ
 = (((const *) \

877 (cÚ¡ *è(
s1
))[1] - 
__s2
[1]); \

878 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

880 
__»suÉ
 = (((const *) \

881 (cÚ¡ *è(
s1
))[2] - 
__s2
[2]); \

882 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

883 
__»suÉ
 = (((const *) \

884 (cÚ¡ *è(
s1
))[3] \

885 - 
__s2
[3]); \

888 
__»suÉ
; }))

	)

890 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
è(- 
	`__¡rcmp_cg
 (s2, s1,†2))

	)

895 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


896 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

897 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

898 && ((
	`__butš_cÚ¡ªt_p
 (
s1
) \

899 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

900 || (
	`__butš_cÚ¡ªt_p
 (
s2
) \

901 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

902 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

908 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rc¥n
 || defšed 
_FORCE_INLINES


909 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


910 #ià
__GNUC_PREREQ
 (3, 2)

911 
	#¡rc¥n
(
s
, 
»jeù
) \

912 
__ex‹nsiÚ__
 \

913 ({ 
__r0
, 
__r1
, 
__r2
; \

914 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

915 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

916 ? 
	`__butš_¡rc¥n
 (
s
, 
»jeù
) \

917 : ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

918 ? 
	`¡¾’
 (
s
) \

919 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

920 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

921 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

922 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

923 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

924 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

925 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)))))) \

926 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)); })

	)

928 
	#¡rc¥n
(
s
, 
»jeù
) \

929 
__ex‹nsiÚ__
 \

930 ({ 
__r0
, 
__r1
, 
__r2
; \

931 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

932 ? ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

933 ? 
	`¡¾’
 (
s
) \

934 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

935 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

936 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

937 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

938 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

939 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

940 : 
	`¡rc¥n
 (
s
, 
»jeù
))))) \

941 : 
	`¡rc¥n
 (
s
, 
»jeù
)); })

	)

945 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

946 
__STRING_INLINE
 
size_t


947 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

949 
size_t
 
__»suÉ
 = 0;

950 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù
)

951 ++
__»suÉ
;

952  
__»suÉ
;

953 
	}
}

955 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
,

956 
__»jeù2
);

957 
__STRING_INLINE
 
size_t


958 
	$__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
)

960 
size_t
 
__»suÉ
 = 0;

961 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


962 && 
__s
[
__»suÉ
] !ğ
__»jeù2
)

963 ++
__»suÉ
;

964  
__»suÉ
;

965 
	}
}

967 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
,

968 
__»jeù2
, 
__»jeù3
);

969 
__STRING_INLINE
 
size_t


970 
	$__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
,

971 
__»jeù3
)

973 
size_t
 
__»suÉ
 = 0;

974 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


975 && 
__s
[
__»suÉ
] !ğ
__»jeù2
 && __s[__»suÉ] !ğ
__»jeù3
)

976 ++
__»suÉ
;

977  
__»suÉ
;

978 
	}
}

984 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¥n
 || defšed 
_FORCE_INLINES


985 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


986 #ià
__GNUC_PREREQ
 (3, 2)

987 
	#¡r¥n
(
s
, 
acû±
) \

988 
__ex‹nsiÚ__
 \

989 ({ 
__a0
, 
__a1
, 
__a2
; \

990 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

991 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

992 ? 
	`__butš_¡r¥n
 (
s
, 
acû±
) \

993 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

994 ? ((è(
s
), (
size_t
) 0) \

995 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

996 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

997 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

998 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

999 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1000 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1001 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)))))) \

1002 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)); })

	)

1004 
	#¡r¥n
(
s
, 
acû±
) \

1005 
__ex‹nsiÚ__
 \

1006 ({ 
__a0
, 
__a1
, 
__a2
; \

1007 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1008 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1009 ? ((è(
s
), (
size_t
) 0) \

1010 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1011 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1012 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1013 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1014 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1015 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1016 : 
	`¡r¥n
 (
s
, 
acû±
))))) \

1017 : 
	`¡r¥n
 (
s
, 
acû±
)); })

	)

1021 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1022 
__STRING_INLINE
 
size_t


1023 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1025 
size_t
 
__»suÉ
 = 0;

1027 
__s
[
__»suÉ
] =ğ
__acû±
)

1028 ++
__»suÉ
;

1029  
__»suÉ
;

1030 
	}
}

1032 
__STRING_INLINE
 
size_t
 
__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1033 
__acû±2
);

1034 
__STRING_INLINE
 
size_t


1035 
	$__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1037 
size_t
 
__»suÉ
 = 0;

1039 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2
)

1040 ++
__»suÉ
;

1041  
__»suÉ
;

1042 
	}
}

1044 
__STRING_INLINE
 
size_t
 
__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1045 
__acû±2
, 
__acû±3
);

1046 
__STRING_INLINE
 
size_t


1047 
	$__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1049 
size_t
 
__»suÉ
 = 0;

1051 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2


1052 || 
__s
[
__»suÉ
] =ğ
__acû±3
)

1053 ++
__»suÉ
;

1054  
__»suÉ
;

1055 
	}
}

1060 #ià!
defšed
 
_HAVE_STRING_ARCH_¡½brk
 || defšed 
_FORCE_INLINES


1061 #iâdeà
_HAVE_STRING_ARCH_¡½brk


1062 #ià
__GNUC_PREREQ
 (3, 2)

1063 
	#¡½brk
(
s
, 
acû±
) \

1064 
__ex‹nsiÚ__
 \

1065 ({ 
__a0
, 
__a1
, 
__a2
; \

1066 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1067 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1068 ? 
	`__butš_¡½brk
 (
s
, 
acû±
) \

1069 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1070 ? ((è(
s
), (*è
NULL
) \

1071 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1072 ? 
	`__butš_¡rchr
 (
s
, 
__a0
) \

1073 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1074 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1075 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1076 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1077 : 
	`__butš_¡½brk
 (
s
, 
acû±
)))))) \

1078 : 
	`__butš_¡½brk
 (
s
, 
acû±
)); })

	)

1080 
	#¡½brk
(
s
, 
acû±
) \

1081 
__ex‹nsiÚ__
 \

1082 ({ 
__a0
, 
__a1
, 
__a2
; \

1083 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1084 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1085 ? ((è(
s
), (*è
NULL
) \

1086 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1087 ? 
	`¡rchr
 (
s
, 
__a0
) \

1088 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1089 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1090 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1091 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1092 : 
	`¡½brk
 (
s
, 
acû±
))))) \

1093 : 
	`¡½brk
 (
s
, 
acû±
)); })

	)

1097 
__STRING_INLINE
 *
__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1098 
__acû±2
);

1099 
__STRING_INLINE
 *

1100 
	$__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1103 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2
)

1104 ++
__s
;

1105  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1106 
	}
}

1108 
__STRING_INLINE
 *
__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1109 
__acû±2
, 
__acû±3
);

1110 
__STRING_INLINE
 *

1111 
	$__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1114 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2


1115 && *
__s
 !ğ
__acû±3
)

1116 ++
__s
;

1117  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1118 
	}
}

1124 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¡r
 && !
__GNUC_PREREQ
 (2, 97)

1125 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1126 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
è&& 
	`__¡ršg2_1b±r_p
 (needle) \

1127 ? (((cÚ¡ *è(
ÃedË
))[0] == '\0' \

1128 ? (*è(
size_t
è(
hay¡ack
) \

1129 : (((cÚ¡ *è(
ÃedË
))[1] == '\0' \

1130 ? 
	`¡rchr
 (
hay¡ack
, \

1131 ((cÚ¡ *è(
ÃedË
))[0]) \

1132 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
))) \

1133 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
)))

	)

1137 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


1138 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


1139 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

1140 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

1141 && ((cÚ¡ *è(
£p
))[0] != '\0' \

1142 && ((cÚ¡ *è(
£p
))[1] == '\0' \

1143 ? 
	`__¡¹ok_r_1c
 (
s
, ((cÚ¡ *è(
£p
))[0], 
Ãx
) \

1144 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

1147 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

1148 
__STRING_INLINE
 *

1149 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

1151 *
__»suÉ
;

1152 ià(
__s
 =ğ
NULL
)

1153 
__s
 = *
__Ãx
;

1154 *
__s
 =ğ
__£p
)

1155 ++
__s
;

1156 
__»suÉ
 = 
NULL
;

1157 ià(*
__s
 != '\0')

1159 
__»suÉ
 = 
__s
++;

1160 *
__s
 != '\0')

1161 ià(*
__s
++ =ğ
__£p
)

1163 
__s
[-1] = '\0';

1167 *
__Ãx
 = 
__s
;

1168  
__»suÉ
;

1169 
	}
}

1170 #ifdeà
__USE_POSIX


1171 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

1176 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


1177 #iâdeà
_HAVE_STRING_ARCH_¡r£p


1179 *
__¡r£p_g
 (**
__¡ršgp
, cÚ¡ *
__d–im
);

1180 
	#__¡r£p
(
s
, 
»jeù
) \

1181 
__ex‹nsiÚ__
 \

1182 ({ 
__r0
, 
__r1
, 
__r2
; \

1183 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

1184 && (
__r0
 = ((cÚ¡ *è(
»jeù
))[0], \

1185 ((cÚ¡ *è(
»jeù
))[0] != '\0') \

1186 ? ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], \

1187 ((cÚ¡ *è(
»jeù
))[1] == '\0') \

1188 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

1189 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

1190 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1191 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

1192 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1193 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

1194 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

1197 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

1198 
__STRING_INLINE
 *

1199 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

1201 *
__»tv®
 = *
__s
;

1202 ià(
__»tv®
 !ğ
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

1203 *(*
__s
)++ = '\0';

1204  
__»tv®
;

1205 
	}
}

1207 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

1208 
__STRING_INLINE
 *

1209 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

1211 *
__»tv®
 = *
__s
;

1212 ià(
__»tv®
 !ğ
NULL
)

1214 *
__ı
 = 
__»tv®
;

1217 ià(*
__ı
 == '\0')

1219 
__ı
 = 
NULL
;

1222 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
)

1224 *
__ı
++ = '\0';

1227 ++
__ı
;

1229 *
__s
 = 
__ı
;

1231  
__»tv®
;

1232 
	}
}

1234 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

1235 
__»jeù3
);

1236 
__STRING_INLINE
 *

1237 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

1239 *
__»tv®
 = *
__s
;

1240 ià(
__»tv®
 !ğ
NULL
)

1242 *
__ı
 = 
__»tv®
;

1245 ià(*
__ı
 == '\0')

1247 
__ı
 = 
NULL
;

1250 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
 || *__ı =ğ
__»jeù3
)

1252 *
__ı
++ = '\0';

1255 ++
__ı
;

1257 *
__s
 = 
__ı
;

1259  
__»tv®
;

1260 
	}
}

1261 #ifdeà
__USE_MISC


1262 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

1269 #ifdeà
__USE_MISC


1271 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


1272 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

1273 
	~<¡dlib.h
>

1276 #iâdeà
_HAVE_STRING_ARCH_¡rdup


1278 *
	$__¡rdup
 (cÚ¡ *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

1279 
	#__¡rdup
(
s
) \

1280 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1281 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1282 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1283 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1284 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1285 ià(
__»tv®
 !ğ
NULL
) \

1286 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, 
__Ën
); \

1287 
__»tv®
; 
	}
})) \

1288 : 
	`__¡rdup
 (
s
)))

	)

1290 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


1291 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

1295 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


1297 *
	$__¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

1298 
__THROW
 
__©Œibu‹_m®loc__
;

1299 
	#__¡ºdup
(
s
, 
n
) \

1300 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1301 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1302 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1303 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1304 
size_t
 
__n
 = (
n
); \

1305 *
__»tv®
; \

1306 ià(
__n
 < 
__Ën
) \

1307 
__Ën
 = 
__n
 + 1; \

1308 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1309 ià(
__»tv®
 !ğ
NULL
) \

1311 
__»tv®
[
__Ën
 - 1] = '\0'; \

1312 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, \

1313 
__Ën
 - 1); \

1315 
__»tv®
; 
	}
})) \

1316 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

1318 #ifdeà
__USE_XOPEN2K8


1319 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

1325 #iâdeà
_FORCE_INLINES


1326 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

18 #iâdeà
_STRING_H


22 #ià!
__GNUC_PREREQ
 (5,0)

23 
__w¬ndeş
 (
__w¬n_mem£t_z”o_Ën
,

27 #iâdeà
__ılu¥lus


31 #undeà
memıy


32 #undeà
memmove


33 #undeà
mem£t


34 #undeà
¡rÿt


35 #undeà
¡rıy


36 #undeà
¡ºÿt


37 #undeà
¡ºıy


38 #ifdeà
__USE_GNU


39 #undeà
mempıy


40 #undeà
¡pıy


42 #ifdeà
__USE_MISC


43 #undeà
bcİy


44 #undeà
bz”o


49 
__fÜtify_funùiÚ
 *

50 
__NTH
 (
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

51 
size_t
 
__Ën
))

53  
	`__butš___memıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

54 
	}
}

56 
__fÜtify_funùiÚ
 *

57 
__NTH
 (
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__Ën
))

59  
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

60 
	}
}

62 #ifdeà
__USE_GNU


63 
__fÜtify_funùiÚ
 *

64 
__NTH
 (
	$mempıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

65 
size_t
 
__Ën
))

67  
	`__butš___mempıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

68 
	}
}

77 
__fÜtify_funùiÚ
 *

78 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

82 #ià!
	`__GNUC_PREREQ
 (5,0)

83 ià(
	`__butš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

84 && (!
	`__butš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

86 
	`__w¬n_mem£t_z”o_Ën
 ();

87  
__de¡
;

90  
	`__butš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

91 
	}
}

93 #ifdeà
__USE_MISC


94 
__fÜtify_funùiÚ
 

95 
__NTH
 (
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

97 (è
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

98 
	}
}

100 
__fÜtify_funùiÚ
 

101 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

103 (è
	`__butš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

104 
	}
}

107 
__fÜtify_funùiÚ
 *

108 
__NTH
 (
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

110  
	`__butš___¡rıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

111 
	}
}

113 #ifdeà
__USE_GNU


114 
__fÜtify_funùiÚ
 *

115 
__NTH
 (
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

117  
	`__butš___¡pıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

118 
	}
}

122 
__fÜtify_funùiÚ
 *

123 
__NTH
 (
	$¡ºıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

124 
size_t
 
__Ën
))

126  
	`__butš___¡ºıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

127 
	}
}

130 *
	$__¡²ıy_chk
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

131 
size_t
 
__de¡Ën
è
__THROW
;

132 *
	`__REDIRECT_NTH
 (
__¡²ıy_®Ÿs
, (*
__de¡
, cÚ¡ *
__¤c
,

133 
size_t
 
__n
), 
¡²ıy
);

135 
__fÜtify_funùiÚ
 *

136 
	`__NTH
 (
	$¡²ıy
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
))

138 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1

139 && (!
	`__butš_cÚ¡ªt_p
 (
__n
è|| __À> 
	`__bos
 (
__de¡
)))

140  
	`__¡²ıy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

141  
	`__¡²ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

142 
	}
}

145 
__fÜtify_funùiÚ
 *

146 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

148  
	`__butš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

149 
	}
}

152 
__fÜtify_funùiÚ
 *

153 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

154 
size_t
 
__Ën
))

156  
	`__butš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

157 
	}
}

	@/usr/include/bits/sys_errlist.h

19 #iâdeà
_STDIO_H


25 #ifdeà 
__USE_MISC


26 
sys_Ã¼
;

27 cÚ¡ *cÚ¡ 
sys_”¾i¡
[];

29 #ifdeà 
__USE_GNU


30 
_sys_Ã¼
;

31 cÚ¡ *cÚ¡ 
_sys_”¾i¡
[];

	@/usr/include/bits/sysctl.h

18 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


	@/usr/include/bits/termios.h

19 #iâdeà
_TERMIOS_H


23 
	tcc_t
;

24 
	t¥“d_t
;

25 
	ttcæag_t
;

27 
	#NCCS
 32

	)

28 
	s‹rmios


30 
tcæag_t
 
	mc_iæag
;

31 
tcæag_t
 
	mc_oæag
;

32 
tcæag_t
 
	mc_cæag
;

33 
tcæag_t
 
	mc_læag
;

34 
cc_t
 
	mc_lše
;

35 
cc_t
 
	mc_cc
[
NCCS
];

36 
¥“d_t
 
	mc_i¥“d
;

37 
¥“d_t
 
	mc_o¥“d
;

38 
	#_HAVE_STRUCT_TERMIOS_C_ISPEED
 1

	)

39 
	#_HAVE_STRUCT_TERMIOS_C_OSPEED
 1

	)

43 
	#VINTR
 0

	)

44 
	#VQUIT
 1

	)

45 
	#VERASE
 2

	)

46 
	#VKILL
 3

	)

47 
	#VEOF
 4

	)

48 
	#VTIME
 5

	)

49 
	#VMIN
 6

	)

50 
	#VSWTC
 7

	)

51 
	#VSTART
 8

	)

52 
	#VSTOP
 9

	)

53 
	#VSUSP
 10

	)

54 
	#VEOL
 11

	)

55 
	#VREPRINT
 12

	)

56 
	#VDISCARD
 13

	)

57 
	#VWERASE
 14

	)

58 
	#VLNEXT
 15

	)

59 
	#VEOL2
 16

	)

62 
	#IGNBRK
 0000001

	)

63 
	#BRKINT
 0000002

	)

64 
	#IGNPAR
 0000004

	)

65 
	#PARMRK
 0000010

	)

66 
	#INPCK
 0000020

	)

67 
	#ISTRIP
 0000040

	)

68 
	#INLCR
 0000100

	)

69 
	#IGNCR
 0000200

	)

70 
	#ICRNL
 0000400

	)

71 
	#IUCLC
 0001000

	)

72 
	#IXON
 0002000

	)

73 
	#IXANY
 0004000

	)

74 
	#IXOFF
 0010000

	)

75 
	#IMAXBEL
 0020000

	)

76 
	#IUTF8
 0040000

	)

79 
	#OPOST
 0000001

	)

80 
	#OLCUC
 0000002

	)

81 
	#ONLCR
 0000004

	)

82 
	#OCRNL
 0000010

	)

83 
	#ONOCR
 0000020

	)

84 
	#ONLRET
 0000040

	)

85 
	#OFILL
 0000100

	)

86 
	#OFDEL
 0000200

	)

87 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


88 
	#NLDLY
 0000400

	)

89 
	#NL0
 0000000

	)

90 
	#NL1
 0000400

	)

91 
	#CRDLY
 0003000

	)

92 
	#CR0
 0000000

	)

93 
	#CR1
 0001000

	)

94 
	#CR2
 0002000

	)

95 
	#CR3
 0003000

	)

96 
	#TABDLY
 0014000

	)

97 
	#TAB0
 0000000

	)

98 
	#TAB1
 0004000

	)

99 
	#TAB2
 0010000

	)

100 
	#TAB3
 0014000

	)

101 
	#BSDLY
 0020000

	)

102 
	#BS0
 0000000

	)

103 
	#BS1
 0020000

	)

104 
	#FFDLY
 0100000

	)

105 
	#FF0
 0000000

	)

106 
	#FF1
 0100000

	)

109 
	#VTDLY
 0040000

	)

110 
	#VT0
 0000000

	)

111 
	#VT1
 0040000

	)

113 #ifdeà
__USE_MISC


114 
	#XTABS
 0014000

	)

118 #ifdeà
__USE_MISC


119 
	#CBAUD
 0010017

	)

121 
	#B0
 0000000

	)

122 
	#B50
 0000001

	)

123 
	#B75
 0000002

	)

124 
	#B110
 0000003

	)

125 
	#B134
 0000004

	)

126 
	#B150
 0000005

	)

127 
	#B200
 0000006

	)

128 
	#B300
 0000007

	)

129 
	#B600
 0000010

	)

130 
	#B1200
 0000011

	)

131 
	#B1800
 0000012

	)

132 
	#B2400
 0000013

	)

133 
	#B4800
 0000014

	)

134 
	#B9600
 0000015

	)

135 
	#B19200
 0000016

	)

136 
	#B38400
 0000017

	)

137 #ifdeà
__USE_MISC


138 
	#EXTA
 
B19200


	)

139 
	#EXTB
 
B38400


	)

141 
	#CSIZE
 0000060

	)

142 
	#CS5
 0000000

	)

143 
	#CS6
 0000020

	)

144 
	#CS7
 0000040

	)

145 
	#CS8
 0000060

	)

146 
	#CSTOPB
 0000100

	)

147 
	#CREAD
 0000200

	)

148 
	#PARENB
 0000400

	)

149 
	#PARODD
 0001000

	)

150 
	#HUPCL
 0002000

	)

151 
	#CLOCAL
 0004000

	)

152 #ifdeà
__USE_MISC


153 
	#CBAUDEX
 0010000

	)

155 
	#B57600
 0010001

	)

156 
	#B115200
 0010002

	)

157 
	#B230400
 0010003

	)

158 
	#B460800
 0010004

	)

159 
	#B500000
 0010005

	)

160 
	#B576000
 0010006

	)

161 
	#B921600
 0010007

	)

162 
	#B1000000
 0010010

	)

163 
	#B1152000
 0010011

	)

164 
	#B1500000
 0010012

	)

165 
	#B2000000
 0010013

	)

166 
	#B2500000
 0010014

	)

167 
	#B3000000
 0010015

	)

168 
	#B3500000
 0010016

	)

169 
	#B4000000
 0010017

	)

170 
	#__MAX_BAUD
 
B4000000


	)

171 #ifdeà
__USE_MISC


172 
	#CIBAUD
 002003600000

	)

173 
	#CMSPAR
 010000000000

	)

174 
	#CRTSCTS
 020000000000

	)

178 
	#ISIG
 0000001

	)

179 
	#ICANON
 0000002

	)

180 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


181 
	#XCASE
 0000004

	)

183 
	#ECHO
 0000010

	)

184 
	#ECHOE
 0000020

	)

185 
	#ECHOK
 0000040

	)

186 
	#ECHONL
 0000100

	)

187 
	#NOFLSH
 0000200

	)

188 
	#TOSTOP
 0000400

	)

189 #ifdeà
__USE_MISC


190 
	#ECHOCTL
 0001000

	)

191 
	#ECHOPRT
 0002000

	)

192 
	#ECHOKE
 0004000

	)

193 
	#FLUSHO
 0010000

	)

194 
	#PENDIN
 0040000

	)

196 
	#IEXTEN
 0100000

	)

197 #ifdeà
__USE_MISC


198 
	#EXTPROC
 0200000

	)

202 
	#TCOOFF
 0

	)

203 
	#TCOON
 1

	)

204 
	#TCIOFF
 2

	)

205 
	#TCION
 3

	)

208 
	#TCIFLUSH
 0

	)

209 
	#TCOFLUSH
 1

	)

210 
	#TCIOFLUSH
 2

	)

213 
	#TCSANOW
 0

	)

214 
	#TCSADRAIN
 1

	)

215 
	#TCSAFLUSH
 2

	)

218 
	#_IOT_‹rmios
 \

219 
	`_IOT
 (
	`_IOTS
 (
cæag_t
), 4, _IOTS (
cc_t
), 
NCCS
, _IOTS (
¥“d_t
), 2)

	)

	@/usr/include/bits/time.h

23 #ià
defšed
 
__Ãed_timev®
 || defšed 
__USE_GNU


24 #iâdeà
_STRUCT_TIMEVAL


25 
	#_STRUCT_TIMEVAL
 1

	)

26 
	~<b™s/ty³s.h
>

30 
	stimev®


32 
__time_t
 
	mtv_£c
;

33 
__su£cÚds_t
 
	mtv_u£c
;

38 #iâdeà
__Ãed_timev®


39 #iâdeà
_BITS_TIME_H


40 
	#_BITS_TIME_H
 1

	)

48 
	#CLOCKS_PER_SEC
 ((
şock_t
è1000000)

	)

50 #ià(!
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_POSIX
) \

51 && !
defšed
 
	g__USE_XOPEN2K


54 
	~<b™s/ty³s.h
>

55 
__syscÚf
 ();

56 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

59 #ifdeà
__USE_POSIX199309


61 
	#CLOCK_REALTIME
 0

	)

63 
	#CLOCK_MONOTONIC
 1

	)

65 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

67 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

69 
	#CLOCK_MONOTONIC_RAW
 4

	)

71 
	#CLOCK_REALTIME_COARSE
 5

	)

73 
	#CLOCK_MONOTONIC_COARSE
 6

	)

75 
	#CLOCK_BOOTTIME
 7

	)

77 
	#CLOCK_REALTIME_ALARM
 8

	)

79 
	#CLOCK_BOOTTIME_ALARM
 9

	)

81 
	#CLOCK_TAI
 11

	)

84 
	#TIMER_ABSTIME
 1

	)

87 #ifdeà
__USE_GNU


88 
	~<b™s/timex.h
>

90 
__BEGIN_DECLS


93 
	$şock_adjtime
 (
__şockid_t
 
__şock_id
, 
timex
 *
__utx
è
__THROW
;

95 
__END_DECLS


101 #undeà
__Ãed_timev®


	@/usr/include/bits/types.h

23 #iâdef 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wÜdsize.h
>

30 
	t__u_ch¬
;

31 
	t__u_shÜt
;

32 
	t__u_št
;

33 
	t__u_lÚg
;

36 sigÃd 
	t__št8_t
;

37 
	t__ušt8_t
;

38 sigÃd 
	t__št16_t
;

39 
	t__ušt16_t
;

40 sigÃd 
	t__št32_t
;

41 
	t__ušt32_t
;

42 #ià
__WORDSIZE
 == 64

43 sigÃd 
	t__št64_t
;

44 
	t__ušt64_t
;

46 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

47 
__ex‹nsiÚ__
 
	t__ušt64_t
;

51 #ià
__WORDSIZE
 == 64

52 
	t__quad_t
;

53 
	t__u_quad_t
;

55 
__ex‹nsiÚ__
 
	t__quad_t
;

56 
__ex‹nsiÚ__
 
	t__u_quad_t
;

89 
	#__S16_TYPE
 

	)

90 
	#__U16_TYPE
 

	)

91 
	#__S32_TYPE
 

	)

92 
	#__U32_TYPE
 

	)

93 
	#__SLONGWORD_TYPE
 

	)

94 
	#__ULONGWORD_TYPE
 

	)

95 #ià
__WORDSIZE
 == 32

96 
	#__SQUAD_TYPE
 
__quad_t


	)

97 
	#__UQUAD_TYPE
 
__u_quad_t


	)

98 
	#__SWORD_TYPE
 

	)

99 
	#__UWORD_TYPE
 

	)

100 
	#__SLONG32_TYPE
 

	)

101 
	#__ULONG32_TYPE
 

	)

102 
	#__S64_TYPE
 
__quad_t


	)

103 
	#__U64_TYPE
 
__u_quad_t


	)

106 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

107 #–ià
__WORDSIZE
 == 64

108 
	t__SQUAD_TYPE
 

	)

109 
	t__UQUAD_TYPE
 

	)

110 
	t__SWORD_TYPE
 

	)

111 
	t__UWORD_TYPE
 

	)

112 
	t__SLONG32_TYPE
 

	)

113 
	t__ULONG32_TYPE
 

	)

114 
	t__S64_TYPE
 

	)

115 
	t__U64_TYPE
 

	)

117 
	t__STD_TYPE
 

	)

121 
	~<b™s/ty³sizes.h
>

124 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

125 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

126 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

127 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

128 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

129 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

130 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

131 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

132 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

133 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

134 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

135 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

136 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

137 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

138 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

139 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

140 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

141 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

143 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

144 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

147 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

150 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

153 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

158 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

159 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

162 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

163 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

166 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

167 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

170 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fswÜd_t
;

172 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

175 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysÿÎ_¦Úg_t
;

177 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysÿÎ_ulÚg_t
;

181 
__off64_t
 
	t__loff_t
;

182 
__quad_t
 *
	t__qaddr_t
;

183 *
	t__ÿddr_t
;

186 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

189 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

192 #undeà
__STD_TYPE


	@/usr/include/bits/uio.h

18 #ià!
defšed
 
_SYS_UIO_H
 && !defšed 
_FCNTL_H


22 #iâdeà
_BITS_UIO_H


23 
	#_BITS_UIO_H
 1

	)

25 
	~<sys/ty³s.h
>

39 
	#UIO_MAXIOV
 1024

	)

43 
	siovec


45 *
	miov_ba£
;

46 
size_t
 
	miov_Ën
;

52 #ifdeà
__USE_GNU


53 #ià
defšed
 
_SYS_UIO_H
 && !defšed 
_BITS_UIO_H_FOR_SYS_UIO_H


54 
	#_BITS_UIO_H_FOR_SYS_UIO_H
 1

	)

56 
__BEGIN_DECLS


59 
ssize_t
 
	$´oûss_vm_»adv
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

60 
__liovút
,

61 cÚ¡ 
iovec
 *
__rvec
,

62 
__riovút
,

63 
__æags
)

64 
__THROW
;

67 
ssize_t
 
	$´oûss_vm_wr™ev
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

68 
__liovút
,

69 cÚ¡ 
iovec
 *
__rvec
,

70 
__riovút
,

71 
__æags
)

72 
__THROW
;

74 
__END_DECLS


	@/usr/include/bits/unistd.h

19 #iâdeà
_UNISTD_H


23 
ssize_t
 
	$__»ad_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

24 
size_t
 
__buæ’
è
__wur
;

25 
ssize_t
 
	`__REDIRECT
 (
__»ad_®Ÿs
, (
__fd
, *
__buf
,

26 
size_t
 
__nby‹s
), 
»ad
è
__wur
;

27 
ssize_t
 
	`__REDIRECT
 (
__»ad_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

29 
size_t
 
__buæ’
), 
__»ad_chk
)

30 
__wur
 
	`__w¬Ç‰r
 ("read called with bigger†engthhan size of "

33 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


34 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

39  
	`__»ad_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

41 ià(
__nby‹s
 > 
	`__bos0
 (
__buf
))

42  
	`__»ad_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

44  
	`__»ad_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
);

45 
	}
}

47 #ifdeà
__USE_UNIX98


48 
ssize_t
 
	$__´—d_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

49 
__off_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

50 
ssize_t
 
	$__´—d64_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

51 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

52 
ssize_t
 
	`__REDIRECT
 (
__´—d_®Ÿs
,

53 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

54 
__off_t
 
__off£t
), 
´—d
è
__wur
;

55 
ssize_t
 
	`__REDIRECT
 (
__´—d64_®Ÿs
,

56 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

57 
__off64_t
 
__off£t
), 
´—d64
è
__wur
;

58 
ssize_t
 
	`__REDIRECT
 (
__´—d_chk_w¬n
,

59 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

60 
__off_t
 
__off£t
, 
size_t
 
__bufsize
), 
__´—d_chk
)

61 
__wur
 
	`__w¬Ç‰r
 ("pread called with bigger†engthhan size of "

63 
ssize_t
 
	`__REDIRECT
 (
__´—d64_chk_w¬n
,

64 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

65 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
),

66 
__´—d64_chk
)

67 
__wur
 
	`__w¬Ç‰r
 ("pread64 called with bigger†engthhan size of "

70 #iâdeà
__USE_FILE_OFFSET64


71 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


72 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off_t
 
__off£t
)

74 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

76 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

77  
	`__´—d_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

79 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

80  
	`__´—d_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

81 
	`__bos0
 (
__buf
));

83  
	`__´—d_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

84 
	}
}

86 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


87 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

89 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

91 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

92  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

94 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

95  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

96 
	`__bos0
 (
__buf
));

99  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

100 
	}
}

103 #ifdeà
__USE_LARGEFILE64


104 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


105 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

107 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

109 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

110  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

112 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

113  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

114 
	`__bos0
 (
__buf
));

117  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

118 
	}
}

122 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


123 
ssize_t
 
	$__»adlšk_chk
 (cÚ¡ *
__»¡riù
 
__·th
,

124 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

125 
size_t
 
__buæ’
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

127 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_®Ÿs
,

128 (cÚ¡ *
__»¡riù
 
__·th
,

129 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
), 
»adlšk
)

130 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

131 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_chk_w¬n
,

132 (cÚ¡ *
__»¡riù
 
__·th
,

133 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

134 
size_t
 
__buæ’
), 
__»adlšk_chk
)

135 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
	`__w¬Ç‰r
 ("readlink called with bigger†ength "

138 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
ssize_t


139 
	`__NTH
 (
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
, *__»¡riù 
__buf
,

140 
size_t
 
__Ën
))

142 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

144 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

145  
	`__»adlšk_chk
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

147 iàĞ
__Ën
 > 
	`__bos
 (
__buf
))

148  
	`__»adlšk_chk_w¬n
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

150  
	`__»adlšk_®Ÿs
 (
__·th
, 
__buf
, 
__Ën
);

151 
	}
}

154 #ifdeà
__USE_ATFILE


155 
ssize_t
 
	$__»adlšk©_chk
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

156 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

157 
size_t
 
__buæ’
)

158 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

159 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_®Ÿs
,

160 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

161 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
),

162 
»adlšk©
)

163 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

164 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_chk_w¬n
,

165 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

166 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

167 
size_t
 
__buæ’
), 
__»adlšk©_chk
)

168 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
	`__w¬Ç‰r
 ("readlinkat called with bigger "

172 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
ssize_t


173 
	`__NTH
 (
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

174 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
))

176 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

178 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

179  
	`__»adlšk©_chk
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

181 ià(
__Ën
 > 
	`__bos
 (
__buf
))

182  
	`__»adlšk©_chk_w¬n
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
,

183 
	`__bos
 (
__buf
));

185  
	`__»adlšk©_®Ÿs
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
);

186 
	}
}

189 *
	$__g‘cwd_chk
 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
)

190 
__THROW
 
__wur
;

191 *
	`__REDIRECT_NTH
 (
__g‘cwd_®Ÿs
,

192 (*
__buf
, 
size_t
 
__size
), 
g‘cwd
è
__wur
;

193 *
	`__REDIRECT_NTH
 (
__g‘cwd_chk_w¬n
,

194 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
),

195 
__g‘cwd_chk
)

196 
__wur
 
	`__w¬Ç‰r
 ("getcwd caller with bigger†engthhan size of "

199 
__fÜtify_funùiÚ
 
__wur
 *

200 
	`__NTH
 (
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
))

202 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

204 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
))

205  
	`__g‘cwd_chk
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

207 ià(
__size
 > 
	`__bos
 (
__buf
))

208  
	`__g‘cwd_chk_w¬n
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

210  
	`__g‘cwd_®Ÿs
 (
__buf
, 
__size
);

211 
	}
}

213 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


214 *
	$__g‘wd_chk
 (*
__buf
, 
size_t
 
buæ’
)

215 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

216 *
	`__REDIRECT_NTH
 (
__g‘wd_w¬n
, (*
__buf
), 
g‘wd
)

217 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("please use getcwd instead,‡s getwd "

220 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
 *

221 
	`__NTH
 (
	$g‘wd
 (*
__buf
))

223 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

224  
	`__g‘wd_chk
 (
__buf
, 
	`__bos
 (__buf));

225  
	`__g‘wd_w¬n
 (
__buf
);

226 
	}
}

229 
size_t
 
	$__cÚf¡r_chk
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

230 
size_t
 
__buæ’
è
__THROW
;

231 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_®Ÿs
, (
__Çme
, *
__buf
,

232 
size_t
 
__Ën
), 
cÚf¡r
);

233 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_chk_w¬n
,

234 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

235 
size_t
 
__buæ’
), 
__cÚf¡r_chk
)

236 
	`__w¬Ç‰r
 ("confstr called with bigger†engthhan size of destination "

239 
__fÜtify_funùiÚ
 
size_t


240 
	`__NTH
 (
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
))

242 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

244 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

245  
	`__cÚf¡r_chk
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

247 ià(
	`__bos
 (
__buf
è< 
__Ën
)

248  
	`__cÚf¡r_chk_w¬n
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

250  
	`__cÚf¡r_®Ÿs
 (
__Çme
, 
__buf
, 
__Ën
);

251 
	}
}

254 
	$__g‘groups_chk
 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
)

255 
__THROW
 
__wur
;

256 
	`__REDIRECT_NTH
 (
__g‘groups_®Ÿs
, (
__size
, 
__gid_t
 
__li¡
[]),

257 
g‘groups
è
__wur
;

258 
	`__REDIRECT_NTH
 (
__g‘groups_chk_w¬n
,

259 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
),

260 
__g‘groups_chk
)

261 
__wur
 
	`__w¬Ç‰r
 ("getgroups called with bigger group counthan what "

264 
__fÜtify_funùiÚ
 

265 
	`__NTH
 (
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]))

267 ià(
	`__bos
 (
__li¡
è!ğ(
size_t
) -1)

269 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
) || __size < 0)

270  
	`__g‘groups_chk
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

272 ià(
__size
 *  (
__gid_t
è> 
	`__bos
 (
__li¡
))

273  
	`__g‘groups_chk_w¬n
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

275  
	`__g‘groups_®Ÿs
 (
__size
, 
__li¡
);

276 
	}
}

279 
	$__‰yÇme_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

280 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

281 
	`__REDIRECT_NTH
 (
__‰yÇme_r_®Ÿs
, (
__fd
, *
__buf
,

282 
size_t
 
__buæ’
), 
‰yÇme_r
)

283 
	`__nÚnuÎ
 ((2));

284 
	`__REDIRECT_NTH
 (
__‰yÇme_r_chk_w¬n
,

285 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

286 
size_t
 
__Ä—l
), 
__‰yÇme_r_chk
)

287 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ttyname_r called with bigger buflenhan "

290 
__fÜtify_funùiÚ
 

291 
	`__NTH
 (
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

293 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

295 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

296  
	`__‰yÇme_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

298 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

299  
	`__‰yÇme_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

301  
	`__‰yÇme_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

302 
	}
}

305 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


306 
	$__g‘logš_r_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

307 
	`__nÚnuÎ
 ((1));

308 
	`__REDIRECT
 (
__g‘logš_r_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

309 
g‘logš_r
è
	`__nÚnuÎ
 ((1));

310 
	`__REDIRECT
 (
__g‘logš_r_chk_w¬n
,

311 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

312 
__g‘logš_r_chk
)

313 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("getlogin_r called with bigger buflenhan "

316 
__fÜtify_funùiÚ
 

317 
	$g‘logš_r
 (*
__buf
, 
size_t
 
__buæ’
)

319 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

321 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

322  
	`__g‘logš_r_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

324 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

325  
	`__g‘logš_r_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

327  
	`__g‘logš_r_®Ÿs
 (
__buf
, 
__buæ’
);

328 
	}
}

332 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_UNIX98


333 
	$__g‘ho¡Çme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

334 
__THROW
 
	`__nÚnuÎ
 ((1));

335 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

336 
g‘ho¡Çme
è
	`__nÚnuÎ
 ((1));

337 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_chk_w¬n
,

338 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

339 
__g‘ho¡Çme_chk
)

340 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("gethostname called with bigger buflenhan "

343 
__fÜtify_funùiÚ
 

344 
	`__NTH
 (
	$g‘ho¡Çme
 (*
__buf
, 
size_t
 
__buæ’
))

346 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

348 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

349  
	`__g‘ho¡Çme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

351 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

352  
	`__g‘ho¡Çme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

354  
	`__g‘ho¡Çme_®Ÿs
 (
__buf
, 
__buæ’
);

355 
	}
}

359 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

360 
	$__g‘domašÇme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

361 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

362 
	`__REDIRECT_NTH
 (
__g‘domašÇme_®Ÿs
, (*
__buf
,

363 
size_t
 
__buæ’
),

364 
g‘domašÇme
è
	`__nÚnuÎ
 ((1)è
__wur
;

365 
	`__REDIRECT_NTH
 (
__g‘domašÇme_chk_w¬n
,

366 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

367 
__g‘domašÇme_chk
)

368 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("getdomainname called with bigger "

372 
__fÜtify_funùiÚ
 

373 
	`__NTH
 (
	$g‘domašÇme
 (*
__buf
, 
size_t
 
__buæ’
))

375 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

377 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

378  
	`__g‘domašÇme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

380 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

381  
	`__g‘domašÇme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

383  
	`__g‘domašÇme_®Ÿs
 (
__buf
, 
__buæ’
);

384 
	}
}

	@/usr/include/bits/utsname.h

18 #iâdeà
_SYS_UTSNAME_H


23 
	#_UTSNAME_LENGTH
 65

	)

28 
	#_UTSNAME_DOMAIN_LENGTH
 
_UTSNAME_LENGTH


	)

	@/usr/include/bits/waitflags.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


25 
	#WNOHANG
 1

	)

26 
	#WUNTRACED
 2

	)

29 
	#WSTOPPED
 2

	)

30 
	#WEXITED
 4

	)

31 
	#WCONTINUED
 8

	)

32 
	#WNOWAIT
 0x01000000

	)

34 
	#__WNOTHREAD
 0x20000000

	)

36 
	#__WALL
 0x40000000

	)

37 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


28 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

31 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

34 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

37 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ğ0)

	)

40 
	#__WIFSIGNALED
(
¡©us
) \

41 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

44 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ğ0x7f)

	)

48 #ifdeà
WCONTINUED


49 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ğ
__W_CONTINUED
)

	)

53 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

56 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

57 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

58 
	#__W_CONTINUED
 0xffff

	)

59 
	#__WCOREFLAG
 0x80

	)

62 #ifdef 
__USE_MISC


64 
	~<’dŸn.h
>

66 
	uwa™


68 
	mw_¡©us
;

71 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


72 
	m__w_‹rmsig
:7;

73 
	m__w_cÜedump
:1;

74 
	m__w_»tcode
:8;

77 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


79 
	m__w_»tcode
:8;

80 
	m__w_cÜedump
:1;

81 
	m__w_‹rmsig
:7;

83 } 
	m__wa™_‹rmš©ed
;

86 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


87 
	m__w_¡İv®
:8;

88 
	m__w_¡İsig
:8;

91 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


93 
	m__w_¡İsig
:8;

94 
	m__w_¡İv®
:8;

96 } 
	m__wa™_¡İ³d
;

99 
	#w_‹rmsig
 
__wa™_‹rmš©ed
.
__w_‹rmsig


	)

100 
	#w_cÜedump
 
__wa™_‹rmš©ed
.
__w_cÜedump


	)

101 
	#w_»tcode
 
__wa™_‹rmš©ed
.
__w_»tcode


	)

102 
	#w_¡İsig
 
__wa™_¡İ³d
.
__w_¡İsig


	)

103 
	#w_¡İv®
 
__wa™_¡İ³d
.
__w_¡İv®


	)

	@/usr/include/bits/wchar.h

19 #iâdeà
_BITS_WCHAR_H


20 
	#_BITS_WCHAR_H
 1

	)

33 #ifdeà
__WCHAR_MAX__


34 
	#__WCHAR_MAX
 
__WCHAR_MAX__


	)

35 #–ià
L
'\0' - 1 > 0

36 
	#__WCHAR_MAX
 (0xffffffffu + 
L
'\0')

	)

38 
	#__WCHAR_MAX
 (0x7ffffffà+ 
L
'\0')

	)

41 #ifdeà
__WCHAR_MIN__


42 
	#__WCHAR_MIN
 
__WCHAR_MIN__


	)

43 #–ià
L
'\0' - 1 > 0

44 
	#__WCHAR_MIN
 (
L
'\0' + 0)

	)

46 
	#__WCHAR_MIN
 (-
__WCHAR_MAX
 - 1)

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__
 && !defšed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifdeà
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/bits/xopen_lim.h

29 #iâdeà
_XOPEN_LIM_H


30 
	#_XOPEN_LIM_H
 1

	)

32 
	#__Ãed_IOV_MAX


	)

33 
	~<b™s/¡dio_lim.h
>

65 
	#_XOPEN_IOV_MAX
 
_POSIX_UIO_MAXIOV


	)

70 
	#NL_ARGMAX
 
_POSIX_ARG_MAX


	)

73 
	#NL_LANGMAX
 
_POSIX2_LINE_MAX


	)

76 
	#NL_MSGMAX
 
INT_MAX


	)

80 
	#NL_NMAX
 
INT_MAX


	)

83 
	#NL_SETMAX
 
INT_MAX


	)

86 
	#NL_TEXTMAX
 
INT_MAX


	)

89 
	#NZERO
 20

	)

93 #ifdeà
INT_MAX


94 #ià
INT_MAX
 == 32767

95 
	#WORD_BIT
 16

	)

97 #ià
INT_MAX
 == 2147483647

98 
	#WORD_BIT
 32

	)

101 
	#WORD_BIT
 64

	)

104 #–ià
defšed
 
__INT_MAX__


105 #ià
__INT_MAX__
 == 32767

106 
	#WORD_BIT
 16

	)

108 #ià
__INT_MAX__
 == 2147483647

109 
	#WORD_BIT
 32

	)

112 
	#WORD_BIT
 64

	)

116 
	#WORD_BIT
 32

	)

120 #ifdeà
LONG_MAX


121 #ià
LONG_MAX
 == 2147483647

122 
	#LONG_BIT
 32

	)

125 
	#LONG_BIT
 64

	)

127 #–ià
defšed
 
__LONG_MAX__


128 #ià
__LONG_MAX__
 == 2147483647

129 
	#LONG_BIT
 32

	)

132 
	#LONG_BIT
 64

	)

135 
	~<b™s/wÜdsize.h
>

136 #ià
__WORDSIZE
 == 64

137 
	#LONG_BIT
 64

	)

139 
	#LONG_BIT
 32

	)

	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘İt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ılu¥lus


57 *
İrg
;

71 
İtšd
;

76 
İ‹¼
;

80 
İtİt
;

82 #iâdeà
__Ãed_g‘İt


104 
	sİtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#İtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtİts
),

161 
__posix_g‘İt
);

163 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtİts
è
__THROW
;

165 
	#g‘İt
 
__posix_g‘İt


	)

169 
g‘İt
 ();

172 #iâdeà
__Ãed_g‘İt


173 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtİts
,

175 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtİts
,

179 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ılu¥lus


189 #undeà
__Ãed_g‘İt


	@/usr/include/gnu/stubs.h

6 #ià!
defšed
 
__x86_64__


7 
	~<gnu/¡ubs-32.h
>

9 #ià
defšed
 
__x86_64__
 && defšed 
__LP64__


10 
	~<gnu/¡ubs-64.h
>

12 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


13 
	~<gnu/¡ubs-x32.h
>

	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ılu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¬k”
 {

157 
_IO_m¬k”
 *
	m_Ãxt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

165 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

166 
	mpublic
:

167 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

168 ~
¡»amm¬k”
();

169 
§všg
(è{  
	m_¥os
 == -2; }

170 
d–
(
¡»amm¬k”
&);

171 
d–
();

176 
	e__codecvt_»suÉ


178 
	m__codecvt_ok
,

179 
	m__codecvt_·¹Ÿl
,

180 
	m__codecvt_”rÜ
,

181 
	m__codecvt_nocÚv


184 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

190 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

191 
	m__mb¡©e_t
 *,

192 cÚ¡ 
	mwch¬_t
 *,

193 cÚ¡ 
	mwch¬_t
 *,

194 cÚ¡ 
	mwch¬_t
 **, *,

196 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

197 
	m__mb¡©e_t
 *, *,

199 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

200 
	m__mb¡©e_t
 *,

202 cÚ¡ **, 
	mwch¬_t
 *,

203 
	mwch¬_t
 *, wchar_t **);

204 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

207 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

210 
_IO_icÚv_t
 
	m__cd_š
;

211 
_IO_icÚv_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¬_t
 *
	m_IO_»ad_±r
;

218 
wch¬_t
 *
	m_IO_»ad_’d
;

219 
wch¬_t
 *
	m_IO_»ad_ba£
;

220 
wch¬_t
 *
	m_IO_wr™e_ba£
;

221 
wch¬_t
 *
	m_IO_wr™e_±r
;

222 
wch¬_t
 *
	m_IO_wr™e_’d
;

223 
wch¬_t
 *
	m_IO_buf_ba£
;

224 
wch¬_t
 *
	m_IO_buf_’d
;

226 
wch¬_t
 *
	m_IO_§ve_ba£
;

227 
wch¬_t
 *
	m_IO_backup_ba£
;

229 
wch¬_t
 *
	m_IO_§ve_’d
;

231 
__mb¡©e_t
 
	m_IO_¡©e
;

232 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¬_t
 
	m_shÜtbuf
[1];

237 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

241 
	s_IO_FILE
 {

242 
	m_æags
;

243 
	#_IO_fe_æags
 
_æags


	)

247 * 
	m_IO_»ad_±r
;

248 * 
	m_IO_»ad_’d
;

249 * 
	m_IO_»ad_ba£
;

250 * 
	m_IO_wr™e_ba£
;

251 * 
	m_IO_wr™e_±r
;

252 * 
	m_IO_wr™e_’d
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_’d
;

256 *
	m_IO_§ve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_§ve_’d
;

260 
_IO_m¬k”
 *
	m_m¬k”s
;

262 
_IO_FILE
 *
	m_chaš
;

264 
	m_f’o
;

266 
	m_blksize
;

268 
	m_æags2
;

270 
_IO_off_t
 
	m_Şd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cŞumn
;

275 sigÃd 
	m_vbË_off£t
;

276 
	m_shÜtbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifdeà
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com¶‘e


286 
_IO_FILE
 
	m_fe
;

288 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_ä“»s_li¡
;

295 *
	m_ä“»s_buf
;

297 *
	m__·d1
;

298 *
	m__·d2
;

299 *
	m__·d3
;

300 *
	m__·d4
;

302 
size_t
 
	m__·d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

309 #iâdeà
__ılu¥lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_¶us
;

315 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

316 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

317 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

318 #iâdeà
_LIBC


319 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

320 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

321 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

323 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

324 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

325 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

333 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

341 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_şo£_â
 (*
	t__cook›
);

356 #ifdeà
_GNU_SOURCE


358 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

359 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

360 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

361 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

366 
__io_»ad_â
 *
	m»ad
;

367 
__io_wr™e_â
 *
	mwr™e
;

368 
__io_£ek_â
 *
	m£ek
;

369 
__io_şo£_â
 *
	mşo£
;

370 } 
	t_IO_cook›_io_funùiÚs_t
;

371 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

373 
	g_IO_cook›_fe
;

376 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

377 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

381 #ifdeà
__ılu¥lus


385 
__und”æow
 (
_IO_FILE
 *);

386 
__uæow
 (
_IO_FILE
 *);

387 
__ov”æow
 (
_IO_FILE
 *, );

388 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

390 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

391 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

394 #ià 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

397 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

400 
	#_IO_g‘c_uÆocked
(
_å
) \

401 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

402 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

403 
	#_IO_³ekc_uÆocked
(
_å
) \

404 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

405 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

406 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

407 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

408 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

409 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

410 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

412 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_g‘wc_uÆocked
(
_å
) \

414 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

415 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

416 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

417 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

418 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

421 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

422 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

423 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

426 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

427 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

429 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

431 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

432 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

434 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

438 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

440 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

441 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

442 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

444 #ifdeà
_IO_MTSAFE_IO


445 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

446 
	#_IO_æockfe
(
_å
) \

447 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

448 
	#_IO_fuÆockfe
(
_å
) \

449 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

451 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

452 
	#_IO_æockfe
(
_å
è

	)

453 
	#_IO_fuÆockfe
(
_å
è

	)

454 
	#_IO_árylockfe
(
_å
è

	)

455 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

456 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

459 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

460 
_IO_va_li¡
, *
__»¡riù
);

461 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

462 
_IO_va_li¡
);

463 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

471 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

473 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

474 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

475 #ià
__GNUC__
 >= 2

478 #ià
defšed
 
_LIBC
 && defšed 
SHARED


479 
	~<shlib-com·t.h
>

480 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_šcom·tibË
 \

482 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

483 cÚ¡ 
_IO_¡dš_u£d
;

484 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

487 #iâdeà
_IO_fwide_maybe_šcom·tibË


488 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

492 
	#_IO_fwide
(
__å
, 
__mode
) \

493 ({ 
__»suÉ
 = (
__mode
); \

494 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

496 ià((
__å
)->
_mode
 == 0) \

498 (
__å
)->
_mode
 = -1; \

499 
__»suÉ
 = (
__å
)->
_mode
; \

501 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

502 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

504 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

505 
__»suÉ
; })

	)

508 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

509 
_IO_va_li¡
, *
__»¡riù
);

510 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

511 
_IO_va_li¡
);

512 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

513 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

516 #ifdeà
__LDBL_COMPAT


517 
	~<b™s/libio-ldbl.h
>

520 #ifdeà
__ılu¥lus


	@/usr/include/linux/sysctl.h

22 #iâdeà
_LINUX_SYSCTL_H


23 
	#_LINUX_SYSCTL_H


	)

25 
	~<lšux/k”Ãl.h
>

26 
	~<lšux/ty³s.h
>

29 
	gcom¶‘iÚ
;

31 
	#CTL_MAXNAME
 10

	)

36 
	s__sysùl_¬gs
 {

37 *
	mÇme
;

38 
	mÆ’
;

39 *
	mŞdv®
;

40 
size_t
 *
	mŞdËÅ
;

41 *
	mÃwv®
;

42 
size_t
 
	mÃwËn
;

43 
	m__unu£d
[4];

52 
	mCTL_KERN
=1,

53 
	mCTL_VM
=2,

54 
	mCTL_NET
=3,

55 
	mCTL_PROC
=4,

56 
	mCTL_FS
=5,

57 
	mCTL_DEBUG
=6,

58 
	mCTL_DEV
=7,

59 
	mCTL_BUS
=8,

60 
	mCTL_ABI
=9,

61 
	mCTL_CPU
=10,

62 
	mCTL_ARLAN
=254,

63 
	mCTL_S390DBF
=5677,

64 
	mCTL_SUNRPC
=7249,

65 
	mCTL_PM
=9899,

66 
	mCTL_FRV
=9898,

72 
	mCTL_BUS_ISA
=1

78 
	mINOTIFY_MAX_USER_INSTANCES
=1,

79 
	mINOTIFY_MAX_USER_WATCHES
=2,

80 
	mINOTIFY_MAX_QUEUED_EVENTS
=3

86 
	mKERN_OSTYPE
=1,

87 
	mKERN_OSRELEASE
=2,

88 
	mKERN_OSREV
=3,

89 
	mKERN_VERSION
=4,

90 
	mKERN_SECUREMASK
=5,

91 
	mKERN_PROF
=6,

92 
	mKERN_NODENAME
=7,

93 
	mKERN_DOMAINNAME
=8,

95 
	mKERN_PANIC
=15,

96 
	mKERN_REALROOTDEV
=16,

98 
	mKERN_SPARC_REBOOT
=21,

99 
	mKERN_CTLALTDEL
=22,

100 
	mKERN_PRINTK
=23,

101 
	mKERN_NAMETRANS
=24,

102 
	mKERN_PPC_HTABRECLAIM
=25,

103 
	mKERN_PPC_ZEROPAGED
=26,

104 
	mKERN_PPC_POWERSAVE_NAP
=27,

105 
	mKERN_MODPROBE
=28,

106 
	mKERN_SG_BIG_BUFF
=29,

107 
	mKERN_ACCT
=30,

108 
	mKERN_PPC_L2CR
=31,

110 
	mKERN_RTSIGNR
=32,

111 
	mKERN_RTSIGMAX
=33,

113 
	mKERN_SHMMAX
=34,

114 
	mKERN_MSGMAX
=35,

115 
	mKERN_MSGMNB
=36,

116 
	mKERN_MSGPOOL
=37,

117 
	mKERN_SYSRQ
=38,

118 
	mKERN_MAX_THREADS
=39,

119 
	mKERN_RANDOM
=40,

120 
	mKERN_SHMALL
=41,

121 
	mKERN_MSGMNI
=42,

122 
	mKERN_SEM
=43,

123 
	mKERN_SPARC_STOP_A
=44,

124 
	mKERN_SHMMNI
=45,

125 
	mKERN_OVERFLOWUID
=46,

126 
	mKERN_OVERFLOWGID
=47,

127 
	mKERN_SHMPATH
=48,

128 
	mKERN_HOTPLUG
=49,

129 
	mKERN_IEEE_EMULATION_WARNINGS
=50,

130 
	mKERN_S390_USER_DEBUG_LOGGING
=51,

131 
	mKERN_CORE_USES_PID
=52,

132 
	mKERN_TAINTED
=53,

133 
	mKERN_CADPID
=54,

134 
	mKERN_PIDMAX
=55,

135 
	mKERN_CORE_PATTERN
=56,

136 
	mKERN_PANIC_ON_OOPS
=57,

137 
	mKERN_HPPA_PWRSW
=58,

138 
	mKERN_HPPA_UNALIGNED
=59,

139 
	mKERN_PRINTK_RATELIMIT
=60,

140 
	mKERN_PRINTK_RATELIMIT_BURST
=61,

141 
	mKERN_PTY
=62,

142 
	mKERN_NGROUPS_MAX
=63,

143 
	mKERN_SPARC_SCONS_PWROFF
=64,

144 
	mKERN_HZ_TIMER
=65,

145 
	mKERN_UNKNOWN_NMI_PANIC
=66,

146 
	mKERN_BOOTLOADER_TYPE
=67,

147 
	mKERN_RANDOMIZE
=68,

148 
	mKERN_SETUID_DUMPABLE
=69,

149 
	mKERN_SPIN_RETRY
=70,

150 
	mKERN_ACPI_VIDEO_FLAGS
=71,

151 
	mKERN_IA64_UNALIGNED
=72,

152 
	mKERN_COMPAT_LOG
=73,

153 
	mKERN_MAX_LOCK_DEPTH
=74,

154 
	mKERN_NMI_WATCHDOG
=75,

155 
	mKERN_PANIC_ON_NMI
=76,

156 
	mKERN_PANIC_ON_WARN
=77,

164 
	mVM_UNUSED1
=1,

165 
	mVM_UNUSED2
=2,

166 
	mVM_UNUSED3
=3,

167 
	mVM_UNUSED4
=4,

168 
	mVM_OVERCOMMIT_MEMORY
=5,

169 
	mVM_UNUSED5
=6,

170 
	mVM_UNUSED7
=7,

171 
	mVM_UNUSED8
=8,

172 
	mVM_UNUSED9
=9,

173 
	mVM_PAGE_CLUSTER
=10,

174 
	mVM_DIRTY_BACKGROUND
=11,

175 
	mVM_DIRTY_RATIO
=12,

176 
	mVM_DIRTY_WB_CS
=13,

177 
	mVM_DIRTY_EXPIRE_CS
=14,

178 
	mVM_NR_PDFLUSH_THREADS
=15,

179 
	mVM_OVERCOMMIT_RATIO
=16,

180 
	mVM_PAGEBUF
=17,

181 
	mVM_HUGETLB_PAGES
=18,

182 
	mVM_SWAPPINESS
=19,

183 
	mVM_LOWMEM_RESERVE_RATIO
=20,

184 
	mVM_MIN_FREE_KBYTES
=21,

185 
	mVM_MAX_MAP_COUNT
=22,

186 
	mVM_LAPTOP_MODE
=23,

187 
	mVM_BLOCK_DUMP
=24,

188 
	mVM_HUGETLB_GROUP
=25,

189 
	mVM_VFS_CACHE_PRESSURE
=26,

190 
	mVM_LEGACY_VA_LAYOUT
=27,

191 
	mVM_SWAP_TOKEN_TIMEOUT
=28,

192 
	mVM_DROP_PAGECACHE
=29,

193 
	mVM_PERCPU_PAGELIST_FRACTION
=30,

194 
	mVM_ZONE_RECLAIM_MODE
=31,

195 
	mVM_MIN_UNMAPPED
=32,

196 
	mVM_PANIC_ON_OOM
=33,

197 
	mVM_VDSO_ENABLED
=34,

198 
	mVM_MIN_SLAB
=35,

205 
	mNET_CORE
=1,

206 
	mNET_ETHER
=2,

207 
	mNET_802
=3,

208 
	mNET_UNIX
=4,

209 
	mNET_IPV4
=5,

210 
	mNET_IPX
=6,

211 
	mNET_ATALK
=7,

212 
	mNET_NETROM
=8,

213 
	mNET_AX25
=9,

214 
	mNET_BRIDGE
=10,

215 
	mNET_ROSE
=11,

216 
	mNET_IPV6
=12,

217 
	mNET_X25
=13,

218 
	mNET_TR
=14,

219 
	mNET_DECNET
=15,

220 
	mNET_ECONET
=16,

221 
	mNET_SCTP
=17,

222 
	mNET_LLC
=18,

223 
	mNET_NETFILTER
=19,

224 
	mNET_DCCP
=20,

225 
	mNET_IRDA
=412,

231 
	mRANDOM_POOLSIZE
=1,

232 
	mRANDOM_ENTROPY_COUNT
=2,

233 
	mRANDOM_READ_THRESH
=3,

234 
	mRANDOM_WRITE_THRESH
=4,

235 
	mRANDOM_BOOT_ID
=5,

236 
	mRANDOM_UUID
=6

242 
	mPTY_MAX
=1,

243 
	mPTY_NR
=2

249 
	mBUS_ISA_MEM_BASE
=1,

250 
	mBUS_ISA_PORT_BASE
=2,

251 
	mBUS_ISA_PORT_SHIFT
=3

257 
	mNET_CORE_WMEM_MAX
=1,

258 
	mNET_CORE_RMEM_MAX
=2,

259 
	mNET_CORE_WMEM_DEFAULT
=3,

260 
	mNET_CORE_RMEM_DEFAULT
=4,

262 
	mNET_CORE_MAX_BACKLOG
=6,

263 
	mNET_CORE_FASTROUTE
=7,

264 
	mNET_CORE_MSG_COST
=8,

265 
	mNET_CORE_MSG_BURST
=9,

266 
	mNET_CORE_OPTMEM_MAX
=10,

267 
	mNET_CORE_HOT_LIST_LENGTH
=11,

268 
	mNET_CORE_DIVERT_VERSION
=12,

269 
	mNET_CORE_NO_CONG_THRESH
=13,

270 
	mNET_CORE_NO_CONG
=14,

271 
	mNET_CORE_LO_CONG
=15,

272 
	mNET_CORE_MOD_CONG
=16,

273 
	mNET_CORE_DEV_WEIGHT
=17,

274 
	mNET_CORE_SOMAXCONN
=18,

275 
	mNET_CORE_BUDGET
=19,

276 
	mNET_CORE_AEVENT_ETIME
=20,

277 
	mNET_CORE_AEVENT_RSEQTH
=21,

278 
	mNET_CORE_WARNINGS
=22,

289 
	mNET_UNIX_DESTROY_DELAY
=1,

290 
	mNET_UNIX_DELETE_DELAY
=2,

291 
	mNET_UNIX_MAX_DGRAM_QLEN
=3,

297 
	mNET_NF_CONNTRACK_MAX
=1,

298 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

299 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

300 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

301 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

302 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

303 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

304 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

305 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

306 
	mNET_NF_CONNTRACK_UDP_TIMEOUT
=10,

307 
	mNET_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

308 
	mNET_NF_CONNTRACK_ICMP_TIMEOUT
=12,

309 
	mNET_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

310 
	mNET_NF_CONNTRACK_BUCKETS
=14,

311 
	mNET_NF_CONNTRACK_LOG_INVALID
=15,

312 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

313 
	mNET_NF_CONNTRACK_TCP_LOOSE
=17,

314 
	mNET_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

315 
	mNET_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

316 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

317 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

318 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

319 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

320 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

321 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

322 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

323 
	mNET_NF_CONNTRACK_COUNT
=27,

324 
	mNET_NF_CONNTRACK_ICMPV6_TIMEOUT
=28,

325 
	mNET_NF_CONNTRACK_FRAG6_TIMEOUT
=29,

326 
	mNET_NF_CONNTRACK_FRAG6_LOW_THRESH
=30,

327 
	mNET_NF_CONNTRACK_FRAG6_HIGH_THRESH
=31,

328 
	mNET_NF_CONNTRACK_CHECKSUM
=32,

335 
	mNET_IPV4_FORWARD
=8,

336 
	mNET_IPV4_DYNADDR
=9,

338 
	mNET_IPV4_CONF
=16,

339 
	mNET_IPV4_NEIGH
=17,

340 
	mNET_IPV4_ROUTE
=18,

341 
	mNET_IPV4_FIB_HASH
=19,

342 
	mNET_IPV4_NETFILTER
=20,

344 
	mNET_IPV4_TCP_TIMESTAMPS
=33,

345 
	mNET_IPV4_TCP_WINDOW_SCALING
=34,

346 
	mNET_IPV4_TCP_SACK
=35,

347 
	mNET_IPV4_TCP_RETRANS_COLLAPSE
=36,

348 
	mNET_IPV4_DEFAULT_TTL
=37,

349 
	mNET_IPV4_AUTOCONFIG
=38,

350 
	mNET_IPV4_NO_PMTU_DISC
=39,

351 
	mNET_IPV4_TCP_SYN_RETRIES
=40,

352 
	mNET_IPV4_IPFRAG_HIGH_THRESH
=41,

353 
	mNET_IPV4_IPFRAG_LOW_THRESH
=42,

354 
	mNET_IPV4_IPFRAG_TIME
=43,

355 
	mNET_IPV4_TCP_MAX_KA_PROBES
=44,

356 
	mNET_IPV4_TCP_KEEPALIVE_TIME
=45,

357 
	mNET_IPV4_TCP_KEEPALIVE_PROBES
=46,

358 
	mNET_IPV4_TCP_RETRIES1
=47,

359 
	mNET_IPV4_TCP_RETRIES2
=48,

360 
	mNET_IPV4_TCP_FIN_TIMEOUT
=49,

361 
	mNET_IPV4_IP_MASQ_DEBUG
=50,

362 
	mNET_TCP_SYNCOOKIES
=51,

363 
	mNET_TCP_STDURG
=52,

364 
	mNET_TCP_RFC1337
=53,

365 
	mNET_TCP_SYN_TAILDROP
=54,

366 
	mNET_TCP_MAX_SYN_BACKLOG
=55,

367 
	mNET_IPV4_LOCAL_PORT_RANGE
=56,

368 
	mNET_IPV4_ICMP_ECHO_IGNORE_ALL
=57,

369 
	mNET_IPV4_ICMP_ECHO_IGNORE_BROADCASTS
=58,

370 
	mNET_IPV4_ICMP_SOURCEQUENCH_RATE
=59,

371 
	mNET_IPV4_ICMP_DESTUNREACH_RATE
=60,

372 
	mNET_IPV4_ICMP_TIMEEXCEED_RATE
=61,

373 
	mNET_IPV4_ICMP_PARAMPROB_RATE
=62,

374 
	mNET_IPV4_ICMP_ECHOREPLY_RATE
=63,

375 
	mNET_IPV4_ICMP_IGNORE_BOGUS_ERROR_RESPONSES
=64,

376 
	mNET_IPV4_IGMP_MAX_MEMBERSHIPS
=65,

377 
	mNET_TCP_TW_RECYCLE
=66,

378 
	mNET_IPV4_ALWAYS_DEFRAG
=67,

379 
	mNET_IPV4_TCP_KEEPALIVE_INTVL
=68,

380 
	mNET_IPV4_INET_PEER_THRESHOLD
=69,

381 
	mNET_IPV4_INET_PEER_MINTTL
=70,

382 
	mNET_IPV4_INET_PEER_MAXTTL
=71,

383 
	mNET_IPV4_INET_PEER_GC_MINTIME
=72,

384 
	mNET_IPV4_INET_PEER_GC_MAXTIME
=73,

385 
	mNET_TCP_ORPHAN_RETRIES
=74,

386 
	mNET_TCP_ABORT_ON_OVERFLOW
=75,

387 
	mNET_TCP_SYNACK_RETRIES
=76,

388 
	mNET_TCP_MAX_ORPHANS
=77,

389 
	mNET_TCP_MAX_TW_BUCKETS
=78,

390 
	mNET_TCP_FACK
=79,

391 
	mNET_TCP_REORDERING
=80,

392 
	mNET_TCP_ECN
=81,

393 
	mNET_TCP_DSACK
=82,

394 
	mNET_TCP_MEM
=83,

395 
	mNET_TCP_WMEM
=84,

396 
	mNET_TCP_RMEM
=85,

397 
	mNET_TCP_APP_WIN
=86,

398 
	mNET_TCP_ADV_WIN_SCALE
=87,

399 
	mNET_IPV4_NONLOCAL_BIND
=88,

400 
	mNET_IPV4_ICMP_RATELIMIT
=89,

401 
	mNET_IPV4_ICMP_RATEMASK
=90,

402 
	mNET_TCP_TW_REUSE
=91,

403 
	mNET_TCP_FRTO
=92,

404 
	mNET_TCP_LOW_LATENCY
=93,

405 
	mNET_IPV4_IPFRAG_SECRET_INTERVAL
=94,

406 
	mNET_IPV4_IGMP_MAX_MSF
=96,

407 
	mNET_TCP_NO_METRICS_SAVE
=97,

408 
	mNET_TCP_DEFAULT_WIN_SCALE
=105,

409 
	mNET_TCP_MODERATE_RCVBUF
=106,

410 
	mNET_TCP_TSO_WIN_DIVISOR
=107,

411 
	mNET_TCP_BIC_BETA
=108,

412 
	mNET_IPV4_ICMP_ERRORS_USE_INBOUND_IFADDR
=109,

413 
	mNET_TCP_CONG_CONTROL
=110,

414 
	mNET_TCP_ABC
=111,

415 
	mNET_IPV4_IPFRAG_MAX_DIST
=112,

416 
	mNET_TCP_MTU_PROBING
=113,

417 
	mNET_TCP_BASE_MSS
=114,

418 
	mNET_IPV4_TCP_WORKAROUND_SIGNED_WINDOWS
=115,

419 
	mNET_TCP_DMA_COPYBREAK
=116,

420 
	mNET_TCP_SLOW_START_AFTER_IDLE
=117,

421 
	mNET_CIPSOV4_CACHE_ENABLE
=118,

422 
	mNET_CIPSOV4_CACHE_BUCKET_SIZE
=119,

423 
	mNET_CIPSOV4_RBM_OPTFMT
=120,

424 
	mNET_CIPSOV4_RBM_STRICTVALID
=121,

425 
	mNET_TCP_AVAIL_CONG_CONTROL
=122,

426 
	mNET_TCP_ALLOWED_CONG_CONTROL
=123,

427 
	mNET_TCP_MAX_SSTHRESH
=124,

428 
	mNET_TCP_FRTO_RESPONSE
=125,

432 
	mNET_IPV4_ROUTE_FLUSH
=1,

433 
	mNET_IPV4_ROUTE_MIN_DELAY
=2,

434 
	mNET_IPV4_ROUTE_MAX_DELAY
=3,

435 
	mNET_IPV4_ROUTE_GC_THRESH
=4,

436 
	mNET_IPV4_ROUTE_MAX_SIZE
=5,

437 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL
=6,

438 
	mNET_IPV4_ROUTE_GC_TIMEOUT
=7,

439 
	mNET_IPV4_ROUTE_GC_INTERVAL
=8,

440 
	mNET_IPV4_ROUTE_REDIRECT_LOAD
=9,

441 
	mNET_IPV4_ROUTE_REDIRECT_NUMBER
=10,

442 
	mNET_IPV4_ROUTE_REDIRECT_SILENCE
=11,

443 
	mNET_IPV4_ROUTE_ERROR_COST
=12,

444 
	mNET_IPV4_ROUTE_ERROR_BURST
=13,

445 
	mNET_IPV4_ROUTE_GC_ELASTICITY
=14,

446 
	mNET_IPV4_ROUTE_MTU_EXPIRES
=15,

447 
	mNET_IPV4_ROUTE_MIN_PMTU
=16,

448 
	mNET_IPV4_ROUTE_MIN_ADVMSS
=17,

449 
	mNET_IPV4_ROUTE_SECRET_INTERVAL
=18,

450 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL_MS
=19,

455 
	mNET_PROTO_CONF_ALL
=-2,

456 
	mNET_PROTO_CONF_DEFAULT
=-3

463 
	mNET_IPV4_CONF_FORWARDING
=1,

464 
	mNET_IPV4_CONF_MC_FORWARDING
=2,

465 
	mNET_IPV4_CONF_PROXY_ARP
=3,

466 
	mNET_IPV4_CONF_ACCEPT_REDIRECTS
=4,

467 
	mNET_IPV4_CONF_SECURE_REDIRECTS
=5,

468 
	mNET_IPV4_CONF_SEND_REDIRECTS
=6,

469 
	mNET_IPV4_CONF_SHARED_MEDIA
=7,

470 
	mNET_IPV4_CONF_RP_FILTER
=8,

471 
	mNET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
=9,

472 
	mNET_IPV4_CONF_BOOTP_RELAY
=10,

473 
	mNET_IPV4_CONF_LOG_MARTIANS
=11,

474 
	mNET_IPV4_CONF_TAG
=12,

475 
	mNET_IPV4_CONF_ARPFILTER
=13,

476 
	mNET_IPV4_CONF_MEDIUM_ID
=14,

477 
	mNET_IPV4_CONF_NOXFRM
=15,

478 
	mNET_IPV4_CONF_NOPOLICY
=16,

479 
	mNET_IPV4_CONF_FORCE_IGMP_VERSION
=17,

480 
	mNET_IPV4_CONF_ARP_ANNOUNCE
=18,

481 
	mNET_IPV4_CONF_ARP_IGNORE
=19,

482 
	mNET_IPV4_CONF_PROMOTE_SECONDARIES
=20,

483 
	mNET_IPV4_CONF_ARP_ACCEPT
=21,

484 
	mNET_IPV4_CONF_ARP_NOTIFY
=22,

490 
	mNET_IPV4_NF_CONNTRACK_MAX
=1,

491 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

492 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

493 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

494 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

495 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

496 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

497 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

498 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

499 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT
=10,

500 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

501 
	mNET_IPV4_NF_CONNTRACK_ICMP_TIMEOUT
=12,

502 
	mNET_IPV4_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

503 
	mNET_IPV4_NF_CONNTRACK_BUCKETS
=14,

504 
	mNET_IPV4_NF_CONNTRACK_LOG_INVALID
=15,

505 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

506 
	mNET_IPV4_NF_CONNTRACK_TCP_LOOSE
=17,

507 
	mNET_IPV4_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

508 
	mNET_IPV4_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

509 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

510 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

511 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

512 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

513 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

514 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

515 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

516 
	mNET_IPV4_NF_CONNTRACK_COUNT
=27,

517 
	mNET_IPV4_NF_CONNTRACK_CHECKSUM
=28,

522 
	mNET_IPV6_CONF
=16,

523 
	mNET_IPV6_NEIGH
=17,

524 
	mNET_IPV6_ROUTE
=18,

525 
	mNET_IPV6_ICMP
=19,

526 
	mNET_IPV6_BINDV6ONLY
=20,

527 
	mNET_IPV6_IP6FRAG_HIGH_THRESH
=21,

528 
	mNET_IPV6_IP6FRAG_LOW_THRESH
=22,

529 
	mNET_IPV6_IP6FRAG_TIME
=23,

530 
	mNET_IPV6_IP6FRAG_SECRET_INTERVAL
=24,

531 
	mNET_IPV6_MLD_MAX_MSF
=25,

535 
	mNET_IPV6_ROUTE_FLUSH
=1,

536 
	mNET_IPV6_ROUTE_GC_THRESH
=2,

537 
	mNET_IPV6_ROUTE_MAX_SIZE
=3,

538 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL
=4,

539 
	mNET_IPV6_ROUTE_GC_TIMEOUT
=5,

540 
	mNET_IPV6_ROUTE_GC_INTERVAL
=6,

541 
	mNET_IPV6_ROUTE_GC_ELASTICITY
=7,

542 
	mNET_IPV6_ROUTE_MTU_EXPIRES
=8,

543 
	mNET_IPV6_ROUTE_MIN_ADVMSS
=9,

544 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL_MS
=10

548 
	mNET_IPV6_FORWARDING
=1,

549 
	mNET_IPV6_HOP_LIMIT
=2,

550 
	mNET_IPV6_MTU
=3,

551 
	mNET_IPV6_ACCEPT_RA
=4,

552 
	mNET_IPV6_ACCEPT_REDIRECTS
=5,

553 
	mNET_IPV6_AUTOCONF
=6,

554 
	mNET_IPV6_DAD_TRANSMITS
=7,

555 
	mNET_IPV6_RTR_SOLICITS
=8,

556 
	mNET_IPV6_RTR_SOLICIT_INTERVAL
=9,

557 
	mNET_IPV6_RTR_SOLICIT_DELAY
=10,

558 
	mNET_IPV6_USE_TEMPADDR
=11,

559 
	mNET_IPV6_TEMP_VALID_LFT
=12,

560 
	mNET_IPV6_TEMP_PREFERED_LFT
=13,

561 
	mNET_IPV6_REGEN_MAX_RETRY
=14,

562 
	mNET_IPV6_MAX_DESYNC_FACTOR
=15,

563 
	mNET_IPV6_MAX_ADDRESSES
=16,

564 
	mNET_IPV6_FORCE_MLD_VERSION
=17,

565 
	mNET_IPV6_ACCEPT_RA_DEFRTR
=18,

566 
	mNET_IPV6_ACCEPT_RA_PINFO
=19,

567 
	mNET_IPV6_ACCEPT_RA_RTR_PREF
=20,

568 
	mNET_IPV6_RTR_PROBE_INTERVAL
=21,

569 
	mNET_IPV6_ACCEPT_RA_RT_INFO_MAX_PLEN
=22,

570 
	mNET_IPV6_PROXY_NDP
=23,

571 
	mNET_IPV6_ACCEPT_SOURCE_ROUTE
=25,

572 
	mNET_IPV6_ACCEPT_RA_FROM_LOCAL
=26,

573 
	m__NET_IPV6_MAX


578 
	mNET_IPV6_ICMP_RATELIMIT
=1

583 
	mNET_NEIGH_MCAST_SOLICIT
=1,

584 
	mNET_NEIGH_UCAST_SOLICIT
=2,

585 
	mNET_NEIGH_APP_SOLICIT
=3,

586 
	mNET_NEIGH_RETRANS_TIME
=4,

587 
	mNET_NEIGH_REACHABLE_TIME
=5,

588 
	mNET_NEIGH_DELAY_PROBE_TIME
=6,

589 
	mNET_NEIGH_GC_STALE_TIME
=7,

590 
	mNET_NEIGH_UNRES_QLEN
=8,

591 
	mNET_NEIGH_PROXY_QLEN
=9,

592 
	mNET_NEIGH_ANYCAST_DELAY
=10,

593 
	mNET_NEIGH_PROXY_DELAY
=11,

594 
	mNET_NEIGH_LOCKTIME
=12,

595 
	mNET_NEIGH_GC_INTERVAL
=13,

596 
	mNET_NEIGH_GC_THRESH1
=14,

597 
	mNET_NEIGH_GC_THRESH2
=15,

598 
	mNET_NEIGH_GC_THRESH3
=16,

599 
	mNET_NEIGH_RETRANS_TIME_MS
=17,

600 
	mNET_NEIGH_REACHABLE_TIME_MS
=18,

605 
	mNET_DCCP_DEFAULT
=1,

610 
	mNET_IPX_PPROP_BROADCASTING
=1,

611 
	mNET_IPX_FORWARDING
=2

616 
	mNET_LLC2
=1,

617 
	mNET_LLC_STATION
=2,

622 
	mNET_LLC2_TIMEOUT
=1,

627 
	mNET_LLC_STATION_ACK_TIMEOUT
=1,

632 
	mNET_LLC2_ACK_TIMEOUT
=1,

633 
	mNET_LLC2_P_TIMEOUT
=2,

634 
	mNET_LLC2_REJ_TIMEOUT
=3,

635 
	mNET_LLC2_BUSY_TIMEOUT
=4,

640 
	mNET_ATALK_AARP_EXPIRY_TIME
=1,

641 
	mNET_ATALK_AARP_TICK_TIME
=2,

642 
	mNET_ATALK_AARP_RETRANSMIT_LIMIT
=3,

643 
	mNET_ATALK_AARP_RESOLVE_TIME
=4

649 
	mNET_NETROM_DEFAULT_PATH_QUALITY
=1,

650 
	mNET_NETROM_OBSOLESCENCE_COUNT_INITIALISER
=2,

651 
	mNET_NETROM_NETWORK_TTL_INITIALISER
=3,

652 
	mNET_NETROM_TRANSPORT_TIMEOUT
=4,

653 
	mNET_NETROM_TRANSPORT_MAXIMUM_TRIES
=5,

654 
	mNET_NETROM_TRANSPORT_ACKNOWLEDGE_DELAY
=6,

655 
	mNET_NETROM_TRANSPORT_BUSY_DELAY
=7,

656 
	mNET_NETROM_TRANSPORT_REQUESTED_WINDOW_SIZE
=8,

657 
	mNET_NETROM_TRANSPORT_NO_ACTIVITY_TIMEOUT
=9,

658 
	mNET_NETROM_ROUTING_CONTROL
=10,

659 
	mNET_NETROM_LINK_FAILS_COUNT
=11,

660 
	mNET_NETROM_RESET
=12

665 
	mNET_AX25_IP_DEFAULT_MODE
=1,

666 
	mNET_AX25_DEFAULT_MODE
=2,

667 
	mNET_AX25_BACKOFF_TYPE
=3,

668 
	mNET_AX25_CONNECT_MODE
=4,

669 
	mNET_AX25_STANDARD_WINDOW
=5,

670 
	mNET_AX25_EXTENDED_WINDOW
=6,

671 
	mNET_AX25_T1_TIMEOUT
=7,

672 
	mNET_AX25_T2_TIMEOUT
=8,

673 
	mNET_AX25_T3_TIMEOUT
=9,

674 
	mNET_AX25_IDLE_TIMEOUT
=10,

675 
	mNET_AX25_N2
=11,

676 
	mNET_AX25_PACLEN
=12,

677 
	mNET_AX25_PROTOCOL
=13,

678 
	mNET_AX25_DAMA_SLAVE_TIMEOUT
=14

683 
	mNET_ROSE_RESTART_REQUEST_TIMEOUT
=1,

684 
	mNET_ROSE_CALL_REQUEST_TIMEOUT
=2,

685 
	mNET_ROSE_RESET_REQUEST_TIMEOUT
=3,

686 
	mNET_ROSE_CLEAR_REQUEST_TIMEOUT
=4,

687 
	mNET_ROSE_ACK_HOLD_BACK_TIMEOUT
=5,

688 
	mNET_ROSE_ROUTING_CONTROL
=6,

689 
	mNET_ROSE_LINK_FAIL_TIMEOUT
=7,

690 
	mNET_ROSE_MAX_VCS
=8,

691 
	mNET_ROSE_WINDOW_SIZE
=9,

692 
	mNET_ROSE_NO_ACTIVITY_TIMEOUT
=10

697 
	mNET_X25_RESTART_REQUEST_TIMEOUT
=1,

698 
	mNET_X25_CALL_REQUEST_TIMEOUT
=2,

699 
	mNET_X25_RESET_REQUEST_TIMEOUT
=3,

700 
	mNET_X25_CLEAR_REQUEST_TIMEOUT
=4,

701 
	mNET_X25_ACK_HOLD_BACK_TIMEOUT
=5,

702 
	mNET_X25_FORWARD
=6

708 
	mNET_TR_RIF_TIMEOUT
=1

713 
	mNET_DECNET_NODE_TYPE
 = 1,

714 
	mNET_DECNET_NODE_ADDRESS
 = 2,

715 
	mNET_DECNET_NODE_NAME
 = 3,

716 
	mNET_DECNET_DEFAULT_DEVICE
 = 4,

717 
	mNET_DECNET_TIME_WAIT
 = 5,

718 
	mNET_DECNET_DN_COUNT
 = 6,

719 
	mNET_DECNET_DI_COUNT
 = 7,

720 
	mNET_DECNET_DR_COUNT
 = 8,

721 
	mNET_DECNET_DST_GC_INTERVAL
 = 9,

722 
	mNET_DECNET_CONF
 = 10,

723 
	mNET_DECNET_NO_FC_MAX_CWND
 = 11,

724 
	mNET_DECNET_MEM
 = 12,

725 
	mNET_DECNET_RMEM
 = 13,

726 
	mNET_DECNET_WMEM
 = 14,

727 
	mNET_DECNET_DEBUG_LEVEL
 = 255

732 
	mNET_DECNET_CONF_LOOPBACK
 = -2,

733 
	mNET_DECNET_CONF_DDCMP
 = -3,

734 
	mNET_DECNET_CONF_PPP
 = -4,

735 
	mNET_DECNET_CONF_X25
 = -5,

736 
	mNET_DECNET_CONF_GRE
 = -6,

737 
	mNET_DECNET_CONF_ETHER
 = -7

744 
	mNET_DECNET_CONF_DEV_PRIORITY
 = 1,

745 
	mNET_DECNET_CONF_DEV_T1
 = 2,

746 
	mNET_DECNET_CONF_DEV_T2
 = 3,

747 
	mNET_DECNET_CONF_DEV_T3
 = 4,

748 
	mNET_DECNET_CONF_DEV_FORWARDING
 = 5,

749 
	mNET_DECNET_CONF_DEV_BLKSIZE
 = 6,

750 
	mNET_DECNET_CONF_DEV_STATE
 = 7

755 
	mNET_SCTP_RTO_INITIAL
 = 1,

756 
	mNET_SCTP_RTO_MIN
 = 2,

757 
	mNET_SCTP_RTO_MAX
 = 3,

758 
	mNET_SCTP_RTO_ALPHA
 = 4,

759 
	mNET_SCTP_RTO_BETA
 = 5,

760 
	mNET_SCTP_VALID_COOKIE_LIFE
 = 6,

761 
	mNET_SCTP_ASSOCIATION_MAX_RETRANS
 = 7,

762 
	mNET_SCTP_PATH_MAX_RETRANS
 = 8,

763 
	mNET_SCTP_MAX_INIT_RETRANSMITS
 = 9,

764 
	mNET_SCTP_HB_INTERVAL
 = 10,

765 
	mNET_SCTP_PRESERVE_ENABLE
 = 11,

766 
	mNET_SCTP_MAX_BURST
 = 12,

767 
	mNET_SCTP_ADDIP_ENABLE
 = 13,

768 
	mNET_SCTP_PRSCTP_ENABLE
 = 14,

769 
	mNET_SCTP_SNDBUF_POLICY
 = 15,

770 
	mNET_SCTP_SACK_TIMEOUT
 = 16,

771 
	mNET_SCTP_RCVBUF_POLICY
 = 17,

776 
	mNET_BRIDGE_NF_CALL_ARPTABLES
 = 1,

777 
	mNET_BRIDGE_NF_CALL_IPTABLES
 = 2,

778 
	mNET_BRIDGE_NF_CALL_IP6TABLES
 = 3,

779 
	mNET_BRIDGE_NF_FILTER_VLAN_TAGGED
 = 4,

780 
	mNET_BRIDGE_NF_FILTER_PPPOE_TAGGED
 = 5,

785 
	mNET_IRDA_DISCOVERY
=1,

786 
	mNET_IRDA_DEVNAME
=2,

787 
	mNET_IRDA_DEBUG
=3,

788 
	mNET_IRDA_FAST_POLL
=4,

789 
	mNET_IRDA_DISCOVERY_SLOTS
=5,

790 
	mNET_IRDA_DISCOVERY_TIMEOUT
=6,

791 
	mNET_IRDA_SLOT_TIMEOUT
=7,

792 
	mNET_IRDA_MAX_BAUD_RATE
=8,

793 
	mNET_IRDA_MIN_TX_TURN_TIME
=9,

794 
	mNET_IRDA_MAX_TX_DATA_SIZE
=10,

795 
	mNET_IRDA_MAX_TX_WINDOW
=11,

796 
	mNET_IRDA_MAX_NOREPLY_TIME
=12,

797 
	mNET_IRDA_WARN_NOREPLY_TIME
=13,

798 
	mNET_IRDA_LAP_KEEPALIVE_TIME
=14,

805 
	mFS_NRINODE
=1,

806 
	mFS_STATINODE
=2,

807 
	mFS_MAXINODE
=3,

808 
	mFS_NRDQUOT
=4,

809 
	mFS_MAXDQUOT
=5,

810 
	mFS_NRFILE
=6,

811 
	mFS_MAXFILE
=7,

812 
	mFS_DENTRY
=8,

813 
	mFS_NRSUPER
=9,

814 
	mFS_MAXSUPER
=10,

815 
	mFS_OVERFLOWUID
=11,

816 
	mFS_OVERFLOWGID
=12,

817 
	mFS_LEASES
=13,

818 
	mFS_DIR_NOTIFY
=14,

819 
	mFS_LEASE_TIME
=15,

820 
	mFS_DQSTATS
=16,

821 
	mFS_XFS
=17,

822 
	mFS_AIO_NR
=18,

823 
	mFS_AIO_MAX_NR
=19,

824 
	mFS_INOTIFY
=20,

825 
	mFS_OCFS2
=988,

830 
	mFS_DQ_LOOKUPS
 = 1,

831 
	mFS_DQ_DROPS
 = 2,

832 
	mFS_DQ_READS
 = 3,

833 
	mFS_DQ_WRITES
 = 4,

834 
	mFS_DQ_CACHE_HITS
 = 5,

835 
	mFS_DQ_ALLOCATED
 = 6,

836 
	mFS_DQ_FREE
 = 7,

837 
	mFS_DQ_SYNCS
 = 8,

838 
	mFS_DQ_WARNINGS
 = 9,

845 
	mDEV_CDROM
=1,

846 
	mDEV_HWMON
=2,

847 
	mDEV_PARPORT
=3,

848 
	mDEV_RAID
=4,

849 
	mDEV_MAC_HID
=5,

850 
	mDEV_SCSI
=6,

851 
	mDEV_IPMI
=7,

856 
	mDEV_CDROM_INFO
=1,

857 
	mDEV_CDROM_AUTOCLOSE
=2,

858 
	mDEV_CDROM_AUTOEJECT
=3,

859 
	mDEV_CDROM_DEBUG
=4,

860 
	mDEV_CDROM_LOCK
=5,

861 
	mDEV_CDROM_CHECK_MEDIA
=6

866 
	mDEV_PARPORT_DEFAULT
=-3

871 
	mDEV_RAID_SPEED_LIMIT_MIN
=1,

872 
	mDEV_RAID_SPEED_LIMIT_MAX
=2

877 
	mDEV_PARPORT_DEFAULT_TIMESLICE
=1,

878 
	mDEV_PARPORT_DEFAULT_SPINTIME
=2

883 
	mDEV_PARPORT_SPINTIME
=1,

884 
	mDEV_PARPORT_BASE_ADDR
=2,

885 
	mDEV_PARPORT_IRQ
=3,

886 
	mDEV_PARPORT_DMA
=4,

887 
	mDEV_PARPORT_MODES
=5,

888 
	mDEV_PARPORT_DEVICES
=6,

889 
	mDEV_PARPORT_AUTOPROBE
=16

894 
	mDEV_PARPORT_DEVICES_ACTIVE
=-3,

899 
	mDEV_PARPORT_DEVICE_TIMESLICE
=1,

904 
	mDEV_MAC_HID_KEYBOARD_SENDS_LINUX_KEYCODES
=1,

905 
	mDEV_MAC_HID_KEYBOARD_LOCK_KEYCODES
=2,

906 
	mDEV_MAC_HID_MOUSE_BUTTON_EMULATION
=3,

907 
	mDEV_MAC_HID_MOUSE_BUTTON2_KEYCODE
=4,

908 
	mDEV_MAC_HID_MOUSE_BUTTON3_KEYCODE
=5,

909 
	mDEV_MAC_HID_ADB_MOUSE_SENDS_KEYCODES
=6

914 
	mDEV_SCSI_LOGGING_LEVEL
=1,

919 
	mDEV_IPMI_POWEROFF_POWERCYCLE
=1,

925 
	mABI_DEFHANDLER_COFF
=1,

926 
	mABI_DEFHANDLER_ELF
=2,

927 
	mABI_DEFHANDLER_LCALL7
=3,

928 
	mABI_DEFHANDLER_LIBCSO
=4,

929 
	mABI_TRACE
=5,

930 
	mABI_FAKE_UTSNAME
=6,

	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (cÚ¡ *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (cÚ¡ *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

30 #ifdeà
__USE_XOPEN2K


31 
	#__Ãed_time_t


	)

32 
	#__Ãed_time¥ec


	)

34 
	~<time.h
>

36 #iâdeà
__pid_t_defšed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

45 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

48 
__BEGIN_DECLS


51 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

52 
__THROW
;

55 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

58 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

59 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

62 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

65 
	$sched_y›ld
 (è
__THROW
;

68 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

71 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

77 #ifdeà
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

81 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

82 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

83 
ıu£
)

	)

84 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

87 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

88 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

89 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
ıu£
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

94 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

101 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

103 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

113 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

114 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

118 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

119 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

122 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

123 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

126 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/sys/cdefs.h

18 #iâdef 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #iâdeà
_FEATURES_H


23 
	~<ã©u»s.h
>

29 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


34 #undeà
__P


35 #undeà
__PMT


37 #ifdeà
__GNUC__


41 #ià
__GNUC_PREREQ
 (4, 6è&& !
defšed
 
_LIBC


42 
	#__LEAF
 , 
__Ëaf__


	)

43 
	#__LEAF_ATTR
 
	`__©Œibu‹__
 ((
__Ëaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

57 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
)è
	)
fct

59 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

60 
	#__THROW
 
	`throw
 ()

	)

61 
	#__THROWNL
 
	`throw
 ()

	)

62 
	#__NTH
(
fù
è
__LEAF_ATTR
 fù 
	`throw
 ()

	)

64 
	#__THROW


	)

65 
	#__THROWNL


	)

66 
	#__NTH
(
fù
è
	)
fct

72 
	#__šlše


	)

74 
	#__THROW


	)

75 
	#__THROWNL


	)

76 
	#__NTH
(
fù
è
	)
fct

82 
	#__P
(
¬gs
è
	)
args

83 
	#__PMT
(
¬gs
è
	)
args

88 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

89 
	#__STRING
(
x
è#x

	)

92 
	#__±r_t
 *

	)

93 
	#__lÚg_doubË_t
 

	)

97 #ifdef 
__ılu¥lus


98 
	#__BEGIN_DECLS
 "C" {

	)

99 
	#__END_DECLS
 }

	)

101 
	#__BEGIN_DECLS


	)

102 
	#__END_DECLS


	)

111 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


112 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

113 
	#__END_NAMESPACE_STD
 }

	)

114 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

115 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

116 
	#__END_NAMESPACE_C99
 }

	)

117 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

122 
	#__BEGIN_NAMESPACE_STD


	)

123 
	#__END_NAMESPACE_STD


	)

124 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

125 
	#__BEGIN_NAMESPACE_C99


	)

126 
	#__END_NAMESPACE_C99


	)

127 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3)

136 
	#__w¬ndeş
(
Çme
, 
msg
) \

137 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

138 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

139 
	#__”rÜdeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

142 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

143 
	#__w¬Ç‰r
(
msg
)

	)

144 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

148 #ià
__GNUC_PREREQ
 (2,97)

150 
	#__æex¬r
 []

	)

152 #ifdeà
__GNUC__


153 
	#__æex¬r
 [0]

	)

155 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

156 
	#__æex¬r
 []

	)

159 
	#__æex¬r
 [1]

	)

175 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

177 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

178 #ifdeà
__ılu¥lus


179 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

180 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

182 
Çme
 
´Ùo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

184 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

185 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

186 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

187 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROWNL


	)

189 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

190 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

203 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

204 
	#__©Œibu‹__
(
xyz
è

	)

210 #ià
__GNUC_PREREQ
 (2,96)

211 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

213 
	#__©Œibu‹_m®loc__


	)

218 #ià
__GNUC_PREREQ
 (4, 3)

219 
	#__©Œibu‹_®loc_size__
(
·¿ms
) \

220 
	`__©Œibu‹__
 ((
__®loc_size__
 
·¿ms
))

	)

222 
	#__©Œibu‹_®loc_size__
(
·¿ms
è

	)

228 #ià
__GNUC_PREREQ
 (2,96)

229 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

231 
	#__©Œibu‹_pu»__


	)

235 #ià
__GNUC_PREREQ
 (2,5)

236 
	#__©Œibu‹_cÚ¡__
 
	`__©Œibu‹__
 ((
__cÚ¡__
))

	)

238 
	#__©Œibu‹_cÚ¡__


	)

244 #ià
__GNUC_PREREQ
 (3,1)

245 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

246 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

248 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

249 
	#__©Œibu‹_nošlše__


	)

253 #ià
__GNUC_PREREQ
 (3,2)

254 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

256 
	#__©Œibu‹_d•»ÿ‹d__


	)

265 #ià
__GNUC_PREREQ
 (2,8)

266 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

268 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

275 #ià
__GNUC_PREREQ
 (2,97)

276 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

277 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

279 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

284 #ià
__GNUC_PREREQ
 (3,3)

285 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

287 
	#__nÚnuÎ
(
·¿ms
)

	)

292 #ià
__GNUC_PREREQ
 (3,4)

293 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

294 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

295 #ià
__USE_FORTIFY_LEVEL
 > 0

296 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

299 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

301 #iâdeà
__wur


302 
	#__wur


	)

306 #ià
__GNUC_PREREQ
 (3,2)

307 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

309 
	#__®ways_šlše
 
__šlše


	)

314 #ià
__GNUC_PREREQ
 (4,3)

315 
	#__©Œibu‹_¬tificŸl__
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

317 
	#__©Œibu‹_¬tificŸl__


	)

329 #ià(!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

330 || (
defšed
 
__şªg__
 && (defšed 
__GNUC_STDC_INLINE__
 \

331 || 
defšed
 
__GNUC_GNU_INLINE__
)))

332 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


333 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

334 
	#__ex‹º_®ways_šlše
 \

335 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

337 
	#__ex‹º_šlše
 
__šlše


	)

338 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

342 #ifdeà
__ex‹º_®ways_šlše


343 
	#__fÜtify_funùiÚ
 
__ex‹º_®ways_šlše
 
__©Œibu‹_¬tificŸl__


	)

348 #ià
__GNUC_PREREQ
 (4,3)

349 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

350 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

357 #ià!
__GNUC_PREREQ
 (2,8)

358 
	#__ex‹nsiÚ__


	)

362 #ià!
__GNUC_PREREQ
 (2,92)

363 
	#__»¡riù


	)

369 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


370 
	#__»¡riù_¬r
 
__»¡riù


	)

372 #ifdeà
__GNUC__


373 
	#__»¡riù_¬r


	)

375 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

376 
	#__»¡riù_¬r
 
»¡riù


	)

379 
	#__»¡riù_¬r


	)

384 #ià
__GNUC__
 >= 3

385 
	#__glibc_uÆik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 0)

	)

386 
	#__glibc_lik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 1)

	)

388 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

389 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

392 #ià(!
defšed
 
_NÜ‘uº
 \

393 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

394 && !
	$__GNUC_PREREQ
 (4,7))

395 #ià
	`__GNUC_PREREQ
 (2,8)

396 
	#_NÜ‘uº
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

	)

398 
	#_NÜ‘uº


	)

402 #ià(!
defšed
 
_Stic_as£¹
 && !defšed 
__ılu¥lus
 \

403 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

404 && (!
	`__GNUC_PREREQ
 (4, 6è|| 
defšed
 
__STRICT_ANSI__
))

405 
	#_Stic_as£¹
(
ex´
, 
dŸgno¡ic
) \

406 (*
	`__Stic_as£¹_funùiÚ
 ()) \

407 [!! (¡ruù { 
__”rÜ_if_Ãg©ive
: (
ex´
è? 2 : -1; })]

	)

410 
	~<b™s/wÜdsize.h
>

412 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


413 
	#__LDBL_COMPAT
 1

	)

414 #ifdeà
__REDIRECT


415 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

416 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

417 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

418 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

419 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

420 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

421 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

422 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

423 
	#__LDBL_REDIR_DECL
(
Çme
) \

424 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

425 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

426 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

427 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

428 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

431 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


432 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

433 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

434 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

435 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

436 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

437 #ifdeà
__REDIRECT


438 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

439 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

440 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/sys/poll.h

19 #iâdef 
_SYS_POLL_H


20 
	#_SYS_POLL_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/pŞl.h
>

26 #ifdeà
__USE_GNU


28 
	~<b™s/sig£t.h
>

30 
	#__Ãed_time¥ec


	)

31 
	~<time.h
>

36 
	tnfds_t
;

39 
	spŞlfd


41 
	mfd
;

42 
	mev’ts
;

43 
	m»v’ts
;

47 
__BEGIN_DECLS


57 
pŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
, 
__timeout
);

59 #ifdeà
__USE_GNU


66 
µŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

67 cÚ¡ 
time¥ec
 *
__timeout
,

68 cÚ¡ 
__sig£t_t
 *
__ss
);

71 
	g__END_DECLS


75 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


76 
	~<b™s/pŞl2.h
>

	@/usr/include/sys/syslog.h

32 #iâdeà
_SYS_SYSLOG_H


33 
	#_SYS_SYSLOG_H
 1

	)

35 
	~<ã©u»s.h
>

36 
	#__Ãed___va_li¡


	)

37 
	~<¡d¬g.h
>

40 
	~<b™s/sy¦og-·th.h
>

51 
	#LOG_EMERG
 0

	)

52 
	#LOG_ALERT
 1

	)

53 
	#LOG_CRIT
 2

	)

54 
	#LOG_ERR
 3

	)

55 
	#LOG_WARNING
 4

	)

56 
	#LOG_NOTICE
 5

	)

57 
	#LOG_INFO
 6

	)

58 
	#LOG_DEBUG
 7

	)

60 
	#LOG_PRIMASK
 0x07

	)

62 
	#LOG_PRI
(
p
è(Õè& 
LOG_PRIMASK
)

	)

63 
	#LOG_MAKEPRI
(
çc
, 
´i
è((çcè| (´i))

	)

65 #ifdeà
SYSLOG_NAMES


66 
	#INTERNAL_NOPRI
 0x10

	)

68 
	#INTERNAL_MARK
 
	`LOG_MAKEPRI
(
LOG_NFACILITIES
 << 3, 0)

	)

69 
	s_code
 {

70 *
	mc_Çme
;

71 
	mc_v®
;

72 } 
	tCODE
;

74 
CODE
 
	g´iÜ™yÇmes
[] =

76 { "®”t", 
LOG_ALERT
 },

77 { "ü™", 
LOG_CRIT
 },

78 { "debug", 
LOG_DEBUG
 },

79 { "em”g", 
LOG_EMERG
 },

80 { "”r", 
LOG_ERR
 },

81 { "”rÜ", 
LOG_ERR
 },

82 { "šfo", 
LOG_INFO
 },

83 { "nÚe", 
INTERNAL_NOPRI
 },

84 { "nÙiû", 
LOG_NOTICE
 },

85 { "·nic", 
LOG_EMERG
 },

86 { "w¬n", 
LOG_WARNING
 },

87 { "w¬nšg", 
LOG_WARNING
 },

88 { 
NULL
, -1 }

93 
	#LOG_KERN
 (0<<3è

	)

94 
	#LOG_USER
 (1<<3è

	)

95 
	#LOG_MAIL
 (2<<3è

	)

96 
	#LOG_DAEMON
 (3<<3è

	)

97 
	#LOG_AUTH
 (4<<3è

	)

98 
	#LOG_SYSLOG
 (5<<3è

	)

99 
	#LOG_LPR
 (6<<3è

	)

100 
	#LOG_NEWS
 (7<<3è

	)

101 
	#LOG_UUCP
 (8<<3è

	)

102 
	#LOG_CRON
 (9<<3è

	)

103 
	#LOG_AUTHPRIV
 (10<<3è

	)

104 
	#LOG_FTP
 (11<<3è

	)

107 
	#LOG_LOCAL0
 (16<<3è

	)

108 
	#LOG_LOCAL1
 (17<<3è

	)

109 
	#LOG_LOCAL2
 (18<<3è

	)

110 
	#LOG_LOCAL3
 (19<<3è

	)

111 
	#LOG_LOCAL4
 (20<<3è

	)

112 
	#LOG_LOCAL5
 (21<<3è

	)

113 
	#LOG_LOCAL6
 (22<<3è

	)

114 
	#LOG_LOCAL7
 (23<<3è

	)

116 
	#LOG_NFACILITIES
 24

	)

117 
	#LOG_FACMASK
 0x03f8

	)

119 
	#LOG_FAC
(
p
è((Õè& 
LOG_FACMASK
è>> 3)

	)

121 #ifdeà
SYSLOG_NAMES


122 
CODE
 
	gçc™yÇmes
[] =

124 { "auth", 
LOG_AUTH
 },

125 { "auth´iv", 
LOG_AUTHPRIV
 },

126 { "üÚ", 
LOG_CRON
 },

127 { "d«mÚ", 
LOG_DAEMON
 },

128 { "áp", 
LOG_FTP
 },

129 { "k”n", 
LOG_KERN
 },

130 { "Ír", 
LOG_LPR
 },

131 { "ma", 
LOG_MAIL
 },

132 { "m¬k", 
INTERNAL_MARK
 },

133 { "Ãws", 
LOG_NEWS
 },

134 { "£cur™y", 
LOG_AUTH
 },

135 { "sy¦og", 
LOG_SYSLOG
 },

136 { "u£r", 
LOG_USER
 },

137 { "uuı", 
LOG_UUCP
 },

138 { "loÿl0", 
LOG_LOCAL0
 },

139 { "loÿl1", 
LOG_LOCAL1
 },

140 { "loÿl2", 
LOG_LOCAL2
 },

141 { "loÿl3", 
LOG_LOCAL3
 },

142 { "loÿl4", 
LOG_LOCAL4
 },

143 { "loÿl5", 
LOG_LOCAL5
 },

144 { "loÿl6", 
LOG_LOCAL6
 },

145 { "loÿl7", 
LOG_LOCAL7
 },

146 { 
NULL
, -1 }

153 
	#LOG_MASK
(
´i
è(1 << (´i)è

	)

154 
	#LOG_UPTO
(
´i
è((1 << (Õri)+1)è- 1è

	)

162 
	#LOG_PID
 0x01

	)

163 
	#LOG_CONS
 0x02

	)

164 
	#LOG_ODELAY
 0x04

	)

165 
	#LOG_NDELAY
 0x08

	)

166 
	#LOG_NOWAIT
 0x10

	)

167 
	#LOG_PERROR
 0x20

	)

169 
__BEGIN_DECLS


175 
şo£log
 ();

181 
İ’log
 (cÚ¡ *
__id’t
, 
__İtiÚ
, 
__çc™y
);

184 
	$£ogmask
 (
__mask
è
__THROW
;

190 
	$sy¦og
 (
__´i
, cÚ¡ *
__fmt
, ...)

191 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

193 #ifdeà
__USE_MISC


200 
	$vsy¦og
 (
__´i
, cÚ¡ *
__fmt
, 
__gnuc_va_li¡
 
__­
)

201 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

206 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


207 
	~<b™s/sy¦og.h
>

209 #ifdeà
__LDBL_COMPAT


210 
	~<b™s/sy¦og-ldbl.h
>

213 
__END_DECLS


	@/usr/include/sys/sysmacros.h

19 #iâdeà
_SYS_SYSMACROS_H


20 
	#_SYS_SYSMACROS_H
 1

	)

22 
	~<ã©u»s.h
>

24 
__BEGIN_DECLS


26 
__ex‹nsiÚ__


27 
	$gnu_dev_majÜ
 (
__dev
)

28 
__THROW
 
__©Œibu‹_cÚ¡__
;

29 
__ex‹nsiÚ__


30 
	$gnu_dev_mšÜ
 (
__dev
)

31 
__THROW
 
__©Œibu‹_cÚ¡__
;

32 
__ex‹nsiÚ__


33 
	$gnu_dev_makedev
 (
__majÜ
,

34 
__mšÜ
)

35 
__THROW
 
__©Œibu‹_cÚ¡__
;

37 #ifdeà
__USE_EXTERN_INLINES


38 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

39 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

41  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

42 
	}
}

44 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

45 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

47  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

48 
	}
}

50 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

51 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

53  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

54 | (((è(
__mšÜ
 & ~0xff)) << 12)

55 | (((è(
__majÜ
 & ~0xfff)) << 32));

56 
	}
}

58 
	g__END_DECLS


61 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

62 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

63 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/sys/ttydefaults.h

40 #iâdeà
_SYS_TTYDEFAULTS_H_


41 
	#_SYS_TTYDEFAULTS_H_


	)

46 
	#TTYDEF_IFLAG
 (
BRKINT
 | 
ISTRIP
 | 
ICRNL
 | 
IMAXBEL
 | 
IXON
 | 
IXANY
)

	)

47 
	#TTYDEF_OFLAG
 (
OPOST
 | 
ONLCR
 | 
XTABS
)

	)

48 
	#TTYDEF_LFLAG
 (
ECHO
 | 
ICANON
 | 
ISIG
 | 
IEXTEN
 | 
ECHOE
|
ECHOKE
|
ECHOCTL
)

	)

49 
	#TTYDEF_CFLAG
 (
CREAD
 | 
CS7
 | 
PARENB
 | 
HUPCL
)

	)

50 
	#TTYDEF_SPEED
 (
B9600
)

	)

55 
	#CTRL
(
x
è(x&037)

	)

56 
	#CEOF
 
	`CTRL
('d')

	)

57 #ifdeà
_POSIX_VDISABLE


58 
	#CEOL
 
_POSIX_VDISABLE


	)

60 
	#CEOL
 '\0'

	)

62 
	#CERASE
 0177

	)

63 
	#CINTR
 
	`CTRL
('c')

	)

64 #ifdeà
_POSIX_VDISABLE


65 
	#CSTATUS
 
_POSIX_VDISABLE


	)

67 
	#CSTATUS
 '\0'

	)

69 
	#CKILL
 
	`CTRL
('u')

	)

70 
	#CMIN
 1

	)

71 
	#CQUIT
 034

	)

72 
	#CSUSP
 
	`CTRL
('z')

	)

73 
	#CTIME
 0

	)

74 
	#CDSUSP
 
	`CTRL
('y')

	)

75 
	#CSTART
 
	`CTRL
('q')

	)

76 
	#CSTOP
 
	`CTRL
('s')

	)

77 
	#CLNEXT
 
	`CTRL
('v')

	)

78 
	#CDISCARD
 
	`CTRL
('o')

	)

79 
	#CWERASE
 
	`CTRL
('w')

	)

80 
	#CREPRINT
 
	`CTRL
('r')

	)

81 
	#CEOT
 
CEOF


	)

83 
	#CBRK
 
CEOL


	)

84 
	#CRPRNT
 
CREPRINT


	)

85 
	#CFLUSH
 
CDISCARD


	)

93 #ifdeà
TTYDEFCHARS


94 
cc_t
 
	g‰ydefch¬s
[
NCCS
] = {

95 
CEOF
, 
CEOL
, CEOL, 
CERASE
, 
CWERASE
, 
CKILL
, 
CREPRINT
,

96 
_POSIX_VDISABLE
, 
CINTR
, 
CQUIT
, 
CSUSP
, 
CDSUSP
, 
CSTART
, 
CSTOP
, 
CLNEXT
,

97 
CDISCARD
, 
CMIN
, 
CTIME
, 
CSTATUS
, 
_POSIX_VDISABLE


99 #undeà
TTYDEFCHARS


	@/usr/include/sys/ucontext.h

18 #iâdeà
_SYS_UCONTEXT_H


19 
	#_SYS_UCONTEXT_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<sigÇl.h
>

26 
	~<b™s/sigcÚ‹xt.h
>

28 #ifdeà
__x86_64__


31 
__ex‹nsiÚ__
 
	tg»g_t
;

34 
	#NGREG
 23

	)

37 
g»g_t
 
	tg»g£t_t
[
NGREG
];

39 #ifdeà
__USE_GNU


43 
	mREG_R8
 = 0,

44 
	#REG_R8
 
REG_R8


	)

45 
	mREG_R9
,

46 
	#REG_R9
 
REG_R9


	)

47 
	mREG_R10
,

48 
	#REG_R10
 
REG_R10


	)

49 
	mREG_R11
,

50 
	#REG_R11
 
REG_R11


	)

51 
	mREG_R12
,

52 
	#REG_R12
 
REG_R12


	)

53 
	mREG_R13
,

54 
	#REG_R13
 
REG_R13


	)

55 
	mREG_R14
,

56 
	#REG_R14
 
REG_R14


	)

57 
	mREG_R15
,

58 
	#REG_R15
 
REG_R15


	)

59 
	mREG_RDI
,

60 
	#REG_RDI
 
REG_RDI


	)

61 
	mREG_RSI
,

62 
	#REG_RSI
 
REG_RSI


	)

63 
	mREG_RBP
,

64 
	#REG_RBP
 
REG_RBP


	)

65 
	mREG_RBX
,

66 
	#REG_RBX
 
REG_RBX


	)

67 
	mREG_RDX
,

68 
	#REG_RDX
 
REG_RDX


	)

69 
	mREG_RAX
,

70 
	#REG_RAX
 
REG_RAX


	)

71 
	mREG_RCX
,

72 
	#REG_RCX
 
REG_RCX


	)

73 
	mREG_RSP
,

74 
	#REG_RSP
 
REG_RSP


	)

75 
	mREG_RIP
,

76 
	#REG_RIP
 
REG_RIP


	)

77 
	mREG_EFL
,

78 
	#REG_EFL
 
REG_EFL


	)

79 
	mREG_CSGSFS
,

80 
	#REG_CSGSFS
 
REG_CSGSFS


	)

81 
	mREG_ERR
,

82 
	#REG_ERR
 
REG_ERR


	)

83 
	mREG_TRAPNO
,

84 
	#REG_TRAPNO
 
REG_TRAPNO


	)

85 
	mREG_OLDMASK
,

86 
	#REG_OLDMASK
 
REG_OLDMASK


	)

87 
	mREG_CR2


88 
	#REG_CR2
 
REG_CR2


	)

92 
	s_libc_åx»g


94 
	msignifiÿnd
[4];

95 
	mexpÚ’t
;

96 
	m·ddšg
[3];

99 
	s_libc_xmm»g


101 
__ušt32_t
 
	m–em’t
[4];

104 
	s_libc_å¡©e


107 
__ušt16_t
 
	mcwd
;

108 
__ušt16_t
 
	mswd
;

109 
__ušt16_t
 
	máw
;

110 
__ušt16_t
 
	mfİ
;

111 
__ušt64_t
 
	mr
;

112 
__ušt64_t
 
	mrdp
;

113 
__ušt32_t
 
	mmxc¤
;

114 
__ušt32_t
 
	mmxü_mask
;

115 
_libc_åx»g
 
	m_¡
[8];

116 
_libc_xmm»g
 
	m_xmm
[16];

117 
__ušt32_t
 
	m·ddšg
[24];

121 
_libc_å¡©e
 *
	tå»g£t_t
;

126 
g»g£t_t
 
	mg»gs
;

128 
å»g£t_t
 
	må»gs
;

129 
__ex‹nsiÚ__
 
	m__»£rved1
 [8];

130 } 
	tmcÚ‹xt_t
;

133 
	sucÚ‹xt


135 
	muc_æags
;

136 
ucÚ‹xt
 *
	muc_lšk
;

137 
¡ack_t
 
	muc_¡ack
;

138 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

139 
__sig£t_t
 
	muc_sigmask
;

140 
_libc_å¡©e
 
	m__å»gs_mem
;

141 } 
	tucÚ‹xt_t
;

146 
	tg»g_t
;

149 
	#NGREG
 19

	)

152 
g»g_t
 
	tg»g£t_t
[
NGREG
];

154 #ifdeà
__USE_GNU


158 
	mREG_GS
 = 0,

159 
	#REG_GS
 
REG_GS


	)

160 
	mREG_FS
,

161 
	#REG_FS
 
REG_FS


	)

162 
	mREG_ES
,

163 
	#REG_ES
 
REG_ES


	)

164 
	mREG_DS
,

165 
	#REG_DS
 
REG_DS


	)

166 
	mREG_EDI
,

167 
	#REG_EDI
 
REG_EDI


	)

168 
	mREG_ESI
,

169 
	#REG_ESI
 
REG_ESI


	)

170 
	mREG_EBP
,

171 
	#REG_EBP
 
REG_EBP


	)

172 
	mREG_ESP
,

173 
	#REG_ESP
 
REG_ESP


	)

174 
	mREG_EBX
,

175 
	#REG_EBX
 
REG_EBX


	)

176 
	mREG_EDX
,

177 
	#REG_EDX
 
REG_EDX


	)

178 
	mREG_ECX
,

179 
	#REG_ECX
 
REG_ECX


	)

180 
	mREG_EAX
,

181 
	#REG_EAX
 
REG_EAX


	)

182 
	mREG_TRAPNO
,

183 
	#REG_TRAPNO
 
REG_TRAPNO


	)

184 
	mREG_ERR
,

185 
	#REG_ERR
 
REG_ERR


	)

186 
	mREG_EIP
,

187 
	#REG_EIP
 
REG_EIP


	)

188 
	mREG_CS
,

189 
	#REG_CS
 
REG_CS


	)

190 
	mREG_EFL
,

191 
	#REG_EFL
 
REG_EFL


	)

192 
	mREG_UESP
,

193 
	#REG_UESP
 
REG_UESP


	)

194 
	mREG_SS


195 
	#REG_SS
 
REG_SS


	)

200 
	s_libc_å»g


202 
	msignifiÿnd
[4];

203 
	mexpÚ’t
;

206 
	s_libc_å¡©e


208 
	mcw
;

209 
	msw
;

210 
	mg
;

211 
	moff
;

212 
	mcs£l
;

213 
	md©aoff
;

214 
	md©a£l
;

215 
_libc_å»g
 
	m_¡
[8];

216 
	m¡©us
;

220 
_libc_å¡©e
 *
	tå»g£t_t
;

225 
g»g£t_t
 
	mg»gs
;

228 
å»g£t_t
 
	må»gs
;

229 
	mŞdmask
;

230 
	mü2
;

231 } 
	tmcÚ‹xt_t
;

234 
	sucÚ‹xt


236 
	muc_æags
;

237 
ucÚ‹xt
 *
	muc_lšk
;

238 
¡ack_t
 
	muc_¡ack
;

239 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

240 
__sig£t_t
 
	muc_sigmask
;

241 
_libc_å¡©e
 
	m__å»gs_mem
;

242 } 
	tucÚ‹xt_t
;

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/asm/ioctls.h

1 
	~<asm-g’”ic/ioùls.h
>

	@/usr/include/asm/socket.h

1 
	~<asm-g’”ic/sock‘.h
>

	@/usr/include/bits/byteswap-16.h

19 #iâdeà
_BITS_BYTESWAP_H


23 #ifdeà
__GNUC__


24 #ià
__GNUC__
 >= 2

25 
	#__bsw­_16
(
x
) \

26 (
__ex‹nsiÚ__
 \

27 ({ 
__v
, 
__x
 = (è(
x
); \

28 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

29 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

31 
	`__asm__
 ("rorw $8, %w0" \

32 : "ô" (
__v
) \

33 : "0" (
__x
) \

35 
__v
; }))

	)

38 
	#__bsw­_16
(
x
) \

39 (
__ex‹nsiÚ__
 \

40 ({ 
__x
 = (è(
x
); \

41 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

44 
__šlše
 

45 
	$__bsw­_16
 (
__bsx
)

47  
	`__bsw­_cÚ¡ªt_16
 (
__bsx
);

48 
	}
}

	@/usr/include/bits/fcntl-linux.h

19 #iâdef 
_FCNTL_H


37 #ifdeà
__USE_GNU


38 
	~<b™s/uio.h
>

42 
	#O_ACCMODE
 0003

	)

43 
	#O_RDONLY
 00

	)

44 
	#O_WRONLY
 01

	)

45 
	#O_RDWR
 02

	)

46 #iâdeà
O_CREAT


47 
	#O_CREAT
 0100

	)

49 #iâdeà
O_EXCL


50 
	#O_EXCL
 0200

	)

52 #iâdeà
O_NOCTTY


53 
	#O_NOCTTY
 0400

	)

55 #iâdeà
O_TRUNC


56 
	#O_TRUNC
 01000

	)

58 #iâdeà
O_APPEND


59 
	#O_APPEND
 02000

	)

61 #iâdeà
O_NONBLOCK


62 
	#O_NONBLOCK
 04000

	)

64 #iâdeà
O_NDELAY


65 
	#O_NDELAY
 
O_NONBLOCK


	)

67 #iâdeà
O_SYNC


68 
	#O_SYNC
 04010000

	)

70 
	#O_FSYNC
 
O_SYNC


	)

71 #iâdeà
O_ASYNC


72 
	#O_ASYNC
 020000

	)

74 #iâdeà
__O_LARGEFILE


75 
	#__O_LARGEFILE
 0100000

	)

78 #iâdeà
__O_DIRECTORY


79 
	#__O_DIRECTORY
 0200000

	)

81 #iâdeà
__O_NOFOLLOW


82 
	#__O_NOFOLLOW
 0400000

	)

84 #iâdeà
__O_CLOEXEC


85 
	#__O_CLOEXEC
 02000000

	)

87 #iâdeà
__O_DIRECT


88 
	#__O_DIRECT
 040000

	)

90 #iâdeà
__O_NOATIME


91 
	#__O_NOATIME
 01000000

	)

93 #iâdeà
__O_PATH


94 
	#__O_PATH
 010000000

	)

96 #iâdeà
__O_DSYNC


97 
	#__O_DSYNC
 010000

	)

99 #iâdeà
__O_TMPFILE


100 
	#__O_TMPFILE
 (020000000 | 
__O_DIRECTORY
)

	)

103 #iâdeà
F_GETLK


104 #iâdeà
__USE_FILE_OFFSET64


105 
	#F_GETLK
 5

	)

106 
	#F_SETLK
 6

	)

107 
	#F_SETLKW
 7

	)

109 
	#F_GETLK
 
F_GETLK64


	)

110 
	#F_SETLK
 
F_SETLK64


	)

111 
	#F_SETLKW
 
F_SETLKW64


	)

114 #iâdeà
F_GETLK64


115 
	#F_GETLK64
 12

	)

116 
	#F_SETLK64
 13

	)

117 
	#F_SETLKW64
 14

	)

131 #ifdeà
__USE_GNU


132 
	#F_OFD_GETLK
 36

	)

133 
	#F_OFD_SETLK
 37

	)

134 
	#F_OFD_SETLKW
 38

	)

137 #ifdeà
__USE_LARGEFILE64


138 
	#O_LARGEFILE
 
__O_LARGEFILE


	)

141 #ifdeà
__USE_XOPEN2K8


142 
	#O_DIRECTORY
 
__O_DIRECTORY


	)

143 
	#O_NOFOLLOW
 
__O_NOFOLLOW


	)

144 
	#O_CLOEXEC
 
__O_CLOEXEC


	)

147 #ifdeà
__USE_GNU


148 
	#O_DIRECT
 
__O_DIRECT


	)

149 
	#O_NOATIME
 
__O_NOATIME


	)

150 
	#O_PATH
 
__O_PATH


	)

151 
	#O_TMPFILE
 
__O_TMPFILE


	)

157 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


158 
	#O_DSYNC
 
__O_DSYNC


	)

159 #ià
defšed
 
__O_RSYNC


160 
	#O_RSYNC
 
__O_RSYNC


	)

162 
	#O_RSYNC
 
O_SYNC


	)

167 
	#F_DUPFD
 0

	)

168 
	#F_GETFD
 1

	)

169 
	#F_SETFD
 2

	)

170 
	#F_GETFL
 3

	)

171 
	#F_SETFL
 4

	)

173 #iâdeà
__F_SETOWN


174 
	#__F_SETOWN
 8

	)

175 
	#__F_GETOWN
 9

	)

178 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


179 
	#F_SETOWN
 
__F_SETOWN


	)

180 
	#F_GETOWN
 
__F_GETOWN


	)

183 #iâdeà
__F_SETSIG


184 
	#__F_SETSIG
 10

	)

185 
	#__F_GETSIG
 11

	)

187 #iâdeà
__F_SETOWN_EX


188 
	#__F_SETOWN_EX
 15

	)

189 
	#__F_GETOWN_EX
 16

	)

192 #ifdeà
__USE_GNU


193 
	#F_SETSIG
 
__F_SETSIG


	)

194 
	#F_GETSIG
 
__F_GETSIG


	)

195 
	#F_SETOWN_EX
 
__F_SETOWN_EX


	)

196 
	#F_GETOWN_EX
 
__F_GETOWN_EX


	)

199 #ifdeà
__USE_GNU


200 
	#F_SETLEASE
 1024

	)

201 
	#F_GETLEASE
 1025

	)

202 
	#F_NOTIFY
 1026

	)

203 
	#F_SETPIPE_SZ
 1031

	)

204 
	#F_GETPIPE_SZ
 1032

	)

206 #ifdeà
__USE_XOPEN2K8


207 
	#F_DUPFD_CLOEXEC
 1030

	)

212 
	#FD_CLOEXEC
 1

	)

214 #iâdeà
F_RDLCK


216 
	#F_RDLCK
 0

	)

217 
	#F_WRLCK
 1

	)

218 
	#F_UNLCK
 2

	)

223 #iâdeà
F_EXLCK


224 
	#F_EXLCK
 4

	)

225 
	#F_SHLCK
 8

	)

228 #ifdeà
__USE_MISC


230 
	#LOCK_SH
 1

	)

231 
	#LOCK_EX
 2

	)

232 
	#LOCK_NB
 4

	)

234 
	#LOCK_UN
 8

	)

237 #ifdeà
__USE_GNU


238 
	#LOCK_MAND
 32

	)

239 
	#LOCK_READ
 64

	)

240 
	#LOCK_WRITE
 128

	)

241 
	#LOCK_RW
 192

	)

244 #ifdeà
__USE_GNU


246 
	#DN_ACCESS
 0x00000001

	)

247 
	#DN_MODIFY
 0x00000002

	)

248 
	#DN_CREATE
 0x00000004

	)

249 
	#DN_DELETE
 0x00000008

	)

250 
	#DN_RENAME
 0x00000010

	)

251 
	#DN_ATTRIB
 0x00000020

	)

252 
	#DN_MULTISHOT
 0x80000000

	)

256 #ifdeà
__USE_GNU


258 
	e__pid_ty³


260 
	mF_OWNER_TID
 = 0,

261 
	mF_OWNER_PID
,

262 
	mF_OWNER_PGRP
,

263 
	mF_OWNER_GID
 = 
F_OWNER_PGRP


267 
	sf_owÃr_ex


269 
__pid_ty³
 
	mty³
;

270 
__pid_t
 
	mpid
;

276 #ifdef 
__USE_MISC


277 
	#FAPPEND
 
O_APPEND


	)

278 
	#FFSYNC
 
O_FSYNC


	)

279 
	#FASYNC
 
O_ASYNC


	)

280 
	#FNONBLOCK
 
O_NONBLOCK


	)

281 
	#FNDELAY
 
O_NDELAY


	)

284 #iâdeà
__POSIX_FADV_DONTNEED


285 
	#__POSIX_FADV_DONTNEED
 4

	)

286 
	#__POSIX_FADV_NOREUSE
 5

	)

289 #ifdeà
__USE_XOPEN2K


290 
	#POSIX_FADV_NORMAL
 0

	)

291 
	#POSIX_FADV_RANDOM
 1

	)

292 
	#POSIX_FADV_SEQUENTIAL
 2

	)

293 
	#POSIX_FADV_WILLNEED
 3

	)

294 
	#POSIX_FADV_DONTNEED
 
__POSIX_FADV_DONTNEED


	)

295 
	#POSIX_FADV_NOREUSE
 
__POSIX_FADV_NOREUSE


	)

299 #ifdeà
__USE_GNU


301 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

304 
	#SYNC_FILE_RANGE_WRITE
 2

	)

307 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

312 
	#SPLICE_F_MOVE
 1

	)

313 
	#SPLICE_F_NONBLOCK
 2

	)

316 
	#SPLICE_F_MORE
 4

	)

317 
	#SPLICE_F_GIFT
 8

	)

321 
	#FALLOC_FL_KEEP_SIZE
 1

	)

324 
	#FALLOC_FL_PUNCH_HOLE
 2

	)

325 
	#FALLOC_FL_COLLAPSE_RANGE
 8

	)

328 
	#FALLOC_FL_ZERO_RANGE
 16

	)

333 
	sfe_hªdË


335 
	mhªdË_by‹s
;

336 
	mhªdË_ty³
;

338 
	mf_hªdË
[0];

342 
	#MAX_HANDLE_SZ
 128

	)

345 
	g__BEGIN_DECLS


347 #ifdeà
__USE_GNU


350 
ssize_t
 
	$»adah—d
 (
__fd
, 
__off64_t
 
__off£t
, 
size_t
 
__couÁ
)

351 
__THROW
;

358 
	`sync_fe_¿nge
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__couÁ
,

359 
__æags
);

366 
ssize_t
 
	`vm¥liû
 (
__fdout
, cÚ¡ 
iovec
 *
__iov
,

367 
size_t
 
__couÁ
, 
__æags
);

373 
ssize_t
 
	`¥liû
 (
__fdš
, 
__off64_t
 *
__offš
, 
__fdout
,

374 
__off64_t
 *
__offout
, 
size_t
 
__Ën
,

375 
__æags
);

381 
ssize_t
 
	`‹e
 (
__fdš
, 
__fdout
, 
size_t
 
__Ën
,

382 
__æags
);

388 #iâdeà
__USE_FILE_OFFSET64


389 
	`çÎoÿ‹
 (
__fd
, 
__mode
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

391 #ifdeà
__REDIRECT


392 
	`__REDIRECT
 (
çÎoÿ‹
, (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

393 
__off64_t
 
__Ën
),

394 
çÎoÿ‹64
);

396 
	#çÎoÿ‹
 
çÎoÿ‹64


	)

399 #ifdeà
__USE_LARGEFILE64


400 
	`çÎoÿ‹64
 (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

401 
__off64_t
 
__Ën
);

406 
	$Çme_to_hªdË_©
 (
__dfd
, cÚ¡ *
__Çme
,

407 
fe_hªdË
 *
__hªdË
, *
__mÁ_id
,

408 
__æags
è
__THROW
;

414 
	`İ’_by_hªdË_©
 (
__mouÁdœfd
, 
fe_hªdË
 *
__hªdË
,

415 
__æags
);

419 
__END_DECLS


	@/usr/include/bits/libio-ldbl.h

19 #iâdeà
_IO_STDIO_H


23 
	$__LDBL_REDIR_DECL
 (
_IO_vfsÿnf
)

24 
	`__LDBL_REDIR_DECL
 (
_IO_vårštf
)

	@/usr/include/bits/libm-simd-decl-stubs.h

19 #iâdeà
_MATH_H


33 #iâdeà
_BITS_LIBM_SIMD_DECL_STUBS_H


34 
	#_BITS_LIBM_SIMD_DECL_STUBS_H
 1

	)

36 
	#__DECL_SIMD_cos


	)

37 
	#__DECL_SIMD_cosf


	)

38 
	#__DECL_SIMD_co¦


	)

40 
	#__DECL_SIMD_sš


	)

41 
	#__DECL_SIMD_sšf


	)

42 
	#__DECL_SIMD_sšl


	)

44 
	#__DECL_SIMD_sšcos


	)

45 
	#__DECL_SIMD_sšcosf


	)

46 
	#__DECL_SIMD_sšco¦


	)

48 
	#__DECL_SIMD_log


	)

49 
	#__DECL_SIMD_logf


	)

50 
	#__DECL_SIMD_logl


	)

52 
	#__DECL_SIMD_exp


	)

53 
	#__DECL_SIMD_expf


	)

54 
	#__DECL_SIMD_ex¶


	)

56 
	#__DECL_SIMD_pow


	)

57 
	#__DECL_SIMD_powf


	)

58 
	#__DECL_SIMD_powl


	)

	@/usr/include/bits/local_lim.h

24 #iâdeà
NR_OPEN


25 
	#__undef_NR_OPEN


	)

27 #iâdeà
LINK_MAX


28 
	#__undef_LINK_MAX


	)

30 #iâdeà
OPEN_MAX


31 
	#__undef_OPEN_MAX


	)

33 #iâdeà
ARG_MAX


34 
	#__undef_ARG_MAX


	)

38 
	~<lšux/lim™s.h
>

41 #ifdeà
__undef_NR_OPEN


42 #undeà
NR_OPEN


43 #undeà
__undef_NR_OPEN


46 #ifdeà
__undef_LINK_MAX


47 #undeà
LINK_MAX


48 #undeà
__undef_LINK_MAX


51 #ifdeà
__undef_OPEN_MAX


52 #undeà
OPEN_MAX


53 #undeà
__undef_OPEN_MAX


56 #ifdeà
__undef_ARG_MAX


57 #undeà
ARG_MAX


58 #undeà
__undef_ARG_MAX


62 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

64 
	#PTHREAD_KEYS_MAX
 1024

	)

67 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

69 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

72 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

74 #undeà
PTHREAD_THREADS_MAX


78 
	#AIO_PRIO_DELTA_MAX
 20

	)

81 
	#PTHREAD_STACK_MIN
 16384

	)

84 
	#DELAYTIMER_MAX
 2147483647

	)

87 
	#TTY_NAME_MAX
 32

	)

90 
	#LOGIN_NAME_MAX
 256

	)

93 
	#HOST_NAME_MAX
 64

	)

96 
	#MQ_PRIO_MAX
 32768

	)

99 
	#SEM_VALUE_MAX
 (2147483647)

	)

	@/usr/include/bits/poll.h

18 #iâdeà
_SYS_POLL_H


25 
	#POLLIN
 0x001

	)

26 
	#POLLPRI
 0x002

	)

27 
	#POLLOUT
 0x004

	)

29 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


31 
	#POLLRDNORM
 0x040

	)

32 
	#POLLRDBAND
 0x080

	)

33 
	#POLLWRNORM
 0x100

	)

34 
	#POLLWRBAND
 0x200

	)

37 #ifdeà
__USE_GNU


39 
	#POLLMSG
 0x400

	)

40 
	#POLLREMOVE
 0x1000

	)

41 
	#POLLRDHUP
 0x2000

	)

47 
	#POLLERR
 0x008

	)

48 
	#POLLHUP
 0x010

	)

49 
	#POLLNVAL
 0x020

	)

	@/usr/include/bits/poll2.h

19 #iâdeà
_SYS_POLL_H


24 
__BEGIN_DECLS


26 
__REDIRECT
 (
__pŞl_®Ÿs
, (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

27 
__timeout
), 
pŞl
);

28 
__pŞl_chk
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
, 
__timeout
,

29 
__SIZE_TYPE__
 
__fd¦’
);

30 
__REDIRECT
 (
__pŞl_chk_w¬n
, (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

31 
__timeout
, 
__SIZE_TYPE__
 
__fd¦’
),

32 
__pŞl_chk
)

33 
__w¬Ç‰r
 ("poll called with fds bufferoo small file‚fdsƒntries");

35 
__fÜtify_funùiÚ
 

36 
	$pŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
, 
__timeout
)

38 ià(
	`__bos
 (
__fds
è!ğ(
__SIZE_TYPE__
) -1)

40 ià(! 
	`__butš_cÚ¡ªt_p
 (
__nfds
))

41  
	`__pŞl_chk
 (
__fds
, 
__nfds
, 
__timeout
, 
	`__bos
 (__fds));

42 ià(
	`__bos
 (
__fds
è/  (*__fdsè< 
__nfds
)

43  
	`__pŞl_chk_w¬n
 (
__fds
, 
__nfds
, 
__timeout
, 
	`__bos
 (__fds));

46  
	`__pŞl_®Ÿs
 (
__fds
, 
__nfds
, 
__timeout
);

47 
	}
}

50 #ifdeà
__USE_GNU


51 
__REDIRECT
 (
__µŞl_®Ÿs
, (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

52 cÚ¡ 
time¥ec
 *
__timeout
,

53 cÚ¡ 
__sig£t_t
 *
__ss
), 
µŞl
);

54 
__µŞl_chk
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

55 cÚ¡ 
time¥ec
 *
__timeout
,

56 cÚ¡ 
__sig£t_t
 *
__ss
, 
__SIZE_TYPE__
 
__fd¦’
);

57 
__REDIRECT
 (
__µŞl_chk_w¬n
, (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
,

58 cÚ¡ 
time¥ec
 *
__timeout
,

59 cÚ¡ 
__sig£t_t
 *
__ss
,

60 
__SIZE_TYPE__
 
__fd¦’
),

61 
__µŞl_chk
)

62 
__w¬Ç‰r
 ("ppoll called with fds bufferoo small file‚fdsƒntries");

64 
__fÜtify_funùiÚ
 

65 
	$µŞl
 (
pŞlfd
 *
__fds
, 
nfds_t
 
__nfds
, cÚ¡ 
time¥ec
 *
__timeout
,

66 cÚ¡ 
__sig£t_t
 *
__ss
)

68 ià(
	`__bos
 (
__fds
è!ğ(
__SIZE_TYPE__
) -1)

70 ià(! 
	`__butš_cÚ¡ªt_p
 (
__nfds
))

71  
	`__µŞl_chk
 (
__fds
, 
__nfds
, 
__timeout
, 
__ss
, 
	`__bos
 (__fds));

72 ià(
	`__bos
 (
__fds
è/  (*__fdsè< 
__nfds
)

73  
	`__µŞl_chk_w¬n
 (
__fds
, 
__nfds
, 
__timeout
, 
__ss
,

74 
	`__bos
 (
__fds
));

77  
	`__µŞl_®Ÿs
 (
__fds
, 
__nfds
, 
__timeout
, 
__ss
);

78 
	}
}

81 
	g__END_DECLS


	@/usr/include/bits/sched.h

20 #iâdeà
__Ãed_sched·¿m


22 #iâdeà
_SCHED_H


28 
	#SCHED_OTHER
 0

	)

29 
	#SCHED_FIFO
 1

	)

30 
	#SCHED_RR
 2

	)

31 #ifdeà
__USE_GNU


32 
	#SCHED_BATCH
 3

	)

33 
	#SCHED_IDLE
 5

	)

35 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

38 #ifdeà
__USE_GNU


40 
	#CSIGNAL
 0x000000fà

	)

41 
	#CLONE_VM
 0x00000100

	)

42 
	#CLONE_FS
 0x00000200

	)

43 
	#CLONE_FILES
 0x00000400

	)

44 
	#CLONE_SIGHAND
 0x00000800

	)

45 
	#CLONE_PTRACE
 0x00002000

	)

46 
	#CLONE_VFORK
 0x00004000

	)

48 
	#CLONE_PARENT
 0x00008000

	)

50 
	#CLONE_THREAD
 0x00010000

	)

51 
	#CLONE_NEWNS
 0x00020000

	)

52 
	#CLONE_SYSVSEM
 0x00040000

	)

53 
	#CLONE_SETTLS
 0x00080000

	)

54 
	#CLONE_PARENT_SETTID
 0x00100000

	)

56 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

58 
	#CLONE_DETACHED
 0x00400000

	)

59 
	#CLONE_UNTRACED
 0x00800000

	)

61 
	#CLONE_CHILD_SETTID
 0x01000000

	)

63 
	#CLONE_NEWUTS
 0x04000000

	)

64 
	#CLONE_NEWIPC
 0x08000000

	)

65 
	#CLONE_NEWUSER
 0x10000000

	)

66 
	#CLONE_NEWPID
 0x20000000

	)

67 
	#CLONE_NEWNET
 0x40000000

	)

68 
	#CLONE_IO
 0x80000000

	)

72 
	ssched_·¿m


74 
	m__sched_´iÜ™y
;

77 
	g__BEGIN_DECLS


79 #ifdeà
__USE_GNU


81 
şÚe
 ((*
__â
è(*
__¬g
), *
__chd_¡ack
,

82 
__æags
, *
__¬g
, ...è
__THROW
;

85 
	$unsh¬e
 (
__æags
è
__THROW
;

88 
	$sched_g‘ıu
 (è
__THROW
;

91 
	$£Šs
 (
__fd
, 
__n¡y³
è
__THROW
;

95 
__END_DECLS


99 #ià!
defšed
 
__defšed_sched·¿m
 \

100 && (
defšed
 
__Ãed_sched·¿m
 || defšed 
_SCHED_H
)

101 
	#__defšed_sched·¿m
 1

	)

103 
	s__sched_·¿m


105 
__sched_´iÜ™y
;

107 #undeà
__Ãed_sched·¿m


111 #ià
defšed
 
_SCHED_H
 && !defšed 
__ıu_£t_t_defšed


112 
	#__ıu_£t_t_defšed


	)

114 
	#__CPU_SETSIZE
 1024

	)

115 
	#__NCPUBITS
 (8 *  (
__ıu_mask
))

	)

118 
__CPU_MASK_TYPE
 
	t__ıu_mask
;

121 
	#__CPUELT
(
ıu
è((ıuè/ 
__NCPUBITS
)

	)

122 
	#__CPUMASK
(
ıu
è((
__ıu_mask
è1 << ((ıuè% 
__NCPUBITS
))

	)

127 
__ıu_mask
 
__b™s
[
__CPU_SETSIZE
 / 
__NCPUBITS
];

128 } 
	tıu_£t_t
;

131 #ià
	`__GNUC_PREREQ
 (2, 91)

132 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

133 dØ
	`__butš_mem£t
 (
ıu£
, '\0', 
£tsize
); 0)

	)

135 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

137 
size_t
 
__i
; \

138 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

139 
__ıu_mask
 *
__b™s
 = (
ıu£
)->__bits; \

140 
__i
 = 0; __˜< 
__imax
; ++__i) \

141 
__b™s
[
__i
] = 0; \

142 
	}
} 0)

	)

144 
	#__CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
) \

145 (
__ex‹nsiÚ__
 \

146 ({ 
size_t
 
__ıu
 = (
ıu
); \

147 
__ıu
 / 8 < (
£tsize
) \

148 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

149 |ğ
	`__CPUMASK
 (
__ıu
)) \

150 : 0; }))

	)

151 
	#__CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
) \

152 (
__ex‹nsiÚ__
 \

153 ({ 
size_t
 
__ıu
 = (
ıu
); \

154 
__ıu
 / 8 < (
£tsize
) \

155 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

156 &ğ~
	`__CPUMASK
 (
__ıu
)) \

157 : 0; }))

	)

158 
	#__CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
) \

159 (
__ex‹nsiÚ__
 \

160 ({ 
size_t
 
__ıu
 = (
ıu
); \

161 
__ıu
 / 8 < (
£tsize
) \

162 ? ((((cÚ¡ 
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

163 & 
	`__CPUMASK
 (
__ıu
))) != 0 \

164 : 0; }))

	)

166 
	#__CPU_COUNT_S
(
£tsize
, 
ıu£
) \

167 
	`__sched_ıucouÁ
 (
£tsize
, 
ıu£
)

	)

169 #ià
__GNUC_PREREQ
 (2, 91)

170 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

171 (
	`__butš_memcmp
 (
ıu£1
, 
ıu£2
, 
£tsize
è=ğ0)

	)

173 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

174 (
__ex‹nsiÚ__
 \

175 ({ cÚ¡ 
__ıu_mask
 *
__¬r1
 = (
ıu£1
)->
__b™s
; \

176 cÚ¡ 
__ıu_mask
 *
__¬r2
 = (
ıu£2
)->
__b™s
; \

177 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

178 
size_t
 
__i
; \

179 
__i
 = 0; __˜< 
__imax
; ++__i) \

180 ià(
__¬r1
[
__i
] !ğ
__¬r2
[__i]) \

182 
__i
 =ğ
__imax
; }))

	)

185 
	#__CPU_OP_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, 
İ
) \

186 (
__ex‹nsiÚ__
 \

187 ({ 
ıu_£t_t
 *
__de¡
 = (
de¡£t
); \

188 cÚ¡ 
__ıu_mask
 *
__¬r1
 = (
¤c£t1
)->
__b™s
; \

189 cÚ¡ 
__ıu_mask
 *
__¬r2
 = (
¤c£t2
)->
__b™s
; \

190 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

191 
size_t
 
__i
; \

192 
__i
 = 0; __˜< 
__imax
; ++__i) \

193 ((
__ıu_mask
 *è
__de¡
->
__b™s
)[
__i
] = 
__¬r1
[__i] 
İ
 
__¬r2
[__i]; \

194 
__de¡
; }))

	)

196 
	#__CPU_ALLOC_SIZE
(
couÁ
) \

197 ((((
couÁ
è+ 
__NCPUBITS
 - 1è/ __NCPUBITSè*  (
__ıu_mask
))

	)

198 
	#__CPU_ALLOC
(
couÁ
è
	`__sched_ıu®loc
 (couÁ)

	)

199 
	#__CPU_FREE
(
ıu£t
è
	`__sched_ıuä“
 (ıu£t)

	)

201 
__BEGIN_DECLS


203 
	$__sched_ıucouÁ
 (
size_t
 
__£tsize
, cÚ¡ 
ıu_£t_t
 *
__£
)

204 
__THROW
;

205 
ıu_£t_t
 *
	$__sched_ıu®loc
 (
size_t
 
__couÁ
è
__THROW
 
__wur
;

206 
	$__sched_ıuä“
 (
ıu_£t_t
 *
__£t
è
__THROW
;

208 
__END_DECLS


	@/usr/include/bits/socket_type.h

19 #iâdeà
_SYS_SOCKET_H


24 
	e__sock‘_ty³


26 
	mSOCK_STREAM
 = 1,

28 
	#SOCK_STREAM
 
SOCK_STREAM


	)

29 
	mSOCK_DGRAM
 = 2,

31 
	#SOCK_DGRAM
 
SOCK_DGRAM


	)

32 
	mSOCK_RAW
 = 3,

33 
	#SOCK_RAW
 
SOCK_RAW


	)

34 
	mSOCK_RDM
 = 4,

35 
	#SOCK_RDM
 
SOCK_RDM


	)

36 
	mSOCK_SEQPACKET
 = 5,

38 
	#SOCK_SEQPACKET
 
SOCK_SEQPACKET


	)

39 
	mSOCK_DCCP
 = 6,

40 
	#SOCK_DCCP
 
SOCK_DCCP


	)

41 
	mSOCK_PACKET
 = 10,

44 
	#SOCK_PACKET
 
SOCK_PACKET


	)

49 
	mSOCK_CLOEXEC
 = 02000000,

51 
	#SOCK_CLOEXEC
 
SOCK_CLOEXEC


	)

52 
	mSOCK_NONBLOCK
 = 00004000

54 
	#SOCK_NONBLOCK
 
SOCK_NONBLOCK


	)

	@/usr/include/bits/syslog-ldbl.h

19 #iâdeà
_SYS_SYSLOG_H


23 
	$__LDBL_REDIR_DECL
 (
sy¦og
)

25 #ifdeà
__USE_MISC


26 
	$__LDBL_REDIR_DECL
 (
vsy¦og
)

29 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


30 
	$__LDBL_REDIR_DECL
 (
__sy¦og_chk
)

32 #ifdeà
__USE_MISC


33 
	$__LDBL_REDIR_DECL
 (
__vsy¦og_chk
)

	@/usr/include/bits/syslog-path.h

19 #iâdeà
_SYS_SYSLOG_H


23 #iâdeà
_BITS_SYSLOG_PATH_H


24 
	#_BITS_SYSLOG_PATH_H
 1

	)

26 
	#_PATH_LOG
 "/dev/log"

	)

	@/usr/include/bits/syslog.h

19 #iâdeà
_SYS_SYSLOG_H


24 
	$__sy¦og_chk
 (
__´i
, 
__æag
, cÚ¡ *
__fmt
, ...)

25 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

27 #ifdeà
__va_¬g_·ck


28 
__fÜtify_funùiÚ
 

29 
	$sy¦og
 (
__´i
, cÚ¡ *
__fmt
, ...)

31 
	`__sy¦og_chk
 (
__´i
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

32 
	}
}

33 #–ià!
defšed
 
__ılu¥lus


34 
	#sy¦og
(
´i
, ...) \

35 
	`__sy¦og_chk
 (
´i
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

39 #ifdeà
__USE_MISC


40 
	$__vsy¦og_chk
 (
__´i
, 
__æag
, cÚ¡ *
__fmt
,

41 
__gnuc_va_li¡
 
__­
)

42 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

44 
__fÜtify_funùiÚ
 

45 
	$vsy¦og
 (
__´i
, cÚ¡ *
__fmt
, 
__gnuc_va_li¡
 
__­
)

47 
	`__vsy¦og_chk
 (
__´i
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

48 
	}
}

	@/usr/include/bits/timex.h

18 #iâdef 
_BITS_TIMEX_H


19 
	#_BITS_TIMEX_H
 1

	)

21 
	~<b™s/ty³s.h
>

25 
	stimex


27 
	mmodes
;

28 
__sysÿÎ_¦Úg_t
 
	moff£t
;

29 
__sysÿÎ_¦Úg_t
 
	mäeq
;

30 
__sysÿÎ_¦Úg_t
 
	mmax”rÜ
;

31 
__sysÿÎ_¦Úg_t
 
	me¡”rÜ
;

32 
	m¡©us
;

33 
__sysÿÎ_¦Úg_t
 
	mcÚ¡ªt
;

34 
__sysÿÎ_¦Úg_t
 
	m´ecisiÚ
;

35 
__sysÿÎ_¦Úg_t
 
	mtŞ”ªû
;

36 
timev®
 
	mtime
;

37 
__sysÿÎ_¦Úg_t
 
	mtick
;

38 
__sysÿÎ_¦Úg_t
 
	mµsäeq
;

39 
__sysÿÎ_¦Úg_t
 
	mj™‹r
;

40 
	mshiá
;

41 
__sysÿÎ_¦Úg_t
 
	m¡ab
;

42 
__sysÿÎ_¦Úg_t
 
	mj™út
;

43 
__sysÿÎ_¦Úg_t
 
	mÿlút
;

44 
__sysÿÎ_¦Úg_t
 
	m”rút
;

45 
__sysÿÎ_¦Úg_t
 
	m¡bút
;

47 
	mi
;

56 
	#ADJ_OFFSET
 0x0001

	)

57 
	#ADJ_FREQUENCY
 0x0002

	)

58 
	#ADJ_MAXERROR
 0x0004

	)

59 
	#ADJ_ESTERROR
 0x0008

	)

60 
	#ADJ_STATUS
 0x0010

	)

61 
	#ADJ_TIMECONST
 0x0020

	)

62 
	#ADJ_TAI
 0x0080

	)

63 
	#ADJ_SETOFFSET
 0x0100

	)

64 
	#ADJ_MICRO
 0x1000

	)

65 
	#ADJ_NANO
 0x2000

	)

66 
	#ADJ_TICK
 0x4000

	)

67 
	#ADJ_OFFSET_SINGLESHOT
 0x8001

	)

68 
	#ADJ_OFFSET_SS_READ
 0xa001

	)

71 
	#MOD_OFFSET
 
ADJ_OFFSET


	)

72 
	#MOD_FREQUENCY
 
ADJ_FREQUENCY


	)

73 
	#MOD_MAXERROR
 
ADJ_MAXERROR


	)

74 
	#MOD_ESTERROR
 
ADJ_ESTERROR


	)

75 
	#MOD_STATUS
 
ADJ_STATUS


	)

76 
	#MOD_TIMECONST
 
ADJ_TIMECONST


	)

77 
	#MOD_CLKB
 
ADJ_TICK


	)

78 
	#MOD_CLKA
 
ADJ_OFFSET_SINGLESHOT


	)

79 
	#MOD_TAI
 
ADJ_TAI


	)

80 
	#MOD_MICRO
 
ADJ_MICRO


	)

81 
	#MOD_NANO
 
ADJ_NANO


	)

85 
	#STA_PLL
 0x0001

	)

86 
	#STA_PPSFREQ
 0x0002

	)

87 
	#STA_PPSTIME
 0x0004

	)

88 
	#STA_FLL
 0x0008

	)

90 
	#STA_INS
 0x0010

	)

91 
	#STA_DEL
 0x0020

	)

92 
	#STA_UNSYNC
 0x0040

	)

93 
	#STA_FREQHOLD
 0x0080

	)

95 
	#STA_PPSSIGNAL
 0x0100

	)

96 
	#STA_PPSJITTER
 0x0200

	)

97 
	#STA_PPSWANDER
 0x0400

	)

98 
	#STA_PPSERROR
 0x0800

	)

100 
	#STA_CLOCKERR
 0x1000

	)

101 
	#STA_NANO
 0x2000

	)

102 
	#STA_MODE
 0x4000

	)

103 
	#STA_CLK
 0x8000

	)

106 
	#STA_RONLY
 (
STA_PPSSIGNAL
 | 
STA_PPSJITTER
 | 
STA_PPSWANDER
 | \

107 
STA_PPSERROR
 | 
STA_CLOCKERR
 | 
STA_NANO
 | 
STA_MODE
 | 
STA_CLK
)

	)

	@/usr/include/bits/typesizes.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifdeà
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

74 
	#__CPU_MASK_TYPE
 
__SYSCALL_ULONG_TYPE


	)

76 #ifdeà
__x86_64__


80 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

83 
	#__INO_T_MATCHES_INO64_T
 1

	)

87 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___com·t_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/linux/errno.h

1 
	~<asm/”ºo.h
>

	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<lšux/sysšfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
è
	`__ALIGN_KERNEL_MASK
(x, (
	`ty³of
(x))×è- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
è(((xè+ (mask)è& ~(mask))

	)

12 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
è((Òè+ (dè- 1è/ (d))

	)

	@/usr/include/linux/limits.h

1 #iâdeà
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/param.h

1 #iâdeà
_LINUX_PARAM_H


2 
	#_LINUX_PARAM_H


	)

4 
	~<asm/·¿m.h
>

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty³s.h
>

6 #iâdeà
__ASSEMBLY__


8 
	~<lšux/posix_ty³s.h
>

16 #ifdeà
__CHECKER__


17 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

19 
	#__b™wi£__


	)

21 #ifdeà
__CHECK_ENDIAN__


22 
	#__b™wi£
 
__b™wi£__


	)

24 
	#__b™wi£


	)

27 
__u16
 
	t__b™wi£
 
	t__Ë16
;

28 
__u16
 
	t__b™wi£
 
	t__be16
;

29 
__u32
 
	t__b™wi£
 
	t__Ë32
;

30 
__u32
 
	t__b™wi£
 
	t__be32
;

31 
__u64
 
	t__b™wi£
 
	t__Ë64
;

32 
__u64
 
	t__b™wi£
 
	t__be64
;

34 
__u16
 
	t__b™wi£
 
	t__sum16
;

35 
__u32
 
	t__b™wi£
 
	t__wsum
;

46 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

48 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

	@/usr/include/asm-generic/ioctls.h

1 #iâdeà
__ASM_GENERIC_IOCTLS_H


2 
	#__ASM_GENERIC_IOCTLS_H


	)

4 
	~<lšux/ioùl.h
>

19 
	#TCGETS
 0x5401

	)

20 
	#TCSETS
 0x5402

	)

21 
	#TCSETSW
 0x5403

	)

22 
	#TCSETSF
 0x5404

	)

23 
	#TCGETA
 0x5405

	)

24 
	#TCSETA
 0x5406

	)

25 
	#TCSETAW
 0x5407

	)

26 
	#TCSETAF
 0x5408

	)

27 
	#TCSBRK
 0x5409

	)

28 
	#TCXONC
 0x540A

	)

29 
	#TCFLSH
 0x540B

	)

30 
	#TIOCEXCL
 0x540C

	)

31 
	#TIOCNXCL
 0x540D

	)

32 
	#TIOCSCTTY
 0x540E

	)

33 
	#TIOCGPGRP
 0x540F

	)

34 
	#TIOCSPGRP
 0x5410

	)

35 
	#TIOCOUTQ
 0x5411

	)

36 
	#TIOCSTI
 0x5412

	)

37 
	#TIOCGWINSZ
 0x5413

	)

38 
	#TIOCSWINSZ
 0x5414

	)

39 
	#TIOCMGET
 0x5415

	)

40 
	#TIOCMBIS
 0x5416

	)

41 
	#TIOCMBIC
 0x5417

	)

42 
	#TIOCMSET
 0x5418

	)

43 
	#TIOCGSOFTCAR
 0x5419

	)

44 
	#TIOCSSOFTCAR
 0x541A

	)

45 
	#FIONREAD
 0x541B

	)

46 
	#TIOCINQ
 
FIONREAD


	)

47 
	#TIOCLINUX
 0x541C

	)

48 
	#TIOCCONS
 0x541D

	)

49 
	#TIOCGSERIAL
 0x541E

	)

50 
	#TIOCSSERIAL
 0x541F

	)

51 
	#TIOCPKT
 0x5420

	)

52 
	#FIONBIO
 0x5421

	)

53 
	#TIOCNOTTY
 0x5422

	)

54 
	#TIOCSETD
 0x5423

	)

55 
	#TIOCGETD
 0x5424

	)

56 
	#TCSBRKP
 0x5425

	)

57 
	#TIOCSBRK
 0x5427

	)

58 
	#TIOCCBRK
 0x5428

	)

59 
	#TIOCGSID
 0x5429

	)

60 
	#TCGETS2
 
	`_IOR
('T', 0x2A, 
‹rmios2
)

	)

61 
	#TCSETS2
 
	`_IOW
('T', 0x2B, 
‹rmios2
)

	)

62 
	#TCSETSW2
 
	`_IOW
('T', 0x2C, 
‹rmios2
)

	)

63 
	#TCSETSF2
 
	`_IOW
('T', 0x2D, 
‹rmios2
)

	)

64 
	#TIOCGRS485
 0x542E

	)

65 #iâdeà
TIOCSRS485


66 
	#TIOCSRS485
 0x542F

	)

68 
	#TIOCGPTN
 
	`_IOR
('T', 0x30, è

	)

69 
	#TIOCSPTLCK
 
	`_IOW
('T', 0x31, è

	)

70 
	#TIOCGDEV
 
	`_IOR
('T', 0x32, è

	)

71 
	#TCGETX
 0x5432

	)

72 
	#TCSETX
 0x5433

	)

73 
	#TCSETXF
 0x5434

	)

74 
	#TCSETXW
 0x5435

	)

75 
	#TIOCSIG
 
	`_IOW
('T', 0x36, è

	)

76 
	#TIOCVHANGUP
 0x5437

	)

77 
	#TIOCGPKT
 
	`_IOR
('T', 0x38, è

	)

78 
	#TIOCGPTLCK
 
	`_IOR
('T', 0x39, è

	)

79 
	#TIOCGEXCL
 
	`_IOR
('T', 0x40, è

	)

81 
	#FIONCLEX
 0x5450

	)

82 
	#FIOCLEX
 0x5451

	)

83 
	#FIOASYNC
 0x5452

	)

84 
	#TIOCSERCONFIG
 0x5453

	)

85 
	#TIOCSERGWILD
 0x5454

	)

86 
	#TIOCSERSWILD
 0x5455

	)

87 
	#TIOCGLCKTRMIOS
 0x5456

	)

88 
	#TIOCSLCKTRMIOS
 0x5457

	)

89 
	#TIOCSERGSTRUCT
 0x5458

	)

90 
	#TIOCSERGETLSR
 0x5459

	)

91 
	#TIOCSERGETMULTI
 0x545A

	)

92 
	#TIOCSERSETMULTI
 0x545B

	)

94 
	#TIOCMIWAIT
 0x545C

	)

95 
	#TIOCGICOUNT
 0x545D

	)

101 #iâdeà
FIOQSIZE


102 
	#FIOQSIZE
 0x5460

	)

106 
	#TIOCPKT_DATA
 0

	)

107 
	#TIOCPKT_FLUSHREAD
 1

	)

108 
	#TIOCPKT_FLUSHWRITE
 2

	)

109 
	#TIOCPKT_STOP
 4

	)

110 
	#TIOCPKT_START
 8

	)

111 
	#TIOCPKT_NOSTOP
 16

	)

112 
	#TIOCPKT_DOSTOP
 32

	)

113 
	#TIOCPKT_IOCTL
 64

	)

115 
	#TIOCSER_TEMT
 0x01

	)

	@/usr/include/asm-generic/socket.h

1 #iâdeà
__ASM_GENERIC_SOCKET_H


2 
	#__ASM_GENERIC_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

24 
	#SO_BSDCOMPAT
 14

	)

25 
	#SO_REUSEPORT
 15

	)

26 #iâdeà
SO_PASSCRED


27 
	#SO_PASSCRED
 16

	)

28 
	#SO_PEERCRED
 17

	)

29 
	#SO_RCVLOWAT
 18

	)

30 
	#SO_SNDLOWAT
 19

	)

31 
	#SO_RCVTIMEO
 20

	)

32 
	#SO_SNDTIMEO
 21

	)

36 
	#SO_SECURITY_AUTHENTICATION
 22

	)

37 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

38 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

40 
	#SO_BINDTODEVICE
 25

	)

43 
	#SO_ATTACH_FILTER
 26

	)

44 
	#SO_DETACH_FILTER
 27

	)

45 
	#SO_GET_FILTER
 
SO_ATTACH_FILTER


	)

47 
	#SO_PEERNAME
 28

	)

48 
	#SO_TIMESTAMP
 29

	)

49 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

51 
	#SO_ACCEPTCONN
 30

	)

53 
	#SO_PEERSEC
 31

	)

54 
	#SO_PASSSEC
 34

	)

55 
	#SO_TIMESTAMPNS
 35

	)

56 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

58 
	#SO_MARK
 36

	)

60 
	#SO_TIMESTAMPING
 37

	)

61 
	#SCM_TIMESTAMPING
 
SO_TIMESTAMPING


	)

63 
	#SO_PROTOCOL
 38

	)

64 
	#SO_DOMAIN
 39

	)

66 
	#SO_RXQ_OVFL
 40

	)

68 
	#SO_WIFI_STATUS
 41

	)

69 
	#SCM_WIFI_STATUS
 
SO_WIFI_STATUS


	)

70 
	#SO_PEEK_OFF
 42

	)

73 
	#SO_NOFCS
 43

	)

75 
	#SO_LOCK_FILTER
 44

	)

77 
	#SO_SELECT_ERR_QUEUE
 45

	)

79 
	#SO_BUSY_POLL
 46

	)

81 
	#SO_MAX_PACING_RATE
 47

	)

83 
	#SO_BPF_EXTENSIONS
 48

	)

85 
	#SO_INCOMING_CPU
 49

	)

87 
	#SO_ATTACH_BPF
 50

	)

88 
	#SO_DETACH_BPF
 
SO_DETACH_FILTER


	)

90 
	#SO_ATTACH_REUSEPORT_CBPF
 51

	)

91 
	#SO_ATTACH_REUSEPORT_EBPF
 52

	)

93 
	#SO_CNX_ADVICE
 53

	)

	@/usr/include/asm/errno.h

1 
	~<asm-g’”ic/”ºo.h
>

	@/usr/include/asm/param.h

1 
	~<asm-g’”ic/·¿m.h
>

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gcÚv_¡•
;

66 
	g__gcÚv_¡•_d©a
;

67 
	g__gcÚv_lßded_objeù
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 
	s__gcÚv_¡•


86 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

87 cÚ¡ *
__modÇme
;

89 
__couÁ”
;

91 *
__äom_Çme
;

92 *
__to_Çme
;

94 
__gcÚv_fù
 
__fù
;

95 
__gcÚv_btowc_fù
 
__btowc_fù
;

96 
__gcÚv_š™_fù
 
__š™_fù
;

97 
__gcÚv_’d_fù
 
__’d_fù
;

101 
__mš_Ãeded_äom
;

102 
__max_Ãeded_äom
;

103 
__mš_Ãeded_to
;

104 
__max_Ãeded_to
;

107 
__¡©eful
;

109 *
__d©a
;

114 
	s__gcÚv_¡•_d©a


116 *
__outbuf
;

117 *
__outbuãnd
;

121 
__æags
;

125 
__švoÿtiÚ_couÁ”
;

129 
__š‹º®_u£
;

131 
__mb¡©e_t
 *
__¡©•
;

132 
__mb¡©e_t
 
__¡©e
;

138 
	s__gcÚv_šfo


140 
size_t
 
__n¡•s
;

141 
__gcÚv_¡•
 *
__¡•s
;

142 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

143 } *
	t__gcÚv_t
;

146 
	`__gcÚv_Œª¦™”©e
 (
__gcÚv_¡•
 *
¡•
,

147 
__gcÚv_¡•_d©a
 *
¡•_d©a
,

148 cÚ¡ *
šbuf¡¬t
,

149 cÚ¡ **
šbuå
,

150 cÚ¡ *
šbuãnd
,

151 **
outbuf¡¬t
,

152 
size_t
 *
œ»v”sibË
);

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__k”Ãl_fd_£t
;

29 (*
	t__k”Ãl_sighªdËr_t
)();

32 
	t__k”Ãl_key_t
;

33 
	t__k”Ãl_mqd_t
;

35 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/sysinfo.h

1 #iâdeà
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<lšux/ty³s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysšfo
 {

8 
__k”Ãl_lÚg_t
 
	mu±ime
;

9 
__k”Ãl_ulÚg_t
 
	mlßds
[3];

10 
__k”Ãl_ulÚg_t
 
	mtÙ®¿m
;

11 
__k”Ãl_ulÚg_t
 
	mä“¿m
;

12 
__k”Ãl_ulÚg_t
 
	msh¬ed¿m
;

13 
__k”Ãl_ulÚg_t
 
	mbufã¼am
;

14 
__k”Ãl_ulÚg_t
 
	mtÙ®sw­
;

15 
__k”Ãl_ulÚg_t
 
	mä“sw­
;

16 
__u16
 
	m´ocs
;

17 
__u16
 
	m·d
;

18 
__k”Ãl_ulÚg_t
 
	mtÙ®high
;

19 
__k”Ãl_ulÚg_t
 
	mä“high
;

20 
__u32
 
	mmem_un™
;

21 
	m_f
[20-2*(
__k”Ãl_ulÚg_t
)-(
__u32
)];

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
)

149 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

152 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

154 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

157 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

158 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
)

159 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

161 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

162 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

163 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

166 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

169 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifdeà
__USE_XOPEN2K8


175 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

178 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

179 
size_t
 
__n
è
__THROW
;

183 
	~<xloÿË.h
>

185 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
__loÿË_t
 
__loc
è
__THROW
;

188 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

189 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscŞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

199 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

200 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifdeà
__USE_XOPEN2K8


209 
	$wcscŞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

210 
__loÿË_t
 
__loc
è
__THROW
;

215 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

216 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

219 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

230 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

231 
__THROW
 
__©Œibu‹_pu»__
;

234 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

236 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

240 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

241 
__THROW
 
__©Œibu‹_pu»__
;

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_GNU


248 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

249 
__THROW
 
__©Œibu‹_pu»__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

256 
__THROW
 
__©Œibu‹_pu»__
;

259 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

260 
__THROW
 
__©Œibu‹_pu»__
;

262 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

265 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

266 cÚ¡ 
wch¬_t
 *
__acû±
)

267 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

269 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

270 
__THROW
 
__©Œibu‹_pu»__
;

273 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

276 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

277 cÚ¡ 
wch¬_t
 *
__ÃedË
)

278 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

280 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

281 
__THROW
 
__©Œibu‹_pu»__
;

285 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

286 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

287 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

290 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

291 
__END_NAMESPACE_STD


293 #ifdeà
__USE_XOPEN


295 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

298 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

299 cÚ¡ 
wch¬_t
 *
__ÃedË
)

300 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

302 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

303 
__THROW
 
__©Œibu‹_pu»__
;

307 #ifdeà
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

310 
__THROW
 
__©Œibu‹_pu»__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

319 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

323 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©Œibu‹_pu»__
;

328 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©Œibu‹_pu»__
;

332 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

333 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

337 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifdeà
__USE_GNU


347 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

348 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

360 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

364 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

368 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

369 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

370 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

373 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

374 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

377 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

378 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

379 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

380 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifdeà
__USE_EXTERN_INLINES


389 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

390 
__ex‹º_šlše
 
wšt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

395 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

396 
__ex‹º_šlše
 

397 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

398 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

399 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

401 
__ex‹º_šlše
 
size_t


402 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

403 
mb¡©e_t
 *
__»¡riù
 
__ps
))

404 {  (
__ps
 !ğ
NULL


405 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

412 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

413 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

418 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

419 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

427 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

428 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

432 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

433 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

434 
size_t
 
__nwc
, size_ˆ
__Ën
,

435 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

440 #ifdeà
__USE_XOPEN


442 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

446 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

454 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifdeà
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

461 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

462 
	$wc¡Şd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

463 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc¡Ş
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

472 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

476 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

477 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifdeà
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__ex‹nsiÚ__


486 
	$wc¡Şl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

487 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

488 
__THROW
;

492 
__ex‹nsiÚ__


493 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

494 
wch¬_t
 **
__»¡riù
 
__’d±r
,

495 
__ba£
è
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifdeà
__USE_GNU


502 
__ex‹nsiÚ__


503 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

504 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

505 
__THROW
;

509 
__ex‹nsiÚ__


510 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

511 
wch¬_t
 **
__»¡riù
 
__’d±r
,

512 
__ba£
è
__THROW
;

515 #ifdeà
__USE_GNU


529 
	~<xloÿË.h
>

533 
	$wc¡Ş_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

534 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

535 
__loÿË_t
 
__loc
è
__THROW
;

537 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

538 
wch¬_t
 **
__»¡riù
 
__’d±r
,

539 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

541 
__ex‹nsiÚ__


542 
	$wc¡Şl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

543 
wch¬_t
 **
__»¡riù
 
__’d±r
,

544 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

546 
__ex‹nsiÚ__


547 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

548 
wch¬_t
 **
__»¡riù
 
__’d±r
,

549 
__ba£
, 
__loÿË_t
 
__loc
)

550 
__THROW
;

552 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

553 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

554 
__THROW
;

556 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

557 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

558 
__THROW
;

560 
	$wc¡Şd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

561 
wch¬_t
 **
__»¡riù
 
__’d±r
,

562 
__loÿË_t
 
__loc
è
__THROW
;

566 #ifdeà
__USE_XOPEN2K8


569 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

570 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

574 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

575 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

586 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

597 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

598 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

607 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

608 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

609 
__THROW
 ;

615 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

616 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

617 
__gnuc_va_li¡
 
__¬g
)

623 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

624 
__gnuc_va_li¡
 
__¬g
)

628 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

629 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

630 
__gnuc_va_li¡
 
__¬g
)

631 
__THROW
 ;

638 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

639 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

648 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

649 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

650 
__THROW
 ;

652 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

653 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

654 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

655 #ifdeà
__REDIRECT


659 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

660 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_fwsÿnf
)

663 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

664 
__isoc99_wsÿnf
)

666 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

667 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

668 ...), 
__isoc99_swsÿnf
)

671 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

673 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

674 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

675 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

676 
__THROW
;

677 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

678 
	#wsÿnf
 
__isoc99_wsÿnf


	)

679 
	#swsÿnf
 
__isoc99_swsÿnf


	)

683 
__END_NAMESPACE_STD


686 #ifdeà
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

693 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

694 
__gnuc_va_li¡
 
__¬g
)

700 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

701 
__gnuc_va_li¡
 
__¬g
)

704 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

705 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

706 
__gnuc_va_li¡
 
__¬g
)

707 
__THROW
 ;

709 #ià!
defšed
 
__USE_GNU
 \

710 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

711 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

712 #ifdeà
__REDIRECT


713 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

714 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

717 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

718 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

720 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

721 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

722 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

725 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

726 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

727 
__gnuc_va_li¡
 
__¬g
);

728 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
);

730 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

731 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

732 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

733 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

734 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

735 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

749 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

755 
wšt_t
 
	`g‘wch¬
 ();

762 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

763 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

769 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

777 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

778 
__FILE
 *
__»¡riù
 
__¡»am
);

784 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

785 
__FILE
 *
__»¡riù
 
__¡»am
);

792 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

793 
__END_NAMESPACE_STD


796 #ifdeà
__USE_GNU


804 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

805 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

813 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

821 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

830 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

831 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

840 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

841 
__FILE
 *
__»¡riù
 
__¡»am
);

849 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

850 
__FILE
 *
__»¡riù
 
__¡»am
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

859 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

860 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifdeà
__USE_GNU


864 
	~<xloÿË.h
>

868 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

869 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

870 cÚ¡ 
tm
 *
__»¡riù
 
__
,

871 
__loÿË_t
 
__loc
è
__THROW
;

880 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


881 
	#__Ãed_iswxxx


	)

882 
	~<wùy³.h
>

886 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


887 
	~<b™s/wch¬2.h
>

890 #ifdeà
__LDBL_COMPAT


891 
	~<b™s/wch¬-ldbl.h
>

894 
__END_DECLS


902 #undeà
__Ãed_mb¡©e_t


903 #undeà
__Ãed_wšt_t


	@/usr/include/asm-generic/errno.h

1 #iâdeà
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-g’”ic/”ºo-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

17 
	#ENOSYS
 38

	)

19 
	#ENOTEMPTY
 39

	)

20 
	#ELOOP
 40

	)

21 
	#EWOULDBLOCK
 
EAGAIN


	)

22 
	#ENOMSG
 42

	)

23 
	#EIDRM
 43

	)

24 
	#ECHRNG
 44

	)

25 
	#EL2NSYNC
 45

	)

26 
	#EL3HLT
 46

	)

27 
	#EL3RST
 47

	)

28 
	#ELNRNG
 48

	)

29 
	#EUNATCH
 49

	)

30 
	#ENOCSI
 50

	)

31 
	#EL2HLT
 51

	)

32 
	#EBADE
 52

	)

33 
	#EBADR
 53

	)

34 
	#EXFULL
 54

	)

35 
	#ENOANO
 55

	)

36 
	#EBADRQC
 56

	)

37 
	#EBADSLT
 57

	)

39 
	#EDEADLOCK
 
EDEADLK


	)

41 
	#EBFONT
 59

	)

42 
	#ENOSTR
 60

	)

43 
	#ENODATA
 61

	)

44 
	#ETIME
 62

	)

45 
	#ENOSR
 63

	)

46 
	#ENONET
 64

	)

47 
	#ENOPKG
 65

	)

48 
	#EREMOTE
 66

	)

49 
	#ENOLINK
 67

	)

50 
	#EADV
 68

	)

51 
	#ESRMNT
 69

	)

52 
	#ECOMM
 70

	)

53 
	#EPROTO
 71

	)

54 
	#EMULTIHOP
 72

	)

55 
	#EDOTDOT
 73

	)

56 
	#EBADMSG
 74

	)

57 
	#EOVERFLOW
 75

	)

58 
	#ENOTUNIQ
 76

	)

59 
	#EBADFD
 77

	)

60 
	#EREMCHG
 78

	)

61 
	#ELIBACC
 79

	)

62 
	#ELIBBAD
 80

	)

63 
	#ELIBSCN
 81

	)

64 
	#ELIBMAX
 82

	)

65 
	#ELIBEXEC
 83

	)

66 
	#EILSEQ
 84

	)

67 
	#ERESTART
 85

	)

68 
	#ESTRPIPE
 86

	)

69 
	#EUSERS
 87

	)

70 
	#ENOTSOCK
 88

	)

71 
	#EDESTADDRREQ
 89

	)

72 
	#EMSGSIZE
 90

	)

73 
	#EPROTOTYPE
 91

	)

74 
	#ENOPROTOOPT
 92

	)

75 
	#EPROTONOSUPPORT
 93

	)

76 
	#ESOCKTNOSUPPORT
 94

	)

77 
	#EOPNOTSUPP
 95

	)

78 
	#EPFNOSUPPORT
 96

	)

79 
	#EAFNOSUPPORT
 97

	)

80 
	#EADDRINUSE
 98

	)

81 
	#EADDRNOTAVAIL
 99

	)

82 
	#ENETDOWN
 100

	)

83 
	#ENETUNREACH
 101

	)

84 
	#ENETRESET
 102

	)

85 
	#ECONNABORTED
 103

	)

86 
	#ECONNRESET
 104

	)

87 
	#ENOBUFS
 105

	)

88 
	#EISCONN
 106

	)

89 
	#ENOTCONN
 107

	)

90 
	#ESHUTDOWN
 108

	)

91 
	#ETOOMANYREFS
 109

	)

92 
	#ETIMEDOUT
 110

	)

93 
	#ECONNREFUSED
 111

	)

94 
	#EHOSTDOWN
 112

	)

95 
	#EHOSTUNREACH
 113

	)

96 
	#EALREADY
 114

	)

97 
	#EINPROGRESS
 115

	)

98 
	#ESTALE
 116

	)

99 
	#EUCLEAN
 117

	)

100 
	#ENOTNAM
 118

	)

101 
	#ENAVAIL
 119

	)

102 
	#EISNAM
 120

	)

103 
	#EREMOTEIO
 121

	)

104 
	#EDQUOT
 122

	)

106 
	#ENOMEDIUM
 123

	)

107 
	#EMEDIUMTYPE
 124

	)

108 
	#ECANCELED
 125

	)

109 
	#ENOKEY
 126

	)

110 
	#EKEYEXPIRED
 127

	)

111 
	#EKEYREVOKED
 128

	)

112 
	#EKEYREJECTED
 129

	)

115 
	#EOWNERDEAD
 130

	)

116 
	#ENOTRECOVERABLE
 131

	)

118 
	#ERFKILL
 132

	)

120 
	#EHWPOISON
 133

	)

	@/usr/include/asm-generic/param.h

1 #iâdeà
__ASM_GENERIC_PARAM_H


2 
	#__ASM_GENERIC_PARAM_H


	)

4 #iâdeà
HZ


5 
	#HZ
 100

	)

8 #iâdeà
EXEC_PAGESIZE


9 
	#EXEC_PAGESIZE
 4096

	)

12 #iâdeà
NOGROUP


13 
	#NOGROUP
 (-1)

	)

16 
	#MAXHOSTNAMELEN
 64

	)

	@/usr/include/asm-generic/types.h

1 #iâdeà
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

6 
	~<asm-g’”ic/št-Î64.h
>

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~<asm/posix_ty³s_32.h
>

3 #–ià
defšed
(
__ILP32__
)

4 
	~<asm/posix_ty³s_x32.h
>

6 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm/sockios.h

1 
	~<asm-g’”ic/sockios.h
>

	@/usr/include/bits/wchar-ldbl.h

19 #iâdeà
_WCHAR_H


23 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


24 
__BEGIN_NAMESPACE_C99


25 
__LDBL_REDIR_DECL
 (
fw´štf
);

26 
__LDBL_REDIR_DECL
 (
w´štf
);

27 
__LDBL_REDIR_DECL
 (
sw´štf
);

28 
__LDBL_REDIR_DECL
 (
vfw´štf
);

29 
__LDBL_REDIR_DECL
 (
vw´štf
);

30 
__LDBL_REDIR_DECL
 (
vsw´štf
);

31 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

32 && !
defšed
 
	g__REDIRECT
 \

33 && (
defšed
 
	g__STRICT_ANSI__
 || defšed 
	g__USE_XOPEN2K
)

34 
	$__LDBL_REDIR1_DECL
 (
fwsÿnf
, 
__Ædbl___isoc99_fwsÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
wsÿnf
, 
__Ædbl___isoc99_wsÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
swsÿnf
, 
__Ædbl___isoc99_swsÿnf
)

38 
	`__LDBL_REDIR_DECL
 (
fwsÿnf
);

39 
	`__LDBL_REDIR_DECL
 (
wsÿnf
);

40 
	`__LDBL_REDIR_DECL
 (
swsÿnf
);

42 
__END_NAMESPACE_C99


45 #ifdeà
__USE_ISOC99


46 
__BEGIN_NAMESPACE_C99


47 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd
, 
wc¡od
);

48 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

49 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

50 
	$__LDBL_REDIR1_DECL
 (
vfwsÿnf
, 
__Ædbl___isoc99_vfwsÿnf
)

51 
	$__LDBL_REDIR1_DECL
 (
vwsÿnf
, 
__Ædbl___isoc99_vwsÿnf
)

52 
	$__LDBL_REDIR1_DECL
 (
vswsÿnf
, 
__Ædbl___isoc99_vswsÿnf
)

54 
	`__LDBL_REDIR_DECL
 (
vfwsÿnf
);

55 
	`__LDBL_REDIR_DECL
 (
vwsÿnf
);

56 
	`__LDBL_REDIR_DECL
 (
vswsÿnf
);

58 
__END_NAMESPACE_C99


61 #ifdeà
__USE_GNU


62 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd_l
, 
wc¡od_l
);

65 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


66 
	$__LDBL_REDIR_DECL
 (
__sw´štf_chk
)

67 
	$__LDBL_REDIR_DECL
 (
__vsw´štf_chk
)

68 #ià
__USE_FORTIFY_LEVEL
 > 1

69 
	$__LDBL_REDIR_DECL
 (
__fw´štf_chk
)

70 
	$__LDBL_REDIR_DECL
 (
__w´štf_chk
)

71 
	$__LDBL_REDIR_DECL
 (
__vfw´štf_chk
)

72 
	$__LDBL_REDIR_DECL
 (
__vw´štf_chk
)

	@/usr/include/bits/wchar2.h

19 #iâdeà
_WCHAR_H


24 
wch¬_t
 *
	$__wmemıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

25 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

26 
size_t
 
__ns1
è
__THROW
;

27 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_®Ÿs
,

28 (
wch¬_t
 *
__»¡riù
 
__s1
,

29 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
),

30 
wmemıy
);

31 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_chk_w¬n
,

32 (
wch¬_t
 *
__»¡riù
 
__s1
,

33 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

34 
size_t
 
__ns1
), 
__wmemıy_chk
)

35 
	`__w¬Ç‰r
 ("wmemcpy called with†ength biggerhan size of destination "

38 
__fÜtify_funùiÚ
 
wch¬_t
 *

39 
	`__NTH
 (
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, cÚ¡ wch¬_ˆ*__»¡riù 
__s2
,

40 
size_t
 
__n
))

42 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

44 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

45  
	`__wmemıy_chk
 (
__s1
, 
__s2
, 
__n
,

46 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

48 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

49  
	`__wmemıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

50 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

52  
	`__wmemıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

53 
	}
}

56 
wch¬_t
 *
	$__wmemmove_chk
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

57 
size_t
 
__n
, size_ˆ
__ns1
è
__THROW
;

58 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_®Ÿs
, (wch¬_ˆ*
__s1
,

59 cÚ¡ 
wch¬_t
 *
__s2
,

60 
size_t
 
__n
), 
wmemmove
);

61 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_chk_w¬n
,

62 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

63 
size_t
 
__n
, size_ˆ
__ns1
), 
__wmemmove_chk
)

64 
	`__w¬Ç‰r
 ("wmemmove called with†ength biggerhan size of destination "

67 
__fÜtify_funùiÚ
 
wch¬_t
 *

68 
	`__NTH
 (
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
))

70 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

72 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

73  
	`__wmemmove_chk
 (
__s1
, 
__s2
, 
__n
,

74 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

76 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

77  
	`__wmemmove_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

78 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

80  
	`__wmemmove_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

81 
	}
}

84 #ifdeà
__USE_GNU


85 
wch¬_t
 *
	$__wmempıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

86 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

87 
size_t
 
__ns1
è
__THROW
;

88 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_®Ÿs
,

89 (
wch¬_t
 *
__»¡riù
 
__s1
,

90 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
,

91 
size_t
 
__n
), 
wmempıy
);

92 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_chk_w¬n
,

93 (
wch¬_t
 *
__»¡riù
 
__s1
,

94 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

95 
size_t
 
__ns1
), 
__wmempıy_chk
)

96 
	`__w¬Ç‰r
 ("wmempcpy called with†ength biggerhan size of destination "

99 
__fÜtify_funùiÚ
 
wch¬_t
 *

100 
	`__NTH
 (
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, cÚ¡ wch¬_ˆ*__»¡riù 
__s2
,

101 
size_t
 
__n
))

103 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

105 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

106  
	`__wmempıy_chk
 (
__s1
, 
__s2
, 
__n
,

107 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

109 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

110  
	`__wmempıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

111 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

113  
	`__wmempıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

114 
	}
}

118 
wch¬_t
 *
	$__wmem£t_chk
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

119 
size_t
 
__ns
è
__THROW
;

120 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_®Ÿs
, (wch¬_ˆ*
__s
, wch¬_ˆ
__c
,

121 
size_t
 
__n
), 
wmem£t
);

122 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_chk_w¬n
,

123 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

124 
size_t
 
__ns
), 
__wmem£t_chk
)

125 
	`__w¬Ç‰r
 ("wmemset called with†ength biggerhan size of destination "

128 
__fÜtify_funùiÚ
 
wch¬_t
 *

129 
	`__NTH
 (
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
))

131 ià(
	`__bos0
 (
__s
è!ğ(
size_t
) -1)

133 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

134  
	`__wmem£t_chk
 (
__s
, 
__c
, 
__n
, 
	`__bos0
 (__sè/  (
wch¬_t
));

136 ià(
__n
 > 
	`__bos0
 (
__s
è/  (
wch¬_t
))

137  
	`__wmem£t_chk_w¬n
 (
__s
, 
__c
, 
__n
,

138 
	`__bos0
 (
__s
è/  (
wch¬_t
));

140  
	`__wmem£t_®Ÿs
 (
__s
, 
__c
, 
__n
);

141 
	}
}

144 
wch¬_t
 *
	$__wcsıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

146 
size_t
 
__n
è
__THROW
;

147 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsıy_®Ÿs
,

148 (
wch¬_t
 *
__»¡riù
 
__de¡
,

149 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsıy
);

151 
__fÜtify_funùiÚ
 
wch¬_t
 *

152 
	`__NTH
 (
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

154 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

155  
	`__wcsıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

156  
	`__wcsıy_®Ÿs
 (
__de¡
, 
__¤c
);

157 
	}
}

160 
wch¬_t
 *
	$__wııy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

161 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

162 
size_t
 
__de¡Ën
è
__THROW
;

163 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wııy_®Ÿs
,

164 (
wch¬_t
 *
__»¡riù
 
__de¡
,

165 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wııy
);

167 
__fÜtify_funùiÚ
 
wch¬_t
 *

168 
	`__NTH
 (
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

170 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

171  
	`__wııy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

172  
	`__wııy_®Ÿs
 (
__de¡
, 
__¤c
);

173 
	}
}

176 
wch¬_t
 *
	$__wc¢ıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

177 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

178 
size_t
 
__de¡Ën
è
__THROW
;

179 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_®Ÿs
,

180 (
wch¬_t
 *
__»¡riù
 
__de¡
,

181 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

182 
size_t
 
__n
), 
wc¢ıy
);

183 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_chk_w¬n
,

184 (
wch¬_t
 *
__»¡riù
 
__de¡
,

185 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

186 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wc¢ıy_chk
)

187 
	`__w¬Ç‰r
 ("wcsncpy called with†ength biggerhan size of destination "

190 
__fÜtify_funùiÚ
 
wch¬_t
 *

191 
	`__NTH
 (
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

192 
size_t
 
__n
))

194 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

196 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

197  
	`__wc¢ıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

198 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

199 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

200  
	`__wc¢ıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

201 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

203  
	`__wc¢ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

204 
	}
}

207 
wch¬_t
 *
	$__wınıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

208 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

209 
size_t
 
__de¡Ën
è
__THROW
;

210 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_®Ÿs
,

211 (
wch¬_t
 *
__»¡riù
 
__de¡
,

212 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

213 
size_t
 
__n
), 
wınıy
);

214 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_chk_w¬n
,

215 (
wch¬_t
 *
__»¡riù
 
__de¡
,

216 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

217 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wınıy_chk
)

218 
	`__w¬Ç‰r
 ("wcpncpy called with†ength biggerhan size of destination "

221 
__fÜtify_funùiÚ
 
wch¬_t
 *

222 
	`__NTH
 (
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

223 
size_t
 
__n
))

225 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

227 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

228  
	`__wınıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

229 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

230 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

231  
	`__wınıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

232 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

234  
	`__wınıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

235 
	}
}

238 
wch¬_t
 *
	$__wcsÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

239 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

240 
size_t
 
__de¡Ën
è
__THROW
;

241 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsÿt_®Ÿs
,

242 (
wch¬_t
 *
__»¡riù
 
__de¡
,

243 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsÿt
);

245 
__fÜtify_funùiÚ
 
wch¬_t
 *

246 
	`__NTH
 (
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

248 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

249  
	`__wcsÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

250  
	`__wcsÿt_®Ÿs
 (
__de¡
, 
__¤c
);

251 
	}
}

254 
wch¬_t
 *
	$__wc¢ÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

255 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

256 
size_t
 
__n
, size_ˆ
__de¡Ën
è
__THROW
;

257 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ÿt_®Ÿs
,

258 (
wch¬_t
 *
__»¡riù
 
__de¡
,

259 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

260 
size_t
 
__n
), 
wc¢ÿt
);

262 
__fÜtify_funùiÚ
 
wch¬_t
 *

263 
	`__NTH
 (
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

264 
size_t
 
__n
))

266 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

267  
	`__wc¢ÿt_chk
 (
__de¡
, 
__¤c
, 
__n
,

268 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

269  
	`__wc¢ÿt_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

270 
	}
}

273 
	$__sw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

274 
__æag
, 
size_t
 
__s_Ën
,

275 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

276 
__THROW
 ;

278 
	`__REDIRECT_NTH_LDBL
 (
__sw´štf_®Ÿs
,

279 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

280 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...),

281 
sw´štf
);

283 #ifdeà
__va_¬g_·ck


284 
__fÜtify_funùiÚ
 

285 
	`__NTH
 (
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

286 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...))

288 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

289  
	`__sw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

290 
	`__bos
 (
__s
è/  (
wch¬_t
),

291 
__fmt
, 
	`__va_¬g_·ck
 ());

292  
	`__sw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
	`__va_¬g_·ck
 ());

293 
	}
}

294 #–ià!
defšed
 
__ılu¥lus


296 
	#sw´štf
(
s
, 
n
, ...) \

297 (
	`__bos
 (
s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1 \

298 ? 
	`__sw´štf_chk
 (
s
, 
n
, 
__USE_FORTIFY_LEVEL
 - 1, \

299 
	`__bos
 (
s
è/  (
wch¬_t
), 
__VA_ARGS__
) \

300 : 
	`sw´štf
 (
s
, 
n
, 
__VA_ARGS__
))

	)

303 
	$__vsw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

304 
__æag
, 
size_t
 
__s_Ën
,

305 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

306 
__gnuc_va_li¡
 
__¬g
)

307 
__THROW
 ;

309 
	`__REDIRECT_NTH_LDBL
 (
__vsw´štf_®Ÿs
,

310 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

311 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
,

312 
__gnuc_va_li¡
 
__­
), 
vsw´štf
);

314 
__fÜtify_funùiÚ
 

315 
	`__NTH
 (
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

316 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
))

318 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

319  
	`__vsw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

320 
	`__bos
 (
__s
è/  (
wch¬_t
), 
__fmt
, 
__­
);

321  
	`__vsw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
__­
);

322 
	}
}

325 #ià
__USE_FORTIFY_LEVEL
 > 1

327 
__fw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

328 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

329 
__w´štf_chk
 (
__æag
, cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

331 
__vfw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

332 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

333 
__gnuc_va_li¡
 
__­
);

334 
__vw´štf_chk
 (
__æag
, cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

335 
__gnuc_va_li¡
 
__­
);

337 #ifdeà
__va_¬g_·ck


338 
__fÜtify_funùiÚ
 

339 
	$w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...)

341  
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

342 
	}
}

344 
__fÜtify_funùiÚ
 

345 
	$fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
, cÚ¡ 
wch¬_t
 *__»¡riù 
__fmt
, ...)

347  
	`__fw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

348 
	`__va_¬g_·ck
 ());

349 
	}
}

350 #–ià!
defšed
 
__ılu¥lus


351 
	#w´štf
(...) \

352 
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

353 
	#fw´štf
(
¡»am
, ...) \

354 
	`__fw´štf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

357 
__fÜtify_funùiÚ
 

358 
	$vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

360  
	`__vw´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

361 
	}
}

363 
__fÜtify_funùiÚ
 

364 
	$vfw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

365 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

367  
	`__vfw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

368 
	}
}

372 
wch¬_t
 *
	$__fg‘ws_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

373 
__FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

374 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_®Ÿs
,

375 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

376 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws
è
__wur
;

377 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_chk_w¬n
,

378 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

379 
__FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘ws_chk
)

380 
__wur
 
	`__w¬Ç‰r
 ("fgetws called with bigger sizehan†ength "

383 
__fÜtify_funùiÚ
 
__wur
 
wch¬_t
 *

384 
	$fg‘ws
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

386 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

388 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

389  
	`__fg‘ws_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

390 
__n
, 
__¡»am
);

392 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

393  
	`__fg‘ws_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

394 
__n
, 
__¡»am
);

396  
	`__fg‘ws_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

397 
	}
}

399 #ifdeà
__USE_GNU


400 
wch¬_t
 *
	$__fg‘ws_uÆocked_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
,

401 
__n
, 
__FILE
 *
__»¡riù
 
__¡»am
)

402 
__wur
;

403 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_®Ÿs
,

404 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

405 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws_uÆocked
)

406 
__wur
;

407 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_chk_w¬n
,

408 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

409 
__FILE
 *
__»¡riù
 
__¡»am
),

410 
__fg‘ws_uÆocked_chk
)

411 
__wur
 
	`__w¬Ç‰r
 ("fgetws_unlocked called with bigger sizehan†ength "

414 
__fÜtify_funùiÚ
 
__wur
 
wch¬_t
 *

415 
	$fg‘ws_uÆocked
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

417 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

419 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

420  
	`__fg‘ws_uÆocked_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

421 
__n
, 
__¡»am
);

423 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

424  
	`__fg‘ws_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

425 
__n
, 
__¡»am
);

427  
	`__fg‘ws_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

428 
	}
}

432 
size_t
 
	$__wütomb_chk
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

433 
mb¡©e_t
 *
__»¡riù
 
__p
,

434 
size_t
 
__buæ’
è
__THROW
 
__wur
;

435 
size_t
 
	`__REDIRECT_NTH
 (
__wütomb_®Ÿs
,

436 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

437 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wütomb
è
__wur
;

439 
__fÜtify_funùiÚ
 
__wur
 
size_t


440 
	`__NTH
 (
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

441 
mb¡©e_t
 *
__»¡riù
 
__ps
))

446 
	#__WCHAR_MB_LEN_MAX
 16

	)

447 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__WCHAR_MB_LEN_MAX


450 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__WCHAR_MB_LEN_MAX
 > __bos (__s))

451  
	`__wütomb_chk
 (
__s
, 
__wch¬
, 
__ps
, 
	`__bos
 (__s));

452  
	`__wütomb_®Ÿs
 (
__s
, 
__wch¬
, 
__ps
);

453 
	}
}

456 
size_t
 
	$__mb¤towcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

457 cÚ¡ **
__»¡riù
 
__¤c
,

458 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

459 
size_t
 
__d¡Ën
è
__THROW
;

460 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_®Ÿs
,

461 (
wch¬_t
 *
__»¡riù
 
__d¡
,

462 cÚ¡ **
__»¡riù
 
__¤c
,

463 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

464 
mb¤towcs
);

465 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_chk_w¬n
,

466 (
wch¬_t
 *
__»¡riù
 
__d¡
,

467 cÚ¡ **
__»¡riù
 
__¤c
,

468 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

469 
size_t
 
__d¡Ën
), 
__mb¤towcs_chk
)

470 
	`__w¬Ç‰r
 ("mbsrtowcs called with dst buffer smallerhan†en "

473 
__fÜtify_funùiÚ
 
size_t


474 
	`__NTH
 (
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ **__»¡riù 
__¤c
,

475 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

477 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

479 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

480  
	`__mb¤towcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

481 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

483 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

484  
	`__mb¤towcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

485 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

487  
	`__mb¤towcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

488 
	}
}

491 
size_t
 
	$__wc¤tombs_chk
 (*
__»¡riù
 
__d¡
,

492 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

493 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

494 
size_t
 
__d¡Ën
è
__THROW
;

495 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_®Ÿs
,

496 (*
__»¡riù
 
__d¡
,

497 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

498 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

499 
wc¤tombs
);

500 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_chk_w¬n
,

501 (*
__»¡riù
 
__d¡
,

502 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

503 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

504 
size_t
 
__d¡Ën
), 
__wc¤tombs_chk
)

505 
	`__w¬Ç‰r
 ("wcsrtombs called with dst buffer smallerhan†en");

507 
__fÜtify_funùiÚ
 
size_t


508 
	`__NTH
 (
	$wc¤tombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 **__»¡riù 
__¤c
,

509 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

511 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

513 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

514  
	`__wc¤tombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

516 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

517  
	`__wc¤tombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

519  
	`__wc¤tombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

520 
	}
}

523 #ifdeà
__USE_GNU


524 
size_t
 
	$__mb¢¹owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

525 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

526 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

527 
size_t
 
__d¡Ën
è
__THROW
;

528 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_®Ÿs
,

529 (
wch¬_t
 *
__»¡riù
 
__d¡
,

530 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

531 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

532 
mb¢¹owcs
);

533 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_chk_w¬n
,

534 (
wch¬_t
 *
__»¡riù
 
__d¡
,

535 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

536 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

537 
size_t
 
__d¡Ën
), 
__mb¢¹owcs_chk
)

538 
	`__w¬Ç‰r
 ("mbsnrtowcs called with dst buffer smallerhan†en "

541 
__fÜtify_funùiÚ
 
size_t


542 
	`__NTH
 (
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ **__»¡riù 
__¤c
,

543 
size_t
 
__nmc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

545 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

547 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

548  
	`__mb¢¹owcs_chk
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

549 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

551 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

552  
	`__mb¢¹owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

553 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

555  
	`__mb¢¹owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
);

556 
	}
}

559 
size_t
 
	$__wc¢¹ombs_chk
 (*
__»¡riù
 
__d¡
,

560 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

561 
size_t
 
__nwc
, size_ˆ
__Ën
,

562 
mb¡©e_t
 *
__»¡riù
 
__ps
, 
size_t
 
__d¡Ën
)

563 
__THROW
;

564 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_®Ÿs
,

565 (*
__»¡riù
 
__d¡
,

566 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

567 
size_t
 
__nwc
, size_ˆ
__Ën
,

568 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wc¢¹ombs
);

569 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_chk_w¬n
,

570 (*
__»¡riù
 
__d¡
,

571 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

572 
size_t
 
__nwc
, size_ˆ
__Ën
,

573 
mb¡©e_t
 *
__»¡riù
 
__ps
,

574 
size_t
 
__d¡Ën
), 
__wc¢¹ombs_chk
)

575 
	`__w¬Ç‰r
 ("wcsnrtombs called with dst buffer smallerhan†en");

577 
__fÜtify_funùiÚ
 
size_t


578 
	`__NTH
 (
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 **__»¡riù 
__¤c
,

579 
size_t
 
__nwc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

581 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

583 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

584  
	`__wc¢¹ombs_chk
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

585 
	`__bos
 (
__d¡
));

587 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

588  
	`__wc¢¹ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

589 
	`__bos
 (
__d¡
));

591  
	`__wc¢¹ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
);

592 
	}
}

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/stddef.h

3 #iâdeà
__®ways_šlše


4 
	#__®ways_šlše
 
__šlše__


	)

	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´İ”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´İ”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@/usr/include/asm-generic/errno-base.h

1 #iâdeà
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/asm-generic/int-ll64.h

8 #iâdeà
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__ASSEMBLY__


19 
__sigÃd__
 
	t__s8
;

20 
	t__u8
;

22 
__sigÃd__
 
	t__s16
;

23 
	t__u16
;

25 
__sigÃd__
 
	t__s32
;

26 
	t__u32
;

28 #ifdeà
__GNUC__


29 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

30 
__ex‹nsiÚ__
 
	t__u64
;

32 
__sigÃd__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm-generic/sockios.h

1 #iâdeà
__ASM_GENERIC_SOCKIOS_H


2 
	#__ASM_GENERIC_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/posix_types_32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__k”Ãl_mode_t
;

11 
	#__k”Ãl_mode_t
 
__k”Ãl_mode_t


	)

13 
	t__k”Ãl_c_pid_t
;

14 
	#__k”Ãl_c_pid_t
 
__k”Ãl_c_pid_t


	)

16 
	t__k”Ãl_uid_t
;

17 
	t__k”Ãl_gid_t
;

18 
	#__k”Ãl_uid_t
 
__k”Ãl_uid_t


	)

20 
	t__k”Ãl_Şd_dev_t
;

21 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

23 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_64.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__k”Ãl_Şd_uid_t
;

11 
	t__k”Ãl_Şd_gid_t
;

12 
	#__k”Ãl_Şd_uid_t
 
__k”Ãl_Şd_uid_t


	)

14 
	t__k”Ãl_Şd_dev_t
;

15 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

17 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__k”Ãl_lÚg_t
;

14 
	t__k”Ãl_ulÚg_t
;

15 
	#__k”Ãl_lÚg_t
 
__k”Ãl_lÚg_t


	)

17 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #iâdeà
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #iâdeà
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #iâdeà
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #iâdeà
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #iâdeà
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

66 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

67 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

68 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

69 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
è(Ñ))

	)

74 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

75 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

79 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

80 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

83 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/posix_types.h

1 #iâdeà
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__k”Ãl_lÚg_t


14 
	t__k”Ãl_lÚg_t
;

15 
	t__k”Ãl_ulÚg_t
;

18 #iâdeà
__k”Ãl_šo_t


19 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_šo_t
;

22 #iâdeà
__k”Ãl_mode_t


23 
	t__k”Ãl_mode_t
;

26 #iâdeà
__k”Ãl_pid_t


27 
	t__k”Ãl_pid_t
;

30 #iâdeà
__k”Ãl_c_pid_t


31 
	t__k”Ãl_c_pid_t
;

34 #iâdeà
__k”Ãl_uid_t


35 
	t__k”Ãl_uid_t
;

36 
	t__k”Ãl_gid_t
;

39 #iâdeà
__k”Ãl_su£cÚds_t


40 
__k”Ãl_lÚg_t
 
	t__k”Ãl_su£cÚds_t
;

43 #iâdeà
__k”Ãl_daddr_t


44 
	t__k”Ãl_daddr_t
;

47 #iâdeà
__k”Ãl_uid32_t


48 
	t__k”Ãl_uid32_t
;

49 
	t__k”Ãl_gid32_t
;

52 #iâdeà
__k”Ãl_Şd_uid_t


53 
__k”Ãl_uid_t
 
	t__k”Ãl_Şd_uid_t
;

54 
__k”Ãl_gid_t
 
	t__k”Ãl_Şd_gid_t
;

57 #iâdeà
__k”Ãl_Şd_dev_t


58 
	t__k”Ãl_Şd_dev_t
;

65 #iâdeà
__k”Ãl_size_t


66 #ià
__BITS_PER_LONG
 != 64

67 
	t__k”Ãl_size_t
;

68 
	t__k”Ãl_ssize_t
;

69 
	t__k”Ãl_±rdiff_t
;

71 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_size_t
;

72 
__k”Ãl_lÚg_t
 
	t__k”Ãl_ssize_t
;

73 
__k”Ãl_lÚg_t
 
	t__k”Ãl_±rdiff_t
;

77 #iâdeà
__k”Ãl_fsid_t


79 
	mv®
[2];

80 } 
	t__k”Ãl_fsid_t
;

86 
__k”Ãl_lÚg_t
 
	t__k”Ãl_off_t
;

87 
	t__k”Ãl_loff_t
;

88 
__k”Ãl_lÚg_t
 
	t__k”Ãl_time_t
;

89 
__k”Ãl_lÚg_t
 
	t__k”Ãl_şock_t
;

90 
	t__k”Ãl_tim”_t
;

91 
	t__k”Ãl_şockid_t
;

92 * 
	t__k”Ãl_ÿddr_t
;

93 
	t__k”Ãl_uid16_t
;

94 
	t__k”Ãl_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #iâdeà
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ià
defšed
(
__x86_64__
è&& !defšed(
__ILP32__
)

5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #iâdeà
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
295
6070
adlist.c
adlist.h
ae.c
ae.h
ae_epoll.c
ae_evport.c
ae_kqueue.c
ae_select.c
anet.c
anet.h
aof.c
asciilogo.h
atomicvar.h
bio.c
bio.h
bitops.c
blocked.c
childinfo.c
cluster.c
cluster.h
config.c
config.h
crc16.c
crc64.c
crc64.h
db.c
debug.c
debugmacro.h
dict.c
dict.h
endianconv.c
endianconv.h
evict.c
expire.c
fmacros.h
geo.c
geo.h
geohash.c
geohash.h
geohash_helper.c
geohash_helper.h
help.h
hyperloglog.c
intset.c
intset.h
latency.c
latency.h
lazyfree.c
libchash.c
libchash.h
lzf.h
lzfP.h
lzf_c.c
lzf_d.c
memtest.c
module.c
modules/hellotype.c
modules/helloworld.c
modules/testmodule.c
multi.c
networking.c
notify.c
object.c
pqsort.c
pqsort.h
pubsub.c
quicklist.c
quicklist.h
rand.c
rand.h
rdb.c
rdb.h
redis-benchmark.c
redis-check-aof.c
redis-check-rdb.c
redis-cli.c
redisassert.h
redismodule.h
release.c
release.h
replication.c
rio.c
rio.h
scripting.c
sds.c
sds.h
sdsalloc.h
sentinel.c
server.c
server.h
setproctitle.c
sha1.c
sha1.h
slowlog.c
slowlog.h
solarisfixes.h
sort.c
sparkline.c
sparkline.h
syncio.c
t_hash.c
t_list.c
t_set.c
t_string.c
t_zset.c
testhelp.h
util.c
util.h
version.h
ziplist.c
ziplist.h
zipmap.c
zipmap.h
zmalloc.c
zmalloc.h
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/dlfcn.h
/usr/include/endian.h
/usr/include/errno.h
/usr/include/execinfo.h
/usr/include/fcntl.h
/usr/include/features.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/linux/version.h
/usr/include/locale.h
/usr/include/math.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/netinet/tcp.h
/usr/include/poll.h
/usr/include/pthread.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/sys/epoll.h
/usr/include/sys/file.h
/usr/include/sys/ioctl.h
/usr/include/sys/param.h
/usr/include/sys/resource.h
/usr/include/sys/select.h
/usr/include/sys/socket.h
/usr/include/sys/stat.h
/usr/include/sys/sysctl.h
/usr/include/sys/time.h
/usr/include/sys/types.h
/usr/include/sys/uio.h
/usr/include/sys/un.h
/usr/include/sys/utsname.h
/usr/include/sys/wait.h
/usr/include/syslog.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/ucontext.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/bits/byteswap.h
/usr/include/bits/confname.h
/usr/include/bits/dlfcn.h
/usr/include/bits/endian.h
/usr/include/bits/environments.h
/usr/include/bits/epoll.h
/usr/include/bits/errno.h
/usr/include/bits/fcntl.h
/usr/include/bits/fcntl2.h
/usr/include/bits/huge_val.h
/usr/include/bits/huge_valf.h
/usr/include/bits/huge_vall.h
/usr/include/bits/in.h
/usr/include/bits/inf.h
/usr/include/bits/ioctl-types.h
/usr/include/bits/ioctls.h
/usr/include/bits/locale.h
/usr/include/bits/math-finite.h
/usr/include/bits/math-vector.h
/usr/include/bits/mathcalls.h
/usr/include/bits/mathdef.h
/usr/include/bits/mathinline.h
/usr/include/bits/nan.h
/usr/include/bits/netdb.h
/usr/include/bits/param.h
/usr/include/bits/posix1_lim.h
/usr/include/bits/posix2_lim.h
/usr/include/bits/posix_opt.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/resource.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/setjmp.h
/usr/include/bits/sigaction.h
/usr/include/bits/sigcontext.h
/usr/include/bits/siginfo.h
/usr/include/bits/signum.h
/usr/include/bits/sigset.h
/usr/include/bits/sigstack.h
/usr/include/bits/sigthread.h
/usr/include/bits/sockaddr.h
/usr/include/bits/socket.h
/usr/include/bits/socket2.h
/usr/include/bits/stat.h
/usr/include/bits/stdio-ldbl.h
/usr/include/bits/stdio.h
/usr/include/bits/stdio2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/stdlib-bsearch.h
/usr/include/bits/stdlib-float.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/sys_errlist.h
/usr/include/bits/sysctl.h
/usr/include/bits/termios.h
/usr/include/bits/time.h
/usr/include/bits/types.h
/usr/include/bits/uio.h
/usr/include/bits/unistd.h
/usr/include/bits/utsname.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/bits/wchar.h
/usr/include/bits/wordsize.h
/usr/include/bits/xopen_lim.h
/usr/include/getopt.h
/usr/include/gnu/stubs.h
/usr/include/libio.h
/usr/include/linux/sysctl.h
/usr/include/rpc/netdb.h
/usr/include/sched.h
/usr/include/stdc-predef.h
/usr/include/sys/cdefs.h
/usr/include/sys/poll.h
/usr/include/sys/syslog.h
/usr/include/sys/sysmacros.h
/usr/include/sys/ttydefaults.h
/usr/include/sys/ucontext.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/asm/ioctls.h
/usr/include/asm/socket.h
/usr/include/bits/byteswap-16.h
/usr/include/bits/fcntl-linux.h
/usr/include/bits/libio-ldbl.h
/usr/include/bits/libm-simd-decl-stubs.h
/usr/include/bits/local_lim.h
/usr/include/bits/poll.h
/usr/include/bits/poll2.h
/usr/include/bits/sched.h
/usr/include/bits/socket_type.h
/usr/include/bits/syslog-ldbl.h
/usr/include/bits/syslog-path.h
/usr/include/bits/syslog.h
/usr/include/bits/timex.h
/usr/include/bits/typesizes.h
/usr/include/gnu/stubs-64.h
/usr/include/linux/errno.h
/usr/include/linux/kernel.h
/usr/include/linux/limits.h
/usr/include/linux/param.h
/usr/include/linux/types.h
/usr/include/asm-generic/ioctls.h
/usr/include/asm-generic/socket.h
/usr/include/asm/errno.h
/usr/include/asm/param.h
/usr/include/asm/types.h
/usr/include/gconv.h
/usr/include/linux/posix_types.h
/usr/include/linux/sysinfo.h
/usr/include/wchar.h
/usr/include/asm-generic/errno.h
/usr/include/asm-generic/param.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/asm/sockios.h
/usr/include/bits/wchar-ldbl.h
/usr/include/bits/wchar2.h
/usr/include/linux/ioctl.h
/usr/include/linux/stddef.h
/usr/include/wctype.h
/usr/include/asm-generic/errno-base.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm-generic/sockios.h
/usr/include/asm/ioctl.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
